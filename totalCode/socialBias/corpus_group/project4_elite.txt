  [@gengjiawen](https://github.com/gengjiawen) has updated the pull request. [@gengjiawen](https://github.com/gengjiawen) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2082/files/514fc359aed6cfa447b3be220193c97f79950952..44427cf7fabcd61557bfdde56ad21579c3266830)  Could you share the code where you set up your `ImageRequest` and `DraweeController`?

Also CC @oprisnik   Thanks @novotnyfra for raising this issue :)

Seems like it got lost in here: https://github.com/facebook/fresco/pull/2075

I'll fix that right now You can use `https://raw.githubusercontent.com/facebook/fresco/master/fbcore/proguard-fresco.pro` as a working link for now  Neat and tidy ðŸ‘ thanks for the PR  Closing empty issue

@zhoulailai please replace the template with your question/bug-report when opening a new issue :)  Yes, this seems to be a duplicate of #2049 (especially https://github.com/facebook/fresco/issues/2049#issuecomment-367235216). @jyh149129, I'm closing the issue here to focus the discussion there :) 

Thanks @gengjiawen!  It's not merged yet :) I've imported it to our internal system to verify it and get comments from my colleagues.

Once it is merged, this pull-request will close automatically Hi @gengjiawen this looks good :)

However, can you remove the update of the documentation for now? We'd want to wait with it until we made the new release. [@gengjiawen](https://github.com/gengjiawen) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2075/files/8741263fe0d17ba2508fe99c3ef6b5a51f72bd78..d93ed23438a35e179f6db04472cd6543ebfd82f1), [changes since last import](https://github.com/facebook/fresco/pull/2075/files/8741263fe0d17ba2508fe99c3ef6b5a51f72bd78..d93ed23438a35e179f6db04472cd6543ebfd82f1)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%232074). Thanks! Thanks @howardpang ! I'll run this against our internal tests once we have the CLA :) Hi @howardpang, can you try the CLA flow again? If it's successful then the bot will add a tag "CLA Signed" to this PR (like here https://github.com/facebook/fresco/pull/2075).

Let me know when trying again doesn't work and I'll forward it to the team that maintains that flow Hi @howardpang, can you mail cla@fb.com with a link to this PR? They should be able to sort it out quickly :) Seems that the GitHub username that was entered had a typo. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!  Thanks for creating this issue @howardpang! This looks legit.

We'll have a look, but also feel invited to provide a PR with the suggested fix :) Fixed in https://github.com/facebook/fresco/pull/2079  Thanks @YuZhiLiang for the bug report. I feel that I cannot reproduce this on a Google Pixel with Android 8.1.0 in our showcase app.

When setting your border configuration, the edges look weird. However, when zooming in it seems that they are correct and it's just the thinness of the border that makes it look weird.

Setting an overlay color (opposed to bitmap rounding, http://frescolib.org/docs/rounded-corners-and-circles.html) does not seem to have any effect.

Does removing the border help in your case?
Is it just that OPPO device or also other Android 8.1.0 devies?

**img1: Just setting rounding looks great**

![a](https://user-images.githubusercontent.com/908387/37768809-d4b9d9a0-2dc6-11e8-8f97-8760478d3f7d.png)

**img2: Adding a 0.33dp border looks "ugly" around the corners**

![b](https://user-images.githubusercontent.com/908387/37768814-d846e7c0-2dc6-11e8-866d-dc28c563ecb8.png)

![bb](https://user-images.githubusercontent.com/908387/37769140-ee3159fc-2dc7-11e8-8461-05ea9d12385f.png)
  What would you like to achieve? 

The `EncodedImage` class represents an image. The fact that this image might have had a network URL at some point should be irrelevant. That's interesting. So you're catching the OOM exception and just display no image if it happens?  Thanks for reporting the issue. Can you add some sample images where this happens so that we can try to reproduce the issue? Thanks!  I think we might not properly handle 9patch images with rounded corners. You can manually create a rounded corner version in code and set it.

We'd appreciate help with implementing this if you or somebody else wants to add this feature.  [@jnawaz](https://github.com/jnawaz) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2068/files/834c97521bddc0648c1553f30d2d5388919c11cd..a933a4e33c77c7bc9c3433c69d86c2bd7c306210) [@jnawaz](https://github.com/jnawaz) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2068/files/a933a4e33c77c7bc9c3433c69d86c2bd7c306210..7110c8c137405a84381a047a44c1fca6a5f14abb) [@jnawaz](https://github.com/jnawaz) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2068/files/7110c8c137405a84381a047a44c1fca6a5f14abb..07e0d6d10e7c2ce38c9bd3746cb6608991bdc4e5)  Hi @BerkeWu 

What happens if you don't set scale type but use ResizeOptions instead?  Hi @tasneembohra 

Could you please post this issue on the React Native bug tracker instead: https://github.com/facebook/react-native

It looks to me like the exception is more related to RN than to Fresco.

Thanks!  Hi @DogParty 

I believe you can achieve what you want using one of the listeners that we provide:
http://frescolib.org/docs/listening-to-events.html  That said, we're happy about pull requests that make this easier to check. Feel free to submit one!  Thanks for the PR @NightlyNexus !  Thanks!  Hi @ChengCheng-Hello 

I think the problem might be that you are also using some other library in your app which modifies how classes and .so files are loaded. 

My guess is that com.taobao.sophix.core is connected to this.

@oprisnik  - is it still possible to use SoLoaderShim instead of SoLoader? That might help here.

 No, SoLoader is the new default, but it should not interfere with this. @oprisnik , it seems like SoLoader assumes that the class loader extends BaseDexClassLoader though. So if you're injecting a different class loader (I guess this is the case here), it would break.   Hi @PalDhv,

Thanks for reporting this issue. Have you checked our [showcase app](https://github.com/facebook/fresco/tree/master/samples) that shows an example of [gif loading](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/gif/ImageFormatGifFragment.java)? 

Please take a look on the link I provided to see if you're using the correct code, otherwise please provide a code sample to reproduce your issue. The code looks good and should work. Does this happen exclusively for GIF images or also for normal images? Do you have a sample GIF for us?  Try calling `SoLoader.setInTestMode()` in your test setup (`@Before` method). We do this in a bunch of our tests as well, see:

https://github.com/facebook/fresco/search?q=setintestmode

Let me know if this fixes the issue. We should probably document this somewhere. Hmm, `MainApplication#onCreate()` shouldn't be called before setUp. Perhaps you can try using `@BeforeClass` instead? Hi @sdeira 

Could you replace your default Application class with one used only for the tests?

it should be possible using Robolectric: https://stackoverflow.com/questions/21725309/robolectric-not-using-test-application  I'm not familiar with React Native's gradle build setup. I think you might have more success posting your issue on the RN issue tracker. Because I had no hope. If you are interested in this issue I can reopen it.  You probably want [`ImagePipeline#prefetchToBitmapCache`](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/core/ImagePipeline.html#prefetchToBitmapCache(com.facebook.imagepipeline.request.ImageRequest,%20java.lang.Object)).

Closing this issue now as it's not actually a bug, but a question.  Hi @geek2driod ,

Sorry for the slow response, there are some general things you can check to help reduce the number of OutOfMemoryErrors you get.

- Verify that all images you load have a suitable size (something close to the size you want to display on the screen).
- If you don't have control over the exact size of the images you load, then make sure that you specify resize options when loading the image. This will reduce memory usage: http://frescolib.org/docs/resizing.html
- If you are using the image pipeline directly to load images (and get the bitmap), be careful so that you don't leak any memory. In the layout for your recyclerView items, how do you define the width and height of the SimpleDraweeView?

Also, what does setTeam2Flag(bitmap) do? Since you have a fixed hight and aspect ratio, could you not set the resize option without the need to the layout listener?

The usage of com.facebook.imagepipeline.datasource.BaseBitmapDataSubscriber is not correct (but I don't think it could case the issue you're experiencing). If you check the documentation for BaseBitmapDataSubscriber, you will see that is says

`public void onNewResultImpl(@Nullable Bitmap bitmap) {
        // Pass bitmap to system, which makes a copy of the bitmap.
        updateStatus(bitmap);
        // No need to do any cleanup.
      }`

I recommend that you either switch to using a BaseDataSubscriber and manage the ClosableReference or keep using BaseBitmapDataSubscriber and instead copy the bitmap.  Hi @yleyvag , sorry for the slow response!

Going by what I see in the logs (lots of lines about split apks) I assume that you are running this from inside Android studio. It's possible that the crash is caused by a bug in Instant Run so I recommend turning this off (it's in the Android Studio settings) and check if that helps.  Hi @lin-zy1229, thank you very much for the detailed information!

I think this is the same issue as https://github.com/facebook/fresco/issues/2054 (which is older). Close this one here so we have the other issue to as a single place where we communicate. I'll link to this issue from there as well.

This doesn't mean that this issue is wrong, it's just for focusing communication :) Let me know if you think that these are separate problem and I'll promptly re-open.  Hi @Anilugale and @lin-zy1229, thank you very much for raising the issue. This might be due to our updates regarding the compile/api directives in 1.8.0. We'll look into reproducing this locally such that I can precisely see what's going wrong here.

This problem also been mentioned in https://github.com/facebook/fresco/issues/2055 (which I'll close so we have this issue as the single place for communication). Also CC @dmitryou from the other issue.

When you figure out something in the mean time, please let me know. @Anilugale in your issue, you specify:

> Fresco version: 1.8.1

But also:

> frescoLibVersion = '1.5.0'

Which one is true?

Also, what is your React Native version? Well, React Native depends on Fresco 1.3.0, see here:

https://github.com/facebook/react-native/blob/master/ReactAndroid/build.gradle#L284

So if you're overriding the Fresco version you can expect things not to work. I'm checking internally to see if / how we can fix this.  Hi @ChinmayLad, thanks for raising the issue. I'd need some more information in order to help you.

Can you provide which version of Fresco you are using and which Phone (model + Android API) you are using? Also, does it work when you comment out the line `configureCaches(configBuilder,getAppContext());`?

I've tried to reproduce in the showcase, but it works fine:

With Internet:

```
02-19 18:49:55.808 3749-3775/com.facebook.fresco.samples.showcase V/unknown:RequestLoggingListener: time 67152: onProducerStart: {requestId: 10, producer: DiskCacheProducer}
02-19 18:49:55.811 3749-3840/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Did not find image for http://frescolib.org/static/sample-images/animal_b_m.jpg in staging area
02-19 18:49:55.812 3749-3840/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Disk cache read for http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:49:55.812 3749-3840/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Disk cache miss for http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:49:55.813 3749-3840/com.facebook.fresco.samples.showcase V/unknown:RequestLoggingListener: time 67157: onProducerFinishWithSuccess: {requestId: 10, producer: DiskCacheProducer, elapsedTime: 5 ms, extraMap: {cached_value_found=false}}
02-19 18:49:55.954 3749-3778/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: About to write to disk-cache for key http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:49:55.974 3749-3778/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Successful disk-cache write for key http://frescolib.org/static/sample-images/animal_b_m.jpg
```

Then killing the app, turning on flight-mode, restarting:

```
02-19 18:51:02.454 4218-4243/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Did not find image for http://frescolib.org/static/sample-images/animal_b_m.jpg in staging area
02-19 18:51:02.454 4218-4243/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Disk cache read for http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:51:02.499 4218-4243/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Found entry in disk cache for http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:51:02.838 4218-4243/com.facebook.fresco.samples.showcase V/unknown:BufferedDiskCache: Successful read from disk cache for http://frescolib.org/static/sample-images/animal_b_m.jpg
02-19 18:51:02.839 4218-4243/com.facebook.fresco.samples.showcase V/unknown:RequestLoggingListener: time 134183: onProducerFinishWithSuccess: {requestId: 0, producer: DiskCacheProducer, elapsedTime: 401 ms, extraMap: {cached_value_found=true, encodedImageSize=40502}}
02-19 18:51:02.839 4218-4243/com.facebook.fresco.samples.showcase V/unknown:RequestLoggingListener: time 134183: onUltimateProducerReached: {requestId: 0, producer: DiskCacheProducer, elapsedTime: -1 ms, success: true}
``` Hey, it seems that the cache directory is removed between the app sessions.

Can you verify that the content of the folder of the cache directory using `adb shell` while the app is displaying and after app kill?  The link that you are passing is not to a photo but to a webpage that renders a photo as part of it and Fresco cannot parse that since it's not an image.

The URI that you are passing needs to be an image, so I suppose there is a Google Drive API / SDK that lets you do that, maybe https://developers.google.com/drive/ can help.
Since this question is not related to Fresco but to Google Drive, I'd suggest posting on StackOverflow or looking at the Google Drive APIs / SDK.  Do you already use Bolts for something else in your Gradle file?

Please fill out the GitHub issue template. Hi @KirillJJ,

I've tried to use your dependency list to see which import is providing another bolt copy. However, I've run into multiple other errors (and I'm missing the values for your variables). Can you try to get a more verbose log that might point to which other import provides the `bolts` library? Or try to disable them one-by-one until that error goes away?  Please fill out the GitHub issue template. Without more details, we cannot help you.  How is your build set up? Are you using ABI splits? http://frescolib.org/docs/shipping.html Hi @hsandyque, you don't need the extra dependency on `soloader` as it now ships with Fresco since 1.8.0. I'd recommend updating to 1.8.1 as it fixes other bugs.

Your build.gradle file should reference the `proguard-fresco.pro` file as described in the link that @oprisnik posted.

For clarification: does this bug _only_ happen on that particular device? Is there any `adb logcat` output that you can share? Hi @hsandyque, given that it only happens with Oppo phones suggests that the way the binary libraries are bundled and the way the phone loads them are not playing nice.

I don't have access to an OPPO phone at the moment and I couldn't find better pointers when searching :/

(a) Does this also happen when installing the showcase app that we have in our repository? (that would bring me closer to debug this once I get hold on an OPPO phone)
(b) Can you provide the output of running `unzip -l your_release.apk | grep lib/` on your release APK? That will show which files are actually bundled. @hsandyque 

Do you specify any ABI (CPU type) filters in your apps gradle files?  Hi @mpivchev, our Showcase sample app has an example that does exactly that.

The XML layout looks similar to yours:
https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/res/layout/activity_drawee_transition_detail.xml

The Java code is here (which is again very similar):
https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/transition/ImageDetailsActivity.java

Please check where your code differs from the sample I've linked to above. Everything works in the sample app and your code does look quite similar, so I suppose the issue is somewhere else.

I'm closing this for now, but if you think there is an issue with the Fresco library, let us know with more details and how to reproduce in the Showcase sample app (e.g. by changing the example) and we'll re-open and investigate.
  Hi @HenryChao24, I think the issue might be with the `ResourceUtil` that you are using (is it the Apache one?).

Fresco comes with a `UriUtil` class that should correctly handle the `#` sign in file paths. I've tested that the following works in the Showcase sample app:

```
final Uri uri = UriUtil.getUriForFile(new File("/sdcard/Download/penguin#penguin.jpg"));
simpleDraweeView.setImageURI(uri);
```  Looks good to me :) Was there any specific issue that arouse from having the older versions?   [@eldk](https://github.com/eldk) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2043/files/775facc9d27ee54aa02a8ee99e90ca828a544d0e..54db8c0405e092d9a0ed9d1366fc79130dc43163) [@eldk](https://github.com/eldk) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/2043/files/54db8c0405e092d9a0ed9d1366fc79130dc43163..430cfecd755af0efb4e960f26406e3ac21ff828b) Awesome! Thank you very much :) I will just check if it also builds fine with older NDK tool chains  Hi @eldk, thanks for the pull-request :) I'm going to check with @foghina if this change was intended this way.

It's coincidence that the showcase builds fine because the `implementation "com.facebook.stetho:stetho-okhttp3:${STETHO_VERSION}"` dependency leaks OkHttp3 as a `compile` dependency.

I'm happy to change it back to API as most people want to access `OkHttp`/`OkHttp3` in their application any way. However, it would also be good to have them make it explicit in their own gradle file :)   Thanks for the PR @eldk !  Thanks for the bug report @eldk!

Looks like both copies of `jpeg_codec` are missing `#include <string.h>`. I'd guess that previous NDK versions just did not care enough about this.

Can you check if adding those lines to the file might solve the problem? I don't have that NDK version ready at the moment - but otherwise I'll have a look on Monday :)  Hi @gajicm93, thank you very much for the bug report!

I can reproduce this with the showcase app by using the build settings that you've mentioned and a 4.4.2 emulator.

I'll have a look into how we can fix this (y) Got it, proguard needs to know about the SoLoader `@DoNotOptimize` annotation. I'll add those rules for to the Fresco proguard file. If you want to unblock yourself in the meantime, you can add the following lines to your app's proguard file:

```
-keep,allowobfuscation @interface com.facebook.soloader.DoNotOptimize
-keep @com.facebook.soloader.DoNotOptimize class *
-keepclassmembers class * {
    @com.facebook.soloader.DoNotOptimize *;
}
``` Thanks for reporting this issue. @lambdapioneer has updated the ProGuard rules with 559082930126c05988f46de8f27fccad0dd88568, so please update your proguard files!  Hi @sidzi 

WE've not planned to implement support for this. You are more than welcome to add support and submit a pull request though since it sounds like a useful feature.  Hi, @AlirezaGhanbarinia, you can use placeholderImageScaleType and pass there scale type from http://frescolib.org/docs/scaletypes.html Can you please specify what is thumbnail in your case? Where do you use, what do you show there?
I thought thumbnail is the same as "placeholder". Hi @AlirezaGhanbarinia, can you post some sample code that reproduces the issue? I'm not sure if thumbnail refers to what we call "placeholder" (see http://frescolib.org/docs/placeholder-failure-retry.html) or if you are doing a multi-uri request (see http://frescolib.org/docs/requesting-multiple-images.html). Hey @AlirezaGhanbarinia, I've looked into this and tried to reproduce the issue. I took the `DraweeScaleTypeFragment` fragment from the Showcase sample app and changed the following method:

```
  private void changeMainDraweeUri(Uri uri) {
    final AbstractDraweeController controller =
        Fresco.getDraweeControllerBuilderSupplier().get()
            .setUri("http://frescolib.org/static/sample-images/animal_a_xxl.jpg")
            .setLowResImageRequest(ImageRequest
                .fromUri("http://frescolib.org/static/sample-images/animal_d_xxl.jpg")).build();
    mDraweeMain.setController(controller);
  }
```

By default the scale type in this example is `ScalingUtils.ScaleType.CENTER`. I observed the intended behavior: Both the low-res image request and the final image request are shown using the mentioned scale type (focus on the center, original size and rest of the image cropped).

Do you want to apply different scale types for the different image requests? In that case there is no easy solution that I'm aware off. The same `setActualImageScaleType` is applied to both the low-res image request and the normal image request.

Or is there another issue showing? It would be most helpful to have a code sample that I can run locally to reproduce the issue :)  Sorry to hear about your problems, @HardikMaru. Can you provide more details?
We need:
* Code sample which reproduces this issue
* Url to image which causes problems Hi @HardikMaru, we would need a minimal code sample that reproduces the issue as we simply don't have the capacity to debug 3rd party apps. Also, the task of reducing it down to the most-simple Activity most likely will already show you what excatly causes the issue.

Maybe it can help you to compare your app with our showcase app which uses a drawer which works quite fine. Also the recycler view example might be interesting for you: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java

Feel free to open a new task with a compilable sample (or ideally a modification of the show case app) that demonstrates the issue.  Thanks you for reporting this @eaggle. Does it behave differently for gif's? Hi @eaggle. Android does not natively support GIFs and animated WebPs. Fresco includes custom decoders that make use of native C/C++ libraries to add that functionality and manually create Bitmap frames - which is not hardware accelerated.
Also, constantly updating all views with the bitmap frames requires the view to be invalidated, the next frame to be loaded from cache, the drawable updated, the new bitmap drawn and next frames prepared ahead of time so that they are ready - which explains your CPU usage.

I'm afraid that at the moment there's not a lot that you can do. You can customize the animation so only selected animation frames are played (and drop the rest) or have some GIFs tap-to-play and you should ensure that the memory cache is adequately sized. If that is not the case (e.g. imagine the cache is 0, you cannot cache any frames and always have to re-decode all the frames).

For your GIF URL that you posted above:
It has 60 frames, each of them 170x121, 8 bit.
This means that all frames for 1 GIF take up ~ 4.7 MB, for 9 GIFs this would be ~42 MB.

If you have any suggestions on how to improve this, please let us know and submit a pull request!
To experiment with different decoders, you can add a custom decoder, see http://frescolib.org/docs/customizing-image-formats.html

I'm closing this for now, but if you have further questions, let us know!  @anymol, please take a look at conversation here: https://github.com/facebook/fresco/issues/1592#issue-196621209  @richso, Looks like you are trying to update ViewPager model outside of main thread. 
I can't see this from your stack trace for sure, but suspect this from exception.
It is likely that you fix this by moving your code which updates model to AsyncTask.onPostExecute()  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%232031). Thanks! Hi @sivaraam 

Thanks for this pull request! Yes, in order to contribute it you are required to sign the CLA, so please do that if you want it accepted. This has been merged in #2032.  Hi @chandru22 

Could you please fill out the template and provide more details in the issue description?  Please fill out the template. We have no idea what's going on in your case.  Hi @datnt1987 

Could you please post a code snippet that you're using? What is the image that is failing to load? I don't see anything suspicious in these code snippets. Can you compare your code to our Showcase sample app  recycler view (https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java)?
There, everything works as expected, so if you make sure your code behaves similarly, everything should work.

You can also experiment with our sample app, see https://github.com/facebook/fresco/tree/master/samples/  Hi @haodadaa 

This was supposed to be fixed in v1.8.0. Is it still reproducible for you after upgrading? Thanks! As @erikandre said, this should have been fixed with 1.8.0 and we also released 1.8.1 recently. If this is still an issue, please fill out the issue template and let us know how to reproduce the error (e.g. sample image).  Hi @zhangzhen123! Thanks for submitting the bug report.

Using the resize option currently only works OK for some use cases (like when the resized image is smaller, but not by much).

Could you try the following workaround:

```
draweeSpanStringBuilder.setDraweeSpanChangedListener(new DraweeSpanStringBuilder.DraweeSpanChangedListener() {
      public void onDraweeSpanChanged(DraweeSpanStringBuilder builder) {
        mDraweeSpanTextView.setDraweeSpanStringBuilder(builder);
      }
    });
```  Hi @asadullahrao 

This might be a bug for using the XML value, it should work when set in code using `setActualImageScaleType()` method (as in the scaling example in the showcase app).

We'll take a look on that, thanks for reporting! I cannot reproduce this in the showcase app, are you sure there is no padding set in the layout or parent? If you look at the documentation for DraweeView, you'll find that `setImageBitmap` is deprecated: `Use this method only when using this class as an ordinary ImageView.`.
Basically, your image view will be "downgraded" to an ImageView and that's the default ImageView behavior.  Hi @abdrasulov 

You're right, currently we don't support fading behavior between images using RetainingDataSourceSupplier but we will take a look into it, as it would be definitely great to have it.

Thanks for reporting!  Thanks for reporting this issue.
Android Oreo added support for wide color gamut images and Fresco does not fully support wide color gamut yet. I've recently implemented a workaround so that they are at least rendered (albeit less efficiently), 4a64df0099776be6bb1e229a274526e1d5c54df3

The next release will include the fix. Proper support will be added at some point in the future. Pull requests are welcome :)  Hi @zzx2016 

Have you seen any pattern in the crashes? For example, it only happens on some devices or Android versions?

Based on the stack trace I think it happens when trying to load the drawable set as the "retry image". Are you using this feature in your app? and if so, what type of drawable are you using? (xml, animation, png/jpeg) @zzx2016 - are you using an xml drawable as the placeholder image? I'm wondering if the problem could be something similar to what is described here: https://stackoverflow.com/questions/34252386/android-view-inflateexception-binary-xml-file-line-8-error-inflating-class-u Thanks for the additional details @zzx2016 !

In the stack trace I see that you are using a subclass of SimpleDraweeView (ZZSimpleDraweeView).
Does it add any functionality to SimpleDraweeView? Just asking since in the xml you are just using SimpleDraweeView.  Thanks for reporting this issue. @lambdapioneer fixed this, so if you upgrade to 1.8.1 it should work again!  I think we should only make this change if the range also begins at byte 0. If you want to make that change here then we can merge this.

I'm curious about cases where the response include the `Content-Range` header despite returning the entire response.

Can you share a URL to an image which needs this change? [@bschnack](https://github.com/bschnack) has updated the pull request.  Hi @Yinzeyu 

Could you please provide more details.

- What kind of images are you loading?
- How large are they?
- Are you setting any ResizeOptions when loading the image?  Hi @oldmansulaiman 

Could you please provide a bit more details.

Thanks! Closing due to lack of information  Thanks for reporting @ericleong, we'll take a look It looks like 504401041cc783c231feb7fabc870a3acea3ee30 introduced this regression. We'll fix it. Fixed with 086fd1dfc4ee6d772ea50cba7731461120dd95c5  Region decoding is still work in progress (you can't currently use it out-of-the-box with Fresco). We might add support for it later on.  Thanks for the pull request @zjupure! How did you test your changes? Do you have a before and after image for the issue?  Thanks!  Please fill out the issue template. I have no idea what your issue is and how to reproduce the error. Closing due to inactivity.  I'm pretty sure this is related to the smart resizing / downsampling bug in 1.7.1, see #2000 
Thanks for reporting!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%232010). Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! [@jungletian](https://github.com/jungletian) has updated the pull request. I'm closing this PR since this is breaking the correct behavior of `wasImmediate` (more info in #2006).  @oprisnik probably a malformed gif? The GIF plays correctly for me in the Showcase sample app media picker example when I auto play animations: `        mSimpleDraweeView.setController(Fresco.newDraweeControllerBuilder().setAutoPlayAnimations(true).setUri(data.getData()).build());
`

I recently fixed partial frame rendering, which might have fixed this.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%232008). Thanks! [@jungletian](https://github.com/jungletian) has updated the pull request. Thanks for the pull request @jungletian. Can you please sign the CLA? Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! This PR changes the current logic of caching post-processed images. This issue isn't valid because in order to cache the post-processor results you need to implement the `getPostprocessorCacheKey()` method (see docs http://frescolib.org/docs/modifying-image.html#caching-post-processor-results) which is used in `PostprocessorProducer`.

For postprocessors that we decide not to require caching, the image to be processed is still taken from cache with a cache key returned from `getBitmapCacheKey()` method.

  This issue isn't valid since the logic for caching post-processed images is included in PostProcessorProducer (more info in #2008). This issue isn't valid because in order to cache the post-processor results you need to implement the `getPostprocessorCacheKey()` method (see docs http://frescolib.org/docs/modifying-image.html#caching-post-processor-results) which is used in `PostprocessorProducer`.

For postprocessors that we decide not to require caching the image to be processed is still taken from cache with a cache key returned from `getBitmapCacheKey()` method.  In the current code `wasImmediate` is not always `false`. Please take a look on tests in `AbstractDraweeControllerTest` where you can find scenarios when it is `true`.

The PR you sent is breaking the tests for scenarios where `wasImmediate` should be `false`, it seems like after your change it always returns `true` which is not expected.  I'm afraid I don't understand what your problem is. I'm not sure what you mean by "memory jitter"? Are you hitting a crash? Is there a stack trace that you can share from the Meizu phone?  Hi @wangzhengyi 

I don't see any obvious problem in your code. What are you passing in as the BaseBitmapDataSubscriber parameter to downLoadImage()? It sounds like `prefetchToDiskCache()` (or even to memory cache) is actually what you want in this case. Closing this for now, but let us know if you're still having issues.  Hi @DankeLuo 

What ResizeOptions are you using? It would also be helpful if you could attach a screenshot showing the problem.

Thanks!  Hi @yihuaqi !

Are you using any of the setFirstAvailableImageRequests(...) methods in AbstractDraweeControllerBuilder? I took a look and that code path should only be invoked if mMultiImageRequests has been assigned in the controller builder. @yihuaqi, great :)

Yes, you're right, having a better error message for this would be very useful. I'll add it to the list of future improvements.
You are also very welcome to submit a pull request.

Thanks!  Fixed in https://github.com/facebook/fresco/commit/6449ca0162a856f32898ff82b6ce41250b038535

I've changed the behaviour to assert that the arguments are not empty at an earlier point. That should make it easier for others who might run into this.  Thanks for reporting this issue. Maybe, @oprisnik can check if this issue caused by region decoding. Hi @MidoriInu1 

Thanks for submitting the bug report. I tried to reproduce this in the Showcase app using our normal test images, but no luck.

Would it be possible for you to share one of your test images so that we can try it out? Thanks! I've just tested with the current master version and the Showcase app correctly resizes JPEG images. However, you're right @MidoriInu1, PNG downsampling is broken. I should have a fix shortly. Thanks for reporting!
 The fix is now available, see e2c464efbc9214d1a00aa416d3d9cfb26c0298da. Also fixes the issue for WebP.  Fixed in v1.7.1, see #1991.  Thank you, @8enet   Don't know how to act on this report  Thank you!!  Please ask such questions on stackoverflow   Release notes published now: https://github.com/facebook/fresco/releases
Sorry for delay.  Whoops, this is my bad. I've updated the release details with a link to this issue. I'll have a look tomorrow and push another release.

@efrohnhoefer do you think the plugin update is enough to fix everything? I would've thought some `implementation` -> `api` dependency changes would be necessary as well. [v1.7.1 is now out](https://github.com/facebook/fresco/releases/tag/v1.7.1).  Hi @pluzmedia 

I believe the resized image should at least be cached in memory. Are you seeing a different behaviour? or is the problem that the resized image is not cached to disk?  Hi @yline 

Could you please try using ResizeOptions to make sure that the images are resizes to a size that is suitable for the view. More details here: http://frescolib.org/docs/resizing.html

You can also enable the debug overlay to check if the images you are loaded are the right size:

https://github.com/facebook/fresco/blob/38d13c0995fd93688b228abea717870775868975/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/ShowcaseApplication.java#L76

With the overlay enabled, images that are the correct size are shown in green while images with incorrect size are shown in red.

 Closing due to no response from the submitter.  @obabujiApp, can you please follow the guidance when posting issues. We need more details to help you.
Do you have example of an image you are loading?
What is definition of "taking too much time"? Is this time to load image or display image?
Is it slow when image been already cached and loaded from disc cache? (for this you can kill app and restart and if you have same urls you can expect them to be in disc cache).
How many images do you want to show?
How does your request looks like? Do you apply any transformations to the request?
How does you pipeline configured?
Thank you @obabujiApp, by saying "slow", are you talking about minutes, seconds, milliseconds? What is your network speed? How fast browser loads same images on your phone on the same connection? Is it relatively same time or fresco is much slower? Thank you, @obabujiApp, we will investigate this issue @obabujiApp I've tried to reproduce the described issue in the Fresco showcase app.

For me it took about 2000ms before the image was displayed (I used one of your example images).
Most of that time was spent waiting for the download to finish.

When doing the same download on my laptop (just using wget) it takes about 500ms so 4x faster.

The times that you mention sounds really long, specially that it would 40 seconds to load in browser (is that the browser on your device). Since I don't see any action to take here or a strong connection to Fresco itself I'm going to close the issue.

If you have some additional information that could help us investigate this, then please comment here and I can reopen the issue.  We don't support SVG out of the box. However, we have an example for a custom SVG decoder here:

https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg/SvgDecoderExample.java

Also, in the future, please actually fill out the issue description template.  Thank you for the report! We don't use OkHttp internally so this is fairly low priority for us. Feel free to send a pull request though! Oh, sweet. I had no idea ðŸ˜…  See here for solution: https://github.com/facebook/fresco/issues/933#issuecomment-186266187  PRs are welcome :)  Are the stickers animated (gif / webp)?

If not, it's probably just a matter of either increasing the memory cache size (which you can do when configuring the pipeline), or more aggressively recycling DraweeViews. What are you using to display stickers, ScrollView or List/RecyclerView? We have this issue internally to some degree as well. In our case the fix was to use `forceStaticImage` in the decode options so that we only show the first frame of the gif in the RecyclerView. You can then implement a tap-to-play feature. Showing many GIFs in a grid/list view is going to be hard with any image library.

You can also look into using videos instead.

> In 14 and above

Do you mean version `0.14`? That is very old. Have you tried with something more recent, like `1.7.1`? So I think in v1.4.0 (is this what you're using?) we switched from having a separate memory cache for GIF frames to using the main one. This is good generally as it reduces the overall memory footprint (and OOMs) of Fresco by evicting other bitmaps in favor of animation frames, but it does also lead to this exception.

@oprisnik since you made this change, do you know if there is a way around this exception? Perhaps increasing the default bitmap pool size? Or configuring the frame prefetching differently? The limit is hardcoded to 384 at the moment (https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/BitmapCounterProvider.java#L26) but we should re-evaluate that.  I believe the issue here could be that Fresco caches both the original image and the postprocessed image in memory cache. If for example the postprocessed image gets evicted from the cache (which I guess happens in your example), we'll have a hit on the original image and then apply the postprocessor and then cache the postprocessed image.
The postprocessed image will currently not be cached to the disk. If you prepare a lot of images ahead of time, you'll find that on devices with low memory, you can run into the situation where you'd prepare too many images, which means that the least recently used ones (which are now the ones that are about to be displayed) get evicted, which means you run into the situation that you've described.

However, I think that in your case, having a custom decoder would be the correct way? I don't know how your encryption works (what the original bitmap looks like), but you can just add a (globalZ) custom decoder that is able to decode the image stream you get from the network directly - which is way better for memory since you don't have to cache both versions. This should then also help with having more images cached.
A simple example for a custom color decoder can be found here: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/color/ColorImageExample.java
  This doesn't look like anything I've seen before :(. It looks like the call isn't even making it into some a DraweeView, or any Fresco code for that matter.

DraweeViews are leaf nodes, we don't have any `ViewGroup`s in Fresco that would potentially cause this.

Is there any chance that your A/B experiment is not fully initialized or something, thus returning a `null` view somewhere?

I'm really scratching my head at this one. It shouldn't be possible to have a null view in a hierarchy, which is probably why `dispatchVisibilityAggregated` isn't guarding against it. Could be an Android bug?

I'm guessing you're not able to repro this locally, right? Try switching screens really quickly / a lot (maybe even write an espresso test that does it). Could be some weird race condition.

I'm sorry this isn't more helpful, but I don't have a lot to go on without code / a repro. I believe this was fixed ðŸ˜Š  This issue has no details at all. Please open another if you want to raise something.  Hi, @JinohK, thank you for reporting this issue. I was able to reproduce it in our showcase app. Looks like we don't support downsampling of gifs. Downsampling / resizing for GIFs is indeed not supported. Pull requests are welcomed :)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%231974). Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! @Anandsoni14 I followed that URL but get this error. Could that be because of location restrictions?

![screen shot 2017-11-23 at 13 36 33](https://user-images.githubusercontent.com/3764367/33175386-910d8a06-d053-11e7-8f7a-0dcc23573832.png)
  Thanks for letting us know. Currently we are suggesting to follow this guide: http://frescolib.org/docs/shipping.html#proguard, which require including fresco proguard configuration. 
We are thinking to automate this in future.  Please look at this response on the similar issue: https://github.com/facebook/fresco/issues/1088#issuecomment-203730626  Hi @hexiangyuan, please follow our guidelines on how to create an issue for Fresco (fill the template provided when you click on "new issue"). Your particular question is more like a discussion and I would suggest to raise question on StackOverflow (http://stackoverflow.com/questions/tagged/fresco).

Such huge images should be resized before drawing. Best way is resize images on server if you have such and option. If you load images from some places out of your control, take a look on http://frescolib.org/docs/resizing.html to learn how to specify resizing options for your requests.  Thank you for PR, code looks nice!
Tests been failing due to the master been broken. Master is fixed now, can you please rebase PR to the master and resubmit it. Thank you. [@w0yne](https://github.com/w0yne) has updated the pull request. Thank you!  Thanks for reporting and PR. Will close this one once PR is imported.  Please fill out the issue template or provide more details. I have no idea what your question or issue is.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%231966). Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Thanks for the pull request! I'll take a look when I have some time.

The CI failure looks unrelated, I'll check that as well. Thanks, your change will be included in the next release.  I suppose you do not have access rights to the file or your path is wrong. See also #1858 and related issues for correct file paths.  Thanks for reporting this issue. This is a problem for big images and GIFs and more details including a workaround can be found in #1468.  Please fill out the template. There is an "edit post icon" at the top right of the post.

Does this happen when you are displaying animated GIFs / WebPs? How are you using Fresco? In that case, this looks like a duplicate of #1950. Please check the discussion there.  Thanks. It would be great to look a bit more into this and see if there is something we need to do on the Fresco side. I'll keep this open in case somebody wants to do that. Pull requests are always welcome :) Thanks @hanhailong, yes that should definitely be changed. I'll go ahead and close this issue. If there's anything on the Fresco side, let us know and we can revisit.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%231959). Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! @efrohnhoefer I expect that we have a release soon (within the next 10 days). And thanks again for contributing!  Thanks for the suggestion @efrohnhoefer, we should fix that. Please feel invited to create a pull-request if you want to contribute to Fresco :)  @artyomdangizyan can you provide us with the image that fails here? Ideally, you can make it reproduce in the `samples:showcase` app that you can find in our repro I'm closing this issue due to inactivity. If this is still a problem, let us know!  Hello, @ajaystha005, can you turn on logging on Fresco and find out what particular image crashes?
Please follow this instructions: http://frescolib.org/docs/troubleshooting.html#examining-logcat I'm closing this issue due to inactivity. If this is still a problem, let us know!  Can reproduce using the URI override in the sample app and then going to the WebP fragment: https://github.com/KeepLearningKeepGoing/LearningNotes/blob/master/10002802_broken.webp?raw=true

```
11-01 14:19:03.530  1281  1281 F DEBUG   : Build fingerprint: 'Android/sdk_google_phone_x86/generic_x86:6.0/MASTER/4174734:userdebug/test-keys'
11-01 14:19:03.530  1281  1281 F DEBUG   : Revision: '0'
11-01 14:19:03.530  1281  1281 F DEBUG   : ABI: 'x86'
11-01 14:19:03.530  1281  1281 F DEBUG   : pid: 3229, tid: 3229, name: amples.showcase  >>> com.facebook.fresco.samples.showcase <<<
11-01 14:19:03.530  1281  1281 F DEBUG   : signal 6 (SIGABRT), code -6 (SI_TKILL), fault addr --------
11-01 14:19:03.533  1281  1281 F DEBUG   : Abort message: 'art/runtime/java_vm_ext.cc:410] JNI DETECTED ERROR IN APPLICATION: JNI MonitorEnter called with pending exception java.lang.IllegalStateException: Failed to decode frame'
11-01 14:19:03.533  1281  1281 F DEBUG   :     eax 00000000  ebx 00000c9d  ecx 00000c9d  edx 00000006
11-01 14:19:03.533  1281  1281 F DEBUG   :     esi b7754c50  edi 0000000b
11-01 14:19:03.533  1281  1281 F DEBUG   :     xcs 00000073  xds 0000007b  xes 0000007b  xfs 00000007  xss 0000007b
11-01 14:19:03.533  1281  1281 F DEBUG   :     eip b731d656  ebp 00000c9d  esp bfe4ca30  flags 00200202
11-01 14:19:03.537  1281  1281 F DEBUG   :
11-01 14:19:03.537  1281  1281 F DEBUG   : backtrace:
11-01 14:19:03.537  1281  1281 F DEBUG   :     #00 pc 00083656  /system/lib/libc.so (tgkill+22)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #01 pc 000815f8  /system/lib/libc.so (pthread_kill+70)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #02 pc 00027205  /system/lib/libc.so (raise+36)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #03 pc 000209e4  /system/lib/libc.so (abort+80)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #04 pc 005173cb  /system/lib/libart.so (art::Runtime::Abort()+377)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #05 pc 0014d9f3  /system/lib/libart.so (art::LogMessage::~LogMessage()+1343)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #06 pc 003a5252  /system/lib/libart.so (art::JavaVMExt::JniAbort(char const*, char const*)+3842)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #07 pc 003a5eac  /system/lib/libart.so (art::JavaVMExt::JniAbortV(char const*, char const*, char*)+116)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #08 pc 00163a10  /system/lib/libart.so (art::ScopedCheck::AbortF(char const*, ...)+62)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #09 pc 0016d9d2  /system/lib/libart.so (art::ScopedCheck::CheckThread(_JNIEnv*)+1890)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #10 pc 0016e4e1  /system/lib/libart.so (art::ScopedCheck::Check(art::ScopedObjectAccess&, bool, char const*, art::JniValueType*) (.constprop.114)+1489)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #11 pc 00183743  /system/lib/libart.so (art::CheckJNI::MonitorEnter(_JNIEnv*, _jobject*)+601)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #12 pc 0000a76f  /data/app/com.facebook.fresco.samples.showcase-1/lib/x86/libstatic-webp.so
11-01 14:19:03.537  1281  1281 F DEBUG   :     #13 pc 0000ab85  /data/app/com.facebook.fresco.samples.showcase-1/lib/x86/libstatic-webp.so
11-01 14:19:03.537  1281  1281 F DEBUG   :     #14 pc 00d27298  /data/app/com.facebook.fresco.samples.showcase-1/oat/x86/base.odex (offset 0x664000) (void com.facebook.animated.webp.WebPFrame.nativeRenderFrame(int, int, android.graphics.Bitmap)+156)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #15 pc 00d277a0  /data/app/com.facebook.fresco.samples.showcase-1/oat/x86/base.odex (offset 0x664000) (void com.facebook.animated.webp.WebPFrame.renderFrame(int, int, android.graphics.Bitmap)+84)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #16 pc 00d65a54  /data/app/com.facebook.fresco.samples.showcase-1/oat/x86/base.odex (offset 0x664000) (void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageSupportsScaling(android.graphics.Canvas, com.facebook.imagepipeline.animated.base.AnimatedImageFrame)+1064)
11-01 14:19:03.537  1281  1281 F DEBUG   :     #17 pc 00d6694a  /data/app/com.facebook.fresco.samples.showcase-1/oat/x86/base.odex (offset 0x664000) (void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(int, android.graphics.Canvas)+206)
```

@oprisnik is this something that looks familiar to you? We'll most likely need to check for pendingExceptions in libstatic-webp.so I don't think I've seen this before, should we show nothing instead for broken WebPs? At least it should not crash the app. I think the best is to propagate as a imagepipeline failure to the listeners  You can use a controller listener to get the `Animatable` when the final image is loaded, see http://frescolib.org/docs/listening-to-events.html

The animatable is an instance of `AnimatedDrawable2` and you can do:
`animatedDrawable2.getFrameCount()`, `animatedDrawable2.getLoopCount() * animatedDrawable2.getLoopDuration()`. Keep in mind that the loop count can be `AnimationInformation.LOOP_COUNT_INFINITE` for infinite animations.  Hi @mynameispp 

Fresco should work with NestedScrollView. If you have found a bug related to this, then please file an issue describing the problem.  Hi @TickerBomb 

Thanks for submitting the bug report.
Could you please elaborate a bit more on why the content length affects the download speed in this case? In general we recommend that you use OkHttpNetworkFetcher.

Please feel free to submit a pull request if you want to help us improve HttpUrlConnectionNetworkFetcher. Thanks! @TickerBomb, We use OkHttpNetworkFetcher and recommend it to others. If you need another fetcher, please send us pull request with fix for length issue. Closing as there is not much we can do about this at the moment.
In the future we might implement streaming for gifs but that is not prioritized and quite complex.  Hi @wangrunxiang 

1. Does this happen for all webp animations?
2. What is the size of the image?
3. Is this specific to the Meitu M4? @xjy2061 do you mind to create a pull-request for this? Ideally, we want to propagate the error to the listeners such that it does not fail too silently.

@oprisnik can probably help with the surrounding animation classes. Closing as duplicate of #1862 which will be fixed in the next release  Hi @joslte115 

Thanks for the detailed issue. We will try to look into it as soon as possible.  Hi @moehan 

Which NDK version are you using? @moehan have you tried setting the ndk in the `local.properties` file? See the instructions here: https://github.com/facebook/fresco/tree/master/samples I'm closing this issue since it should work when the NDK is set in `local.properties`. If this is still an issue, let us know!  Hi @harry235day 

Do you have an example of the URL that does not load? I would like to try it out. Closing due to inactivity.  Hi @ursusursus 

I'm afraid using a layout listener is the way to go for that case. Either that, or if possible making sure that you already know the dimensions of the image beforehand.  Hi @krottv 

That sounds reasonable. You are more than welcome to implement it in a similar way to how it is handled for the disk cache, and then submit a pull request.  Hi @crazies 

First of all, I would recommend that you update to the latest version of Fresco. v0.12.0 is more than a year old.

If you change the NDK abi filter to include armeabi-v7a. Does that make a difference?  Thanks for the bug report! This is weird. The Drawable.Callback, which is used to trigger invalidations for example when the image has been downloaded / decoded should also work for animated images. 

One problem that I had when implementing DraweeSpans was that without a custom Drawable.Callback, the wrong region might be invalidated. But this should not be the case here. I think it shouldn't since these listeners are not used for invalidating the webp (and normal animated WebPs worked). I didn't have time to look into this yet, but debugging the issue shouldn't be too hard in case somebody wants to dig in and submit a pull request. There is a sample in the Showcase app. As mentioned, this was fixed by @Kazemir  in #1966.   Thanks for reporting this issue. It seems to be related to #1905 where we also have wrong alpha values with overlays. We do not properly propagate these values right now. The images don't load any more, so I'm assuming this is a duplicate of #1905   Please answer the questions from the template. Without those details we cannot suggest a cause.

I'd also like to know if this happens on all images or particular one. Merging with #1862   I have no experience of Crosswalk and would need much more information to understand the problem.

Does the failure happen while building or at runtime?

Can you point to a sample app which demonstrates the problem? I'm closing this issue due to inactivity. If this is still a problem, let us know!  Sounds good. Let us know if you're still experiencing issues.  Merging with #1862   Hi @lemon-zzz, for GIF images we do not support `setDownsampleEnabled()` and `ResizeOption`s. This is because we don't have the primitives for efficient resizing of GIF images.

Hope this information is helpful and answers your question. Otherwise, please feel free to comment here and I'll reopen the issue.  Hi @gongzelong0718, this looks like a problem with the configuration of your system or network.

Can you try the following command from your command line and check if it does work?

```
wget https://github.com/libjpeg-turbo/libjpeg-turbo/archive/1.5.0.tar.gz
``` I assume that the problem has been resolved since this looks like a network issue.   Hi @huanting, can you check if the showcase app from our repository works on that device?

Also, can you post your `build.gradle` file? I suppose the reason for this is that you should use SoLoader instead (just search for related issues).
We're making SoLoader the default with the next version (aef3790d3429833599d8b5529602e2c12f18c8aa), so it should work if you wait for the next release.  Thank you @lvc! This is really interesting and we had a good read :)

For Fresco we have a set of classes/files (e.g. ImageRequest, ImagePipelineConfig) that we consider to form the API of Fresco. Other public classes are only public for internal reasons (splitting up into multiple APKs and similar). Otherwise, we treat them as internal or only for heavy power users.

Is there a way to provide a set of files/classes as a whitelist for this API? @lvc, that makes sense. CC @kirwan and @oprisnik  who have a good understanding on which packages and modules are the most critical for end-users. This is really cool! I think it would make sense to add most modules to this report, except for `fbcore` probably and all of the `-test` ones.

I'll close this issue for now since it's not a bug or feature request, but we can still respond to any questions/comments.  That looks like a progress bar. I don't see anything in your XML that sets that. Do you have something in Java that does? This looks like a known issue with rounded corners with overlay mode BITMAP_ONLY.

Try setting `fresco:roundWithOverlayColor="@color/you_background_color"` instead (it's also a bit more performant)  Hi @wolongalick, 

see https://github.com/facebook/fresco/blob/f2268961dfd7d8be9ea3b3cf1a978c4d7d0aac9a/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/NetworkFetcher.java#L35-L43

It indicates that the implementation does not provide the total data length from the network stream.  Any chance you have a stable version of Android Studio as well? If yes does it repro there as well?

Also, what version of gradle are you using? I can't repro in either AS 2.2.3 or 3.0 Beta 6. The problem might be that you have the "Unnamed" build config selected (what is that?), you should try selecting something like "showcase".

Let us know if this still doesn't work for you, and if so, give us more info on your env: do you use the gradle wrapper or local gradle? What target are you trying to run / build? Looks like the original issue (importing project) has been resolved. If you think the ANR is a Fresco issue, we need more details. Feel free to open a separate GitHub issue.  Hi @kraghu. Do you think you can provide these problematic GIFs, to help us debug? CC @oprisnik  What's the crash that you're seeing?  @hcadoid, I'll close this task since the provided solution most likely fixed the issue and I haven't heard otherwise. Thanks @efrohnhoefer!

If your issue persists, just comment and I'll re-open. @huanting, the log provided suggests that the `DefaultHandler` is used and not the `SoLoader` library.

The newest 1.8.0 release of Fresco comes with SoLoader as default. Can you try if this helps?  cc @oprisnik  How are you using Fresco, how big are the GIFs etc.? The new implementation is way more performant than the old one - the difference is that the new one now loads all GIFs simultaneously whereas the old one wasn't (which was a worse experience). Do you have a comparison between 1.3.0 and 1.5.0?  This is usually due to issues loading the native library and we generally recommend using ReLinker or SoLoader. See the [comment here for steps](https://github.com/facebook/fresco/issues/933#issuecomment-186266187).  The behavior you're seeing sounds correct to me. The server isn't returning any data, so it's impossible to determine the image format, so we throw an exception. IMO a 204 status code *is* an error condition when trying to load an image, so showing the failure / retry images is the correct behavior.

Bubbling up the http response code sounds potentially useful, but I'm not sure about putting it in `EncodedImage`. That type is often used to represent local images as well, e.g. from camera roll or resources.

However, I'm not sure you need the response code to differentiate between 204 and e.g. 404. In the case of 204, the network producer does emit a response, but then the decode fails. When the response is 404, the network producer emits a failure. Perhaps we can leverage that?

Also, your Fresco version is super old :)

CC @oprisnik who knows more about our API architecture. Adding an `ImageEmptyException` sounds too specific. I'd rather add something more generic like an `HttpException` that would also hold the response code (if available). Do you think that would work? Yeah, I would also be inclined to keep this as generic as possible. Would it be an option to catch these in the network layer or somewhere else?

Also, is this something that quite a few people could run into or something that's specific to your setup? To me, it sounds like 204 should not be returned for images in general? Without any Fresco changes, it is also possible to supply a custom `ImageDecoder` to Fresco (can be either a global or per-image override) that should be able to handle empty responses.

I'm not really sure where the best place for these checks would be. I'd have to dig into the current code a bit. We've discussed this a bit with the team. Do you know what the default behavior in a browser / iOS is if you get a 204 image to have a consistent default behavior?

To solve your problem, you can add a custom image format for the 204 image (with a corresponding header checker) and have a custom decoder that creates an empty 1x1px bitmap for these images.
The custom header checker can expect a header length of 1 and check if the length is 0 (i.e. the image is empty), return the custom image format. It might just work if you return an existing image format instead (like JPEG or PNG), not sure what these decoders would do though, so you'd have to check. 
If you want to test this quickly, you can build our showcase sample app and add a custom decoder like this [example for keyframes](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/keyframes/KeyframesDecoderExample.java). You can register them globally when Fresco is initialized. Not sure if that's exposed in React Native though. Awesome. Please let us know if this approach worked or if we still need to change Fresco.  Hi @yline, thanks for the bug report! Can you tell us what device & Android version this happens on specifically? Your usage of Fresco looks ok. Pinning bitmaps only happens on Android 4.4 and below, so I don't understand why we would try to pin on a 6.0 device. What is the value of `Build.VERSION.SDK_INT` on your device? Merging with issue #1862   CC @oprisnik  Thanks for the report, this has been fixed with e7993cc40fd3c0fc0becde2c11039e797813a813

All combinations, including focus crop should now work.  Hello, thank you for the report! What device / emulator and Android version does this happen on? Also, can you repro with the latest version of Fresco?

CC @lambdapioneer for native magic. Hi @newjorchen, thanks for raising the bug and thanks for having a detailed look already.

Does this bug only show on x86? Does it also crash on other x86 devices? Does that image also crash when you display it in the showcase app?

My guess is that it might be specific to a certain webp image. Can you share a crashing image with us? Closing due to lack of information to proceed with an investigation.  Please take a look at our scale type example in the Showcase app.
You can set a URI override in the setting and everything works fine for me if I use a GIF.

See https://github.com/facebook/fresco/blob/4b54d54688565e57d7b290b214a7db38f74dec74/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeScaleTypeFragment.java  It looks like we did not update the comparison app in quite some time. If you want, feel free to submit a pull request to fix these issues.  @voiddog The attached image is more than 23000 pixels wide. As a workaround I would suggest reducing the size to something more manageable.  @adamc01 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1902/files/1f5f4b993ce7323ca774105315740b44b24e7ed8..80281f95e901edc4c5114fdbb4d905e00b665248) @erikandre has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5861554). Thanks for the PR, it will be included in our next release :)  Hi @TinoGuo 

Could you please provide some example code showing what you are doing? Thanks @TinoGuo. Yeah, I think we should calculate dropped frames differently. Currently, they are only logged when drawing fails - not if you completely skip some frames. I'll se if there's an easy fix.

I'll also check the repeat call.

For the frame count not being continuous: This is by design. This can happen if there is not enough time to render the frame. Internally, we keep track of the animation start time and the current animation time and compute the frame to render based on that. If the UI stalls for whatever reason, you might skip frames if the next draw call is invoked too late.
It is possible to write a custom `FrameScheduler` that delays frames instead of dropping them, something analogous to [`DropFramesFrameScheduler`](https://github.com/facebook/fresco/blob/17daedffe320d1b5660c36038801051e04700c2b/animated-drawable/src/main/java/com/facebook/fresco/animation/frame/DropFramesFrameScheduler.java) I think this should have been fixed with 03a14ab06a9282ce098420217a9ca27a6ae6d587  Hi @ClaudeHangui 

Could you please also include the stack trace of the exception?
Are you calling Fresco.initialize() from the onCreate() of the activity or Application? I'm closing this issue due to inactivity. If this is still a problem, let us know!  Hi @adamc01 

Good idea! Please feel free to contribute an implementation of this.
A good place to start would be in:

- drawee/src/main/res/values/attrs.xml
- drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchyInflater.java
  Hi @rhettor,

If you just want to display a Bitmap then using an ImageView might be easier.
Is there a particular reason why you want to use DraweeView? OK, thanks for the explanation @rhettor 

Since DraweeView is not very well suited for that use case you might want to try a workaround using 2 views:

1st view is a SimpleDraweeView that you use to load and display online/local photo
2nd view is an ImageView that you use to display the modified Bitmap

Once the user changes the brightness you could switched between view 1 & 2   Hi @wangfaxi1985, when you say image size, is that width * height?
Do you get the same problem for an image with less long aspect ratio?
It would also be helpful if you could share the problematic image with us. Thanks! @wangfaxi1985 Depending on the device you are running this on, there are limits to how large a bitmap can be. On older devices it is 2048x2048 and on newer devices it will be bigger than that.

As a workaround, could you try disabling hardware acceleration for the view?

`view.setLayerType(View.LAYER_TYPE_SOFTWARE, null)` @wangfaxi1985 - the next release of Fresco should contain support for region decoding of images. That would allow you to only load a part of the image. That does not really solve the problem, but if support for this was added to PhotoDraweeView then you could have a smaller version when zoomed out, and then load a higher resolution version when zooming in. A really basic example for this is now available in the Showcase app, see baa629d

Keep in mind that this only works for JPEGs right now and that this still needs some work if the image is resized / downsampled since the BitmapFactory.Options#inSampleSize value is not correctly handled.

I'm closing this issue for now. Please let us know if this is still an issue.  The reference returned by `cache()` is not the same reference that's held within the cache itself.

When the entry is stored in the map, a [new reference is cloned and held only within the cache](https://github.com/facebook/fresco/blob/master/imagepipeline-base/src/main/java/com/facebook/imagepipeline/cache/CountingMemoryCache.java#L83).

All references returned from public methods should be closed when no longer needed. This is specified in the Javadocs for the `cache()` method which states "It is the caller's responsibility to close the returned reference once not needed anymore." Do you provide your own `MemoryCacheParams` when building your config? If not, the `DefaultEncodedMemoryCacheParamsSupplier` should set the cache size to between 1-4MB depending on the device's memory.

Unless a trim event is triggered due to lack of memory the cache should stay around that size. I'm closing this issue due to inactivity. If this is still a problem, let us know!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%231894). Thanks!  Hey @demonbibi, these kind of regressions can be caused by very verbose logs (like we set them by default in the showcase app). Try to set `FLog.setMinimumLoggingLevel(FLog.ERROR);`

On my emulator with `VERBOSE` (default):

![screen shot 2017-09-06 at 11 42 20 am](https://user-images.githubusercontent.com/908387/30108043-a302630a-92f8-11e7-8a02-8a0b3e15db88.png)

On my emulator with `ERROR`:

![screen shot 2017-09-06 at 11 42 51 am](https://user-images.githubusercontent.com/908387/30108060-ae626e5c-92f8-11e7-8d05-8b6bb593559e.png)

Let me know if this solves the issue for you.

CC @oprisnik (do we maybe to change the default log level?) Just verified as well that turning off logging in the RecyclerView sample in our Showcase app greatly improves dropped frames. Closing the issue now.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at [cla@fb.com](mailto:cla@fb.com?subject=CLA%20for%20facebook%2Ffresco%20%231892). Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Good catch and thanks for writing this pull-request! I'll land it now @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5774676).  Hey @younas-bangash, have a look at http://frescolib.org/docs/scaletypes.html on how to use scale types. Let me know if this does not solve the problem for you or I've misunderstood the question. I'd be inclined to say that this is likely caused by the layout that includes the `SimpleDraweeView`. We can confirm that the following way: enable the controller overlay in the Fresco configuration (see below) and post the screenshot. Ideally, you also enable the layout bounds in the developer settings. CC @oprisnik 

It shows two lines which are `I: wxh` (the image dimensions) and `D: wxh` (the drawable dimensions). The layout cause is confirmed then the image dimensions match the original image (at least in terms of aspects ratio), but the drawable ones do not.

Where you initialize Fresco add the following:

```java
ImagePipelineConfig imagePipelineConfig = ... // you should already have this

DraweeConfig.Builder draweeConfigBuilder = DraweeConfig.newBuilder();
draweeConfigBuilder.setDebugOverlayEnabledSupplier(
        Suppliers.of(true));

Fresco.initialize(this, imagePipelineConfig, draweeConfigBuilder.build()); // you should already have a similar call. replace it with this
```

Alternatively, if you find a way to reproduce it in the showcase app that is in this repo, we can work from there. Sorry that I couldn't help you with the information provided. I'll close this issue then.  Hey @ar-g this looks like a double-free or a bad-reference-free. From the logcat I cannot narrow this down to Fresco. Do you have more details such as:

 - Does it only reproduce when using Fresco?
 - Can you provide a full log?
 - What's the device model?
 - How can we reproduce this error? @ar-g with "double free" I mean a bug that might be in native code where free is called twice (or on something un-allocated).

Thanks for giving the detailed information. I cannot spot any reference to Fresco in the logs. Why do you think it is related to Fresco?

Moreover, there stack trace covers reference queue and `java.math.Native`. Do you use `BigInteger` or similar in your code (or does any other library?). I know that `BigInteger` makes use of the `ReferenceQueue` to manage its native counter parts. In that case stack-overflow or reporting a bug for Android might be more appropriate. Since none of the traces point to Fresco, it's hard to say what's going on without additional information, so I'm closing this for now. If this is still an issue, let us know.  Hey @ar-g, that's very interesting. It might be that some compiler/linker defaults changed.

Can you provide me with the device that you've been using and the logcat from the crashes? Is there a way to reproduce this errors with the sample app?  What response code do you send in that case? Still 200?

If you're using OkHttp as your network layer, you'd need to check that it works as you expect with that header.

I don't see anything in Universal Image Loader which makes a specific check for that header either. I'm closing this issue due to inactivity. If this is still a problem, let us know!  Thanks @zxz1990 for the issue. Can you provide us with the device details? From a first look this looks like it might be an issue with ashmem. This mostly only has information about the `Rockchip RK3188` which is built into a variety of devices. Can you post the full `getprop` output as an attachment? Also, is this the device a set-top box or a tablet? Hm, there's not much chance that I'll be able to reproduce this. Maybe when you can give me the unobfuscated stack trace, I might be able to point in some general direction. Otherwise, it would be on you to debug on the device (most likely the easiest is using logging calls in the C++ code).

You can try to change the code in `ImagePipelineFactor#buildPlatformDecoder` to always return the `ArtDecoder`. With that you should be able to exclude ashmem issues. If it indeed fixes your issue, we can talk about adding an option to disable ashmem as a configuration parameter.

CC @kirwan  Great to see that you've resolved the issue.  Very sorry but we only can only help with issues in English.

å¾ˆæŠ±æ­‰ï¼Œæˆ‘ä»¬åªèƒ½å¸®åŠ©è‹±æ–‡é—®é¢˜ã€‚
(Google Translate)  Looks like there is not any information on this bug report. @lemon-zzz please fill in bug report. For now, closing this issue  Writing files to disk is handled in a separate thread so it's quite possible for an image request to complete but the file not yet be available from the cache.

My guess is you're just being luckier in the race on your emulator than your device.

Instead of querying cache directly, I'd recommend requesting the encoded image from the pipeline. See the [To get encoded imageâ€¦](http://frescolib.org/docs/datasources-datasubscribers.html#to-get-encoded-image) section in the docs. Request that with the original image request and the multiplexing within Fresco will ensure only one network request is used.  I think you should raise this issue in the React Native project.

Fresco is only used by RN on Android but I'm not sure whether you're seeing this on both platforms.

I'd also suggest linking to the previous bug report. Please raise this issue with React Native! Thanks!  Please provide details of the device and Android version.

Are you using OkHttp or another network layer?

If it is OkHttp, I suggest [turning on logging](https://github.com/square/okhttp/tree/master/okhttp-logging-interceptor) there so you can see what activity there is within that.
Then please reply here with details of what you're seeing.
 Closing due to inactivity. If this is still an issue, please let us know.  This issue reproduces with this particular image. Other images work fine. @Vixb1122, your image is a gif (despite of jpeg extension), once you added support for animated-gif, library started to treat any gif as animated image. And library does not currently support rounding of animated images. I'd recommend to use png for such images, they will take less space and provide better quality.
Or if you don't have control of where images comes from, you can request image with image request and specify imageDecodeOptions.forceStaticImage = true.
```
        ImageRequest request = ImageRequestBuilder.newBuilderWithSource(Uri.parse("http://p1.music.126.net/n4ypQKBBkp4NMdMb2Bxr6Q==/2042892604407899.jpg"))
                .setImageDecodeOptions(new ImageDecodeOptionsBuilder()
                        .setForceStaticImage(true)
                        .build())
                .build();

        DraweeController controller = Fresco.getDraweeControllerBuilderSupplier().get()
                .setImageRequest(request)
                .build();
        draweeView.setController(controller);
``` I hope, @Vixb1122, this answer is enough. If you still having issue, feel free to reopen this bug.  @dmitry-voronkevich has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5679390). Thanks for the PR!  Hi, @wangbin0802, please provide more details:
* How do you use Fresco?
* Do you have sample images?
* Is there sample app where this issue can be reproduced?
* Where and how do you show images (ListView, RecycleView, anything else)?
* How many images do you show at the same time? 
* Do you store DraweeView's anywhere in the memory, like caching them in HashMap for example? 
* Are DraweeView attached/detached correctly? Hi @wangbin0802,

This issue maybe related to change in 1.4.0. Fresco animated images stared to respect caching rules, in 1.3.0 they were ignoring such rules sometimes.
Currently number of images are limited via constant in Fresco code:  https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/BitmapCounterProvider.java#L24

Feel free to sent us a pull request with changes which will allow configuration of this constant when app is initialized. Duplicating to #1980  ### Description

Test Gif:
https://beauty.nosdn.127.net/beauty/img/5fcca295-c5b9-4b91-8413-353db505ddd3.gif?imageView&thumbnail=960x0&tostatic=0

### Additional Information

* Fresco version: 1.4.0, 1.5.0
* Platform version:  Device: Nexus 6P(Android 7.1.2)
 Hi, @Thiross, can you please specify following details, which can help us to identify issue:
* stack trace of a crash
* how do you request image (how does you image request look like)?
* Please include the code where you initiate your ImagePipelineConfig Hi, @dmitry-voronkevich 
### Initialize
``` Java
// in Application class.
@Override
public void onCreate() {
    super.onCreate();
    Fresco.initialize(this);
}
```
### Request
``` java
SimpleDraweeView image = (SimpleDraweeView) findViewById(R.id.image);
image.setImageURI("https://beauty.nosdn.127.net/beauty/img/5fcca295-c5b9-4b91-8413-353db505ddd3.gif?imageView&thumbnail=960x0&tostatic=0");
```
### backtrace

> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470] JNI DETECTED ERROR IN APPLICATION: JNI MonitorEnter called with pending exception java.lang.IllegalStateException: Width or height is too small
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.animated.gif.GifFrame.nativeRenderFrame(int, int, android.graphics.Bitmap) (GifFrame.java:-2)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.animated.gif.GifFrame.renderFrame(int, int, android.graphics.Bitmap) (GifFrame.java:50)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageDoesNotSupportScaling(android.graphics.Canvas, com.facebook.imagepipeline.animated.base.AnimatedImageFrame) (AnimatedDrawableBackendImpl.java:221)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(int, android.graphics.Canvas) (AnimatedDrawableBackendImpl.java:179)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.imagepipeline.animated.impl.AnimatedImageCompositor.renderFrame(int, android.graphics.Bitmap) (AnimatedImageCompositor.java:120)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.wrapper.AnimatedDrawableBackendFrameRenderer.renderFrame(int, android.graphics.Bitmap) (AnimatedDrawableBackendFrameRenderer.java:74)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.renderFrameInBitmap(int, com.facebook.common.references.CloseableReference) (BitmapAnimationBackend.java:305)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:209)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:229)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:229)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (BitmapAnimationBackend.java:164)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.backend.AnimationBackendDelegate.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (AnimationBackendDelegate.java:61)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at boolean com.facebook.fresco.animation.backend.AnimationBackendDelegateWithInactivityCheck.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (AnimationBackendDelegateWithInactivityCheck.java:111)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.fresco.animation.drawable.AnimatedDrawable2.draw(android.graphics.Canvas) (AnimatedDrawable2.java:204)
> 08-22 14:05:01.306 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.ScaleTypeDrawable.draw(android.graphics.Canvas) (ScaleTypeDrawable.java:125)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.FadeDrawable.drawDrawableWithAlpha(android.graphics.Canvas, android.graphics.drawable.Drawable, int) (FadeDrawable.java:304)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.FadeDrawable.draw(android.graphics.Canvas) (FadeDrawable.java:291)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.facebook.drawee.generic.RootDrawable.draw(android.graphics.Canvas) (RootDrawable.java:83)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.widget.ImageView.onDraw(android.graphics.Canvas) (ImageView.java:1268)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.View.draw(android.graphics.Canvas) (View.java:17077)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16059)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ThreadedRenderer.updateViewTreeDisplayList(android.view.View) (ThreadedRenderer.java:656)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ThreadedRenderer.updateRootDisplayList(android.view.View, android.view.ThreadedRenderer$HardwareDrawCallbacks) (ThreadedRenderer.java:662)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ThreadedRenderer.draw(android.view.View, android.view.View$AttachInfo, android.view.ThreadedRenderer$HardwareDrawCallbacks) (ThreadedRenderer.java:770)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewRootImpl.draw(boolean) (ViewRootImpl.java:2841)
> 08-22 14:05:01.307 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewRootImpl.performDraw() (ViewRootImpl.java:2649)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewRootImpl.performTraversals() (ViewRootImpl.java:2256)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewRootImpl.doTraversal() (ViewRootImpl.java:1291)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.ViewRootImpl$TraversalRunnable.run() (ViewRootImpl.java:6362)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.Choreographer$CallbackRecord.run(long) (Choreographer.java:873)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.Choreographer.doCallbacks(int, long) (Choreographer.java:685)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.Choreographer.doFrame(long, int) (Choreographer.java:621)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.view.Choreographer$FrameDisplayEventReceiver.run() (Choreographer.java:859)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.os.Handler.handleCallback(android.os.Message) (Handler.java:751)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.os.Handler.dispatchMessage(android.os.Message) (Handler.java:95)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.os.Looper.loop() (Looper.java:154)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void android.app.ActivityThread.main(java.lang.String[]) (ActivityThread.java:6114)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at java.lang.Object java.lang.reflect.Method.invoke!(java.lang.Object, java.lang.Object[]) (Method.java:-2)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run() (ZygoteInit.java:874)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at void com.android.internal.os.ZygoteInit.main(java.lang.String[]) (ZygoteInit.java:764)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470] 
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]     in call to MonitorEnter
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]     from void com.facebook.animated.gif.GifFrame.nativeRenderFrame(int, int, android.graphics.Bitmap)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470] "main" prio=5 tid=1 Runnable
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   | group="main" sCount=0 dsCount=0 obj=0x75a41000 self=0x7f74e95a00
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   | sysTid=18854 nice=-1 cgrp=default sched=0/0 handle=0x7f78d63a98
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   | state=R schedstat=( 179437190 16768597 167 ) utm=11 stm=6 core=0 HZ=100
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   | stack=0x7fececf000-0x7feced1000 stackSize=8MB
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   | held mutexes= "mutator lock"(shared held)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #00 pc 00000000004764e0  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+220)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #01 pc 00000000004764dc  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+216)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #02 pc 000000000044ad28  /system/lib64/libart.so (_ZNK3art6Thread9DumpStackERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEEbP12BacktraceMap+472)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #03 pc 00000000002ec174  /system/lib64/libart.so (_ZN3art9JavaVMExt8JniAbortEPKcS2_+1128)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #04 pc 00000000002ec85c  /system/lib64/libart.so (_ZN3art9JavaVMExt9JniAbortVEPKcS2_St9__va_list+120)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #05 pc 0000000000101780  /system/lib64/libart.so (_ZN3art11ScopedCheck6AbortFEPKcz+156)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #06 pc 0000000000101190  /system/lib64/libart.so (_ZN3art11ScopedCheck11CheckThreadEP7_JNIEnv+544)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #07 pc 00000000000fecc8  /system/lib64/libart.so (_ZN3art11ScopedCheck5CheckERNS_18ScopedObjectAccessEbPKcPNS_12JniValueTypeE+1120)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #08 pc 00000000000fbd4c  /system/lib64/libart.so (_ZN3art8CheckJNI12MonitorEnterEP7_JNIEnvP8_jobject+620)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #09 pc 00000000000065c4  /data/app/com.example.frescogifcrash-2/lib/arm64/libgifimage.so (???)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   native: #10 pc 0000000000048b8c  /data/app/com.example.frescogifcrash-2/oat/arm64/base.odex (Java_com_facebook_animated_gif_GifFrame_nativeRenderFrame__IILandroid_graphics_Bitmap_2+168)
> 08-22 14:05:01.308 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.animated.gif.GifFrame.nativeRenderFrame(Native method)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.animated.gif.GifFrame.renderFrame(GifFrame.java:50)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageDoesNotSupportScaling(AnimatedDrawableBackendImpl.java:221)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   - locked <0x0717c29b> (a com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(AnimatedDrawableBackendImpl.java:179)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.imagepipeline.animated.impl.AnimatedImageCompositor.renderFrame(AnimatedImageCompositor.java:120)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.wrapper.AnimatedDrawableBackendFrameRenderer.renderFrame(AnimatedDrawableBackendFrameRenderer.java:74)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.renderFrameInBitmap(BitmapAnimationBackend.java:305)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:209)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrame(BitmapAnimationBackend.java:164)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.backend.AnimationBackendDelegate.drawFrame(AnimationBackendDelegate.java:61)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.backend.AnimationBackendDelegateWithInactivityCheck.drawFrame(AnimationBackendDelegateWithInactivityCheck.java:111)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.fresco.animation.drawable.AnimatedDrawable2.draw(AnimatedDrawable2.java:204)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.ScaleTypeDrawable.draw(ScaleTypeDrawable.java:125)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.FadeDrawable.drawDrawableWithAlpha(FadeDrawable.java:304)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.FadeDrawable.draw(FadeDrawable.java:291)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.facebook.drawee.generic.RootDrawable.draw(RootDrawable.java:83)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.widget.ImageView.onDraw(ImageView.java:1268)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.draw(View.java:17077)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16059)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.309 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ThreadedRenderer.updateViewTreeDisplayList(ThreadedRenderer.java:656)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ThreadedRenderer.updateRootDisplayList(ThreadedRenderer.java:662)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ThreadedRenderer.draw(ThreadedRenderer.java:770)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewRootImpl.draw(ViewRootImpl.java:2841)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewRootImpl.performDraw(ViewRootImpl.java:2649)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2256)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1291)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6362)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.Choreographer$CallbackRecord.run(Choreographer.java:873)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.Choreographer.doCallbacks(Choreographer.java:685)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.Choreographer.doFrame(Choreographer.java:621)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:859)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.os.Handler.handleCallback(Handler.java:751)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.os.Handler.dispatchMessage(Handler.java:95)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.os.Looper.loop(Looper.java:154)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at android.app.ActivityThread.main(ActivityThread.java:6114)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at java.lang.reflect.Method.invoke!(Native method)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:874)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:764)
> 08-22 14:05:01.310 18854-18854/com.example.frescogifcrash A/art: art/runtime/java_vm_ext.cc:470] 
> 08-22 14:05:01.352 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] Runtime aborting...
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] Aborting thread:
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "main" prio=6 tid=1 Native
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=0 dsCount=0 obj=0x75a41000 self=0x7f74e95a00
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18854 nice=-1 cgrp=default sched=0/0 handle=0x7f78d63a98
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=R schedstat=( 194945834 16889795 174 ) utm=12 stm=7 core=3 HZ=100
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7fececf000-0x7feced1000 stackSize=8MB
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes= "abort lock"
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 00000000004764e0  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+220)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000004764dc  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+216)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000044ad28  /system/lib64/libart.so (_ZNK3art6Thread9DumpStackERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEEbP12BacktraceMap+472)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000438f0c  /system/lib64/libart.so (_ZNK3art10AbortState10DumpThreadERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEEPNS_6ThreadE+56)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 0000000000438d88  /system/lib64/libart.so (_ZNK3art10AbortState4DumpERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEE+668)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 000000000042c9fc  /system/lib64/libart.so (_ZN3art7Runtime5AbortEv+140)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 00000000000e4b24  /system/lib64/libart.so (_ZN3art10LogMessageD2Ev+1204)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #07 pc 00000000002ec588  /system/lib64/libart.so (_ZN3art9JavaVMExt8JniAbortEPKcS2_+2172)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #08 pc 00000000002ec85c  /system/lib64/libart.so (_ZN3art9JavaVMExt9JniAbortVEPKcS2_St9__va_list+120)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #09 pc 0000000000101780  /system/lib64/libart.so (_ZN3art11ScopedCheck6AbortFEPKcz+156)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #10 pc 0000000000101190  /system/lib64/libart.so (_ZN3art11ScopedCheck11CheckThreadEP7_JNIEnv+544)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #11 pc 00000000000fecc8  /system/lib64/libart.so (_ZN3art11ScopedCheck5CheckERNS_18ScopedObjectAccessEbPKcPNS_12JniValueTypeE+1120)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #12 pc 00000000000fbd4c  /system/lib64/libart.so (_ZN3art8CheckJNI12MonitorEnterEP7_JNIEnvP8_jobject+620)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #13 pc 00000000000065c4  /data/app/com.example.frescogifcrash-2/lib/arm64/libgifimage.so (???)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #14 pc 0000000000048b8c  /data/app/com.example.frescogifcrash-2/oat/arm64/base.odex (???)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.animated.gif.GifFrame.nativeRenderFrame(Native method)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.animated.gif.GifFrame.renderFrame(GifFrame.java:50)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageDoesNotSupportScaling(AnimatedDrawableBackendImpl.java:221)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x0717c29b> (a com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl)
> 08-22 14:05:01.353 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(AnimatedDrawableBackendImpl.java:179)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedImageCompositor.renderFrame(AnimatedImageCompositor.java:120)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.wrapper.AnimatedDrawableBackendFrameRenderer.renderFrame(AnimatedDrawableBackendFrameRenderer.java:74)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.renderFrameInBitmap(BitmapAnimationBackend.java:305)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:209)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrame(BitmapAnimationBackend.java:164)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.backend.AnimationBackendDelegate.drawFrame(AnimationBackendDelegate.java:61)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.backend.AnimationBackendDelegateWithInactivityCheck.drawFrame(AnimationBackendDelegateWithInactivityCheck.java:111)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.drawable.AnimatedDrawable2.draw(AnimatedDrawable2.java:204)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ScaleTypeDrawable.draw(ScaleTypeDrawable.java:125)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.FadeDrawable.drawDrawableWithAlpha(FadeDrawable.java:304)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.FadeDrawable.draw(FadeDrawable.java:291)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.generic.RootDrawable.draw(RootDrawable.java:83)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.widget.ImageView.onDraw(ImageView.java:1268)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.draw(View.java:17077)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16059)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.354 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.updateViewTreeDisplayList(ThreadedRenderer.java:656)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.updateRootDisplayList(ThreadedRenderer.java:662)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.draw(ThreadedRenderer.java:770)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.draw(ViewRootImpl.java:2841)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.performDraw(ViewRootImpl.java:2649)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2256)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1291)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6362)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer$CallbackRecord.run(Choreographer.java:873)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer.doCallbacks(Choreographer.java:685)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer.doFrame(Choreographer.java:621)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:859)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Handler.handleCallback(Handler.java:751)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Handler.dispatchMessage(Handler.java:95)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Looper.loop(Looper.java:154)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.app.ActivityThread.main(ActivityThread.java:6114)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.reflect.Method.invoke!(Native method)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:874)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:764)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] Pending exception java.lang.IllegalStateException: Width or height is too small
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.animated.gif.GifFrame.nativeRenderFrame(int, int, android.graphics.Bitmap) (GifFrame.java:-2)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.animated.gif.GifFrame.renderFrame(int, int, android.graphics.Bitmap) (GifFrame.java:50)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageDoesNotSupportScaling(android.graphics.Canvas, com.facebook.imagepipeline.animated.base.AnimatedImageFrame) (AnimatedDrawableBackendImpl.java:221)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(int, android.graphics.Canvas) (AnimatedDrawableBackendImpl.java:179)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.imagepipeline.animated.impl.AnimatedImageCompositor.renderFrame(int, android.graphics.Bitmap) (AnimatedImageCompositor.java:120)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.wrapper.AnimatedDrawableBackendFrameRenderer.renderFrame(int, android.graphics.Bitmap) (AnimatedDrawableBackendFrameRenderer.java:74)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.renderFrameInBitmap(int, com.facebook.common.references.CloseableReference) (BitmapAnimationBackend.java:305)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:209)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:229)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(android.graphics.Canvas, int, int) (BitmapAnimationBackend.java:229)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (BitmapAnimationBackend.java:164)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.backend.AnimationBackendDelegate.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (AnimationBackendDelegate.java:61)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at boolean com.facebook.fresco.animation.backend.AnimationBackendDelegateWithInactivityCheck.drawFrame(android.graphics.drawable.Drawable, android.graphics.Canvas, int) (AnimationBackendDelegateWithInactivityCheck.java:111)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.fresco.animation.drawable.AnimatedDrawable2.draw(android.graphics.Canvas) (AnimatedDrawable2.java:204)
> 08-22 14:05:01.355 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.ScaleTypeDrawable.draw(android.graphics.Canvas) (ScaleTypeDrawable.java:125)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.FadeDrawable.drawDrawableWithAlpha(android.graphics.Canvas, android.graphics.drawable.Drawable, int) (FadeDrawable.java:304)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.FadeDrawable.draw(android.graphics.Canvas) (FadeDrawable.java:291)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.drawable.ForwardingDrawable.draw(android.graphics.Canvas) (ForwardingDrawable.java:147)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.facebook.drawee.generic.RootDrawable.draw(android.graphics.Canvas) (RootDrawable.java:83)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.widget.ImageView.onDraw(android.graphics.Canvas) (ImageView.java:1268)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.View.draw(android.graphics.Canvas) (View.java:17077)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16059)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.recreateChildDisplayList(android.view.View) (ViewGroup.java:3748)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewGroup.dispatchGetDisplayList() (ViewGroup.java:3728)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.RenderNode android.view.View.updateDisplayListIfDirty() (View.java:16022)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ThreadedRenderer.updateViewTreeDisplayList(android.view.View) (ThreadedRenderer.java:656)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ThreadedRenderer.updateRootDisplayList(android.view.View, android.view.ThreadedRenderer$HardwareDrawCallbacks) (ThreadedRenderer.java:662)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ThreadedRenderer.draw(android.view.View, android.view.View$AttachInfo, android.view.ThreadedRenderer$HardwareDrawCallbacks) (ThreadedRenderer.java:770)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewRootImpl.draw(boolean) (ViewRootImpl.java:2841)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewRootImpl.performDraw() (ViewRootImpl.java:2649)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewRootImpl.performTraversals() (ViewRootImpl.java:2256)
> 08-22 14:05:01.356 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewRootImpl.doTraversal() (ViewRootImpl.java:1291)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.ViewRootImpl$TraversalRunnable.run() (ViewRootImpl.java:6362)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.Choreographer$CallbackRecord.run(long) (Choreographer.java:873)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.Choreographer.doCallbacks(int, long) (Choreographer.java:685)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.Choreographer.doFrame(long, int) (Choreographer.java:621)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.view.Choreographer$FrameDisplayEventReceiver.run() (Choreographer.java:859)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.os.Handler.handleCallback(android.os.Message) (Handler.java:751)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.os.Handler.dispatchMessage(android.os.Message) (Handler.java:95)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.os.Looper.loop() (Looper.java:154)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void android.app.ActivityThread.main(java.lang.String[]) (ActivityThread.java:6114)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object java.lang.reflect.Method.invoke!(java.lang.Object, java.lang.Object[]) (Method.java:-2)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run() (ZygoteInit.java:874)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at void com.android.internal.os.ZygoteInit.main(java.lang.String[]) (ZygoteInit.java:764)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] Dumping all threads without appropriate locks held: thread list lock mutator lock
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] All threads:
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] DALVIK THREADS (16):
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "main" prio=6 tid=1 Runnable
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=0 dsCount=0 obj=0x75a41000 self=0x7f74e95a00
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18854 nice=-1 cgrp=default sched=0/0 handle=0x7f78d63a98
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=R schedstat=( 214534688 16936201 176 ) utm=12 stm=9 core=3 HZ=100
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7fececf000-0x7feced1000 stackSize=8MB
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes= "abort lock" "mutator lock"(shared held)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 00000000004764e0  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+220)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000004764dc  /system/lib64/libart.so (_ZN3art15DumpNativeStackERNSt3__113basic_ostreamIcNS0_11char_traitsIcEEEEiP12BacktraceMapPKcPNS_9ArtMethodEPv+216)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000044ad28  /system/lib64/libart.so (_ZNK3art6Thread9DumpStackERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEEbP12BacktraceMap+472)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000462448  /system/lib64/libart.so (_ZN3art14DumpCheckpoint3RunEPNS_6ThreadE+820)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 000000000045a728  /system/lib64/libart.so (_ZN3art10ThreadList13RunCheckpointEPNS_7ClosureE+456)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 000000000045a338  /system/lib64/libart.so (_ZN3art10ThreadList4DumpERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEEb+288)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 0000000000438d3c  /system/lib64/libart.so (_ZNK3art10AbortState4DumpERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEE+592)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #07 pc 000000000042c9fc  /system/lib64/libart.so (_ZN3art7Runtime5AbortEv+140)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #08 pc 00000000000e4b24  /system/lib64/libart.so (_ZN3art10LogMessageD2Ev+1204)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #09 pc 00000000002ec588  /system/lib64/libart.so (_ZN3art9JavaVMExt8JniAbortEPKcS2_+2172)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #10 pc 00000000002ec85c  /system/lib64/libart.so (_ZN3art9JavaVMExt9JniAbortVEPKcS2_St9__va_list+120)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #11 pc 0000000000101780  /system/lib64/libart.so (_ZN3art11ScopedCheck6AbortFEPKcz+156)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #12 pc 0000000000101190  /system/lib64/libart.so (_ZN3art11ScopedCheck11CheckThreadEP7_JNIEnv+544)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #13 pc 00000000000fecc8  /system/lib64/libart.so (_ZN3art11ScopedCheck5CheckERNS_18ScopedObjectAccessEbPKcPNS_12JniValueTypeE+1120)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #14 pc 00000000000fbd4c  /system/lib64/libart.so (_ZN3art8CheckJNI12MonitorEnterEP7_JNIEnvP8_jobject+620)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #15 pc 00000000000065c4  /data/app/com.example.frescogifcrash-2/lib/arm64/libgifimage.so (???)
> 08-22 14:05:01.357 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #16 pc 0000000000048b8c  /data/app/com.example.frescogifcrash-2/oat/arm64/base.odex (Java_com_facebook_animated_gif_GifFrame_nativeRenderFrame__IILandroid_graphics_Bitmap_2+168)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.animated.gif.GifFrame.nativeRenderFrame(Native method)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.animated.gif.GifFrame.renderFrame(GifFrame.java:50)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderImageDoesNotSupportScaling(AnimatedDrawableBackendImpl.java:221)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x0717c29b> (a com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedDrawableBackendImpl.renderFrame(AnimatedDrawableBackendImpl.java:179)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.animated.impl.AnimatedImageCompositor.renderFrame(AnimatedImageCompositor.java:120)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.wrapper.AnimatedDrawableBackendFrameRenderer.renderFrame(AnimatedDrawableBackendFrameRenderer.java:74)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.renderFrameInBitmap(BitmapAnimationBackend.java:305)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:209)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrameOrFallback(BitmapAnimationBackend.java:229)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.bitmap.BitmapAnimationBackend.drawFrame(BitmapAnimationBackend.java:164)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.backend.AnimationBackendDelegate.drawFrame(AnimationBackendDelegate.java:61)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.backend.AnimationBackendDelegateWithInactivityCheck.drawFrame(AnimationBackendDelegateWithInactivityCheck.java:111)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.fresco.animation.drawable.AnimatedDrawable2.draw(AnimatedDrawable2.java:204)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ScaleTypeDrawable.draw(ScaleTypeDrawable.java:125)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.FadeDrawable.drawDrawableWithAlpha(FadeDrawable.java:304)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.FadeDrawable.draw(FadeDrawable.java:291)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.drawable.ForwardingDrawable.draw(ForwardingDrawable.java:147)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.drawee.generic.RootDrawable.draw(RootDrawable.java:83)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.widget.ImageView.onDraw(ImageView.java:1268)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.draw(View.java:17077)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16059)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.358 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.recreateChildDisplayList(ViewGroup.java:3748)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewGroup.dispatchGetDisplayList(ViewGroup.java:3728)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.View.updateDisplayListIfDirty(View.java:16022)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.updateViewTreeDisplayList(ThreadedRenderer.java:656)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.updateRootDisplayList(ThreadedRenderer.java:662)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ThreadedRenderer.draw(ThreadedRenderer.java:770)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.draw(ViewRootImpl.java:2841)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.performDraw(ViewRootImpl.java:2649)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2256)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1291)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6362)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer$CallbackRecord.run(Choreographer.java:873)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer.doCallbacks(Choreographer.java:685)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer.doFrame(Choreographer.java:621)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:859)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Handler.handleCallback(Handler.java:751)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Handler.dispatchMessage(Handler.java:95)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.os.Looper.loop(Looper.java:154)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at android.app.ActivityThread.main(ActivityThread.java:6114)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.reflect.Method.invoke!(Native method)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:874)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:764)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Jit thread pool worker thread 0" prio=6 tid=2 Native (still starting up)
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x0 self=0x7f6d29ea00
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18859 nice=9 cgrp=default sched=0/0 handle=0x7f7450d450
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 17375259 7752291 7 ) utm=1 stm=0 core=3 HZ=100
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f7440f000-0x7f74411000 stackSize=1021KB
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.359 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 00000000004641bc  /system/lib64/libart.so (_ZN3art10ThreadPool7GetTaskEPNS_6ThreadE+252)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000463678  /system/lib64/libart.so (_ZN3art16ThreadPoolWorker3RunEv+124)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 0000000000462fa8  /system/lib64/libart.so (_ZN3art16ThreadPoolWorker8CallbackEPv+116)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Signal Catcher" prio=6 tid=3 WaitingInMainSignalCatcherLoop
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1670 self=0x7f74f28800
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18860 nice=0 cgrp=default sched=0/0 handle=0x7f7440c450
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 789532 590468 1 ) utm=0 stm=0 core=1 HZ=100
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f74312000-0x7f74314000 stackSize=1005KB
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_sigtimedwait+0xe0/0x1bc
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_rt_sigtimedwait+0xb4/0xec
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000006a848  /system/lib64/libc.so (__rt_sigtimedwait+8)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 0000000000024dc8  /system/lib64/libc.so (sigwait+64)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000043d474  /system/lib64/libart.so (_ZN3art9SignalSet4WaitEv+48)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 000000000043cf44  /system/lib64/libart.so (_ZN3art13SignalCatcher13WaitForSignalEPNS_6ThreadERNS_9SignalSetE+240)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 000000000043b510  /system/lib64/libart.so (_ZN3art13SignalCatcher3RunEPv+396)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "JDWP" prio=6 tid=4 WaitingInMainDebuggerLoop
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1700 self=0x7f6d22de00
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18861 nice=0 cgrp=default sched=0/0 handle=0x7f7430f450
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 3134942 1604115 19 ) utm=0 stm=0 core=3 HZ=100
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f74215000-0x7f74217000 stackSize=1005KB
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: poll_schedule_timeout+0x44/0x68
> 08-22 14:05:01.360 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_select+0x4c0/0x500
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: core_sys_select+0x1fc/0x308
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_pselect6+0x170/0x204
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000006a7a0  /system/lib64/libc.so (__pselect6+8)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 0000000000023300  /system/lib64/libc.so (select+156)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000054f0ec  /system/lib64/libart.so (_ZN3art4JDWP12JdwpAdbState15ProcessIncomingEv+340)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000301428  /system/lib64/libart.so (_ZN3art4JDWP9JdwpState3RunEv+920)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 00000000003008fc  /system/lib64/libart.so (_ZN3art4JDWPL15StartJdwpThreadEPv+48)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "ReferenceQueueDaemon" prio=6 tid=5 Waiting
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1790 self=0x7f74e96400
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18862 nice=0 cgrp=default sched=0/0 handle=0x7f74212450
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 644063 139635 8 ) utm=0 stm=0 core=0 HZ=100
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f74110000-0x7f74112000 stackSize=1037KB
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c54  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+660)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000000810  /system/framework/arm64/boot.oat (Java_java_lang_Object_wait__+124)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait!(Native method)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting on <0x014b4638> (a java.lang.Class<java.lang.ref.ReferenceQueue>)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$ReferenceQueueDaemon.run(Daemons.java:150)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x014b4638> (a java.lang.Class<java.lang.ref.ReferenceQueue>)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "FinalizerDaemon" prio=6 tid=6 Waiting
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1820 self=0x7f74e96e00
> 08-22 14:05:01.361 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18863 nice=0 cgrp=default sched=0/0 handle=0x7f7410d450
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 1188436 169741 6 ) utm=0 stm=0 core=1 HZ=100
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f7400b000-0x7f7400d000 stackSize=1037KB
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c54  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+660)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000000980  /system/framework/arm64/boot.oat (Java_java_lang_Object_wait__JI+140)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait!(Native method)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting on <0x03c22611> (a java.lang.Object)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait(Object.java:407)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:188)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x03c22611> (a java.lang.Object)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:209)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$FinalizerDaemon.run(Daemons.java:204)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "HeapTaskDaemon" prio=6 tid=7 Blocked
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1940 self=0x7f74e98200
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18865 nice=0 cgrp=default sched=0/0 handle=0x7f73f03450
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 23741508 358958 31 ) utm=0 stm=2 core=2 HZ=100
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f73e01000-0x7f73e03000 stackSize=1037KB
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac88  /system/lib64/libc.so (syscall+32)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e7374  /system/lib64/libart.so (_ZN3art17ConditionVariable9TimedWaitEPNS_6ThreadEli+176)
> 08-22 14:05:01.362 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000023f764  /system/lib64/libart.so (_ZN3art2gc13TaskProcessor7GetTaskEPNS_6ThreadE+296)
> 08-22 14:05:01.363 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000240080  /system/lib64/libart.so (_ZN3art2gc13TaskProcessor11RunAllTasksEPNS_6ThreadE+92)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 00000000001e4e80  /system/framework/arm64/boot-core-libart.oat (Java_dalvik_system_VMRuntime_runHeapTasks__+124)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at dalvik.system.VMRuntime.runHeapTasks(Native method)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting to lock an unknown object
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$HeapTaskDaemon.run(Daemons.java:433)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "FinalizerWatchdogDaemon" prio=6 tid=8 Sleeping
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db18b0 self=0x7f74e97800
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18864 nice=0 cgrp=default sched=0/0 handle=0x7f74008450
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 337136 2071823 4 ) utm=0 stm=0 core=2 HZ=100
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f73f06000-0x7f73f08000 stackSize=1037KB
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac88  /system/lib64/libc.so (syscall+32)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e7374  /system/lib64/libart.so (_ZN3art17ConditionVariable9TimedWaitEPNS_6ThreadEli+176)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c64  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+676)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 00000000000bc808  /system/framework/arm64/boot.oat (Java_java_lang_Thread_sleep__Ljava_lang_Object_2JI+164)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.sleep!(Native method)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - sleeping on <0x03699376> (a java.lang.Object)
> 08-22 14:05:01.365 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.sleep(Thread.java:371)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x03699376> (a java.lang.Object)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.sleep(Thread.java:313)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$FinalizerWatchdogDaemon.sleepFor(Daemons.java:314)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$FinalizerWatchdogDaemon.waitForFinalization(Daemons.java:336)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Daemons$FinalizerWatchdogDaemon.run(Daemons.java:253)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Binder:18854_1" prio=6 tid=9 Native
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1af0 self=0x7f6826ac00
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18866 nice=0 cgrp=default sched=0/0 handle=0x7f73d00450
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 3330418 232760 17 ) utm=0 stm=0 core=0 HZ=100
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f73c06000-0x7f73c08000 stackSize=1005KB
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_thread_read+0x1004/0x11c0
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_ioctl_write_read+0x1f8/0x33c
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_ioctl+0x2b0/0x758
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_vfs_ioctl+0x4bc/0x59c
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_ioctl+0x60/0x88
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000006a754  /system/lib64/libc.so (__ioctl+4)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 000000000001fbf0  /system/lib64/libc.so (ioctl+144)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000055534  /system/lib64/libbinder.so (_ZN7android14IPCThreadState14talkWithDriverEb+260)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000055694  /system/lib64/libbinder.so (_ZN7android14IPCThreadState20getAndExecuteCommandEv+24)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 0000000000055dc0  /system/lib64/libbinder.so (_ZN7android14IPCThreadState14joinThreadPoolEb+72)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 0000000000072dc4  /system/lib64/libbinder.so (???)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 0000000000012430  /system/lib64/libutils.so (_ZN7android6Thread11_threadLoopEPv+272)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #07 pc 000000000009d964  /system/lib64/libandroid_runtime.so (_ZN7android14AndroidRuntime15javaThreadShellEPv+116)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #08 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #09 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Binder:18854_2" prio=6 tid=10 Native
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12db1b80 self=0x7f6d2a6200
> 08-22 14:05:01.366 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18867 nice=0 cgrp=default sched=0/0 handle=0x7f73c03450
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 1470108 1351615 9 ) utm=0 stm=0 core=2 HZ=100
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f73b09000-0x7f73b0b000 stackSize=1005KB
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_thread_read+0x1004/0x11c0
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_ioctl_write_read+0x1f8/0x33c
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: binder_ioctl+0x2b0/0x758
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_vfs_ioctl+0x4bc/0x59c
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_ioctl+0x60/0x88
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000006a754  /system/lib64/libc.so (__ioctl+4)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 000000000001fbf0  /system/lib64/libc.so (ioctl+144)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000055534  /system/lib64/libbinder.so (_ZN7android14IPCThreadState14talkWithDriverEb+260)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000055694  /system/lib64/libbinder.so (_ZN7android14IPCThreadState20getAndExecuteCommandEv+24)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 0000000000055dc0  /system/lib64/libbinder.so (_ZN7android14IPCThreadState14joinThreadPoolEb+72)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 0000000000072dc4  /system/lib64/libbinder.so (???)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 0000000000012430  /system/lib64/libutils.so (_ZN7android6Thread11_threadLoopEPv+272)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #07 pc 000000000009d964  /system/lib64/libandroid_runtime.so (_ZN7android14AndroidRuntime15javaThreadShellEPv+116)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #08 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #09 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Profile Saver" prio=6 tid=11 Native
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12dd1940 self=0x7f68286000
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18871 nice=-1 cgrp=default sched=0/0 handle=0x7f73ab4450
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 458334 5488697 3 ) utm=0 stm=0 core=3 HZ=100
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f739ba000-0x7f739bc000 stackSize=1005KB
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac88  /system/lib64/libc.so (syscall+32)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e7374  /system/lib64/libart.so (_ZN3art17ConditionVariable9TimedWaitEPNS_6ThreadEli+176)
> 08-22 14:05:01.367 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000031a190  /system/lib64/libart.so (_ZN3art12ProfileSaver3RunEv+160)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 000000000031b930  /system/lib64/libart.so (_ZN3art12ProfileSaver21RunProfileSaverThreadEPv+100)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "RenderThread" prio=6 tid=12 Native
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12f3d820 self=0x7f6d21f600
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18881 nice=-4 cgrp=default sched=0/0 handle=0x7f6d826450
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 79359368 7248385 97 ) utm=4 stm=3 core=1 HZ=100
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f6d72c000-0x7f6d72e000 stackSize=1005KB
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_epoll_wait+0x2ac/0x370
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_epoll_pwait+0xa4/0x118
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000006a668  /system/lib64/libc.so (__epoll_pwait+8)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 000000000001e3c4  /system/lib64/libc.so (epoll_pwait+64)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000017f9c  /system/lib64/libutils.so (_ZN7android6Looper9pollInnerEi+156)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000017e50  /system/lib64/libutils.so (_ZN7android6Looper8pollOnceEiPiS1_PPv+60)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 0000000000039e2c  /system/lib64/libhwui.so (_ZN7android10uirenderer12renderthread12RenderThread10threadLoopEv+656)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 0000000000012430  /system/lib64/libutils.so (_ZN7android6Thread11_threadLoopEPv+272)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 000000000009d964  /system/lib64/libandroid_runtime.so (_ZN7android14AndroidRuntime15javaThreadShellEPv+116)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #07 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #08 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Thread-2" prio=6 tid=13 Waiting
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12f631f0 self=0x7f682a0a00
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18882 nice=10 cgrp=bg_non_interactive sched=0/0 handle=0x7f6d729450
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 3943074 1004115 3 ) utm=0 stm=0 core=3 HZ=100
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f6d627000-0x7f6d629000 stackSize=1037KB
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.368 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c54  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+660)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000000980  /system/framework/arm64/boot.oat (Java_java_lang_Object_wait__JI+140)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait!(Native method)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting on <0x0225ed77> (a java.lang.Object)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.parkFor$(Thread.java:2127)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x0225ed77> (a java.lang.Object)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at sun.misc.Unsafe.park(Unsafe.java:325)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.LockSupport.park(LockSupport.java:161)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2035)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:413)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1058)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.core.PriorityThreadFactory$1.run(PriorityThreadFactory.java:42)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "pool-2-thread-1" prio=6 tid=14 Waiting
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12f638b0 self=0x7f682a2800
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18883 nice=0 cgrp=default sched=0/0 handle=0x7f6d624450
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 10898280 2919376 7 ) utm=1 stm=0 core=2 HZ=100
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f6d522000-0x7f6d524000 stackSize=1037KB
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c54  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+660)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000000980  /system/framework/arm64/boot.oat (Java_java_lang_Object_wait__JI+140)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait!(Native method)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting on <0x098a8de4> (a java.lang.Object)
> 08-22 14:05:01.369 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.parkFor$(Thread.java:2127)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x098a8de4> (a java.lang.Object)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at sun.misc.Unsafe.park(Unsafe.java:325)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.LockSupport.park(LockSupport.java:161)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2035)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:413)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1058)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "Thread-3" prio=6 tid=15 Waiting
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12f964c0 self=0x7f6d265a00
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18884 nice=10 cgrp=bg_non_interactive sched=0/0 handle=0x7f58e6f450
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 5385623 562500 53 ) utm=0 stm=0 core=2 HZ=100
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f58d6d000-0x7f58d6f000 stackSize=1037KB
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 00000000000e6dd4  /system/lib64/libart.so (_ZN3art17ConditionVariable16WaitHoldingLocksEPNS_6ThreadE+160)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 0000000000377c54  /system/lib64/libart.so (_ZN3art7Monitor4WaitEPNS_6ThreadElibNS_11ThreadStateE+660)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000000980  /system/framework/arm64/boot.oat (Java_java_lang_Object_wait__JI+140)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Object.wait!(Native method)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - waiting on <0x0992124d> (a java.lang.Object)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.parkFor$(Thread.java:2127)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   - locked <0x0992124d> (a java.lang.Object)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at sun.misc.Unsafe.park(Unsafe.java:325)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.LockSupport.park(LockSupport.java:161)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2035)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:413)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1058)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
> 08-22 14:05:01.370 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at com.facebook.imagepipeline.core.PriorityThreadFactory$1.run(PriorityThreadFactory.java:42)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   at java.lang.Thread.run(Thread.java:761)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] "hwuiTask1" prio=6 tid=16 Native
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | group="" sCount=1 dsCount=0 obj=0x12fd0310 self=0x7f58bdd600
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | sysTid=18885 nice=-2 cgrp=default sched=0/0 handle=0x7f58d6a450
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | state=S schedstat=( 540522 387813 2 ) utm=0 stm=0 core=0 HZ=100
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | stack=0x7f58c70000-0x7f58c72000 stackSize=1005KB
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   | held mutexes=
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: __switch_to+0x70/0x7c
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait_queue_me+0xe4/0x144
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: futex_wait+0xf4/0x200
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: do_futex+0xcc/0x890
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: SyS_futex+0xf4/0x16c
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   kernel: el0_svc_naked+0x24/0x28
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #00 pc 000000000001ac84  /system/lib64/libc.so (syscall+28)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #01 pc 0000000000067a24  /system/lib64/libc.so (pthread_cond_wait+96)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #02 pc 000000000003acc8  /system/lib64/libhwui.so (???)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #03 pc 0000000000012430  /system/lib64/libutils.so (_ZN7android6Thread11_threadLoopEPv+272)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #04 pc 000000000009d964  /system/lib64/libandroid_runtime.so (_ZN7android14AndroidRuntime15javaThreadShellEPv+116)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #05 pc 00000000000682cc  /system/lib64/libc.so (_ZL15__pthread_startPv+196)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   native: #06 pc 000000000001dca8  /system/lib64/libc.so (__start_thread+16)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403]   (no managed stack frames)
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/art: art/runtime/runtime.cc:403] 
>                                                                  
>                                                                  --------- beginning of crash
> 08-22 14:05:01.371 18854-18854/com.example.frescogifcrash A/libc: Fatal signal 6 (SIGABRT), code -6 in tid 18854 (.frescogifcrash)
>                                                                   
>                                                                   [ 08-22 14:05:01.372   463:  463 W/         ]
>                                                                   debuggerd: handling request: pid=18854 uid=10151 gid=10151 tid=18854
>  Thanks, I'll take a look. Running this through identify shows that the GIF image has different width/height for different frames:

```
[user:tmp]$ identify test.gif
test.gif[0] GIF 961x145 960x145+0+0 8-bit sRGB 2c 54.4KB 0.000u 0:00.000
...
test.gif[49] GIF 333x76 960x145+283+34 8-bit sRGB 64c 54.4KB 0.000u 0:00.000
```

This was a long standing bug (see https://github.com/facebook/fresco/issues/1657) that was fixed some days ago: https://github.com/facebook/fresco/commit/504401041cc783c231feb7fabc870a3acea3ee30

The fix should go with the next release. I'll close this task here for now, but please ping it when the changes do not fix your issue. This issue should have been fixed already. If you still experience this, please give us a sample image @Anilugale so that we can investigate.  Hi, @fabulant, thank you for great report, we will take a look at this issues.  Fresco doesn't check the file suffix. Just pass the file to a DraweeView and it should work. See also http://frescolib.org/docs/supported-uris.html  Do you have the same measurements for the old version? Could you post a comparison video? In all the tests I did, the new version performed way better.

How many GIFs are you displaying at a time? Do you use a RecyclerView?   Thanks for the videos and sample GIFs. I'll try to repro with one of our sample apps. This should not happen.  Do you have a image URI for such a corrupted / invalid WebP? Yeah, having an option not to crash would be nice. Feel free to check out the stack trace and submit a pull request :)  Please take a look at our RecyclerView example here in our Showcase app that caches images: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java  Almost certainly this is because the smaller images are being loaded from a thumbnail and that misses the `ResizeAndRotateProducer` on the way back.

We'd probably have to review the producer chain to ensure this works correctly.  Hi @pvkumar4125 , could you please attach some logcat logs showing the error that occurs during installation?
Some information about the device would also be useful.
Thanks! If you're building a system app, I think you're supposed to put the .so files in `/system/lib/`. There are probably better places to get help with building and deploying system apps though. By default we include a lightweight, naive SoLoaderShim implementation which should work for you. You can make this more robust by using SoLoader or ReLinker, as per [this comment](https://github.com/facebook/fresco/issues/1817#issuecomment-313374035). Closing issue due to lack of updates  Ideally, your GIF would be properly formatted and have the loop count set to N.

Otherwise, you can create a modifying backend, something like this:
```java
public class LoopCountModifyingBackend extends AnimationBackendDelegate {

  private int mLoopCount;

  public LoopCountModifyingBackend(
      @Nullable AnimationBackend animationBackend,
      int loopCount) {
    super(animationBackend);
    mLoopCount = loopCount;
  }

  @Override
  public int getLoopCount() {
    return mLoopCount;
  }
}
```

and then set it to your animated drawable:

```java
final DraweeController controller = Fresco.newDraweeControllerBuilder()
    .setAutoPlayAnimations(true)
    .setUri(uri)
    .setControllerListener(new BaseControllerListener<ImageInfo>() {
      @Override
      public void onFinalImageSet(
          String id,
          @Nullable ImageInfo imageInfo,
          @Nullable Animatable animatable) {
        if (animatable instanceof AnimatedDrawable2) {
          AnimatedDrawable2 animatedDrawable = (AnimatedDrawable2) animatable;
          animatedDrawable.setAnimationBackend(new LoopCountModifyingBackend(animatedDrawable.getAnimationBackend(), 3));
        }
      }
    })
    .build();
simpleDraweeView.setController(controller);
```

You can also create a custom DrawableFactory that does this directly and then pass it when the image is rendered via PipelineDraweeController.  Hi @UFreedom, could you please provide a stack trace for this exception? @UFreedom, sorry for taking a while to respond.
Looks like there is no easy way to catch this exception without modifying Fresco itself. Probably we should never crash if this error occurs, it would be better to fail safely instead. @geetgobindsingh, @UFreedom a fix for this will be included in the upcoming release (planned for the next few days). Yes @haodadaa, the fix is in 1.8.0  Hi @jhonween, please see documentation http://frescolib.org/docs/using-image-pipeline.html (section called "Synchronous image loading")  Hi @Anmolk22 

Could you please share some of your code, showing how you:

1. How you request the image to be loaded into the SimpleDraweeView in onBindViewHolder
2. Where you call .getWidth()

Thanks! Also, for the SimpleDraweeView, what does the xlm layout look like for each item in the recyclerview? Ok, I don't quite understand what is going on in `setUpImages`, why set the controller from inside he global layout listener? @Anmolk22 , I would not recommend using this approach in a RecyclerView since the view could potentially be recycled before any draw occurs.

If possible, please use a fixed size for the SimpleDraweeView or use a fixed aspect ratio. Yes, the problem should be that using global layout listeners on views in a recycler view is not safe. I would still recommend that you either go with a fixed size or a fixed aspect ratio for the drawee views. You should then be able to already know the dimensions in onBind.  @Fkut - Please provide additional information:

- How are you using Fresco? (please include code if possible)
- What goes wrong? (logs)

I'm going to close this issue for now, but please respond and we can reopen it again. Thanks!
  Hi @stayf - Would it make any difference if you add another "/" to that URI, like this:

`file:///data/user/0/com.test.app/cache/thumb/profile/thumb0.png`  Hi @zhufeng1222, to make that work you would need to implement a ContentProvider that queries your database and returns the image data. After doing so, you can use a "content://" url with Fresco to load the image.

I'm going to close this issue, but if there is something else that is not clear, please leave another comment and we can reopen it. Thanks! You could do something similar to this answer on Stackoverflow: https://stackoverflow.com/a/30028763

Instead of storing the image in the database, it might be simpler to just store the URL, and then let Fresco load and cache the image on disk for you.  I can see the cause, inside [WebpSupportStatus](https://github.com/facebook/fresco/blob/f2268961dfd7d8be9ea3b3cf1a978c4d7d0aac9a/fbcore/src/main/java/com/facebook/common/webp/WebpSupportStatus.java#L36) which doesn't set the static instance of the decoder.

If you're hitting this line, I assume your `ImagePipelineConfig` requests the `WebpSupportEnabled` experiment and that this is a WebP image.

I'll fix the bug but the good news is that you don't need to enable that flag to have WebP images work. It's not a well-named method so I'll add a meaningful Javadoc to that too. When I came to fix this I found the decoder should be set after all. I'm going to return to this though when I have time.

Have you tried turning off the flag and did that help?  You should not have to do this yourself. If the cached bitmaps aren't being held on by anything else they will clear themselves.

I suggest you use Stetho to debug how many images are being held as you make each activity jump. See #1719 for how to add Stetho and use it.  Can you please provide an example URL for a GIF which is showing this issue? The image renders correctly for me both with fitCenter and centerCrop, see:

![screen shot 2017-11-07 at 11 59 20 am](https://user-images.githubusercontent.com/2699634/32492708-27d82d90-c3b3-11e7-9ab7-41973cb50b4f.png)

Please take a look at the sample app here: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/gif/ImageFormatGifFragment.java
  As you've seen the app needs to be restarted because custom decoders can only be set during the initialisation of Fresco during app creation.

We should fix the Showcase so that this switch requests/triggers a restart. Exactly @a-d-collins, a dialog like `ShowRestartMessageDialog` should be used to make it clear the restart is necessary. Roger that. This has been implemented. A toggle will be shown to inform you that the app needs to be restarted.  I'm not keen on breaking the API here.

The bigger problem for me though is that custom format checkers are queried first. As such, every single image you load would run through the entire file seeking `<svg` which assuming most images are JPEGs will be hugely wasteful. And of course you could hit a false positive if you seek through every file in full.

So, I have a couple of thoughts about this.

1) We should alter the order so that the standard formats are checked first. This will remove the possibility of overriding the JPEG decoder but I don't think that was a stated benefit of this API anyway. That way, if a format checker is unavoidably more expensive it will at least only affect the loading of non-standard format images.

2) It may still be imperfect, but how about having the SVG checker check for either `<svg` or `<?xml` at the start of the file. If it finds `<?xml` then it could look through the remainder of the header looking for `<svg` but otherwise bail out at that early stage. Then, editing `getHeaderSize()` to return a higher value (but not ridiculously high, something like 40-50) reduces the chances of false negatives.

What do you think @a-d-collins? @kirwan, I agree that breaking the API is a bad idea. I (now) also agree that running through an entire file to find `<svg` is not a good one either. Hitting false positives is most definitely a possibility there, so doing that search would be both costly and risky, as you pointed out.

As for your suggestions, I like both. Searching for defaults first is smart and using the presence of `<?xml` (or something else) as a possible indicator of the presence of an `<svg` tag later on is an improvement. I'll get started on those.

P.S. - Didn't mean to close the issue. My bad. @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/9f2eb2a3cc754a48a108b9acbeb0fa503a44f971..75e89e3f2757db18e443d9ad63ab09d314d6f9be) @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/75e89e3f2757db18e443d9ad63ab09d314d6f9be..fb051730c395b9e250e5dec5279647f7a415e696) @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/fb051730c395b9e250e5dec5279647f7a415e696..5ed9c67fefe8397b8ffc4e75be49ea6ebfc9a4d6) @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/5ed9c67fefe8397b8ffc4e75be49ea6ebfc9a4d6..49541f0b265e29074f8ac548c32eb4bafd4984fd) @lambdapioneer, @oprisnik, and @kirwan, I'm done making updates. When you all get the chance, let me know your thoughts. @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/49541f0b265e29074f8ac548c32eb4bafd4984fd..bde2a77322d907ca8b696fc3e21f71aaeed47e52) Thanks @a-d-collins, this looks good to me now. @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5546924). Awesome. Good to know! @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/bde2a77322d907ca8b696fc3e21f71aaeed47e52..048831cb06f81eb4552bbe3c4c675bafc02d0f1d) - [changes since last import](https://github.com/facebook/fresco/pull/1849/files/bde2a77322d907ca8b696fc3e21f71aaeed47e52..048831cb06f81eb4552bbe3c4c675bafc02d0f1d) @a-d-collins updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1849/files/048831cb06f81eb4552bbe3c4c675bafc02d0f1d..90e26ba2193af181b9348b0d92cc618ee898edc1) - [changes since last import](https://github.com/facebook/fresco/pull/1849/files/bde2a77322d907ca8b696fc3e21f71aaeed47e52..90e26ba2193af181b9348b0d92cc618ee898edc1) @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5546924).  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at cla@fb.com. Thanks! Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Hey @JuniperPhoton, thank you very much for the pull-request! I'll import it such that our internal tests also run on this.

Can you add unit tests such that this does not regress in future releases? That would be great. @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5526315). @JuniperPhoton updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1848/files/55883f77f85ba00808ac46927e35b3013259be52..81510d45ea9f55114878169094238c2028f1378e) - [changes since last import](https://github.com/facebook/fresco/pull/1848/files/55883f77f85ba00808ac46927e35b3013259be52..81510d45ea9f55114878169094238c2028f1378e) @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5526315).  Have you added our Proguard config? That class is marked as `@DoNotStrip` but unless you include our Proguard rules that will be ignored.

More details on the [Shipping Your App](http://frescolib.org/docs/shipping.html#proguard) page in our docs. This has been asked many times.

See https://github.com/facebook/fresco/search?utf8=%E2%9C%93&q=NoClassDefFoundError+NativeMemoryChunk&type=Issues OK, let's see if we can find another cause...

Can you answer these questions:

1. What other dependencies do you have?
2. Do you enable multidex?
3. What device(s) and Android version(s) is this on? You said x86 but is it a real device or emulator?
4. Debug or release builds? If you are using Multidex, I suggest following the steps [here](https://developer.android.com/studio/build/multidex.html#mdex-gradle) to ensure you're doing everything correctly. I'm not aware of any dependencies that should clash but we saw reports at one time with a particular version of the Google Mobile Services plugin.

With multidex, does your Application class extend `android.support.multidex.MultiDexApplication` or just `Application`? Thanks @efrohnhoefer for noticing the error which I'd missed.

@LIHAIYI I hope that helps you.  Thank you! Looks good (y)

However, we'd need you to sign the CLA (as linked in the PR template) @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5517462). Sorry for the confusion. Looks like @facebook-github-bot had been sleeping. It's landing right now.  Hey @zjupure, thanks for looking into this. However, it seems that this breaks some unit tests that need fixing :) Also it would be great if you can add new unit tests for the new condition that you've added.

Also I think that the change would also need to be applied to `PartialDiskCacheProducer` (CC @kirwan ) @zjupure updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1845/files/35371bdf4f69eeaacd49ba1b5eef765e4e0f41eb..4607e708af1b0a2863df7c02c4c656fd2055e1a9) Thank you very much for fixing and adding unit tests!

However, before importing I'd need to ask you to sign the our contributor license agreement (https://code.facebook.com/cla) 

CC @kirwan who knows about the `PartialDiskCacheProducer` and whether we should include the change there as well. [@zjupure](https://github.com/zjupure) has updated the pull request. View: [changes](https://github.com/facebook/fresco/pull/1845/files/4607e708af1b0a2863df7c02c4c656fd2055e1a9..872714be1a5e548c432e4074558fab940fc16987) [@zjupure](https://github.com/zjupure) has updated the pull request.  Hi @AlirezaGhanbarinia,

we use the GitHub issues for bug reports and questions particular to the Fresco library. You are likely to get a better answer when raising this on stackoverflow (or similar platforms). I'll close this for now.

If I've misunderstood your questions and it's related to a bug in Fresco, please re-open and comment with a repo and we'll have a look.  Hi @AlirezaGhanbarinia,

see http://frescolib.org/docs/progress-bars.html on how to create your own progress drawable. Feel free to re-open if there's something that remained unclear.  Hi @hcadoid, thanks for raising this issue. What do you mean by "fragment jump"? Is this a particular fragment transition?

Also which Fresco library are you using? Would be great if you can provide some small code sample that reproduces the issue. Android N changed visibility handling for Drawables. I've added a workaround, see #1445:

`impleDraweeView.setLegacyVisibilityHandlingEnabled(true)` I don't think I'll have time for a proper fix soon. However,  doing something along the lines of 
```java
setExitSharedElementCallback(new SharedElementCallback() {
    @Override
    public void onSharedElementEnd(List<String> names,
                                   List<View> elements,
                                   List<View> snapshots) {
        super.onSharedElementEnd(names, elements, snapshots);
        for (final View view : elements) {
            if (view instanceof SimpleDraweeView) {
                view.post(() -> {
                    view.setVisibility(View.VISIBLE);
                    view.requestLayout();
                });
            }
        }
    }
});
```
as mentioned in #1445 should work.

The problem is that Google changed the visibility API and I didn't find an easy way to fix that for Drawee. Pull requests are welcome :) @hnvn take a look at the comments in #1445. You have to do this in your activity / fragment  Hi @SandyWangWei, thank you for raising this issue!

Can you provide details on which Android version you have observed this? Ideally some listing of those filedescriptors you are referring to? Hi @SandyWangWei, can you also post the output of `lsof -p $YOUR_PID` here? That allows us to distinguish between unix sockets and TCP sockets.

Which network library are you using (OkHttp?) and does this also reproduce with our sample app?

And for prioritization: does this have any negative observable effects? Closing due to no updates from the submitter.  Hi @jacpy, can you provide us with the code that you use for creating the image request and the drawee view?

Also the logcat output (see http://frescolib.org/docs/troubleshooting.html) would be very helpful. @jacpy It would also be useful to know if this happens for one specific image or if it's happened for different images. Is this the same issue fixed by #1848 ? #1848 is now merged so I'm closing this as fixed based on the stack trace here.  Hi @pverma5, can you confirm that the DraweeViews are getting correctly attached and de-attached when switching/scrolling through the app? As the images don't see large, it's likely an issue where views are considered visible for too long time. I'm closing this issue due to inactivity. If this is still a problem, let us know!

  HI @thomas-le-bihan, thanks for raising this issue. Can you please provide the following information which I need for being able to help with this:

 - Is this happening for every image in your app or only particular ones?
 - Are these images loaded locally (e.g. from SD card) or downloaded over the network?
 - Can you provide us with one image that causes this issue? @thomas-le-bihan, I've tried to reproduce using our showcase on Android 7.0.0 and could not find any issue. Can you provide us with a minimal working example or the `adb logcat` output as described here: http://frescolib.org/docs/troubleshooting.html ? Hi @thomas-le-bihan, thanks for providing the logs. This indeed looks like a bug. Can you provide me with the code that you use to 

 - setup the ImagePipelineConfig
 - set the ImageRequest and DraweeView

Then I should be able to reproduce the same behavior. It seems to me that the `ResizeAndRotateProducer` fails on an intermediate result, but then takes down the entire request (which should not happen) Hi @thomas-le-bihan,

I've been able to reproduce parts of this in our showcase app. I can re-create the error (no JPEG data in stream), but as expected it does not abort the image request and the correct image will be correctly shown eventually. However, there is a grey-box being shown in the mean time.

Can you provide me with the details of the image request? Are you using anything other than a resize? Ideally you can change the showcase app to raise the same error.

**My repro details:**

 - Change ShowcaseApplication.java to: https://gist.github.com/lambdapioneer/d6f3f6638398e0b3c3582536f0a19e59
 - Change DraweeSimpleFragment.java to: https://gist.github.com/lambdapioneer/a04ccf472708b2cfe5d2f779efc59ddf
 - Clear caches and set emulator to EDGE to observe intermediate result propagation
 - Install showcase app and run drawee simple fragment (maybe clear caches once more)
 - Observe following adb logcat output: https://gist.github.com/lambdapioneer/7ba1a46a3652433d3880319e152b23ed
 - Observe that image is gray for some time, but finally gets replaced by correct image Hi @thomas-le-bihan,

We are looking into that issue, but I have no ETA at the moment. Also, I haven't been able to get a minimal sample that actually fails the entire request (in my test runs the image will be correct in the end).

For now removing the resize might work, but I understand that this not an ideal solution.

CC @kirwan   Hey @redpandatronicsuk, thanks for exemplary issue (y).

The react native version `0.46.4` uses Fresco `1.0.1` (see https://github.com/facebook/react-native/blob/0.46-stable/ReactAndroid/build.gradle#L282). Therefore, your animation/webp dependencies should use the same version numbers.

The last reference to `MemoryUiTrimmable ` got removed here: https://github.com/facebook/fresco/commit/d41bf01bc3e3a24a2a24aff4f543d570f2c0e76f (which is just after the `1.0.1` release.

Let me know if updating the version numbers solved your issue.

Alternatively, this commit updated Fresco to `1.3.0` in ReactNative and should be included in the next release: https://github.com/facebook/react-native/commit/999851a3891b4c6ceffd37fa3a6bdb27c5b6159e

CC @foghina   This looks very specific to React Native and not Fresco. My guess is any image format would give the same error. Can you confirm that this only happens for webps?  Are you setting the same image or a different image when it flashes? If it's the same image it **should** be in bitmap cache and there shouldn't be any flashing.

You can try using `RetainingDataSourceSupplier` from #1328 to keep the previous image while the new one is being loaded. @duanyunfei what kind of UI do you have where this issue appears? If it is a recycler view, you might want to have a look at the sample of the showcase app and check if it matches with your code: 

https://github.com/facebook/fresco/blob/1472a3e1b1655e9b52c74e0b06d5ba60d15a42f9/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java#L96-L132  See here: http://frescolib.org/docs/faq.html#why-cant-i-use-androids-wrap_content-attribute-on-a-draweeview  Hi @ankit02jindal! When you're loading an image with `ResizeOptions`, the whole image is still loaded from the server, it's just resized on the device so it takes up less memory (RAM) when displayed. If you want your images to load faster you should resize them on the server instead.  What image are you trying to decode? A huge animated GIF / WebP? Can you reproduce the issue in the Showcase sample app (which has a URI override)? 1.4.0 includes a new implementation for animated images that shares the caches for frames with the rest of fresco to adhere to the set memory limits. Previously, frames were handled completely separately, which means that there were no real limits. It seems that you're running into this issue now since you're displaying many big GIFs. You can increase Fresco's memory limits, see http://frescolib.org/docs/configure-image-pipeline.html Yeah, in general you should not serve huge GIFs to the client. However, we do not support client-side resizing / downsampling for GIFs. You can however implement a custom decoder that creates smaller GIFs. Hi @e-hai, we don't support this feature yet because there was no need for us yet (in many cases videos are the better format for this kind of large animations).

If you want to improve our GIF handling, we gladly accept pull-requests :) This section of our documentation http://frescolib.org/docs/building-from-source.html is a good place to start.

Know that for updating the GIF code, you'll need work on the native side (this here is a good entry point: https://github.com/facebook/fresco/blob/4404a6c88b17fabb3d431653124c64657518b16e/animated-gif/src/main/jni/gifimage/gif.cpp) Closing due to lack of updates.  Looking at the two SVG files, the Wikipedia one starts with `<?xml version="1.0"?>` but the header check in [`SvgDecoderExample`](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg/SvgDecoderExample.java) is naive and relies upon the image starting `<svg`. I'd suggest making this more robust if you need it.

@oprisnik may have more thoughts on this.
 Yeah, the SVG decoder is just a very simple example, so as suggested by Kirwan, making the header checks more robust is the way to go. Feel free to send a PR. @filipedelimabrito, can you confirm that this issue can be closed? I believe that my fixes should have solved your SVG issue. @filipedelimabrito The change is included in [1.5.0](https://github.com/facebook/fresco/releases/tag/v1.5.0) so you can simply upgrade to test. Yeah, this should be fixed now. Let us know if you're still experiencing this issue.  Hey @mac-pro, thanks for opening the issue. All of our dependencies should be declared as `provided`, in which case you can declare whatever version you want in your app, as long as the APIs that we use don't conflict (which they shouldn't). Are you finding that that is not the case? As you say, we use very, very little of the support library.

We increase the version number we depend on because we use the same version for the annotations.

Looking at the support library repo shows that the [Pools](https://github.com/android/platform_frameworks_support/commits/master/compat/java/android/support/v4/util/Pools.java) class we depend on hasn't changed in a while and it's very unlikely that it will break anything whichever version you choose to use.

We could consider bringing that one class into the library (as could someone else via a pull request). It wouldn't affect the library size meaningfully.

I'm curious why this is a particular concern to you though, given I assume you use other libraries which also depend on the support library. To add to what @kirwan said, increasing the major version of a library should be reserved for big breaking changes in the public API of said library. The support library is not part of our public API, so I wouldn't bump the major version when updating that.  Thanks, I verified that this actually doesn't work right now.  We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is be way more performant, especially in the case where you display multiple GIFs. Let us know if you're still experiencing problems with 1.4.0.  Do you have a sample WebP file where this happens? @UFreedom The next release of Fresco will contain an updated version of libwebp as well as improved animation support. Once that is released, let's retest this.
I tried reproducing the issue with your webp files in the Showcase app, but have not succeeded so far (although this was already with a newer build of Fresco than what you are most likely running). I'm closing this as a duplicate of #1700. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs that is way more performant, especially in the case where you display multiple images. Let us know if you're still experiencing problems with 1.4.0.  Hi @zjupure!

Using SoLoader or ReLinker should fix this issue. More info for example in #1724, #1738, #1723, #933 and also here: https://github.com/facebook/SoLoader

If that does not help, please let us know and we can reopen this task. Thanks!  Hi @santanaluiz, are you using a shared element activity transition for animating between the two activities?  Hi @luohongzhen, please see the reply here: https://github.com/facebook/fresco/issues/1749  Hi @zhudongya123. About the placeholder, is 5KB the size on disk or the decoded bitmap size? (also, do you still get the crash if you don't set a placeholder drawable?)

You should also be able to use the hprof file to find out what is keeping the references to all those bitmaps. I see, that is quite strange. There are a few things that you might want to try

1. Try using a different drawable for placeholder and see if it still crashes
2. Use a shared drawable as placeholder and pass that in when binding the view
3. Check how much memory is used without the placeholder, maybe you are still close to running out of memory? @zhudongya123, OK that's good :)

It's still a bit strange that when loading the original placeholder image was trying to allocate 10800012 bytes instead of the expected 1200000 bytes (600*500*4). The first number is almost exactly 9 times the expected (or exactly 9.00001).

I'm wondering if the device is somehow resizing the image incorrectly. It would be interesting to see what the actual dimensions are of the loaded placeholder (could be found out by getting the Bitmap from the loaded BitmapDrawable). btw. In which drawable folder in your project did you place the placeholder image?  Our next release will bring new animated GIF code which may help but memory limitations and time to decode animated images tends to result in this kind of delay. @DukeLee1989 Using a placeholder drawable might also help to make the issue less noticeable.  We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant. Please let us know if this fixed your issue.  You haven't provided enough information to know why this might be failing for you.

I suggest you follow the steps under "Investigating issues with logcat" at http://frescolib.org/docs/troubleshooting.html to see what's happening here. I'm closing this issue due to inactivity. If this is still a problem, let us know!

  I can't tell anything from this about what might have taken the memory.

Have you used the Android Studio memory profiler to see if you have a leak?

Also, have you looked at http://frescolib.org/docs/troubleshooting.html ? I'm closing this issue due to inactivity. If this is still a problem, let us know!

  This should have been documented in our release notes for 1.3.0. Sorry it's missing, I'll amend them.  At 10:46:56.162 there is a call to `submitRequest()` which is cancelling the original request. Is this the one which doesn't load anything or is it the original request you want?

It might be useful to see a snippet of your code to understand what you're calling - are you really just calling `setImageURI()`? I'm closing this issue due to inactivity. If this is still a problem, let us know!

  @xiaoyao27610, please provide details to make this actionable for us. The issues have a template with the information that we'd need. In this case especially the image file would be interesting.  Please fill in the template of the issue. Otherwise this is hardly actionable for us.  Hi @spapapan, thanks for the issue. The `DraweeController` shouldn't cause any CPU cycles after the DraweeView has been detached. I've some details that I'd need to help here :)

Do you know which method in `DraweeController` is causing the suspicious CPU usage? Or did you just see that the overall CPU usage is large?

Have you verified that the fragment is getting properly disposed when it's no longer on screen? Also, does the `GifTextView` get properly detached/closed? In general GIFs are very heavy on CPU.  Please fill out the template.  Hi @zhiyuchao, try using an alternative to the system's loader for native code. For instance, https://github.com/facebook/SoLoader should get you around this issue. Feel free to re-open if this continues to happen.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla. **If you are contributing on behalf of someone else (eg your employer)**, the individual CLA may not be sufficient and your employer may need the corporate CLA signed.

If you have received this in error or have any questions, please contact us at cla@fb.com. Thanks! Please create a new pull request that includes the actual changes. Also we'd ask you to fill out the template in the pull request summary.  Hey @Binxie, have a look at our sample apps that you find in this repository. I can imagine that `samples/zoomable*` is what you are looking for.  What's the image format? Resizing is currently only supported for JPEG, see http://frescolib.org/docs/resizing-rotating.html  Hi @Troll4it, I'm sorry but I don't understand the exact issue here. A code sample and a video of the issue will help us a lot. Hi @Troll4it, I think that the translation software that you are using fails to translate your issue into something that I can work on.

I get that it has something to do with RecyclerView and some loading (not) happening when elements return onto screen. I'd suggest you double check your code and also compare it to our sample implementation here: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java As @lambdapioneer mentioned, I guess the issue is related to your RecyclerView usage. He linked to an example which shows how to use it correctly. If you modify the visibility of the view (e.g. by calling `setVisible(...)`), it could be that the image is not updated correctly since Fresco considers that when fetching images. It could also be that your implementation does not invalidate the correct view once the image is loaded. If you have a custom view, you'd have to correctly implement your custom view (see http://frescolib.org/docs/writing-custom-views.html) for this to work.  Sorry, you would need to provide a lot more details for us to help at all.

If things were working before, I suggest looking at how your old and new servers behave differently. Closing this as we don't have enough information to investigate the problem.
Please comment on this ticket providing more information and we will reopen the task.
Thanks!  Hi @yuehongwei !

What is the content of loading_animation.xml?  Thanks @yuehongwei ! I can reproduce the problem in the sample app using the animated drawable.

No, gifs are not supported as drawables @yuehongwei , please try the following to start the animation:

```
GenericDraweeHierarchyBuilder builder = new GenericDraweeHierarchyBuilder(getResources());
    AnimationDrawable drawable =
        (AnimationDrawable) getResources().getDrawable(R.drawable.placholder);
    builder.setPlaceholderImage(drawable);
    simpleDraweeView.setHierarchy(builder.build());
    drawable.start();
    simpleDraweeView.setImageURI(URI);
``` Closing this since the workaround should be enough to cover this use case.  Hi @aakashshah94!

Does this happen often? Can you reproduce the problem yourself?
Also, what does your app do? Is it showing a lot of images at once, and are the images large? OK, I would recommend that you try to capture a memory dump at a point a little bit before you get the crash. You can find some information on how to do so from Android Studio here: https://developer.android.com/studio/profile/am-hprof.html Closing as there is nothing further to be investigated on our side.  @erikandre has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5199235).  Hi @orenklein!

Thanks for submitting the bug report. Please feel free to submit a Pull request with updated docs :) Awesome! Thank you very much @orenklein  :) ðŸ‘   It's crashing because you have to hold on to the `CloseableReference<Bitmap> reference` until you are done displaying the image and manually call `CloseableReference.closeSafely(reference)` once you are done. If you take a look at the[ JavaDoc for `BaseBitmapDataSubscriber`](https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/imagepipeline/src/main/java/com/facebook/imagepipeline/datasource/BaseBitmapDataSubscriber.java#L71) you see that the bitmap will be freed. That's why you see the crash.

 See http://frescolib.org/docs/using-image-pipeline.html, http://frescolib.org/docs/datasources-datasubscribers.html and http://frescolib.org/docs/closeable-references.html  Hi @thomas-le-bihan!

If you run the same code on other versions of Android, does it work properly for you? Are you using a post processor to modify the loaded image? OK, I just tried to reproduce the issue but I am getting the onFinalImageSet() callback the first time as well. Running it in a Android 7.0 Genymotion instance so not quite the same as a Galax S6 though.

Could you share some of your code for loading the image and setting up the ControllerListener? I guess it works if you set the visibility to visible from the beginning? The controller will be detached when the image is invisible since you generally don't want to waste loading images when the view is not visible in the first place.

Code where this happens: https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/view/DraweeHolder.java#L144 Well, you're basically doing prefetching, so you can use the pipeline directly to schedule the prefetch as suggested here: http://frescolib.org/docs/using-image-pipeline.html Yeah, I think you can either use the pipeline to request the image like for prefetching and then show the view with a listener there or extend `SimpleDraweeView` to ignore visibility changes and load the image anyway. Glad to see that you could resolve the issue.  Hi! Please fill in the template for new issues. We need more information. I've recently updated touch handling for [ZoomableDraweeView](https://github.com/facebook/fresco/blob/master/samples/zoomable/src/main/java/com/facebook/samples/zoomable/ZoomableDraweeView.java). Do you still see the issue?  We are doing manual memory management for Bitmaps. If you're using DraweeView, the memory will be released when the drawee is detached from the current window and if nothing else holds on to the bitmap. If something holds on to the views, this might not work correctly. If you're using the pipeline directly, you have to do this manually.  `ImageRequest.setCacheChoice(CacheChoice.SMALL)` should work. See for example https://github.com/facebook/fresco/blob/3d1e9ea532336975a5b39c2f8b5945a8d533640f/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imagepipeline/MediaVariationsFragment.java#L212  There are many similar issues, see https://github.com/facebook/fresco/search?q=NativeMemoryChunk&type=Issues&utf8=%E2%9C%93 Using SoLoader or ReLinker should fix this issue. More info for example in #1724, #1738, #1723, #933.  @PalDhv, thanks for the issue. The white border seems to be just outside the `SimpleDraweeView, id=profile_image`. Is there any other container wrapping around it and/or is it just happening for (that) GIF images?

Would be great if you can the part of the layout file that contains both views. Then I can try to reproduce it locally. If it also just happens for certain images, those would be helpful as well. Can you post a working minimal example so that we can reproduce this? For example, by modifying [`DraweeSimpleFragment`](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeSimpleFragment.java)? I suppose this issue has been resolved. Let us know if you're still experiencing problems.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! ðŸ‘  let's merge this as well then @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5138764).  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Thanks @Armaxis for fixing this! I'll merge it ðŸ‘  @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5133968). A new branch and PR is likely to be the easiest way :)   Duplicate of #1445  Thanks @Gericop for the detailed issue. Can you also print the relevant error message output from logcat? #1176 describes why this is currently not working. However, for now you can set the drawable in Java and it should work. I don't think we can easily change the inflater to use `AppCompatResources` since the whole library would have to depend on `AppCompatResources` otherwise. Another solution would be to extend `SimpleDraweeView` and inflate the placeholder manually using `AppCompatResources`.  Can you provide a stacktrace and your image pipeline config? From the URL alone we won't be able to help. @qbaowei You said in the original issue that the app crashed. If so, I would expect you to see a crash in Logcat.  Thanks for these. I'm just curious, are you actually using Volley as the backend for drawee? @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5095422). Fantastic. Thanks @YkSix, we appreciate that.  @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5095445).  @YkSix updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1775/files/99bcb65d110f2da8f090a30f8e6744896dbaacc1..c373ef0e78cfc7d445f3a4524aa3b2d33f0318db) @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5095502).  Hi @sohayb, you want your call into JNI look something like this in order to make sure the references are not closed while your code is executing:

```java
// increases the reference counter by 1
CloseableReference myJniRef = CloseableReference.cloneOrNull(rightImageRef);
try {
    jniFunctionCall(myJniRef.get());
} finally {
    // decreases reference counter by 1
    CloseableReference.closeSafely(myJniRef);
}
```

Your life probably would be easier though if you are using a post-processor and let the pipeline do the lifecycle handling for you (and you also get caching of the final result).

Docs: http://frescolib.org/docs/modifying-image.html
Example: https://github.com/facebook/fresco/blob/6ed61d352548f2462337a4af9841c3d050d9cabb/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/postprocessor/ScalingBlurPostprocessor.java  This is strange and I'm inclined to suggest it's a problem with the shrinker, which I note is still [referred to as "experimental" in the docs](https://developer.android.com/studio/build/shrink-code.html#gradle-shrinker).

The class `AnimatedFactoryImpl` is annotated `@DoNotStrip` because it is instantiated by reflection and your stack trace suggests it has not been removed. However, `AnimatedDrawableFactoryImpl` is referenced directly within that class and has been stripped.

This suggests to me that the `@DoNotStrip` is being honoured but that the shrinker doesn't ensure it keeps everything referenced in such classes. I'm closing this issue as I believe the issue lies with the experimental shrinker.  Hey @WTree, can you please provide some more information for this? In general it would be helpful to see the related code or have a minimal repro. Does this show in the sample apps that we provide?  I can see you're using Proguard.

Take a look at the [Using Proguard](http://frescolib.org/docs/proguard.html) section of the docs to see how to avoid stripping that and other classes. @dongorigin Is it just that one particular device or all devices with that configuration?  The low-res image is only loaded from cache if the full image isn't already available. It won't be loaded from the network as that would mean two images being requested when only one is needed. @lushan1314 If you have two different image requests you can give them priorities. See the corresponding method in the image request builder.

For multiple images for the same entity see also http://frescolib.org/docs/requesting-multiple-images.html @lushan1314 There's no way to set a transition. The idea is that the two images should represent the same image just at different resolutions, so that you shouldn't notice the switch other than the image getting clearer.
  The solution is given in #1695.  That simple network fetcher converts a `Uri` into a `URL` for the `HttpURLConnection` API and calls `Uri.toString()`, which doesn't URL-encode as needed.

I have three suggestions.

1) You could try using the `OkHttpNetworkFetcher` and see if that works better. [Instructions here](http://frescolib.org/docs/using-other-network-layers.html#using-okhttp).
2) You could send us a pull request that fixes the [translation in `HttpUrlConnection`](https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/HttpUrlConnectionNetworkFetcher.java#L136).
3) You could simply ensure your URIs are url-encoded before the `ImageRequest` is built. Closing, if the none of the 3 suggested solutions worked out then please comment here and we can reopen the issue.  Use SoLoader or ReLinker to increase robustness of the native library loading.

This have been covered several times before, see #1336, #1005, #410  And the workaround you probably need is in #1695.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5060736).  Duplicate of #1144.  @kirwan can you take a look here, since you're more familiar with media variations? @erikandre just pushed 513fdf32ebb521fc7905b468f72f5f7f36b2af2f which touches some of the same methods. It was attempting to fix a slightly different problem though and I can still reproduce your problem.

We've made a change to the Consumer API so that they now receive an int containing multiple status flags and that may be useful to fix this issue too. A placeholder from the `MediaVariationsFallbackProducer` will now include `IS_PLACEHOLDER`. I wonder if that helps you with this. For non-JPEGs we can initiate decoding only if either `IS_LAST` or `IS_PLACEHOLDER` is et.

@FtheGFW: Do you want to take another look at this?  Can you post a link to the file you're trying to display? It looks like the image probably isn't a JPEG. I've found a simple fix we can add to that producer. We already had a report of this in #1558. I'm going to reopen that issue and produce the fix.  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  What version of Fresco are you using? There are many similar issues, see https://github.com/facebook/fresco/search?q=NativeMemoryChunk&type=Issues&utf8=%E2%9C%93  You can use `onUltimateProducerReached`, which was added by f16d725. This callback will let you know which producer ultimately returned the image, so you will have to check if it's the memory cache producer, disk cache producer etc. However, for some reason this doesn't show up in javadocs yet, but it should be present in 1.3.0.  Thanks @ChrisCraik for raising this. We're taking a look. Hey @ChrisCraik, I've landed the changes in https://github.com/facebook/fresco/commit/b9f6fdbc9b02971c7ef99bd4ceec7a48f8c196c7 and related. They will go into the next release.

I've verified in systrace that the bitmaps now upload asynchronously on Android N:

![screen shot 2017-05-22 at 11 44 25 am](https://cloud.githubusercontent.com/assets/908387/26419569/fca0b1f4-4074-11e7-9bed-a0766eafe7da.png)

It's currently behind an experiment flag for now, but I'll make it default to `true` once verified with our apps. The fellow reader can look at https://github.com/facebook/fresco/commit/337e140f635aeb7fc2792acd043ec13979ad711a for how to enable this already in your application. Now released in [v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0).  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Would you mind posting the contents of `FlagImageView.java`, or just the constructor? It's hard to tell what's going on without looking at the code.

Just guessing however, this doesn't look like a problem with `DraweeView`, as the exception actually happens in `ImageView`'s constructor (which `DraweeView` extends). I took a quick look at the [source for the Android `View` class](https://android.googlesource.com/platform/frameworks/base/+/android-5.1.1_r38/core/java/android/view/View.java) and it looks like line 3738 from your stack trace points to a problem loading the background drawable.

I'm closing this as I don't think it points to a problem in Fresco but if you find something else please comment and we can reopen if necessary.  That looks mostly correct, just a couple of things to check:

1. Have you correctly set your application classname in `AndroidManifest.xml`? To verify this, you can add a log message in `Application#onCreate()` and make sure it shows up.
2. Is there anything relevant in logcat? Ok, two more things to check:

1. `setProgressiveRenderingEnabled` is only needed for progressive JPEG images. You shouldn't use it with gifs, but I doubt this is causing problems
2. Can you post some of the URLs you're trying, so I can check them on my end? Closing as we need more information to proceed. Please reopen if anything changed. Thanks!  This is by design. If you really want to get rid of it, you can set a controller listener and remove it when the final image is set. See the docs here:

http://frescolib.org/docs/listening-download-events.html `setPlaceholderImage(null)` for the hierarchy should work, see http://frescolib.org/docs/drawee-branches.html#Placeholder @fanzhouyou the placeholder image might still be in one of our caches (e.g. the BitmapCache). We do this in order to be able to quickly re-use its bitmap without having to allocate a new one. Also if you use it then again, we can potentially skip the decoding step.

Let me know if that solved the question for you :)  You should find they are cached, but against the original URL you requested. Assuming the URL you request is still the original one, the caching should work as expected.

You could implement your own CacheKeyFactory to build on this if necessary. Can you share a snippet of code where you're setting the image request?

My suspicion is that it's unrelated to the redirect and you need to ensure you're [reusing the old drawee controller](http://frescolib.org/docs/using-controllerbuilder.html#building-a-draweecontroller) as that's how we avoid this kind of flash. I don't see anything wrong with this, so it's curious the image flashes.

If the image is loaded from disk cache there can still be a brief delay while the file is loaded and the image is decoded.

Does the flash happen after the image has already been loaded in the activity (i.e. when it should be in bitmap cache)?

You can [enable logging](http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat) to see how the request passes through the image pipeline in more detail. I'm closing this issue due to inactivity. If this is still a problem, let us know!

  Scaling: If you don't use a DraweeView, you have to perform the scaling yourself. For example, do something similar with Matrix operations like we do in DraweeView and ScaleType.

Crashes: You should not use `BaseBitmapDataSubscriber` to get the bitmap since the bitmap will be closed right after `onNewResultImpl`, which causes the crash. See also #1550.

You should use a DraweeView instead if possible. Also, for the blurring step you should use a `Postprocessor` and we also have blurring postprocessors in the `showcase` sample app.   Fresco now supports custom image formats, decoders, and drawable factories, which allows to add support for APNG.

Example for SVG: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg/SvgDecoderExample.java

Pull requests are welcome :) Closing as we are not planning to implement this feature. Pull requests are still welcome!  What do you mean with `setProgress` is not called? If you add a `ControllerListener`, you should see intermediate image calls for the first scans and the final image call once everything is available and has been decoded.

There is also an example here that lists all scans when they are rendered:

https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/pjpeg/ImageFormatProgressiveJpegFragment.java Thanks, I was able to repro the issue by modifying our Showcase sample app. No idea why this happens yet.

ShowcaseApplication.java:
```java
...
    HttpLoggingInterceptor interceptor = new HttpLoggingInterceptor();
    interceptor.setLevel(HttpLoggingInterceptor.Level.BODY);

    OkHttpClient okHttpClient = new OkHttpClient.Builder()
        .addNetworkInterceptor(interceptor)
        .build();

    ImagePipelineConfig imagePipelineConfig = OkHttpImagePipelineConfigFactory.newBuilder(this, okHttpClient)
        .setRequestListeners(listeners)
        ...
        .build();
...
 I just added some logging to Fresco's [`NetworkFetchProducer`](https://github.com/facebook/fresco/blob/96636983b195cb985db36a7dc2eb7ef13f59a44b/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/NetworkFetchProducer.java#L105) that triggers progress updates. When your interceptor is added, the network fetch producer is not updated until the very end, when it suddenly gets all previous progress updates, so I guess the issue here is the listener holds back the data until the whole message is available to be able to log the whole message.

Seems like something to fix on the OkHttp side :)

If you think this is a Fresco issue, let us know and we can re-open this.  Do you use APK splits? Does this still happen with newer versions of Fresco? I assume the problem has been resolved. If not, please let us know. Hi @huanting, does this reproduce on those devices when you compile and run the showcase app from our repository?

If not, can you post the `build.gradle` file of your app? The upcoming release of Fresco switches from using SoLoaderShim to SoLoader.
Hopefully this will resolve this issue. If not, please file a new issue or comment here so that this one can be reopened. Thanks!  Can you please fill in the issue template? We need additional information. I assume the problem has been resolved. If not, please let us know.  Unfortunately this is currently not supported @amodkanthe, you have to specify both the width and height. Similarly, Fresco also does not support `wrap_content`. More information on this topic can be found here: http://frescolib.org/docs/wrap-content.html Closing as this is not a prioritized feature for the near future.  What exactly do you mean by "the result resolution is less than the original"? What did you expect to see and what actually happened (see also the template we provide for issues)?

Can you provide some example code and point to what is not working as expected? Please ask on StackOverflow if you're still having issues.  Same as #1724, #1738, #1723 and, ultimately, #933. Please check those issues for potential fixes.  Assigning to @oprisnik as the resident gif master. Thanks for the bug report @venik. We'll take a look! I've fixed the issue in f7487d1153461e654695ef6d20c1295cfceaca69, will be included in the next release.  Hi @davidpfahler !

Could you please give us the stack trace as well? Thanks! @davidpfahler You've hit a breaking change I'm afraid, rather than a regression.

I presume you have an implementation of `ProducerListener` or `RequestListener`, in which case you need to implement one new method. I assume this is in your code because the only listener within React Native extends `BaseRequestListener` which has a no-op implementation to avoid this problem.

I've updated the [release notes for 1.3.0](https://github.com/facebook/fresco/releases/tag/v1.3.0) to make this clearer. I assume the problem has been resolved. If not, please let us know. @wwf7758258 Looks like your problem is that the versions for the different Fresco modules do not match (you are using 1.3.0 for Fresco and 1.2.0 for the animated-gif and other modules).
Please change all of them to use the same version, and I would also recommend that you don't use: 

`compile "com...react-native:+"`

to include react native but instead specify exactly which version you want. Otherwise things can easily break when they release a new version, even without you modifying your app.
  Hi @zhej,

Thanks for submitting the bug report. In general, extracting a preview thumbnail from a video will be slower than opening a jpeg. That is expected.

Once the thumbnail has been cached, is it still very slow?
If possible you might want to preload thumbnails beforehand.

Thanks again and sorry for the late reply! I'm closing this issue due to inactivity. If this is still a problem, let us know!  Rounding animated images is only supported using the overlay color rounding mode. See for example #168  Hi @vivienhao 

1. Is this crash reproducible?
2. What device does it occur on?


 There are many similar issues, see https://github.com/facebook/fresco/search?q=NativeMemoryChunk&type=Issues&utf8=%E2%9C%93  Thank you very much for the PR @angarron. We'll take a look soon :) Sample code is here: 6ee00684cec93418c8b71e9285d30026c496d3cd Great to hear that it worked :)  Thank you for your pull request. We require contributors to sign our Contributor License Agreement, and yours has expired.

Before we can review or merge your code, **we need you to email cla@fb.com** with your details so we can update your status. I'm closing our old PRs from internal people. We may still pursue this but right now this is just stale.  @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1735/files/ff3be1a03c30fc5d8ea521288c4058bc9ebbacbd..b11518523949439149991a2c6742cd9e1359161a) Thank you for your pull request. We require contributors to sign our Contributor License Agreement, and yours has expired.

Before we can review or merge your code, **we need you to email cla@fb.com** with your details so we can update your status.  Hi @pkubuding,

Fresco does not support resuming failed downloads like in the case you described. You could achieve something similar by implementing a custom NetworkFetcher that would handle resuming the request.  Hi @BennyTian! 

What does your gradle config look like, for including Fresco and related libraries? No problem @BennyTian ! I'm glad it worked out :)  Hi @coutliuxing !

Please make sure that you are using the same version for all the Fresco imports, also use explicit versions (1.3.0 instead of + or 1+). In your case you got Fresco 1.0.1 but Fresco animated GIF 1.3.0. Ok, there are two things you might want to check

1. If you are using proguard or dexguard, make sure that you are using the correct config: http://frescolib.org/docs/proguard.html
2. Check logcat logs while the app is installing, if some class is discarded during preverification then there should be an error or warning.

Btw. Is this an app that is big enough that is is using multidex? @coutliuxing, I just tried out your project and I got it to run and play the GIF animation.

I did have to change build.gradle though as the project did not build otherwise. It looks like maybe some files were missing in the zip file you attached?

Anyways, here is the gradle file after my changes (which should not be related to the error you are seeing).

```
buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:2.3.1'
    }
}

apply plugin: 'com.android.application'

android {
    compileSdkVersion 25
    buildToolsVersion "25.0.2"

    defaultConfig {
        applicationId "inavr.fresco"
        minSdkVersion 16
        targetSdkVersion 25
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"

    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
    repositories {
        mavenLocal()
        jcenter()
        mavenCentral()
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
//    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {
//        exclude group: 'com.android.support', module: 'support-annotations'
//        exclude group: 'com.google.code.findbugs', module: 'jsr305'
//    })
    compile 'com.android.support:appcompat-v7:25.3.1'
//    compile 'com.android.support.constraint:constraint-layout:1.0.2'
//    testCompile 'junit:junit:4.12'
//    compile 'com.facebook.fresco:imagepipeline-okhttp3:+'


    compile 'com.facebook.fresco:fresco:1.3.0'
    compile 'com.facebook.fresco:animated-gif:1.3.0'

//    compile 'com.facebook.fresco:fresco:1.0.1'
//    compile 'com.facebook.fresco:animated-gif:1.0.1'
}
``` I think the later problem is an incompatibility between the current version of Fresco and that used by React Native, [which is still 1.0.1](https://github.com/facebook/react-native/blob/0a712f5335d1bf04c4ff93a79b14c9e23dbd5831/ReactAndroid/src/main/libraries/fresco/fresco-react-native/BUCK).

Fresco 1.3 introduced a breaking change to the `ProducerListener` listener and [the necessary change to the `SystraceRequestListener` class](https://github.com/facebook/react-native/commit/01a0e1002633021aafcb69fd2c10f1e893fb2dd8) was included in React Native 0.44.0 but earlier versions would be incompatible with Fresco 1.3.

If you need React Native to be upgraded to the latest version of Fresco you could raise an issue or PR on that project. Yeah, please make sure that React Native and Fresco have the same version to keep everything in sync.  Hi @Lee-Wang-Jing 
the OOM could be caused by a leak in some other part of the code and be thrown by the Bitmap allocation because Bitmap objects are usually big. Have you tested you application with some memory specific tools? 
Thankx If this is a reproducible crash I would recommend to capture a memory dump right before the crash occurs. That should reveal what is holding onto the memory.  Sorry for the delay in response.

Is there no way to avoid the duplication? If not, I think it would be better to skip all the comments second time around and just include them in a single, large block. They're already documented within `GenericDraweeHierarchy`. @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D5423468). I'm importing this so it can be included in our imminent release. I'll remove the extraneous comments though.  @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/8886d5643b9601cece6d5b68809dcd724216f680..74f36265e16e7ef788cab65bb0eab50f6a0d9611) @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/74f36265e16e7ef788cab65bb0eab50f6a0d9611..cdb22ada66f5665aea928aa46d710572a794539e) @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/cdb22ada66f5665aea928aa46d710572a794539e..c0439e5c1b18ad54e1f61a80c419c8ce67c819e0) @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/c0439e5c1b18ad54e1f61a80c419c8ce67c819e0..defc4048fc56e45a98c6ec3447c41549747e28b8) @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/defc4048fc56e45a98c6ec3447c41549747e28b8..00f9053b48d56decc40e04e0b15f2ec9803f30b3) @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1728/files/00f9053b48d56decc40e04e0b15f2ec9803f30b3..6e81c70cd496e43ca8cd288ccfcff90406a5c70a) @oprisnik has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4948097).  Hi @yihuaqi,
this is interesting.  This is because the DataSource has been designed in order to provide the reference to the image without waiting for the image into the file system. A think you can try is to use a `CacheEventListener` which has the `onWriteSuccess()` method. You can set it using the `DiskCacheConfig` object. 
Anyway we suggest to make a second request because accessing the file system for the image is not the preferred solution. 
Thankx Closing as the original issue was addressed. @letronje Yes, that sounds reasonable. If you need further assistance, please create a new issue (since reusing old ones makes things a bit messy). Thanks!  Hi @MinJiLiu 
we'll have a look.
Thanks How are you cloning the bitmap and using it? I suspect that the underlying bitmap is closed. I think the issue here is that you re-attach the imageView, which will result in the bitmap being closed for the detach event and re-attaching causes the recycled bitmap to be drawn, which throws the exception. You have to correctly handle closeable references as described in http://frescolib.org/docs/closeable-references.html  Hi @ganshenml,
I've just double checked the code and the `ControllerListener` callback works perfectly. Have you tried putting  breakpoint into the callback methods? Probably something wring in the way you check the log.
Thanks
  This is related to #1723. So I'm closing this issue keeping open the previous.  Hi @sangchengjiang
using try/catch doesn't fix the problem because you avoid the crash but the library is not loaded anyway. Have you tried the solution here #933?
Thankx As suggested, we recommend using https://github.com/facebook/SoLoader to fix these kind of crashes. If that does not work, please comment here and we can reopen the issue.  Thanks for fixing this! Will land this now :) @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4906126).  @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1720/files/9fbb7a3527171c2acd67ff1c935bafd42a112248..75b1b291812eba595b530183cf29e0eb34c84d76) Cool, didn't know lorempixel.com before. I think it's fine since we are able to revert it back in case that service shuts down for any reason. @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4875561).  Like it! @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4875507).  Hi @nesterov-n, I've tried to reproduce your fix, but it does not work in Android Studio (v2.3) for me. With which one have you tested it?  @erikandre I think you did the last release and I think I recall you hitting some issues with these annotations as well. Can you take a look? @shaunkawano what happens if you just tell proguard to keep those two classes? These annotations are only used by infer, so at lint time. They are not used at runtime at all. I think `-dontwarn` should be fine. I'll add this to the docs. Thanks! Wait, looks like infer classes should already have `-dontwarn`, according to [proguard-fresco.pro](https://raw.githubusercontent.com/facebook/fresco/master/proguard-fresco.pro). @shaunkawano did you follow the [proguard doc](http://frescolib.org/docs/proguard.html)? `consumerProguardFiles` sounds useful, we'll look into it. PRs are also welcome ;)  @foghina has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4787195).  @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1714/files/95fee72b760a1f8eb7732c1daf4012c1f8a31dea..76575297f278d458b3afc077a6ce516b4b99c927) @foghina has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4787659). @mkonicek has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4787659). @mkonicek updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1714/files/76575297f278d458b3afc077a6ce516b4b99c927..7237652e1079a03f6a221aee8dc8cf6871e4f72b) - [changes since last import](https://github.com/facebook/fresco/pull/1714/files/76575297f278d458b3afc077a6ce516b4b99c927..7237652e1079a03f6a221aee8dc8cf6871e4f72b) @mkonicek is land not working? Do you want me to try again? @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4787659).  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  See #1552, #192 or a [quick search for `UnsatisfiedLinkError`](https://github.com/facebook/fresco/search?q=UnsatisfiedLinkError&type=Issues&utf8=%E2%9C%93)  Using ReLinker should fix this issue. See #1336, #1005, #410  You're right, unless you've written your own network fetcher priorities don't have an effect. Internally we use a network layer which does support these but OkHttp doesn't at this time.

See https://github.com/square/okhttp/issues/1361

I'll update our docs to make this point clear.  Hi @raylee4204 ,
I don't think this is related to Fresco which, with what you say, into another Activity. Please double check when you invoke the 
`getWindow().setBackgroundColor(R.color.grey).`
code into the first activity. 
Thankx Hi @raylee4204! Just to confirm something. If you remove this line:

`hierarchy.setPlaceholderImage(R.color.grey);`

Does the problem go away?
 OK, then it's starting to make sense. I tried reproducing the problem myself but haven't succeeded yet. 

You mentioned that you are using getWindow().setBackgroundColor() from the activity. Do you mean getWindow().setBackgroundDrawableResource()? 

In any case, could you try setting the background color this way instead:

`setBackgroundDrawable(getResources().getDrawable(R.color. grey).mutate());` Closing this as we've been unable to reproduce the issue.  Do you have a more concrete repo for this? We have a `DraweeSpan` sample in our Showcase sample app here: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeSpanSimpleTextFragment.java

Can you repro the issue there?  Self-creating an issue to track this.

@FtheGFW raised PR #1630 to fix this but it involved changes to the `ProgressiveJpegParser`. We shouldn't get into that class if we're not decoding a jpeg. This comes from the previous assumption that non-final images would always be progressive jpegs. Yes, it just missed 1.2.0 but another release will follow soon.  Thanks for the report @xjy2061. Do you have an example GIF that crashes? I've fixed the issue in bcbe1c57f2d95be6f3827bf5f5a5a38cea5fec12. Thanks!  Can you please aks the question in English? Google translate doesn't really translate your issue well. Something related to placeholders? I guess this is a duplicate of #480 then. Let me know if that's not the case and I'll re-open this issue.  See #1552, #192 or a [quick search for `UnsatisfiedLinkError`](https://github.com/facebook/fresco/search?q=UnsatisfiedLinkError&type=Issues&utf8=%E2%9C%93)  I guess some of your Gradle dependencies got mixed up. We removed `forceOldAnimationCode`. Try and clean/rebuild your project See also #1660  Thanks for raising these issues, which are both part of media variations still being in development.

I'm looking at them both now and they should be resolved very soon.  Hi @nucleartip , thanks for submitting the bug report!

Have you tried capturing a memory dump before the OOM occurs to see what is using all the memory?

By the way, for Lollipop and above you are using maxCacheEntrySize=1, is this an attempt to completely disable memory cache or just limit it to a single item? @nucleartip , would it be possible for you to share that memory dump with me? @nucleartip Either one would work fine :) Closing this as we don't have enough information to go on to continue the investigation.
For any other Out of Memory issue, please create a new task and preferably include a HPROF memory dump.  Hi @notice501 !

Thank you for submitting the bug report. I managed to reproduce the issue using the provided URL.

I do notice that there seems to be something a bit odd with that WEBP file. When loaded in Chrome (on desktop and mobile) the transparency does not work correctly until the animation has looped once.

I can not reproduce this issue when trying to play other animated WEBP files, so I'm thinking that it might be an issue with the file itself. It might be a good idea to try different tools or different settings when exporting the animation (like trying to export it without alpha to see if the glitch is still there). There are a couple of interesting options you could try experimenting with. For example the "-bgcolor A,R,G,B" option (try setting a background with no alpha) or the options related to the dispose method for each frame. @notice501 , I suspect it could be an issue in `libwebp` since that is where the actual animation is handled. We are currently a bit behind the latest version of this library so there is always a chance that upgrading could resolve it. This will require quite a bit of testing though, so it's not something that will happen in the very short term. @UFreedom The next release of Fresco will contain an updated version of libwebp (0.6.0), hopefully this will resolve this problem. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs that is way more performant, especially in the case where you display multiple images. Let us know if you're still experiencing problems with 1.4.0. Thanks! Great to hear that it works now!  Hi @mappy-mobile!

If you want Fresco to resize the image you need to pass in the desired width and height into the ResizeOptions(), like this:

```
int width = 50, height = 50;
ImageRequest request = ImageRequestBuilder.newBuilderWithSource(uri)
    .setResizeOptions(new ResizeOptions(width, height))
    .build();
```
More information about this can be found [here](http://frescolib.org/docs/resizing-rotating.html) Yes. If you are using Fresco to load an remote image (not a local resource) we are not doing any kind of resizing if you don't specify it explicitly. It's not really related to the density of the device since that only applies if the image you are loading has associated information about what density it was designed for (as is the case for local resources like in the example you mention: `ContextCompat.getDrawable(mContext,R.drawable.image)`). An alternative if you're using a DraweeView is using a scale type (which should be fine if the image dimensions are similar): http://frescolib.org/docs/scaling.html

If the dimensions differ by a lot, you would ideally request different images with suitable dimensions from the server to reduce network usage (if the server image is larger) or/and use resizing as @erikandre  described. I don't understand. You have a DraweeView on the client that is AxB dp wide. You then request an image from the server that is also AxB dp (converted to pixels) - so everything should be fine. If you only have larger images, you can supply resize options to resize the image.
If the image is too small or too large, you can also simply use a[ ScaleType](http://frescolib.org/docs/scaling.html) that suits your needs. It is not clear what the issue is, so closing until more information is provided.  Hi @WTree!

Thank you for submitting the bug report.

I tried (and failed) to reproduce this on both an Android 7.0 device and Genymotion.
Could you please provide some additional information to help us investigate the issue?

Either a more detailed step by step or code sample would be very helpful. Thanks!
Also, to be clear, is it a GIF you are loading or some other form of animated image? OK, that's good :)

At what point are you calling .start()? Are you using a ControllerListener to get hold of the Animatable after it has been loaded? (like described here: http://frescolib.org/docs/animations.html) You shouldn't use a fixed delay. A `ControllerListener` is the way to go :) See also #1697  The animatable will be null until the final image has been set. You can use a ControllerListener instead, see http://frescolib.org/docs/animations.html  Hi @xiaoyao27610 ! 

Thank you for submitting the issue. Is this crash reproducible? Does it occur on other devices besides the Vivo Y913?  Thank you for the bug report!

We've simplified the GIF decoding logic in 5ae014e00f571980c661ad553a853755d2ed37ce. This unifies GIF handling for static and animated GIFs - which breaks rounding as you've noticed since it's not supported for animated images in general.

There's a simple fix: You can force static decoding for GIFs with

```java
ImageDecodeOptions imageDecodeOptions = new ImageDecodeOptionsBuilder()
    .setForceStaticImage(true)
    .build();
ImageRequest request =ImageRequestBuilder.newBuilderWith...
    .setImageDecodeOptions(imageDecodeOptionsWithCustomDecoder)
    .build();
... // set the image request
``` Out of curiosity: Why do you use static GIFs?  Play progress: This is currently not possible. We're working on improving these APIs though.
Ready progress: A ControllerListener can be used according to http://frescolib.org/docs/animations.html We've released Fresco 1.4.0 with a completely new animation implementation.
In order to get the current animation duration you can use a controller listener to get the animation start time and subtract it from the current time. Something like

```
new BaseControllerListener(){
            @Override
            public void onFinalImageSet(String id, @Nullable Object imageInfo, @Nullable Animatable animatable) {
                if (animatable != null) {
                    AnimatedDrawable2 ad2 = (AnimatedDrawable2) animatable;
                    long startTimeMs = ad2.getStartTimeMs();
                    long animationTimeMs = SystemClock.uptimeMillis() - startTimeMs;
                }
            }
        }
``` You can also set an [animation listener](https://github.com/facebook/fresco/blob/master/animated-drawable/src/main/java/com/facebook/fresco/animation/drawable/AnimationListener.java) to get notified about these events.

You can use a `ControllerListener` to attach the `AnimationListener`:
```
Fresco.newDraweeControllerBuilder()
      .setImageRequest(imageRequest)
      .setAutoPlayAnimations(true)
      .setControllerListener(
              new BaseControllerListener() {
                  @Override
                  public void onFinalImageSet(
                          String id, 
                          @Nullable Object imageInfo, 
                          @Nullable Animatable animatable) {
                      if (animatable != null) {
                          AnimatedDrawable2 animatedDrawable = (AnimatedDrawable2) animatable;
                          animatedDrawable.setAnimationListener(yourAnimationListener);
                      }
                  }
              })
      .build()
```  @paour, thanks for fixing this! @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4666017).  @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/73231fd4f0a3ba756d93bc6b338fbaf9ae21842f..5eb3f301c1dcbb39dbe43c3e27fcb82aa89c4adb) @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/5eb3f301c1dcbb39dbe43c3e27fcb82aa89c4adb..a51bdb5fb7e9d90f66d05261bd2f599c7e2e302e) @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/a51bdb5fb7e9d90f66d05261bd2f599c7e2e302e..f8991b77bf318b8cccf53c6f07d0e4cfc7797abf) @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/f8991b77bf318b8cccf53c6f07d0e4cfc7797abf..93bf4c6e8b351ad8ddbf24ff03b70725c33209c2) @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/93bf4c6e8b351ad8ddbf24ff03b70725c33209c2..4cb2f0ee266e6e96aa12f346b99cba650f3768bc) @desmond1121 updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1691/files/4cb2f0ee266e6e96aa12f346b99cba650f3768bc..96386a48bbfcbfc4322b1a7736d00fdc494a67bb) @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4819516). As the other pull request was reverted, I'm going to close this too. Thanks for the contribution though @desmond1121.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Thank you! :) @oprisnik has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4762042).  Yes, that is correct. The `AnimatedDrawableBackend` will be recreated if the bounds of the underlying container are changed (see [here](https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/animated-base/src/main/java/com/facebook/imagepipeline/animated/base/AnimatedDrawableBackend.java#L138)) since we need to know the render dimensions for the bitmap size.

However, in the future, it should be possible to keep the initial render dimensions and scale the bitmaps. Right now, this is not supported.

I'm curious, what's the actual use case for this? We don't have a timeframe if / when we will have time for this, but we've just released Fresco v1.4.0 with a new animation implementation that might have mitigated your issues already and you might not need GIF resizing. Do you still experience these issues with 1.4.0?

Pull requests are welcome :)  Can you please make clear what the reproduction is showing? I don't see from the XML anything that's obviously wrong in the image, depending on where the red/white portion is drawn from.

Is the red/white a view behind the drawee view or the image itself?
Has the image loaded at this point?

It might be more useful to see an image showing a photo within the drawee view. And also the Java code you're using to populate the image itself. I assume this issue has been resolved. Let us know if that is not the case.  Can you provide more information and code showing how you use Fresco within your RecyclerView?

What you said about cropping might explain it though (if you mean resizing) as Glide downsamples automatically. @beraybentesen The key difference here I think is that Glide automatically downscales images to the size needed for the view. It slightly delays the request if necessary until that's known.

Fresco doesn't currently do this, though I think there's a strong case to add similar functionality. That's why you currently need to explicitly set `ResizeOptions` if you're loading a larger image than you need for the view. Closing as this is the expected behaviour when not using ResizeOptions to control the final bitmap size.  Cool, looks good - I'll import it. Can you perhaps add here how you tested that the webp support still works correctly? @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4658508). Hi @desmond1121, since this change increased the APK size if just using core library, I'm going to revert it. We are committed to have a slim Fresco core that has minimal size impact on the developers' apps. Also only 10% of Fresco users download the webp-support package. CC @kirwan  Hi @desmond1121, thanks for raising this issue! Having both projects statically linking against a larger library sounds bad and we should fix this. Your solution sounds good and hopefully there's an easy way to do this.

Definitely looking forward to read your PR! ðŸ‘ Would great to have some numbers on the size win.  Nothing looks obviously wrong from what you've detailed here but I'd be interested where you're setting the URI.

You could compare what you have with the [ReactImageView](https://github.com/facebook/react-native/blob/e1577df1fd70049ce7f288f91f6e2b18d512ff4d/ReactAndroid/src/main/java/com/facebook/react/views/image/ReactImageView.java) class in React Native. Particularly, I'd suggest looking at where they call `maybeUpdateView()` which is where they initiate the request.

Beyond that, you might have more luck asking this question on the React Native project as I don't have much experience of working with that. If you're not using the original DraweeView, you can use the image pipeline directly: http://frescolib.org/docs/using-image-pipeline.html  `GenericDraweeHierarchy` allows you to set your own progress bar `Drawable` so you can position it as you want within the view area.

As for the levels, it's true that the download is all that's used and that isn't ideal for animated GIFs. We actually don't generally use determinate progress bars ourselves though so I don't think we're likely to fix that soon. It's not a trivial fix because most images decode very quickly but animations can take a bit of time.  The view should fade in just like any other image.

Animations go through a different decode path though so it's quite likely there's a timing problem for you here where the first frame is still being decoded when the fade in occurs.

I'm not sure whether this will fix it for you, but you can try setting `ImageDecodeOptions` with the option set to decode the preview frame.  Sorry, I don't quite understand.

Are you saying that the timeout isn't respected or that there are specific images where you want to allow more time? I suspect this would need to be worked out in the OkHttp layer. If you try making a direct request to OkHttp for the same image in those circumstances, do you see the request time out as you expect?

In `OkHttpNetworkFetcher` we provide an implementation of `okhttp3.Callback` which implements both callback methods so if one of those is triggered, the failure should return through the pipeline. Sorry, I closed when I saw @JuHonggang had responded but I'm reopening to see whether @eldk's questions help further. Thanks @eldk for your responses here. It looks like I can close the issue now.

If there are more questions, just reply and we'll re-open.  That definitely shouldn't happen if you're calling `Fresco.initialize()` before creating the drawee.

Can you tell me where the drawee is being created?

My best guess right now is that you're setting the content view in `Activity.oncreate()` before calling `super.onCreate()`, which could result in the application class being initiated too late.

If I'm wrong about that, I'd need more information to help you understand why this has gone wrong.

I'd also suggest adding a Logcat call just before your call to `Fresco.initialize(this)` to verify whether that's called. How are you initializing Fresco? This shouldn't happen. Please make sure that Fresco is initialized correctly. If you're still seeing this crash, let us know with repro steps.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Hi @caojianfeng, thanks for the pull request! Can you update with a comment on how you tested the change? I'll wait with the import until then ðŸ‘  @caojianfeng updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1678/files/c57b05906d4a3b37077a9ffe9176b0eb6fcdde61..76b78e7d38051f0105ef5de270ac5257736be1d8) Done.
The comment had been added. @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4658501). @caojianfeng, can you please update the pull request template?

For getting changes into the code base we require pull-requests to have a test plan. Just update the sections below the **bold** headers. Make sure you test plan compares the old- and new behaviour and can be reproduced. @lambdapioneer , I will write a Demo . The demo will enable StrictMode ,and Will crash with the old lib.
And when you replace the old lib with fixed one ,it will work fine. @lambdapioneer ,
Here is the demo : https://github.com/caojianfeng/FrescoDemo.git
Now it crash as soon as started.
It should show a image list when fixed.
And I had update the test plan . 

```
03-07 00:40:09.160 24551-24560/caojianfeng.frescodemo D/dalvikvm: WAIT_FOR_CONCURRENT_GC blocked 18ms
03-07 00:40:09.170 24551-24560/caojianfeng.frescodemo E/StrictMode: A resource was acquired at attached stack trace but never released. See java.io.Closeable for information on avoiding resource leaks.
                                                                    java.lang.Throwable: Explicit termination method 'end' not called
                                                                        at dalvik.system.CloseGuard.open(CloseGuard.java:184)
                                                                        at java.util.zip.Inflater.<init>(Inflater.java:82)
                                                                        at java.util.zip.GZIPInputStream.<init>(GZIPInputStream.java:96)
                                                                        at java.util.zip.GZIPInputStream.<init>(GZIPInputStream.java:81)
                                                                        at libcore.net.http.HttpEngine.initContentStream(HttpEngine.java:528)
                                                                        at libcore.net.http.HttpEngine.readResponse(HttpEngine.java:836)
                                                                        at libcore.net.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:274)
                                                                        at libcore.net.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:486)
                                                                        at com.facebook.imagepipeline.producers.HttpUrlConnectionNetworkFetcher.downloadFrom(HttpUrlConnectionNetworkFetcher.java:97)
                                                                        at com.facebook.imagepipeline.producers.HttpUrlConnectionNetworkFetcher.fetchSync(HttpUrlConnectionNetworkFetcher.java:80)
                                                                        at com.facebook.imagepipeline.producers.HttpUrlConnectionNetworkFetcher$1.run(HttpUrlConnectionNetworkFetcher.java:61)
                                                                        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:442)
                                                                        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)
                                                                        at java.util.concurrent.FutureTask.run(FutureTask.java:137)
                                                                        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1076)
                                                                        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:569)
                                                                        at java.lang.Thread.run(Thread.java:856)
03-07 00:40:09.176 24551-24560/caojianfeng.frescodemo W/System.err: StrictMode VmPolicy violation with POLICY_DEATH; shutting down.
03-07 00:40:09.176 24551-24560/caojianfeng.frescodemo W/System.err: java.lang.Exception
03-07 00:40:09.176 24551-24560/caojianfeng.frescodemo W/System.err:     at android.os.Process.killProcess(Process.java:885)
``` Thanks @caojianfeng, for taking the time and testing the change :) I'll have it merged soon @lambdapioneer ,It`s my hornor.  @yunarta updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1677/files/f054cd055877e073b0f4da7d6b30ca59592b457b..51d5fed88d2373abd4022de43dce2dbf1abde05c) @yunarta updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1677/files/51d5fed88d2373abd4022de43dce2dbf1abde05c..f054cd055877e073b0f4da7d6b30ca59592b457b) Hi @yunarta, I landed a similar version of your PR in 62c58fd, that includes a test fix. Closing this now.  Great!
I have added a sample that shows how to use `CardView`, `Fresco` and `RecyclerView` with a grid layout here: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java

Stackoverflow discussion for this issue: http://stackoverflow.com/questions/42353478/image-height-stretched-simpledraweeview  What version of fresco are you using? Well, the latest version is 1.1.0. Any chance you could check if you can repro on that?  See eacc313 - setting `placeholderImageScaleType` in XML works correctly. Make sure you don't mix-and-match setting the scaleType in XML and the actual image in Java. If you're setting the image in Java just do e.g.:

```java
draweeView.getHierarchy().setPlaceHolderImage(R.drawable.placeholder, ScaleType.CENTER_INSIDE);
``` @pavel163 either set both the image and the scaleType in XML, or set them both in code. This works:

```xml
<com.facebook.drawee.view.SimpleDraweeView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:placeholderImage="@drawable/my_placeholder"
    app:placeholderImageScaleType="fitCenter" />
```

As well as this:

```kotlin
draweeView.hierarchy.setPlaceholderImage(R.drawable.my_placeholder, ScaleType.FIT_CENTER);
```

However this won't work, because setting the placeholder image in code overrides the scaleType set in XML:

```xml
<com.facebook.drawee.view.SimpleDraweeView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:placeholderImageScaleType="fitCenter" />
```

```kotlin
draweeView.hierarchy.placeholderImage = R.drawable.my_placeholder;
```  The changes look fine but can you please update the summary in line with the template? Then I can import it. Yes @FtheGFW, that's coming. This is why the index is still in development and behind an experimental config flag but I'm very happy to have people like you looking at it and making suggestions and improvements. I've updated the initial comment as that's included in the commit message when this is merged. @sdwilsh has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.sdwilsh.sb.facebook.com/D4605725).  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  We're not going to support this as part of fresco. But, we do support custom decoders, so nothing is stopping you from adding one for this format. Unfortunately though, we don't yet have any docs on that, so I'm assigning this to @oprisnik as he wanted to add them.  Sorry for the slow response.

The error is happening when you create the VectorDrawableCompat's bitmap, not anything in Fresco itself.

I'd suggest checking a few things:

What are the layout params for the DraweeView?
Is the resulting placeholder the correct size for that?
Are the views being recycled properly so you only create as many as you need on screen?
Is it necessary to mutate the drawable? When I asked if the placeholder is the correct size, I meant you could debug the app and ensure the drawable and bitmap aren't bigger than the view needs them to be.  Looks good ðŸ‘  let us know once you consider it ready for import. @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4590782).  This looks like a synchronization issue around the database helper. Reads are protected but writes aren't.  Hi @hangduykhiem, thanks for your report. I've been able to reproduce this locally. It just seems to affect `VolleyDraweeHolder` not the `VolleyAdapter`.

As a temporary work-around you can disable "Use Drawee" from the options menu.

I'll mark this as a starter-task and a bug. @YkSix, thanks for fixing this (y) I'm on the PR and have a look now :)  Hello @quietUncle, this should be fixed in Fresco 1.x. We don't have the `DiskStorageCacheUtil` class anymore since July 2016 and the contained logic is gone from this codebase.

If the issue persists, please feel free to re-open this issue.  You want to listen to the animation repeat event (when it jumps back to the first frame)?
Unfortunately, that's currently not supported. However, this should be ready soon since we're improving the animation API. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs.

You can now set  an [animation listener](https://github.com/facebook/fresco/blob/master/animated-drawable/src/main/java/com/facebook/fresco/animation/drawable/AnimationListener.java) to get notified about these events.

You can use a `ControllerListener` to attach the `AnimationListener`:
```
Fresco.newDraweeControllerBuilder()
      .setImageRequest(imageRequest)
      .setAutoPlayAnimations(true)
      .setControllerListener(
              new BaseControllerListener() {
                  @Override
                  public void onFinalImageSet(
                          String id, 
                          @Nullable Object imageInfo, 
                          @Nullable Animatable animatable) {
                      if (animatable != null) {
                          AnimatedDrawable2 animatedDrawable = (AnimatedDrawable2) animatable;
                          animatedDrawable.setAnimationListener(yourAnimationListener);
                      }
                  }
              })
      .build()
```  Thanks! Does this happen for specific images? Do you have a sample image where this can be reproduced with in one of our sample apps (e.g. the URI app)?
For what image format is this happening? Do you have a way to reproduce this issue? The crash itself is happening in Android's `ExifInterface` itself, so not sure if we can do much here. We're [simply creating a new `ExifInterface` here](https://github.com/facebook/fresco/blob/22a11d8fb254ed4520729f16307d2da7bfbf9558/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/LocalExifThumbnailProducer.java#L136).
How do you use Fresco? @badwtg1111 your image works for me in our Showcase sample app:
![screenshot_1499689631](https://user-images.githubusercontent.com/2699634/28018036-942f6fba-6573-11e7-8c35-21d6099629fa.png)

In any case, loading a bitmap this huge (the decoded bitmap has > 90 MB) is not a good idea and will crash on some devices.
  Looks like you're trying to mix different Fresco versions. We've removed the flag that can't be found in 9726a768f419ff319d01501d6780cdfecc203193. Make sure that you're using the same version everywhere. You should also consider updating to v1.0.1 (which should also fix the issue).  You can add a `ControllerListener` and try a different URI in `onFailure`.
See http://frescolib.org/docs/listening-download-events.html  The image doesn't work for me. I suppose the GIF is malformed? Thanks for providing the GIF image! That's super helpful, as it shows that its frames are of different sizes. Especially interesting, is that one dimension is larger in the second frame than in the previous one. My guess is that something goes wrong due to that.

```
$ identify given.gif
t.gif[0] GIF 720x405 720x405+0+0 8-bit sRGB 2c 10.4KB 0.000u 0:00.000
t.gif[1] GIF 600x600 720x405+500+150 8-bit sRGB 256c 10.4KB 0.000u 0:00.000
t.gif[2] GIF 268x356 720x405+670+309 8-bit sRGB 256c 10.4KB 0.000u 0:00.000
``` 

For a workaround, I'd recommend that you re-transcode that GIF to have all drawing frames within the outer borders. I was able to reproduce this and I'll mark this as a bug.

CC: @oprisnik  Hi @wo327808864 and @shewim, thanks for the ping. Even though the GIF image might be a special case (not sure if it is within the standard), I think it's reasonable to expect that it does not crash the application. I'll make sure we look into this.

Also, we are always happy to accept pull-requests and this here is a good starter task. Thank you @RomanTruba for fixing this. This will go out with the next release of Fresco.  Thanks for the report @dannyroa, we'll take a look! What exactly is the issue here? I've tried using an `ACTION_PICK` intent to get a `content://media/external/...` URI and without the `EXTERNAL_STORAGE` permission it doesn't work. However, using a simple `ImageView` or using your `copyMediaStoreUriToCacheDir` to change the URI did not change this either. Images don't show up unless the permission is granted. Isn't that the expected behavior? Thanks, I only tested `ACTION_OPEN_DOCUMENT` and `ACTION_PICK` (sample will be available soon). I'll test with `ACTION_GET_CONTENT`. It seems that the `ACTION_GET_CONTENT` example is working for me, even without permissions. I've added the sample in 35090465864103f65246546f170216ffddbee8ff. The Showcase sample app is [here](https://github.com/facebook/fresco/tree/master/samples/showcase).

I always get `content://com.android.externalstorage.documents/...` URIs when I use `ACTION_GET_CONTENT`. 

```java
Intent intent = new Intent(Intent.ACTION_GET_CONTENT);
intent.setType("image/*");
startActivityForResult(intent, REQUEST_CODE_PICK_MEDIA);
```

![screenshot_1486735873](https://cloud.githubusercontent.com/assets/2699634/22829491/cc544a40-ef9a-11e6-9522-27dfdaf26ed3.png)

Can you reproduce the issue in the sample app? You can just clone the repo, go to `samples/showcase` and install the app with Gradle.
 As I've mentioned above: Can you reproduce the issue in the sample app? You can just clone the repo, go to samples/showcase and install the app with Gradle. Closing as the reported issue is not reproducible in the sample app. Might be a device specific bug.  Take a look our [postprocessor](http://frescolib.org/docs/modifying-image.html) documentation.

You have to add the postprocessor to the image request:
```
ImageRequest request = ImageRequestBuilder.newBuilderWithSource(uri)
    .setPostprocessor(yourPostprocessor)
    .build();
```

Our Showcase sample app also has some sample postprocessors [here](https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/postprocessor) that are used [here](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imagepipeline/ImagePipelinePostProcessorFragment.java).  This is currently not supported. Depending on the GIF size, I suppose this is also not something that you want in general. Even smaller GIFs consume a lot of memory if all frames are decoded. Do you have a sample GIF (or at least width, height and frame number)? You can of course use `imagePipeline.prefetchToBitmapCache(imageRequest, callerContext);` (see http://frescolib.org/docs/using-image-pipeline.html). But as @oprisnik mentioned, for GIF images this will only place them into encoded memory. As all images are competing for that cache, it's likely to be evicted soonish depending on your application.

I'm seeing that you are setting resize options in your image request. If the GIF image is larger than you'd ever display, you might get huge improvements by just shipping a smaller version  @facebook-github-bot stack-overflow Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Sorry Eric, we don't comment on future plans.  Have you tried passing a second parameter to `setProgressBarImage`? Like this:

```
hierarchy.setProgressBarImage(â€¦, ScaleType.CENTER);
```  Please take a look at our Showcase sample app. We have an example with a progress bar [here](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeHierarchyFragment.java). Please let us know if you still experience the issue and we can re-open this task.  You can round the image and add a padding (`fresco:roundingBorderPadding`).
The dotted / dashed border can be done by setting a background (or overlay) drawable with the effect you want (`fresco:backgroundImage` or `fresco:overlayImage`).

All of the parameters also have Java setters for the `GenericDraweeHierarchy` You can change the Showcase sample app as follows:
[activity_drawee_simple.xml](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/res/layout/fragment_drawee_simple.xml)
```xml
  <com.facebook.drawee.view.SimpleDraweeView
      android:id="@+id/drawee_view"
      android:layout_width="@dimen/drawee_width_medium"
      android:layout_height="@dimen/drawee_height_medium"
      fresco:roundAsCircle="true"
      fresco:roundingBorderPadding="10dp"
      fresco:overlayImage="@drawable/outline"
      />
```

Add a new Drawable called `outline.xml`:
```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="oval">
  <stroke
      android:width="4dp"
      android:dashWidth="4dp"
      android:dashGap="4dp"
      android:color="@color/accent"/>
</shape>
```

Looks like this:
![screenshot_1486060465](https://cloud.githubusercontent.com/assets/2699634/22562873/41c66f54-e976-11e6-8e5a-ca8bf43beacb.png)

  If you'd like to give it a try and send a PR that would be fantastic. We don't generally use OkHttp ourselves so aren't always that quick to upgrade.

Another option would be to do what we've done with the support library and make it a "provided" dependency so that we never block anyone using Fresco from upgrading to the latest OkHttp. Do you think that would make sense? Here's an example of what I mean by making the support library a [provided dependency](https://github.com/facebook/fresco/blob/master/imagepipeline-base/build.gradle#L8), which requires client apps to specifically depend on it too.

I think it made perfect sense for the support lib which almost all apps pull in anyway. I'm curious what others think about doing the same here.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Great work! Thanks for fixing this - will import and get it reviewed ðŸ‘  @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4494447).  It's a valid suggestion but I don't think these are things we're likely to change right now partly because we tend to use indeterminate progress bars.

If you'd like to contribute a PR for this, I'd be very happy to take a look at it. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant, including decoding. Let us know if you're still experiencing problems with 1.4.0. As @kirwan mentioned, pull requests are welcome but I don't think we'll have time to implement this any time soon.  Did you add `compile 'com.facebook.fresco:animated-gif:1.0.1'` to your `build.gradle`? I guess you have to use `fetchDecodedImage` instead since animated images are handled a bit differently than normal static bitmaps (not in the same bitmap cache currently).

However, if you want to allow people to save images, you should get the encoded image instead of the decoded image, i.e. `fetchEncodedImage`.  You should not need to manually handle disk / memory cache. Fresco handles everything automatically. You only have to follow the steps here and you should be good to go: http://frescolib.org/docs/writing-custom-views.html 

So basically just use your last couple of lines for creating the controller and set it to the drawee holder. So you could do something like:
```
if (autodownload) {
  draweeView.setImageURI(...);
} else {
  // set blurred thumbnail
}
``` You could supply a low res image request with your blurred image, a normal image request with your remote image. A custom network fetcher can then be used to actually send the network fetch or don't do anything. This would keep all existing caching mechanisms and you don't have to handle all of these edge cases yourself. Take a look at http://frescolib.org/docs/using-other-network-layers.html and https://github.com/facebook/fresco/tree/master/imagepipeline-backends  I think I've found the cause and am sorting out a fix.

In the meantime, it looks like setting the hierarchy before the controller should make the crash go away.  Post-processors are only applied to images held in a `CloseableStaticBitmap`. Any GIF results in a `CloseableAnimatedImage` even if it doesn't actually include an animation.

However, you can fix this with [`ImageRequestBuilder.setImageDecodeOptions(ImageDecodeOptions)`](https://github.com/facebook/fresco/blob/bf0e2f15038a6cba4b913b66db93f26169c85a24/imagepipeline/src/main/java/com/facebook/imagepipeline/request/ImageRequestBuilder.java#L215) which is set to [force static images](https://github.com/facebook/fresco/blob/0c1fa3b4c310abfe0a9d124c883f3269eed28fb8/imagepipeline-base/src/main/java/com/facebook/imagepipeline/common/ImageDecodeOptionsBuilder.java#L137).

I think that should fix your issue, so I'm going to close this. You can still reply if the problem remains.  You are splitting the build for different architectures (x86, armeabi etc.) so are you installing the correct build on your phone? I think any of the arm builds should work for you (arm64-v8a being the best) so I'm surprised if this is failing.

Can you try removing the splits and seeing if it installs then?  Yeah, I think we currently don't support postprocessors for animated images and progessive JPEGs  Hi @dkostyrev,
thank you for the note. It's definitely something we have to improve that should not be related to WebP only. On this side, the next step is to manage this case with the API we have created for custom decoders. Feel free to create a PR for this. 
Thanks
  How big are your images? Do you do view recycling?
As you've noticed, it seems that OpenGL can't render all of these bitmaps. Can you try and make the images smaller? Do you use resizing or downsampling?
You could also enable the Fresco debug overlay by initializing Fresco with:


    DraweeConfig draweeConfig = DraweeConfig.newBuilder()
        .setDrawDebugOverlay(true)
        .build();
    Fresco.initialize(this, yourImagePipelineConfig, draweeConfig);


Ideally, your images should have a green background and the `I` and `D` dimensions in the overlay should approximately be the same. Great to hear that you could solve the problem.

Can you please clarify what exactly you find strange? The first pictures can be loaded and displayed by the GPU. Then, there is no more memory and no more new images can be displayed.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Thank you very much @angarron, looks good to me!  I think it's currently not possible to get the `ResizeOptions` in the custom decoder. Resizing is done before the decoding step is reached, hence we don't pass down the size right now. However, there are `ImageDecodeOptions` and `ImageDecodeOptionsBuilder`. You could add a custom `ImageDecodeOptions` class that extends the base class and then use it in decode (it seems to get passed down). Great to hear that it worked!
You're right, having the file name (or even better the `Uri` itself) would be useful. However, currently this is based on input streams (`encodedImage.getInputStream()`) and we don't have easy access to the URI there. We would need to shuffle things around a bit.  This seems to be related to OkHttp. Did you set up proguard correctly? Can you try with a newer version of Fresco (1.0.0) and maybe also with OkHttp3?

```
  compile "com.facebook.fresco:imagepipeline-okhttp3:1.0.0"
``` It seems that this issue has been resolved. Let us know if this is still an issue for you and we can re-open this issue.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! @FtheGFW updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1630/files/48f85ae1fcc57dc1777e5a7fc2798ced61c41c50..cca98dd1ee24daad01e3322458b90215db6cb655) Thanks for this contribution @FtheGFW. @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4423344). @FtheGFW The changes you've made to `MediaVariationsIndexDatabase` are clearly worthwhile but I don't think related to the non-jpeg case. Would you mind moving those into a new PR (rebased on master to resolve the conflict)?

As for the issue with non-jpeg images, such images shouldn't go through the progressive jpeg flow, so I don't think this is where we'd want to administer a fix.

I think I know why this happens (a non-final image was previously always assumed to be a jpeg) but we should fix that assumption rather than making any changes to jpeg decoding. We should change the format of a couple of the variations in the sample app to test these cases.

I'm working on media variations changes this week so if you aren't able to make the changes I'll get to it. I'm very happy for you to fix the issue if you want to do it though. @FtheGFW updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1630/files/cca98dd1ee24daad01e3322458b90215db6cb655..b9db68b9c899b9e5beed3c3b2590e24b0fb365bc) - [changes since last import](https://github.com/facebook/fresco/pull/1630/files/cca98dd1ee24daad01e3322458b90215db6cb655..b9db68b9c899b9e5beed3c3b2590e24b0fb365bc) @FtheGFW updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1630/files/b9db68b9c899b9e5beed3c3b2590e24b0fb365bc..d351fbe909c2a7349de2b156b1c676628295b33e) - [changes since last import](https://github.com/facebook/fresco/pull/1630/files/cca98dd1ee24daad01e3322458b90215db6cb655..d351fbe909c2a7349de2b156b1c676628295b33e) @FtheGFW updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1630/files/d351fbe909c2a7349de2b156b1c676628295b33e..b9db68b9c899b9e5beed3c3b2590e24b0fb365bc) - [changes since last import](https://github.com/facebook/fresco/pull/1630/files/cca98dd1ee24daad01e3322458b90215db6cb655..b9db68b9c899b9e5beed3c3b2590e24b0fb365bc) @FtheGFW updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1630/files/b9db68b9c899b9e5beed3c3b2590e24b0fb365bc..7ee71bf90ac6c5182f792fe5958f7934199ec95f) - [changes since last import](https://github.com/facebook/fresco/pull/1630/files/cca98dd1ee24daad01e3322458b90215db6cb655..7ee71bf90ac6c5182f792fe5958f7934199ec95f)  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Fixed in 6600841.  Does this error happen all the time? Or just sometimes? What device with Android 4.4 is this happening on?  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Hey @wstczlt and thanks for posting this! This issue looks like a question that would be best asked on [StackOverflow](http://stackoverflow.com/questions/tagged/fresco). StackOverflow is amazing for Q&A: it has a reputation system, voting, the ability to mark a question as answered. Because of the reputation system it is likely the community will see and answer your question there. This also helps us use the GitHub bug tracker for bugs only. Will close this as this is really a question that should be asked on SO.  Do you have a URL to the image you are trying to load? I can't repro the problem. What device are you seeing this on, or is it not device-specific?

Is there a way you can provide a (preferably stripped down) sample app where this happens? @prgomet are you downloading the image outside of fresco? If yes, is there any chance the download is incomplete when you load it into SimpleDraweeView? Any reason why you're not using [prefetching](http://frescolib.org/docs/using-image-pipeline.html#prefetching)? @triple-dot any chance you're doing a similar thing to @prgomet?  What are you doing when you get this exception? Do you have a consistent repro?  I can access the website just fine and all links seem to work. Are you behind a proxy by any chance? Thanks for the clarification!  Does it work if you use `Uri.fromFile(file)`? Should be fixed by 2d3d4b6. @oprisnik worth doing a hotfix release? Yeah we should do a hotfix release soon. Should be fixed in the latest release.  I can't repro any of this. Loading the first image with `roundAsCircle` works fine. Loading all the GIFs works fine as well (they play the same as in Chrome). Could you detail (1) how you are loading the first image and (2) what "play abnormal" means? Ideally by providing a sample app. We changed the way that single image GIFs (like the one you have posted) are handled. See #1695 for more details and a workaround.  Can you consistently repro this, or was it a one-off? Also, what device / OS version is this happening on? Thanks @shenrh and @arso8 for the reports!

I've made sure that the code path won't make the app crash (see 72421c33b78db64dc66e1bd75de0f084372f2036). Older Android version seemed to have a RC in the `Context#getFilesDir` method (details in the commit). I don't know exactly what's causing the issue with 6.0.1, but it should be mitigated as well.

This code path is very optional and just does some clean-up of some files used by an older version of the disk cache.  Sounds like the native libraries haven't loaded correctly. Do you have a consistent repro? What device are you running on?  @JoelMarcey has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4391246).  Do you use view recycling? Is it always just 1 image? What if you change the URLs? Do you use Fresco v1.0.0?   @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4386846). @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4386846).  @JoelMarcey has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4382175).  @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4381947).  Hi @dwzzhw, thanks for the detailed bug report!

Can you tell us on which exact device and Android version you are able to reproduce this? Hi @dwzzhw,
can you tell us if the problem persists also with the last update of libwebp to version 0.5.2 we have done in release 1.0.1?
Thanks  According to the [URL RFC 1738](http://www.ietf.org/rfc/rfc1738.txt), the `@` symbol is a reserved symbol, so you have to encode it. Does it work if you use `goods%402x.png`? (`%40` corresponds to `@`)  Hi @korDen, this looks reasonable to me. Thanks a lot for this very helpful issue. Getting rid of deprecated flags is usually a good idea.

Do you want to create a PR for this change? I think it's just appearing in three places :) I'll then import that change and run it against our internal tests to make sure it has no observable negative impact. @lambdapioneer, closing this since it was handled in the PR as far as I can see  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Nice catch ðŸ‘  Will import and merge after testing @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4386800).  Do you mean a different image for the pressed state? That's not something I'd recommend due to the likelihood of a delay which will seem strange to the user.

You could define an overlay with a `StateListDrawable` for local drawables. You would have to manually manage image loading in that case. I would suggest reading through the custom view guide (http://frescolib.org/docs/writing-custom-views.html) and using the pipeline directly (http://frescolib.org/docs/using-image-pipeline.html)  Hi @ccwls3290, can you provide a code sample that reproduces the issue? And can you rephrase what you are trying to achieve? Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Hi @sachins, please sign the CLA as suggested by the bot. Otherwise, I'll close this PR. But feel free to create a new one afterwards :) Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!  `Fresco` lives in the `drawee-pipeline` module. You have to add that one as well. Hi @Aheadboy, I assume you are using IntelliJ at the moment?

It would be great if you can share your `build.gradle` file(s) or parts of it. Also have a look at http://frescolib.org/docs/index.html on how it should look like As I said above: There is a [drawee-pipeline](https://github.com/facebook/fresco/tree/master/drawee-backends/drawee-pipeline) package that you need to include.  Thanks for the info. Yeah, looks like you're never releasing images, which causes them to fill up the pool until the [hard cap throws exceptions](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/memory/PoolParams.html) due to too many images. Try to recycle those views.  Yes, what @Presleyzheng said. A custom NetworkFetcher can be used to do this.  You also need to add Bolts to your project (and potential other libraries that are missing). Just take a look at our `build.gradle` files in the dependency sections.

For example, Bolts is used here: https://github.com/facebook/fresco/blob/master/imagepipeline/build.gradle#L11  When does this happen? How do you use Fresco? Did you call `Fresco.intialize`?

It looks like your encoded memory cache is null. Do you set custom cache parameters? Closing as the poster did not provide additional details that we need to proceed with any investigation.  Hi @ICECHN, I cannot reproduce this using the URI sample app. I've been using the following URI: `file:///sdcard/Download/test#test/sq_h.jpg`.

Can you provide us with sample code where your file path fails?  Hi @athornz, 

If the static image is part of the app you can set the first (static) image as the "placeholder image". The second one that needs loading would be your "actual image" (see: http://frescolib.org/docs/drawee-branches.html).

You can also set "fadeDuration" on the hierarchy in order to have a smooth transition.

If you need to load both from an external server, you can try out the code from this PR: https://github.com/facebook/fresco/pull/1328  Hi @447zyg, in general, one should not circumvent certificate validation.

However, if you see this to be indicated for your case: Look at http://frescolib.org/docs/using-other-network-layers.html for using OkHttp3 and then learn how to deactivate security for OkHttp3. There should be tons of answers on stack overflow. @447zyg can you perhaps help @hss01248 ? I'm not sufficiently familiar with OkHttp3 here. Closing as the workaround detailed in this task seems to be enough to cover this use case.  Hi @LucianWang, the URI seems wrong. The correct one is of the format `Uri:///{resource_id}`. You can use `uri = UriUtil.getUriForResourceId(R.drawable.loading_player_cache)` in order to create the correct URI.  Hi @edconan93, can you provide us with a minimal code sample that reproduces the issue?

In general, we recommend using a RecyclerView for those scenarios. You can have a look at our scroll perf app on how to do this (including a grid layout). I suppose this issue has been resolved. Please let us know if that is not the case.  Hi @prgomet, the correct start of file uris should be: `file:///storage/emulated/0/`. If this is already the case for you, can you post a minimal code example that reproduces the issue? I verified that local file URIs still work fine using the sample apps. Hi @prgomet, the normal Uri builder will encode spaces with `%20`. You can either use a ContentResolver to get the correct URIs in the first place or use the following:

```
uri = Uri.parse("file://" + yourFile.getAbsolutePath());
``` Glad to hear that this works now for you. I see that it is confusing which way the URI should be created. I've created https://github.com/facebook/fresco/issues/1596 in order to tackle this issue (especially since this is a nice task for first-time contributors).

I'll close here then :)  Hi @palmyer, this is a known limitation (repeated edges) of this combination of scale type and rounded corners. 

Please see http://frescolib.org/docs/rounded-corners-and-circles.html for some background and solutions to this. I think that this should solve your issue. You can either use the color overlay rounding mode or modify your image to have a 1px transparent border (so that transparent pixels will be repeated instead of the white ones. Unfortunately, there's no better solution yet.  Hi @zongjingyao, I cannot reproduce this in our demo app "uri app". Which Fresco version are you using? Also, please provide a minimal code example that reproduces the issue :) Thanks  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Hi @ChrisA89, thanks for the pull-request.

I'm not sure which underlying problem you are tackling with this change. Can you quickly explain it and describe how one can reproduce it? Alternatively, you can also open a new issue for this. This will certainly help me to provide good feedback to your pull-request :) Hey @ChrisA89,

I am very sorry that I have not responded in a long time. This seems to have fallen between the cracks during the Christmas holidays :/

The tricky part with propagating the issue from the `DecodeProducer` is that the `EncodedMemoryCacheConsumer ` and the `DiskCacheWriterConsumer ` are upstream. One possibility would to catch the error downstream and then issue a removal from the caches.

Having thought about this a bit more, would be a basic sanitizer with the registered `FormatChecker`s just when we receive the first bytes from the `NetworkFetcher`. Then we can abort the request right away. Also we don't remove things from the `DiskCache` when we try to store the "bad data". (@oprisnik knows more about this)

I think one good implementation for this would to add a `InputSanitizerProducer` right after the `NetworkFetchProducer`/`LocalFileFetchProducer`. This obviously would be a bit more code to write (you can find an example of adding a new producer here: b9f6fdbc9b02971c7ef99bd4ceec7a48f8c196c7 and 4bc362217390e311a25f1f0d1b390c0bbdd9f9b7)

Let me know if you are still interested on taking on this :) Thanks for the contribution @ChrisCanCompute 
I'm going to close this now as from what I can see, the pull request is not in a state where we can merge it and there has been no activity for quite some time.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Thanks @ChrisA89, for fixing the test. I'll import the change :)  Hey @ChrisA89, I think that the change is no longer necessary due to 2d3d4b6f098646ff6dd3c748f8af8d7949ecb4ae and c6dcedcfbdd94ee26d2911bdfcef30f812551010.

Can you confirm this on Windows as well? I have also fixed another test in 554779490f511db12e122953d9470991805dcfd1.

Thanks again for your contribution, but I'll close this PR since it should not be needed any more.  Thanks, we're on it, the docs will be updated soon. The version number is `1.0`instead of `1.0.0`. Everything has been updated. We also changed the version number to 1.0.0 in order to be consistent.  Do other placeholder images work? Can you set the same image as a background for any view (or for an ImageView). How big is the placeholder? What imagme format etc.? I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  Hi @edconan93, you can have a look at http://frescolib.org/docs/intro-image-pipeline.html for introductory information on how the pipeline works.

However, the definite documentation is the code in this repository. The [`ProducerSequenceFactory`](https://github.com/facebook/fresco/blob/fc393f739d08f38dd16ef9c2c05f9c1a9d0087dd/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ProducerSequenceFactory.java) is a good place to start. I'm closing out this old issue - if this is still relevant, please create a new one  How are you using Fresco? How big is the original image and what type? What rounding mode do you use (http://frescolib.org/docs/rounded-corners-and-circles.html), how many images are displayed at the same time (i.e. how many list items and how do you bind these)? You should not use ListView for this but RecyclerView (or something similar that does view recycling). ListView keeps all elements in memory - which means that you will have more and more images in memory - which leads to the OOM eventually. I assume the problem has been resolved. Let us know if you're still experiencing this issue.  I guess you've enabled downsampling or resizing? Android does not allow images that large in a single Bitmap. A single 1080x10000 bitmap has around 41 MB, so that's a lot for low-end devices. Solutions:
- You can split the image up in multiple smaller images.
- There's also a discussion going on in #4 how we could decode regions on the fly. This should be possible with a custom decoder. However, the full encoded image (which should be significantly smaller though) still has to be in memory.  I'm closing out this old issue - if this is still relevant, please create a new one  The following code works for me:
```java
  public void showCustomToast(Context context, String text, Uri photoUri) {
    View layout = LayoutInflater.from(context).inflate(R.layout.drawee_custom_toast, null);

    TextView textView = (TextView) layout.findViewById(R.id.text);
    textView.setText(text);

    final SimpleDraweeView view = (SimpleDraweeView) layout.findViewById(R.id.drawee);
    view.setImageURI(photoUri);
    
    final Toast toast = new Toast(context);
    toast.setDuration(Toast.LENGTH_LONG);
    toast.setView(layout);
    toast.show();
  }
```  @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4326405).  Does it work if you manually add `compile "com.facebook.fresco:animated-base:${fresco}"` ? Can you take a look and see if the suggestions in #1552 fix the issue? If not, what's your Fresco version? Glad to hear that you've resolved the issue.  I'm afraid that's currently not supported out-of-the-box. 
However, it is possilbe to implement a custom `DrawableFactory` that does tiling.

Adding this to the core library would also be quite easy. You would need to pass a parameter down to `PipelineDraweeController` where the `BitmapDrawable` is created and then use that. Or Modify GenericDraweeHierarchy to have support for this. Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  Yes, please make the changes and update your pull request :) @ghassett updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1573/files/2cf70860038a4c8ab5fa91c4434f1e2581662c75..98af385ae5855e4fd3f587b29a39e996e144f140) @oprisnik has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4306125).  Please take a look at #1552. Using SoLoader / ReLinker should help here.  I don't think that custom producers can be added right now.
However, I think in your case you want a custom decoder instead. Take a look at the custom decoder example here: https://github.com/facebook/fresco/tree/master/samples/decoders/src/main/java/com/facebook/samples/decoders So what do you want to do exactly that requires a custom `Producer` instead of a `Decoder`? I'm closing this since it's almost a year old. Feel free to comment with why you'd need a custom producer instead of a decoder if this is still an issue.  Let's continue the discussion in your Stackoverflow question here: http://stackoverflow.com/questions/41009186/how-to-improve-the-speed-of-facebook-fresco-imagerequest-cached-image-bitmap-loa  You should not need to do `Fresco.getImagePipeline().evictFromMemoryCache(Uri.parse(url));`. Fresco handles everything for you.

What does `startNext()` do? You have to make sure that you correctly release the previous animation so that the memory can be freed. If anything still holds on to the image, Fresco can't release all resources.
Do you have 1 DraweeView where you change the URI? Multiple DraweeViews? Can you create a minimal example that reproduces the issue? Judging from your code this should be just 1 drawee view and a listener with `onFinalImageSet` where you load the next animation after some time. I assume the problem has been resolved. If not, please let us know.  What exactly are you trying to do? Why do you need to assemble a new GIF on the client? How are you using GifImage?

Internally, we're composing the image frames together [here](https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/animated-base/src/main/java/com/facebook/imagepipeline/animated/impl/AnimatedDrawableBackendImpl.java#L204).
The transparent color should always be `Color.TRANSPARENT`. Thanks for the very detailed explanation @ghassett !
You're right, this is not supported right now.

However, it shouldn't be too hard to expose a method `GifFrame.getTransparentColor()`.
`gif.cpp` already has `getColorFromTable(colorIndex, pColorMap);` and you can get the transparent color index for the frame.

Feel free to send us a pull request that exposes this for GifFrame :) Yeah, it's not easy with Android Studio or Gradle to do this. I think an easy way would be to either export `.aar`s and include them in your project or use a local maven repository.

You can also try and import required modules in your existing project, e.g. by adding something like

```
include ':animated-gif'
project(':animated-gif').projectDir = new File(settingsDir, '../fresco/animated-gif')
```
to your settings.gradle for all Fresco modules, see for example [this StackOverflow thread](http://stackoverflow.com/questions/17479076/android-studio-add-external-project-to-build-gradle)
If everything fails, you could consider using symlinks.

Or you can modify one of our sample apps and add your code there to make sure it works.  Thanks for letting us know. We currently don't have a better workaround for this unfortunately and our CircleCI tests have the same issue. We'll try to fix this next week.
You can also manually download the library and put them in the destination folder in nativedeps. Once the file is there, it should work. Thanks @ghassett ! We'll take a look at it and we'll probably release a new version that includes your code in the next couple of days. Thanks again for your PR. It will be included in the next release! We currently don't offer snapshot releases. However, we plan to do a release that includes your changes very soon. This is now available in v1.0.0  Thanks for the feedback! Yeah, we could improve the documentation or add a timeout.
If you'd like, feel free to send a pull request :)  Can you give us more details what the issue you're facing is (maybe with a video / gif of the issue), how to repro and what the desired behavior would be?  Thank you very much for the detailed description @senhor .
That sounds like a bug indeed. If you have time, feel free to send a pull request that fixes this. Otherwise we'll take a look at this at some point. Thank you. Maybe we also have some spare time soon to take a look at this. I can't repro on the latest version. I added your exact `zoomToPoint` call to the zoomable sample app and it works:

https://gfycat.com/EnormousExcitableAngelwingmussel

Closing the issue for now. Feel free to reopen if you can supply a valid repro (e.g. as a sample app). @senhor I've added double tap to the zoomableapp sample in 6309246. Check it out!  There does not seem to be an easy way to combine .aars, see https://stackoverflow.com/questions/20700581/android-studio-how-to-package-single-aar-from-multiple-library-projects

You could import the Fresco modules to your own Android Studio project and then depend on the models instead of AARs. Then each change will be automatically picked up  Hi @Leiluojun 
we're refactoring all the animations in order to fix this and other animation problems.
Stay tuned!

Thanks The new implementation is being worked on. We don't have an ETA yet. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs that is way more performant, especially in the case where you display multiple images. Let us know if you're still experiencing problems with 1.4.0.  Hi @wstczlt 
As written in the pull request we prefer to keep the Cache size as it is not dependent on the LargeHeap configuration.
Thanks  Hi @Dobrygnom,
as you experimented the Postprocessed image is not saved into the DiskCache. There we have the EncodedImage and so the image before decoding. The Postprocessor works on the DecodedImage (the Bitmap) and it's saved only into the Memory Cache. This is because the Postprocessor, which is the last producer of the pipeline,  should decorate images on the fly. If the decorated image is something you can elaborate beforehand, you could just put it on your server and use it as a normal image.  

Thanks   Ho @sourabhv 
Fresco itself doesn't allow to intercept the Uri of the image and change it. This is also because we use the Uri also for the Cachekey. You could use what OkHttp offers but keeping in mind the cache implications.
 Another problem is that we do not necessarily know the size of the view yet. You could prefetch an image or use the image pipeline manually.
We currently don't have a simple way of changing this behavior I'm afraid.

I guess you could manually get the size of the view before calling the image pipeline and supply resize options with these dimensions and then access the resize options? Closing as this is not practical to implement in Fresco.  Hi @hpdx ,
Can you provide us the image Url please?
Thanks @ChenSiLiang can you provide us with a sample image file that shows the described behavior? That would allow us to verify the fix and add unit tests to avoid regressing this. Closing issue as the problem is reported to be solved :) I don't think this was actually solved as it's been reported again in #1760.

The key thing which I think was missed before is that the image is a PNG and EXIF data is only available in JPEGs. This is now fixed in Fresco 1.4.0. @farwayer if this is causing a problem for you with React Native, we'll need to get that updated to use 1.4.0.  Hi @hqzxzwb ,
The [ImagePipelineNativeLoader](https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/imagepipeline/src/main/java/com/facebook/imagepipeline/nativecode/ImagePipelineNativeLoader.java#L43) class is responsible for loading the memchunk native library which is necessary for Fresco. We're not using native code just for decoding so at the moment what you need is not possible. Anyway we'll consider to allow the usage of Fresco also in newest Android releases without the unnecessary .SOs.  Fresco depends on version 24.2.1 of the support library. Do you depend on a different version which might be clashing?

I would expect something like that to result in a build-time error rather than runtime though. Glad that helped. Our next release should remove any more issues like this.  Sorry, can you repeat your question in English? Internally, the progress bar drawable uses `onLevelChange` to set the progress, so you have to make sure that your Drawable supports this. Otherwise, we're [setting a `ProgressBarDrawable` for our demo sample app](https://github.com/facebook/fresco/blob/b54c73ed2bbb4e2cd347f85a518da5fd5f8b20a7/samples/demo/src/main/java/com/facebook/samples/demo/MainActivity.java#L105), where this works. Can you give us an example where this does not work for the demo sample app (one of these drawables)? I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  There are obviously parts of the image pipeline that make the assumption that a URL will always point to the same resource.

If this isn't possible for you, there are a couple of alternatives that come quickly to mind.

1. Add a cache-busting query parameter (e.g. `avatar.jpg?c=2` where the previous version was 1)
2. Call `draweeAvatar.setImageURI(null)` then `ImagePipeline.evictFromCache(Uri)` before setting the same Uri back to the avatar. I'm closing as there have been no follow-up questions.  I suggest trying the [solution here to use the ReLinker library](https://github.com/facebook/fresco/issues/933#issuecomment-186266187). We've found that's helped people in the past with this kind of problem.

You can use the same technique with Facebook's full [SoLoader](https://github.com/facebook/SoLoader) library.

Please let me know if that helps. We use SoLoader but it was open-sourced later than Fresco so isn't part of the library.

SoLoader adds greater reliability than the default behaviour which just tries once to call `System.loadLibrary(String)`.

The failures we tend to see occur somewhat randomly and rarely so I'm not surprised you haven't seen them in your own tests.  There are a few things in your code I don't understand or aren't needed.

`ImagePipeline.fetchEncodedImage()` will download the file from the network so there's no need to request a prefetch immediately before. It will also write the file to cache but this goes through the `BufferedDiskCache` class so that the delay in writing the file doesn't hold up the image pipeline. That might explain why it's not available when you first ask.

The subscriber for that request is given the file bytes, so why do you need the file path? Are you passing that out somewhere else? If so, it might be better to write your own temporary file rather than trying to make changes directly in cache.

Also, it looks like `ImageDownloadSubscriber` is writing the file to cache but the image pipeline will be doing that already so your subscriber might conflict with that process.

Does that help? You can get the format from Fresco by doing something like this:

```
DataSource<CloseableReference<PooledByteBuffer>>
    source = Fresco.getImagePipeline().fetchEncodedImage(imageRequest, true);
EncodedImage encodedImage = new EncodedImage(source.getResult());
encodedImage.parseMetaData();
ImageFormat imageFormat = encodedImage.getImageFormat();
if (imageFormat == DefaultImageFormats.GIF) {
  ...
} else {
  ...
}
```

I don't know what your `gif_photo` and `iv_photo` objects are but if you use `DraweeView` you will get support for animated GIFs without having to do any extra work. You just need to include the [optional Gradle dependencies](http://frescolib.org/docs/index.html). Another alternative might be that your `DiskStorageCache` can be created with a `CacheEventListener` which has a few callbacks including one after each item has been written.

I wouldn't necessarily recommend using it if you're just interested in a single request but it does trigger an event at the point you're interested in. @Freshman111 If this was all to avoid using Fresco's internal GIF support, you may be happy to hear that our new release (coming in the next few hours) has rewritten support for animated images.

Hopefully that will be better for you.  You shouldn't use a `BaseBitmapDataSubscriber` and then set the bitmap to an `ImageView` as the bitmap could be recycled any time after `onNewResultImpl()` completes.

We **strongly** recommend using a `DraweeView` instead of ImageView as it handles the lifecycle of the bitmap. If you must use an ImageView, you will have to use a `BaseDataSubscriber<CloseableReference<CloseableImage>>` and keep the `CloseableReference` until the image is no longer needed and then finally close it (for example, in `onDestroy()`.

Take a look under ["To get decoded imageâ€¦" in this page of the docs](http://frescolib.org/docs/datasources-datasubscribers.html).  This looks correct. It refers to the method that takes allows setting the values for the radius of each corner (hence the plural: radii). I'll close this PR. Please re-open if you feel that the change is relevant nevertheless.

See https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/drawee/src/main/java/com/facebook/drawee/generic/RoundingParams.java#L182-L185  The reason for that sizing is that the maximum bitmap most GPUs can cope with is 2048x2048 so [we enforce that](https://github.com/facebook/fresco/blob/2cf4f9d0dfd8a690c42ed50765efbba787f9c21f/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/DownsampleUtil.java#L52) when downsampling is enabled.

A recent PR added the ability for a request's ResizeOptions to override the maximum bitmap size which should be your solution but the code I linked to above isn't checking that so this should be a simple enough fix.

If you want to send a PR (with tests for the default and overridden max sizes) that would be fantastic. Otherwise we'll get to this before the next release. Fixed in 56a30cd.  Hi @desmond1121, thanks for this opening this issue.

Do you by any chance have a local repro and can provide us with the logcat from the app start up to this issue? I'm inclined to say that this related to the specific models. Also, is this a one-off issue for those devices or is it happening on every start?

You can also try to use a native code loader for Android which might help to mitigate some of the issues. You can register with the `SoLoaderShim` from Fresco:
- https://github.com/KeepSafe/ReLinker
- https://github.com/facebook/SoLoader
 SoLoader will be the default with the next release, see aef3790d3429833599d8b5529602e2c12f18c8aa  Hi @androidbyxj, have you followed the instruction on http://frescolib.org/docs/proguard.html ?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  Hi @Pirokar, the URI loads fine in our sample application. I think the following is the issue here:

The `\` is an escape character in Java strings. You most likely need to double escape its occurences: `\` -> `\\`. Alternatively, you can escape it the "uri-way" like the other special characters: `\` -> `%5C`.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions.
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks for adding to the documentation :)
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions.
 @aphexcx updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1543/files/12bc1b1036781dc963bafc36fbe3e1580b7430c3..3f7450d4fd986215480821fbe7e230faf9f6c5a5)
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks for fixing the documentation :)
  Sorry, I just merged another new app on this page. Can you please rebase and send it to us again? @gejiaheng updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1542/files/bccdc5da3a9e8cda523984819db62da6afd15c57..f5156773efa54f37be5ac06fc51ce925ff4edf63)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions.
 @xuwakao updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1541/files/a3bce6748c79f94323cad33d867bf29aa9df6b96..0daf4f3c3ea87a94b407a66f0a11906948f59996)
 It looks like you're just trying to merge back changes which are already here so I don't think there's anything for us here.

If you have something specific to offer, please create a specific PR with detailed title and summary.  Hi @asker517, depending on the circumstances, this might be a real limitation. Decoded GIF images take up a lot of memory and therefore their frames are not cached as done for static images. However, the encoded version (i.e. the GIF file) should still be in the encoded memory cache and disk cache.

We are currently reconsidering our animation implementation and chances are that it might work better in this use-case.
  Hi @xiaoyao27610, thanks for the bug report. As the method appears to be correctly gated to switch behavior depending on the phones API level, I suspect this might be device/model specific.

Can you provide me with the concrete model number? Does this reproduce consistently on that phone?
 Additional details needed but no response from submitter  Hi @ccwls3290, we have recently added the feature to add custom decoders and it sounds this would be interesting for you. However, there hasn't been a release since then, but you can start trying using the `master` branch from this repository.

See https://github.com/facebook/fresco/commit/f36cb8e80653e678cad2ad715da394d999c5dd12 for an example on how to register you own custom decoder.
  Have you looked at creating a `ProducerListener`? That allows you to get some more specific feedback from particular producers in the pipeline and it might help provide the details you're interested in.  What version of Fresco are you using? Does this still happen with v14.0.1? I think that @kirwan has been working on this in recent releases and it should work.
 OK, I see the difference here which highlights the cause of the bug.

When you use `Fresco.newDraweeControllerBuilder().setUri(String)` an `ImageRequest` is created internally which requests for the rotation to be deferred until render time as drawee handles this for us.

When you create an `ImageRequest` directly in `ImageRequest.fromUri(String)` the default `RotationOptions` are used which results in the image being rotated within the image pipeline.

So, the bitmap which the `DraweeController` receives is actually different to the one the `DataSubscriber` gets. They are both rendered the same though of course and are both perceived the same so they clearly should receive the same info.

This may involve just a simple fix to `CloseableStaticBitmap` but that might have side-effects so we'll need to check on that.

I'm glad you have a fix for now but we'll aim to fix this before our next open source release.
  I suggest trying the [solution here to use the ReLinker library](https://github.com/facebook/fresco/issues/933#issuecomment-186266187). We've found that's helped people in the past with this kind of problem.

You can use the same technique with Facebook's full [SoLoader](https://github.com/facebook/SoLoader) library.

Please let me know if that helps.  I've added a reply to your [StackOverflow question](http://stackoverflow.com/questions/40484538/android-display-images-when-offline-once-downloaded-using-fresco).
  Closing as this is a duplicate of #743  As stated in the documentation (and your comment), this will not work since the bitmap could be released / recycled immediately after the call.

You can just get the decoded image, like you do, and then get the bitmap from the `CloseableReference<CloseableImage> image` and hold on to the result until you don't need the bitmap any more. Once you're done, do not forget to call `CloseableReference.closeSafely(image)`.

See also http://frescolib.org/docs/using-image-pipeline.html and http://frescolib.org/docs/datasources-datasubscribers.html
  Hi @shixiangyu 
you question is too generic. Can you provide more context please?
Thanks
 We would need more details please, including information on how to reproduce your issue. Please let us know if this is still an issue.  Hi @benzly 
when are you invoking that method? 

Thanks
  Hi @Wilson13 
at the moment we don't support the pause but we're working on it
Thanks
 The issue with @liukangqi2015 's solution is that it doesn't pause but reset the animation. There is currently not a simple way to resume an ongoing animation without resetting. Our new animation architecture will support this though. We'll keep you updated when it's ready. Sorry, there's no particular timeline but we'll keep you updated. The new architecture is out and I believe we recently made a change that should allow this to work. I'll check.  Hi @maplesnow-zsm 
can you provide more info please? What's the problem?

Thanks
 It's still not clear to me what the issue is here. Please provide us with a minimal example how to reproduce the issue. I'm closing this for now but can re-open once we know what the issue is and how to reproduce it.  Hi @benzly ,
at the moment RN support only 0.11 because of the compatibility library version. Do you have any special feature of the 0.14?
Thanks
 React native is using a newer version now.  No, you don't have to recycle the bitmaps if you use Fresco correctly. How do you get the Bitmaps?
 Manually recycling the bitmap is more efficient since we're not sure when the next GC run will be.

From the [Android documentation for memory](https://developer.android.com/training/displaying-bitmaps/manage-memory.html):

> On Android 2.3.3 (API level 10) and lower, using recycle() is recommended. If you're displaying large amounts of bitmap data in your app, you're likely to run into OutOfMemoryError errors. The recycle() method allows an app to reclaim memory as soon as possible.

On some Android versions we also use bitmap pools where the bitmaps are not recycled immediately but re-used instead.
  Unfortunately this is a known issue. See #1399 for more information. 
  Thanks @yangbo637829,
we'll try this image and see what's happening. 
  I can't repro this on master:

https://gfycat.com/PleasedAgileKudu

The code I used:

```java
mSimpleDraweeView.getHierarchy().setPlaceholderImage(R.mipmap.ic_launcher);
mSimpleDraweeView.setImageURI("http://i.imgur.com/0fYW56sb.jpg");

new Handler().postDelayed(
    new Runnable() {
      @Override
      public void run() {
        mSimpleDraweeView.getHierarchy().setPlaceholderImage(null);
        DraweeController controller = Fresco.newDraweeControllerBuilder()
            .setLowResImageRequest(ImageRequest.fromUri("http://i.imgur.com/0fYW56sb.jpg"))
            .setImageRequest(ImageRequest.fromUri("http://i.imgur.com/0fYW56s.jpg"))
            .setOldController(mSimpleDraweeView.getController())
            .build();
        mSimpleDraweeView.setController(controller);
      }
    },
    3000);
```

Closing the issue for now. Feel free to reopen if you have a valid repro (e.g. sample app).  I guess the issue is that you hold on to all images with `private List<MemoryTrimmable> trimmables = new ArrayList<>();`. Hence, Fresco cannot correctly clear the caches and at some point there will be no more memory left.

What exactly do you want to achieve with your code?
 Does the issue still repro if you try removing either downsampling or the `MemoryTrimmableRegistry`? Could it be that you're holding on to the drawee views in your recycler view code somewhere?
 Closing as there was no response from the original poster  Each time you call `notifyDataSetChanged()`, all the images will be re-requested. Bitmaps which are held in the memory cache should be reloaded immediately (so won't blink) but any that aren't will be reloaded in a background thread then faded in.

As your screen shows a grid of local photos which I suspect are much larger than they're shown, that could explain why as soon as the old bitmaps are closed, some are likely to be immediately evicted from cache.

I don't know how easy this would be for you, but I'd recommend using the `RecyclerView` if you're not already and report changes to the dataset more specifically than the general `notifyDataSetChanged()` which throws away everything and rebuilds all views, whether or not each of them needs it.
 Yes, just updating the individual items could help a lot.

I'm going to close this issue but feel free to comment if you have another question and I can reopen it.
  Sorry, I'm not sure what you're asking. I wouldn't expect Android Studio to auto-suggest the Fresco custom properties.

Just to note: you've called the namespace "fresco" but this will provide all properties defined in your app or other libraries you use.
 when I use the Fresco 0.10.1ï¼Œthere  appears the custom property. But when I use the Fresco 0.14.1ï¼Œno custom property prompts. How can I solve this problem?
 The actualImageUri attribute was added more recently than 0.10.0 so it's no surprise that doesn't appear if that's the version you're using.

I've just found this Stack Overflow question about [losing custom attribute autocomplete](http://stackoverflow.com/questions/30684613/android-studio-xml-editor-autocomplete-not-working-with-support-libraries). If that's what you're experiencing, there are a couple of suggested answers.
 > `https://cloud.githubusercontent.com/assets/12003831/19923314/b01d735a-a121-11e6-85fd-e492e96ac939.png`
 I've just checked [`attrs.xml`](https://github.com/facebook/fresco/blob/d36a93adee541532d321d85e998ad19b696ec018/drawee/src/main/res/values/attrs.xml) and can see that's because that is the only attribute declared against `SimpleDraweeView`.

The others are declared against `GenericDraweeHierarchy`. That can be changed so that auto-complete works, by declaring the attributes against both.

I can't promise when that will happen and would also welcome a pull request.
 Not yet. As I said in my previous comment, it would be quite a straightforward pull request for someone though if you can't wait for us to get to this. I believe this should be fixed with v1.4.0, which we released earlier today.  I can't say why that might be based on the information you've given.
- Have you made any changes to the default ImagePipelineConfig?
- Can you show an example image request and/or the drawee view's XML?
- What size are the images received from the server?
- Do you repeatedly update the dataset or do you just update the adapter once?
 Closing as a solution has been provided. Automatic resizing might be implemented in the future but for now using ResizeOptions is the way to go  This looks like a duplicate of of issue #434 so I suggest checking the suggestions there.

The exception is within `ContextImpl` in the Android framework, so looking at the cause of the exception there might also help. It seems [`getAssets()` only calls `getResources().getAssets()`](https://android.googlesource.com/platform/frameworks/base/+/android-4.4.2_r2/core/java/android/app/ContextImpl.java) so assuming you're initializing after calling the application's `super.onCreate()` I don't see why that should happen.

I can think of a work-around though, to lazily load the asset manager so we could look at including that in a future release.
  You might be able to use a `ProducerListener` and check for successful events from the cache producers. It involves checking Strings though.

I've been wondering about a way to pass this kind of metadata back with the response but I don't expect any changes like that soon and for now I think what we have should work for you.
 If you'd like to propose something via a pull request (even if it's just a RFC) I'd very happily take a look.
 There has been an update to `ProducerListener` which now identifies the ultimate producer which was reached. If this is one of the cache producers, you now know that cache was used to provide the image.

I hope this helps your case.  Your entire stack trace relates to OkHttp and Okio. I suggest asking your question to them.

Sorry I can't be more help.
 Thanks for investigating this @lucas34.

It sounds as though this is a sensible, defensive change. If you'd like to create a PR, that would be fantastic.

If you do that, please remember we have two OkHttp modules (for v2 and v3) and it would be best to update both. Fixed in 358bdc3cd6d85a016237f156d06beffcb00d35b2  @wstczlt updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1512/files/dcad80673caab08b2d985dbf2223dbfbdbe2463b..a2cc63ea7efc4134ff079392b25f04da49576581)
 @wstczlt updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1512/files/a2cc63ea7efc4134ff079392b25f04da49576581..0f11ebb5d20cf87541bcce71383fce29b55d5f8a)
 @wstczlt updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1512/files/0f11ebb5d20cf87541bcce71383fce29b55d5f8a..51aa671dea7c562e3a2fabbca08aca18d01b36f4)
 @wstczlt updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1512/files/51aa671dea7c562e3a2fabbca08aca18d01b36f4..4ea894c83f351936f90a7aa62b5275ffb269c197)
 @wstczlt updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1512/files/4ea894c83f351936f90a7aa62b5275ffb269c197..4359d1dcb3bc5312a8af4a8de99ae8f778f4a310)
 Sorry for the slow response from us. I just wanted to explain why we prefer to keep the value we have as the default.

The `MemoryCacheParams` are configurable so this is something you're already free to alter for your purposes, depending on the specific needs of your app.

However we suspect that to take up to a quarter of the large heap size by default would be excessive for the majority of cases.

Feel free to comment further or make other suggestions but for now I'm going to close this pull request.  We have much easier ways of [prefetching to cache](http://frescolib.org/docs/using-image-pipeline.html#prefetching) if that's all you want do.
  Hi @stephen-niu, the given URL does not (even) load in my browser. Have tried another HTTP framework like OkHttp3 described here: http://frescolib.org/docs/using-other-network-layers.html ?

In any case, it would be great if you could provide us the logcat output by following the steps here: http://frescolib.org/docs/troubleshooting.html 
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!

**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions.
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Hi @sdqhzhm, thank you very much for this PR. It this looks really good.

I'll import it to run our internal tests and discuss with my colleagues.
 @lambdapioneer has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4050645).
 @sdqhzhm I'm currently landing the pull-request :) For the final diff, I've re-ordered the imports to match our code-style.
  Hi @wstczlt, thanks for the question. @kirwan is currently implementing `MediaVariations`. I think these changes provide the feature you are asking for (first commit: https://github.com/facebook/fresco/commit/3f851dbf1369b7d381eec89307b16e3a81857f5e).

Until those changes make it into a release, you could also consider just implementing a custom `getCacheKeyForRequest` in the cache key factory and have an external component map the different URLs to IDs that you then use for the cache keys. 
 Are you saying the different URLs point to exactly the same image at the same size?

If so, a `CacheKeyFactory` which creates keys based on this ID sounds like it would work perfectly and may require your extended `ImageRequest`.

Another option would be to normalize the Uri into a cache key which removes the parts which may vary between versions of the Uri, if that's possible.

The Media Variations API @lambdapioneer mentioned is intended to help in cases where you have the same image at different sizes and these may be suitable to serve a new request rather than requesting a new version of the image from the network.
 In that case, if you can wait for our next release you will see the addition of a [`MediaVariations`](https://github.com/facebook/fresco/blob/50a6a39e81a47cc55527ec51ed123adbfbc13832/imagepipeline/src/main/java/com/facebook/imagepipeline/request/MediaVariations.java) object in the image request. This takes an ID for the piece of media and you will be able to use that in your custom `CacheKeyFactory`.
 Looks resolved :)  Hi @wangbourne, have a look at http://frescolib.org/docs/resizing-rotating.html . You probably want to apply resizing and/or downsampling for that request. An image of that size is likely to have a decoded size of around 250 MiB!
  You need to update your support library, see #1493 
  Hi @wangbourne, it seems that you have another dependency on the bolts library. Can you post your `build.gradle`or a minimal repro?
 cool. I'll close this then
  Hi @ffelini, this looks like a race-condition when a controller listener is removed while an event is propagated. Thank you very much for reporting! Do you have any calls to `removeListener()` in your code?

As a temporary measure you could remove calls to that method. We'll surely follow-up with a fix soon, but it will take until the next release to be available.
 Do you have a minimal repro for this that you can share?
 Looks like @lambdapioneer fixed this, closing.  Hi @YangCrayon, please have a look at http://frescolib.org/docs/troubleshooting.html

If the problem persists, please provide more details such as logs, android version, sample images and ideally a minimal piece of code that reproduces the issue.
  Are you sure that both files exist? Can you access them with ADB?
 So this seems to be a device specific problem then. Let us know if you think this is a Fresco problem.

In general, you shouldn't hardcode these paths but use Android's system methods to get to the correct directories.
  That's weird. Can you provide us with the sample image (and maybe copy paste the layout) so that it's easier for us to repro?
 Thanks, we'll investigate!
 I've tried to reproduce in the current showcase app, but failed. The rounding sample app is no longer in the repository.

Maybe the problem solves for you when you upgrade to the latest Fresco version. Which version are you using btw?

Changed the following:

```
  private List<Uri> createDummyData() {
    List<Uri> data = new ArrayList<>();
    for (int i = 0; i < NUM_ENTRIES_PER_CATEGORY; i++) {
      for (int j = 0; j < CATEGORIES.length; j++) {
        data.add(Uri.parse("http://images.adsttc.com/media/images/5192/55ba/b3fc/4b8d/f000/005b/large_jpg/MBS_Image_by_BIG_01.jpg?1368544661"));
      }
    }
    return data;
  }
```

and

```
    public SimpleViewHolder(View itemView) {
      super(itemView);
      mSimpleDraweeView = (SimpleDraweeView) itemView.findViewById(R.id.drawee_view);
      mSimpleDraweeView.getHierarchy().setActualImageScaleType(ScalingUtils.ScaleType.CENTER_CROP);
      RoundingParams roundingParams = RoundingParams.fromCornersRadii(50, 50, 50, 50);
      roundingParams.setRoundingMethod(RoundingParams.RoundingMethod.BITMAP_ONLY);
      mSimpleDraweeView.getHierarchy().setRoundingParams(roundingParams);
    }
```

Observed that all images show up fine and that memory is not spiking:

![screenshot_1509545162](https://user-images.githubusercontent.com/908387/32278654-3a83b8b4-bf0e-11e7-9143-47d0478d285f.png)

![screen shot 2017-11-01 at 2 03 12 pm](https://user-images.githubusercontent.com/908387/32278661-3e4c69dc-bf0e-11e7-8fd3-207c765b2c70.png)

  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thanks for the pull request, I've added a comment.

I guess you are using a custom OkHttpClient and that is why you need this?
 @kukuhyoniatmoko updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1499/files/22df3e42f9fe698a980aa3fde36c285983d91bc3..5d4d151a006bd376c311ab806f79d895a339499f)
 Thanks! Can you also sign the CLA please?
 @kukuhyoniatmoko updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1499/files/5d4d151a006bd376c311ab806f79d895a339499f..7144d13e845369b7db6c20f013a8082f53b0b1d7)
 The change looks fine to me.

I can see the email address you told us has signed the CLA but I can't import from GitHub into our repo until there's a link between this PR and an email address with CLA. Sorry but that's blocking me right now.

Can you please sign again linking your GitHub account?

You can also add a second email address to GitHub if you need to at https://github.com/settings/emails
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 @kirwan has imported this pull request.  If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4080908).
  I re-ran the build on Circle CI and it's passed this time.
 @nesterov-n updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1498/files/3c7afe9659dca31d5988c55a8a9ed182a4a4e46b..8442445fee42a8d26d3fcb6b4dfa5a76c31d57e5)
 Thanks for importing. If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D4001566).
 I haven't tested but I wonder whether drawee and the pipeline will honour this new option if there is no post-processor.

In [`DecodeProducer.doDecode()`](https://github.com/facebook/fresco/blob/821ebca43184d4c167f87f21a78f599ddc4baef6/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/DecodeProducer.java#L217) we call through to the decoder which for JPEGs passes the rotation from the image into a new ClosableStaticBitmap [with the rotation angle from the encoded image](https://github.com/facebook/fresco/blob/1469512e84394b352405a1d26b92fe4eb5760a8b/imagepipeline/src/main/java/com/facebook/imagepipeline/decoder/DefaultImageDecoder.java#L188).

We can't stop the `EncodedImage` holding the correct value because these are cached for multiple requests so instead I think we might need to add a new property to `ImageDecodeOptions` or otherwise stop the value being passed through.

That doesn't necessarily block this PR but I'm interested to know what you think and whether you could test and if necessary fix that scenario.
 @nesterov-n I'm going to merge this but we would like to ensure the situation I've described works.

Let us know if it's something you'd like to look at otherwise we may add a comment to the Javadocs that this may not work in the situation I've outlined and we'll encourage someone to check/fix it.
  Hi! You could try doing this with a custom decoder. I have recently added this functionality and a [simple sample app](https://github.com/facebook/fresco/tree/master/samples/decoders).

You could add a custom image format for your use case and add a custom decoder that does whatever you want.

For now, you have to manually clone the GitHub repo though since we did not release a pre-built version that includes custom decoder support yet.
 Good to hear that this works for you!

The next version that we release will support this and we're releasing quite regularly right now, so expect a new version soon (a couple of days I suppose). For now you can just check out Fresco from GitHub and include in your project.
 We've moved the custom decoder samples to https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat  How do yo use Fresco? XML, Java? Did you follow all setup steps? Could the Xposed framework be a problem?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  I don't think that this is currently possible. 
For memory caches, something similar to [clearMemoryCaches()](https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipeline.java#L375) with a custom `Predicate` that only clears the images that you want.
 Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  Hi! Can you give us more details what exactly what you mean by that? Static Code Analysis is a very wide topic, what are "low, mid, high issues"?
 Internally, we use infer for static analysis and also run a range of linters, and run tests for every commit (Circle CI). Unfortunately, I don't have any numbers for you.
  I guess you are using an older version of the support library? Try upgrading to the one we use for Fresco, [24.2.1](https://github.com/facebook/fresco/blob/master/gradle.properties#L42).
 Good to hear that it works now!
  @nesterov-n Your proposal makes perfect sense and a PR would be gratefully received.
 Closing issue as the pull request was merged some time ago  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 You're absolutely right. Thanks for fixing this example.
  Hi @walter-ghost,
[here](http://frescolib.org/blog/2016/09/02/fresco-101.html) you can find an example.
Thanks
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 I absolutely know how easy it is to reach 64k methods but we've had a discussion about this and I'm afraid we don't think this is a change we want to make.

I appreciate what you've said about synthetic methods but we currently prefer to accept those in favour of clear and correct visibility of class fields and methods.

If you need to enable multidex, it's [simple to do](https://developer.android.com/studio/build/multidex.html). Alternatively, if you're not already using Proguard that will help remove and inline some methods though I admit I've not personally run tests to compare the method counts with different Proguard settings.
 I'm going to close this PR but you can still reply to this thread if you have something else to suggest or ask.  Thanks @Doomkyn,
this is interesting. Could you provide us more context please? What HTTP layer are you using?

Thanks
 Sorry @Doomkyn,
I meant the network layer. Are you using okhttp3?

Thanks
 Great @Doomkyn,
that is actually the solution that we usually suggest for this :)

Thanks
  You have to set a different [scale type](http://frescolib.org/docs/scaling.html). `centerCrop` should work in your case.
 That code works for me. Just made a sample app with the following code:
test.xml:

``` xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:fresco="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="10dp"
    android:orientation="vertical">


    <android.support.v7.widget.CardView
        xmlns:card_view="http://schemas.android.com/apk/res-auto"
        android:id="@+id/card_view"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="center"
        android:layout_margin="16dp"
        card_view:cardCornerRadius="2dp"
        card_view:cardPreventCornerOverlap="false"
        card_view:contentPadding="0dp">


        <LinearLayout

            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:gravity="center|center_horizontal"
            android:orientation="horizontal"
            android:weightSum="1">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:baselineAligned="false"
                android:focusable="false"
                android:focusableInTouchMode="false"
                android:orientation="vertical"
                android:weightSum="1">

                <FrameLayout
                    android:layout_width="match_parent"
                    android:layout_height="190dp"
                    android:layout_weight="0.10">

                    <com.facebook.drawee.view.SimpleDraweeView
                        android:id="@+id/img_main"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        fresco:actualImageScaleType="centerCrop"
                        fresco:placeholderImage="@mipmap/ic_launcher"/>

                    <FrameLayout
                        android:layout_width="match_parent"
                        android:layout_height="40dp"
                        android:layout_gravity="bottom|right"
                        android:background="#42000000"
                        tools:ignore="RtlHardcoded">

                        <TextView
                            android:id="@+id/txt_header"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_gravity="left|center_vertical"
                            android:gravity="right"
                            android:padding="8dp"
                            android:text="Header"
                            android:textAppearance="@android:style/TextAppearance.DeviceDefault.Large"
                            android:textColor="#ffffff"
                            android:transitionName="title"
                            tools:ignore="RtlSymmetry"/>
                    </FrameLayout>

                </FrameLayout>

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="90dp"
                    android:layout_weight="0.0001"
                    android:baselineAligned="false"
                    android:orientation="horizontal"
                    android:weightSum="1">

                    <LinearLayout
                        android:layout_width="109dp"
                        android:layout_height="match_parent"
                        android:layout_weight="0.10"
                        android:orientation="vertical">

                        <com.facebook.drawee.view.SimpleDraweeView
                            android:id="@+id/img_logo"
                            android:layout_width="match_parent"
                            android:layout_height="match_parent"
                            />

                    </LinearLayout>

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:layout_weight="0.90"
                        android:orientation="horizontal">

                        <TextView
                            android:id="@+id/txt_discription"
                            android:layout_width="match_parent"
                            android:layout_height="match_parent"
                            android:gravity="right"
                            android:paddingRight="4dp"
                            android:text="Discription"
                            android:textAppearance="@android:style/TextAppearance.DeviceDefault.Small"
                            tools:ignore="RtlHardcoded,RtlSymmetry"/>
                    </LinearLayout>

                </LinearLayout>

                <ImageView
                    xmlns:android="http://schemas.android.com/apk/res/android"
                    android:layout_width="fill_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginLeft="10dp"
                    android:layout_marginRight="10dp"
                    android:paddingBottom="1dp"
                    android:scaleType="fitXY"
                    android:src="@android:drawable/divider_horizontal_textfield"/>

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:layout_weight="0.99"
                    android:baselineAligned="false"
                    android:gravity="right|center_horizontal"
                    android:orientation="horizontal"
                    android:weightSum="2"
                    tools:ignore="RtlHardcoded">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:layout_weight="1.75"
                        android:gravity="center_vertical|center_horizontal"
                        android:orientation="horizontal"
                        android:weightSum="1">

                        <ImageView
                            android:id="@+id/img_distance_icon"
                            android:layout_width="24dp"
                            android:layout_height="24dp"
                            android:background="#ffff00"
                            android:contentDescription=""
                            tools:layout_width="24dp"/>
                    </LinearLayout>

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="52dp"
                        android:layout_weight="0.35"
                        android:gravity="center|right"
                        android:orientation="horizontal">

                        <TextView
                            android:id="@+id/txt_distance"
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_weight="0.77"
                            android:gravity="right"
                            android:maxLines="1"
                            android:paddingLeft="8dp"
                            android:paddingRight="8dp"
                            android:text="0.0 km"
                            android:textAlignment="viewStart"
                            android:textAppearance="?android:attr/textAppearanceSmall"/>

                        <TextView
                            android:id="@+id/txt_indoor"
                            android:layout_width="100dp"
                            android:layout_height="match_parent"
                            android:gravity="center|right"
                            android:paddingRight="4dp"
                            android:text="Indoor"
                            android:textAlignment="viewStart"
                            android:textAppearance="?android:attr/textAppearanceSmall"
                            android:textColor="#e00b0b"
                            android:textSize="18sp"
                            tools:ignore="RtlHardcoded,RtlSymmetry"/>

                    </LinearLayout>

                </LinearLayout>

            </LinearLayout>

        </LinearLayout>
    </android.support.v7.widget.CardView>

</LinearLayout>
```

MainActivity.java

``` java
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        Fresco.initialize(this);
        super.onCreate(savedInstanceState);
        setContentView(R.layout.test);

        SimpleDraweeView sdv = (SimpleDraweeView) findViewById(R.id.img_main);
        sdv.setImageURI("http://lorempixel.com/400/400/sports/2/");
    }
}
```

Result:

![screenshot_1475277400](https://cloud.githubusercontent.com/assets/2699634/19009487/67421a1a-876c-11e6-8b3e-610d7abdddf7.png)

So it seems that something else is not working for you?
 How do you set the image URL?
 So it doesn't work for the placeholder image? If so, you have to use `placeholderImageScaleType` instead of `actualImageScaleType` in XML (and the corresponding method in Java).
 Since it still works for me with the sample code above, I would say the problem is somewhere else in your code. A minimal example to reproduce the issue would be nice. Otherwise just go from the example and gradually add functionality until it fails - then you know where the issue is.
 As a workaround, you could try setting an aspect ratio `fresco:viewAspectRatio="1.23"` or in Java with `drawee.setAspectRatio(1.23)`?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  You're right. `prefetchToBitmapCache()` only takes the image as far up the pipeline as the main bitmap cache.

Post-processing and caching the result of that comes later.

Pre-fetching before you need the image will give you the benefit of downloading the image and decoding into bitmap cache. Then calling `fetchDecodedImage()` will take the image from cache and run the post-processor.
  You should have a section like this in your Gradle file too. I'd be surprised if it's missing but that's the first thing to check.

```
repositories {
    jcenter()
}
```

If that's there and it's still failing I suggest opening the terminal and from your project's root folder running `./gradlew build --info` to see if you get a more useful error message.

I also did a quick Google search for "gradle failed to resolve" and saw some [Stack Overflow suggestions like this one](http://stackoverflow.com/questions/29077374/gradle-fails-to-resolve-dependencies-in-android-studio).
 I'm going to assume your problem is resolved so I'll close the issue. You can still reply if you still have problems.
  Are the drawable resource and the one downloaded from the URL _exactly_ the same GIF?

When you're loading it from local resources, how are you doing that?
 Can you try with v0.14.1? We've changed the loop count parsing in 95359b9cb7650cf00b362ffbc018e90d503d476b
 It looks like your GIF has no NETSCAPE2.0 block, which means that the GIF should only be repeated once. 

I suppose that this GIF plays correctly: https://s3.amazonaws.com/giphygifs/media/4aBQ9oNjgEQ2k/giphy.gif
  I'm looking into this right now and there's an easy way to stop this happening but I'd like to understand if there's a specific combination of factors which results in the issue as I've not been able to reproduce it myself.

Can you provide a particular image which results in this error? It would be useful to know whether you have any changes to the default `ImagePipelineConfig` or `ImageRequest` too.
 This should be fixed by 573986ac0530300a42941534898b534234745c24.

I'd still be interested in knowing specifics of an image that reproduces this issue if it's possible to share one.
 Thanks @victorxxie, that's enabled me to verify the original cause and the fix.

The image you sent me isn't progressive and that's what showed the bug. If a non-progressive JPEG comes through for a request where progressive rendering is turned on, the dimensions can't be loaded and the error occurred.

It is fixed by my change. We'll discuss whether it's necessary to push out a patch release now this is fixed.
  You say you've only attempted to load three images, but that exception should only be thrown once you've [created 384 bitmaps](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/BitmapCounterProvider.java#L24).

Are you absolutely sure you're not loading any other images within your app which aren't being released?
  That's very strange and I don't see how the existence of code which is unused could result in a piece of unrelated code breaking.

I'd need more information to understand how Fresco could result in this.
- Can you provide more Logcat lines before the error and a full stack trace if there is one?
- How have you added Fresco to your project? Gradle or another way?
- Are you sure you don't use any of the Fresco APIs at all, so that removing it altogether doesn't break anything?
- Are you picking the photo using another app or do you have an activity for this?

Also, 0.10.0 is quite old so I'd be interested in knowing if the same happens with 0.14.0.
 @oprisnik has just suggested it could be due to the support library. Do you explicitly import the support library and if so, what version? Does that change in the Fresco/non-Fresco branches?

I found this Stack Overflow question where someone [suggested downgrading the support lib](http://stackoverflow.com/questions/36587428/fragmentactivity-activity-result-delivered-for-unknown-fragment), though they don't explain why that might help.
 Closing due to lack updates or other reports of the issue  This is out of the scope of Fresco and the best solution may depend on what network fetcher you're using.

A quick Google search pointed to this similar question on Stack Overflow which may help you: http://stackoverflow.com/questions/6825226/trust-anchor-not-found-for-android-ssl-connection
  Your build has failed during Proguard. A quick Google search suggests this is due to [duplicate class definitions](http://stackoverflow.com/questions/35092586/exception-while-dexing-files-translation-has-been-interrupted).

The first thing that occurs to me is that we've [updated the support library version to 24.2.1](https://github.com/facebook/fresco/blob/master/gradle.properties#L42). You may need to upgrade your support lib dependency too.

If that doesn't fix it, please check your other dependencies and see what might be out of sync.
 You can certainly fork Fresco and modify your fork to achieve that. Otherwise I'm afraid you may have to stick with 0.13.0 until you can upgrade.

If you have further questions, comment here and I can reopen the issue.
 I'm happy if this has helped you. We have a plan for how to avoid clashes due to support library versioning (Fresco uses very little of the support library).

That will be included in the next release.  Update version to last release : 0.14.0
 Thanks @eldk, we forgot this while running through our release process.
  Hello,
#1472

Add statement to check if mCacheStats isInitialized in getSize() and getCount(), if not, call maybeUpdateFileCacheSize().

Thanks,

Eric
 Hi @eldk,

thanks for the PR. Looks good ðŸ‘  Let me import it to run the tests as CI is broken at the current base of your diff.
 https://github.com/facebook/fresco/blob/master/imagepipeline-base/src/test/java/com/facebook/cache/disk/DiskStorageCacheTest.java#L298
 @eldk updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1475/files/eb4451f9a97346e120df89aae6604efb4eb20e4e..f4ebf5eb2cde598818d88f2211cea544b251a189) - [changes since last import](https://github.com/facebook/fresco/pull/1475/files/ad0732d073e65e404ae376448681b8d2102143b1..f4ebf5eb2cde598818d88f2211cea544b251a189)
  I'll use this pull-request to verify that the changes would indeed fix the CI build
  Hello,

Testing crash reports and then have some app restart, I see imagePipelineFactory.getMainFileCache().getSize() return -1 even if cache is not empty (it's the same for getCount()).

This was not the case some time ago.

My repository is up to https://github.com/facebook/fresco/commit/93d5a4c81c8b4b1bb9e5a1f874851969d06a3a0f.

I will update it this afternoon and test again.

Thanks,

Eric
 Hello,

I have tested on last Fresco master branch : https://github.com/facebook/fresco/commit/b74da9e78f47db5baaba419f2fea606607d6cb4b .

It's the same, after app restart (device restart, force shutdown, or app crash), cacheStats are not initialized, so getSize() or getCount() return -1.

This PR solve it : https://github.com/facebook/fresco/pull/1475.

Thanks,

Eric

PS : CircleCl is broken
 Hi @eldk,

I'm currently fixing the CI. Once that's done I'll have a look at the PR.

Cheers, Daniel
  Hi @1181631922, Fresco does not support downloading videos, as it is focussed on still images.

You can use the underlying network stack (e.g. HttpURLConnection, OkHttp2/3 or Volley) to download files manually. Or use Android's [DownloadManager](https://developer.android.com/reference/android/app/DownloadManager.html) for large files.
 Most likely not, as we are focussed on images.
  Hi @jobpav1984 , from the error message this looks like the JpegTranscoder that Fresco is using has a problem while resizing the file. Unfortunately, I cannot reproduce this error using the provided image in our sample apps.

The message you are seeing can be an indicator that the file was not fetched completely or was corrupted during transport.

Can you provide me details on the following questions:
- Which version of Fresco are you using?
- Does the bug reproduce consistently? (i.e. are always the same images failing)
- Do you use a custom network fetcher?
- Does the bug reproduce when you store the file on the device and replace the uri with `Uri.parse("file:///path/to/the/image.jpg")`?
 I've tried the URL in our `scroll_perf` sample app (with resizing) and everything seems to work fine. I'm getting a 415 by the server sometimes though, but that's something that I also see in my browser.

Can you try out the following to help me debug this:
- Add logging for image requests and repost the FLog. The current one does not have the exceptions in it. See code below for the necessary changes to your image pipeline configuration
- What does your current ImagePipelineConfig look like?
- Use the OkHttp3 network fetcher: http://frescolib.org/docs/using-other-network-layers.html

```
FLog.setMinimumLoggingLevel(FLog.VERBOSE);
Set<RequestListener> requestListeners = new HashSet<>(1);
requestListeners.add(new RequestLoggingListener());
ImagePipelineConfig imagePipelineConfig = ImagePipelineConfig.newBuilder(this)
    /** you probably have your own settings here */
    .setRequestListeners(s)
```
  Hi @longlylong, it looks like you application is running out of memory. Is there a special connection to Fresco here?
 Have you tried the resize options described in our documentation: http://frescolib.org/docs/resizing-rotating.html?

In case the problem persists: can you provide a minimal example that reproduces the bug including the pictures that you are using?
 I'm closing this issue due to inactivity. If this is still a problem, let us know!

  Yeah, unfortunately this is a known issue. If you set a new URI, you'll see the placeholder image until the new image is ready. This is especially noticeable when you have large images and you switch them a lot (like in your example).

There is a PR that solves this, https://github.com/facebook/fresco/pull/1328, but we did not yet include it in Fresco. You could try and see if this would solve the issue.
 You don't need to fork. The DraweeController already [supports setting a DataSourceSupplier ](https://github.com/facebook/fresco/blob/d148b96f2c6a9f3f72aa430fa47ecc188f925b57/drawee/src/main/java/com/facebook/drawee/controller/AbstractDraweeControllerBuilder.java#L185), so you should be able to just copy paste the code from `RetainingDataSourceSupplier` in your project that uses Fresco and then use it like shown in `MainActivity.java` of the pull request.
 Which also means that if this works for you, you can just use it until we've officially included it in Fresco :)
 Yes, if you take a look at the PR, `setDataSourceSupplier` does not return the builder.

You have to do

```
PipelineDraweeControllerBuilder builder = Fresco.newDraweeControllerBuilder()...
builder.setDataSourceSupplier();
setController(builder.build());
```
 Perfect, good to know that it works! Let us know if you experience some issues with this. We'll also work on including this directly into Fresco.
 Take a look at #1328 @karun2189  The sample code in #1328 is working for me locally. Just do the exact same things as in the example given there.  Please take a look at the other OOM issues. We need more information about the image type, size, how many, how you use Fresco, configuration etc.

https://github.com/facebook/fresco/issues?utf8=%E2%9C%93&q=is%3Aissue%20OOM
 Good to hear that :)
  You can use the [image pipeline directly](http://frescolib.org/docs/using-image-pipeline.html) for this and use [subscribers](http://frescolib.org/docs/datasources-datasubscribers.html). Don't forget to [close the references](http://frescolib.org/docs/closeable-references.html) to the bitmaps once you are done so that you do not leak memory.
  It's not currently possible but we have recently received PR #1459 which allows the addition of headers to be included in the request. This should be available in the next release of Fresco.

It's dependent on using a `NetworkFetcher` which makes use of the headers added to the `ImageRequest` though.
 You can however implement your own network fetcher or extend one of the existing ones to just add your parameters.
  This has been asked before, for example #712.

It's not currently possible. Images aren't always retrieved from HTTP (for example local or cached images) so these wouldn't be available consistently anyway.

You would be able to extract the headers if you implemented your own `NetworkFetcher` however you would still need to find another way of passing back the values you want.
  Where do you want to use VectorDrawable resource IDs?

Right now, Fresco will only load bitmaps for the primary image but for placeholders, backgrounds, overlays, loading drawables and failures they should work.

If you could give a small code snippet we can double check what your issue is.
 `DraweeView` doesn't support VectorDrawables as the main image, only bitmaps. I think you would need to simply use an `ImageView` in this case.

`DraweeView` does extend `ImageView` but as the [documentation on the class says](https://github.com/facebook/fresco/blob/4b94f604e0a98a999dcc1357992f8cb34b1b83b6/drawee/src/main/java/com/facebook/drawee/view/DraweeView.java#L38), that shouldn't be taken as a sign that it supports everything that does.
  Thanks for the PR @kunny. We'll take a look
  Closing as part of our cleanup of old issue.
We've not seen that this synchronization (and waiting for the lock) is causing issues but if anyone is experiencing issue with this, please file a new bug report.  The doc you've added wasn't quite what I meant, which was that the headers are only supported if you use a `NetworkFetcher` implementation which consumes them. This PR only adds support for one of the two `NetworkFetcher`s in the open source library and anyone using their own would have to add support.

That said I don't want to delay this over a doc which I can fix myself - particularly as we have a new release coming which this could be included in - so I'm going to import it then make the slight change myself.

@facebook-github-bot import
 Hi @rigdern and @npomfret,

Thanks again for the pull request. While the changes certainly would unblock the React Native feature, I do not feel too comfortable adding HTTP headers to the `ImageRequest` class. There are three arguments that I have for this:

First, the HTTP headers would only apply to a certain URI scheme (http) and is not relevant e.g. for local file requests. After adding headers, we might also want to add support for auth tokens in cookies and so on leading to some confusing parts in the core api.

Second, sending tokens from a higher level seems to be a specific use case due to the nature of React Native. Most clients would use an OkHttp interceptor (see code below [1]) to solve this. Passing down auth tokens from the UI would look like an anti-pattern there.

Finally, so far the URI was able to fully describe the source of the content. If the image might change depending on the used headers, this would require us to rethink cache keys.

## Proposals

Nevertheless, I see that this is crucial for writing applications in React Native that require auth headers. I'd like to propose the following alternatives:

(1) We find a way to leverage the OkHttp3 interceptor in ReactNative. Frankly, I don't know how feasible this is to do. However, the big benefit would be that one can properly do the rewriting of all request parameters. In addition, client logic could handle a `401` itself, re-auth and then re-issue the original request. Completely transparent to the image and UI code.

(2) In the React Native Android code, we create a custom `ReactNativeImageRequest extends ImageRequest` in those cases where one wants to pass down HTTP modifiers. React Native would also implement its own `NetworkFetcher` down in the stack and there check for `instanceof ReactNativeImageRequest` for modifying the request on the lower level where necessary. This would come close to the current proposal with a lot of freedom, without modifying the `ImageRequest` class.

(3) Refactor the Fresco code to have a `NetworkImageRequestWithHeaders extends ImageRequest`. This would not change much for other clients, but make it available for users who really need this.

I'm looking forward to hear what you think about these ideas :)

Maybe @oprisnik or @kirwan also chime in. Personally, I feel that (2) would be something that we can get working quite soon. I'm more than happy to help you working on those so that we get them in soon.

Cheers,
Daniel

## Code attachments

[1] Best-practice of adding auth headers using interceptor of okhttp

```
final OkHttpClient.Builder okHttpClientBuilder = new OkHttpClient.Builder()
    .addInterceptor(new Interceptor() {
        @Override
        public Response intercept(Chain chain) throws IOException {
            if (!chain.request().url().host().equals("myhost.com")) {
                return chain.proceed(chain.request());
            }
            final Request.Builder requestBuilder = chain.request().newBuilder();
            requestBuilder.addHeader("authtoken", "foobar42");
            return chain.proceed(requestBuilder.build());
        }
    });
final ImagePipelineConfig imagePipelineConfig = OkHttpImagePipelineConfigFactory.newBuilder(
        getApplicationContext(),
        okHttpClientBuilder.build())
    .build();
```
 @rigdern, I've added my comments to the implementation at rigdern/react-native@2743ba2. Looks very good and happy to support from Fresco side
 @rigdern updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1459/files/5eaf11d798e69f9df6cf1756335b218261f1dd66..9aa1e75f78f984cb39b77ac50fca0db0fade1dcb) - [changes since last import](https://github.com/facebook/fresco/pull/1459/files/5eaf11d798e69f9df6cf1756335b218261f1dd66..9aa1e75f78f984cb39b77ac50fca0db0fade1dcb)
 @rigdern updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1459/files/9aa1e75f78f984cb39b77ac50fca0db0fade1dcb..5c444cd7fccc6aad8c2fa28bcf96bd5c788f8dda) - [changes since last import](https://github.com/facebook/fresco/pull/1459/files/9aa1e75f78f984cb39b77ac50fca0db0fade1dcb..5c444cd7fccc6aad8c2fa28bcf96bd5c788f8dda)
  It could be because the bitmaps are being retained in the memory cache.

To test that theory, you could provide an alternative `Supplier<MemoryCacheParams>` to the `ImagePipelineConfig` so that the eviction queue cannot grow bigger than 0. This is the number of bitmaps which can be held in cache, even if they are no longer used elsewhere.

You could even set the max cache size to 0 and then the cache shouldn't hold onto any bitmaps that have no other references.
 That's good. I've closed the issue but if you have further questions you can still reply.
  1) implement `MemoryTrimmableRegistry` (as per the docs you copied here)
2) In your `Application` class customise the config by calling `ImagePipelineConfig.newBuilder()`, provide the builder with an instance of your `MemoryTrimmableRegistry` implementation and build the config to pass to `Fresco.initialize()`.
 This looks good to me.

I don't believe `sMemoryTrimmable` or `sImagePipelineConfig` need to be static as your `Application` class will only be instantiated once per session but neither will that break this.

As for the number of trimmables, more than four classes implement `MemoryTrimmable` but some are dependent on the Android version or your config so it seems reasonable that you see four.
  Thanks for all those details.

Sadly the "Caused by" section at the end of the stack trace is what you need to look at and that's been cut off. It's a reflection call (to read the XML).
 @heyou93 Thanks for sending this through, but you also haven't shown the full stack trace.

In particular I would expect to see a "Caused by" section showing the inner cause. Are you still able to reproduce this?

It would also be useful to see your layout XML.

We're spending this week going over open source issues in Fresco and resolving what we can so if you're able to provide this quickly it would really help us deal with it. I'm going to close this for now, but if someone can provide the full root cause I'll reopen the issue.  Look at the [`MemoryTrimmableRegistry`](https://github.com/facebook/fresco/blob/master/fbcore/src/main/java/com/facebook/common/memory/MemoryTrimmableRegistry.java) interface.

The only implementation currently available in the library is a no-op but the docs explain how you can [create your own MemoryTrimmableRegistry](http://frescolib.org/docs/configure-image-pipeline.html#using-a-memorytrimmableregistry).
  Thanks for this @huangjunkun - the change looks good.

Some tests are broken though, as shown by CircleCI. Can you please fix the tests?
 Thanks @huangjunkun. This looks great.

@facebook-github-bot import
 Yeah, I'll take a look at #1317.
 @huangjunkun: After merging this PR, we've seen a number of instances of bitmaps being cleaned up by finalizers due to the `CloseableReference`s not being cleaned up. I think I'm going to have to revert this for now and then we can test the change further.
  Hi @huangjunkun. I'm still interested in testing this original issue, after we had to revert the PR. Do you have a simple sample app which results in the screenshot you attached?

If you could send me that it would really help in testing what goes wrong. We think the second line you pointed to should stop this being an issue.
 I tried to repro but I couldn't. Both datasources get a valid result with this sample code:

```java
private static class SimpleLoggingDataSubscriber
    extends BaseDataSubscriber<CloseableReference<CloseableImage>> {
  private final String mTag;

  private SimpleLoggingDataSubscriber(String tag) {
    mTag = tag;
  }

  @Override
  protected void onNewResultImpl(DataSource<CloseableReference<CloseableImage>> dataSource) {
    Log.d(mTag, String.format(
        "ds#isClosed:%b result#isValid:%b image#isClosed:%b",
        dataSource.isClosed(),
        dataSource.getResult().isValid(),
        dataSource.getResult().get().isClosed()));
  }

  @Override
  protected void onFailureImpl(DataSource<CloseableReference<CloseableImage>> dataSource) {
    Log.d(mTag, "failed!");
  }
}
// later, in onCreate
final DataSource<CloseableReference<CloseableImage>> ds1 =
    Fresco.getImagePipeline().fetchDecodedImage(
        ImageRequestBuilder.newBuilderWithSource(Uri.parse("http://i.imgur.com/gknajFC.jpg"))
            .setResizeOptions(new ResizeOptions(200, 200))
            .build(),
        null);
final DataSource<CloseableReference<CloseableImage>> ds2 =
    Fresco.getImagePipeline().fetchDecodedImage(
        ImageRequestBuilder.newBuilderWithSource(Uri.parse("http://i.imgur.com/gknajFC.jpg"))
            .setResizeOptions(new ResizeOptions(100, 100))
            .build(),
        null);
ds1.subscribe(new SimpleLoggingDataSubscriber("DS1"), CallerThreadExecutor.getInstance());
ds2.subscribe(new SimpleLoggingDataSubscriber("DS2"), CallerThreadExecutor.getInstance());
```

Closing for now. Feel free to reopen if you have a valid repro (code sample or app). We've released version 1.0.0 now. Could you check if you still have issues with this release? Thanks! Good to know, thanks @huangjunkun  `adjustViewBounds` is not supported, as documented in the [Gotchas section](http://frescolib.org/docs/gotchas.html#dont-use-imageview-attributes-or-methods-with-draweeview) of the documentation.

Try using `fresco:viewAspectRatio` instead.
 The primary disadvantage @plamenko was warning of is that if the image size changes when the image loads the screen layout may change after the initial layout. This is a very unpleasant user experience.

However, you can use `android:setAspectRatio` without having to update later as long as you have set either the width or height, which you have in your case with `android:layout_width="match_parent"`
  We don't set a resizeOption as default for now. What format is your image?
 I presume these are local images on the device. In which case you shouldn't need to set `setLowResImageRequest()`. Maybe the main URI is failing so I suggest trying to remove that and `setRetainImageOnFailure()` and see if your image loads as expected.
 I'm closing this issue since it's more than a year old and @kirwan answered your question. Feel free to comment if this is still an issue.  What do you need to do exactly?

To display a gif image using Fresco, you can use

Uri uri;
DraweeController controller = Fresco.newDraweeControllerBuilder()
    .setUri(uri)
    .setAutoPlayAnimations(true)
    . // other setters
    .build();
mSimpleDraweeView.setController(controller);
 If you don't .setAutoPlayAnimations(true), Fresco would take the first frame as real image for the view. You can also apply round param to the DraweeHierarchyBuilder.
 Please show us the XML or `DraweeController` code that creates the view. I suspect there might be an issue with the `RoundingMethod` you're using.
 GIF rounding is currently not supported.  Hello,

Should you have a look at : 
http://frescolib.org/docs/wrap-content.html#main_wrap
http://frescolib.org/docs/using-drawees-xml.html#wrapcontent

https://github.com/facebook/fresco/issues?page=1&q=wrap_content

Thanks,
Eric
  dup of #1445 
  Can you please show how you do the transition part using Fresco's demo app?
 Thanks, we'll take a look @marcosalis When returning to the first activity (with the recyclerView). Does that always trigger a notifyDataSetChanged()? @marcosalis Great that you've found a workaround! I tried to reproduce this particular issue in the Showcase app running on Genymotion with Android 7 but no luck.

What does the item views for the recyclerview look like? In my case it was just a FrameLayout wrapping a SimpleDraweeView. I think we found a workaround and hopefully a fix will be available soon. The workaround can be found in dc7ec2436fc9b639fe1a39398712c360b16da468.

For now, you have to set up the first `DraweeView` where the transition is starting from to use legacy visibility handling by calling `simpleDraweeView.setLegacyVisibilityHandlingEnabled(true);` (as you can see in the transition example in our Showcase sample app).

Can you please check if this solves the issues for you? We're going to release a new Fresco version that cointains this fix very soon. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes the fix as mentioned above. Just call `simpleDraweeView.setLegacyVisibilityHandlingEnabled(true);` and it should work now.

We've also updated the [Showcase transition sample](https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/transition) to reflect these changes. Visibility handling changed with Android N and my change is (kind of) reverting the behavior back to pre-N. Changing this behavior for all images could lead to other unexpected issues and that's why we decided to not turn it on by default yet. Once we've verified that there are no side effects, we'll consider turning it on by default. 
Feel free to set it to` true` and report back any issues that you encounter. @marcosalis does it only happen on Oreo or also on Nougat? Thanks, I'll try to repro when I have a bit more time I was able to repro. For me it only occurs rarely though. I'll check if I can find a different workaround to fix this. Not yet, this is tricky to fix since Google changed the View visibility behavior, which breaks Fresco's visibility handling (which we need for memory management) and I'm also not going to have a lot of time to look into this in the near future. However, there are several alternatives mentioned in this thread that fix the issue (like the workaround from @MartB that manually sets the visibility). 

If somebody would like to look into this, pull reuqests are always welcome! :) @oprisnik , `react-native-maps` module also affected from this issue.
I've marked [these lines](https://github.com/facebook/fresco/blob/v1.3.0/drawee/src/main/java/com/facebook/drawee/generic/RootDrawable.java#L79-L81) as comment in RootDrawable.java file as a workaround.
Do you remember/know any big issue that is related marking those lines as comment lines? @efkan I don't know exactly. I remember that I looked into this as well when I was looking for alternative fixes, but dismissed it. I think one issue with removing these checks is that the underlying bitmap has been released (since the View is not visible any more) and trying to draw it would throw a `java.lang.RuntimeException: Canvas: trying to use a recycled bitmap ...` since `BitmapDrawable` doesn't perform any sanity checks.

`ImageView` itself has the same bug where it doesn't properly restore the Drawable visibility of any drawable, but it still works since most Drawables don't do the visibility check and there's no manual memory management - and the underlying Bitmap would still be valid.
 @oprisnik thanx for the all these explanations. In order to test if this works, it's fairly easy to add this as a setting to `GenericDraweeHierarchyBuilder` and depending on that ignore the visibility check in `RootDrawable` (which is created in `GenericDraweeHierarchy`, see https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchy.java#L155).

Feel free to submit a PR that adds this setting so that you can enable it for your applications and see if there are side effects. @babyblue1314 - The `RootDrawable` change mentioned above also doesn't fix it for you? @babyblue1314 I don't see any transition in your videos or transition-related code. Are you sure that you're talking about the same issue?  Fresco uses LRU logic of eviction in disk cache. You can find it in DefaultEntryEvictionComparatorSupplier.java.
  You're right, but I'd prefer to leave it for a little longer in case people are still using the older versions.

I'll merge this after completing the next release.
 Thanks for importing. If you are a Facebook employee, you can view this diff [on Phabricator](https://phabricator.intern.facebook.com/D3974828).
  Can you please show are you're using the SimpleDraweeView in code?
 I assume the problem has been resolved. If not, please let us know. There is also a related discussion going on in #1445  I don't believe that will work.

`fresco:roundAsCircle` is a boolean and you can't really animate a boolean. What could work but doesn't right now is to animate specified corner radius values.

If you'd be interested in providing a pull request, I believe that could be achieved by adding another transition to [`DraweeTransition.createTransitionSet(ScaleType, ScaleType)`](https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/view/DraweeTransition.java). That works with numerical values and they are very well suited to transitions.
  Can you try with the solution in #410 ?
 @peacepassion When we've seen issues like this before it's because the native library was not successfully loaded.

I think @aagnes had this solution in mind: https://github.com/facebook/fresco/issues/933#issuecomment-186266187

That comment has a solution to use another small library called Relinked and integrate it with `SoLoaderShim` to improve the success of loading those native libraries.
 Closing as a workaround was suggested and no updates since last year  I think you're right. Are you calling `DiskStorageCache.insert()` directly to replace existing items? In the pipeline, it's only ever called if the item is not already in cache.
 Closing as it's not clear if the problem was due to incorrect usage  This still works for me. The issue in your code is that you have to supply a color value instead of a color resource ID for `setBorder(...)`.
Our documentation on this is also wrong, we will update it accordingly. Thanks for flagging!

Setting in Java:

```
int color = getResources().getColor(android.R.color.white); // or whatever your color is
simpleDraweeView.getHierarchy().setRoundingParams(RoundingParams.asCircle().setBorder(color, radius));
```

Setting in XML

```
<com.facebook.drawee.view.SimpleDraweeView
    android:id="@+id/drawee"
    android:layout_width="46dp"
    android:layout_height="46dp"
    fresco:roundAsCircle="true"
    fresco:roundingBorderWidth="8dp"
    fresco:roundingBorderColor="@android:color/white"
    />
```
 I have also added a support annotation in 4924b892fe1e6b4574b9e55f1fbe0a54ec0a39f7. You should see a warning / error in Android Studio now if you supply a wrong type.
  It works for me as expected. Example:

XML:

```
<com.facebook.drawee.view.SimpleDraweeView
  android:id="@+id/sdv"
  android:layout_width="64dp"
  android:layout_height="128dp"
  />
```

Java:

```
SimpleDraweeView sdv = (SimpleDraweeView) findViewById(R.id.sdv);
sdv.getHierarchy().setActualImageScaleType(ScalingUtils.ScaleType.CENTER_CROP);
sdv.setImageURI(uri);
```

Tested with remote and local image in `raw` directory, 600x400px
 Keep in mind that in order for this to work in XML, you have to use

```
<com.facebook.drawee.view.SimpleDraweeView
    android:id="..."
    android:layout_width="..."
    android:layout_height="..."
    app:actualImageScaleType="centerCrop"
    />
```

where `xmlns:app="http://schemas.android.com/apk/res-auto"`, see http://frescolib.org/docs/using-drawees-xml.html and http://frescolib.org/docs/scaling.html

Then it should also work in XML.
 Changing the scale type in XML works for me as expected. Maybe you set a custom DraweeHierachy (which overwrites the XML values)?
 Also, the default scale type used is CENTER_CROP, so not specifying anything should also give the correct results.

`setImageBitmap` should not be used with Fresco. Another reason why this is not working could be your custom layout params.
 How do you use Fresco? Could you provide a minimal example where we can reproduce the problem?
 We'll look into it. @bpappin could you reproduce this in the showcase app? I tested with Media Provider example to use a local image (`DraweeMediaPickerFragment.java`) but I cannot reproduce it, also tried with RelativeLayout and it is also working fine.

Are you sure you're setting the image using `setImageURI()` method?  Do you have a sample image / code / minimal example so that we can reproduce the issue?
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs that is way more performant, especially in the case where you display multiple images. Let us know if you're still experiencing problems with 1.4.0.  Sorry for the late response. You can do something like

```
CountingMemoryCacheInspector.DumpInfo memoryCacheDumpInfo = new CountingMemoryCacheInspector<>(Fresco.getmagePipelineFactory().getBitmapCountingMemoryCache())
                .dumpCacheContent();
// do something with memoryCacheDumpInfo
```  Thanks @s1rius , looks good!
 @facebook-github-bot import
 This does look good.

However, I've looked at `getParentDrawableAtIndex()` and realised that will create an object just to then check if the thing inside is null. A `hasDrawableAtIndex()` method would be much better.
 @s1rius updated the pull request - [view changes](https://github.com/facebook/fresco/pull/1432/files/6c0b1149ab47853c483525663804ae0dd12ea938..376984bee1faaec0783d6a088a00ba082420b88c) - [changes since last import](https://github.com/facebook/fresco/pull/1432/files/a578a752286671a591b27d5a7aa4d35b73e89aab..376984bee1faaec0783d6a088a00ba082420b88c)
 Thanks for your patience with me. This looks great now.

@facebook-github-bot import
  How are you using Fresco? How big are your images? Animations?
I see that you're using a RecyclerView, are you unbinding the DraweeViews somewhere (setting the URI to null)?

There are also [similar discussions here](https://github.com/facebook/fresco/issues?utf8=%E2%9C%93&q=is%3Aissue%20oom)
 How many images are we talking about and what dimensions and file type (width x height). Are you using downsampling or resizing?
Do you re-use the controller (e.g. like here https://github.com/facebook/fresco/blob/master/samples/scrollperf/src/main/java/com/facebook/samples/scrollperf/fragments/recycler/DraweeViewHolder.java#L68 )?

You stated "the point is the SimpleDraweeView hold the context".
[Every view on Android holds on to the context](https://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/core/java/android/view/View.java#3476), you should not hold on to the view when your Activity is destroyed.
  This works for me for a sample app. Do you have a minimal code example that doesn't work for you?

I've used this:

``` java
DraweeController controller = Fresco.newDraweeControllerBuilder().setImageRequest(
        ImageRequestBuilder.newBuilderWithSource(Uri.parse("http://lorempixel.com/800/800/?random=" + Math.random()))
                .setPostprocessor(new BasePostprocessor() {
                    @Override
                    public void process(Bitmap bitmap) {
                        Log.d(TAG, "Postprocessor.process");
                    }
                })
                .build())
        .setControllerListener(new BaseControllerListener<ImageInfo>() {
            @Override
            public void onFinalImageSet(String id, ImageInfo imageInfo, Animatable animatable) {
                Log.d(TAG, "BaseControllerListener.onFinalImageSet");
            }
        })
        .build();
simpleDraweeView.setController(controller);
```

Output is as expected:
Postprocessor.process
BaseControllerListener.onFinalImageSet
 I see what you mean.
However, it's working as expected since that's exactly what the `BaseRepeatingPostprocessor` is for. It has an `update()` method that runs postprocess again and updates the image. That's why `onFinalImageSet` is never called since there never is a final image (because you could call `update()` at any time).
That's why you can use `onIntermediateImageSet()` in this case. However, if you do not need to postprocess multiple times, just use a normal `BasePostprocessor` instead.

More information can be found here: http://frescolib.org/docs/modifying-image.html
  Thanks for the pull request @dbnoise. Could you tell me why you would need to know the original image size? 
 I've just been reviewing this PR again and I can see how this could be useful.

However, Fresco supports two approaches to resizing images and this PR only covers the downsampling approach. The alternative involves transcoding to a smaller encoded image in the `ResizeAndRotateProducer` and if that happens the "original" width and height returned would be the smaller values from the `EncodedImage` created there.

As things stand I don't see a simple way to pass those original values but I'd welcome your thoughts if you think this pull request could be amended to cover that case too. This has been marked as needs-revision for over six months so I'm going to close. If someone still has a strong need for something like this, please make the necessary changes and re-open.  Hi!

You should use [ProGuard](http://frescolib.org/docs/proguard.html) and you can also use [ABI splits](http://frescolib.org/docs/multiple-apks.html) to make the APK much smaller.

For example, a simple test application that I just built has 690 kB without Fresco and 953 kB with Fresco for the armeabi-v7a architecture, so Fresco adds approx. 250 kB to your APK. For 64bit builds, the APK gets ~50kb bigger since the native libraries take up a bit more space.

We might try to make the core library even smaller in the future.
  Please take a look at http://frescolib.org/docs/building-from-source.html

There is also a discussion going on in #1114 and #938.
  Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks for the pull request @gtpark. I've added some inline comments.
 @facebook-github-bot import
  Thanks for the info @lucas34.
If you find unnecessary dependencies, feel free to send a pull request to remove them if you want.
Otherwise, we might do a cleanup when we have some free time.

In terms of APK size, this shouldn't make a difference though. 
Both Bolts and support-v4 are used in the core imagepipeline, which is always required when you use Fresco. However, I agree that we should keep the codebase clean.
  Hi @jyh149129,
we're uploading files now :) 
 @jyh149129
Done! :) 
  This is related to the rounding mode and scale type that you're using. Take a look at #153, #208 and #1110 to find out why this is happening.
  Amazing, thank you! :)
  Hi @jmbusby,
in order to have the Postprocessed image into cache you should just provide implementation for the getPostprocessorCacheKey() operation as you did. Are you using Drawee? The fade is something from Drawee and not related to Postprocessor. 
Anyway we'll add the cache flag to the scrolperf app in the samples as an example of this feature.
Thanks
 Hi @jmbusby,
the cache implementation we use for postprocessed images is the same we use for "normal" images. That's the reason we use 2 different keys and this is the reason because they should always be different. I've seen you have implemented your CacheKey implementing the interface directly but you could use SimpleCacheKey instead. Anyway, the containsUri() operation is just used in order to create predicates for cache eviction. It's useful when we want to delete all the values in cache related to the same Uri. We also use this to check if an image for a specific uri is present in cache. 
Again, your CacheKey doesn't contain the Uri but you can create one through a CacheKeyFactory implementation. It has reference to the ImageRequest which contains the Uri. 

Thanks
  See #1419
  Hi @s1rius ,
thanks for letting us know.
  Hi @Lee-Wang-Jing ,
how big is the original image? Is the image from resource right? It looks like Android is decoding the Image from the resources but this is too big. 
Thanks
 Looks like largeHeap fixed this issue.  Hi @ylbkoo 
can you provide more info please? Does this happen on specific case or always?
Thanks
 Hi @romichandra, have you followed the instructions from http://frescolib.org/docs/index.html and http://frescolib.org/docs/proguard.html ? Do the sample apps in our repository build and run when you build them locally?
 This seems to come from another (Facebook) app. It's not related to Fresco.
 Closing as this is not a supported way of including Fresco in your app. Please use gradle to include the library as documented here: http://frescolib.org/docs/getting-started.html  Hi @aguynamedrich ,
At the moment you cannot do this but we're working in that direction. 
Thanks
  Hi @54binge,
are you using Drawee or accessing the ImagePipeline directly?
Thanks
 Hi @54binge,
have you tired to se the controller to null when you're finished? 
`simpleDraweeView.setController(null);`
  Hi @iamprashant, can you provide us with the placeholder image that causes the problems and information about the device (device type and Android version) where this issue shows up?
  Thanks :)
  Pull requests are always welcome :) Closing due to lack of updates.  Hi @1181631922, have a look at `ImagePipeline.fetchEncoded` (http://frescolib.org/docs/using-image-pipeline.html) and/or `BaseBitmapDataSubscriber` (http://frescolib.org/docs/datasources-datasubscribers.html).
  Hi @hcadoid, do you see any errors in `adb logcat`?

As you mentioned that you see this bug on a particular device configuration: Do the sample applications work on that device? Can you check if your code works without `setResizeOptions` or `fresco:roundAsCircle`?
 Thanks for the logs, they have been very helpful. Your image uses the CMYK color space which is quite unusual and seems to create the problem:

```
>$ identify image.jpeg
image.jpeg JPEG 220x220 220x220+0+0 8-bit CMYK 9.03KB 0.000u 0:00.000
```

I'd suggest to create a png or a jpeg with a RGB colorspace.
 if somebody wants to add support for CMYK images, please submit a pull request. I'm closing this issue for now.  In general, Drawees are not supposed to be called this way. They should be used inside the normal layout of your application. Have a look at the `BaseBitmapDataSubscriber` (http://frescolib.org/docs/datasources-datasubscribers.html) if you are interested in getting a Bitmap.

If you really want to go this way: From the stack trace it looks like you call the `onDraw` from a non-UI thread. Try out calling this from a runnable scheduled using `Activity#runOnUiThread`. You also want to pass in a controller to avoid the warning message.
 Also, take a look at [how to write custom views](http://frescolib.org/docs/writing-custom-views.html). You can take the top level Drawable from the DraweeHierarchy and draw it manually (and properly forward attach / detach calls).
  Hi @deejaygeekout , this seems to be a (configuration) problem with the `dexguard` tool that you are using instead of the classic `proguard`. It mentions an dex method index overflow (>65k).

You might want to reach out to the Dexguard developers and optionally point them to this documentation: http://frescolib.org/docs/proguard.html
  Did you set up ProGuard correctly? http://frescolib.org/docs/proguard.html
  Thank you very much @pungrue26, looks good!

@facebook-github-bot import
  A screenshot would be really helpful to see what you mean with "pixel shadow".
 Yeah, you're right this seems to be a bug. The image has the same size as the white border and you see the image leaking through the edges. We should make the underlying image smaller if we have a border.
 As a workaround, you can add `fresco:roundingBorderPadding="${the border width}"` in xml as suggested by @s1rius in #1525 
 Also, there is now the possibility to scale the image within the border, see d4bcaf98e23e6bdd964650350a380667066bfa93  We currently don't support re-initializing Fresco, which leads to these memory leaks.
However, we might support this some time in the near future.
 Also, you want to switch this for each image request? how would this work in your case when you load multiple images from different servers and the user is on a slow network. This would re-initialize everything mid-loading. Can you not configure OkHttp to correctly handle this internally?
What does `ImagePipelineConfigFactory.getNewOkHttpImagePipelineConfig(...)` do?

IMO this should be handled by OkHttp and Fresco should only be initialized once.
 Another alternative would be to write your own simple backend that handles this correctly. It's just 2 classes and you can have all your endpoints and forward to the correct one, see https://github.com/facebook/fresco/tree/master/imagepipeline-backends/imagepipeline-okhttp3/src/main/java/com/facebook/imagepipeline/backends/okhttp3
 Yeah, writing your own `BaseNetworkFetcher<OkHttpNetworkFetcher.OkHttpNetworkFetchState>` should be the best solution here since re-initializing Fresco all the time would clear all the memory caches etc. - which is not really what you want.
  How big are your images? How many images are you holding on to? Do you use animations?
You can try and resize your images or downsampling.
There are already many [similar threads](https://github.com/facebook/fresco/issues?utf8=%E2%9C%93&q=is%3Aissue%20is%3Aclosed%20oom) about OOMs.
 Closing old issues.  You should use DraweeView though (or if you really need to implement a [custom view](http://frescolib.org/docs/writing-custom-views.html) that does everything that's required) since ImageView doesn't handle the lifecycle correctly and which leads to memory leaks.

You're using BaseBitmapDataSubscriber, and call `imageView.setImageBitmap(bitmap);`, which is **not** going to work. You set the bitmap that you get to your `ImageView` but if you take a look at the [JavaDoc](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/datasource/BaseBitmapDataSubscriber.java#L74) for the method, you'll see that Fresco will automatically free the memory afterwards.

For different sizes: You're using `bitmap.compress(Bitmap.CompressFormat.JPEG, 60, stream);` and I suppose that the implementation (or the parameters) are different compared to iOS, which leads to different file sizes.

I also don't see where you actually compare the local cache size with the one on the server.
In general, I think that relying on the file size is not the best idea, but if you really want to, something like this should work:
- Use `SimpleDraweeView`.
- Have a custom `CacheKeyFactory` that you set for the `ImagePipelineConfig` and that you then use when initializing Fresco (`Fresco.initialize(context, imagePipelineConfig)`). Now, everything should automatically use correct CacheKeys for your Firebase setup.
- You can then use URIs (or ImageRequests) directly to fetch your images (`draweeView.setImageURI(uri)`).
- Before you do that, you have to check if the image needs to be re-fetched and evict the old image from the cache if so (I didn't actually test this but something like this should work):

``` java
if (Fresco.getImagePipeline().isInDiskCache(uri)) {
    ImageRequest cachedRequest = ImageRequestBuilder.newBuilderWithSource(uri).setLowestPermittedRequestLevel(ImageRequest.RequestLevel.DISK_CACHE).build();
    DataSource<CloseableReference<PooledByteBuffer>> dataSource = Fresco.getImagePipeline().fetchEncodedImage(cachedRequest, null);
    dataSource.subscribe(new BaseDataSubscriber<CloseableReference<PooledByteBuffer>>() {
        @Override
        protected void onNewResultImpl(DataSource<CloseableReference<PooledByteBuffer>> dataSource) {
            if (dataSource.hasResult()) {
                int localSize = dataSource.getResult().get().size();
                if (localSize != remoteSize) { // or whatever your re-fetch condition is
                    Fresco.getImagePipeline().evictFromCache(uri);
                }
            }
        }

        @Override
        protected void onFailureImpl(DataSource<CloseableReference<PooledByteBuffer>> dataSource) {

        }
    });
}
```
 If you use my code above, the size comparison should work since you don't compress the image on the client again but take the size of the original image that you've downloaded from the server.

How do you request data from the server then if you don't have a URI? E.g. in the beginning nothing is cached locally and you have to set something?

Fresco manages all the caching for you. For example, if you have a URI that is "http://something.com/image.jpg", you just set it. If you're offline, it will not show and your placeholder / error images will be displayed. If you're online and the image is not cached, it will try to download, cache and display it.

If the file is in cache, it will automatically take it from there.
 As I've said above, Fresco should automatically use the cached file for you.
For example, if you have a URI "http://something.com/image.jpg" it will NOT always use the one from the network. If the image is already in cache, it will detect that and use the cached version. Only if the image is not in the cache, it will go through the network and fetch the image (e.g. the first time you see the image or if your cache is full and the old image got evicted).
You can verify this by monitoring the network traffic of your app (e.g. with Stetho).
 I guess the easiest solution would be to just store (cache) the URI somehwere locally on the device (depending on how many of them you actually have).
 Great to hear that it works now!
  Thanks for your PR @0mok ! We'll take a look at this :)
 Sorry for the delay. We'll have to test this internally first to make sure that this works for our apps.

I'm also working on a new implementation for animated images altogether that doesn't have this issue. Should be available soon. @oprisnik - is this still relevant or can we close it? We're about to release an improved implementation for animations that doesn't have these issues any more, so I think we can close this.

Thanks again @0mok for looking into this. If you have suggestions on how to improve the new implementation, feel free to open new pull requests.

I'm also going to post an update here when the new version is ready. Now released in [v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0).  pull merged
 .........
  I suppose you get a crash when you start your app that's something like `UnsatisfiedLinkError: couldn't find "libmemchunk.so"`.
In that case, there are already a lot of questions around this topic, so please do [a quick search](https://github.com/facebook/fresco/issues?utf8=%E2%9C%93&q=is%3Aissue%20libmemchunk.so) and look for example at #410, #429 or other search results.
  Closing old issue due to lack of updates  On the `ImageRequestBuilder` for the individual `ImageRequest`s you can call `disableDiskCache()`.

Alternatively, you can create your own `nullFileCache` by extending `FileCache` and implement the methods s.t. they have no effect. You then inject it into the `ImagePipeline` using `ImagePipelineConfig#setFileCacheFactory`.
 @contrudar That should work, but using disableDiskCache() should be a better alternative.  Hello @kirwan,

I've created a new pull request with commits rebased to https://github.com/facebook/fresco/commit/c5f6bbc83edfa83ddccc03e06d16d339190ad55a

Thanks,

Eric

origin pull request was https://github.com/facebook/fresco/pull/1377
 Thanks, that's cleaner.

We'll need to run some internal tests but we can do that now.

@facebook-github-bot import
 Hello,

Changes are similar to those done to switch to libwebp 0.5.0 : 
- https://github.com/facebook/fresco/commit/05968b99f25378938c9f7d825d9948d5bdaa5837
- https://github.com/facebook/fresco/commit/d5f85189dbfd84809691512d4a09d0567a14eab8
- https://github.com/facebook/fresco/commit/f8ca12e704e990977f1d788080e5fb2eadfe04f5

Thanks,
Eric
  Hi @maikoulin, can you provide us with some more details? Especially, I'd like to know if you've followed the steps http://frescolib.org/docs/proguard.html and if the issue also appears in debug builds without obfuscation.
 Please update to the latest Fresco version and update your proguard configuration according to http://frescolib.org/docs/shipping.html  Thanks for the PR @Roma-Lis!
We're looking into adding custom decoders for Fresco so that you can simply plug in your own decoders, like this one for SVG.
The format shouldn't be too different from the current implementation, so it should be pretty easy to adapt your code once this is ready.

We'll keep you updated! 
 Yeah, we are working on making pluggable decoders. We don't know the view dimensions before, but we can enforce that resize options have to be set for the `ImageRequest`.
 Also, for your PR: you can just add the Gradle dependency (`compile 'com.caverock:androidsvg:1.2.1'`)instead of copy-pasting the whole library.
 We now have custom decoders and will be adding a sample very soon for using SVG within Fresco.

I'm closing this pull request but please take a look later in the week. A very simple example for SVG support (using the same library as you've used in this PR) can be found here: https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg 

I didn't check if the functionality is exactly the same as in your `SvgDecoder`, but you can just modify the custom decoder to achieve whatever you want.

Thanks for your time!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thanks @KoMinkyu for the PR :) I've added some comments inline. To make this PR awesome, please also update/extend the current test cases in `BufferedDiskCacheTest`: https://github.com/facebook/fresco/blob/a80a7ec2e68c7e21531d9d49b0eb042a04e52b20/imagepipeline/src/test/java/com/facebook/imagepipeline/cache/BufferedDiskCacheTest.java#L119-L129
 Thanks a lot for the update!

I'd argue that `isInDiskCacheSync(final Uri uri)` is currently giving a wrong/bad answer. I'd expect that people using this method usually want to know if the image is in any disk cache s.t. they can route some application logic. An example would be to show articles first where images are available w/o network fetch. Currently, their code might make a non-optimal decision.

The async `DataSource<Boolean> isInDiskCache(final Uri uri)` also checks both caches.

What I meant with the "in memory cache" is that we often don't need to do a full disk-sweep for the cache check duet to this recent improvement: https://github.com/facebook/fresco/commit/c5e8a450527f3566de48198b836e66df6661847e

This method is executed before the slow real check is performed: https://github.com/facebook/fresco/blob/4e52672dcde4821254f870935dcf0d49156bd626/imagepipeline-base/src/main/java/com/facebook/cache/disk/DiskStorageCache.java#L582-L595
 Awesome! I'll import it and maybe adapt some parts to our style guide. You'll see an update here once we've merged it

@facebook-github-bot import
  See Stackoverflow.
  Thanks for the PR!
 Thanks for updating, we'll take a look shortly!
 Looks better now, thank you! I'll update some formatting (indentation of ZoomDoubleTabListener) myself before landing.
 I've added double tap and double-tap-and-scroll to zoom in 6309246. Thanks for the contribution @xjy2061 but I'll have to close this now.  I assume that the problem has been fixed with newer Fresco versions. Please let us know if you're still experiencing this issue.
  Have a look at the sample app `scrollPerf` on how to use Fresco with a list view.

Please provide more details (full log, minimal repro) if the issue persist.
 I'm closing this issue since it's more than a year old. Feel free to comment if this is still an issue.  Can you tell us if you are using the latest version `0.12.0`?

If the issue persists, please provide some additional information. Ideally a minimal piece of code that can reproduce the issue. Also let us know about the Android version you are using.
 I assume the problem has been resolved. If not, please let us know.  Hello,

Switch to libwebp 0.5.1

Some libwebp files have moved and some others have been sliced since libwebp 0.5.0

The switch has been tested on device with no webp support and which need static-webp module.

Eric
 Thanks very much Eric. This has reminded me that your previous PR has slipped through the cracks again. Sorry for that. I'll start by importing than then ask you to rebase this one so that this PR is clean of those changes.
 Ok @kirwan 
Thanks
  The image you've shared here looks a lot like a JPEG (in which transparency isn't supported) but that might just be from your screenshot. Can you share the URL of the image in question?
  -1 is an illegal value for either parameter in the `ResizeOptions` constructor and will throw that exception. If `ScreenUtils.dp2px(int)` can return -1 I suggest checking the `width` and `height` values you have before creating `ResizeOptions`.
  Hi @ArtisanM, can you clarify the issue you are facing? Is it about missing persistency of the attribute or about a wrong display of the color? Ideally, you can provide us with an example that helps us to reproduces the issue.

Additionally: Are the themes you are mentioning on OS level or are they specific to your app?
  Thanks for both of those, I'll update the Proguard file we point people to.

We have fixed the animated GIF example but that's not been released yet, so you're right that bug still exists in the latest release.
  The documentation seems correct to me.

You can see how the repeated post processor works internally here: https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/request/BaseRepeatedPostProcessor.java#L25-L29

For your code, you just need to make sure that the `update()` method is called in your new sub class when you want to re-apply the post processor (as it is done in the example).  The callbacks will be set by the internals of the ImagePipeline.
  We will look into this. If you'd like to send us a pull request it would probably happen a bit sooner though.
 Hello,

This have been done here :  https://github.com/facebook/fresco/pull/1388

Thanks,

Eric
 Hello,

I think this should be closed.

Thanks,

Eric

https://github.com/facebook/fresco/commit/c142b3e84774a87594344613be4fad77f90f726f
  It seems that shrinker is currently only experimental, as per this page: http://tools.android.com/tech-docs/new-build-system/built-in-shrinker

So, if you're having a problem it might be worth creating an issue in Google's Issue Tracker. Also, you could try removing the `useProguard false` line to use Proguard instead of the new shrinker.

I've just tried to reproduce your issue with the Fresco demo app but have not been able to.
  Do you add gif module?
http://frescolib.org/docs/index.html#_
  You shouldn't use the bitmap. Is that Chris Banes's PhotoView project that you're using? On the [GitHub page](https://github.com/chrisbanes/PhotoView) it says Fresco isn't supported but points to [ongakuer's](https://github.com/ongakuer/PhotoDraweeView) project which does.
 Closing as the reported did not provide additional information needed to proceed  You should use different controllers for different `DraweeViews`. 
Internally, each controller is bound to a `DraweeHierachy` (which holds the drawable that you see on screen and which is usually unique per DraweeView). When you attach a controller to a DraweeView, it updates the given hierarchy, so it will be set to the one of the second view for your example.

In theory, 2 views could share the same `DraweeHierarchy` (just set the same hierarchy for both, for example with `draweeView2.setHierarchy(draweeView1.getHierarchy())`). But then one of the views will not be updated when the state changes (e.g. when the network image is loaded) since the `Drawable.Callback` is set to only one of the two views. So the other view is not aware that it needs to update. It would be possible to write a custom `Drawable.Callback` that knows about all views that use the same `DraweeHierarchy` and invalidates all of them.
However, I would suggest that you use 2 separate controllers.
  Thanks @huangjunkun for your thorough answer. I'll close this issue as I think that answers it.

I'll add that both memory and disk cache employ LRU eviction. The future timestamp check in disk cache is additional to cover scenarios where the device time changes and cached items now appear to have been cached in the future. These could otherwise be retained indefinitely while more recent items are evicted.
  While I see your point that having finalizers adds a marginal perf penalty I don't think that it's the major cause for the memory issues here.
Fresco uses deterministic memory management so if used correctly all the memory is freed up before you get to the finalizer.
If it not used correctly (which being an open source library we can't guarantee) we're using the finalizers to clean up the memory. The reason we're doing this is because we're using the ashmem, which is a shared memory - so if you hold on to memory you might degrade not just your apps but the phones experience.

We're going to take another look at the perf penalty and the reason why you see so many FinalizerReferences - but I really don't think that's the cause for high memory usage.

Both Facebook and Twitter are using Fresco - so if there would be any regression we'd see that in our graphs very-very early and it would effect us in a major way.
 @fab1an:
As I said before: "We're going to take another look at the perf penalty and the reason why the FinalizerReferences are not collected - but I really don't think that's the cause for high memory usage."

As with every engineering decision there's a tradeoff here:
- on one hand you can gain CPU cycles
- on the other hand you're risking leaking huge portion of shared memory

The question is how do you evaluate this tradeoff: what is exactly the perf penalty and how much you can loose if you leak a bitmap.

Example:
According to your measurements an object initialization takes 4.6us instead of 1.7us. Although that is 3x, you're not likely to have more than 100 objects on a screen at once, which is still 0.46ms instead of 0.17ms - which even in this extreme case would be a small portion of the frame (16ms) so it would not result in a skipped frame.

On the other hand if you forget to close a CloseableReference - which can happen very easily, since deterministic memory management is very alien for Java - you can leak a a few MB of Android Shared memory easily. On low end phones memory is much more valuable than CPU cycles.

---

Now here the real cost is the GC for the finalizers - and since Android is not Java we need to measure the penalty on both Dalvik and ART GC to understand what does that really mean to make that tradeoff.

Getting rid of the finalizers introduces the risk of leaking huge amount of memory - and since this is an open source library and we can't control the callers + deterministic memory management is an unusual thing in Java this is a real risk.
 @fab1an : you've already done some great analysis on this, I'd be happy if you'd help us analyze the cost of the GC penalty for Finalizers on Dalvik and ART. (A bit deeper than there's a second pass GC and object references on the heap).
 Oh, and yes, you're right: we need to fix the animated images
 @brianhama that is a red herring: the vm will create a `FinalizerReference` for each object that has a `finalize()` method. What you're looking at is not necessarily the queue of objects waiting to be finalized, but merely the list of all object instances implementing `finalize()`. The retained size is obviously huge, as it will include all the images that are on screen or in the bitmap cache.

Relating to the finalizers issue: we've run an experiment over a couple of months where we provide a separate implementation of `CloseableReference` that does **not** implement `finalize()`, but uses `PhantomReference`s to clean up the native memory. In the millions of devices that have participated in the experiment, we have **not** seen statistically significant improvements in:

* crashes in general
* out of memory crashes
* scroll performance
* cpu usage
* battery drain

In conclusion, we will be sticking with finalizers for now. There's not much more data than "none of our metrics changed" :), and if there were, I doubt I could post it. Just to clarify, this is not to say that finalizers are good, but that alternative options such as PhantomReferences are not necessarily better. And we're not in a place where we can live without a solution for this.  Hi @646448434, have a look at our sample app `scrollperf` on how to use Fresco with a list view. If the issue persists, please provide us with a small example that can reproduce the issue.
 I assume the problem has been resolved. If not, please let us know.  Fresco is using deterministic memory management and reference counting with the ClosableReferences.
If you have an ImageView holding a CloseableReference to a bitmap and there's another CloseableReference pointing to the bitmap from the cache the counter is 2. If you clear the cache, you decrease the counter to 1 but you still have a reference to the bitmap from the ImageView, so the memory is not freed up until you either get rid of the ImageView or close the reference from the ImageView.
So clearing the cache will not help if you have Views holding on to the bitmaps. I suspect there's a bug in RN which will not close bitmap references in some weird cases.

cc @aagnes, @oprisnik to confirm
 AFAIK mCount and mSize is only counting the size of our cache - not the system memory taken up by images. When you launch clearCAches() the cache should not hold on to any bitmaps anymore. Bitmaps that were _only_ in the cache should be freed up. Bitmaps that have other references to them should still be around.

> The leak happens when you reload the react-native JS bundle or quit with launching again.

Yes, I've seen your other issue in the React Native thread and we'll look into this. My guess is that when you reload the old references are still around.
  The log indicates that instant run was enabled for the build. If this bug report is still relevant, try disabling it and see if that helps.  Hello,

I have it running on one app project with Fresco 0.11.0. 

1- clone the Fresco repository on a local folder, out of Android Studio project folder
2 - modify project settings gradle :

`include ':app'`
`include ':fbcore'`
`project(':fbcore').projectDir = new File('/way_out_of_project/to/git/fresco/fbcore')`
`include ':drawee'`
`project(':drawee').projectDir = new File('/way_out_of_project/to/git//drawee')`
`include ':drawee-backends:drawee-pipeline'`
`project(':drawee-backends:drawee-pipeline').projectDir = new File('/way_out_of_project/to/git/fresco/drawee-backends/drawee-pipeline')`
`include ':imagepipeline'`
`project(':imagepipeline').projectDir = new File('/way_out_of_project/to/git/fresco/imagepipeline')`
`include ':imagepipeline-base'`
`project(':imagepipeline-base').projectDir = new File('/way_out_of_project/to/git/fresco/imagepipeline-base')`

because gradle complain of some missing dependencies when build : 

`include ':imagepipeline-test'
project(':imagepipeline-test').projectDir = new File('/way_out_of_project/to/git/fresco/imagepipeline-test')`
`include ':imagepipeline-base-test'`
`project(':imagepipeline-base-test').projectDir = new File('/way_out_of_project/to/git/fresco/imagepipeline-base-test')`

optional : 

`include ':imagepipeline-backends:imagepipeline-okhttp3'`
`project(':imagepipeline-backends:imagepipeline-okhttp3').projectDir = new File(/way_out_of_project/to/git/fresco/imagepipeline-backends/imagepipeline-okhttp3')`
`include ':static-webp'`
`project(':static-webp').projectDir = new File('/way_out_of_project/to/git/fresco/static-webp')`

3 - I have added in app module build.gradle : 

`compile project(':fbcore')`
   `compile project(':drawee')`
   `compile project(':drawee-backends:drawee-pipeline')`
    `compile project(':imagepipeline')`
    `compile project(':imagepipeline-base')`

optional : 

```
`compile project(':imagepipeline-backends:imagepipeline-okhttp3')`
`compile project(':static-webp')`
```

4 - I have replaced my project build.gradle with the one used for Fresco project (as it is convenient to me) 

`buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath "com.android.tools.build:gradle:${ANDROID_GRADLE_PLUGIN_VERSION}"
        classpath "de.undercouch:gradle-download-task:${GRADLE_DOWNLOAD_TASK_VERSION}"
        classpath "com.jfrog.bintray.gradle:gradle-bintray-plugin:${GRADLE_BINTRAY_PLUGIN_VERSION}"
        classpath "com.github.dcendents:android-maven-gradle-plugin:${ANDROID_MAVEN_GRADLE_PLUGIN_VERSION}"

```
    // NOTE: Do not place your application dependencies here; they belong
    // in the individual module build.gradle files
}
```

}

project.ext {
    buildToolsVersion = "${BUILD_TOOLS_VERSION}"
    compileSdkVersion = COMPILE_SDK_VERSION.toInteger()
    minSdkVersion = MIN_SDK_VERSION;
    targetSdkVersion = TARGET_SDK_VERSION;
    preDexLibs = !project.hasProperty('disablePreDex');
}

subprojects {

```
repositories {
    mavenLocal()
    jcenter()
    mavenCentral()
}

task allclean {
}

afterEvaluate { project ->
    allclean.dependsOn(project.tasks.matching { it.name == 'clean' })

    if (project.tasks.matching { it.name == 'assembleRelease' }) {
        def jarList = new ArrayList()
        task setJarList(dependsOn: assembleRelease) << {
            configurations.compile.each {
                jarList.add(it)
            }
        }

        task copyDeps(dependsOn: setJarList, type: Copy) {
            from jarList
            into 'build/external'
        }
    }
}

project.plugins.whenPluginAdded { plugin ->
    if ("com.android.build.gradle.AppPlugin".equals(plugin.class.name)) {
        project.android.dexOptions.preDexLibraries = rootProject.ext.preDexLibs
    } else if ("com.android.build.gradle.LibraryPlugin".equals(plugin.class.name)) {
        project.android.dexOptions.preDexLibraries = rootProject.ext.preDexLibs
    }
}
```

}`

4.a - and use Fresco project gradle.properties file as my project properties - copyed in Android Studio project root folder
4.b - add/copyed release-bintray.gradle and release-sonatype.gradle from  to Android Studio project root folder

5 - in gradle Global properties file : 
`ndk.path=/way/to/sdk/ndk-bundle/r10e`
`org.gradle.daemon=true`
`org.gradle.parallel=true`
`org.gradle.configureondemand=true`

This way, I'm able to build without any error and use one forked repository from Fresco (https://github.com/eldk/fresco) with libs modification, and another one for my app project.

> I don't know why gradle keep warn me imagepipeline-base and imagepipeline is jar but not with drawee. 

I seems like drawee has a complete Android project structure thus other module are not. (Warnings from Crashlytics debug).

But not sure .

Hope that it helps.
 Closing as a workaround was suggested. This is not a very common use case, so I believe that the workaround should be enough.  Thanks for your pull request.

@massimocarli I think it looks good to me. What do you think. I'll need to import and do local testing though before taking into master.
 It would be great if you can add a video(for the animation app) as a test plan for your changes.
  duplicate of #1354 
  Are you allocating a 25M placeholderImage? You can use some tools to optimize you local image to less than hundreds KB in lossless way.
  Why exactly do you need to put the listener in onDestroy? 
 you can removeListener from controller and reset listener to null in onDestroy().
  Duplicating to #1980  Thanks for reporting the bug, what Android device are you using? It seems you're testing in 4.4.4, 4.1.2, 4.3, 4.4.2, have you encountered the native crash in >=5.0 devices? And also which Fresco library version are you using?
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated images, which might have fixed this issue. Let us know if you're still experiencing problems with 1.4.0 and we can re-open it.  We don't have a way to disable DraweeEventTracker without modifying fresco's source code at the moment. We definitely should provide a way to disable logging in the future.
 Hello,
This is done here : https://github.com/facebook/fresco/commit/8f4978ea3460e1badc1c94b5cbdf136ea583cb0e
 @eldk is right, the code to disable looks like this:

```
DraweeEventTracker.disable();
Fresco.initialize(...);
```
  Hi @MichaelArchangel 
could you provide us the stack trace please?
Thanks
 HI,
are you sure you're running 0.11? I cannot find correspondence from the line in the stacktrace and the code. 
 Hey @MichaelArchangel 
did you customize the code? Actually that's not our code. We don't provide  custom ProducerSequenceFactory. If you do that you should also provide an implementation. Anyway this is not a think you can customize in Fresco. At least at the moment. 
  Hi,
we planned to do that. At the moment you can use the [focusCrop](http://frescolib.org/docs/scaling.html#focusCrop) ScaleType. 
Thanks
 Hi @JiaoShuai,
sure I understand what you're saying. Loading a "cropped" means loading (and decoding) only the part of interest with a lot of savings in memory. That's what I meant as the plan for a kind of CropParams :) This is not in our immediate plan but if you like challenges you could create a PR for it.
Thanks
  Hi @xiedong,
the question is not related to Fresco. Anyway those lines are gray because the related namespaces are not used in the layout :)
Thanks
  Hi @646448434 
can you provide us more details please?
Thanks
 @646448434 using `setLowResImageRequest` should solve the issue for you (see http://frescolib.org/docs/requesting-multiple-images.html)

When using this, make sure that you only create one image request and controller in total.

If there's any other issue, feel free to re-open this issue.  Hi @rafaelekol,
in order to understand what is happening could you please load the same images using our scrollperf demo app? There you can insert your URLs into a string-array resource and se what is happening. 
At first look it seems that you're loading local images. Are you applying the ResizeOptions? 

Thanks
 Hi @rafaelekol,
can you double check if the downloaded files are ok? I mean, just access the file system and check if the image files are corrupted during download. 
You could also try if the same thing happens with our scrollperf app.
Thanks
 Hi all,
now in `ImagePipelineExperiments` we have 2 experimental methods which allow us to test the max number of threads during decoding and the cancellation when `ImageRequest` are cancelled. The latter is very useful for local images. In particular I'm writing about:

[max number of decoding thread](https://github.com/facebook/fresco/blob/c07bb70d457f5cd27a4dde55a177d681942563b9/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineExperiments.java#L208)

```
public ImagePipelineConfig.Builder setThrottlingMaxSimultaneousRequests(
        int throttlingMaxSimultaneousRequests) 
```

and [enabled cancellation for cancelled requests](https://github.com/facebook/fresco/blob/c07bb70d457f5cd27a4dde55a177d681942563b9/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineExperiments.java#L172)

```
public ImagePipelineConfig.Builder setDecodeCancellationEnabled(
        boolean decodeCancellationEnabled)
```

Can you please test if, changing those parameters, you have the same problem?

Thanks
 Hi @rafaelekol,
an example is into the [ScrollPerf sample application](https://github.com/facebook/fresco/blob/master/samples/scrollperf/src/main/java/com/facebook/samples/scrollperf/ScrollPerfApplication.java#L47).
Thanks
 Can you try with newer versions of Fresco @rafaelekol? The issue does not reproduce for me in our Showcase sample app, so it's hard to say what's going on. If this is still a problem, let us know!

  Hi @AllenVork,
resizing can have some performance and memory implications. Can we place face a problem at a time? Could you provide us a specific example?
Thanks
 I've tried the zoomable sample app in the Fresco project and the image looks fine for me even with downsampling turned on.

I suggest you do two things:
1. Add a comment with the image request you're using with the PhotoDraweeView.
2. Look at http://frescolib.org/docs/troubleshooting.html and follow the steps in the **Investigating issues with logcat** section. In your case, I suggest particularly looking out for a "onProducerFinishWithSuccess" log for the DecodeProducer, which will include the size of the bitmap that's been decoded.
 Hi @AllenVork, is this still causing you a problem? 
 What do you mean with "muzzy"? Do you have a sample image and can you post a comparison between original and downsampled image?  Hi @sureshperiyasamy 
These are very few information. Please read our documentation about image resizing. 
Thanks 
  All the retry logic in encapsulated into the [RetryManager](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/drawee/src/main/java/com/facebook/drawee/components/RetryManager.java) class. In order to enable this you have to invoke the `setTapToRetryEnabled()` method in the `DraweeControllerBuilder`. The default number of retry is 4 but you can obviously change it.
Thanks
 Hi @lovearthhome,
you're right. At the moment the only way is to create a class which extends RetryManager and implements the new logic. We'll add the API asap.
Thanks
  Hi @yangjianjun198 
sorry but the question is not very clear. What would you use instead if the key is an int?
Thankx
  Thank you @huangjunkun 
we're investigating about this.
  Thanks!
  Hi @caopeng000 
could you provide more information please?
Thanks
 Hi @caopeng000 
are you using Drawee or accessing the Bitmap directly?

Thanks
 Closing old issue since it needs been in "needs details" state since last year.  Hi @chonamdoo,
please try the solution [here](https://github.com/facebook/fresco/issues/410)
 Hi @chonamdoo,
I meant [this](https://github.com/facebook/fresco/issues/933#issuecomment-186266187) the usage if  [Relinker](https://github.com/KeepSafe/ReLinker) library in SoLoaderShim with Relinker.findLibrary() instead of System.findLibrary()
 Hi @chonamdoo,
have you tried with the 0.13.0?
Thanks
 WIth 1.8.0, we made SoLoader the new default, so this should be fixed. Hi @Anilugale,

we have fixed the `NoClassDefFoundError` in the 1.8.1 release after it has been found in the 1.8.0 release. Updating to that version number should fix the issue. We are sorry for the inconvenience. Oh, just seeing that your are loading Fresco as part of React?

Can you maybe create a new issue (as this seems to be different from the original issue in this thread) and provide the information asked for in the issue template? :) that will allow us to narrow down the issue that you are experiencing :) Especially, the content of your `build.gradle` file would be interesting  Yes, it works for me:

``` java
SimpleDraweeView sdv = ...;
DraweeController controller = Fresco.newDraweeControllerBuilder()
        .setImageRequest(ImageRequestBuilder
                .newBuilderWithResourceId(R.drawable.test)
                .setResizeOptions(new ResizeOptions(300, 300))
                .setAutoRotateEnabled(true)
                .build())
        .build();
sdv.setController(controller);
```

There has to be a different issue for you.
 Changing to from Bug to Enhancement Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  my app run with 20mb memory normally.After I run monkey test on my device for 12 hours,the memory usage came to 80mb.Then I found that fresco take up a lot of memory.
Is there any idea to do with it?

Objects in memory:
![objects](https://cloud.githubusercontent.com/assets/13446529/16510779/aec8446a-3f7b-11e6-8a83-dcbfa36398ae.png)

A Detail of an object:
![details](https://cloud.githubusercontent.com/assets/13446529/16510788/beda72d8-3f7b-11e6-9763-0d1b46c90466.png)
 I  use fresco in a listview with 150 items
  I suppose this is mainly because most animations would be quite big (and hence would clear everything else from the cache).
 We're also working on a new version that will cache bitmaps in the default BitmapMemoryCache. We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant, and caches animation frames in BitmapMemoryCache.  It works for me, there must be another issue with your code.
My code:

``` xml
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:fresco="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingBottom="@dimen/activity_vertical_margin"
    android:paddingLeft="@dimen/activity_horizontal_margin"
    android:paddingRight="@dimen/activity_horizontal_margin"
    android:paddingTop="@dimen/activity_vertical_margin">

    <com.facebook.drawee.view.SimpleDraweeView
        android:id="@+id/editer_icon"
        android:layout_width="32dp"
        android:layout_height="32dp"
        fresco:roundedCornerRadius="15dp"
        fresco:roundWithOverlayColor="#0000ff"
        fresco:roundingBorderWidth="1dp"
        fresco:roundingBorderColor="#ff0000"/>
</RelativeLayout>
```

``` java
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Fresco.initialize(this);
        setContentView(R.layout.activity_main);
        SimpleDraweeView sdv = (SimpleDraweeView)findViewById(R.id.editer_icon);
        sdv.setImageURI("http://lorempixel.com/800/800/");
    }
}
```

Looks like this:

![screenshot_20160630-141145](https://cloud.githubusercontent.com/assets/2699634/16489302/d4bfdaf2-3ecc-11e6-8c7b-1312c8cd21cf.png)
 Side note: you can also use `roundAsCircle="true"` since it seems that you want a circle.
 I'm closing this but if you find this is a Fresco issue, please let us know and we will investigate and reopen this issue.
  @huangjunkun updated the pull request.
 The code this was changing has mostly now been removed.  @huangjunkun updated the pull request.
 We have a plan for a slightly more sophisticated way to control resizing. With that, I don't think this change is necessary.  See the comment above the return statement for `getMaxCacheSize()`:

```
// We don't want to use more ashmem on Gingerbread for now, since it doesn't respond well to
// native memory pressure (doesn't throw exceptions, crashes app, crashes phone)
```
  `RetainingDataSourceSupplier` retains the previous image until the new image is ready. This is useful in slideshow and similar use cases.
 Looks cool and will be definitely helpful for the use-cases where we face the `flashing` images issues. I didn't comment on the change to the sample app, as I guess that you'll update that part anyway.
 For now, you can just copy paste `RetainingDataSourceSupplier.java` from the PR, should just work. We'll take a look again at this when we have some time.  Thanks!
 @facebook-github-bot import
  We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant. Let us know if you're still experiencing problems with 1.4.0.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you very much! Once you sign the CLA, I'm going to import this :)
 Thanks!
If you like, feel free to either update this diff or submit a new PR.

@facebook-github-bot import
  This works for me on API19.
I just changed the SimpleDraweeView of our `uriapp` sampe and changed the background to white.

![screenshot_20160629-122543](https://cloud.githubusercontent.com/assets/2699634/16450483/16947696-3df5-11e6-98c8-cc03d6e3ea85.png)

``` xml
    <com.facebook.drawee.view.SimpleDraweeView
      android:id="@+id/simple_drawee_view"
      android:layout_width="match_parent"
      android:layout_height="0dp"
      android:layout_weight="1"
      fresco:actualImageScaleType="fitCenter"
      fresco:roundingBorderWidth="1dp"
      fresco:roundingBorderColor="@android:color/black"
      fresco:roundedCornerRadius="4dp"
      fresco:roundTopLeft="true"
      fresco:roundTopRight="true"
      fresco:roundBottomLeft="false"
      fresco:roundBottomRight="false"
      fresco:failureImage="@color/red" />
```

(https://github.com/facebook/fresco/blob/89477f77af3b6954f57dc39b8c572b4b8eb4e84a/samples/uriapp/src/main/res/layout/activity_main.xml)

We need more information how you use Drawee.
 I assume the problem has been resolved. If not, please let us know.  Added GRADLE_OPTS according to https://circleci.com/docs/oom/ to give Gradle more memory, which fixes the build, see https://circleci.com/gh/oprisnik/fresco/30
 @facebook-github-bot import
  Why are you not using a simple DraweeView?

First of all, you're only setting 1 bitmap that is available at the beginning, which is never updated - you have to set the drawable.
Second, you don't handle the Drawee lifecycle correctly (attach / detach events, setting the Drawable callback etc.).

Please use DraweeView instead or if you _really_ need a custom view take a look at http://frescolib.org/docs/writing-custom-views.html
 As I have mentioned above, just make sure that your custom view does everything as described in http://frescolib.org/docs/writing-custom-views.html

Since you're extending `BubbleImageView`, which extends `ImageView`, you can take a look at [DraweeView](https://github.com/facebook/fresco/blob/4b94f604e0a98a999dcc1357992f8cb34b1b83b6/drawee/src/main/java/com/facebook/drawee/view/DraweeView.java).
If you want a simpler interface, you can also check out GenericDraweeView and SimpleDraweeView.

You cannot call `setImageBitmap` but have to use something like
`super.setImageDrawable(mDraweeHolder.getTopLevelDrawable());` (which is done in DraweeView as well)).
  So if I understand correctly, `fit()` takes the size of the image view and automatically resizes the image once it is downloaded?
We do not support this out-of-the-box, but it would be pretty easy to implement:
You know the size of your view, so you can just set the resize options accordingly.
If you're using match_parent, you can just get the width of the view (delay the request until you have a size) and then set the resize options: http://frescolib.org/docs/resizing-rotating.html

It might also be related that we [don't support `wrap_content`.](http://frescolib.org/docs/wrap-content.html)

The best solution would be if your images would have an appropriate size right away.
 Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  I guess the activity has to be recreated and all images have to be read from the (disk) cache, decoded etc. - which just takes some time. GIF images especially take quite some time to decode, see for example #1231.

How big are your GIFs (resolution and size) and how many do you display?
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant. Let us know if you're still experiencing problems with 1.4.0.  We have a sample app for this, called `scrollperf`.
See also the 3 classes `DraweeViewAdapter`, `DraweeViewHolder` and `DraweeViewListAdapter` [here](https://github.com/facebook/fresco/tree/master/samples/scrollperf/src/main/java/com/facebook/samples/scrollperf/fragments/recycler).
  The DownsampleUtil is used by the ImagePipeline itself, which does not know anything on how the image is used later on.
I suppose that for your case, you're using a `fit...` scaling type for your DraweeView? 
But the pipeline at this point does not know that (and different DraweeViews could have different scale types) and if we're too aggressive with downscaling and you're using cropping, the quality might be worse.
 @huangjunkun sampleSize is always an integer. 
 As commented on the PR, we're soon introducing a more flexible way of defining resize options. I think that makes this redundant.  Thank you very much @huangjunkun!

@facebook-github-bot import
 It seems that you didn't update your forked repo for quite a long time. Hence, the old version doesn't compile on CircleCI because the Android Build Tools version is too old.
  So you want to display a selected frame of a video / a preview image? Or cache a video from a server? Or play a video?
 We currently do not support adding videos to our cache. The only thing that could work is rendering a frame (as a bitmap) of a locally stored video.
 Since Fresco is an image loading library, we currently don't have plans to support adding random files to our caches in the near future.
It should be fairly easy though to write a simple file cache yourself.
  What exactly do you want to do? 
You can extend AnimatedDrawable and use it manually. If you want to use your own AnimatedDrawable extension with GIFs automatically with Fresco, I don't think that we provide an easy way to do this.
You would have to modify `AnimatedDrawableFactoryImpl` to return your drawable that extends AnimatedDrawable or create a new `AnimatedDrawableFactoryImpl` for your case.
 I think there is no easy way to do this without changing Fresco. I would suggest that you use smaller GIFs from the beginning (maybe let the server resize them for you) since such large GIFs will take up a lot of network traffic and it will also take quite some time to decode them (see #1231 for example).
We currently don't support downsampling / resizing for GIFs.
 It's possible to create a custom decoder and DrawableFactory that does what you want, see https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat for some examples.  I have been using fresco in my project and updated from version 0.10.0 to 0.11.0.
In case of adapters displaying image in viewholders there is a large memory usage in version 0.11.0 and the memory is not getting freed leading to slow scroll.

I am new to memory leaks and don't know how to use MAT so I reverted back to version 0.10.0.

Also, image loading is relatively slow. Is there some kind of imagepipeline configuration you can help with?
 You noticed higher memory usage only with 0.11.0? How much of a difference is there compared to 0.10.0, how are you using Fresco and what kind of images.

For slow loading images: We need more information which images you're using (size, type etc.).
 Good to hear that you solved the issue.

You should consider only serving images that roughly match the size of your views so that you don't have to fetch huge images that are never used. This decreases the network traffic for your user and speeds up everything.
If you have to use resizing, take a look at the documentation here: http://frescolib.org/docs/resizing-rotating.html

If by 2 images you mean a low-res and a high-res image on top of each other: We support this out-of-the-box. The DraweeControllerBuilder has `setLowResImageRequest` and `setImageRequest`.
  Hello,

Testing Fresco with .setDownsampleEnabled(true) on one API 17 device, I don't have the downsample fresco logs (RequestLoggingListener).

With another device, that is API 10, files are well downsampled. I could see the RequestLoggingListener lines.

The API 10 device, with same Fresco settings (downsample and resize to same size) is fastest (about x2 to x4 ) to decode picture that the API 17 one.

API 10 : 
`RequestLoggingListener: time 210302582: onProducerFinishWithSuccess: {requestId: 11, producer: DecodeProducer, elapsedTime: 273 ms, extraMap: {bitmapSize=1600x1067, queueTime=0, imageType=DEFAULT, isFinal=true, hasGoodQuality=true}}`

API 17 : 
`RequestLoggingListener: time 89545018: onProducerFinishWithSuccess: {requestId: 52, producer: DecodeProducer, elapsedTime: 928 ms, extraMap: {bitmapSize=1600x1067, queueTime=2, imageType=DEFAULT, isFinal=true, hasGoodQuality=true}}`

On API 10, I can find the Downsample log line : 
`DownsampleUtil: Downsample - Specified size: 2048x2048, image size: 1600x1067 ratio: 1.3 x 1.9, ratio: 1.919 for http://domain.tl/picture.jpg`

Thus I can't in API 17.

I have read this (http://frescolib.org/docs/configure-image-pipeline.html#_) and see downsample is experimental, but which Android version are supported, and which are not ?

This have been tested with fresco 0.10.0, 0.11.0.
All tested pictures are prefetch to disk and stored there before to be displayed.

Greatings,

Eric
 Hello,

I think it's a bug related to webp usage : 

If I prefetch a jpg picture, then display it, downsample is well done for API 17 : 

`DownsampleUtil: Downsample - Specified size: 2048x2048, image size: 4133x2554 ratio: 0.5 x 0.8, ratio: 0.802 for http://domain.tld/img.jpg`

If I prefetch a webp picture (named img.jpg and not img.webp), then display it, downsample is not done : 

I use mod_pagespeed (https://developers.google.com/speed/pagespeed/module/): 
- the requested picture filename is always something.jpg
- the UA and accept header are always "faked" with the use of okHttp.

A curl example of a request : 
`curl -H "Accept: image/webp,image/*,*/*;q=0.8" -A "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36" http://domain.tld/picturefolder/image.jpg`

The server response : 
`HTTP/1.1 200 OK
Server: nginx
Content-Type: image/webp
Content-Length: 86864
Connection: keep-alive
ETag: W/"PSA-aj-9k8tbmsEil"
Date: Sat, 18 Jun 2016 22:51:28 GMT
Expires: Mon, 27 Apr 2026 08:13:48 GMT
Cache-Control: max-age=310987340
Vary: Accept`

exiftool img.jpg : 
`ExifTool Version Number         : 9.16
File Name                       :img.jpg
File Size                       : 85 kB
File Modification Date/Time     : 2016:06:19 01:37:17+02:00
File Access Date/Time           : 2016:06:19 01:40:00+02:00
File Type                       : WEBP
MIME Type                       : image/webp
VP8 Version                     : 0 (bicubic reconstruction, normal loop)
Image Width                     : 1600
Horizontal Scale                : 0
Image Height                    : 1067
Vertical Scale                  : 0
Image Size                      : 1600x1067`

So, the response is always a webp, from API 10 to ...

I stiil have to try with one pictures simply named img.webp ...

Thanks,

Eric

`
 Hello,

> I stiil have to try with one picture simply named img.webp ...

Test KO : no log for downsampling, and DecodeProducer is longest for about x4 compare to API 10

`RequestLoggingListener: time 348148: onProducerFinishWithSuccess: {requestId: 0, producer: DecodeProducer, elapsedTime: 811 ms, extraMap: {bitmapSize=1600x1067, queueTime=1, imageType=DEFAULT, isFinal=true, hasGoodQuality=true}}`

Looking at this : 
- https://developers.google.com/speed/webp/faq#what_is_webp_why_should_i_use_it
- http://frescolib.org/docs/webp-support.html
- https://developers.google.com/speed/pagespeed/module/filter-image-optimize

I have tryed to force lossy webp request (as it's API 17) and see if downsample is done : No change : KO.

Full fresco logs from combined tests with API 10 vs API 17  (picture is the same for all runs):

[logs_fresco_downsample_webp.txt](https://github.com/facebook/fresco/files/322334/logs_fresco_downsample_webp.txt)

two android API 17  debug info : 
`06-19 16:47:20.084 29781-30199/tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imagepipeline.nativecode.Bitmaps.reconfigureBitmap`
`06-19 16:47:20.094 29781-30199/tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imageutils.BitmapUtil.getSizeInBytes`

https://github.com/facebook/fresco/issues/220

But image is wrap with aspect ratio :
http://frescolib.org/docs/using-drawees-xml.html#wrap-content

`final RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT,
                            RelativeLayout.LayoutParams.WRAP_CONTENT);`

build draweeView with params : 
`imageView.setLayoutParams(params);
                    imageView.setPadding(0, 10, 0, 10);
ficheEspece.addView(imageView, params);`

request picture

Then set aspect ratio : 

`imageView.setAspectRatio(1.62f);`
 Hello,

Setting fixed values to width and height for layout does not solved - "webp pictures are not downsampled  for API 17": 

`06-21 18:16:09.826 21639-22178/tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imagepipeline.nativecode.Bitmaps.reconfigureBitmap`

`06-21 18:16:09.826 21639-22178//tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()I`

`06-21 18:16:09.826 21639-22178//tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imageutils.BitmapUtil.getSizeInBytes`

`06-21 18:16:09.826 21639-22178//tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()I``

The diff from API10/API17 is that all off previous logs are not present.

For API 10 the logs are only: 

`06-21 18:32:34.779 22163-22198/tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()I`
`06-21 18:32:34.779 22163-22198/tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 627: Landroid/graphics/Bitmap;.getByteCount ()I`

and the picture is downsampled :

`06-21 18:32:34.809 22163-22199/tld.domain.app V/unknown:DownsampleUtil: Downsample - Specified size: 320x480, image size: 1600x1067 ratio: 0.2 x 0.4, ratio: 0.450 for http://domain.tld/picture.jpg`

and deco
 Here :   https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/DownsampleUtil.java#L38 

`EncodedImage.isMetaDataAvailable(encodedImage)` is always false with webp in API 17 thus it's not in API 10.

`EncodedImage.isValid(encodedImage)` return true on both API 10 and API 17.
 Hello,

As request is made with same headers with okHttp (3 now), the same picture send to both device with API 10 and API 17 have same size :  `GET /palourde_bleue-2.jpg HTTP/1.1" 200 86864`. 

The .ext is .jpg, but it's a webp : 

`A curl example of a request :
curl -H "Accept: image/webp,image/*,*/*;q=0.8" -A "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36" http://domain.tld/picturefolder/image.jpg`

The server response :
`HTTP/1.1 200 OK Server: nginx Content-Type: image/webp Content-Length: 86864 Connection: keep-alive ETag: W/"PSA-aj-9k8tbmsEil" Date: Sat, 18 Jun 2016 22:51:28 GMT Expires: Mon, 27 Apr 2026 08:13:48 GMT Cache-Control: max-age=310987340 Vary: Accept`

exiftool img.jpg :
`ExifTool Version Number : 9.16 File Name :img.jpg File Size : 85 kB File Modification Date/Time : 2016:06:19 01:37:17+02:00 File Access Date/Time : 2016:06:19 01:40:00+02:00 File Type : WEBP MIME Type : image/webp VP8 Version : 0 (bicubic reconstruction, normal loop) Image Width : 1600 Horizontal Scale : 0 Image Height : 1067 Vertical Scale : 0 Image Size : 1600x1067`

But files stores in Android app cache are different in size, encoding ...

API 10 stored file (.cnt) : 

ExifTool Version Number         : 9.16
File Name                       : scivwy71EWXLfd2WGo5U3Iu85FY_api10.cnt
File Size                       : 165 kB
File Type                       : JPEG
MIME Type                       : image/jpeg
JFIF Version                    : 1.01
Resolution Unit                 : None
X Resolution                    : 1
Y Resolution                    : 1
Image Width                     : 1600
Image Height                    : 1067
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 1600x1067

API 17 stored file (.cnt) : 

ExifTool Version Number         : 9.16
File Name                       : scivwy71EWXLfd2WGo5U3Iu85FY_api17.cnt
File Size                       : 85 kB
File Type                       : WEBP
MIME Type                       : image/webp
VP8 Version                     : 0 (bicubic reconstruction, normal loop)
Image Width                     : 1600
Horizontal Scale                : 0
Image Height                    : 1067
Vertical Scale                  : 0
Image Size                      : 1600x1067

Should it be the `Vary: Accept` from server response ?

I will check.

If So EncodedImage.isMetaDataAvailable(encodedImage) will always be false for API 17.
And it should explain why decoding is more time consuming.
A least, there's no a big diff to time to onProducerFinishWithSuccess but the rendering appear "flappy" and  much long.
 https://github.com/facebook/fresco/issues/743
 Thank you very much for the very detailed description @eldk , that is amazing! 

As you've mentioned previously this is still experimental and has a couple of issues. 
We'll take a look at this and do some digging.
 @oprisnik , thanks.

Should you have a look here : 

https://groups.google.com/forum/#!topic/mod-pagespeed-discuss/GbntPnwiGTU

that's not a direct matter but should enhance the use of Fresco and the app user respect on "get what you need, for what you should expect from what your device can do".
 https://github.com/facebook/fresco/pull/1098
 https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/WebpTranscodeProducer.java#L33
 Hello,

I don't know if that should be opened in another topic, "mod_pagespeed/ngx_pagespeed : Provide support for image-resizing in-place " :  
That's should be resume in "request, download and store pictures to the size you need for the user device spec from Apache or Nginx webserver".

From Fresco side, that would be done with oKHttp backend that can modify request headers.

https://github.com/pagespeed/mod_pagespeed/issues/1329

preambule : https://groups.google.com/forum/#!topic/mod-pagespeed-discuss/GbntPnwiGTU

Thanks,

Eric

PS : @tyronen ... , should you have a look
 Hello,

API 17 : 

When webp pictures are used, downsample, nor resize are done.

`final DisplayMetrics displaymetrics = new DisplayMetrics();
                    getWindowManager().getDefaultDisplay().getMetrics(displaymetrics);
                    int height = displaymetrics.heightPixels;
                    int width = displaymetrics.widthPixels;`

`ImageRequest request = ImageRequestBuilder
                            .newBuilderWithSource(urlImage)
                            .setResizeOptions(new ResizeOptions(width, height))`

with setDownSampleEnabled(true) : 

`RequestLoggingListener: time 20375552: onRequestSuccess: {requestId: 54, elapsedTime: 4165 ms}`
`FinalÂ imageÂ received!Â SizeÂ %dÂ xÂ %d: Quality level 3945, good enough: 2438, full quality: 2147483647`

without //setDownSampleEnabled(true) : 

`RequestLoggingListener: time 20638151: onRequestSuccess: {requestId: 0, elapsedTime: 4195 ms}`
`FinalÂ imageÂ received!Â SizeÂ %dÂ xÂ %d: Quality level 3945, good enough: 2438, full quality: 2147483647`

With jpg : 
`DownsampleUtil: Downsample - Specified size: 600x976, image size: 3945x2438 ratio: 0.2 x 0.4, ratio: 0.400 for`
`RequestLoggingListener: time 551538: onRequestSuccess: {requestId: 0, elapsedTime: 1275 ms}`
`FinalÂ imageÂ received!Â SizeÂ %dÂ xÂ %d: Quality level 1973, good enough: 1219, full quality: 2147483647`
 Hello,

API 17 :

> When webp pictures are used, downsample, nor resize are done.

remove static-webp from build change nothing (picture is displayed), except :
those logs are not there :  

`06-30 16:11:01.720 2000-2335/tld.domain.app D/dalvikvm: Trying to load lib /data/app-lib/tld.domain.app-1/libstatic-webp.so 0x41a7ace8`

`06-30 16:11:01.730 2000-2335/tld.domain.app D/dalvikvm: Added shared lib /data/app-lib/tld.domain.app-1/libstatic-webp.so 0x41a7ace8`
 Hello,

API 17 : 

> When webp pictures are used, downsample, nor resize are done.

Enable downsample for webp to test :
https://github.com/eldk/fresco/commit/9730761f004f819f7d18f2b38e5b778664b16747

Have you some pictures ... info, on what is https://github.com/eldk/fresco/blob/9730761f004f819f7d18f2b38e5b778664b16747/imagepipeline-base/src/main/java/com/facebook/imagepipeline/image/EncodedImage.java#L282 ?

I have tryed with a set of 50 webp pictures (WEBP_SIMPLE) but no error and all webps are "downsampled".

And no more : 

`06-21 18:16:09.826 21639-22178/tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imagepipeline.nativecode.Bitmaps.reconfigureBitmap`

`06-21 18:16:09.826 21639-22178//tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()I`

`06-21 18:16:09.826 21639-22178//tld.domain.app I/dalvikvm: Could not find method android.graphics.Bitmap.getAllocationByteCount, referenced from method com.facebook.imageutils.BitmapUtil.getSizeInBytes`

`06-21 18:16:09.826 21639-22178//tld.domain.app W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()I``

Thanks,

Eric

https://chromium.googlesource.com/webm/libwebp/+/master/doc/
 Create a branch with update to libwebp 0.5.1 (static-webp) with downsample enabled (commented if statement https://github.com/facebook/fresco/compare/master...eldk:mlibwebp0.5.1+downsampleWebp#diff-834406681de434c4151758dd5d280b43R285) for webp : 
https://github.com/eldk/fresco/tree/mlibwebp0.5.1+downsampleWebp .

About to publish one app version with listener on producer ... to build stats on times to fetch, transcode, decode ...
 Hello,

as libwebp 0.5.1  is now merged in Fresco/Master (https://github.com/facebook/fresco/pull/1388).

I deleted all branches, from my repository, with previous libwebp versions.

Branche with downsample enable for webp (to test) is here : https://github.com/eldk/fresco/tree/mDownSample (diff is here : https://github.com/eldk/fresco/commit/8e91c71c7d0aece81a2cbf7381cabe6754e84cca)
  Try changing to this:

```
DraweeController controller = Fresco.newDraweeControllerBuilder()
        .setLowResImageRequest(lowResRequest)
        .setRetainImageOnFailure(true) // <--- Add this line
        .setImageRequest(request)
        .setOldController(view.getController())
        .build();
```

Reopen the issue if you still have a problem.
  In 0.10.0, we broke GIF support out into a separate dependency to reduce the size of the core library. Does your Gradle file include the following?

```
compile 'com.facebook.fresco:animated-gif:0.11.0'
```

See [the docs](http://frescolib.org/docs/index.html) for the other optional modules too.
  There really isn't enough information for me to be able to say what kind of problem might be involved here.

Are you using drawee or requesting image from the pipeline directly?

One thing you could try is to specify alternative `MemoryCacheParams` in your `ImagePipelineConfig`. The default values come from `DefaultBitmapMemoryCacheParamsSupplier`. You could even set it to hold no items at all to make sure the cache isn't holding onto images which you don't need.
  Thanks for letting us know. We'll upgrade the dependency and include that in our next release.

It looks like you haven't been rejected here, but this is a warning that action is required to avoid being rejected later in the year. Correct me if I'm wrong.
 As @PiotrWpl mentioned, this should be fixed in 0.13.0 which was released last Friday thanks to bc6016e1f8daa74ce0cb60710414afd3f320f2aa and 5649f0cfee8670c1e262a1626528d0077af5ace3.

Reopen the issue if you still see issues but I think this is now resolved.
  Can you give a more detailed description what this diff solves and how it worked before / after (Screenshots or a video would help as well)?
 @facebook-github-bot import
  Sorry, I can't really tell anything from this graph.

You could look at my suggestions here https://github.com/facebook/fresco/issues/1306#issuecomment-226775401

I'll close this issue and if you'd like to discuss memory further, let's do it on #1306 
  Fresco supports two rounding types, [`BITMAP_ONLY` and `OVERLAY_COLOR`](https://github.com/facebook/fresco/blob/89477f77af3b6954f57dc39b8c572b4b8eb4e84a/drawee/src/main/java/com/facebook/drawee/generic/RoundingParams.java#L22).

`BITMAP_ONLY` is the default but supports limited scale types. Does your image's scale type match one of those? What are the other params on the view?
 And how are you attaching the image to the view in the screenshot? It should be below the blue bar at the top or above? How does the parent view look like?
 Is this still causing a problem for anyone? If so, can you provide more detail of your layout (not just the drawee view) and how the view's being used, e.g. RecyclerView or ListView. I'm closing this issue since it's more than a year old. Feel free to comment if this is still an issue.  Thanks, we're looking into this!
 We've fixed this with 0d0c5757ff40eb9e9f23533c9798dcdde095ce86 so this will be fixed in the next release. Thanks for reporting!
  How are you using Fresco? Can you give a short example where the overlay image is not centered?
Does this only happen for 9-patch files or also for normal images?
  As @Wbreadboy says, the solution can be found in this comment: https://github.com/facebook/fresco/issues/1177#issuecomment-221807002

I'll ensure our Proguard documentation is updated to include this.
 We've fixed this with 0d0c5757ff40eb9e9f23533c9798dcdde095ce86 so this will be fixed in the next release. Thanks for reporting!
  I've added the possibility to get the animation duration, see 5c927efcff52213016497e86af7cde45ab295b12
 We don't have an exact release schedule, but we're now releasing on a regular basis, so you can expect a new version pretty soon.
  You can try 0.11.0 now too.

As you seem happy after upgrading, I'm going to close this issue but reopen it if the problem continues.
  That error message comes from with the libjpeg_turbo from [jccolor.c](https://github.com/libjpeg-turbo/libjpeg-turbo/blob/3ff13e651bbe6de9c6f15d05235d1d4f26f63ffc/jccolor.c#L678).

It suggests CMYK images should work if valid.

Does this only happen when downscaling is enabled?
 Can you provide a sample image for us to look at? Closing as we don't have a jpeg to reproduce this with.  Hi @hbm1985 ,
if I have understood the question you need a callback in order to understand when the Webp/Gif animation has completed. Do you confirm?

Thanks
 @massimocarli hbm1985 is asking the exact thing. So you would need BaseControllerListener to listen for the event.
  Hi!
You can specify `ResizeOptions` for the image request. If you don't set resize options, the image will just be scaled. We currently do not automatically set ResizeOptions for you, so you have to explicitly set them.
More information: http://frescolib.org/docs/resizing-rotating.html
  The class was added after we've released v0.10.0. It will be in the next release, stay tuned! 
  As the message says there were failing tests but you haven't provided enough detail to understand why.

Please view the file specified (`file:///E:/dir_git/fresco/imagepipeline-base/build/reports
/tests/debug/index.html` in this case) in your browser and see which tests failed.

If you share that with us we might be able to understand why.
 We're still missing details here. Let me know if you still need help but I'm closing the issue for now.
  @massimocarli 
 Hi @paulzin,
it looks like the transparent Webp are recognized as simple or enhanced Webp and so transparent information are lost. We should check wha'st the format recognized by the ImageFormatChecker and WebpTranscodeProducer classes. If you can reproduce the problem can you please put some breakpoint into the doTranscode() method in WebpTranscodeProducer and see what's the recognized type for that images? Basically [here](https://github.com/facebook/fresco/blob/b3c1a9643d901457c5db1af33320926622270f77/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/WebpTranscodeProducer.java#L182)

Please check in both cases; I mean passing true and false to setWebpSupportEnabled().

Thanks 
 Hi @paulzin 
The setWebpSupportEnabled() is a configuration method that you should call to decide if using the webp transcoding to jpg or png or using our experimental webp decoder. I suggested to see both cases in order to see if this was a transconding or decoding problem. 
Thanks
  We don't recommend to use imageview with imagepipeline for rendering image. Why not use drawee?
  Try solution in #410 
  What you can do is to create your controllerListener listens to AnimatableDrawable and create Animator using the same AnimatableDrawable. Then you'll be able to setRepeatCount to that animator.
  Try the solution in #410 
  OpenGL limit bitmap rendering no more than 2048x2048. Auto resize is what we wanna achieve. It would be really helpful if someone in community can give us a hand in this.
 Yeah, unfortunately there is a system limit. Resizing the image should help.  You can use ControllerListener. See http://frescolib.org/docs/listening-download-events.html.
  This was a bug which will be fixed in the next release but it suggests you're using WebP images but haven't included the necessary optional dependency for WebP support.

http://frescolib.org/docs/webp-support.html

Re-open the issue if this doesn't solve the problem for you but I believe it will.
  By design, placeholder is used for display before getting actual image. Is that what you mean by blink?
 That's strange because if the image is visible, it should be in the bitmap cache. If you set the same image again to a view, it should find the image in the bitmap cache immediately and there should be no flicker. 

There are a couple of possibilities:
- the uri and/or request parameters are actually not exactly the same
- the image was not found in cache (shouldn't happen)
- there is a bug in the drawee logic
- something else

Please follow our troubleshooting section and provide the logcat output that will tell us more.
 I assume the problem has been resolved. If not, please let us know.  What do you mean by downSampleSize?
 Closing as it's not clear what the problem is, and no further information was provided  Can you provide a link to an image you're having this problem with?

As you say it has been raised before and I'll take a look to see how we can resolve this. It would be good to have another image to test with though, the example in #475 is a really large (file size) image and I'm curious how large yours are.
 I've created a simple fix which will stop the progress bar disappearing until the decoding is complete. Fortunately, I'm also preparing a new release so I'm hoping that will fix your issue, even if we may still want to improve the sophistication of the solution later.
 I believe this should be resolved by da9b7f162bb31f538bda2f34e83ac505f0e67a39.
  This PR has been sitting stale for a while now and a similar PR #1461 has been merged so I'm closing this.  You can fetch encoded bytes and store them outside of disk cache, would that work for you ? Checkout [skipping the decode section in our docs](http://frescolib.org/docs/using-image-pipeline.html)
 Closing as there seems to be nothing more to do here  I am not sure I understand. Are you saying that you cannot download the image ?
  There is no API to do this yet, but you should still be able to hack something for now by talking directly to the disk cache. The code would look like something like this:

``` java
ImageRequest imageRequestForYourImage =  ...;
InputStream yourImageStream = ...;
try {
    CacheKey cacheKey = DefaultCacheKeyFactory.getInstance(). getEncodedCacheKey(imageRequestForYourImage);
    Fresco.getImagePipelineFactory().getMainFileCache().insert(cacheKey, WriteCallbacks.from(yourImageStream));
} finally {
    yourImageStream.close();
}
```

Let us know how it goes.
 Closing as a workaround was provided which resolved the issue  After applying your changes I am able to display 78 images at once. At the same time the comparison app is not configured to downsample or resize images, so if each of them was a big 4100px \* 3100px (size you reported in previous task) local image then in total there would be almost 3.5GB of pixel data in memory (4 bytes per pixel). At that point the crash is expected.

In general, apps should either download images that have appropriate size for the destination view, or should tell Fresco to downsample or resize (http://frescolib.org/docs/resizing-rotating.html)
  Are you sure that the communication framework includes Fresco ? Gradle is not supposed to put dependencies of library in the same aar. Normally those dependencies are specified in pom.xml files and gradle knows to download them together with the library if the library is needed. This way gradle can handle complex dependencies graphs without conflicts.

It is possible that the communication framework your app depends on uses the same name for one of its native libraries as Fresco does. This way both aars would include 'libmemchunk.so' but each of those would be a different library, in which case you'll have to rename libmemchunk.so to something else either by forking Fresco or changing source code of the communication framework.

Is the source of the communication framework available anywhere so that I can have a look ?
 I downloaded their sdk and checked that libbitmaps.so and libmemchunk.so are included in one of their aars. I cannot find Fresco classes using them in those aars, so I think those libraries were included there "by mistake". You should be able to remove them from wukongim_1.3.4.9-UT-SNAPSHOT.aar. Also it might be a good idea to ping maintainers of the communication framework and ask them to fix this.
  What do you need to clip? If you're talking about bitmap, we can fetch bitmap from imagepipeline and post process from there.
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  I suppose something in the way you append new messages causes all the DraweeViews to be detached and attached again. Could you check that is the case by checking what is printed in logcat when you send new messages ? First you'll have to tell Fresco to log more info to logcat (see "Setting up logcat" here: http://frescolib.org/docs/troubleshooting.html).
 As @michalgr mentioned, I guess you are re-attaching the drawee view - which results in the flicker since animated images are heavier than normal image.
You should only invalidate / re-attach the new views. Closing as a fix was suggested that should resolve this.  The `PipelineDraweeControllerBuilder` allows you to set a low res image request and the normal image request, see http://frescolib.org/docs/requesting-multiple-images.html#going-from-low-to-high-resolution
  `Debug.getNativeHeapSize()` is not supposed to go down. The implementation delegates to mallinfo and returns highwater mark.

https://android.googlesource.com/platform/frameworks/base/+/kitkat-mr2.2-release/core/jni/android_os_Debug.cpp#123
http://man7.org/linux/man-pages/man3/mallinfo.3.html
  It seems that there is no loop count in basic gif, it was added in netscape extension. I'll repurpose this issue as enhancement to add support for that.
 This has been fixed with 95359b9cb7650cf00b362ffbc018e90d503d476b
  When `CloseableBitmap` is closed [this](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/BitmapCounter.java#L54) code is executed. Recycle will release the bitmap even if it is pinned.
  Thanks longya3xian. @a63622110: also have a look at our documentation here: http://frescolib.org/docs/multiple-apks.html
  Thanks ! Could you provide crash message from logcat ?
 I did not get your email yet. Also, I can't see any exception/native crash in the log you provided, are you sure the app crashed when the log was captured ?
 Please send logs to michalgr at fb dot com. Thanks !
 I received the logs, thanks. Could you enable Fresco logs ("Setting up logcat" section here: http://frescolib.org/docs/troubleshooting.html) and capture logs with timestamp (adb logcat -v threadtime) again ? This way we'll have more information to debug the issue, thanks.
 This is the last Fresco log (DecodeProducer) from the logs @imrunning sent me:

```
06-03 14:56:12.989  1915  8197 V unknown:RequestLoggingListener: time 154717: onProducerStart: {requestId: 46, producer: DecodeProducer}
06-03 14:56:12.989  1915  1915 V unknown:AbstractDraweeController: controller 4286d7a0 null -> 62: initialize
06-03 14:56:12.990  1915  1915 V unknown:AbstractDraweeController: controller 4286d7a0 62: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@42982a78
06-03 14:56:12.990  1915  8197 W skia    : enter Skia Webp try_path 1, mode 0, L:1045!! 
06-03 14:56:12.990  1915  8199 W mHalJpgDec: mHalJpgDec:: parser lock success,fg(1),SWS 0x25800, L:166!!
06-03 14:56:12.990  1915  8199 D WebpDecPipe: [Parser] not support smaller 1980x1088, (720 260)!!
06-03 14:56:12.990  1915  8199 W JpgDecPipe: [ImageDecPipe] - decoder parse fail, L:481!!
06-03 14:56:12.990  1915  8199 D JpgDecPipe: JpgDecPipe::~JpgDecPipe
06-03 14:56:12.990  1915  8199 W JpgDecPipe: ::[UNLOCK] unlock , islock 1!!
06-03 14:56:12.990  1915  8199 W WebpDecPipe: [Warning] try to deinit VDEC with zero handle!!
06-03 14:56:12.990  1915  8199 D WebpDecPipe: Free VDEC dst memory: va:0x0, L:1207 !!
06-03 14:56:12.990  1915  8199 D WebpDecPipe: WebpDecPipe::~WebpDecPipe
06-03 14:56:12.990  1915  8199 D ImgScaler: ImgCdpPipe::~ImgCdpPipe
06-03 14:56:12.990  1915  8199 W mHalJpgDec: no support file format
06-03 14:56:12.990  1915  8197 W skia    : Use WEBP SW Decoder, L:1175!!
06-03 14:56:12.990  1915  8199 W skia    : Use WEBP SW Decoder, L:1175!!
06-03 14:56:12.990  1915  8197 D skia    : Flag is not 10
06-03 14:56:12.990  1915  8199 D skia    : skiaWebpDecoder:: org:w 720, h 260, out:720 260, decBuf 720 260, sample 1!!
06-03 14:56:13.008   127   474 I SurfaceFlinger: [SurfaceFlinger] fps:2.700974,dur:1110.71,max:508.34,min:112.06
06-03 14:56:13.013   463   463 W ADB_SERVICES: create_local_service_socket() name=shell:dumpsys gfxinfo 1915
06-03 14:56:13.014  8292  8292 W ADB_SERVICES: adb: unable to open /proc/8292/oom_adj
```

The producer never finishes its job. Clearly you can tell that two threads are executing skia code (8199 is an ongoiing decode as well). I wonder if there is any deadlock in skia or Android decoder.
 @imrunning It looks like this issue is happening for decoding webp format. Do you have issue when turning on MemoryFile for decoding jpeg or png format?
 Closing this due to lack of updates and no further reported instances of the issue since 2016  Duplicate of https://github.com/facebook/fresco/issues/159
  What produces such an error message ? How do you make your app depend on Fresco ?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  Could you explain what do you mean by "the item position always move" ?

When it comes to dimensions of resized image - Fresco can't resize images to arbitrary dimensions. Scalling factor is always a fraction with denominator equal to 8, see [here](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline/src/main/java/com/facebook/imagepipeline/nativecode/JpegTranscoder.java#L31-L33).
 We have an example for displaying images in a RecyclerView here:

https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/drawee/DraweeRecyclerViewFragment.java

Otherwise, I suggest to ask the general question about view recycling on Stackoverflow since it's unrelated to Fresco.  Could you explain what do you want to do ? Drawee already[supports loading images from multiple sources](http://frescolib.org/docs/requesting-multiple-images.html). Can you use that ?
 Once you set a new uri to a DraweeView, the previous request will automatically get cancelled. You should not cancel anything explicitly.

As for the crash you are seeing, please provide the code of your controller listener.
  Interesting, when it happens again, could you save logcat output ? Being able to see detailed [Fresco logs](http://frescolib.org/docs/troubleshooting.html) and GCs would be helpful.
 See http://frescolib.org/docs/progress-bars.html for the download progress.  Fresco doesn't do it yet.
 This feature has already been requested in #480. Pull requests are welcome :)  Do you build Fresco from source or include the .AARs?
Did you set up Fresco correctly (calling `Fresco.initialize(...)` exactly one time, see #1234)?
Does this only happen for specific images and can you reproduce the error all the time or just sporadic?
Is your app hitting the 65k method limit? Are you using Multidex?
 I'm closing this issue since it's more than a year old. Feel free to comment if this is still an issue.  No, Android itself does. Most devices cannot display more than 4096x4096, and many can't do more than 2048x2048. The OpenGL subsystem can't render an image like that, which is much bigger than a mobile screen anyway.
  We would need to see a code snippet of your custom view to see what it is doing. In any case, please ask this question on [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco).
  You need to add this line to your `build.gradle` file as [explained](http://frescolib.org/docs/index.html) in ths docs:

``` groovy
  compile 'com.facebook.fresco:webpsupport:0.10.0'
```

This is needed to display WebP images on older Android devices.

In the next release of Fresco your app won't crash in this case, but still won't show the image.
  I've just completed a series of changes to be included in the next Fresco release.

This adds a `RotationOptions` class which can be specified when building an image request. As well as having a new API, several fixes have been made with respect to rotation when downscaling is enabled, when a postprocessor is attached and other cases we were aware of.

The initial commit for these changes is 36dd783.

When the new release is made (or sooner if you'd like to build from source and test with that) I'd be interested to know if this resolves your use case.
 I think there may be a little confusion here about what auto-rotate means though and I will update the docs when the new API is released in Fresco 0.14.0.

Where an image has been stored with metadata to define a rotation, auto-rotate needs to be turned on to see the image oriented correctly.

I think your problem was that when downsampling was on, the rotation wasn't being done, not that it couldn't be stopped.
  This achieves two things:
- It allows us to dynamically change backgrounds and overlays
- It saves memory as we removed 5 instance integers and added only 2 instance null-references (two null elements in the array of the fade drawable)

An additional change is that multiple backgrounds are from now on deprecated. Context:
This improvement required a small interface change between GenericDraweeHierarchy and its builder. In particular, GenericDraweeHierarchy now has only one layer dedicated for a background. Multiple backgrounds are still supported via builder, but this gets emulated by wrapping them with an ArrayDrawable. In theory this should work fine, with one caveat. Rounding no longer works for multiple backgrounds. This would be relatively easy to support, but given that multiple backgrounds are rarely used feature (if ever), instead of introducing additional complexity we decided to deprecate it instead.
In case where there is only one or no background, everything should work as it was before.

Test Plan: unit tests, demo sample app
 All in all a great change but let's do a more in-depth description.
We're basically removing support for multiple backgrounds with this commit - let's emphasize that. I would change the commit name to "Remove multiple background support" and then explain that we're doing this for perf reasons.
 We are not really dropping support for multiple backgrounds. There has been an internal interface change between drawee hierarchy and its builder, but the builder setter (which clients may be using) is still there.

There is a breaking part though, which is that rounding won't work for backgrounds if there is more than one. This is easy to fix, but I didn't bother because I am reasonably confident that multiple backgrounds is rarely used if ever. I admit that was a bit of overengineering on my side. Time to fix it :)
  Are you clearing the controller in `destroyItem` of your `PagerAdapter`? For example:

```
    public void destroyItem(ViewGroup container, int position, Object object) {
        FrameLayout page = (FrameLayout) container.getChildAt(position);
        SimpleDraweeView draweeView = (SimpleDraweeView) page.getChildAt(0);
        draweeView.setController(null);
    }
```

Or something along those lines. I am sure that `ViewPager` keeps only a few pages alive at  a time (current, previous and next) and If you are doing a proper cleanup there and if you are not leaking fragment instances somehow, there should be no memory leaking.

It would help if you could find what exactly is being leaked. You can use MAT and analyze heap dumps for that.
 Closing due to lack or progress and/or updates since 2016  How do you set the resource? Placeholder? What are you trying to do?
 I assume the problem has been resolved. If not, please let us know.  If the current gesture performed on our ZoomableDraweeView haven't caused the transform to be corrected, we request our parent to not intercept events as we are going to hndle them. If on the other hand the transform got corrected, it means we tried to scroll past the bounds and we will let our parent intercept the events in case it wants to.

As a consequence we can zoom-in, pan the image around, and once we reach the edge, the parent will take over and perform paging, as the user would expect. With this fix I hope we solved issues with ZoomableDraweeView within another scrollable containers such as ViewPager, etc.
 Ah, I get it now why we need the ViewPager in the sample app :)
 This is very cool! I've checked the implementation in the Android source for requestDisallowInterceptTouchEvent for ViewGroup, ScrollView and the AbsListView - this should work.
I'd live to test this with the Facebook app - but it looks good.

AWESOME!
 @facebook-github-bot import
  Tested that before this diff a false long-press would be triggered if user taps while the image is not loaded yet. Tested that this does not happen with this fix, and that long-press properly gets detected once the image gets loaded.
 That's a very nice catch! Mega Like!
(Please fix the nits, otherwise it's good to go)
  This sample app has a ViewPager with 3 pages, each containing one ZoomableDraweeView. This will allow us to test touch logic when zoomable view is in a container that also handles gestures.
 Looks good in general, the only real issue I have is the gradlew.bat changes. Otherwise just a few small things (can be ignored).
 @facebook-github-bot import
  At the moment, progress is only being reflected for downloading. If you already have the image downloaded and in one of our caches, the reported progress will be 10000 (i.e. 100%). In most cases this is good enough as the total time to display an image is being dominated by network fetch. However, decoding can also take a non trivial amount of time if the image is large. This is what most likely you are seeing and unfortunately we currently do not support decoding progress. We might add this feature some time in the future.
  If you increase the bitmap memory cache to 400MB, your app will be unusable on most devices out there. Not many phones have such a big amount of memory available for a single cache of a single app.
 Yes that is correct. 

Please in future ask questions of this type on [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco).
  Is this GIF animated? Animated GIF frames are not stored in bitmap cache.

Please ask questions of this type on [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco). Thanks!
  Yep, this is a known limitation.
 This feature has been added by @franzks in d25944a2ac2f5b7e865140ab0ee77ab2c70e4c90  We don't actually support building with Ant. How did you set this up?
 Make sure your build.xml file includes the C++ giflib shared library with your app apk. If it does and still doesn't work, let us see it here.
 As stated, ant is not officially supported  So the first image in your screenshot should be the same size as the second?

Try instead using scale type `CENTER_INSIDE` or `FIT_CENTER`.

It's usually not the best idea to re-layout your views to match the image's size; this will slow down your app. Decide how much space is available on your screen and scale the image to match it instead. 
  Some of my images are blurry.
When using downsample for global, how can I display the full quality images?
 This likely means your `ResizeOptions` are too small. Try increasing it to the actual size you need to display.
 @tyronen I found it in document, thanks anyway.
  I just took a look and that GIF is 2.5MB so I'm not surprised that it takes some time to download.
 As @kirwan said, this is a 1920x1076 image with 26 frames. The decode has to do this frame by frame. It will take a while.
  Summary: Allows backgrounds and overlays to be changed dynamically. Note, DraweeHierarchy space for backgrounds and overlays need to be preallocated in advance in order to be changed.

Test Plan: Verified in the sample app that:
    \* setting background dynamically works
    \* setting overlay dynamically works
    \* setting both a background and an overlay dynamically works
    \* attempting to set a backgroudn or an overlay without preallocating throws
 ![screen shot 2016-05-19 at 20 26 51](https://cloud.githubusercontent.com/assets/3705123/15406849/124a041c-1e00-11e6-84b5-335b67ffe888.png)
 Thanks for the PR @plamenko. It looks great.

@facebook-github-bot-0 import
 @facebook-github-bot import
  I am using AppCompat version 23.4.0 and my build .gradle looks like this:

``` groovy
`apply plugin: 'com.android.application'


android {
    compileSdkVersion 23
    buildToolsVersion "23.0.3"



    signingConfigs {
        debug {
            storeFile rootProject.file('debug.keystore')
            storePassword 'android'
            keyAlias 'android'
            keyPassword 'android'
        }
    }

    defaultConfig {
        applicationId "com.listup.android"
        minSdkVersion 15
        targetSdkVersion 23
        versionCode 33
        versionName "1.3.3"
        vectorDrawables.useSupportLibrary = true
        multiDexEnabled true
    }
    buildTypes {
        release {
            shrinkResources true
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
    packagingOptions {
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/NOTICE.txt'
    }

    splits {
        abi {
            enable true
            reset()
            include 'x86', 'x86_64', 'arm64-v8a', 'armeabi-v7a', 'armeabi'
            universalApk true
        }
    }
    project.ext.versionCodes = ['armeabi': 1, 'armeabi-v7a': 2, 'arm64-v8a': 3, 'x86': 8, 'x86_64': 9]

    android.applicationVariants.all { variant ->
        variant.outputs.each { output ->
            output.versionCodeOverride =
                    project.ext.versionCodes.get(output.getFilter(
                            com.android.build.OutputFile.ABI), 0) * 10000000 + android.defaultConfig.versionCode
        }
    }
}

task contentProviderGen {
    description = 'Generating a ContentProvider and required classes'
    doLast {
        System.out.println("Generating ContentProvider...")
        String schemaFilename = 'cpgen/schema.json';//replace with the path to your schema
        String baseOutputDir = 'src/main/java/package/generated';
        //if gradle throws an error on the following line, you probably either don't have your import statement set or you have the wrong path in your buildscript definition
        ContentProviderGenerator.generateContentProvider(schemaFilename, baseOutputDir);
    }
}


buildscript {
    repositories {
        mavenCentral()
    }
    repositories {
        maven { url 'https://maven.fabric.io/public' }
    }

    dependencies {
        classpath files('cpgen/cpgen.jar')
        classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
        classpath 'com.canelmas.let:let-plugin:0.1.10'
        classpath 'io.fabric.tools:gradle:1.+'
    }
}

repositories {

    maven {
        url "https://jitpack.io"
    }
    flatDir {
        dirs 'libs'
    }
    maven { url 'https://maven.fabric.io/public' }
}

apply plugin: 'com.neenbedankt.android-apt'
apply plugin: 'let'
apply plugin: 'io.fabric'

dependencies {
    compile 'org.apache.commons:commons-lang3:3.4'
    compile 'com.android.support:cardview-v7:23.4.0'
    compile 'com.android.support:design:23.4.0'
    compile 'com.google.code.gson:gson:2.6.2'
    compile 'com.squareup.retrofit2:retrofit:2.0.0-beta4'
    compile 'com.squareup.retrofit2:converter-gson:2.0.0-beta4'
    compile 'com.squareup.okhttp3:okhttp-urlconnection:3.2.0'
    compile 'com.facebook.fresco:fresco:0.10.0'
    compile ('com.facebook.android:facebook-android-sdk:4.11.0'){
        exclude group: 'com.parse.bolts',
                module: 'bolts-android';}
    compile 'com.pubnub:pubnub-android:3.7.10'
    compile 'com.adjust.sdk:adjust-android:4.6.0'
    compile 'com.jakewharton:butterknife:8.0.1'
    compile 'com.squareup.okhttp3:logging-interceptor:3.2.0'
    compile 'com.google.android.gms:play-services-location:8.4.0'
    compile 'com.google.android.gms:play-services-gcm:8.4.0'
    compile 'com.viewpagerindicator:library:2.4.1@aar'
    compile 'com.google.android.gms:play-services-analytics:8.4.0'
    compile 'com.github.amlcurran.showcaseview:library:5.4.3'
    compile('com.github.afollestad.material-dialogs:core:0.8.5.7@aar') {
        transitive = true
    }

    compile(name: 'appintro', ext: 'aar')
    apt 'com.jakewharton:butterknife-compiler:8.0.1'
    compile 'com.nineoldandroids:library:2.4.0'
    compile 'com.daimajia.easing:library:1.0.1@aar'
    compile 'com.daimajia.androidanimations:library:1.1.3@aar'
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.github.jd-alexander:library:1.1.0'
    compile 'com.github.dmytrodanylyk:android-morphing-button:98a4986e56'
    compile('com.crashlytics.sdk.android:crashlytics:2.5.5@aar') {
        transitive = true;
    }
    compile 'com.android.support:multidex:1.0.1'
}

apply plugin: 'com.google.gms.google-services'
```

I am getting this before lollipop:

```
Caused by android.content.res.Resources$NotFoundException
android.content.res.Resources.loadDrawable (Resources.java:2120)
android.content.res.MiuiResources.loadDrawable (MiuiResources.java:359)
android.content.res.Resources.getDrawable (Resources.java:710)
com.facebook.drawee.generic.GenericDraweeHierarchyInflater.getDrawable (GenericDraweeHierarchyInflater.java:227)
com.facebook.drawee.generic.GenericDraweeHierarchyInflater.updateBuilder (GenericDraweeHierarchyInflater.java:116)
com.facebook.drawee.generic.GenericDraweeHierarchyInflater.inflateBuilder (GenericDraweeHierarchyInflater.java:77)
com.facebook.drawee.view.GenericDraweeView.inflateHierarchy (GenericDraweeView.java:58)
com.facebook.drawee.view.GenericDraweeView.<init> (GenericDraweeView.java:43)
com.facebook.drawee.view.SimpleDraweeView.<init> (SimpleDraweeView.java:60)
java.lang.reflect.Constructor.constructNative (Constructor.java)
java.lang.reflect.Constructor.newInstance (Constructor.java:423)
android.view.LayoutInflater.createView (LayoutInflater.java:597)
android.view.LayoutInflater.createViewFromTag (LayoutInflater.java:699)
android.view.LayoutInflater.rInflate (LayoutInflater.java:758)
android.view.LayoutInflater.rInflate (LayoutInflater.java:761)
android.view.LayoutInflater.rInflate (LayoutInflater.java:761)
android.view.LayoutInflater.inflate (LayoutInflater.java:495)
android.view.LayoutInflater.inflate (LayoutInflater.java:400)
com.listup.android.adapter.BaseRecyclerAdapter.onCreateViewHolder (BaseRecyclerAdapter.java:23)
android.support.v7.widget.RecyclerView$Adapter.createViewHolder (RecyclerView.java:5482)
android.support.v7.widget.RecyclerView$Recycler.getViewForPosition (RecyclerView.java:4707)
android.support.v7.widget.RecyclerView$Recycler.getViewForPosition (RecyclerView.java:4617)
android.support.v7.widget.LayoutState.next (LayoutState.java:100)
android.support.v7.widget.StaggeredGridLayoutManager.fill (StaggeredGridLayoutManager.java:1538)
android.support.v7.widget.StaggeredGridLayoutManager.onLayoutChildren (StaggeredGridLayoutManager.java:657)
android.support.v7.widget.StaggeredGridLayoutManager.onLayoutChildren (StaggeredGridLayoutManager.java:592)
com.listup.android.fragment.ProductListFragment$5.onLayoutChildren (ProductListFragment.java:269)
android.support.v7.widget.RecyclerView.dispatchLayoutStep2 (RecyclerView.java:3028)
android.support.v7.widget.RecyclerView.dispatchLayout (RecyclerView.java:2906)
android.support.v7.widget.RecyclerView.onLayout (RecyclerView.java:3283)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.support.v4.widget.SwipeRefreshLayout.onLayout (SwipeRefreshLayout.java:596)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.FrameLayout.layoutChildren (FrameLayout.java:453)
android.widget.FrameLayout.onLayout (FrameLayout.java:388)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.RelativeLayout.onLayout (RelativeLayout.java:1055)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.support.v4.view.ViewPager.onLayout (ViewPager.java:1695)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.support.design.widget.HeaderScrollingViewBehavior.layoutChild (HeaderScrollingViewBehavior.java:122)
android.support.design.widget.ViewOffsetBehavior.onLayoutChild (ViewOffsetBehavior.java:42)
android.support.design.widget.AppBarLayout$ScrollingViewBehavior.onLayoutChild (AppBarLayout.java:1192)
android.support.design.widget.CoordinatorLayout.onLayout (CoordinatorLayout.java:814)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.FrameLayout.layoutChildren (FrameLayout.java:453)
android.widget.FrameLayout.onLayout (FrameLayout.java:388)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.LinearLayout.setChildFrame (LinearLayout.java:1671)
android.widget.LinearLayout.layoutVertical (LinearLayout.java:1525)
android.widget.LinearLayout.onLayout (LinearLayout.java:1434)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.FrameLayout.layoutChildren (FrameLayout.java:453)
android.widget.FrameLayout.onLayout (FrameLayout.java:388)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.LinearLayout.setChildFrame (LinearLayout.java:1671)
android.widget.LinearLayout.layoutVertical (LinearLayout.java:1525)
android.widget.LinearLayout.onLayout (LinearLayout.java:1434)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.widget.FrameLayout.layoutChildren (FrameLayout.java:453)
android.widget.FrameLayout.onLayout (FrameLayout.java:388)
android.view.View.layout (View.java:14845)
android.view.ViewGroup.layout (ViewGroup.java:4631)
android.view.ViewRootImpl.performLayout (ViewRootImpl.java:2017)
android.view.ViewRootImpl.performTraversals (ViewRootImpl.java:1774)
android.view.ViewRootImpl.doTraversal (ViewRootImpl.java:1030)
android.view.ViewRootImpl$TraversalRunnable.run (ViewRootImpl.java:5639)
android.view.Choreographer$CallbackRecord.run (Choreographer.java:761)
android.view.Choreographer.doCallbacks (Choreographer.java:574)
android.view.Choreographer.doFrame (Choreographer.java:544)
android.view.Choreographer$FrameDisplayEventReceiver.run (Choreographer.java:747)
android.os.Handler.handleCallback (Handler.java:733)
android.os.Handler.dispatchMessage (Handler.java:95)
android.os.Looper.loop (Looper.java:136)
android.app.ActivityThread.main (ActivityThread.java:5111)
java.lang.reflect.Method.invokeNative (Method.java)
java.lang.reflect.Method.invoke (Method.java:515)
com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run (ZygoteInit.java:806)
com.android.internal.os.ZygoteInit.main (ZygoteInit.java:622)
dalvik.system.NativeStart.main (NativeStart.java)
```
 Please take a look at the 2 solutions in #1176.
  Fresco does support HTTPS images.

We would need more information to be able to help here.

If your image is failing to load, look at LogCat to see what error is shown. It could be a certificate problem.
 I just put that URL into the Uri sample app included in Fresco and the image appeared. That app doesn't have anything unusual setup for Fresco.

One thing which may help you debug is to add logging and look at the output.

Try this and look at Logcat.

```
Set<RequestListener> listeners = new HashSet<>();
listeners.add(new RequestLoggingListener());
ImagePipelineConfig config = ImagePipelineConfig.newBuilder(this)
    .setRequestListeners(listeners)
    .build();
```
  Have you checked [StackOverflow](http://stackoverflow.com/questions/14307611/problems-compiling-object-using-arm-linux-androideabi-gcc) ?
 Duplicate, let's track this in  #1205
  Looks amazing, just a couple of comments to address.
 I am accepting this in advance as there are only a couple small comments to be applied.
 This looks fantastic. Thanks for the PR. Let me know if you have any more amendments, otherwise I'll import it so we can merge to master.
 @facebook-github-bot import
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/596930920487588/int_phab) to review.
 @dmitrychistyakov I'm curious what the reason was for removing the transparency from `test_image.png`. I presume that's not necessary.
 Thanks @dmitrychistyakov! I stepped through the framework code and I can confirm that what you said is exactly right. The framework copies just some of the properties from the source view to the destination view and then passes the destination view instance to `Transition.captureStartValues`. It then restores back the original properties of the destination view and calls `Transition.captureEndValues`. This is a design flaw of the Android framework as it prevents any custom properties to be properly captured. We will have to go with the current solution until this gets improved on Android side.

As for adding XML support for `DraweeTransition`, that would be amazing too! As you said, a separate PR would be better than doing it here. Let's ship this!
 Btw, about making transition more obvious, I changed the destination scale type to FIT_CENTER and added a backgroundImage which is just a light green color. The transition is very visible.
![screen shot 2016-05-19 at 15 57 40](https://cloud.githubusercontent.com/assets/3705123/15398178/9ded8582-1dda-11e6-83fd-c955b4a60b70.png)
![screen shot 2016-05-19 at 15 57 49](https://cloud.githubusercontent.com/assets/3705123/15398184/a33dddca-1dda-11e6-9f66-1d52035811b7.png)
 @dmitrychistyakov I've run this on a device now and it looks brilliant. Thanks so much.

There's no need to make any more changes, as I had to run some formatting anyway so I've added the background as @plamenko suggested.
  This is not the format of the data uri. The syntax of data URIs was defined in Request for Comments (RFC) 2397, published in August 1998, and follows the URI scheme syntax. A data URI consists of:

```
data:[<media type>][;charset=<character set>][;base64],<data>
```

Observe that the data is separated from the preceding part by a comma (,). This comma is not optional.
 Can't you use the file scheme instead? Also, check the [supported uris](http://frescolib.org/docs/supported-uris.html).
  By "some problem" and "no response", do you mean the image doesn't load?
For "circle", do you mean `roundAsCircle`? If so, is the rounding part important? If you remove rounding, do images load?
 Closing as we've had no further reports of this issue  @facebook-github-bot import
 Hi, I tried patching this, and discovered that if I ran our comparison app, GIFs would no longer load with this PR. Were you able to get it to work?
 @facebook-github-bot import
  Hi!

Rounded corners with animated GIFs are supported if you use the OVERLAY_COLOR rounding mode.
You just have to add `fresco:roundWithOverlayColor="@color/your_color"` to your DraweeView in XML. You can also set this in code. More information on rounding modes can be found here: http://frescolib.org/docs/rounded-corners-and-circles.html

The BITMAP_ONLY rounding mode currently does not support animated GIFs as you've noticed.
 I don't think we currently plan to support that rounding mode for animated gifs and as you've seen the overlay color must be an opaque color, `@color/transparent` won't work.
  You should probably not be using `PlatformBitmapFactory` directly. Can you give us more context on what you are trying to achieve?

I don't understand the "blank bitmap (with alpha channel) but a picture for any uri" part. Is it a blank bitmap or is it a bitmap that shows image pointed by a specific uri?
 You should not be implementing `PlatformBitmapFactory`, we already did that. You can just get its instance from Fresco and create a bitmap directly:

```
CloseableReference<Bitmap> bitmapRef = Fresco.getImagePipelineFactory().getPlatformBitmapFactory().createBitmap(width, height);
```

However, keep in mind that you are responsible for managing the lifetime of your bitmap and you need to call `bitmapRef.close()` once you don't need the bitmap anymore.
  Thanks for making this fix! Please make sure that it works if padding is set on the view and then we can get this merged.
 @facebook-github-bot import
 @Aohayou Thanks so much for this PR but another came very soon after which I means I don't think is necessary anymore. See #1225.
  Most likely, the image is not fitting in the cache. You should make your cache bigger or download something that is the right size. 
  I'm afraid you have provided no information that could help us debug your problem. Perhaps you lost network connectivity. 
 Yes, https is supported.
  Does the fix from #1209 work for you? 
 If you're using our pre-built Maven / jCenter AARs, try with `compile 'com.facebook.fresco:animated-gif:0.10.0'` instead of `compile project(':animated-gif')` mentioned in #1209
  Taking a step back, why would you want to implement `PlatformBitmapFactory`? You should really just be using one of the provided implementations. 

It looks like you imported the wrong `CloseableReference` - you are using `java.io.CloseableReference`, not the Fresco one. 
  https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineExperiments.java#L80
  Please follow the instructions for building from source: http://frescolib.org/docs/building-from-source.html
  Not sure I follow. The network will only download one image at a time, right? The other requests will be queued until that one is finished. 
  See #335 
  Unfortunately the stock Java Uri.parse doesn't do escaping. You need to escape your string beforehand. Check this [StackOverflow](http://stackoverflow.com/questions/573184/java-convert-string-to-valid-uri-object) answer.
  Between 9 and 16 May building on the master branch was broken. Sorry about that.

Please git pull to ensure you have fb0f3f4bb056cf48bbdf290bd9e5b6626d27e42c then let us know if the problem persists.
 btw: you can follow the status on our CI server: https://circleci.com/gh/facebook/fresco
 The change which broke usages of okhttp has been reverted.

As for the problem with building the native libraries, try building from the command line by running `./gradlew build`.

I've heard some people say they can build the native code from the command line but not from within Studio. If this is the case for you, you should then be able to build from inside Studio as long as the C/C++ files are unchanged.

Let us know if this helps you and we'll try to resolve that issue too.
 We have pushed a couple of fixes to the build, including one for exactly the error message @ffelini quoted. Please let us know if it still won't build in your setup.
  Instead of screenshot, can you please provide this log in a textual format? Can you also give us more context on what oyu have to do in order to reproduce this issue?
 Closing as this seems to be resolved  This doesn't sound like a fresco issue. Perhaps your network is wrong, or something like that? 
  Looks like you are including two projects that include nineoldandroids. The latest version of Fresco has nineoldandroids as optional, I believe, so you should probably use that. 
  I'm not sure what you mean? Do you want the width of the downloaded image, or are you asking how to get the width of your view into which you want to download an image (in which case, this is not really a Fresco issue)? 
 Why do you want to do that? You can use `ImageInfo` to get the width and the height but this approach is not recommended. It will be a very jarring experience when the image loads. 
  There are numerous examples of similar issues. See OOMs and failing to allocate a bitmap on this page: http://frescolib.org/docs/troubleshooting.html
  The Eclipse instructions won't work for Android Studio. You need to instead set up a local Maven repo on your machine, download Fresco into it, and then point Android Studio to use it.
  No, this is not possible. You should use SimpleDraweeView if you are using Fresco. 
  It sounds like you are just calling `getProgress` once before the DataSource returns anything so that's why it returns 0.0. 

You need your `DataSubscriber` to implement `onProgressUpdate`. 
  There are numerous examples of similar issues. See `OOMs and failing to allocate a bitmap` on this page: http://frescolib.org/docs/troubleshooting.html
  Does this help? https://github.com/facebook/fresco/issues/239#issuecomment-102857475
 Closing due to lack of response  Can you try and add `fresco:roundWithOverlayColor="@color/your_color"`? It should be more efficient if you use the overlay color rounding mode.

See also http://frescolib.org/docs/rounded-corners-and-circles.html
 I don't think that should be the case, but glad that you found a solution. 
  You need to get the ZoomableController from the ZoomableDraweeView after which you can do various things with it. If you haven't set a custom `ZoomableController` and are just using the one created automatically by the view, it will be an instance of `AnimatedZoomableController`. Btw, check out `zoomToPoint` method too.

```
AnimatedZoomableController zoomableController = (AnimatedZoomableController) zoomableDraweeView.getZoomableController();
zoomableController.reset();
```
  Thanks for the PR @chthai64. Unfortunately this breaks the build, see https://circleci.com/gh/facebook/fresco/128

It seems that simply updating the version number is not enough.
 @facebook-github-bot import
 @chthai64 Could you please rebase again?

I've made a change which I hope will resolve Circle CI's memory problem but it would be great to confirm that before merging the PR.

Thanks so much for your help with this.
 Thanks. Circle is happy now so we can get this merged.
  What you see is one of the earliest progressive JPEG scans which is naturally of low quality, but gives some idea about what the image displays. You explicitly enabled this with `setProgressiveRenderingEnabled`. The question here is why the final image (of the high quality) doesn't show up. There are couple of possibilities:
- The image is still downloading and you need to wait (most likely).
- The image file is incomplete (less likely).
- An internal bug in the image pipeline (unlikely).

You can get an idea what is going on with that image by looking at the logcat as explained in the [Troubleshooting documentation](http://frescolib.org/docs/troubleshooting.html).
 I assume that this problem has been resolved. Please let us know if you're still experiencing this issue.
  Did you add the support version for WebP to your project according to [Adding Fresco to your Project](http://frescolib.org/docs/index.html)?
We made the core library smaller by making things like WebP support optional.
 If you're using ProGuard, also make sure that you set it up correctly, see http://frescolib.org/docs/proguard.html
 We changed some ProGuard configurations. Please let us know if you still have this issue.
  Hi! Did you set up ProGuard according to http://frescolib.org/docs/proguard.html ?
 Closing since there has been no further updates or reports of this since May 2016  Thank you very much! I'll import this once the CLA has been confirmed by the bot.
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 @facebook-github-bot import
  Thank you!
  That depends on how your app works. The ListView will recycle images when you scroll the list view. But the ScrollView won't recycle anything in the ListView if you scroll the ListView itself off screen.
 Picasso does not recycle images at all. They all stay in memory until the containing view is dereferenced, which may not be until the activity exits.
  Hi!

Please take a look at the [Image pipeline configuration documentation](http://frescolib.org/docs/configure-image-pipeline.html), which explains how you can customize all caches.
  Hi! I haven't checked what modifications you made to the samples code, but all you need to do is implement `GestureDetector.SimpleOnGestureListener` and set it as a setTapListener to your zoomable Drawee view.

```
 private void setTapListener(final ZoomableDraweeView view) {
    final AnimatedZoomableController zc = (AnimatedZoomableController) view.getZoomableController();
    view.setTapListener(new GestureDetector.SimpleOnGestureListener() {
      private final PointF mDoubleTapViewPoint = new PointF();
      private final PointF mDoubleTapImagePoint = new PointF();
      @Override
      public boolean onDoubleTapEvent(MotionEvent e) {
        PointF vp = new PointF(e.getX(), e.getY());
        PointF ip = zc.mapViewToImage(vp);
        switch (e.getAction()) {
          case MotionEvent.ACTION_DOWN:
            mDoubleTapViewPoint.set(vp);
            mDoubleTapImagePoint.set(ip);
            break;
          case MotionEvent.ACTION_UP:
            if (zc.getScaleFactor() < 1.5f) {
              zc.zoomToPoint(2.0f, ip, vp, DefaultZoomableController.LIMIT_ALL, 300, null);
            } else {
              zc.zoomToPoint(1.0f, ip, vp, DefaultZoomableController.LIMIT_ALL, 300, null);
            }
            break;
        }
        return true;
      }
    });
  }
```
  Is your ZoomableDraweeView in some container that intercepts touch events like a PagerView?
 Yeah, it's hard to tell what exactly causes PagerView to consume those events without knowing how you are using it.

Are you saying that you first zoom-in the photo and then, while it's zoomed in, you are unable to pan with a single finger? If that's the case I'm not really sure what's going on because ZoomableDraweeView is doing [getParent().requestDisallowInterceptTouchEvent](https://github.com/facebook/fresco/blob/9caa0fe12aafba7383816e7f48abbf4a883e34f3/samples/zoomable/src/main/java/com/facebook/samples/zoomable/ZoomableDraweeView.java#L264), which should prevent the parent from consuming the events.

You can put some breakpoints or logs there and see what events ZoomableDraweeView gets. We already have some verbose logging there.
  I provided code example in a duplicate issue #1183
  That warning was added to OkHttp [here](https://github.com/square/okhttp/commit/4ae314a1f21d07ee5dbad024bc098182219e9e07) which is more recent than 2.6, which is what Fresco 0.9.1 depended on, so that explains the warning not showing before.

Taking a look at a couple of issues around this warning on OkHttp's project it seems the advice is to always call `ResponseBody.close()` regardless of whether the response was successfull and I've noticed we don't do that in the [error case](https://github.com/facebook/fresco/blob/master/imagepipeline-backends/imagepipeline-okhttp3/src/main/java/com/facebook/imagepipeline/backends/okhttp3/OkHttpNetworkFetcher.java#L109).

I'll fix this.
 I think I have a fix but I've been unable to reproduce the bug. When you say you're mangling the URLs are you simply changing the URL before adding it to the `ImageRequest`?

If they're not private, would you mind sending me an example of one of these URLs to see if that then reproduces the original issue for me.
 I'm still unable to reproduce the bug following the same approach that causes problems for you.

Can you share with me the code where you setup your `OkHttpClient` instance in case something you've set there is related?
 @jmbusby I've confirmed that the addition of the `ImageHttpRequestInterceptor` uncovered this issue and that my fix resolves it in this case. The fix will be merged to master soon.
  Hi!

`compile 'com.facebook.fresco:fresco:0.10.0'` depends on drawee and should automatically download the artifacts required. It works for me for a demo project.

Can you try and refresh the Gradle project (`./gradlew clean build` should run without errors)? And if you're using Android Studio / IntelliJ, sync your project with Gradle again / restart it.

If this doesn't work you can always manually add the drawee dependency by adding

`compile 'com.facebook.fresco:drawee:0.10.0'`

Please let us know if this fixes the problem.
 @droidekas yes your change in #1086 got merged after the release cut. It will be included in the next release.

I have added the styleable change to https://github.com/facebook/fresco/releases/tag/v0.10.0
  You are right, we could add these methods. I don't think that there is a particular reason why we did not add this.
 If you want, feel free to submit a pull request that adds this :)
  You can take a look at the [Fresco ProGuard documentation](http://frescolib.org/docs/proguard.html). If you have ProGuard issues with animated-gif, please give us more details.
 @oprisnik I copy the ProGuard text to my ProGuard file, but it's not working. It can't display gif in all  devices.
 Did you add the support version for animated GIFs to your projects according to [Adding Fresco to your Project](http://frescolib.org/docs/index.html)?
We made the core library smaller by making things like GIF support optional.
 ``` groovy
`compile 'com.facebook.fresco:fresco:0.10.0'
compile 'com.facebook.fresco:animated-gif:0.10.0'
compile 'com.facebook.fresco:imagepipeline-okhttp3:0.10.0'`

`# fresco start------------------------
# Keep our interfaces so they can be used by other ProGuard rules.
# See http://sourceforge.net/p/proguard/bugs/466/
-keep,allowobfuscation @interface com.facebook.common.internal.DoNotStrip

# Do not strip any method/class that is annotated with @DoNotStrip
-keep @com.facebook.common.internal.DoNotStrip class *
-keepclassmembers class * {
    @com.facebook.common.internal.DoNotStrip *;
}

# Keep native methods
-keepclassmembers class * {
    native <methods>;
}
-keep class com.facebook.animated.gif.** {
    *;
}

-keep class com.facebook.** {
    *;
}
-dontwarn okio.**
-dontwarn javax.annotation.**
# Keep native methods
-dontwarn com.android.volley.toolbox.**
# fresco end ------------------------`

Finally when I add below code, it's working.
`-keep class com.facebook.** {
    *;
}`
```
 Does it work if you add `compile 'com.facebook.fresco:animated-base-support:0.10.0'`?

A stack trace for the crash could also be helpful, thanks.
 It doesn't crash and works well. It just didn't play gif when using proguard. My project's min sdk is 15.
My problem is that the proguard in ducumentation doesn't work well
 We've fixed this issue in 0d0c5757ff40eb9e9f23533c9798dcdde095ce86.
With the next release, you don't need to manually change your ProGuard files any more.
Thanks for reporting!
  Hi! 

**Update**: See my post below on how you can use vector drawables with Fresco.

Original comment:
We currently do not support vector drawables for API < 21. 
It works for API 21 and above because Android added native vector drawable support with Lollipop. The support library internally replaces your `ImageView` with `AppCompatImageView` (which supports vectors pre-Lollipop) but it can't do this for `DraweeView`. 
You can also take a look at https://medium.com/@chrisbanes/appcompat-v23-2-age-of-the-vectors-91cbafa87c88#.hwhg5l1rd for more information.
 A bit of a clarification there: By "We currently do not support vector drawables for API < 21." I meant we do not support vector drawables if specified **in XML**.
You can of course still us Fresco with support vector drawables that should work on all supported Android versions by building your own drawee hierarchy in Java.

A quick example for this would be:

``` java
// android.support.v4.content.ContextCompat creates your vector drawable
Drawable placeholderDrawable = ContextCompat.getDrawable(context, R.drawable.yourVectorAsset);

SimpleDraweeView draweeView = (SimpleDraweeView) findViewById(R.id.yourImage);

// Set the placeholder image to the placeholder vector drawable
draweeView.setHierarchy(
    GenericDraweeHierarchyBuilder.newInstance(context.getResources())
        .setPlaceholderImage(placeholderDrawable)
        .build());
```
 I just tested this and it also works for me if I define the placeholder in XML

``` xml
<com.facebook.drawee.view.SimpleDraweeView
    android:id="@+id/drawee"
    ...
    fresco:placeholderImage="@drawable/vector_graphic"
    />
```

with

`compile 'com.android.support:appcompat-v7:23.2.1'`

and 

```
android {
    defaultConfig { 
        vectorDrawables.useSupportLibrary = true  
    }
}
```

in my build.gradle.
 It works for me on Jelly Bean, so yes.
 Great! 
 You can add custom SVG decoders and drawable factories now. A very simple example how this could look like can be found here: https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg   Hi! We split the Fresco library up in v0.10.0 and you have to enable GIF support by adding

```
// For animated GIF support
compile 'com.facebook.fresco:animated-gif:0.10.0'
```

to your build.gradle.

More information can be found here: http://frescolib.org/docs/index.html
  If this thing is easy to do it would already be supported :) You should take a look at the [resizing section in the documentation](http://frescolib.org/docs/resizing-rotating.html).

I am not sure how exactly are you performing that resizing, but one way to do it would be via [post-processors](http://frescolib.org/docs/modifying-image.html). Post-processed images can be cached and that might work for you.

Downside of that approach is that both the big original image and the resized image will be stored in the bitmap cache.
  Hi @assadyouness,
Thank you very much for the tip. 
  I would like to create a sprite animation using Fresco.
Once i load the image into SimpleDraweeView, and i got the coordinates of the rectangle that i want to show, how can i tell SimpleDraweeView to only display that part(the rectangle) of that image? 

With regards,
Hay.
 If anyone will look for this, i managed to do it by extending the BaseRepeatedPostProcessor.

But i have another issue when if im quickly changing the png file that contains the sprite resources to some other png file(containing other sprite resource) and i wish to displays it, the more i'm repeating this the more the image is getting slowly invisible untill it dissapears.

The images that i load are really small, they are 180 x 32 pixels which is 2.5kbs +- of disk size.
 Implement a custom [ScalingUtils.ScaleType](http://frescolib.org/docs/scaling.html) and set it as `simpleDraweeView.getHierarchy().setActualImageScaleType(mySpriteScaleType)`.

Then in your animator you can do something like:

```
MySpriteScaleType mySpriteScaleType = (MySpriteScaleType) simpleDraweeView.getHierarchy().getActualImageScaleType();
mySpriteScaleType.setSprite(...);
simpleDraweeView.getHierarchy().setActualImageScaleType(mySpriteScaleType);
```
  Hi @eldk,
yes, you're right. If you just want to support static Webp for API < 14 you have to add 

`'compile 'com.facebook.fresco:webpsupport:0.10.0'`

Thanks
  Hi @ing670,
what do you mean with multi placeholder? Can you describe a possible use case?
Thanks
  This is similar to #1078. Since OkHttp 3 is now available, we should prefer it over v2.
  Hi @ziad-halabi9,
Thanks for you post. At the moment every time we send a request we show the placeholder. This is the behavior of most the use case. Why would you need to keep the previous image when requesting the new onein a recycling logic? 
Thanks
 You should build your drawee controller with both `lowResImageRequest` and `imageRequest` set as explained [here](http://frescolib.org/docs/requesting-multiple-images.html). Then Fresco will take care of loading the low res and automatically replacing it with high-res as soon as it is available.
 See #1328 and linked issues there.  Hi! Did you mean to create this pull request? Can you give us more details what you would like to do?
 No problem, I'm closing it then.
  Thanks!
  The `getMainDiskStorageCache()` method has been deprecated. You can use: 
`getMainFileCache().getSize()`  in `ImagePipelineFactory`
  Thanks!
  Hi @zfdang,
if I try to download the image from the browser I get the same error. This is not an issue related to Fresco. 
Thanks
  Hi @ndurell,
if you want make the PR you should change branch

https://github.com/facebook/fresco/blob/gh-pages/_docs/03-troubleshooting.md

Thanks
 Thanks for the PR @ndurell. There are just no tests for the github pages and for some reason this gets reported as failing. Everything is OK, I just merged your PR.
  Hi @ndurell,
the @NotStrip annotation should be on all the classes whose instance are created with reflection. The annotation should be there but I'll double check.
Thanks
  Hi @leeon7,
as said at the isses you mentioned you should call Fresco.shutdown() just once when you finish your application. Anyway we need to improve that method in order to do more than clear memory caches. I'll close this issue and keep opened the other one.
Thanks
  Thanks,
release notes are also here https://github.com/facebook/fresco/releases/tag/v0.10.0
  Hi @eastwoodwang and @Casper3635,
do you still have the same problem with 0.10.0?

Thanks
  Closing as this type of authentication for HTTP is more or less obsolete.  @eidk is correct, you need to call Fresco.initialize.
  Thanks @wgykontage,
can you please provide information on the version of Gradle you're using?
 Perfect.
Thanks
  In our comparison app we're using Drawee into a RecyclerView. Please use that demo app as reference.
 @howedeng Thank for this. We'll make some test about this. 
  You have quite a few libraries there so I wonder if the 65k method limit is the cause.

A quick search showed this StackOverflow answer which I think will help you. http://stackoverflow.com/a/30692005
 No problem. I'll close the issue but feel free to re-open if the problem continues.
  Can you first do 

``` bash
./gradlew clean allclean
```

and try again?
 @XuWeishun,
what version of Gradle are you using?
Thanks
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  There is not much that we can do here. As the exception suggests, this happens when your app shuts down while Fresco is initializing (e.g. because of a different crash, or because of user exit). There's not much we can do here, there is no way to detect this condition. Furthermore, because the app is already shutting down, there isn't much user impact here (they're not getting thrown out of the app because of this).

Since there's no action that we can take here, I'll close this now.  Url Encoding is responsibility of the client. Why is this encoded?
  Thanks very much. The new website just went live yesterday and we hadn't noticed that.
 Oh, actually, I'll suggest an improvement here. Because `ghrepo` is defined in [_config.yml](https://github.com/facebook/fresco/blob/gh-pages/_config.yml#L13) it becomes available to use in templates like this footer as {{ site.ghrepo }}, so you should be able to change that to:

```
 <a class="footerLink" href="https://github.com/{{ site.ghrepo }}" target="_blank">Contribute to this project on GitHub</a>
```
 OK, I've just merged the PR so I'll change that separately.
  You are using fading animation with fresco (`setFadeDuration(300)`), but no animation with Glide (`dontAnimate`). Try disablign fading with Fresco too: `setFadeDuration(0)`

Btw, if you are reusing `photoImageView`, there is no need to create the hierarchy each time. Do this only once when the view gets instantiated. Or if the view gets inflated, just specify placeholder, failure and fade duration in XML and that's it. Creating hierarchy each time is wasteful as explained in the [documentation](http://frescolib.org/docs/using-drawees-code.html).
  We will need more details than this. What was your application doing? What type of image was being decoded? What device(s) does this occur on? Does this consistently reproduce?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  Can you please share a snippet of your code?

You say you're using the last displayed drawable but I wonder if you're somehow setting a drawable inside the same hierarchy twice, creating an infinite loop.
 This will happen if there is a loop in the hierarchy tree. Setting the top-level-drawable as a placeholder in the same hierarchy would do that. If you are trying to show the previously set image as a placeholder, this is a wrong way to do it.

Instead, you should build a `DraweeController` with `setLowResIamgeRequest` pointing to the old image and `setImageRequest` pointing to the new one as explained [here](http://frescolib.org/docs/requesting-multiple-images.html).
  I suggest trying the [solution here to use the ReLinker library](https://github.com/facebook/fresco/issues/933#issuecomment-186266187). We've found that's helped people in the past with this problem.

Please re-open the issue if you continue to have problems.
  @matthewjohnston4 updated the pull request.
 @matthewjohnston4 updated the pull request.
 @matthewjohnston4 updated the pull request.
  Can you please clarify? Is the ZoomableDraweeView consuming the touch events or the ViewPager?

I think you mean the zoomed image isn't scrolling around so I'll check that.
 OK, I may need to create a test for this scenario. I'll look into that.
 This is a known issue. Keep in mind that the zoomable code provided are only examples of how a zoomable view implementation might look like.
 I'm pretty sure that this is the behavior you'd want most of the time. Zooming in on an image and then not being able to pan around would be quite weird. If you need this behavior, you can just manually set a gesture listener that doesn't pan to the left or right side.  Fresco already stop image loading while scrolling. please refer our comparison app as reference on how to use Fresco into a RecyclerView.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  You don't need direct access to `GenericDraweeHierarchyInflater`. That class will simply look for any of the properties identified within it in the properties you've identified in your layout XML file.

You can take the approach shown in the implementation you linked to if you want to set those values in code or you can set the values in your XML layout.

If you need further help, please let me know which properties you're trying to set and I can try to be more specific.
 OK great. For now, I'm going to close the issue but please reopen if you still have problems.
  The change looks good but I have some small comments to add. Also, it would be great if you could add a unit test or two for the new methods.
 @chethann updated the pull request.
 @chethann updated the pull request.
 Thanks for this. We currently have an issue with out import script but this should be imported in the next few days.
 @facebook-github-bot import
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/1674489499482165/int_phab) to review.
  Thanks for your interest in translating our page, that would be fantastic.

I'm afraid that right now we don't have a great way of supporting multiple languages with the way our pages are setup.

The existing translations are actually self-hosted by the people who were kind enough to do them. That would be an option but we're also discussing how we may be able to accommodate translations on our main GitHub pages. We'll let you know what comes out of that discussion.
 The English files are found here in the repo, in the [gh-pages](https://github.com/facebook/fresco/tree/gh-pages) branch.

We would be very happy for you to set up your own repos for Spanish and Portuguese. You can see the [Chinese](https://github.com/liaohuqiu/fresco-docs-cn) and [Korean](https://github.com/recrack/fresco-docs-kr) repos for examples. I believe these files are automatically published using GitHub's Pages facility.

We don't yet have a way of automatically notifying volunteer translators of changes in the English docs. The best you can do for now is watch the repo and keep an eye on changes to the gh-pages branch.

Thanks for your help! We really appreciate it. We would be happy to place links to your translations from the English site once they are ready.
  What do you mean by concurrent? Can you show what you want to achieve here and how do you deal with it and also full error log from logcat? The error you pasted above are from skia and android, which basically cannot help us understand anything.
  Answered in stackoverflow
 I can see my comments from there now. Can you please check it again?
  What bugs do you mean by that? We'll have a new release shortly.
 please try with the solution with #933 . If you experience bugs, please create a new thread or join an existing one so we can track for each.
  dup of #410
  Please use setController with resizeOption.
  Please try with Uri.fromFile instead of using "file://" directly
  please follow the guide, it tells you all the essential steps to build fresco. And let me know which step you fail from there.
 `getNdkBuildFullPath` is broken again and gradle script can't get path for `ndk-build.cmd`. I added NDK path to environment variables and that worked. Btw, if you have white spaces anywhere in your path, you are doomed.
 Closing as it's been more than a year since the last update.  We have a comparison sample app for using RecyclerView. You can refer on that app. Also can you show how you use RecyclerView with Drawee?
 Thanks for sharing your code. I believe it's helped me find the solution.

Take a look at [this line in our sample](https://github.com/facebook/fresco/blob/master/samples/comparison/src/main/java/com/facebook/samples/comparison/holders/FrescoHolder.java#L52). By calling `setOldController()` like this, the existing controller may actually be reused and the old image is cleared from memory.

In you case this should be done in `MediasAdapter` in the chained build which starts at line 73.
 Feel free to reopen the issue if you continue to have a problem.
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know how to do something or something is not working as you expect but not sure it's a bug, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
  Hi!

Could you please post a screenshot of the drawee view and of the progress bar drawable itself?

Does it work if you use `OVERLAY_COLOR` instead? (see #153 and [the documentation for rounded corners](http://frescolib.org/docs/rounded-corners-and-circles.html))
 Can you share the screenshot of your view to show what do you mean by "But there are also two diameter lines (one vertical and one horizontal, marking something like a cross) below the progress bar image." And also which fresco lib version do you use?
 That's a bug we fixed and will come out in the next release. If you wanna fix it right now, you can modify your progress bar image by making the pixel on edge "not green". When the bitmap is upscaled to the dimen of hosting view, the edge gets repeated.
  You have 1 image with path X. You change the file with this path to a different image and then set the same path again for the drawee view?
Aid with your code it does not update the image but uses the one in the memory cache?
If it is a local image, it is not stored in disk cache but in memory only.

What does `clearFerscoCache(mPath);` do?
 I assume the problem has been resolved. Please let us know if you're still experiencing this issue.  placeholderImage is from local device. You should make your local image smaller in terms of performance.
  May I understand why you don't use preview image as placeholderImage?
 See #1328 for a potential workaround  duplicate of #410 
  Thank you very much for your report. We'll look into this!
 Can I ask you to double-check the context which is passed to `Fresco.initialize(Context)`?

The details above shows `mContext` (which is set to whatever you pass into that method) has an instance of `com.cibersons.monchis.activities.MainActivity` but I presume that's not your application class.
 Hi @votagus 
we're now explicitly calling Context.getApplicationContext() [here](https://github.com/facebook/fresco/blob/c83333404edfd9e7d87183e4bedafbd6f34a99c6/drawee-backends/drawee-pipeline/src/main/java/com/facebook/drawee/backends/pipeline/Fresco.java#L63).

This should be ok now.
Thanks
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Other than the imports being reordered, I don't see any other changes. What am I missing?
 It looks like, although GitHub doesn't realize you need a rebase, you do. Your changes are overwritten by code from master.
 As the others have said, there doesn't appear to be an actual change here and this has been sitting here for a while.

I'm going to close the PR but you can create a new one if there's something you want to change.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 @huangjunkun updated the pull request.
 @huangjunkun updated the pull request.
 @huangjunkun updated the pull request.
 First, thanks for your PR. We really appreciate contributions from others.

It would help if you could explain what problem you're trying to fix though. I don't see a link to an issue this should resolve and you haven't explained the scenario where there is a problem without these changes.

Also, you've added some HTTP changes which don't relate to the title or description (and should probably be in a separate PR) and some of your changes are incorrectly formatted (in particular, we use two-space indents).

If you can explain the purpose of the changes we can better review them. It would particularly help if you could include an example `ImageRequest` and `ImagePipelineConfig` which benefit from this.
 Also, have you signed our CLA? It looks like the Github Bot has not updated the PR to say you have.
 It would be good to make two separate pull requests, one for LocalFetcher, the other for NetworkFetcher, as these two seems to be unrelated.
  Can you please clarify your problem?

Do you mean thumbnails? If so, only Jpeg thumbnails are supported.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 @luksdlt92 updated the pull request.
  when will new version 0.9.1 be release ?
Thank you~
 We are going to release a new version very soon. Stay tuned!
  @a631855639 updated the pull request.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 @tikiet updated the pull request.
  Thanks for letting us know. You can actually send us pull request from feature did or bug you found.
  THanks for pointing it out. We'll fix the bug asap.
 This is actually an experimental config option which I wouldn't currently recommend using.

In the next release this has been moved to a separate class to the main `ImagePipelineConfig` called [`ImagePipelineExperiments`](https://github.com/facebook/fresco/blob/abeb080ce8135326a450e65b2e00b95f9dacd876/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineExperiments.java) to make it more obvious that this is one of a few options which are riskier to change.
  please try with downsampling or resizeOption for your jpeg image. You don't need to load full image of 30MB.
  Combine into #1088 
  As this is solved, I'm closing the task.
 You should use `UriUtil`, see https://github.com/facebook/fresco/blob/master/fbcore/src/main/java/com/facebook/common/util/UriUtil.java#L218  For local images, it won't be available immediately as well. There's still chance of glitch when view size get changed. You can use aspect ratio to get a none square view you want.
  This looks good to me but please fix the formatting, specifically to switch to two-space indentation as in the rest of the project.
 @droidekas updated the pull request.
 @facebook-github-bot shipit
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/1799779800243873/int_phab) to review.
 @facebook-github-bot import
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/1799779800243873/int_phab) to review.
 @facebook-github-bot shipit
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/1799779800243873/int_phab) to review.
  unfortunately we don't support it now
 You can add a comment here with your solution :)
 Closing as there has been no updates for the last year. A potential solution to this would be to modify Fresco and then publish the build artifact to your own maven repo (or even a local one if it does not need to be shared)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  æœ¬åœ°å›¾ç‰‡æ˜¯780900ï¼Œä¼ å…¥çš„ResizeOptionsæ˜¯16001600,è¿”å›žçš„å›¾ç‰‡å¤§å°æ˜¯195*255çš„å›¾ç‰‡,æ€Žä¹ˆä¸æ˜¯åŽŸå›¾
you don't need to load the entire bitmap in the view if your view is a lot smaller in dimension

å¹¶ä¸”ä¸‹æ¬¡å–è¯¥å›¾æ˜¯æ˜¯ç›´æŽ¥è¿”å›žäº†å†…å­˜ä¸­çš„è¯¥å›¾
We cache bitmap and retrieve it for you next time when you need the same image
  Can you provide the piece of XML that specifies SimpleDraweeView?
 These problems are usually caused by not calling `Fresco.initialize` as @Anier2015 said.

If you have called it, please open a new issue, and paste in the section of the stack trace below any text like "Caused by".
  sorry I don't really understand your question here. Why do you need to compile fresco in other module?
 I assume the problem has been resolved. If not, please let us know.  @szpnygo, Why do you need a network image as a placeholder? The concept of placeholder is different. It should be an image to show while you download the image and it should be already present as a resource. 
 @szpnygo updated the pull request.
 Hi @szpnygo ! Thanks for your pull request and sorry for the delays. Adding uri attribute to XML seems fine, but we should do it for `SimpleDraweeView`, not for `GenericDraweeView`. `GenericDraweeView` doesn't know about uris, image requests, etc, and we should try to keep it that way.
 @szpnygo updated the pull request.
 @szpnygo updated the pull request.
 @szpnygo updated the pull request.
 @szpnygo updated the pull request.
 Looks good, thanks!
 Amazing, thank you! We will import it in the next batch.

Just a note for the rest of Fresco reviewers, this is the image the data uri contains (in webp format): ![img](https://cloud.githubusercontent.com/assets/3705123/15268528/4374dafa-19da-11e6-95ac-3afbcef93107.png)
To be on a safe side, I'd suggest replacing it with a Fresco logo: ![fresco logo](https://cloud.githubusercontent.com/assets/3705123/15268683/e778912e-19de-11e6-97ae-98155a11eb75.png)

```
fresco:imageUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEZ0l
EQVR42u2bWUgVURjHzXZoxyyQqMhKbRdbsDBte7BsoaiwMkMyKoQi9fYSRA9hGq0PESRmD1kQZWELbWALQRFYUUFEaVC
0WCZlmqbT/4tv4uM0c+cGLbM9/LnO3P+9nvPzzJlvGcM0TQvzssJ8AD4AH4APwAfgA/AB/HE1z+sYCZVAd6F4C280dBq
6CkVZeBOgSqgcmmNLABjYNOgJpLHyg3iXQK+EN83E1w7KgeqF94itAGBAnaGt0FcxSFKugbcndEDxkWYbeKOgEwbew7Y
BgMEMgy6LwTVALUYAcDwRuie8n6A2IwB0DD3j99rYq3+u5L8DwCB6QOnQWzGwW9Bi6I0EgNf20Cbos/CehDLVFcCrqRD
6Jt7bAwXsBuCQsizpuAs0GPqgAFgvfM10ufD5RAMAu8S5Oiibz2fbDYBc9huUS6JOAVDEx43QQuFNFt+RyufO8TGtogT
hXWs3ABd4MK3QcAsABXxcTbdJCwDl+uWk/D7bAqANanSIAF5A/UMEcMepACi4eR8igMTfALDaKQDm8kb3MxAKAiBHTGq
OBYB9tgqElD1gBJ/bqNzq1hgAoFA5HNrJn9W9yQqA2yK0Pip89Jn9dgJA0d8MqFQMku7he6GuCoCn0FSO/TXx+YD4Xh3
ADWgy9Eh4a6FVUISdALQowdBLaJHi1QF8gd4J70MoSfHqAOqV+P8mNNI22aAAIHUeGmTgLTDwlhr9JQUATewxhfpqshM
AGQhRgLOZr216L4VvW93YWyi8FCVmsY80H8qAOrD3rPBWm2WJdgCQy6lvFV/XdK4TtE3cBfRNMBV6DV2DRrFXzQqTRch
LkE5BA21bEOEEpzcnRXQcC11Rlq/c3PrSMmbvBOi+4k1jH62ifpQUOaYihMEuVzZCzSQdJmh5nDJb1gNsD4BXQLGYBO3
yZWo2yF7KEs8IL0WLx0Qs4CwAnMvLZUzX+AKeaK0SCo/nIEj3PobGcZ1PcyqAi2LwVKyMDiEZ0jiqizRIhhwHQMYB8Rb
Z4A4RJEWZZIOOBdAqIzSLFVBDO7zbAKjZ4FCDkphZNpjkRgCxIoa3AjDTVQAocoMqxKTyzADgdQx3j4I2RpwAgFLfIRz
/14gJ0c9jFQDPOb+nlPaj8FZZtcbsDKCRgx9ZCKmQWaEAQK2w46JxonEg1cdxzVGTdJhg5FM/L4R0mOoCmY7tDmPwl5Q
JPeAiZxg3SCKEt0jxXofiHN0eV+p0P5YxTz6Os0Ja7inszRf7xfa/nen9KwAU86+k8pcobmQoJa8Ae7tD66BZrnxAgv/
6xVbpsCufEMEkpyiVW+rpNbkeACY3gOuATWLyVMaarrbH3QqgTKntbxGtsTovAJC3wfRg2aBbAch0OMbLACzb414D8Et
73GsAssSTXwHP7AH8QONuMXnSCi8AoDhgqdIVauDWWbhXVoCsBVCvYJLrH5Y2qQcchHp54mlxJRCi0HeZpx6X51S4kh9
sjPH/X8AH4APwAfgAfAA+AB+AU/Qd42W8mKN4nlcAAAAASUVORK5CYII="
```
 @szpnygo updated the pull request.
 @facebook-github-bot import
 This looks good to me. I'm importing it now so we can merge it.
 @szpnygo Please rebase. There are merge conflicts.
 Hi @szpnygo,
we know that and a pull request is already available to fix it. Please stay tuned. 
Thanks
 @facebook-github-bot import
 I've just realised we have a problem with this internally as we already have an imageUri property in another of our modules which clashes with this.

We've just discussed the clash and think changing this name to `actualImageUri` would both get past this problem in our codebase and also make sense anyway as it fits with naming conventions we use in drawee hierarchy.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you!
 @shenghaiyang updated the pull request.
  Please provide more information.
Thanks
 merge in #410 
  SimpleDraweeView is not "Data Binding compatible" at the moment and we don't have plan to do that in short period. In order to do so please feel free to create your pull request we'll be happy to approve.
Thanks
  The same as #1074 
  What type of ViewPagerAdapter are you using? At what stage are you making the request for the image?
Thanks
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks! Can you please resolve the merge conflicts?
  The question is not clear. Can you provide more information please?
Thanks
  Thank you @Roma-Lis, we'll investigate the problem. Can you please provide us a snippet of the cose you use into the RecyclerView
Thanks
 I wonder whether my comment here will help. It relates to reusing the controller in `onBindViewHolder()`.

https://github.com/facebook/fresco/issues/1113#issuecomment-211455186
 As a workaround for now add `android:largeHeap="true"` to your `AndroidManifest.xml` file.
 I'm not aware of anything specifically that might have fixed this, though I would say that we don't have similar problems with the Nexus 5X internally and are obviously loading a lot of images within RecyclerViews too.

First thing to try would be to upgrade to the latest release: 1.0.1.

Beyond that, I can suggest some more diagnostic tools if you're seeing problems with this. Would also recommend that ResizeOptions are used in case the loaded images are large. Closing issue for now but please comment with any additional useful information that could help us investigate this. Thanks!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 There are a couple of things going on here.
- FadeDrawable already supports independently fading each layer. Therefore, no changes are necessary to it.
- As for the GenericDraweeHierarchy changes, it is not clear what is the fading semantics with crossfade disabled.

Can you give us more context on what are you trying to achieve actually? If you do not wish placeholder to be faded out when fading to the actual image, you can set it as a background instead. That way it will stay faded in. We will be able to help once you provide more context on what behavior would you liek to achieve.
 Thanks! I believe you can actually achieve what you want without any changes to Fresco. See my comment on the issue.
  Hi,
can you please check if all the permission are ok and if there's enough space on the device please?
Thanks
 Closing as this seems to be harmless.  Yes, as @eldk said the image is too big. You should use ResizeOptions to resize it.
Thanks
  The log doesn't say too much. Can you provide please the code you're using into your ListView?
Thanks
 Hi,
for sure you have to initialize Fresco just ones so this code should not be in the getView() method.
`
Fresco.initialize(mContext.getApplicationContext(),ImagePipelineConfigFactory.getOkHttpImagePipelineConfig(mContext.getApplicationContext()));â€¨`
 I suggest you to give a look to our sample application [here](https://github.com/facebook/fresco/tree/master/samples) on how to use Fresco into a ListView o RecyclerView.

Thanks
 Hi @leeon7,
Actually Fresco.shutdown() should stop all services, executors and clean stuff in order to release resources. At the moment it's just clearing memory caches. We're going to improve this but i think this should be invoked, if you want, when the application stops and so on the onDestroy() of the main Activity. Thanks
 Closing old issues  We're considering to do this. Stay tuned! :)
  Thank you @qindachang,
we'll investigate the use case.
 I don't really understand the issue here. Could you give us a minimal example that shows how to reproduce the issue? (for example by modifying the Showcase sample app in GitHub).

I'll re-open once we have more details  When we load an image we also put it into the cache. If the image has some ResizeOptions we put also the resized image into the cache with different key. In your case you should fetch the image without resizeOptions and query its size on the Bitmap object. Obviously if the image is very big (greater that 2048x2048) there might be some problems. Hope this answers.
 Closing as the suggested solution seems to cover the use case, and further comment was made.  To manage animation you should check this [code](https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/animated/base/AnimatedDrawableBackend.java) and in general what's in the java.com.facebook.imagepipeline.animated.base packages. We'll provide more documentation on that.

Thanks
  Android has a limit of 4k \* 4k on images, so the height of your image is too great. You need to resize the image to make sure it fits within Android's limits.
  please try the solution described here. https://github.com/facebook/fresco/issues/933
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Great, thank you very much!
 @kevinzetterstrom updated the pull request.
  We manage the memory using a deterministic approach in order to optimize its usage. Anyway you can use a [BaseDataSubscriber](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/fbcore/src/main/java/com/facebook/datasource/BaseDataSubscriber.java) but in this case you have to manage the memory on your own.
  The onIntermediateImageSet() is not so accurate and is relative to all the pipeline process. The feature you're requesting is a feature of the Network layer and can be probably done at that level. http://frescolib.org/docs/using-other-network-layers.html#using-your-own-network-fetcher-optional
  I don't fully understand the issue. What exactly is, and what exactly is not being called?
Do you see `Log.d(TAG, "onTouch")` in the logcat? Can you also log `motionEvent.getaction()`? We need to see if both ACTION_DOWN and ACTION_UP get passed to your gestureDetector.
  We're working on making the library size smaller and writing a post/doc about what to do to make your app smaller.
In general if you don't need any additional functionality it will be ~600k or less.

The reason why it's so big is because we're using a bunch of open source native libraries for additional functionality (eg. webp support back to Gingerbread, animated gif and animated webp, etc). The native libraries have .so files for all the architectures (x86, armv7, arm, etc) so if you're not building different apk's for different architectures all of them will be included in your apk.

We're planning to make the extra features optional and writing a doc about how to minimize the library size.
  cc @massimocarli 
Any idea why this is happening?
 Our general recommendation for this type of issue is to use SoLoader: https://github.com/facebook/SoLoader  Thanks @qiuqiutang,
we'll make some investigation.
 @qiuqiutang, can you please provide the url and link of your image so we can get access to it?
 This is a known limitation as explained in the [documentation](http://frescolib.org/docs/rounded-corners-and-circles.html).
  I've tested the URL with our demo app and everything works. What's the code you're using to show it?

Thanks
 Please follow the "Investigating issues with logcat" section of the [troubleshooting page](http://frescolib.org/docs/troubleshooting.html) and paste the log output here.
 I assume the problem has been resolved. If not, please let us know.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks!
  http://frescolib.org/docs/listening-download-events.html#_
 @younas-bangash You can register a `ControllerListener` and react in the `onFailure` method. See http://frescolib.org/docs/listening-to-events.html  There has to be logcat, but you need to enable `VERBOSE` logging for your app while debugging this. See [here](http://developer.android.com/reference/android/util/Log.html#isLoggable%28java.lang.String,%20int%29) how to do that.
Then provide paste of the logcat obtained as explained [here](http://frescolib.org/docs/troubleshooting.html#_).
Without this information there is no way for us to know what is happening.
  I cannot open the link with the logs. Can you attach the txt file here on github?
  If `onRelease` has been called, it means DraweeView for some reason thinks it's not visible. Can you please provide the logcat logs as explained [here](http://frescolib.org/docs/troubleshooting.html#_)?
 The sequence of events shows that the controller is detached very soon, before the request to network has even gone out. Fresco is told that the controller is detached, so it cancels the network request. 

The weird thing is why the controller gets detached when it is actually on-screen. This might be an issue with the ViewPager code itself, at least on this device.

`onDetach` is called from either `View.onStartTemporaryDetach` or `View.detachFromWindow`. For whatever reason one of these is being called. If you can set a breakpoint to them in your debugger and find when one of them is called on the SDV, that would give you a clue.
 I assume the problem has been resolved. If not, please let us know.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Great find! `EncodedImage` clones the reference as it should per contract, but `LocalExifThumbnailProducer` forgets to close the original one. Thanks for this fix!
 @facebook-github-bot import
  Yes, fresco does support both things.
- CacheKey: You need to provide a custom `CacheKeyFactory` while initializing `Fresco`. You can just extend the [DefaultCacheKeyFactory](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.java) and override `getEncodedCacheKey`. There you can build a cache key from the normalize uri ("photos/image1.jpg").
- Animations: You can specify a `ControllerListener` that will notify you once the image is loaded. The `onFinalImageSet` callback provides `Animatable` which can be started/stopped at your convenience.
  Looks good, can you please address the tiny comment?
 @froxCZ updated the pull request.
 @froxCZ We'll merge it soon.

@facebook-github-bot import
 Thanks for importing. If you are an FB employee go to [Phabricator](https://our.intern.facebook.com/intern/opensource/github/pull_request/1646490392281310/int_phab) to review.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks!
 @paulomcnally updated the pull request.
  Yes, that used to be a bug, but I believe this has been fixed recently. I am not sure If we released the version with the fix yet. What is the Fresco version you use?
 Yeah, this has been fixed internally, but the code has not yet been pushed to GitHub.
 Very soon, stay tuned!
  @AllenVork, any reason why you want to turn off the "enforce GPU rendering"? From 4.0, the "Force GPU rendering" option is vestigial and it's already the default.
 Using a overlay color for rounding should be a workaround for this, see http://frescolib.org/docs/rounded-corners-and-circles.html

The question still remains why you are disabling GPU rendering in the first place?
 Closing as a workaround was suggested. Forcefully disabling hardware acceleration is usually not a good idea.   Is the wrong image displayed permanently, or does the right image appear after a while ?
 I see. Could you capture and share with us logcat output when this happens? http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat
 Just to narrow down the issue, does this still happen if you remove the following options:

```
setLocalThumbnailPreviewsEnabled(true)

setOldController(mImageView.getController())
setAutoPlayAnimations(false)
```

Btw, `SimpleDraweeView` will never have a null hierarchy, therefore you don't need that null check. Also, you can set the fade duration in XML and then you can remove the whole `setHierarchyForDraweeView` method and just do:

```
GenericDraweeHierarchy hierarchy = mImageView.getHierarchy();
```
  Do you use proguard ? Can you make sure this is included in proguard config: https://github.com/facebook/fresco/blob/master/proguard-fresco.pro ?
 @imliujun Have you tired the solution here? https://github.com/facebook/fresco/issues/410

Thanks
 The suggested solution for this type of issue is to use https://github.com/facebook/SoLoader  The crash was caused by Fresco not being able to load `libmemchunk.so` native library with is essential, without it Fresco can't do anything.

What is the affected android device ? Also, you mentioned disk cleaning tool - is there a chance that it could remove libs used by Fresco ?
 å´©æºƒçš„é—®é¢˜æ‰¾åˆ°äº†æ˜¯å› ä¸ºgradle debug  version ç›¸å…³åŽŸå›  ä½†æ˜¯ å…³äºŽå›¾ç‰‡ç¼“å­˜çš„ å¯èƒ½æ˜¯æŸäº›æ¸…ç†å·¥å…·æ¸…ç†ç£ç›˜ æ¸…ç†çš„ä¸å®Œæ•´ï¼Œå¯¼è‡´åŠ è½½å›¾ç‰‡å‡ºçŽ°äº†ä¸€äº›é—®é¢˜ã€‚
The collapse of the problem found is that gradle debug version related reasons but about the image cache may be some cleaning tool to clean up the disk cleanup is not complete, there are some problems lead to load the picture.
 å´©æºƒçš„é—®é¢˜æ‰¾åˆ°äº†æ˜¯å› ä¸ºgradle debug  version ç›¸å…³åŽŸå›  ä½†æ˜¯ å…³äºŽå›¾ç‰‡ç¼“å­˜çš„ å¯èƒ½æ˜¯æŸäº›æ¸…ç†å·¥å…·æ¸…ç†ç£ç›˜ æ¸…ç†çš„ä¸å®Œæ•´ï¼Œå¯¼è‡´åŠ è½½å›¾ç‰‡å‡ºçŽ°äº†ä¸€äº›é—®é¢˜ã€‚
The collapse of the problem found is that gradle debug version related reasons but about the image cache may be some cleaning tool to clean up the disk cleanup is not complete, there are some problems lead to load the picture.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 @facebook-github-bot import
 Hi - we appreciate this contribution, but would feel a lot safer accepting it if there was a unit test :)
 I'm going to import this in the spirit of cleaning up and will add a test.  Thanks @eldk.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thank you for the pull-request. However, this is something we deliberately decided not to do. Read [here](http://frescolib.org/docs/wrap-content.html#_) why. We will reconsider this decision, and if we decide to support `wrap_content`, this would have to be done on the `DraweeView` level for flexibility reasons. There are many custom views that extend `DraweeView` directly (instead of `SimpleDraweeView`) and we would need to support this for these other views too.
  Could you please explain what you mean by "link will disappear" ? Is this issue about part of the image being rendered outside of the border ? 
 I don't really understand the issue. The screenshot looks correct to me. If this tiny gray circle around the border is what bothers you, just add `fresco:roundingBorderPadding="1dp"`.
If you specify border width to be 0dp, border won't be drawn at all, and this is expected too.
 As explained by @plamenko, you should either set no border or add border padding.
If there is a different bug, please post a screenshot that highlights the issue and we can re-open this. Closing for now.  Please have a look here for an explanation why `wrap_content` is not supported: http://frescolib.org/docs/wrap-content.html
  you can use CloseableReference.of()
  This sounds like a bug somewhere in Android. Can you share the code how you use two views together.
 We'll investigate
 Looks like fixing the scheme should resolve the problem, thanks @joeywp   We don't support ico image format. However you can do a transcode into jpeg, save it as a local file and load the url from there.
  Can you show how you try to use bitmap?
 I guess you are using Fresco to get the Bitmap directly. If you do so, you should not manually call `bitmap.close()`. If you use a `CloseableReference<Bitmap>` or `CloseableReference<CloseableImage>`, make sure to hold on to the reference until you are done and then close the reference.
If you do not hold on to it, the finalizer of the reference will close the bitmap for you in order to avoid memory leaks.
  you'll need override public void onLowMemory() { Fresco.getImagePipeline().clearCaches(); }. Register MemoryTrimmableRegistry for handling memory for activity. You also need to check if you have a memory leak issue in your app.
  please continue the thread in #410
  What device and os are you using? This should be a device specific issue. You may also want to try using other Fresco version.
 Are you using armv8 (64bit) device by any chance ? Is jpush173 compiled for armv8 or armv7 ? Can you list content of lib directory in your apk ?
 merge into #410 
  I feel this is weird because setProgressiveRenderingEnabled is default to false. And I don't see any issues when digging into source code. Can you debug yourself and see the value? 
 this is my code, 

``` java
public class FrescoView<DH extends DraweeHierarchy> extends View {
    private GenericDraweeHierarchy mHierarchy;
    private DraweeHolder<DH> mDraweeHolder;
    private boolean mInitialised = false;
    private int mDrawableWidth;
    private int mDrawableHeight;
    private Drawable mDrawable;
    private Matrix mDrawMatrix = null;
    private ImageView.ScaleType mScaleType;
    private Matrix mMatrix;
    private RectF mTempSrc = new RectF();
    private RectF mTempDst = new RectF();
    private boolean mIsDownload = false;
    private IFDrawableCallback mDrawableCallback;
    private Context mContext;

    public static void initQView(Context context, boolean isLowMemoryDevice) {
        FrescoImagePipeline.initialize(context, isLowMemoryDevice);
    }

    public FrescoView(Context context) {
        super(context);
        init(context);
    }


    public FrescoView(Context context, AttributeSet attrs) {
        super(context, attrs);
        init(context);
    }

    public FrescoView(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        init(context);
    }

    @TargetApi(Build.VERSION_CODES.LOLLIPOP)
    public FrescoView(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
        init(context);
    }

    private void init(Context context) {
        if (!mInitialised) {
            mHierarchy = new GenericDraweeHierarchyBuilder(getResources()).build();
            mDraweeHolder = (DraweeHolder<DH>) DraweeHolder.create(mHierarchy, context);
            mInitialised = true;
            mContext = context;
        }
        mIsDownload = false;
    }


    public DH getHierarchy() {
        return mDraweeHolder.getHierarchy();
    }

    @Override
    public void onStartTemporaryDetach() {
        super.onStartTemporaryDetach();
        mDraweeHolder.onDetach();
    }

    @Override
    public void onFinishTemporaryDetach() {
        super.onFinishTemporaryDetach();
        mDraweeHolder.onAttach();
    }

    @Override
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();
        mDraweeHolder.onAttach();
    }

    @Override
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
        mDraweeHolder.onDetach();
    }

    @SuppressLint("ClickableViewAccessibility")
    @Override
    public boolean onTouchEvent(MotionEvent event) {
        return mDraweeHolder.onTouchEvent(event) || super.onTouchEvent(event);
    }

    @Override
    protected boolean verifyDrawable(Drawable who) {
        super.verifyDrawable(who);
        if (who == mDraweeHolder.getTopLevelDrawable()) {
            return true;
        }
        return false;
    }

    public void setDrawableCallback(IFDrawableCallback callback) {
        mDrawableCallback = callback;
        mIsDownload = false;
    }

    public void releaseDrawableCallback() {
        mDrawableCallback = null;
        mIsDownload = false;
    }

    public void setImageRequest(FImageRequest fImageRequest) {
        FLog.data("isDownload=" + mIsDownload);
        if (fImageRequest != null) {
            int id = fImageRequest.getPlaceHolderResourceId();
            if (id != 0) {
                mHierarchy.setPlaceholderImage(id);
            }
            RoundingParams rp = fImageRequest.buildRoundingParams();
            ImageRequest request = fImageRequest.buildImageRequest();
            FLog.data("ProgressiveRenderingEnabled="+request.getProgressiveRenderingEnabled()); // this echo false;
            mHierarchy.setRoundingParams(rp);
            DraweeController controller = Fresco.newDraweeControllerBuilder()
                    .setImageRequest(request).setOldController(mDraweeHolder.getController())
                    .setControllerListener(new ControllerListener<ImageInfo>() {
                        @Override
                        public void onSubmit(String id, Object callerContext) {
                            FLog.data("onSubmit id=" + id);
                        }

                        @Override
                        public void onFinalImageSet(String id, ImageInfo imageInfo, Animatable animatable) {
                            FLog.data("onFinalImageSet id=" + id);
                            Drawable drawable = mDraweeHolder.getHierarchy().getTopLevelDrawable();

                            final int oldWidth = mDrawableWidth;
                            final int oldHeight = mDrawableHeight;
                            mDrawable = drawable;
                            updateDrawable(mDrawable);

                            if (oldWidth != mDrawableWidth || oldHeight != mDrawableHeight) {
                                requestLayout();
                            }
                            FHttpExecutor.getHttpExecutor().execute(new Runnable() {
                                @Override
                                public void run() {
                                    if (!mIsDownload && mDrawableCallback != null) {
                                        mDrawableCallback.onSuccess(mDrawable);
                                    }
                                }
                            });
                            mIsDownload = true;
                        }

                        @Override
                        public void onIntermediateImageSet(String id, ImageInfo imageInfo) {
                        }

                        @Override
                        public void onIntermediateImageFailed(String id, Throwable throwable) {
                        }

                        @Override
                        public void onFailure(String id, Throwable throwable) {
                            FLog.data("onFailure id=" + id);
                            FHttpExecutor.getHttpExecutor().execute(new Runnable() {
                                @Override
                                public void run() {
                                    if (mDrawableCallback != null) {
                                        mDrawableCallback.onFailed();
                                    }
                                }
                            });
                        }

                        @Override
                        public void onRelease(String id) {
                            FLog.data("onRelease id=" + id);
                            FHttpExecutor.getHttpExecutor().execute(new Runnable() {
                                @Override
                                public void run() {
                                    if (mDrawableCallback != null) {
                                        mDrawableCallback.onRelease();
                                    }
                                }
                            });
                        }
                    })
                    .build();
            mDraweeHolder.setController(controller);
        }
    }

    @SuppressLint("NewApi")
    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        /*
        Drawable drawable = mDraweeHolder.getHierarchy().getTopLevelDrawable();

        final int oldWidth = mDrawableWidth;
        final int oldHeight = mDrawableHeight;
        mDrawable = drawable;
        updateDrawable(mDrawable);

        if (oldWidth != mDrawableWidth || oldHeight != mDrawableHeight) {
            requestLayout();
        }

        if (mDrawable != null && !mIsDownload && mDrawableCallbacks.size() > 0) {
            for (IFDrawableCallback callback : mDrawableCallbacks) {
                callback.onSuccess(mDrawable);
                mIsDownload = true;
            }
        }*/
        //mDrawable.draw(canvas);
    }

    public Drawable getDrawable() {
        return mDrawable;
    }

    private void updateDrawable(Drawable d) {
        if (d != null) {
            d.setCallback(this);
            if (d.isStateful()) {
                d.setState(getDrawableState());
            }
            d.setVisible(getVisibility() == VISIBLE, true);
            mDrawableWidth = d.getIntrinsicWidth();
            mDrawableHeight = d.getIntrinsicHeight();
            configureBounds();
        } else {
            mDrawableWidth = mDrawableHeight = -1;
        }
    }

    private void configureBounds() {
        if (mDrawable == null) {
            return;
        }

        int dwidth = mDrawableWidth;
        int dheight = mDrawableHeight;
        int vwidth = getWidth() - getPaddingLeft() - getPaddingRight();
        int vheight = getHeight() - getPaddingTop() - getPaddingBottom();

        boolean fits = (dwidth < 0 || vwidth == dwidth) &&
                (dheight < 0 || vheight == dheight);

        if (dwidth <= 0 || dheight <= 0 || ImageView.ScaleType.FIT_XY == mScaleType) {
            mDrawable.setBounds(0, 0, vwidth, vheight);
            mDrawMatrix = null;
        } else {
            mDrawable.setBounds(0, 0, dwidth, dheight);
            if (ImageView.ScaleType.MATRIX == mScaleType) {
                if (mMatrix.isIdentity()) {
                    mDrawMatrix = null;
                } else {
                    mDrawMatrix = mMatrix;
                }
            } else if (fits) {
                mDrawMatrix = null;
            } else if (ImageView.ScaleType.CENTER == mScaleType) {
                mDrawMatrix = mMatrix;
                mDrawMatrix.setTranslate((int) ((vwidth - dwidth) * 0.5f + 0.5f),
                        (int) ((vheight - dheight) * 0.5f + 0.5f));
            } else if (ImageView.ScaleType.CENTER_CROP == mScaleType) {
                mDrawMatrix = mMatrix;
                float scale;
                float dx = 0, dy = 0;

                if (dwidth * vheight > vwidth * dheight) {
                    scale = (float) vheight / (float) dheight;
                    dx = (vwidth - dwidth * scale) * 0.5f;
                } else {
                    scale = (float) vwidth / (float) dwidth;
                    dy = (vheight - dheight * scale) * 0.5f;
                }

                mDrawMatrix.setScale(scale, scale);
                mDrawMatrix.postTranslate((int) (dx + 0.5f), (int) (dy + 0.5f));
            } else if (ImageView.ScaleType.CENTER_INSIDE == mScaleType) {
                mDrawMatrix = mMatrix;
                float scale;
                float dx;
                float dy;

                if (dwidth <= vwidth && dheight <= vheight) {
                    scale = 1.0f;
                } else {
                    scale = Math.min((float) vwidth / (float) dwidth,
                            (float) vheight / (float) dheight);
                }

                dx = (int) ((vwidth - dwidth * scale) * 0.5f + 0.5f);
                dy = (int) ((vheight - dheight * scale) * 0.5f + 0.5f);

                mDrawMatrix.setScale(scale, scale);
                mDrawMatrix.postTranslate(dx, dy);
            } else {
                mTempSrc.set(0, 0, dwidth, dheight);
                mTempDst.set(0, 0, vwidth, vheight);
                mDrawMatrix = mMatrix;
                mDrawMatrix.setRectToRect(mTempSrc, mTempDst, scaleTypeToScaleToFit(mScaleType));
            }
        }
    }

    private static final Matrix.ScaleToFit[] sS2FArray = {
            Matrix.ScaleToFit.FILL,
            Matrix.ScaleToFit.START,
            Matrix.ScaleToFit.CENTER,
            Matrix.ScaleToFit.END
    };

    private static Matrix.ScaleToFit scaleTypeToScaleToFit(ImageView.ScaleType st) {
        return sS2FArray[st.ordinal() - 1];
    }
}
```
 I have found the solution of the problem. Because I rebuild the NetworkFetcher and return true in shouldPropagate(FETCH_STATE fetchState);
 Sorry, I found the solution does not work.
 DecodeProducer .class code is below

```
@Override
  public void produceResults(
      final Consumer<CloseableReference<CloseableImage>> consumer,
      final ProducerContext producerContext) {
    final ImageRequest imageRequest = producerContext.getImageRequest();
    ProgressiveDecoder progressiveDecoder;
    if (!UriUtil.isNetworkUri(imageRequest.getSourceUri())) {
      progressiveDecoder = new LocalImagesProgressiveDecoder(consumer, producerContext);
    } else {
      ProgressiveJpegParser jpegParser = new ProgressiveJpegParser(mByteArrayPool);
      progressiveDecoder = new NetworkImagesProgressiveDecoder(
          consumer,
          producerContext,
          jpegParser,
          mProgressiveJpegConfig);
    }
    mInputProducer.produceResults(progressiveDecoder, producerContext);
  }
```

Are you sure that there judges whether isProgressiveRenderingEnabled from ImageRequest?
  Well, from 5.0, Android don't have ashmem. So we won't be able to use ashmem as well. You can try to see if you have memory leak or do a resize option for your jpeg image to help oom happening.
  Can you tell which version of the fresco library are you using? The behavior you're describing is the default one. I need to know your version of use to suggest how you can overwrite the controller or the view to achieve you goal.
 In ZDV, you can see 

``` java
  @Override
  public boolean onTouchEvent(MotionEvent event) {
    if (mZoomableController.onTouchEvent(event)) {
      if (mZoomableController.getScaleFactor() > 1.0f) {
        getParent().requestDisallowInterceptTouchEvent(true);
      }
      FLog.v(TAG, "onTouchEvent: view %x, handled by zoomable controller", this.hashCode());
      return true;
    }
    FLog.v(TAG, "onTouchEvent: view %x, handled by the super", this.hashCode());
    return super.onTouchEvent(event);
  }
```

which disallow you to scroll to the previous or next page if zoom happened.
So to achieve your goal, you'll need to subclass ZDV and override the onTouchEvent.
 I actually don't understand what do you mean by "enable scroll only when image border reached". I suppose if you wanna enable scroll in limited occasions, you need to implement under onTouchEvent, and disallow scrolling by using getParent().requestDisallowInterceptTouchEvent(true); when in the occasions you define.
 Yeah, I understand what you mean. This is on our TODO list, but it is not the top-priority thing we have on our plate at the moment and therefore we can not promise when will this be implemented.
 I actually found some time and sent a pull request. ZoomableDraweeView should work just fine in ViewPager.
 This should have been fixed already, take a look at the sample app here: https://github.com/facebook/fresco/tree/master/samples/zoomableapp
There's even a toggle now to select what behaviour you want: swipe to next image when zoomed or stay at current image.  Can you provide more details how you use the SDV. What url of image are you using? It's quite obvious the request of image is not successful so you won't see the image there. But need to understand why.
 I don't see issue you use SDV. Do you have a valid file path? You can debug and see what returns from Uri.fromFile(new File(mPath)).
 What is the format of the image ? Is it one of the formats recognized by BitmapFactory ? http://developer.android.com/guide/appendix/media-formats.html
 Are you able to decode that particular image with BitmapFactory ?
 Can you upload the image itself here so we can take a look?
 I assume the problem has been resolved. If not, please let us know.  @eldk updated the pull request.
 @eldk updated the pull request.
 Hi! Thanks for the pull request and apologies for the delay. We will review this today.
 It looks like you still need to incorporated @plamenko's suggestions.
 @facebook-github-bot import
 @eldk updated the pull request.
 Looks good, there are just a couple of nits related to coding conventions we employ in Fresco. 
 @facebook-github-bot import
 Ok, I will have a look.
 @eldk updated the pull request.
 @facebook-github-bot import
 Hi @eldk, thanks a lot for the diff. I'm currently testing and merging your PR.

One quick question: Is there a particular reason for having `isExternal` in `FileCache`? Seems to me that we can just have it in `DiskStorage`. There might be FileCaches where this method cannot provide a valuable answer: For example, if the cache is on both internal and external storage.

If you are fine with the change, I'd go ahead and remove `isExternal` from the `FileCache` interface. That should not change the benefit from this PR
 Hello,

> If you are fine with the change, I'd go ahead and remove isExternal from the FileCache interface. 

It's OK.
Thanks,
Eric
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks!
  I don't understand what you mean? Is that a question or a feature you want fresco library to have?
 It would be great if you want to contribute and have a pull request after.
 Instead of `placeholderImage`, just set the `backgroundImage` to black.
  Please see the docs: http://frescolib.org/docs/intro-image-pipeline.html#_
  There's little use request for SVG so far. You may be the only one asking for this.
 We currently have no plan in support SVG at the moment. We would appreciate if someone in community wants to contribute it.
 You can use vector drawables from the support library. See #1176 for more information
 We're looking into adding custom decoders for Fresco so that you can add an SVG decoder if needed.
 You can now add custom SVG decoders and drawable factories now. A very simple example how this could look like can be found here: https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/svg   You need to use `app:placeholderImageScaleType="centerCrop"` instead of `app:actualImageScaleType="centerCrop"`
 try setting the scale type programmatically too at the same time that you set the image? 
 You're calling the wrong method - should be placeholder, not actual image
  So you're not seeing your placeholder at all? Sounds like it's not resolving to the resource correctly, are you setting something valid? 

For example, if you do `hierarchy.setPlaceholderImage(new ColorDrawable(Color.BLUE)`, does that show up correctly? If it does, then it's definitely a problem with your resource. 
  Please can you give more details, otherwise there is no way that we are able to help you.
  Please see the docs: http://frescolib.org/docs/proguard.html#_
  Can you use drawee for hosting the animated image? If you .setAutoPlayAnimations(false), it will only take the first frame as preview image.
  Yes, please see the docs: http://frescolib.org/docs/requesting-multiple-images.html#_
 You can just create image requests for each one, how about that? http://frescolib.org/docs/using-image-pipeline.html#_
  Does the image ever load? Is there just a delay or does it stay black? Also, if you scroll up and down does the image become visible? 
 From your logs, it looks like the only errors are coming from `ChatterAndTweetsAdapter` - could that be relevant? 

Perhaps your cache is getting full? Are you holding onto a lot of images in other tabs that are not on the screen? Can you try increasing the size of the cache? 
 I wonder if all the drawee views get notification of being reattached. It might be worth looking at part of the logcat that correspond to "going back" to the affected tab. Could you please do this to get us more debugging data:
1. open any tab in your app and wait for all the images to show up
2. go to another tab and wait for all the images to show up
3. clear logcat (`adb logcat -c`)
4. start recording logcat
5. go back to the first tab
6. check that some images do not show up
7. make a screenshot

Having such screenshot and logcat output should allow us to check how many drawee views  were reattached, how many of them submitted image requests, how many of the request completed and how many images become visible after that.
 I am seeing `controller 44198828 3: ignore_old_datasource @ onFailure: failure: java.lang.NullPointerException` in logs. Let me take a closer look.
 Even if we are not getting `onAttach` event, as a fail-safe mechanism, we do reattach in `onDraw`. So I suspect something is clearing uri/controller or failure in the pipeline.
 So I took a look at the log data in Excel and I can't see the issue. The problem is that the data looks pretty much normal. It would definitely help if you follow steps @michalgr suggested. That way we will have more interesting log, as the current one contains tons of valid data and is hard to spot anomalies.
[issue1000.xlsx](https://github.com/facebook/fresco/files/166297/issue1000.xlsx)
![screen shot 2016-03-09 at 23 44 48](https://cloud.githubusercontent.com/assets/3705123/13654642/6419f2d4-e651-11e5-8a98-6907ccdf001a.png)
 Let me quickly explain the Excel data I made. I kept only lines containing "AbstractDraweeController". I sorted them by controller hash and then by time. Then on the right side I marked events of interest (initialize, set hierarchy, attach, submit, set_final, detach, release). You can observe that sequence of events look normal for each controller (at least for the first few I checked). The events of interest happen in correct order and with expected times between them.
The two lines I marked in red are suspicious because onDetach happened very quickly after the image has been shown. This can be expected if you changed tab just after the image loaded, but there is no way for me to tell if that was the case. If you could log each time you change tabs that would be super useful too.
 Are you still experiencing this?
 Hi @9h0st, do you have a (minimal) example that reproduces the issue? If this happening only on Nougat, we would want to follow up on this (ideally in a new issue).

Thanks a lot, Daniel
 Closing due to lack of updates or further reports since 2016  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Hi! Thank you for your pull request. However, I do have a working double-tap to zoom in/out code and no changes are necessary to the gesture detectors. I will push the code to the github soon.
  Can you explain your hierarchy a bit more clearly please. In particular, which layer are you using the drawable you mentioned above for? I'm not clear what you mean by "shape layer"? 

If you could explain what you see, and what is in your hierarchy at each stage, that would be great. 
 Sounds like a bug I would guess, though can't see how it would be happening. 
 Closing due to lack of updates and no further reported instances of this issue.  Are you sure this is caused by Fresco? Can you give more details? 
  Looks like a duplicate. 
  You have to be careful with memory on Lollipop, as it is allocated on the java heap. Please see: http://frescolib.org/docs/troubleshooting.html#ooms-and-failing-to-allocate-a-bitmap
  Looks like this is happening in Android itself, can you dig into the code to see why that's happening please? 
  can you share the code that you're using? or some logs to show what's happening? http://frescolib.org/docs/troubleshooting.html#setting-up-logcat
 Given it works the first time you try, why do you think it's a problem with Fresco? Are you not resetting things properly or something like that? Are you able to try and get a bit closer to knowing what the issue is? 
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 That's great, thanks for letting us know! Please let us know if you have any issues with it :) 
  You just need to set a white placeholder. It will fade in from whatever the placeholder is. 
  Looks like a problem with your NDK. Can you make sure that you have everything set up correctly? 
  Are you correctly reloading the image? Check the logcat (http://frescolib.org/docs/troubleshooting.html#setting-up-logcat) to see whether the image is being reloaded when it's required? 
 No problem. 
  Hi @wstczlt,
this is true. This is because the libwebp are still used by animated-webp. We're making the animated-webp and animated-gif also optional and so the libwebp will disappear from the main aar. Stay tuned!

Thanks
  You cannot use minSdkVersion=8 with Fresco. You must use minSdkVersion=9 or higher.

Please ask questions like this in  [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco) in future.
  Please ask questions like this on [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco).
  Please ask questions like this on [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco).
  SDV doesn't itself do this, but you should be able to maintain a Map in your app to achieve the same effect.

To remove a URI, simply call 

 `sdv.setController(null);`
  If your images are being shown in a `ListView`, `GridView`, or `RecyclerView`, this is handled automatically.

Do not use a `ScrollView`.

If you are using a `ViewPager` or other similar class, you should call [View.onStartTemporaryDetach](http://developer.android.com/intl/zh-tw/reference/android/view/View.html#onStartTemporaryDetach%28%29) when your child views go off-screen.

Please post in [Stack Overflow](http://stackoverflow.com/questions/ask?tags=fresco) if you need more help.
  Hi @budnyjj, 
as in the previous issue, thanks for the interesting note. We'll be happy to receive your pull request in order to fix this. 
Thanks
 Closing due to lack of updates or further reports of the issue  Hi @budnyjj, 
thanks for the interesting note. We're executing our test using RobolectricTestRunner. If you want to provide an optimized way we'll be happy to receive your pull request.
Thanks
 Closing since this issue is not prioritized to be implemented in the foreseeable future.
If this is a feature that you need, please consider contributing a pull request to Fresco!  We'll investigate more but you could also initialize Fresco on an ApplicationContext.

Thanks
 Can you provide the code snippet that initializes Fresco? In what class exactly are you calling `Fresco.initialize` ?
 Hi @votagus 
we're now explicitly calling Context.getApplicationContext() [here](https://github.com/facebook/fresco/blob/c83333404edfd9e7d87183e4bedafbd6f34a99c6/drawee-backends/drawee-pipeline/src/main/java/com/facebook/drawee/backends/pipeline/Fresco.java#L63).

This should be ok now.
Thanks
  Thank you for the detailed description. We're already working on that.

Thanks
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant and shouldn't suffer from memory leaks. Let us know if you're still experiencing problems with 1.4.0.  This feature is not supported and I don't think we'll support in the feature.
  Use of isInEditMode() is not supported yet.

Thanks
 Hi @ivanviragine, can you provide us some log you should have when the preview fails, please? Anyway, as said before, the preview is not supported yet. 
Thanks
 @ivanviragine We don't have plan at the moment but it would be a good task for a pull request. Feel free to implement it and submit the pull request we'd be happy to review. 
Thanks
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Can you please tells us the URL of the image you're trying to download? What kind of imagerequest are you making? Can you provide us more context please?
Thanks
 Does your server have different screen sizes available? You should try to avoid downloading a 1920x1080 image on smaller devices. 

Even if that is the only size your server offers, I would recommend skipping the `setResizeOptions`. As [explained in the docs](http://frescolib.org/docs/resizing-rotating.html#_), this is less efficient than simply letting the hardware scale the image.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 So far we have used Play Store links for apps and site links for libraries. Unless there's a compelling reason not to, we'd rather keep it this way.
 To save time we added it directly.
  Can you see any error log? Can you provide us some specific case please?
Thankx
 Are you setting the failure image programmatically or via XML?
  Yes. Please follow that guide.
  What kind of problems? Can you please give us more context please?
 @imyetse Have you tired the solution here? https://github.com/facebook/fresco/issues/410

Thanks
 Closing due to lack of response from reporter.  @sagartrehan updated the pull request.
 Thank you!
 Btw, the reason we use for loop instead of for-each loop is because for-each automatically creates a new iterator and this allocation may cause GC to happen which is something we don't want.
 @facebook-github-bot import
  Because it's not required for Fresco. We use SHA1 to generate a unique filename when disk-caching a particular image. The worst thing that can happen should a collision occur is Fresco displaying another image that happened both to already be in your disk cache and simultaneously have the same SHA1 hash. Chances of this happening are astronomically low, and even if it happens the impact would be negligible.
  We've released a couple of new versions since then. Please let us know if the problem still exists.  Thank you for your interest. Let us see if there is something that would be suitable and we'll respond here.
 Hey @rahulrj, I'm very happy that you want to contribute to Fresco!

Here are a few things that are popular feature requests and would be a good match:
#480 , #807, #655, #941, #480, #868, #921

Starting with something simpler would be an easier way to get familiar with the codebase.

Let us know if you need any help with any of these.
 Closing this issue, but please get in touch with us if you need help.
  May I see the code in your datasource callback?

Btw, Instead of doing for-loop and `setPixel/getPixel`, it is much more efficient (and the scaling quality will be much better) if you just do something like this:

```
Canvas canvas = new Canvas(destBitmap);
Rect destRect = new Rect(0,0,destBitmap.width(), destBitmap.height());
canvas.drawBitmap(sourceBitmap, null, destRect, paint);
```
 I think you need to set `ResizeOptions` in order for image to get rotated. Can you try that? Anyhow, this looks like a bug and we need to fix it.
 I've just completed a series of changes to be included in the next Fresco release.

This adds a `RotationOptions` class which can be specified when building an image request. As well as having a new API, several fixes have been made with respect to rotation when downscaling is enabled, when a postprocessor is attached and other cases we were aware of.

The default behaviour will now be to fix the rotation in the pipeline so that by the time a post-processor is triggered, the image is fixed.
 The initial commit for these changes is 36dd783deed7299ecf16b37a2d56cc66d07fb637.
  Yeah, [GifFormatChecker.isAnimated](https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/imagepipeline-base/src/main/java/com/facebook/imageformat/GifFormatChecker.java#L47).

It accepts an input stream instead of just Uri though.
  Hmm, looks like a build issue.

01-27 14:51:01.061 26981-27422/xxx W/dalvikvm: VFY: unable to resolve virtual method 626: Landroid/graphics/Bitmap;.getAllocationByteCount ()
 Merging with #1862   Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  Duplicate #945 
  Please follow the [Troubleshooting](http://frescolib.org/docs/troubleshooting.html#_) steps and provide the logcat output that will show where the issue is. 
  Thanks!
  I don't understand the issue. Is your app throwing an exception in the runtime? If so, can you provide the stack trace?
 @my519820363 Could you please provide us the error log? I tried to create a project with Android Studio 2.0beta7, Android plugin 1.5 putting fresco dependency into the gradle file for the library and everything is fine. If you provide us the error log we can try to reproduce it.
Thanks
  Yes, this is a known limitation. Animated images would be too big to have all frames decoded in memory at once so they don't get cached in the same way as static images. They are decoded on demand, and only a couple of frames (those about to be displayed) get cached.
As explained in the [documentation](http://frescolib.org/docs/resizing-rotating.html#_), resizing at the moment only works for JPEG images.
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant, especially in the case where you display multiple GIFs. Let us know if you're still experiencing problems with 1.4.0.  You need to set the  [ResizeOptions](http://frescolib.org/docs/resizing-rotating.html#_).
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thank you!
  ZoomableDraweeView is really just an example implementation. It is not intended to be used as is.

The problem you have happens because the sample implementation of ZoomableDraweeView just forwards all of the touch events to the DefaultZoomableController which always handles them. In order to workaround this, you have to implement some additional logic in ZoomableDraweeView.onTouchEvent and/or ZoomableController.

Anyhow, for this kind of questions please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.
  Duplicate #410 
  The 0.9.0 version is available on Maven Central, check [here](http://search.maven.org/#artifactdetails%7Ccom.facebook.fresco%7Cfresco%7C0.9.0%7Caar).

How does your gradle file look and what is the exact compilation error you get?
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Hi! Thanks for your pull request and sorry for the delay. Seems good to go :)
  http://frescolib.org/docs/troubleshooting.html#_
  Is your app hitting the 65k method limit? Are you using Multidex?
 What version of Fresco?
 We'll investigate, thanks for reporting.
 Does this issue still occur with newer Fresco versions (e.g. 0.14.1)? I assume that the problem has been resolved. Please let us know if you're still experiencing this issue.
  Can you explain what is your problem exactly?
 I'm afraid I don't understand the issue.
 Please tell us what 'xxx' is.

Please also post your `build.gradle` file.
 Problem seems unrelated to fresco.  I doubt this is a Fresco bug. DraweeView just forwards the touch event to the parent class `View` which detects and calls `onClick`.
Just to isolate where the issue is, are you using Fresco's tap-to-retry functionality? If so that might be related. If not, then I suggest that you try to replace SimplaDraweeView with an ImageView (no need to set any image) and see if you get the same onClick behavior. If you do, that means this is due to Android's implementation, not Fresco.
  This looks like a baseline JPEG image that is not fully downloaded. That's weird because if the network request doesn't finish with all data being received, it should fail. This leaves a couple of options:
1. Server is misbehaving
2. Networking library is misbehaving
3. There is a bug in Fresco

Can you provide more information on what version of Fresco are you using, do you use a custom networking stack, where this image comes from (uri)?
  If you are referring to tap-to-retry functionality, this is not supported at the moment.
In order to support that, we need to add the `setMaxTapToRetryAttempts` setter to [RetryManager](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/drawee/src/main/java/com/facebook/drawee/components/RetryManager.java) and the corresponding option to the [AbstractDraweecontrollerBuilder](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/drawee/src/main/java/com/facebook/drawee/controller/AbstractDraweeControllerBuilder.java).
Feel free to send a pull request :)
 Closing since this issue is not prioritized to be implemented in the foreseeable future.
If this is a feature that you need, please consider contributing a pull request to Fresco!  Answered on StackOverflow
  Duplicate of #410
  Which version are you trying to build? @massimocarli any ideas?

Also we're trying to encourage moving these discussion to StackOverflow because we have a wider community that can help there. Ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.
 @syndycat What of you build from command line?
 I'm closing this issue due to inactivity. If this is still a problem, let us know!  same as #933 
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
 I assume that the problem has been resolved. Please let us know if you're still experiencing this issue.
  Duplicate of #933 
  Thx for reporting it, @massimocarli will have a look
 This will probably happen because you're using webp images and 0.9.0 made them optional. You shouldn't see an exception but adding the dependency to webp would probably solve your issue:
http://frescolib.org/docs/webp-support.html#_
 @wangmeng1989 We've just added the jars for eclipse here https://github.com/facebook/fresco/releases/tag/v0.9.0 . Please try to add the static-webp dependency and see if the problem has been fixed. Thanks
 @wangmeng1989 Can you please provide us more information in order to reproduce it? You mentioned you used the Android version 4.1.2. What does your code do? What format of image you're downloading? Are you fetching from the network? In case, can you provide us the URL of the image you're trying to download? Are you resizing the image? You mentioned you're using eclipse, right?
Thanks
 We're trying to reproduce the problem. In the meanwhile, as a temporal fix, could you try to put this into your main Activity or Application and see if it fixes?

```
static {
      try {
        SoLoaderShim.loadLibrary("webp");
      } catch(UnsatisfiedLinkError nle) {
      }
}
```

Thanks
 OK, so the problems seems to be present only for Android 4.1.2 right? We'll make some test with this version and with ResizeOptions. 
Is this present only on eclipse or also in Android Studio? Cannot replicate on AS
 Hi @Zhuinden,
is the ReLinker solving this issue?

Thanks
 Thanks @Zhuinden, we've recently open-sourced [SoLoader](https://github.com/facebook/SoLoader)  so replacing SoLoaderShim with it should fix the problem. Until we don't make a new release using a default Handler for it should fix.
Thanks
 merge into #410 
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thank you!
  Can you provide more info, a sample app or a vide and logs please?
 Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
  Can you provide the piece of XML that specifies SimpleDraweeView?
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
 Closing  Thx for reporting, it seems that 0.9.0 is broken for eclipse. We're working on a fix. cc @massimocarli 
 Hi @wangmeng1989, The eclipse zip files have been updated. All the jars are there now.
Thanks
  Fresco 0.9.0 is not on jCenter yet. We're working on the issue but you can use mavenCentral until that.
  Are you using `ControllerListeners`? If so, can you provide your code?
From the stack trace it seems that [ForwardingControllerListener.onFailure](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/drawee/src/main/java/com/facebook/drawee/controller/ForwardingControllerListener.java#L133) gets cleared while being iterated over. This method is synchronized meaning that this can only happen if one of the child controller listeners causes the issue. This may happen if for example you have a controller listener that onFailure attempts to set a new Uri to the DraweeView.
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
  Does your app have multiple dex files ? If yes, do you follow all steps listed here: https://developer.android.com/tools/building/multidex.html ?
  Hey, thanks for reporting this issue!

Fresco is getting really popular and truth is we're getting a bit overwhelmed by the activity surrounding it. There are just too many issues for us to manage properly.

If you don't know **how to do something** or **something is not working as you expect but not sure it's a bug**, please ask on [StackOverflow](http://stackoverflow.com/questions/ask?tags=fresco,android) with the tag fresco and android. We're answering questions on stackoverflow but there are a lot more people in the community who can help you.

We welcome clear issues and PRs that are ready for in-depth discussion. Please provide screenshots where appropriate and always mention the version of Fresco you're using. Thank you for your contributions!
 The next version of Fresco will include an improved animation implementation that should fix this issue.  We're currently not supporting this functionality but you can easily do this on top of Fresco.

I think it's a good idea so we're going to add it to our things to do/consider.
 This can easily be achieved on top of Fresco. Feel free to send a pull request!  You can configure ImagePipeline with your own CacheKeyFactory: http://frescolib.org/docs/configure-image-pipeline.html. Here is the default implementation: https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.java. The default one uses full url, your implementation can cut everything after '?'
  Hi @dotingcode, We're making some tests on Windows. In the meanwhile, could you please try to upgrade the gradle plugin from 
`classpath 'com.android.tools.build:gradle:1.3.0'`

to 

`classpath 'com.android.tools.build:gradle:1.5.0'`

and see if the problem persists. 
Thanks
 @dotingcode 
Are you including any library that includes `nineoldandroids`?
Could you try the same config with the Fresco sample apps?
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Hi @eldk. If you're building from the source you should just add this 

`compile project(':static-webp')`

to the dependencies of imagepipeline module or into your module. 
 @eldk , in that case just add this:

`'compile 'com.facebook.fresco:webpsupport:0.9.0+'`
 @eldk Please, just as a test, try to set 

.setWebpSupportEnabled(false)

or don't use that method at all. 

Thanks
 I've created a very simple app which  just load a webp images and without webpsupport library I get, as right, a NPE while when I define the webpsupport as dependency all works fine. I've tested with webp images and on GB. Can you provide us the URL of the image you're try to load please?
Thanks
  Could you help us debugging this by capturing debug logs ? Here is the description how to do this: http://frescolib.org/docs/troubleshooting.html#setting-up-logcat
 @kunny not at the moment. What is the desired limit you want to use ?
 Not sure to be honest. I'm a bit afraid exposing this. I'm afraid that a lot of people will not be familiar with the memory consequences and just change it to a very large limit.
 So according to @tyronen :
"We picked a default of 2048x2048.The thing is, many devices actually do support 4096x4096. But the only way to tell that is to use a nonstatic Canvas method. You need 1) a real, hw-accelerated Canvas, and 2) an API 14+ device.
At most we could expose a method that takes a Canvas argument and adjusts the limit, but the user must call it from within a draw method somewhere. Or we could hit it from the first Drawee to get drawn."

I wouldn't make the BitmapUtil.MAX_BITMAP_SIZE user-configurable, but option two could be doable: adjusting the size automatically on the first draw call.

To be fair, this would be very low on our priority list but we're always happy to see a pull request :) @kunny : would you like to create one?
 A change has been made to enable larger bitmap sizes if requested.

We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  If you want to display progress bar, you can follow this: http://frescolib.org/docs/progress-bars.html. If you want to do something else you probably need to use image pipeline directly and provide your own DataSubscriber. You can find out more here:
http://frescolib.org/docs/using-image-pipeline.html
http://frescolib.org/docs/datasources-datasubscribers.html
https://github.com/facebook/fresco/blob/df2854a76786f58e044a71617309cc3c0a0c358c/fbcore/src/main/java/com/facebook/datasource/BaseDataSubscriber.java#L70
  Some of our tests do not pass on windows. Try running target that does not require unit tests ?
 It is an unit test failure, you should be able to build the library. We are aware that some of our tests fail on Windows. This is not the case on other platforms.
 I'll actually keep it open, maybe one day someone fixes this.
 I believe all our tests now work on Windows.

We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  You can prefetch images like this: http://frescolib.org/docs/using-image-pipeline.html#prefetching
  I think there is an easy fix to that. As of API 21 Drawable got a new method: `void setHotspot (float x, float y)`. We just need to override this method in our `ForwardingDrawable` and `ArrayDrawable` and forward the call to the children.
We might want to make this feature optional though, because I am concerned by performance implications of passing each touchevent to the whole hierarchy of drawables. Anyhow, this should be easy to fix on Fresco side.
 @sagartrehan pull requests are always welcome :) If you would like to give it a shot, here are the two drawables that need to be modified: [ForwardingDrawable](https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/drawable/ForwardingDrawable.java) and [ArrayDrawable](https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/drawable/ArrayDrawable.java).

We just need to add something along these lines:

``` Java
  @Override
  @TargetApi(Build.VERSION_CODES.LOLLIPOP)
  public void setHotspot(float x, float y) {
    mCurrentDelegate.setHotspot(x, y);
  }
```
 Closing since this issue is not prioritized to be implemented in the foreseeable future.
If this is a feature that you need, please consider contributing a pull request to Fresco!  Could you show us all Fresco logs that are logged when views are first attached ? We should be able to reconstruct some of the events based on that and we'll see why some images got stuck. Please _do not_ scroll down / up to make all of the images appear.
 @ShawnDuan: In your logs I can see that 10 images were fetched (grep for `set_final_result`) and two were released after being fetched (look for `release:` in two last lines). Were you expecting 10 images to appear and 2 did not appear ? Or were you expecting just 8 images ?
  Fresco does not do anything fancy about placeholder images - whatever you specify, it will be obtained via `Resources.getDrawable` (https://github.com/facebook/fresco/blob/94ce1dee0733300fe2c029382e0c454169db81b8/drawee/src/main/java/com/facebook/drawee/view/GenericDraweeView.java#L246).

Could you check whether the memory grows because the thisone_placeholder image is that big or because multiples instances of bitmaps are created (one per drawable) ? You can check that in heapdump.
 Placeholders are meant to be small, quickly-loaded images. If you need to use a large image there, you should use a [low-res request](http://frescolib.org/docs/requesting-multiple-images.html#going-from-low-to-high-resolution) instead.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks for sending a pull request. Please see my comments. Also, it would be nice to have the equivalent logic for `FIT_X`.
 @yangkai3 updated the pull request.
 Looks good thanks!

Btw, just a notice that I am doing some refactoring in order to allow providing of a custom scale type without having to modify the Drawee code. We will import your pull request, but the code will likely be refactored once my change gets in. My refactor shouldn't affect the existing clients so no need to worry about that. I just wanted to let you know.
 Sorry for the delay! 
The way scale types work has changed and you can now specify custom scale types.
Unfortunately, your PR has merge conflicts because of this.

The scale types in ScalingUtils have to be updated to the new format where each scale type is a separate class.
For example, something like that should work:

``` java
private static class ScaleTypeFitX extends AbstractScaleType {

  public static final ScaleType INSTANCE = new ScaleTypeFitX();

  @Override
  public void getTransformImpl(
      Matrix outTransform,
      Rect parentRect,
      int childWidth,
      int childHeight,
      float focusX,
      float focusY,
      float scaleX,
      float scaleY) {
    float scale, dx, dy;
    scale = scaleX;
    dx = parentRect.left;
    dy = parentRect.top + (parentRect.height() - childHeight * scale) * 0.5f;
    outTransform.setScale(scale, scale);
    outTransform.postTranslate((int) (dx + 0.5f), (int) (dy + 0.5f));
  }
}
```

In addition, you need to also update `GenericDraweeHierarchyInflater` to support the new scale types from XML. Finally, it would be great to have tests for the new scale types similar to the ones we have for existing types.

It would be great if you could update your PR to the new format. If you'd like we could also implement a new version ourselves when we have some time.
 I'm going to close this PR as it's not been updated for a while and we now offer custom scale types. If you still want to update it, please do.
 I have added an example for custom scale types to our showcase sample app that adds fitX and fitY, see https://github.com/facebook/fresco/commit/92da47e95664414f0d442dbd2fbe88daaa563384  Can you make sure that all the options specified in the thumbnail request and the low res request are exactly the same ? Here is the list of things that needs to match in order for bitmap cache hit (bitmap cache hit = no flicker): https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/BitmapMemoryCacheKey.java#L39

Also, you do you use post-processors by any chance ?
 Looks like a bug, which version of Fresco are you using ?
 I made some [changes](https://github.com/facebook/fresco/commit/6abd727c90ef398cbc6c991d23a1171d7efbbdc9) to postprocessor caching a few weeks ago. This may have fixed the caching issue. Can you please check with the latest Fresco version?
 Glad to heart that!
  There is no API exposing exact file location at the moment, we do not commit to preserving original format of cached images (we may want to add headers for example or encrypt images if cached on external storage).

Would accessing encoded bytes be enough for your use-case ? If so, have a look here: http://frescolib.org/docs/using-image-pipeline.html#skipping-the-decode
  For now there is no such option, feel free to drop a diff adding a utility method though !
 I think we need a new method on SimpleDraweeView that accepts String argument and calls [setImageURI](https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/view/SimpleDraweeView.java#L96) with null or new Uri depending on whether the string was null or not.
  Try version 0.8.1, I think this is fixed by https://github.com/facebook/fresco/commit/b1f83c9d9d441da96b637a3c55e04348a12ee49e. When you load jpeg from disk Fresco will first check if the jpeg contains exif thumbnail. If the thumbnail is big enough it will be used instead. The diff I pointed to fixes the number that thumbnail's size is compared with if no expected dimensions are provided (was -1 previously :))
  If I understood correctly, you want fresco: xml attributes to apply to failure images, right ? At the moment this is not supported, but you can provide any drawable as fresco:failureImage, you should be able to add rounding based on that.
   Pool hard cap violation? Hard cap = 1048576 Used size = 1048576 Free size = 0 Request size = 16384
                                                                                  com.facebook.imagepipeline.memory.BasePool$PoolSizeViolationException: Pool hard cap violation? Hard cap = 1048576 Used size = 1048576 Free size = 0 Request size = 16384
                                                                                      at com.facebook.imagepipeline.memory.BasePool.get(BasePool.java:240)
                                                                                      at com.facebook.imagepipeline.memory.PooledByteStreams.copy(PooledByteStreams.java:52)
                                                                                      at com.facebook.imagepipeline.cache.BufferedDiskCache$6.write(BufferedDiskCache.java:333)
                                                                                      at com.facebook.cache.disk.DefaultDiskStorage.updateResource(DefaultDiskStorage.java:178)
                                                                                      at com.facebook.cache.disk.DiskStorageCache.insert(DiskStorageCache.java:289)
                                                                                      at com.facebook.imagepipeline.cache.BufferedDiskCache.writeToDiskCache(BufferedDiskCache.java:329)
                                                                                      at com.facebook.imagepipeline.cache.BufferedDiskCache.access$500(BufferedDiskCache.java:38)
                                                                                      at com.facebook.imagepipeline.cache.BufferedDiskCache$3.run(BufferedDiskCache.java:214)
                                                                                      at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1080)
                                                                                      at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:573)
                                                                                      at java.lang.Thread.run(Thread.java:856)
 Pool hard cap violation? Hard cap = 1048576 Used size = 1048576 Free size = 0 Request size = 16384 
@tyronen  how can i fix this issue? Thank you for any help! Best Wishesï¼
 Hi. Do you set up any custom configuration ?
 noï¼ŒMy config is very common ï¼Œ no any custom configuration ã€‚
I use OkHttps.
 @michalgr this happen random but very ofen.  I suppose you shoul check the code where the log print.
Hope this can fix in next version.
 Checking the place where the exception was throws won't help us that much. We need to understand why the pool is saturated, not where it was observed this particular time.

Do you know by any chance how many parallel requests are there going on in OkHttp ? If there are too many of them then response handlers will consume too many byte arrays from the pool. I'll suggest trying limiting number of parallel requests or increasing size of the pool. Anyway, you'll need a knowledge of what is going on in your app to decide which way to go.

Reducing number of parallel fetches might be done by configuring your OkHttpClient with appropriate Dispatcher (http://square.github.io/okhttp/3.x/okhttp/okhttp3/Dispatcher.html#Dispatcher-java.util.concurrent.ExecutorService-).

Increasing number of byte arrays in the pool is a bit more complex. When configuring pipeline provide configuration with custom pool factory (http://frescolib.org/docs/configure-image-pipeline.html). Creating PoolFactory that allows for more byte arrays in the pool would look like this:

``` java
    SparseIntArray defaultBuckets = new SparseIntArray();
    defaultBuckets.put(16 * ByteConstants.KB, NUMBER_OF_PARALLEL_NETWORK_FETCHES);
    PoolParams smallByteArrayPoolParams = PoolParams(
        16 * ByteConstants.KB * NUMBER_OF_PARALLEL_NETWORK_FETCHES,
        NUMBER_BIGGER_OR_EQUAL_TO_WHAT_IS_ABOVE,
        defaultBuckets);
    PoolFactory factory = new PoolFactory(
        PoolConfig.newBuilder()
              . setSmallByteArrayPoolParams(smallByteArrayPoolParams)
              .build());
```

Let us know how it goes.
 @michalgr thank you for your suggestion 
Best wishes~
 i will try soon and give feedback
 @michalgr You are right  Thank you very much
below code work fine wor me hope this will help others:
        MaxRequestPerTime = 64
        SparseIntArray defaultBuckets = new SparseIntArray();
        defaultBuckets.put(16 \* ByteConstants.KB, MaxRequestPerTime);
        PoolParams smallByteArrayPoolParams = new PoolParams(
                16 \* ByteConstants.KB \* MaxRequestPerTime,
                2 \* ByteConstants.MB,
                defaultBuckets);
        PoolFactory factory = new PoolFactory(
                PoolConfig.newBuilder()
                        . setSmallByteArrayPoolParams(smallByteArrayPoolParams)
                        .build());
        ImagePipelineConfig imagePipelineConfig = OkHttpImagePipelineConfigFactory.newBuilder(context,okHttpClient)
                .setMainDiskCacheConfig(diskCacheConfig)
                .setDownsampleEnabled(true)
                .setPoolFactory(factory)
                .build();
  Does this happen only on this particular phone ? Is there anything special about the image that cannot be opened ? What is the size/format of the images that can't be displayed ? Can you share them ? Also, does it always happen for the same images or random images cannot be displayed ?
  Can you post a full stack trace and maybe the code snippets showing what is going on in the post-processor callback ?
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 This looks empty? 
  We have build.gradle files for it in the repo. You can use that to include them in your app, as long as you are abiding by the sample license terms.
  Are you building with Gradle, or Eclipse? How is your build environment set up?
  See #410 
  Can you paste logcat output as described here: http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat
  Pull request #875 will fix this.
  See #512 
  Can you attach a dump of logcat? Follow these instructions: http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat
 You have to turn on verbose logging in your app.
 @Wood-Water-Peng 
is this problem fixed? It should be after a fix on PostProcessor. 
Thanks
 Cleaning up old issues. No additional information was provided.  By default, Fresco is served from Maven Central, not yet jCenter. Make sure your `build.gradle` file reflects this:

``` groovy
repositories {
  mavenCentral()
}
```
  What is the full stack trace. Usually there are "Caused by" headings that point to underlying errors.
 I'm going to close this since we've released newer versions of Fresco. If you still experience issues with for example v1.1.0, please let us know.  http://frescolib.org/docs/using-drawees-xml.html#fixing-the-aspect-ratio
  The most common reason for this is the images being in an unsupported format. What are the URls of these imags?
  [Do not nest SimpleDraweeView in ScrollViews.](http://frescolib.org/docs/gotchas.html#don-t-use-scrollviews)
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Hi, we'd be happy to merge this, however we need you to sign the CLA first. Please see the link above.
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  It looks like you are trying to build directly from source inside Android Studio? In which case you shouldn't use the Maven compile.

``` groovy
// don't use 
// compile 'com.facebook.fresco:0.7.0+'

// do this instead
compile project(':drawee-backends:drawee-pipeline')
```
  This can be resolved by the use of a `CacheKeyFactory` which strips your changeable query parameters.

We're cleaning up long-untouched issues so I'm closing this one.  Can you elaborate? What was the problem? And what version of Fresco are you using?
 I've just completed a series of changes to be included in the next Fresco release, 0.14.0.

This adds a `RotationOptions` class which can be specified when building an image request. As well as having a new API, several fixes have been made with respect to rotation when downscaling is enabled, when a postprocessor is attached and other cases we were aware of.

The default behaviour will now be to fix the rotation in the pipeline so that by the time a post-processor is triggered, the image is fixed.

The initial commit for these changes is 36dd783.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Hi Jesse. Thanks for the request! Two things--
1. We do need you to sign the CLA, and
2. This release is numbered as RC1. If it's only a release candidate, I'd prefer waiting until it has graduated from it.

I didn't see any release notes for 3.0 - is there a description anywhere of what's changed?
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 We've talked about it a bit here at Facebook. We totally understand that, with a new API, you wouldn't want libraries like ours blocking its adoption. And we'd like to see apps using our libraries to get the benefits of your upgrade sooner rather than later.

ReactNative uses both Fresco and OkHttp directly, and of course we have internal code using all three. A change of this scale takes a certain amount of effort, mostly in testing. We'd prefer to go through this exercise only once rather than twice to make absolutely sure we get it right. For that reason I'd still like to wait on this until it reaches the 3.0 milestone.

That doesn't mean we're halting on this - we've started to test 3.0.0-RC1 internally and will let you know if there are problems with it. But this particular PR will have to wait a bit, sorry.
 As @tyronen  mentioned the biggest work here to migrate all of our internal dependencies to OKHttp3.

The quickest and safest way to get this in would be to create a separate okhttp3 imagepipeline-backend.
So add a new directory fresco/imagepipeline-backends/imagepipeline-okhttp3 which will produce a new artifact: imagepipeline-okhttp3.aar

This has an added benefit that we're not introducing a breaking change, people can still use the new version of Fresco with the old OKHttp. (Although I guess for OKHttp's adoption point of view this is not a bonus :) )

The downside is that we're duplicating some code but we're talking about two small classes here.

What do you think?
 Yeah, that makes a lot of sense and it also makes people (and us ;) ) update faster.
 @swankjesse - any update on this?
Or alternatively @lzy26fate would you like to create the pull request?
 @swankjesse updated the pull request.
 @swankjesse updated the pull request.
 Hi Jessee,

We already imported your PR but until we do a new release it's not going to show up. We're currently working on better github integration - that's one of the main reason why there was no new release for a while.

As of today:
The source of truth is our internal repo and we do a manual sync from internal to github at every release (similar to AOSP). So your pull request is not going to be visible until we do a new release.

What we're working on:
We want the internal and github repos to be completely in sync. This means that once we accept your pull request it will automatically show up in github. There are a number of issues we need to solve to achieve this (external CI, sync script, warnings for leaking internal info, etc) but we're very close.

Hopefully we'll finish this shortly and also make a new version with OkHTTP3.
 @swankjesse updated the pull request.
  01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err: java.lang.IllegalStateException: Failed to slurp image 0
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.gif.GifImage.nativeCreateFromNativeMemory(Native Method)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.gif.GifImage.create(GifImage.java:64)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.animated.factory.AnimatedImageFactory.decodeGif(AnimatedImageFactory.java:67)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.decoder.ImageDecoder.decodeGif(ImageDecoder.java:113)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.decoder.ImageDecoder.decodeImage(ImageDecoder.java:88)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.DecodeProducer$ProgressiveDecoder.doDecode(DecodeProducer.java:188)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.DecodeProducer$ProgressiveDecoder.access$200(DecodeProducer.java:96)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.DecodeProducer$ProgressiveDecoder$1.run(DecodeProducer.java:128)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.JobScheduler.doJob(JobScheduler.java:207)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.JobScheduler.access$000(JobScheduler.java:27)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.producers.JobScheduler$1.run(JobScheduler.java:78)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at com.facebook.imagepipeline.core.PriorityThreadFactory$1.run(PriorityThreadFactory.java:43)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke W/System.err:     at java.lang.Thread.run(Thread.java:818)
01-02 11:29:08.851 22170-22170/com.qiuduanribao.joke E/**onFailure:: Failed to slurp image 0

gif url is http://ww4.sinaimg.cn/bmiddle/6d87e02fjw1ezjzc314x2g20ao0607uw.gif

hope this will be fix in next version

thank you very much for this great lib

Happy new year with my best wishes
 #167
  there's a way of doing so,
you need to have different params for different orientations(in xml or code)
vertical:

``` xml
<com.facebook.drawee.view.SimpleDraweeView
   android:id="@+id/card_item_image"
   android:layout_width="match_parent"
   android:layout_height="wrap_content"
   fresco:actualImageScaleType="centerCrop"
   fresco:viewAspectRatio="1"/>
```

horizontal:

``` xml
<com.facebook.drawee.view.SimpleDraweeView
   android:id="@+id/card_item_image"
   android:layout_width="wrap_content"
   android:layout_height="match_parent"
   fresco:actualImageScaleType="centerCrop"
   fresco:viewAspectRatio="1"/>
```

then you should be good
 Closing as there has been no updates since 2016 and this is no prioritized to be implemented.
If this is a feature that you need, please consider submitting a pull request. Thanks!  I assume you're using GenericDraweeView right? Fresco provides ActivityListener, which allows you to disconnect drawee from the destroyed activity.
 Can you try to debug and see if detachController in draweeholder is getting called when the activity gets destroyed?
 you should really use drawee, then you won't have the leak problem. do you subclass from ImageView.
  We currently don't have a plan for encoding webp since there's few needs.
 Hey @beartung 
Can you explain in more details why do you need encoding for displaying images?
 I don't understand where you need encoding webps.
As far as I can understand your webserver will send Fresco already encoded webp images (the jpeg -> webp encoding will happen on the server in the pagespeed_module), right?
On the client side we only need to decode the webp images to display them.

Am I missing something?
 Closing as fresco already supports decoding of webp images. There is at the moment no need to including the encoding support.  please do a resize for your image. you don't need a 1.96mb image.
  unfortunately fresco don't support ico at the moment.
 we don't have a plan to support ico as it's not commonly used. I believe you can transform it to jpg/png format.
 Fresco supports custom image decoders. You can just add a custom decoder and image format header checker (you don't need a DrawableFactory, just return a `CloseableStaticBitmap`) and then you're good to go.

If somebody wants to add one to the Showcase sample app for .ico, that would be great. Pull requests are welcome!

Simple color example: https://github.com/facebook/fresco/tree/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/color  I assume that the problem has been fixed with newer Fresco versions. Please let us know if you're still experiencing this issue.  alternatively, fresco has an indeterminate progress indicator already. U can use AutoRotateDrawable for ProgressBarDrawable.
  please do a resize for you jpg to see if it can solve your problem
 and how big each image is? how many of those are showing on a screen at the same time?
 Are they all JPEGs? If not, then you need to use downsampling. 
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  #340

fresco currently doesn't support custom headers.
  what's the size of each image? resizing may help.
 what i mean is how many bytes of each image. if it's greater than 4~500 kb, i would suggest to use resize
 See #213 
  Can you try resizing to something much smaller? 4096 is huge, and may mean that there isn't space for all of the images that you are trying to prefetch. 
 I wonder if some of the images are not being fetched because they are already in the memory cache. Could you please run with logcat http://frescolib.org/docs/troubleshooting.html#setting-up-logcat and see if that is the case (or just post the logcat here)? Thanks!
 This is good thanks. You can see what is happening from the trace. After you clear the cache, the disk cache is emptied but the memory cache is not. This particular image is found in the memory cache and is therefore not fetched from the network (and not put back into the disk cache). 

If you want to clear the memory cache too, then you need to kill the app from the settings menu. 
 Yep! Try that. 
  please do a resize for your image. you image is too big. You don't need a full 1.96MB image to load in.
  Let's track this in #912.
  There are some other issues raised about this. We're working on making all modules optional. 
  Hi @Abthul, we are relying on Android's `ThumbnailUtils` in our `LocalVideoThumbnailProducer`:

https://github.com/facebook/fresco/blob/84aeab6895f3177cee473e85656cf898112f263f/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/LocalVideoThumbnailProducer.java#L62
  If you want to use VectorDrawable then I think you're best just creating it yourself and then setting it to be the placeholder image, and do not set an actual image. 
 See also #1176
  Now added using Google CSE.
  Does it help if you tell proguard not to worry about `GuardedBy` ?

```
-dontwarn javax.annotation.concurrent.GuardedBy
```
 Closing as this warning seems to be harmless and should have no impact on the build itself.  Yes, this is related to https://github.com/facebook/fresco/issues/797 so please refer to that. 
  I suppose you're not handling the lifecycle of the underlying bitmap correctly. You have to keep the `CloseableReference` around until the image is not needed any more, see http://frescolib.org/docs/closeable-references.html  Author of the video didn't use Fresco as intended. Local camera photos are huge and the best practice is to resize them before displaying.
Please see the documentation: [resizing](http://frescolib.org/docs/resizing-rotating.html#_).
  Please refer to this documentation for rounding and let us know if the problem persists. 
http://frescolib.org/docs/rounded-corners-and-circles.html#_
  You can use a custom cache key factory. Override [CacheKeyFactory](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/cache/CacheKeyFactory.html) and use it to configure the image pipeline.
  @wangmeng1989 Is this fixed? Can you provide more information on the images you're trying to load please?
Thanks
  Can you provide logs or stacktraces? It is quite possible that if you are getting OOMs, they happen for completely unrelated reason. I don't think rounded corners has anything to do with this. Post-processing requires additional bitmap to be created and that's just the way it is. We added caching of post-processed images some time ago so that might help.
 Closing as no further information was provided  Hi,
please provide more context and code in order to understand the problem.
  Thanks @kunny for the detailed report of the bug. We're investigating on it. 
 have this being solved?
 This is not fixed yet. We can make ROUNDUP_FRACTION configurable (instead of using constant we can specify it in ResizeOptions with current value being the default one).
 Marking as a starter-task in case anyone wants to help to get this done sooner than later.
  Hi,
the 1.0 value is probably the result of a rounding and it's not the one to use as indicator of completion. For this reason we provided the `dataSource.isFinished()` method. Anyway we'll double check the reason of that asymptotic line.  
 Hi,
To provide us more information could you please follow this instructions and provide us the log of it?
http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat

Thanks
 Closing as it's been 2 years and no update from the submitter to the request for more information.  Hi,
can you provide more information please? Is it possible to get the URL of the animated webp/gif. What kind of rotation animation did you implement?
Thanks
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs. Please let us know if you're still experiencing this issue with the new version.  We're working on making webp optional and it will be released very soon. Anyway if you use Fresco just change the name of your own library and you should not have any problem. If you want the same libwebp.so of Fresco you just skip the build phase for yours. 
  At the moment we don't support rounded gif animations.  
http://frescolib.org/docs/rounded-corners-and-circles.html
 @marcosalis There would be a quite a high performance penalty of performing the crop using a bitmap shader for each frame.

On newer versions of Android using an outline provider on the View itself could be an option. We got a pull request where this is implemented: https://github.com/facebook/fresco/pull/1736
As a workaround you could try using an View outline on API level 21+ and using the less nice overlay color option for older devices.

To work around the issue with shared element transitions you could then for older devices replace the animated image with a still frame where the crop is done using a bitmap shader right before you trigger the transition (yes, It's a bit hacky) @marcosalis About the flicker issue, the next release of Fresco will contain a rewritten GIF pipeline which is much improved over the old one (specially for performance, frame rate consistency, caching and lots more) so fingers crossed that it might be fixed then :)  Hi,
Do you mean the percentage of the image while downloading? 
 To do that you should use the `getProgress()` callback method of the `DataSource`. This is a float from 0.0f and 1.0f which can be used to calculate percentage. https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/fbcore/src/main/java/com/facebook/datasource/DataSource.java#L73
  I assume that the pasted code is part of the ImageBrowserActivity ? So which exactly is the line number 177 ?
 The subscriber should not be assumed to be running on the UI thread. This error happens when you try to touch UI elements from a non-UI thread.
  Can you provide more information ? Can you show us how you use Fresco in your xml or java code ?
 I guess you have the same issue as #1468. If not, please let us know and we can re-open this issue.
  Nope, there is no such API and this information is not directly available to the controller.
  There is no synchronous API for getting images. If you want you can make the operation synchronous by employing one of the synchronization primitives (CountDownLatch should be good). 

Please have in mind that Fresco deterministically manages lifetime of images via CloseableReferences. I have a strong suspicion that your `getBitmap` might violate the contract. Please read http://frescolib.org/docs/using-image-pipeline.html carefully to find out how to work with CloseableReferences.

That being said, to avoid issues you probably want not only to build the notification in `onNewResultImpl` but also send it there. Alternatively you can make copy of the bitmap managed by Fresco or make caller of getNotification responsible for closing CloseableReferences when it does not need the image anymore.
 Actually `builder.build()` makes a copy of the bitmap, so you don't need to send notification in `onNewResultImpl`. Here you can find some more info: http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap
  We left it at 0.7.0 on purpose because of issues syncing to jCenter.
  Thanks for reporting.

Can you try bumping your target sdk to 21 ? If not, it is fine to add the line  (`-dontwarn com.facebook.drawee.view.DraweeView`) to your proguard config.
  After closing `imageReferenceClone` you are not allowed to use the result of `imageReferenceClone.get()` anymore. After closing both references in yours `onNewResultImpl` Fresco is allowed to recycle underlying resources. If you want to keep the image around you have to keep at least one live reference pointing to the image.

If you really can't use SimleDraweeView, you have to make sure that you pass appropriate CloseableReference together with all drawables/images depending on them. Also, to avoid memory leaks, your code should call `close` on the reference once the image is not needed anymore.
 Looks good !
 Also, make sure that you read documentation: [DataSources and DataSubscribers](http://frescolib.org/docs/datasources-datasubscribers.html#_)
  Thanks for reporting. Which version of Fresco do you use ?
 Nevermind, someone is already fixing this.
  Thanks ! Can you reproduce this with Fresco 0.8.1 ? Can you share a link to a jpeg that you use to reproduce the issue ?
 michalgr at fb dot com

Thanks
 I was able to display all the images using our [uriapp](https://github.com/facebook/fresco/tree/master/samples/uriapp) without seeing any exceptions. How often does it reproduce ? Can you share the part of you code that creates and sets up the controller ?
  1. Is the view that draws to Canvas a SimpleDraweeView ?
2. What do you do with the bitmap in the `//work on the bitmap` if branch ? Do you store it somewhere (this is not allowed) ? Is there any chance that the code that manipulates the bitmap recycles it on its own ?
3. There is a leak in your code where you call `imageReference.clone().get()`. Clone method returns new instance of ClosaebleReference that you are responsible for closing. If you don't do that then garbage collector will have to.
 Can you show us the full stack trace ? 3 can cause the bitmap to be recycled while it is used, however I still don't know how can this cause exception in SimpleDraweeView.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Glad to see such a cool project uses Fresco.
 @valentinstoychev updated the pull request.
 This looks good but we need you to sign the CLA as indicated above before we can merge it.
 @valentinstoychev Please sign the CLA here https://code.facebook.com/cla . 
We need this in order to add your project. 
Thanks
  Please share the original photo, I'll check whether I can reproduce this in our sample app.
 I am able to display the picture in our [uriapp](https://github.com/facebook/fresco/tree/master/samples/uriapp) without any artifacts. What version of fresco do you use ? Can you show us the code (java/xml) that configures SimpleDraweeView ?
 Hm. What devices is this behaviour occurring on?
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  No, the default http stack and disk cache do not exchange any information apart from image bytes. But you can use ok-http as the http stack and disk cache: http://frescolib.org/docs/using-other-network-layers.html.
 By default Fresco never removes old entires unless you hit the size limit. If you want to clear old entries on your own, there is `FileCache. clearOldEntries` method which you can use.
  How is this Fresco related question?
 In case this is related to fresco, here is the disk cache configuration: https://github.com/facebook/fresco/blob/c08495a312ceffe15a815304b42db8fe24f6fde0/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineConfig.java#L177-L178
 @LiuDeng where do you get `LowDiskSpace` and `VeryLowDiskSpace` from? Is this something that **Fresco** reports, or is this something that your **Android device** reports? If it is the later than this has nothing to do with the Fresco library. Even if the Fresco disk cache contributes to the disk usage the actual limits have likely nothing to do with Fresco.
  We do have a limit on cache items size, so it is quite possible that that's the reason. Any chance you can share the GIF file? Also, are you seeing any logcat messages output by Fresco?
 How do you determine that loading fails ? I am able to display the image you pointed to using our [uriapp](https://github.com/facebook/fresco/tree/master/samples/uriapp) sample app, it takes a few seconds to decode though.
  Yes, Fresco does support GIF images. In order to determine why your GIF fails to load we are going to need more information. If you can share the GIF image that would be the easiest way.
 Any chance you can upload that GIF file so we can try it ourselves? Have you followed the [troubleshooting](http://frescolib.org/docs/troubleshooting.html#_) steps?
  Is the gif image animated? There are some limitations with rounding. Please see the [rounding](http://frescolib.org/docs/rounded-corners-and-circles.html#_) documentation for what those limitations are and how they can be worked around.
  Hi, I think you are missing the point of executors. This is not how executors are supposed to be implemented/used. The purpose of executors is to execute runnables on a specific thread and with specific policy.
We already provide several [executors](https://github.com/facebook/fresco/tree/0f3d52318631f2125e080d2a19f6fa13a31efb31/fbcore/src/main/java/com/facebook/common/executors) and one should carefully chose which one to be used. The one that you implemented is actually `CallerThreadExecutor` and should be used with great caution as it executes runnables on the caller's thread.
If you need to do any UI stuff from your callback, you must use `UiThreadExecutorService` as Android view system is not thread safe and is only to be accessed from the main thread (the UI thread).
If you need to do some db access, file writes or anything else that is a slow operation, this should not be done either with CallerThread nor with the UiThread executors, but with one of the background thread executors. See [DefaultExecutorSupplier.forBackgroundTasks](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/core/DefaultExecutorSupplier.java) for example implementation.
 No problem, thank you for pointing this out. I just updated the docs explaining executors. Let me know if that helps.
 Btw, Executors are not really Fresco specific, this is a well known Java concept. But I do agree that it is worth mentioning them in the docs.
Also, please see:
https://docs.oracle.com/javase/tutorial/essential/concurrency/executors.html
http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executor.html
  Hi, your project looks nice! I think in this case it is better if we keep `RippleCompat` as a separate project, instead of being a part of Fresco library. That way we avoid coupling two libraries that should remain separate.
RippleCompat being a separate library doesn't make it incompatible with Fresco in any way. That said, I definitely would like to help you make your project compatible with Fresco. I briefly looked at the source code and I have some suggestions.
I noticed that at the moment RippleCompat heavily depends on the view being ImageView. This imposes some complexities, none of which are required with Fresco.
Display layer of fresco is called Drawee. Drawee supports overlay drawables and ripple effect feels like a perfect use case for that. Drawee already propagates state changes correctly, so, to make a ripple effect with Drawee, all you really need to do is implement a single Drawable that is state aware. Like Android's `StateListDrawable`. When the state changes to `state_pressed` your drawable can start performing the ripple-effect animation. When the state changes to something other than `state_pressed` you stop the animation.
You do not need to temper with the actual image in the ImageView, or with the scale types, etc. This is both dangerous and unnecessary.
The only thing that Drawee doesn't support at the moment is passing the touch event to the drawable and therefore we don't have coordinates of the touch. We can add support for that, and this is really the only change that should be done in Fresco.

After you implement your drawable that is state aware, this is how it can be set to Fresco / Drawee:

Programmatically:

```
GenericDraweeHierarchyBuilder.setOverlay(rippleEffectDrawable)
```

XML:

```
fb:overlayImage="@drawable/rippleEffectDrawable"
```

This is a simple example of Android's StateListDrawable that is state-aware and just displays the `underlyingDrawable` when you tap on the view:

```
StateListDrawable stateListDrawable = new StateListDrawable();
stateListDrawable.addState(new int[]{android.R.attr.state_pressed}, underlyingDrawable);
```

I strongly suggest that you provide a similar API. Just a single drawable that can be inflated from XML or instantiated programmatically with the given parameters. Then we just set that drawable as an overlay.
 Yes exactly. Ideally you should not be solving scaling and other stuff unless absolutely necessary. This also makes your library incompatible with anything that does scaling and other stuff in a different way than your library. It is best if the code can be kept modularized so that your library only really does the ripple effect.
I understand why you need this logic with the ImageView, but luckily, with Fresco, we can make it much simpler.
If I were you I would refactor your library like so:
- Create a `RippleEffectDrawable` that just draws the ripple effect onto canvas (based on the pressed-state, and a public method `setRippleCenter(float x, float y)`.
- For your effect to work with Fresco, the above drawable is enough.
- To support the plain ImageView for those who do not use Fresco, I would offer two ways:
1. By extending `ImageView`. The advantage is that you do not need to deal with scale type, and you do not temper with the view background. The drawback is that Java does not support multiple inheritance which means that this is not always a suitable approach.
   
   ```
   onDraw(canvas) {
     super.draw(canvas);
     mRippleEffectDrawable.draw(canvas);
   }
   
   onTouchEvent(event) {
     mRippleEffectDrawable.setRippleCenter(event.x, event.y);
     or
     mRippleEffectDrawable.onTouchEvent(event)
   }
   ```
2. By modifying the ImageView in the way that you do now. This has exactly the opposite trade-off. You have to deal with the scaling, background, etc, but this might also work with some other Custom views that extend ImageView. Even though, you should be aware that this is a dangerous practice.
 FYI, Android introduced the `setHotspot(float x, float y)` method that serves for this purpose.
  Hi!

Thank you for your interest in Fresco. I think your idea is pretty cool and I see no reason not to do it. We just need to check some technicalities such as the license of those image formats, because some of them might be proprietary.
On a related note, right now we are in the process of making WebP support optional so that we don't impose additional size overhead to those apps that do not need it. Once we add ability to make WebP optional, I think it would be pretty straightforward to optionally support any other image format at no cost to those that are not using it. So we should be fine on that front too.
Btw, I am slightly confused because you mentioned BPG at first and then BNP. Are those two the same image format or? Also, I am curious what you have in mind when you say adding support for it. Do you mean adding an open source C library that handles those formats and the corresponding Java glue-logic, or are you thinking of actually implementing the codec itself?
 Exactly my thoughts, we should not reimplement this logic, but use the existing implementation. WebP refactoring is already in progress and we should be able to reuse that infrastructure to other formats as well.
But waiting until this is done that doesn't have to block you. You can still check out Fresco repo and start playing with it.
 Let me check that and we will respond here.
 Use as a model the native code that does transcoding and resizing in the imagepipeline package.
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still worth pursuing, feel free to comment and we can re-open. It looks to me as though the licensing issues which have been raised might make this impossible to pursue though.  Is it possible that there is redirection happening? It's hard to tell when you substituted actual urls with `/folder/file.jpg`. Also, I only see one response. Why is that?
 You can email it to me on plamenko at fb dot com.
 Can you follow the instructions for [debug logcat dumps](http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat) and paste the results here?

Also are you using OkHttp?
 @eldk :
Ping on @tyronen's questions.

Also here are some ideas on how to make progress:
1. Try your urls with a very simple sample app (use one from the /samples directory). Do you still see the double gets?
2. Try your app with a hardcoded image url to a public, static image which is not in your servers. Do you still see the double gets?
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Hey @beetlebum , very happy to hear that you're using Fresco :) I'd love to hear your feedback on the library - if you want to have a chat send me an email on balazsbalazs@fb.com.
Also, could you sing the Contributor License Agreement
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Oh, btw: both me and Tyrone are active users of Memrise! :)
  Hi, you can't inflate only the hierarchy at the moment, but you can inflate `GenericDraweeView`. If you just need the hierarchy, you could make a pull request that extracts `GenericDraweeHierarchy` [inflation logic](https://github.com/facebook/fresco/blob/94ce1dee0733300fe2c029382e0c454169db81b8/drawee/src/main/java/com/facebook/drawee/view/GenericDraweeView.java#L91) out of `GenericDraweeView` (preferably to a separate file, `GenericDraweeHierarchyInflator` or similar). I wanted to do that since long time ago, but there was always something else. 
 You can use `GenericDraweeHierarchyInflater.inflateHierarchy(Context context, AttributeSet attrs)` or GenericDraweeHierarchyInflater.inflateBuilder(Context context, AttributeSet attrs)` to get a hierarchy or a builder.  What exactly "doesn't work" mean? Do you get an exception, do you just get a blank image, something else?
 So, is this still an issue for you, or "clean up" resolved it and we can close this task?
  Can you give us more information about those images? If you can upload one of them that would be very useful. If you can't upload it, if you could extract first couple (say 100) of bytes of the file, with some Hex editor, that would be also be helpful.
 Yeah, this is similar to #321 
Would it make sense to clear the cache if the image if we fail to decode it?
Disadvantage might be more data usage (we're going to re-download something that is not recoverable). Maybe we can have a retry limit.
 That's weird. I don't think we should do any code changes until we understand what exactly happened here. If the image gets corrupted during the download, network fetch should fail. I would expect HTTP library to be able to detect corruptions. That means that there is no reason to expect different outcome if we fetch the image again. So, caching the image is not a problem here, even if it cannot be decoded.

The problem we need to investigate is how we first got a corrupted and then a correct image for the same uri.
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.

The last comment however mentioned the lack of a check for HTTP_OK which is now present.  Can you try enabling resizing or downsampling ? http://frescolib.org/docs/resizing-rotating.html#resizing
 Can you follow the instructions for [debug logcat dumps](http://frescolib.org/docs/troubleshooting.html#investigating-issues-with-logcat) and paste the results here?
  Extend [DefaultCacheKeyFactory](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.java), override `getCacheKeySourceUri` and return a new normalized Uri. If I understand correctly, in your case normalization would be something like removing a signature from the end of the Uri. 
Then build `ImagePipelineConfig` with your cache key factory (just set it with `setCacheKeyFactory`) and pass that config to Fresco initialization as explained in the documentation.
  You process ran out of memory - not much we can do about it. Try to use large heap, other than that we can't do much on ART.
  Can you provide more details please?
Are you saying that if I download the image in the above URL and put it as a placeholder image it will not appear?
If yes, can you try it in a very simple sample application, which only has one SimpleDraweeView and this image as a placeholder. Is it working there?
 Hi, the problem is the space into the URL you provided. It should be responsibility of the caller to encode it using classes like http://docs.oracle.com/javase/7/docs/api/java/net/URLEncoder.html. In your case the URL should be:

https://s3-ap-northeast-1.amazonaws.com/drogen-bucket/item/LOBIT%20300GT/1448867012241_lobit-300.jpg

with the %20 in place of the space.
  Can you attach or link to a sample application where this is visible/testable?
 Yes, Fresco does not load images that are not visible. That's by design and greatly reduces the memory usage occupied by the bitmaps. If you explicitly want an image to be loaded even if not visible, [prefetch](http://frescolib.org/docs/using-image-pipeline.html#_) it to the bitmap cache so that it is immediately ready when needed.
  Can you attach or link a sample app where this is reproducible?
I'm not sure what you want to do here. I guess the runOnUiThread() will just schedule the runnables in the UI looper, in which case there is no concurrency, everything is running on the UI thread synchronously, one after another.

Not sure what the relative layout is in this case.
  Can you provide more detail please? What are you trying to do exactly?
  What's the reason you closed this? Is this not happening anymore?
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  When is this happening? What are you doing? Which version of Fresco?
  Answered on stack overflow: http://stackoverflow.com/a/34076700/3027862
  DataSource.getResult() will return null if the image is not downloaded yet.
The DataSource is basically a Future. You need to use a DataSubscriber, see documentation here:
http://frescolib.org/docs/datasources-datasubscribers.html#_
 I don't think so. Why do you want to load it on the UI thread?
 You're loading local resources normally in UI thread because they are relatively fast. Decoding an animated GIF is much slower.
Blocking the UI thread is never a good idea, if you don't want to show any UI until this is loaded you can set a listener and make your UI invisible/visible. Blocking the UI thread will make the whole app unresponsible (not just the UI), back key won't work, etc.
  We're working on it. You can use it from Maven Central for now. JCenter doesn't have 0.8.1 yet.
 See issue #744 . Closing this.
  Please see the [resize](http://frescolib.org/docs/resizing-rotating.html#_) documentation.
  Hey! Thx for reporting it, I'm going to add this. Do you have any idea how to test it?
 We're cleaning up long-untouched issues so I'm closing this one.

If you still think this is needed, I'm happy to support a pull request.  What are you doing exactly? Can you paste the code that fails?
 ok, can you post the full stacktrace please?
 Duplicating to the newer issue #1696  That's by design. Interaction with the image is not allowed until the image is loaded.
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Wooohooo! Thx for using Fresco ;)
Amazing and meaningful app! Well done.

I'd love to hear your experiences with Fresco.
 @mrsasha: good to hear :) Let us know if we can help with anything.
 @sleeperabc : ping me on balazs.balazs80@gmail.com with things you find challenging to learn/understand. Maybe we can improve the documentation/examples.
  Hey @pipipzz !

`DalvikBitmapFactory` was removed in 0.8.1. so this message is strange.
1. Do you have any specific rule in your proguard config related to `DalvikBitmapFactory`?
2. Can you look into your build directories to see if you have the `DalvikBitmapFactory` anywhere?
3. Can you also try a gradle clean and then try building again?
  Making a synchronous call to disk cache would surely block main thread for some time. It's highly unrecommended to do so, and also unnecessary. You can isInDiskCache in imagepipeline class to see if image lives on disk.
  please do a resize or downsample to your images. THe last image you're decoding before oom is more than 2mb. You don't need an entire original image load in.
 You are simply running out of memory. Loading huge images in a collection view will cause that.
  This is something we'll plan to do in future. Thanks.
 You can actually do this now, sort of:

``` java
DiskStorageCache diskCache = Fresco.getImagePipelineFactory().getMainDiskStorageCache();
SimpleCacheKey cacheKey = new SimpleCacheKey(uri.toString());
diskCache.probe(cacheKey);
```

This updates the timestamp so that the image is once again the 'least recently used'. Do this regularly and the image won't ever get evicted. This won't work if you are using a custom CacheKeyFactory.
 Another way to tackle a problem like this is to request the encoded image data and write it to a local file. You can then attempt to display it based on a local URI.

We're cleaning up long-untouched issues so I'm closing this one.  How big you pic is? I guess you're running in 5.0+.
Double check with your pic, and do a resize or downsampling for your picture. 
If issue still exists, can you show your code?
 I would say this is just because the placeholder is too big but multiple people are saying the same things and 1242x400 doesn't seem extremely big -> so I suspect there might be some problem here.
I tried to reproduce/catch this but I wasn't able. Can anyone help reproduce it?
- how often do you see this?
- what device are you using?
- is this in a list or just a simple image?

Can someone create a very simple sample app where this is reproducible?
 Similar thing is reported here:
https://github.com/facebook/fresco/issues/734
 Folding all OOM issues into #574 
  We have ZoomableDraweeView do this thing.
 It should be in com.facebook.samples.zoomable. Do you have the lastest version of Fresco library?
  You're doing the right thing!
 You need have a listener.
http://frescolib.org/docs/listening-download-events.html#_ surely helps you.
  what is the full path of your image, and what kind of format is it.
You may need to use https://developer.android.com/reference/android/os/Environment.html
 You can try to query JPG path first. I think Fresco is able to decode the pic once if it can find the image file. You'll need to figure out the file path.
  http://frescolib.org/docs/resizing-rotating.html#_
We're still in the stage of experimenting downsampling.

Depending on your need, downsample may be better to use in you case.
 There's limited for downsampling which you can find online as well. Downsampling might not cover what the use cases.
  Hey @cazador4,

Thx for the pull request, it's awesome.
However, we discussed it internally and we'd prefer not to include it in the core library, rather include it in a separate samples/contrib directory.

Our reasons are the following:
1. We want to keep the core library as small and as simple as possible.
2. You can do a similar thing using AutoRotateDrawable as the progress bar image
3. The class is very simple and there's a chance users will need a custom implementation of  (eg stroke width, circle style, etc).

That said I think the code is **very** useful so we'd love to have it because I'm pretty sure people do need it. We also have a few other Pull Requests which are similar.
So what I suggest: let's put this under /samples/contrib/ directory. (/samples/contrib/com/facebook/drawee/drawable/CircleProgressBarDrawable.java)

What do you think?
 @cazador4 updated the pull request.
 Ah, cool, thx for this!
  http://frescolib.org/docs/caching.html#_
It's stated in doc. Hold true for local images as well.
  nineOldslibrary is shipped with 0.8.1, you don't need to add it yourself.
  java.lang.RuntimeException: Canvas: trying to use a recycled bitmap android.graphics.Bitmap@16502a9
mean you bitmap was recycled before drawing. 
 Can you show your code?
 From the title, I assume the author just uses SimpleDraweeView. This looks like a Fresco bug. Probably something in the pipeline as there have not been any recent changes on the Drawee part that I am aware of. It seems that we are closing bitmap while it is still being used by the view.
 Is this still happening for newer Fresco versions (v0.13)?
 I'm closing this issue since we don't have a repro for this and we've released many new versions since then. Let us know if this is still an issue.  You can listen to all requests (including prefetches) by setting a listener here: https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineConfig.java#L402:L405
 Hi @xiadeye, besides the global listener that @korniltsev suggested, you can now (v0.14+) also register listener for single image requests: `ImageRequestBuilder#setRequestListener`.

Usually, you want to use the former for implementing general logging and the later if you want to instrument special requests.
  Yeah you should try with an updated version of Fresco
  Make sure you are using a recent version of Fresco, and that you are only receiving images of the size you need (do resizing if possible). 

If you absolutely cannot get it down to a reasonable size, you can try setting `android:largeHeap=true` in your manifest file.
  Same as #741 
  You can create smaller thumbnails (and cache them) by specifying resize params for your image. This will have a different cache key to the same url with no resize params. 
  My mistake, you can't actually do that for the disk cache - I was thinking of the bitmap cache, where this is an option. 
  You don't need to resize the image to the **exact** size of the view. So just find a way to approximate it, or use whatever gets sent from the network. 
  Your cache size is 100KB so that's probably why you can only fit one image in it at a time. 
  This image is 69MB! I suggest you download something a bit smaller :) 
 What's the URL? In the error it says that we're trying to allocate 69596748 bytes
 Do you have any special configuration for Fresco? How are you loading the image? This is a bit weird. Are you sure that is the image that it's OOMing on, and there isn't another one that is really huge? 
  Yeah this is not supported - the images should be the same, just at a different resolution, so you shouldn't require fading at this point. 
  I don't understand. It makes a request each time getView is called, which is what you've written your code to do. 
  Yeah, unfortunately it will be slow as encryption is fairly slow. I suspect the OOMs are unrelated. Unfortunately there is no good way to do this right now. 
  It was no longer required. 
 It was also a duplicate of `UiThreadImmediateExecutorService`. You can use that class instead.
  Yeah, you can specify resize params. See http://frescolib.org/docs/resizing-rotating.html#_

As that article says, really you should try to load a smaller image from the network, as that is using a lot of unnecessary data. 
  What URL are you passing to Fresco? It looks like you are passing *.gif, when it should be *.jpg? 
 In your first comment, it says that it is a jpg, no? 
 What happens if you move it to a different directory? 
  If you are using a recycler view, then match_parent is undefined, so you can't use that. You have to use wrap_content, and then you can rely on the aspect ratio of the image, rather than specifying one yourself. 

Where in the documentation does it say that the disk cache will be deleted if you kill the app? I don't think that is the case (that is the point of the disk cache, after all). 
 You can get the full image to be displayed using match_parent for width, and then whatever aspect ratio will show you the full image. 

You can use DiskCacheConfig to specify that you only want 10 images to be saved. 
 Your parent container has a height of `wrap_content`, which we do not support. You can either explicitly set a height or set an aspect ratio for the Drawee view.

See http://frescolib.org/docs/wrap-content.html and http://frescolib.org/docs/using-drawees-xml.html
  This is already imported - don't worry about updating the commit. Will be in the next version. 
  Is the problem that the image doesn't fully cover the view? See the last bullet point here: http://frescolib.org/docs/rounded-corners-and-circles.html#caveats

can you use `OVERLAY_COLOR` instead? 
 Oh, great find, thx a lot! And amazing details, this is super helpful! Looking into it now.
 Thx again @burzumrus for the amazing details, this issue is fixed now, will be available with the next release.
  Is it because this device is running ART and the other devices you are using run on Dalvik? Maybe try making the memory cache a bit smaller, if you can? 
  Thanks for letting us know. Are you able to proceed without the `setBitmapsConfig` line? 
 Can you please give the url of an image that is failing to load? 
 Great!
  I don't think Fresco currently supports this, sorry. 
  Are you just using normal Fresco? Or do you configure the disk cache or anything like that yourself? 
 Are you using SimpleDraweeView to download the images? Or are you doing it yourself? 
 You should be able to just use the SimpleDraweeView and not use the pipeline directly. Are you experiencing this on devices other than Samsung? We have had problems before with file descriptors on Samsung.
  Looks like same as #324, it's the `rejecting re-init` log that is the problem. 
  This is really great, thanks @andreidiaconu!!! 
 @shercoder: You can create you own `NetworkFetcher` implementation and provide that to the `ImagePipeline.Config`. With that you'd have all freedom to handle these special cases.

I feel that most applications want to do proper error handling of any non-200 response that comes from the network stack on the product level. For instance, often one does not want such an image staying in the cache for a transient issue.  Hmm, strange. ImagePipeline and Drawee have been correctly mirrored to jcenter from mavenCentral(), but Fresco has not. 
 We're working on it. You can use it from Maven Central for now. JCenter doesn't have 0.8.1 yet.
  This isn't a hi-pri bug for us so we don't have a timeline for fixing this I'm afraid. 
  With your Lollipop config, you are only allowing 1 entry in the cache at once. I suggest you change the value returned by the `getMaxCacheSize` method for Lollipop builds, and leave all the other params as is. 
 Why didn't it help? What happened? Can I see your new code? 
 Yeah, what goes wrong now? 
  I cannot reproduce the problem. I've just created a simple application using Google Play Services and loading an image with Fresco. Are these dependencies the same you are using?

```
    compile 'com.facebook.fresco:fresco:0.8.1+'
    compile 'com.google.android.gms:play-services:8.3.0'
```

When do you see the problem?
Thanks
 I assume that the problem has been resolved. Please let us know if you're still experiencing this issue.
  I suggest you do as @gokhanbarisaker suggested and pass the width into the adapter. 

Also, when someone tries to help you I don't think responding "NONONONO!" is really going to encourage them to help you again in the future. 
 No worries :) 
  You can set a ControllerListener and get this info from the ImageInfo object that is returned. 

http://frescolib.org/docs/listening-download-events.html#_
  This means your image has at least one dimension larger than 2048 pixels. Android cannot display images that size on a hardware-accelerated texture. Nor can Fresco resize or downsample the image, as it is a GIF.
  Closing as the issue has already been fixed  If you are using an ImageSpan inside a view, then the images in the span should all belong to a MultiDraweeHolder. See the instructions for [custom views](http://frescolib.org/docs/writing-custom-views.html#_).
  What is the empty_collection drawable?
 Do you see a "Caused by" anywhere in the stack trace?
If not, can you set a breakpoint inside the GenericDraweeView.inflateHierarchy method? Try to navigate to the exact point of the crash.
 How big is the empty_collection drawable? Can you attach it?
My gut feeling is that the placeholder image is just too big for the device to load. It's usually is a good practice to use small images as placeholders.
 Let's continue this discussion in #780 - the cause seems to be the same.
duplicate of: https://github.com/facebook/fresco/issues/780
  Duplicate of #410 please comment there.
  Your app went out on Oct 30? Did you have a previous release that was also using Fresco? If so, what version was that?
 please answer in #410 
  Just fetch it as you normally would. Fresco always checks cache first.

If you don't want to go to network again, use `ImageRequestBuilder.setLowestPermittedRequestLevel`.
 Yes. If the data is not in cache, it is fetched from network.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  å½“ä½¿ç”¨å¤§å›¾çš„æ—¶å€™ï¼Œè¯·ä½ æŒ‰ç…§ä½ çš„éœ€æ±‚ä½¿ç”¨resizeæˆ–è€…downsamplingã€‚æ™®éè¯´æ¥ï¼Œä½ å¹¶ä¸éœ€è¦æŠŠæ•´ä¸ªå¤§å›¾è£…è½½è¿›ä½ çš„viewä¸­ã€‚
  `android:src` is [not supported by Fresco](http://frescolib.org/docs/gotchas.html#don-t-use-imageview-attributes-or-methods-with-draweeview).
  This seems to be a build problem - at run time, it's apparently unable to get a system class from JNI code. 

Are you using v0.8.0? We have had issues with that - please upgrade to v0.8.1.

You can also make sure you are doing a completely clean build for your production releases:

```
rm $HOME/.gradle/caches
rm .gradle
./gradlew clean
./gradlew build
```

Do you get the issue in debug builds?
 Please tell us the manufacturer and model name of this device. Is it available outside China?
 Thanks for the updates. We'll investigate later.
 I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.  Try this: 

``` java
ImageRequest imageRequest = ImageRequestBuilder.newBuilderWithSource(uri)
    .setLowestPermittedRequestLevel(RequestLevel.DISK_CACHE)
    .build(();

DataSource dataSource = imagePipeline.fetchDecodedImage(imageRequest, callerContext);
dataSource.subscribe(new BaseBitmapDataSubscriber() {
    @Override
    public void onNewResultImpl(@Nullable Bitmap bitmap) {
        if (bitmap != null) {
            Log.w("Debug", "The bitmap is in cache!!!");
        }
    }
  },
  executor);
```

This will determine if the image is, in fact, in cache.
 Can you give us some context on what are you actually trying to do?
`imagePipeline.isInDiskCache` will return whether the image is in the disk cache. But this won't download the image and put it in the disk cache. This merely checks whether the image is there or not.

Doing the following will prefetch the image in the disk cache:

``` java
imagePipeline.prefetchToDiskCache(ImageRequest.fromUri(uri), callerContext);
```

If the above succeeds, your `isInDiskCache` code should yield true.
  See the [API docs](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/request/BasePostprocessor.html#process%28android.graphics.Bitmap%29) for the method you called. You have to make your changes to the passed-in bitmap for them to appear. You're creating a whole new Bitmap, which is not returned anywhere and will simply get garbage-collected.

You should override this method instead:
`public CloseableReference<Bitmap> process (Bitmap sourceBitmap, PlatformBitmapFactory bitmapFactory)`

Instead of calling `Bitmap.createBitmap`, you can then call `bitmapFactory.createBitmap`.
  Follow #574.
  I don't understand your question.

If you mean you cannot use SimpleDraweeView, you can use our [custom view](http://frescolib.org/docs/writing-custom-views.html#_) support.

Please open a new issue if that was not your question.
  Follow [these instructions](http://frescolib.org/docs/caching.html#checking-to-see-if-an-item-is-in-cache) to see if an item is in cache.

You can specify a custom decoder when [configuring the image pipeline](http://frescolib.org/docs/configure-image-pipeline.html#_). Use the `setImageDecoder` method.
 No. Images are not in cache until they've been downloaded, and they will be evicted from cache if the cache fills up. Eviction goes by least-recently-used; so if you want to prevent an image from being evicted, fetch it again.

You can also make use of two caches by using the [small cache](http://frescolib.org/docs/caching.html#using-one-disk-cache-or-two).

If you call `fetchEncodedImage`, you get a DataSource. Add a DataSubscriber to that DataSource, and it will get called when the image is downloaded. After that it will remain in cache until evicted.
  #700 
æˆ‘å‘çŽ°ä½ åˆpostäº†ä¸€æ¬¡ã€‚åœ¨700ä¸­ï¼Œæœ‰è¯´è¿‡ä½ è¦æœ‰å¯¹è±¡æŒ‡å‘cloneå¯¹è±¡ã€‚åˆä»£ç è¯´è¯å°±æ˜¯ï¼Œä½ éœ€è¦CloseableReference<CloseableImage> closeableImageReference = dataSource.getResult();
CloseableReference<CloseableImage>  copyCloseableImageReference = closeableImageReference.clone()ï¼›
CloseableBitmap closeableBitmap = (CloseableBitmap)copyCloseableImageReference.get();
ç„¶åŽå¯¹closeableBitmapè¿›è¡Œæ“ä½œ

ä¸­é—´æ¯ä¸€æ­¥éƒ½éœ€è¦æœ‰å¯¹è±¡æŒ‡å‘ã€‚ä¸ç„¶gcä¼šæŠŠbitmapå›žæ”¶ã€‚
 å¦‚æžœä½ æ˜¯æƒ³ç”¨imageviewå¯¹bitmapè¿›è¡Œå±•ç¤ºçš„è¯ï¼Œè¯·ä½¿ç”¨draweeã€‚ä¸ç„¶ï¼Œå†…å­˜å¤„ç†ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚
å¯¹äºŽä¸Šè¿°çš„gcå¯¹bitmapå›žæ”¶çš„é—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¯·ç»“åˆä½ å…·ä½“æƒ…å†µä½¿ç”¨ã€‚

``` java
DataSubscriber dataSubscriber =
    new BaseDataSubscriber<CloseableReference<CloseableImage>>() {
  @Override
  public void onNewResultImpl(
      DataSource<CloseableReference<CloseableImage>> dataSource) {

    if (!dataSource.isFinished()) {
      FLog.v("Not yet finished - this is just another progressive scan.");
    }  

    CloseableReference<CloseableImage> imageReference = dataSource.getResult();
    if (imageReference != null) {
      try {
        CloseableImage image = imageReference.get();
        // æ­¤å¤„å¯¹imageè¿›è¡Œæ“ä½œï¼Œä¸­é—´è¯·è‡ªè¡Œåˆ¤æ–­bitmapæ˜¯å¦è¢«å›žæ”¶
Bitmap loadedImage = image.getUnderlyingBitmap();
doSomethingWithBitmap(loadedImage);
      } finally {
        imageReference.close();
      }
    }
  }
  @Override
  public void onFailureImpl(DataSource dataSource) {
    Throwable throwable = dataSource.getFailureCause();
    // handle failure
  }
};

dataSource.subscribe(dataSubscriber, executor);
```
  As documentation says the Bitmap into the `onNewResultImpl()` method  is only guaranteed to be around for the lifespan of the method. This means you have to consume the image into that method. Probably you're keeping the image around. Try to use a `BaseDataSubscriber` instead. 

https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/imagepipeline/src/main/java/com/facebook/imagepipeline/datasource/BaseBitmapDataSubscriber.java#L71
 How are you using the image into the Canvas? Can you provide a snippet please?
Thanks
 At some stage there's a call to Bitmap `recycle()` probably in `CustomImageSpan`. Could you check if the Bitmap in the onNewResultImpl() has isRecycled() returning false?

Thanks
 Do you mean ImagePipeline caches or another cache implementation?
 Your code above is wrong. You are taking the Bitmap out of the `CloseableReference` and passing it to the rest of your app. When the reference count goes to zero, your Bitmap will be recycled without warning.

You should instead pass the `CloseableReference<Bitmap>` to the rest of your app, and hold a reference to it. When you are done with the Bitmap, then call `close()`.
 That sounds like you are closing the reference too early. Once you have called close, you should never again pass that bitmap to any draw method.
 You should close the reference when nothing holds on to the bitmap and when the bitmap will never be rendered again.  Where are you getting that error? Could you provide more information please?
Thanks
 please check if you have the right NDK path
  I cannot imagine why you could possibly need a 50M jpeg on a mobile device.

You should [resize](http://frescolib.org/docs/resizing-rotating.html#resizing) the image first. If you absolutely cannot get it down to a reasonable size, you can try setting `android:largeHeap=true` in your manifest file.
  Thank you for your suggestion. We're always testing new ways to optimize the load and rendering of the images. Anyway, if you give us the reference to the specific image we can investigate more on the reason of the performance you're measuring. 
Thanks
 We're looking into the current GIF implementation to see what can be improved. However, large GIFs are time- and memory consuming to decode and display.
 Since the last update we have launched improved gif support that should help with performance issues. Please re-test on the latest build and reopen the ticket if the performance is still an issue. Thanks!  Most of the time the placeholder and failure images are already into the application and not loaded from a different sources. Anyway, we'll consider other way to se those images.
Thanks
 Sure, we'll definitely improve that. 
Thanks
  The ImagePipeline should be decoupled form the source of the image that is not always the web. In any case we're working on providing some more information about the HTTP stack when we make a request and when we get a response.
Thanks
 Closing. This would be useful but it also break the abstractions we have to decouple image fetching.  Thank you for this proposal. We're evaluating the support for other types of images but not in the short term. 
  [Resize](http://frescolib.org/docs/resizing-rotating.html#resizing) your image before decoding it.  Be sure not to enable downsampling.
  Probably the same problem of this: https://github.com/facebook/fresco/issues/717
  Android `Animatable` interface doesn't have the `pause()` operation so probably you could implement this as a specific `Animatable` implementation feature. At the moment we don't plan to do that.
Thanks
 This is now possible (f914b7a8e2acd2313ee785b48aee7722f3d7da9a) thanks to @gtpark. It will be available in the next release (or right now if you're using the GitHub source directly).
However, since `Animatable` is an Android interface, you have to pause the animation differently, see f914b7a8e2acd2313ee785b48aee7722f3d7da9a
  `ImagePipeline` is already design in order to optimize the load of the images. The `Drawee` framework is then optimize to interact with the `ImagePipeline`. Do you have any specific use case? What do you mean with 'stop processing queue'?
Thanks
 Duplicate of #512 
  Here you can find the information you need.
http://frescolib.org/docs/closeable-references.html#_
  In our implementation we keep the network layer decoupled from the ImagePipeline; not all images are loaded from network. We'll probably add the chance to set some header to the HTTP request and we're evaluating the same for other features. 
 The solution to get more control over how requests are performed would be to write a custom Network fetcher. See NetworkFetcher and OkHttpNetworkFetcher.   Can you provide the layout resource and a snippet of code you're using please? Also a link to the image you're loading could be very useful.
Thanks
 You should use fresco:actualImageScaleType if this is a SimpleDraweeView.

What is the image itself? Can you upload a screenshot of how it is rendered?
  Your link does not work.
 How do you determine that given byte array is a leak ?
 The picture doesn't work any more.
We also need more sample code how Fresco is used.
I'm closing this for now, but feel free to update with more details and we can re-open this issue.  è¯·ä¸è¦ä½¿ç”¨CloseableBitmap closeableBitmap = (CloseableBitmap)imageReference.clone().get();è¿™ä¸ªå†™æ³•æ˜¯é”™è¯¯çš„ã€‚å½“ä½ ä½¿ç”¨cloneçš„æ—¶å€™è¯·è®°å¾—æœ‰å¯¹è±¡æŒ‡å‘cloneã€‚åœ¨ä½ ä¸éœ€è¦bitmapçš„æ—¶å€™å†å…³é—­cloneå¯¹è±¡ã€‚ä¸ç„¶çš„è¯ï¼Œåœ¨ä½ è¿˜æ²¡å®Œå…¨ä½¿ç”¨bitmapå‰ï¼Œcloneå¯¹è±¡å°±å·²ç»è¢«å›žæ”¶äº†ã€‚ç„¶åŽå°±æœ‰äº† trying to use a recycled bitmapé”™è¯¯ã€‚
  From the `SimpleDraweeView` you can get the `DraweeHierarchy` and the current `Drawable`. If it's a `BitmapDrawable`, or any other Drawable implementation that publish the related image, you can get the related `Bitmap`. 
  duplicate of https://github.com/facebook/fresco/issues/681
  With the `ImagePipelineConfig` class you have the opportunity to inject an `ImageDecoder`. At the moment it's a class but not final so you could extend it and override the methods you need. At the moment we don't have immediate plan to abstract this step. 
  Hi,
can you provide us more information about that please? Have you applied what's here? http://frescolib.org/docs/rounded-corners-and-circles.html 

Thanks
 Your `viewAspectRatio` won't make any difference here. Can you post:
- the original image you are using
- a screenshot of what it looks like with this code?
  Please use our demo apps as references for the usage of Fresco with a ListView o RecyclerView.
  And also try again with 0.8.1.
  Please use our comparison app (https://github.com/facebook/fresco/tree/master/samples/comparison) as a reference for `Drawee` into a `RecyclerView`.
  Thanks for your comment. We'll add some more specific documentation about that. 
 I'm cleaning up very old issues. If this is still something you think is needed please comment and we can re-open.  How are you importing fresco library? Could you provide more information please?
Thanks
 Please try again with 0.8.1.

Are you in mainland China? From there, you need to use a VPN. 
  Bitmaps are never unpinned. They are recycled when they are not needed anymore.
  You don't have to cache instances of `DraweeHierarchy` on your own. Create hierarchies in `onCreateViewHolder` as in our sample app: https://github.com/facebook/fresco/blob/v0.8.0/samples/comparison/src/main/java/com/facebook/samples/comparison/adapters/FrescoAdapter.java#L44 and rely on views to cache them for you.
 When placeholders appear, do actual images show up after a while ?
 This sounds like onAttach/onDetach is not called correctly.

What is your holder.mImage? Is it a SimpleDraweeView or something else? 
  Avoiding the copy will require some changes to the Fresco code. The easiest way todo that would be to change this method: https://github.com/facebook/fresco/blob/v0.8.0/imagepipeline/src/main/java/com/facebook/imagepipeline/request/BasePostprocessor.java#L47 to accept CloseableReference<Bitmap> instead of Bitmap and override it in your subclass. When you don't want to modify the bitmap you can simply return input reference (cloned).
 If you don't mind creating new bitmap then you can simply copy pixels like here: https://github.com/facebook/fresco/blob/v0.8.0/imagepipeline/src/main/java/com/facebook/imagepipeline/request/BasePostprocessor.java#L79
 I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.  Have a look at our documentation: http://frescolib.org/docs/index.html
  Can you share full stack trace ?
 This is the cause:
10-22 20:14:44.924: E/AndroidRuntime(13607): Caused by: java.lang.NoClassDefFoundError: com.facebook.drawee.R$styleable

You did not list any resource files. How did you add Fresco to your project ? Did you follow http://frescolib.org/docs/index.html#eclipse-adt ?
 @hejie: are you an eclipse user as well ? Did you add res files to your eclipse project as well ?
 Do you still experience these issues with newer versions of Fresco?
 I assume that the problem has been resolved. Please let us know if you're still experiencing this issue.
  How big is your failure image ? Is it a Bitmap ?
 Does it always happen exactly when you set a failure image? or randomly at different spots in your app?

If Fresco is causing OOMs, the most common cause of this is using very large images and not [resizing](http://frescolib.org/docs/resizing-rotating.html#resizing) them.
  Interesting - there is no DalvikBitmapFactory in version 0.8.0 anymore. I am able to reproduce though.
 we'll do new release
 Please try v0.8.1.
  fresco:roundWithOverlayColor="@color/translucent"
  You can follow changes between versions here: https://github.com/facebook/fresco/releases
  Do you create controllers or manipulate drawee components on non-ui thread ?
 We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  This is taken care of. DraweeView will notify ImagePipeline whenever it is detached from window and it will cancel the request.
  Thank you for reporting.
 If the images are downloaded from an endpoint that is under your control. This issue could be avoided if HTTPS is used instead of HTTP.

If using HTTPS and the request is served by a captive portal instead of the actual endpoint, then the SSL certificate checks should fail and the image would fail to load.  English documentation should be already up to date: http://frescolib.org/docs/index.html.
 Filed a pull request with the Korean doc owners. Please report issues with the Korean docs to the [Korean repository](https://github.com/recrack/fresco-docs-kr).
  Does this cause a crash ? Is there anything else in the logcat ? What phone and os version do you use to reproduce the issue ?
 This may be an issue loading libraries depended on by AnimatedDrawable - either Fresco's native libraries (libimagepipeline.so et al) or nineoldandroids. Are you excluding nineoldandroids in your build.gradle file anywhere? Can you show us the file?
 @droidekas Do you still have the problem with version 0.10.0? Can you provide us the fresco dependencies you're using?
Thanks
 Since there has been no response, I assume this is fixed.  I tried to update to the newest 0.8.0 version but I got following error:

> Could not find fbcore.jar (com.facebook.fresco:fbcore:0.8.0).
>   Searched in the following locations:
>       https://jcenter.bintray.com/com/facebook/fresco/fbcore/0.8.0/fbcore-0.8.0.jar

https://jcenter.bintray.com/com/facebook/fresco/fbcore/0.7.0/
https://jcenter.bintray.com/com/facebook/fresco/fbcore/0.8.0/
 The problem seems to be the file extension. You're trying to download `fbcore-0.8.0.jar.` You should be downloading `fbcore-0.8.0.aar.`

How are the `repositories` and `dependencies` sections in your `build.gradle` set up?
 @tyronen my top-level build.gradle:

``` groovy
buildscript {
    repositories {
        jcenter()
        maven { url 'https://maven.fabric.io/public' }
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:1.3.1'

        ..........
    }
}

allprojects {
    repositories {
        jcenter()
        maven { url 'https://maven.fabric.io/public' }
        maven { url "https://jitpack.io" }
    }
}
```

And in my module's build.gradle I have 

``` groovy
dependencies {
...
compile 'com.facebook.fresco:fresco:0.8.0'
compile 'com.facebook.fresco:imagepipeline-okhttp:0.8.0'
...
}
```

I tried gradlew generateDebugSources --info/debug/stacktrace, but found no relevant info there (I can post full logs if needed)
 Clearing Gradle cache with gradle build --refresh-dependencies solved the problem.
 In Android Studio, execute Gradle task build --refresh-dependencies from right Gradle menu.
 No idea how to fix that, reopening....
 @JadenGu I had the problem with latest Gradle 2.8.
@ffelini try manually deleting $HOME/.gradle/caches folder, it should force Gradle to redownload all dependencies
 It could also be you have a local Maven repo which has an incorrect pom file.

If you have a $HOME/.m2/repository/com/facebook/fresco directory, delete it.
 If you are still experiencing problems, try again with v0.8.1.
  Could you show us a video ? I don't see flickering in our comparison app (http://frescolib.org/docs/sample-code.html#the-comparison-app), unless you mean fade-in animation as suggested by @KynoYang. Could you try reproducing it using the comparison app ?
  Can you try this: http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap ?
  Why do you need Bitmaps ? We keep them hidden so that we can deterministically reclaim memory. Have a look here: http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap
  have you tried any of the ideas here: http://stackoverflow.com/questions/4406524/how-to-set-shadow-to-a-view-in-android ?
  This is the method you can use to prefetch image to disk cache: https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipeline.java#L271. After that Drawee will fetch the image from disk cache instead of downloading it from network.
  Can you verify that Initialization runs in the process that uses SimpleDraweeView ? Logging to logcat after `Fresco.initialize` will be enough to verify that.
 Fresco.initialize(this) initializes caches and other components required by SimpleDraweeView within calling process. It should be called in every process that uses SimpleDraweeView.
  If you want to use your own config, you'll need to pass it when you create your own ImagePipelineFactory. The sequence here really matters. Can you please share your code, or steps how you do?

We expect the usage is
-   ImagePipelineConfig config = ImagePipelineConfig.newBuilder()
-       .setPlatformBitmapFactory(platformBitmapFactory)
-       .build();
-   ImagePipelineFactory factory = new ImagePipelineFactory(config);
-   ImagePipeline pipeline = factory.getImagePipeline();
  I doubt it is about the color. Uploaded photo is just huge, tell Fresco to make it smaller before decoding: http://frescolib.org/docs/resizing-rotating.html
  I am not sure I understand the question. Do you want SimpleDraweeView to scale image to be as high as screen and its width to be scaled up to preserve aspect ratio even if it would be wider than screen ?
 Do you know aspect ratio of images you want to display ? Setting the aspect ratio would help SimpleDraweeView position itself when layout happens and image is not decoded yet. If you don't know the aspect ratio upfront you might use ControllerListener (http://frescolib.org/docs/listening-download-events.html#usage) to wait for the final image and set the aspect ratio then.
  That won't work, it is for the controller only. We don't currently permit changing the hierarchy overlay dynamically. 
 No, do NOT use `setControllerOverlay`. This only to be used by controller.
At the moment we do not support overlay image to be changed. You can either build another hierarchy, or, If you are building your hierarchy programmatically, you can set SettableDrawable as overlay. SettableDrawable allows you to change the underlying drawable.
 Hi @sagartrehan. Accessing a drawable, and replacing it are two different things. This issue is not related to the problem you explained so let's keep track of hotspot issue in #912.
 Yes, like @ruifcardoso mentioned you can just update the hierarchy accordingly.  There is not API for that. Can you share more details about your use case ? What do you want to do ? Prevent redirections ? Collect some stats ?
 Closing since this issue is not prioritized to be implemented in the foreseeable future.
If this is a feature that you need, please consider contributing a pull request to Fresco!  Have you tried our comparison app? It uses local images as well. Please try it with your local images and tell us if the same thing happens.
Thanks
 Please, tell Fresco to resize (or even better, downsample) as well: http://frescolib.org/docs/resizing-rotating.html#resizing.

@wenxueguo107room: does it help ?
 Setting the width and height in xml only sets the display size, it doesn't resize the image itself.
  At the moment you should add the headers on the `HttpUrlConnectionNetworkFetcher` that is responsible to fetch the image. We're going to add this feature to the `ImageRequestBuilder`.
 @LiuDeng: unfortunately we don't have a timeline for this. This is not something we need internally so it's not high priority for us at the moment.
If you really need it feel free to submit a pull request - those are always welcome :)
 Yes, adding a OkHttp interceptor is the preferred way to do this. There is also a discussion going on in #1459 with alternative solutions, so just monitor the discussion in the PR.
  Could you provide more information please? Your question is not very clear.
Thanks
 è¯·ç”¨ä¸­æ–‡. æˆ‘ä»¬çœ‹ä¸æ‡‚ä½ çš„é—®é¢˜.å¸Œæœ›ä½ å¯ä»¥ç”¨ä¸­æ–‡è¯¦ç»†æè¿°ä½ çš„é—®é¢˜.
  Fresco doesn't listen to the network state and doesn't trigger a new request in that case. Is this what you mean? Could you provide us more information about this please?
 @whokilledtheelectricmonk please file a separate issue for that, and include an example of the source uri.
  Actually theres not reason for that but we planned to add this feature asap. 
Thanks
 Closing as this is enhancement is not prioritized to be implemented.
Still, please feel free to submit a pull request for any missing functionality.  Our Cache implementation for memory is already an LruCache so the problem is probably somewhere else. Please use our demo app as a reference on how to use the Drawee components into a ListView or RecyclerView. 
 Are you still experiencing this behaviour with 0.8.1?
  The java.lang.VerifyError happens if you have compiled against a different library than you are using at runtime. Could you provide please more information about that please?
  You can build your own Bitmap.Config in ImagePipelineConfig.Builder
  Due to design of android, fresco cannot get the images from another process. 
  if you mean by the file path for downloaded images in Bitmap cache/Disk cache, they don't have file path as they're not real file
 May I ask why do you need to get the local cache file path?
  please refer to fresco's sample apps and docs. It's cleared stated there.
  This is because you're not retaining any references to the CloseableBitmap, so it gets released when it is still in the ImageView. 

You really should use DraweeView to do this, otherwise the memory management is very complicated. 
  see #446 
  I want to use [this](http://imgur.com/jXWiywA) 9-patch from resources as a placeholder while my image is loading. The problem is that since version 0.7.0, Fresco isn't rendering it properly.

``` java
<FrameLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:fresco="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/black">

    <com.facebook.drawee.view.SimpleDraweeView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        fresco:placeholderImage="@drawable/ic_placeholder"
        fresco:placeholderImageScaleType="none"/>

</FrameLayout>
```

This layout looks differently in 0.6.1 and 0.7.0
![comparison](https://cloud.githubusercontent.com/assets/11048800/10353004/65981324-6d53-11e5-92af-4be04f29bf34.png)

I can provide sample project if needed.
 I think you need to use scaletype as fitXY for your placeholder image
  You can now use a `RetainingDataSourceSupplier` ff3bed97fb05e4d235e5e67009b1e26b7ad384b8 to control what happens.  Do you have user-permission for getting access gallery and camera for your app?
 http://frescolib.org/docs/datasources-datasubscribers.html#_
Check the caveat here
 Good, thanks.
 When I tried with your code and selected one static jpeg image from the Gallery, I get onNewResultImpl called with a good Bitmap returned. I doubt if it's because the device specific you're using.
 Can you attach the error log and see what the stack trace is
  which os version specific and device type of genymotion are you using?
 I used your code in SimpleDraweeView to get a network image. It's working properly. Where is the image resource? And can you share more code for using the DraweeView?
  I assume you use controll listener to watch the bitmap status. I assume you scroll your screen before all the visible images finish download. Otherwise it won't have the spikes thing you talk about. Is it the case? And also what is the size of your images?
 For those downloaded images, they could be stored in bitmap cache, or disk cache. I suspect the "spikes" you mention are the time spent in caching disk. Can you check that?
http://frescolib.org/docs/caching.html#_
 Or even might not in cache at all if it's running out of space. Then it's fetching from network again. Please see if this is the case for you.
  I'm cleaning up very old issues. If this is still something you think is needed please comment and we can re-open.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Fresco is mainly target in handling images. We don't have a plan to support WebM right now. 
 Encoded images are simply bytes. You could use Fresco's [encoded image ability](http://frescolib.org/docs/using-image-pipeline.html#skipping-the-decode) and then pass the bytes to a video decoder instead of an image decoder.
  Have you added Fresco to your project correctly? 

Also you'll want to add the custom namespace per http://frescolib.org/docs/getting-started.html#_ and use `fresco:placeholderImage` instead of `android:src`
 How is the problem coming because of that attribute? 

Can you verify through logs that Fresco.initialize is getting called before this crash? 
  Could you give the image url and a screenshot of the problem please? 

What do you mean by "it should autofill its height"?
  What happens to the other pictures? Nothing is ever shown? Do they fail? 

Generally using a scrollview is a bad idea as you will retain all the images in memory. Why can't you just use a pure listview for your needs?
  @erdizz , thank you very much for fixing this!

Funny how I identified the same race condition in [AbstractDraweeController](https://github.com/facebook/fresco/blob/0f3d52318631f2125e080d2a19f6fa13a31efb31/drawee/src/main/java/com/facebook/drawee/controller/AbstractDraweeController.java#L414), yet the same thing slipped elsewhere in the codebase.

Perhaps we should do a quick check whether `isFinished` is called too late on other places too. @tyronen , could you please file a task for that?
 @facebook-github-bot shipit
  what do you mean? There is a single assets folder per apk. 
 Fresco doesn't have the ability to do this for you, sorry. 
  The problem is that your Executor doesn't do anything except make a log. Apart from that you just want to follow the instructions on http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap, which you mostly seem to have done
 Which callback method is that? 
 Yeah, that is because your executor ignores the Runnable that is passed to it. 
 You need to call `command.run()`. I also suggest not creating a new executor for every request. 
  Yeah you should use the instructions from the link that @ouattararomuald posted. 
  Since Fresco 0.10.0 the OkHttp version being used is 2.7.4 (or 3.0.1 if you switch to the OkHttp 3 module). Let us know if the problem still occurs but I don't think it should.
  The zoomable library is not under the same BSD license as the rest of Fresco and therefore can't be included in the same download. Right now, I'm afraid that does mean downloading the source.
  Please see http://frescolib.org/docs/multiple-apks.html#_.
  You don't have to directly set the height and width of your image. You set them for your View, usually in XML as for any Android view. Fresco scales your image to match.

If the image is much larger than the view, and you can't get a smaller image, then you should use resizing as @yamateh says.
  Don't use `android:scaleType`.

However, it's not clear to me from your image what the problem is - the left image looks like it has indeed be center-cropped. Can you give us examples of what you are trying to see and what you are actually seeing?
  We need more details than this.
- How often do you get these OOMs?
- Does it happen consistently?
- What size of image are you displaying? Are you resizing or downsampling them?
- What format of image is it (jpeg, png, gif)?
 Closing due to lack of updates and not enough available information to investigate further.  We're looking at adding this functionality before too long. 
 This will be in the next release. 
  Code licensed under our sample license may be used in closed source applications if itâ€™s only for testing and evaluation purposes. It should not be shipped in a commercial application.
  Can you tell us what version of Android and what device you are using?
 Hi!
"Finalized without closing" indicates an issue, but the image should still be displayed properly, and the resources should still be cleaned up properly (just later than we would like to). Is that not the case? I mean, is the only thing that bothers you this logcat line, or do you actually have some issues with displaying images? 

Are those GIFs animated? Also, can you provide some more context on how you use Fresco? XML, code, etc.
 @crianzy are you using a RecyclerView?
 Seems like there's a known issue where Android doesn't call `onDetachedFromWindow()` in some cases:

https://code.google.com/p/android/issues/detail?id=5708

This is the only situation where this would manifest. As @plamenko said, this isn't a bug, the objects just get cleaned up a bit later. Closing for now because there's not much we can do about it.  The Comparison app uses that feature. It's as easy as what described here.

http://frescolib.org/docs/progress-bars.html#_
 I wouldn't create anything into the draw() method that should just "draw" what related to the current position of the ProgressBar. The easiest way, but not the best in terms of performance, is to manage the current position into the onLevelChange() triggering the invalidation of the View accordingly. 
  We're getting a 404 with the stacktrace link you reported. 
 Please double check your NDK configuration. The ndk_build tool in not in the classpath as shown here.

Caused by: java.io.IOException: Cannot run program "ndk-build" (in directory "/Users/yohannarizk/code/stuff/lib/fresco/imagepipeline"): error=2, No such file or directory
at net.rubygrapefruit.platform.internal.DefaultProcessLauncher.start(DefaultProcessLauncher.java:25)
... 4 more
Caused by: java.io.IOException: error=2, No such file or directory
... 5 more
  Could you provide us some more information please? Are you using Drawee? If yes how are you instantiating them? From layout or from code? 
 The JIT code cache full problem seems to be completely unrelated to the image loading. Anyway I remind you that the Bitmap provided by the BaseBitmapDataSubscriber  to this method is only guaranteed to be around for the lifespan of the callback method. As JavaDoc says the framework will free the bitmap's memory after this method has completed. I suggest to use the BaseDataSubscriber instead and manage the returned CloseableImage as needed. 
 As @massimocarli said, this is not likely to be an issue with Fresco. But you can verify this. Can you comment Fresco out of your app and try it again? Do you then get the same problem?
  This is usually due to an invalid image. Have you tested the app with different Android version? Does it happen always with the same images? 
 Can you show us the image in question?
  A simple test is to use the images that are not working with our demo applications. Can you please do that and tell us if it happens again? Better if tested with different version of the Android platform. 
 Please show us the specific images that do not load.
  We have tried the use case and everything is fine. Could you provide other details of the problem please? Are you using the Drawee in the layout document or instantiate directly in the code?
 I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.

As another thought, these properties can be set via XML, either in the layout file or as part of a style.  If you just want a Bitmap, we can get it, but it is not recommended: http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap

You can call setImageURI as often as you want - Fresco will display the image in the last call.
  Please use our demo apps as a reference and be sure to resize the images before using them. 
 http://frescolib.org/docs/resizing-rotating.html#_ provides instructions on doing this.
  Thanks for the note. We're working to integrate the callerContext into the documentation. 
 Hi @aphexcx, the caller context can be anything that you like. It's meant to allow you to pass information down the chain to your `RequestListener` or `ControllerListener`.

Applications might store metadata about the object that is helpful for their logging or error triage. E.g. the name of the current fragment.
  Fresco doesn't have such a method I'm afraid. 

You can probably use the code provided by @mkrcpp in #603 to get the file you want, and then just save that to the SD card. 
  What is the width of your layout? 431 is quite small so perhaps the image is having to be upscaled horizontally?
 Android has a limit of 4k \* 4k on images, so the height of your image is too great. You need to resize the image to make sure it fits within Android's limits. 
 Hi @caoyunxuan07,

The default `MAX_BITMAP_SIZE` that Fresco is using is 2048px, as this is the limit that some older devices can process.

The pull-request https://github.com/facebook/fresco/pull/1461 (thanks @kunny) has made this limit configurable such that you can override it for a image request. This will be included in the next release 0.14.0 that we hope to ship very soon.
  Could you please provide us more information about the problem? Does it appear on different type of device, emulator or it always happen to you? I've just created a sample application to test the component with the picture you sent us and I cannot reproduce the problem. I've tested it with a Samsung S5 (Lollipop) and Emulator with Kitkat. 
 Also with this image I cannot reproduce the problem. Are there other components into the same layout? Are you managing the SimpleDraweeView also from code?

![issue_605](https://cloud.githubusercontent.com/assets/235695/9864339/657ff748-5afd-11e5-82b4-6c841ba71dc7.png)
 Another questions: are there different resolutions for the same image? Into which qualification folder are you using it? 
 OK, got it. I've put the image into the /res/drawable-xhdpi and I got the problem you mentioned. The problem is even worse if we put the image into the /res/drawable-xxhdpi. 
To fix your problem you could try to use a placeholderImageScaleType like in this case:

```
<com.facebook.drawee.view.SimpleDraweeView
    android:id="@+id/image"
    android:layout_width="96dp"
    android:layout_height="96dp"
    android:padding="16dp"
    fresco:placeholderImage="@drawable/_emergency_contact"
    fresco:placeholderImageScaleType="fitCenter"
    fresco:roundAsCircle="true"/>
```
 I know this is strange but this is working as intended.

This is mentioned in the documentation at rounding: http://frescolib.org/docs/rounded-corners-and-circles.html

> "Due to a limitation of Android's BitmapShader, if the image doesn't fully cover the view, instead of drawing nothing, edges are repeated. One workaround is to use a different scale type (e.g. centerCrop) that ensures that the whole view is covered."

This is what "edges are repeated" means. If the view is bigger than the placeholder image the edges will repeat. We couldn't find a better way to solve this (the other solution is to repeat the whole image) and we should publish a blog post about how rounding works. If anyone has a better idea we're open to it :)

There are two workarounds that you can do:
1. Use OVERLAY_COLOR mode. This works perfectly if your background is a solid color. This doesn't have any limitation and the performance is also good.
2. If you can't use OVERLAY_COLOR then add 1px invisible border to your image (that way the invisible border is the one that gets repeated).
 Or you can just add 1px transparent border to your image and then transparent pixels are going to be repeated (i.e. it will look correct). And I mean the image file (png) has to be saved with this transparent 1px border.
  This is an Exception we throw when the number/memory of Bitmap allocated exceed the values configured. Could you please add more information to the possible question? 
 The use case is similar to our demo apps. Please use those apps as reference for your application. 
  The new APIs are for seeing whether an image is in cache. The method for getting an image from disk cache is the same as before - please see the documentation here: http://frescolib.org/docs/datasources-datasubscribers.html#_
 Looks reasonable. But you don't need the `isImageDownloaded` method as there is already `ImagePipeline.isinDiskCache(Uri uri)` which does the same thing. 

Also, File IO is slow so be sure to do this on a background thread. 
  Fresco does not support this out of the box. You could write a NetworkFetcher that enabled this functionality though. Just check what kind of connection the phone has before sending the download request for the image. 
  What version are you using? 
 What images is your app loading? How large are they? Are you resizing?
 How are you attaching each image to a view. Are you using SimpleDraweeViews with the URI set to the file path on sdcard? This would be the recommended approach.

Or are you using ImagePipeline to load everything at once and then placing them in your child views?
  Duplicate of #22 
  `/system/lib/libjpeg.so` is not used by JpegTranscoder itself, it is used by components like BitmapFactory. Can you tell me what indicates that the crash is related to JpegTranscoder ?
 I don't know yet. Can you provide more information what you are doing ? Fresco does not use inBitmap prior to KK so I assume you are decoding images on your own, am I right ? Are you reusing Bitmaps maintained by Fresco ?
 I am confused now. You don't use Fresco but open an issue blaming JpegTranscoder ? Hm :)

Make sure you don't pass recycled bitmaps to BitmapFactory. Make sure the jpeg is a valid jpeg and it ends with EOI tag.
  duplicate of #597 
  I suspect this is because you need to provide a drawable resource id for the pressed state overlay image, rather that a color resource id. 
  Resizing generally does it.
  I think this may be an issue with the upgrade to Gradle 2.6. Investigating.
  What Eric said.

Also, you don't always need to know the size of the image. If it's not too large, you can simply set it into your ListView using standard Android layout parameters. Except `wrap_content,` which isn't supported except as Eric described above.

If you really need the size, you can set a [controller listener](http://frescolib.org/docs/listening-download-events.html#_) and examine the `ImageInfo` object passed in; it will tell you the size.
  How large are the images? We have had problems if they are very large.
 Yes this is a confirmed issue - downsampling cannot yet be used for large images.
  Your logs indicate that your image is 18 MB before being resized. Resizing can handle that; downsampling can't right now. Since it is a jpeg I'd recommend turning off downsampling.
 The exact size will vary by device. We don't enable it by default yet because of this issue.
 The limit is because, on Android 4.x and below, we load the entire encoded image into memory before decoding it. This is necessary in order to put the decoded image into ashmem. If the encoded images are small, this is not a problem, but you can run into memory problems on larger images and smaller devices.

Resizing avoids this by using C++ code to resize the encoded image in a separate, slower step before decoding it. So we have a speed vs memory safety tradeoff between downsampling and resizing. 
  Please run Gradle with the --debug option and see what the output of ndk-build is.

Have you installed the Android NDK? and set it in your $HOME/.gradle/gradle.properties file?
  TooManyBitmapsException happens when you've filled up the available memory with visible bitmaps. If you're giving yourself a lot of extra screen space for layout and filling it with bitmaps, that would explain it.

Duplicate requests are ignored if there is already a request in-flight.

If memory gets full, cache entries will be evicted _if_ there are no references to them - that is, views hosting said images. It sounds like in your case there are.
  @tbruceyu, thank you very much for this investigation, we'll investigate it further.
Can you please tell us how did you use the app? E.g. scrolling news feed, navigating to timeline, browsing photos etc. This will help us identify whether the issue is in some of the app components (e.g. not resizing local images when we should) or there is a flaw in Fresco memory management. Thanks!
 Going to treat as a duplicate of #574 
  This is what prefetching means. You can find more info on the link @tbruceyu provided.
  You are absolutely right in that this should not happen. We have a logic in place that should prevent that from happening, but there may be a bug.
Can you provide some more information please?
- How/where do you initialize Fresco?
- What do you mean by refreshing the listview? Do you mean Adapter.dataSetChanged or something else?
- Can you please provide a verbose logcat: `adb logcat -v threadtime | grep -iE 'LoggingListener|AbstractDraweeController'`
 This ought to be blocked by the `EncodedMemoryCacheMultiplexProducer`.

We're cleaning up long-untouched issues so I'm closing this one.

If you think this is still an issue, feel free to comment and we can re-open.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 @tbruceyu thank you for this pull request!
I labeled it as `please-change` as I'd like to discuss whether this is a necessary or even a desirable change. If you strongly feel that `GenericDraweeHierarchyBuilder.setPlaceholderImage(null, someScaleType)` is not a convenient solution, then we can consider doing this, but it would be better to do it in `GenericDraweeHierarchyBuilder`.
Also, please keep in mind that this is a breaking change as we are now changing the default behavior someone might have relied on.
 Awesome! Btw, please do not hesitate to send more pull-requests!
  ZoomableDraweeView uses a sample license rather than the BSD license used by the core library, so unfortunately we cannot include it in the same library. You are free to compile it yourself, as long as  you abide by the terms of the license.
  Can you use a content provider URI to access them?
  Can you give us some more information?
- Do you see the image, and then it flashes to placeholder and then back to image again?
- Do you know what triggers this flash?
- How many images do you have visible on the screen?
 You can [setFadeDuration](http://frescolib.org/javadoc/reference/com/facebook/drawee/generic/GenericDraweeHierarchyBuilder.html#setFadeDuration%28int%29) to 0 to turn off the animation. Reaping.
  This has been fixed in f1e1f24de3d65aa06d51f7dde92651a3cb29ed76  Are you using a ScrollView? Don't.

If not, can you give us more details? How many webps do you have and how many are on-screen at a time? Are they animated?
  Is this a debug or release build?
Are you using ProGuard?
Can we see where you include Fresco in your build.gradle?
  I wonder if the actual file downloaded is some HTML response instead of the actual image file. What do you get if you curl or wget your uri?
  Correct. Separate hierarchy per view.
  I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.  You can construct a resource ImageRequest with the [ImageRequestBuilder.newBuilderWithResourceId](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/request/ImageRequestBuilder.html#newBuilderWithResourceId%28int%29) method.
  Hi @eresid, very soon we'll release a new version of Fresco library with the first step toward the complete modularization you suggested. The first step will be static webp images. 
  How many images do you have loaded on-screen? 

Could you attach a hprof file? See the [instructions](https://developer.android.com/tools/debugging/debugging-memory.html#ViewHeap) on how to generate them.
 @mheras: Your heap dump shows a total memory footprint of 56 MB. I'm going to assume this was on a device with a 64 MB heap, so the OOM risk is high.

On such a device, the bitmap cache is by default limited to 16 MB. If your app is finding that hard, there are two possible solutions:

1) Set `android:largeHeap=true` in your app's manifest.
2) Adjust the size of the cache along the lines @sensen suggested. His code limits the cache to just one entry on Lollipop, which is probably not what you want. You can try changing the code of `getMaxCacheSize` instead to give you a smaller cache for the 64MB devices - perhaps 8MB would work better for you, rather than the 16MB we use by default.

I notice also you seem to be using Picasso and Fresco simultaneously. Each of these libraries operates its own memory cache; putting both together on a low-end device is going to be hard. Do you need both? Are there features Picasso provides your app that Fresco does not?
 @ThomasWang2014: your issue should be fixed in v0.8.0.
 @mheras we do do this. Your app's problem is this:

Fresco uses 1/4 of the heap size. If this is filled up, images are swapped out but remain on disk.
Picasso uses 1/7 of the heap size. If this is filled up, images are swapped out but remain on disk.

The rest of your app is thus limited to around 60% of the normal heap. If your app ever needs more than that, it will OOM.

You either have to reduce Picasso or Fresco's memory footprint by reducing the cache size, OR reduce the rest of your app's footprint.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  The one with the space shouldn't work, but the one with %20 should.

We will probably have to do something like this: http://stackoverflow.com/questions/26818553/filenotfoundexception-for-site-with-tilde-when-using-httpurlconnection.
 Thanks @andreidiaconu 
  This is coming soon.
 We are actively working on this, should be available soon.
 Newer versions now support this, just add your dependency as needed, see http://frescolib.org/docs/
  Can you show us the code where you are making the image request?
 Hm. This looks correct. 

You mentioned that the images are full-sized - does that mean full-screen? These take up a lot of space and it could simply be that the cache is filling up after just one or two images and they are getting evicted.

This can't be determined from the logs, but we do have a way of getting it. You have to declare an object implementing the [ImageCacheStatsTracker](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/cache/ImageCacheStatsTracker.html) interface. [Configure the image pipeline](http://frescolib.org/docs/configure-image-pipeline.html#_) with it. That will allow you to figure out what your cache hit rate is.
 One thing that I noticed is the implementation of `getPostprocessorCacheKey`. That cache key should only depend on the parameters of the postprocessor, not on the parameters of the image request such as url (as those are already taken into account). If your postprocessor doesn't have any parameters (e.g. blur radius) then you can just use a constant key:

```
        private final SimpleCacheKey mKey = new SimpleCacheKey("Blur");

        @Override
        public CacheKey getPostprocessorCacheKey() {
            return mKey;
        }
```

Can you please provide a logcat output: `adb logcat -v threadtime | grep -iE 'LoggingListener|AbstractDraweeController'`
I am particularly interested in what happens with the `BitmapMemoryCacheProducer` and `PostprocessedBitmapMemoryCacheProducer` and how the cache key for each looks like.
 Hi sorry for the delay in responding. We've added new [instructions for logging](http://frescolib.org/docs/troubleshooting.html#using-the-logcat); can you let us know what that outputs?
 Ok this log is helpful. If you grep specifically for RequestLoggingListener the picture becomes clearer. This class logs an `onProducerFinishWithSuccess` message for each step of the pipeline, and then an `onRequestSuccess` at the end.

Normally if a post-processed image is found in cache, the only producer you'd hit would be `PostprocessedBitmapMemoryCacheProducer`. If that cache misses, you then hit `BitmapMemoryCacheGetProducer` for the original image in cache, and `PostprocessorProducer` that postprocesses it.

And, indeed, I see a large number of calls to `PostprocessorProducer`, and it looks like your postproc is pretty expensive, taking as much as 500 ms.

What seems to be happening is that your requests are getting cancelled before the postprocessing is complete. I see several `onRequestCancellation` messages that occur _before_ the `onProducerFinishWithSuccess` for the postprocessor producer. In that case, the postprocessed image doesn't get cached.

And there appear to be a lot of cancellations. There are 14 image requests in the log and 12 of them are cancelled. I'm also seeing pretty short intervals - 20 ms or less between request submit and cancellation. In fact, so many image requests were outstanding that the thread pool that does the postprocesses would have blocked up, making all of them take longer. 

DraweeViews cancel when their `onStartTemporaryDetach` or `onDetachedFromWindow` is called without a matching `onFinishTemporaryDetach` or `onAttachedToWindow` in the same frame. I'm not familiar with FragmentStatePagerAdapter, but it could be it's aggressively detaching the views while toggling back and forth. 

Or were you just rapidly scrolling through views when generating this log? Do you still see this effect if you toggle much more slowly, eg. allowing at least one second back and forth? 

On our end, two options come to mind. We could either 1) make postprocessing interruptible, to not waste CPU on a cancelled request, or 2) cache the output even of a cancelled postproc request. We'll need to think about this.

Unfortunately I can't promise speedy implementation of either option, but thanks at least for your patience in getting us this far - we seldom get such detailed bug reports :)
 Not exactly.
- The postprocessed images are only in the bitmap cache because the postprocessing happens after they are decoded. That's what gives you a Bitmap, instead of a byte[], to work with in the postprocessor.
- They take up more space because we store _both_ images - the original and the postprocessed - in the cache. So cache will fill up sooner when you are postprocessing. You can omit the putting the postprocessed image in cache, but you can't omit putting the original.

I suppose we could take a closer look at what is happening at eviction.
 There's no straightforward solution to this, but we've discussed internally and would like to provide some suggestions.

First, have a look at our sample [`ScalingBlurPostprocessor`](https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/postprocessor/ScalingBlurPostprocessor.java). This is much, much faster than the normal blur processor and produces almost indistinguishable results.

Second, in your custom post processor, you can evict the original image from memory cache. This will help keep more blurred images in the cache. Simply call `imagePipeline.evictFromMemoryCache(uri)` in your `process()` method.

Third, if you want to get fancy and cache the blurred image to disk cache, you can write a custom decoder (there are examples in the repo) that does the blurring implicitly. This will cause the original image to be thrown away and only the blurred one to be cached in both memory and disk caches.

I'll close this now as it's unlikely that we'll make any changes within the library to address it.

CC @oprisnik   Are you located in mainland China? There are occasional issues connecting to jcenter and Maven Central. See http://fresco-cn.org/docs/compile-in-android-studio.html#_ (in Chinese).

Please file a new issue if you are experiencing this problem outside China.
  Do you specify ResizeOptions? If not, each of these images requires a bitmap of the screen size, even though they are 9 times smaller (I.e. your app is using 9x more memory on images than it should).

Without some more context it is hard to tell.
 For PNGs you need to [enable downsampling](http://frescolib.org/docs/resizing-rotating.html#downsampling) when specifying ResizeOptions.
  I was thinking the same as @desmond1121 . I wonder whether this is a misspelled path issue, or something else, such as permission issue.
 Just for a test, can you try to open a plain old Java FileInputStream with that path?
 Alright, this doesn't seem to be related to Fresco, hence closing it.
  What is `deviceSize`? How many images at once can be displayed? Ideally, you should never have more images displayed than to cover the device screen once. That means if you are dealing with full-screen images, you should only ever display one (or two).
 SimpleDraweeView should clear the resources automatically once it gets off the screen. However if the container is misbehaving and is not detaching the invisible children (or calling setVisible(false) on them) Drawee won't be able to tell that is not visible and will not release the resources. What is the container of DraweeView? Is it ViewPager? How many pages are there?
 Do not use ScrollViews with Fresco.
  Is the image animated?
 Yeah, this is a known limitation. Please see our documentation for [Rounding](http://frescolib.org/docs/rounded-corners-and-circles.html#_), there are more explanations and alternatives.
  This looks identical to #429. Make sure the libmemchunk.so file is in the armeabi-v7a folder, not armeabi, when installing on an ARM v7 device. All phones and most tablets running Android 4.0 or later are ARM v7.
  Thanks for reporting this. Sounds like a bug, we are investigating.
 Fixed in v0.8.0
  Is there really no logcat output related to your app crash at all?
 Ok this is weird. The crash indicates that it is calling Bitmap.getByteCount from BitmapUtil.getSizeInBytes. But that method [is not supposed to be called on Gingerbread](https://github.com/facebook/fresco/blob/e58561de5b3ca613d2647d4d8cc55c344d5cc579/imagepipeline/src/main/java/com/facebook/imageutils/BitmapUtil.java#L48).

What are the minSdkVersion and targetSdkVersion in your app? Does this happen on a physical Gingerbread device, or just the emulator?
 Are you using Fresco 0.7.0?
I am not sure now if the logcat you posted earlier is actually the crash. There is usually a stack trace there somewhere. Can you follow our [logging instructions](http://frescolib.org/docs/troubleshooting.html#using-the-logcat)?
  You should make per-architecture builds. Please read the documentation: http://frescolib.org/docs/multiple-apks.html#_
  You are trying to allocate an 8MB Bitmap when there is only 2MB memory left. This usually happens because there are too many images displayed at once and/or the images are not properly resized. Please see [Resizing](http://frescolib.org/docs/resizing-rotating.html#_).
If you provide us some more context about the app and the containers/layouts that host the DraweeView we may be able to be more specific.
 PNG files can't be resized. You have to use downsampling instead. Follow the instructions at http://frescolib.org/docs/resizing-rotating.html#downsampling.
 Downsampling does the job better, actually - it's faster and can give you a smaller size than resizing can.
  No need to extend `SimpleDraweeView` to make it square, simply add the following XML properties: `fresco:viewAspectRatio="1"` and `android:layout_height="wrap_content"`.
As for the repeated edges, this is a known limitation of Android. Please see the Caveats section of [Rounded Corners and Circles](http://frescolib.org/docs/rounded-corners-and-circles.html#_).
  Use `abiFilter` or `abiFilters`. More info here: #458 and here: http://tools.android.com/tech-docs/new-build-system/tips.
 I am not suggesting using multiple apks. I am telling you that you can use `abiFilters` to select abis for universal apk :) Example for x86_64 and x86 abis:

```
apply plugin: 'com.android.application'

dependencies {
    compile project(':drawee-backends:drawee-pipeline')
}

android {
    compileSdkVersion 21
    buildToolsVersion '21.1.2'
    defaultConfig {
        applicationId "com.facebook.samples.demo"
        minSdkVersion 9
        targetSdkVersion 21
        versionCode 1
        versionName "${VERSION_NAME}"

        testApplicationId "com.facebook.samples.demo.test"
        testInstrumentationRunner "android.test.InstrumentationTestRunner"

        ndk {
            abiFilters 'x86', 'x86_64'
        }
    }
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), '../../proguard-fresco.pro'
        }
    }

    lintOptions {
        warning 'InvalidPackage'
    }
}
```

I used this `build.gradle` file to build our demo app (https://github.com/facebook/fresco/tree/master/samples/demo):

```
./gradlew samples:demo:assembleRelease
```

After that I run following command to verify content of the apk:

```
unzip -l samples/demo/build/outputs/apk/demo-release-unsigned.apk
```

> Archive:  samples/demo/build/outputs/apk/demo-release-unsigned.apk
>  Length     Date   Time    Name
> 
> ---
> 
> ```
> 1992    08-19-15 20:06   AndroidManifest.xml
> 2388    08-19-15 20:06   res/layout/activity_main.xml
> 3122    08-19-15 20:05   res/mipmap-hdpi-v4/ic_launcher.png
> 1956    08-19-15 20:05   res/mipmap-mdpi-v4/ic_launcher.png
> 4366    08-19-15 20:05   res/mipmap-xhdpi-v4/ic_launcher.png
> 7007    08-19-15 20:05   res/mipmap-xxhdpi-v4/ic_launcher.png
> 3488    08-19-15 20:05   resources.arsc
> 403912  08-19-15 20:06   classes.dex
> 5288    08-19-15 20:05   lib/x86/libbitmaps.so
> 157356  08-19-15 20:05   lib/x86/libgifimage.so
> 562556  08-19-15 20:05   lib/x86/libimagepipeline.so
> 5364    08-19-15 20:05   lib/x86/libmemchunk.so
> 234752  08-19-15 20:05   lib/x86/libwebp.so
> 140972  08-19-15 20:05   lib/x86/libwebpimage.so
> 5856    08-19-15 20:05   lib/x86_64/libbitmaps.so
> 498576  08-19-15 20:05   lib/x86_64/libgifimage.so
> 985424  08-19-15 20:05   lib/x86_64/libimagepipeline.so
> 5984    08-19-15 20:05   lib/x86_64/libmemchunk.so
> 259920  08-19-15 20:05   lib/x86_64/libwebp.so
> 482192  08-19-15 20:05   lib/x86_64/libwebpimage.so
> ```
> 
> ---
> 
>  3772471                   20 files
  This is not currently supported out of the box. 
 We've released Fresco v1.4.0, which includes a new implementation for animated WebPs.

You can create a Drawee controller with a listener and then specify the given frame with something like this:

```
Fresco.newDraweeControllerBuilder()
  .setImageRequest(imageRequest)
  .setControllerListener(
          new BaseControllerListener() {
              @Override
              public void onFinalImageSet(String id, @Nullable Object imageInfo, @Nullable Animatable animatable) {
                  if (animatable != null) {
                      AnimatedDrawable2 animatedDrawable = (AnimatedDrawable2) animatable;
                      animatedDrawable.jumpToFrame(targetFrameNumber);
                  }
              }
          })
  .build());
```  As far as I know, we haven't done any special testing with this particular layout. Do you have any problems with it or?
 We have not yet actually tested this, but I would expect the same rules to apply. You can freely lay out a Drawee using percents, but `wrap_content` will not work.
  What do you mean by maintaining aspect ratio? If you set the `FIT_CENTER` scale type, the aspect ratio should be preserved. Is that not the case?
What do you mean by not smooth? If you mean not animated, yeah, that's not implemented. The zoomable code provided here is only an example of how such functionality can be achieved with Fresco. You'd have to implement any zoomable functionality you desire yourself.
 Ah, this is not what aspect ratio means. Aspect ratio is the ratio between the width and the height. What you are looking for is scale factor that you can set with [setMaxScaleFactor](https://github.com/facebook/fresco/blob/c5e1d4cf2c081bf871f59f70cd02e4a68950ac41/samples/zoomable/src/main/java/com/facebook/samples/zoomable/DefaultZoomableController.java#L162).
  What happens exactly? Can you turn on verbose logging and call FLog.setMinimumLoggingLevel(FLog.VERBOSE) so we can look at what is going on?
 Oh wait - the image is 4.8MB? You must [resize](http://frescolib.org/docs/resizing-rotating.html#resizing) it, unless you are running on Android 5.0 or later.
  Please read our documentation [Using the Image Pipeline Directly](http://frescolib.org/docs/using-image-pipeline.html#_) and [DataSources and DataSubscribers](http://frescolib.org/docs/datasources-datasubscribers.html#_).

Do not access the disk cache directly, but submit the image request and subscribe your data subscriber as explained in the "get encoded image" example in the documentation.
  Is this related to the Fresco library?
 How do you measure native memory and which Android version do you use ?
  Thanks for reporting.

It seems that exception is thrown here: https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/drawable/RoundedBitmapDrawable.java#L61. According to the documentation Paint.Style.STROKE is available since API level 1 (http://developer.android.com/reference/android/graphics/Paint.Style.html). This looks suspicious.

Can you tell us which Android version do you run when you hit this issue ? What is the phone model ? Does it happen all the time or sporadically ?
 @EugineKidoz Is the problems till there?
Thanks
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  @tyronen could that be related to the media thumbnails?
 Unlikely. What are the layout width and height of your view?
 Fixed in v0.8.0
  Are you specifying the rounded corners?
 Yeah, rounding is the issue here, see http://frescolib.org/docs/troubleshooting.html  It's hard to tell without looking at the code. Can you please provide the implementation of your view?
  I see. It is most likely because android failed to load native library backing NativeMemoryChunk (libmemchunk.so). Are you able to reproduce this reliably ?
 Could you check what is the content of lib subdirectory of your's app directory under /data/ when this happens ?
 This is likely the same issue as #429. The solution is to make sure the .so files are in the correct directory. If it's low-end phones, they may need to be in armeabi, not armeabi-v7a.
 @shangcongrong This seems unrelated. The paths of the image to load should not affect the loading of `.so` files. Have you followed the instructions on http://frescolib.org/docs/index.html, http://frescolib.org/docs/getting-started.html and http://frescolib.org/docs/proguard.html? Do you see the same problem when building and running the sample apps in your local setup?
  Hi !

do you resize or downsample local images ? If not, can you check if that solves the issue ?
http://frescolib.org/docs/resizing-rotating.html
 Are you using DraweeView or are you submitting those image requests in some other way? 
 Are these PNG images? If so, use downsampling instead of resizing: http://frescolib.org/docs/resizing-rotating.html#downsampling
 No reply to multiple comments, reaping
  Yes. If you start another request for the same uri it will wait for the first one to be decoded (or downloaded if you specify different decode options) and after that both requests will share the result. Component that takes care of this is called MultiplexProducer (https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/MultiplexProducer.java)
  Fresco maintains bitmap cache and it's default size limit is equal to 1/4 of the heap size. Can you confirm that Bitmaps take more space than that ?
 Closing due to lack of updates.  How many different sizes of Bitmaps do your app use ? If there are not many we can use bitmap pool to trade allocations for memory consumption. I'll tell you how to configure it if pooling is applicable.
 Ok, let's tray this then:
1. Create PoolParams for bitmap pool (https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/PoolParams.java). Default PoolParams for bitmap pool is created here: https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/DefaultBitmapPoolParams.java#L48-L54 - you can use this code for reference. Soft cap is number of bytes that pool will try not to exceed (after hitting this limit bitmap pool will start dropping pooled bitmaps when a new one has to be allocated), hard cap is number of bytes that will not be exceeded ever (after hitting that limit bitmap allocations will fail). You can set soft = hard = max number of MB you want to use for bitmaps. Make this bigger than 1/4 of your heap size, because 1/4 is what bitmap cache keeps alive.
   <p> Now the important part - you need to specify bucket sizes (the 3rd param). For each bitmap size you need to specify how many additional bitmaps you want to keep alive for the purpose of future reusing. This is done by providing SparseIntArray that maps bitmap size (number of pixels) to number of extra instances. This is app specific and you should experiment with few configurations.
2. Create PoolFactory and pass PoolParams from 1) to its constructor
3. Use PoolFactory from 2) to create ImagePipelineConfig http://frescolib.org/docs/configure-image-pipeline.html
4. Initialize Fresco

I hope this helps reduce gcs. Let me know how it goes, I am happy to explain things in more details.
 You need to populate SparseIntArray with appropriate entries. The argument passed to constructor does not do that. This is example of code that configures another pool: https://github.com/facebook/fresco/blob/96d74f385b297f364db1f719dd6ee61fc380d0d4/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/DefaultByteArrayPoolParams.java#L41-L42 - if you used the same SparseIntArray then bitmap pool would store up to `DEFAULT_BUCKET_SIZE` bitmaps, each one having `DEFAULT_IO_BUFFER_SIZE` pixels. I hope this example helps.
 By the way, do you observe scroll perf issues when using Fresco to load local or network photos ? And what device do you use to reproduce ?
 You mean `System.gc()` cals ? Fresco does not use it apart from the sample app: https://github.com/facebook/fresco/search?utf8=%E2%9C%93&q=%22System.gc%28%29%22&type=Code

PoolParams setup looks fine. I'll try to set it up for our sample app, verify it works and share the code.

I also tried to scroll through a long grid of camera photos (on Nexus 5 running Lollipop). I could not see jitter and glitches. Any advices how to reproduce this ? I used our sample app (https://github.com/facebook/fresco/tree/master/samples/comparison) which displays 3 images in a row (on Nexus 5 each one is 371x371 px)
 Ok, I am able to reproduce significant gc pauses if I resize to 1500x1500 instead of 371x371 (1500x1500 corresponds to size=2250000).
 @bluef thanks, it is great to hear that ! Would you mind adding your app to the list on our main page ? (http://frescolib.org/ - look for "Who Uses Fresco?" and 'pull request' link). It is great to see that more and more production apps use Fresco :)
  @kexuejin : do I understand correctly that the issue happens only for local images, not for the ones that are downloaded ?

Also: does it happen on all versions of Android or is it Lollipop-only issue ?
 Do you use LeakCanary? Let me know if this might be related to #536

@saurabh0802chd @kexuejin @yychai : I would love to help here but I need more details. For start I need to know:
- sizes of decoded images and sizes of drawee views used to display them
- do you use resizing or downsampling (http://frescolib.org/docs/resizing-rotating.html)
- android version you use to reproduce this
- number of images on screen
 I see. Without resizing or downsampling Fresco will decode huge bitmap and that will cause gc issues. Specifying resize options will most likely solve the issue.
 No, at least not yet.
 Resizing should work. Use downsampling if PNGs.
  Fresco does not round bitmaps. Instead it uses RoundedButmapDrawable to draw it as rounded one to Canvas. If you need a rounded bitmap you have to create one on your own. You can use Canvas and code similar to this one: https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/drawable/RoundedBitmapDrawable.java#L157-L175
  Have a look at `evictFromDiskCache` and `clearDiskCaches` methods in `ImagePipeline` (https://github.com/facebook/fresco/blob/e58561de5b3ca613d2647d4d8cc55c344d5cc579/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipeline.java)
  Is your app allowed to write to external storage ? You might be required to specify WRITE_EXTERNAL_STORAGE permission in your manifest.

I am not sure whether you use the most appropriate directory for disk cache: those files are intended to be read by disk cache only and the format is an implementation detail of the cache. Besides, directory structure maintained by the cache as well as names of stored files do not look user friendly - it might look as if your app dumps a lot of trash to public picture directory.
 When you get a json response, like the one you posted above, which url do you pass to Fresco ? Is it https://awe-words-images.s3.amazonaws.com/uploads/Presence.jpg?AWSAccessKeyId=AKIAJBXK3JSJCOZW6Y6Q&Signature=f/3FwxWseAHpt7SVyNQS1oHzIU4%3D&Expires=1439240656 or https://awe-words-images.s3.amazonaws.com/uploads/Presence.jpg ? In case of the former one, are the params after question mark constant across app sessions for particular user ? Fresco will use entire url to compute a cache key and will treat https://awe-words-images.s3.amazonaws.com/uploads/Presence.jpg?a and https://awe-words-images.s3.amazonaws.com/uploads/Presence.jpg?b as two different images.
 Have a look at CacheKeyFactory and DefaultCacheKeyFactory (https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.java). You can set custom implementation using ImagePipelineConfig's builder.

Thanks !
  Can you turn on verbose logging (`com.facebook.common.logging.Flog. setMinimumLoggingLevel(Flog.VERBOSE)`) ? After that you should get detailed info in logcat on requests execution. With that we'll be able to see which step takes so much time, whether requests are properly cancelled as associated views are scrolled off the screen etc.
 Hm... Apparently we need some set up before we can get more interesting logs. Reuqest progress is reported by RequestLoggingListener(https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/listener/RequestLoggingListener.java). It is turned off by default and this is how you can turn it on: https://github.com/facebook/fresco/blob/920539d9443bc3979fbd838ecd64d3356b735ee0/samples/demo/src/main/java/com/facebook/samples/demo/MainActivity.java#L48-L54. Can you try this and paste logs logged by RequestLoggingListener ?
 I see 6 image requests (ids= 27, 28, 29, 30, 31 and 32) , all 6 got read images from disk cache. First 4 of them finished within the time you were collecting logs. Times it took for the requests to finish: 103ms, 172ms, 181ms and 311ms. Are you sure you experienced image loading lag ?

One thing to node: one of your images is quite big: 1520px x 1520px - it might be worth resizing it to match the size of the view that displays it.
 If you search for "onRequestSuccess" in the log you will find out how many ms each request needed to complete (elapsedTime). I see values below 200ms, which does not seem much. Maybe I do not understand what the 'lag' means here.

> Resize, how should I do this?

You can find out about resizing here: http://frescolib.org/docs/resizing-rotating.html

> Also, is it possible to do not reload images after scrolling back to them?

What do you mean ? Do you want placeholders instead of actual image if you scroll back to it ?
 Ok, I get it. Here is similar issue we had recently (#536). What helped there was disabling LeakCanary, please check if you are using it.

Apart from that, please resize images before displaying them. Instead of this:

``` java
holder.ivImage.setImageURI(Uri.parse(getItem(position).imageUrl));
```

do something like this:

``` java
ImageRequest request = ImageRequestBuilder.newBuilderWithSource(Uri.parse(getItem(position).imageUrl))
        .setResizeOption(new ResizeOptions(width_of_your_drawee_view, height_of_your_drawee_view))
        .build();
PipelineDraweeController controller = Fresco.newDraweeControllerBuilder()
    .setOldController(holder.ivImage.getController())
    .setImageRequest(request)
    .build();
holder.ivImage.setController(controller);
```

If those things do not help, please tell us know what phone do you use to reproduce this issue and what Android version it runs.
 Assuming the above response fixed the issue; file a new one if not.
  Do you know what allows oppo's album to load images that fast ?
 Reaping
  GenericDraweeHierarchy hierarchy = new GenericDraweeHierarchyBuilder(getResources())
                .setActualImageScaleType(ScalingUtils.ScaleType.CENTER_CROP)
                .setPlaceholderImage(getResources().getDrawable(R.color.transparent))
                .build();
mySimpleDraweeView.setHierarchy(hierarchy);
mySimpleDraweeView.setImageUri(yourImageUri);

Voila!
 Use this: https://github.com/facebook/fresco/blob/920539d9443bc3979fbd838ecd64d3356b735ee0/drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchyBuilder.java#L156-L158
 @KashanDanish , you could make a pull request :)
 This will be available in the next version of Fresco. 
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  Does it work if you add `compile 'com.facebook.fresco:fresco:0.6.0+'` to third party app gradle file ?
 Do you use your lib as a prebuilt aar ? If so, you'll also have to check in fresco prebuilt aars, as well as aars/jars for all of fresco's dependencies.

When you build a library gradle does not put dependencies inside your's library aar. Instead it will try to recursively bundle all dependencies together with your app. This is achieved either by analyzing associated pom.xml (1) or available projects (2).

Fresco is a good example here. Fresco is not a single aar, as you can see here: http://search.maven.org/#search%7Cga%7C1%7Cfresco.

(1) When you depend on fresco you depend on fresco.aar, but also on all aars and jars listed in this pom file: https://repo1.maven.org/maven2/com/facebook/fresco/fresco/0.6.1/fresco-0.6.1.pom. If you fetch your dependency from maven then gradle will recursively traverse pom files of all dependencies and fetch all aars/jars for you. In the end, when compiling project depending on Fresco, gradle will also bundle fbcore, drawee, imagepipeline, nineoldandroids, bolts and support library (and possibly more).

(2) Gradle can also automatically detect dependencies across your own projects. This is a `build.gradle` file for one of fresco sample apps: https://github.com/facebook/fresco/blob/master/samples/demo/build.gradle. When gradle sees

> compile project(':drawee-backends:drawee-pipeline')

it knows you depend on other project and it will make sure that all dependencies of `:drawee-backends:drawee-pipeline` end up in the app's apk.

Now, back to prebuilt aars/jars. With prebuilt jars you don't give gradle any clue what the dependencies are and you have to deal with them on your own. I do not know if it is possible to force gradle to put all library dependencies in the library's aar. Maybe it is, but this is not the standard way of dealing with deps. It seems that most reasonable thing to do is to use maven to distribute your library. Another option is to tell gradle it should depend on fresco.
  Do `bitmapReference.get().setHasAlpha(true);`
  Just a note: we do welcome external contributions :)
 AutoRotateDrawable already has this as an option: https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/drawable/AutoRotateDrawable.java#L30
  Are you sure that there is no stacktrace output in the logcat?
 @somatezyc , this issue has nothing to do with the issue #490. Furthermore, @michalgr did ask you some additional questions there, which you have not answered so far.

The cause of this issue is related to a bug we are aware of, where a stream was not properly closed. This has been fixed and we will make a push some time today.
 Fixed in 0.6.1.
  It makes little sense to have multiple instances of Fresco (because each would have their own memory cache, etc. which would be suboptimal). That's why it is a singleton.
Application can be composed of several independent modules that need not to know about each other. Several of those modules may require imaging functionality and for the reasons explained above, they should not have their own instance of Fresco, but should use the one and only instance configured on the app level. Another reason why configuration should not happen in any of those submodules is because they are not aware of the bigger scheme under which they operate.

For example, your app may have a chat section where there is a profile picture next to each message, and no other pictures than that. Then you might have another news-feed like section where there are stories accompanied by the authors' profile pictures, but may also contain the actual pictures that may be big. If the Fresco initialization is being done in the chat section, one might conclude that the imaging library should be configured with a small memory cache, because there is no need to keep that many profile pictures in the memory cache and they are all reasonably small. If each section has their own instance of Fresco, then the same profile picture might be contained twice, each in a separate memory cache. The only way to properly solve this is to do the initialization/configuration on the application level.

That being said, the library you are referring to should really not initialize Fresco. Please let me know if that answers your question. If I actually misunderstood your question, it would help if you  provide some code examples of the API that you would prefer.
  Duplicate of #80 
  Thanks for reporting the issue, I'll try to help. There are few question that might help us find out what is going on:
1. How did you import Fresco ? Do you include Fresco as aar or do you compile it from source ?
2. Which task do you run to compile your app ? Is it release build or debug build ?
3. Is proguard run as a step in the compilation process ?
4. Can you share gradle's output ? It might help us identify build steps that take the most of time.
 @alexli0707, @vipulasri Do you still have this problem with the 0.9.0?

Thanks
 Closing due to lack of progress and or updates during the last 2 years.  Fresco will evict old entries from disk cache to free space for new images automatically before creating new file, you don't have to do anything.

Your NullPointerException comes from these lines: https://github.com/facebook/fresco/blob/96d74f385b297f364db1f719dd6ee61fc380d0d4/imagepipeline/src/main/java/com/facebook/cache/disk/DiskCacheConfig.java#L42-L43 - you have to set base directory name (prefix of cache directory name) and base directory path suplier (supplier of File object represetning directory where cache directory should be created). Use this as a reference: https://github.com/facebook/fresco/blob/e58561de5b3ca613d2647d4d8cc55c344d5cc579/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipelineConfig.java#L159-L166
  Fixed in 0.6.1
  Please take a look at https://developer.android.com/tools/building/multidex.html
  I think this is due to Uri.parse. Perhaps you should escape the string before passing it to Uri.parse.
How do you create an uri from such a string? Can you paste the code snippet?
  What are the dimensions of the image? What do you mean by "the network image is not compressed"? Are you loading animated images?
 Are you sure that you don't have multiple instances of activity B in memory?
 @nimengbo, perhaps the best way of telling what happens is to take a heap dump when your memory usage gets suspiciously big and then analyze that. There are various ways to cause a memory leak, `singleTask` being used or not.

Please see: https://developer.android.com/tools/debugging/debugging-memory.html
 We strongly recommend against using uncompressed network images. Very large images can OOM; you should [resize](http://frescolib.org/docs/resizing-rotating.html#_) instead.
  Can you give us more context on why would you want to do that?
 By "flow" do you mean "data usage"?
 I think the easiest way to achieve this at the moment would be to add request queueing in ThreadHandoffProducer.

Right now Fresco first looks up if the image is available immediately in Bitmap cache. If it misses then execution gets to ThreadHandoffProducer which moves execution of the image request from UI thread to background thread. We could have additional check there to see if image loading is paused or not and depending on that resume request immediately or queue it for execution later.

I am happy to provide more directions.

https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ThreadHandoffProducer.java
 This is the code that ends up kicking off the downloads (and cancelling them): https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/view/DraweeView.java#L101:L124
 I'm closing this since this should be possible with `resume()` and `pause()` as stated above.  Please provide the full stack trace.
  What's OSS?
  https://github.com/facebook/fresco/blob/v0.6.0/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipeline.java#L349

Use the newest version of Fresco: 0.6.0
  Without description we might not be able to help.
 LOL :) I assume this is a crash when trying to parse a jpeg header when extracting dimensions and orientation. Likely because we hit end-of-file.
  Call `Fresco.getImagePipeline().evictFromCache(uri_to_your_image)` before you reload the image.
  There is no libweibosdkcore.so in arm64-v8a directory. When your app is installed Android unpacks libs from the most appropriate directory and those libs can be loaded at run time. In case of 64bit devices it selects arm64-v8a (or x86_64) and if some of the libraries is not there then you won't be able to load it.

64bit devices, however, should be able to run 32bit libs. Just make sure that arm64-v8a and x86_64 are not included in your apk. See here: https://github.com/facebook/fresco/issues/458
  Same as #181 
  There seems to be a bug in 4.1.2: ShapeDrawable.mutate copies its padding Rect without checking whether it is null anywhere. Calling `setPadding(new Rect())` before calling `mutate` should help work around this issue. Marking this as a bug until some work around is in place.
 You can try setting padding on the shape drawable in your app. Let me know if that helps.
 @Liverm0r, the PR was taken back by @emhagman one hour after he opened it. Let me try to find some time this week to look into it  Closing as it's been 2 years without further reported cases of this. Most likely this was a device specific issue.  What does screen jump mean ? Do images disappear for a moment ?
 I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.  We are aware of the problem, fix is on its way.
 Fixed in 0.6.1
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 It's not at all clear that this should be a min rather than a max. If the aspect ratio of your image is very high, and you use min, then you will get a much lower quality image that you might expect. 

Currently, we care more about image quality than memory use, so we'll be leaving it as it is for the moment. The best solution would be to make this configurable. 
  What is going wrong? This is only going to get the last frame once the whole image is decoded, at which point you might as well show the image I guess? 
 Take a look at:
`ImageRequestBuilder.setImageDecodeOptions`
`ImageDecodeOptionsBuilder.setDecodePreviewFrame`
`ImageDecodeOptionsBuilder.setUseLastFrameForPreview`
 You should not be doing any of those things you are doing in the subscriber.
 Reaping.
  I'm not totally clear what you're asking for? It seems that you need to resize your images before displaying them? 
  Fixed in 0.6.1.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  Your logcat isn't very useful. What is the crash? Are you resizing your images correctly? 
 TransactionTooLargeException is a bucket for a lot of different issues: http://stackoverflow.com/questions/11451393/what-to-do-on-transactiontoolargeexception.

Does it happen if you display less than 100+ images ? Can you check number of opened file descriptors in your app ?
 I am not saying it is not related to Fresco, Fresco uses file descriptors. Could you answer my questions from previous comment ?
  There are a number of issues that address this question - on 5.0 and above, the images are stored on the java heap rather than in ashmem, which can lead to an increase in OOMs. You should make sure to resize your images correctly and release the images when you have finished with them so that you don't see this problem. 
  Are you able to upload a video of the problem please? 
 It looks like the image isn't being found in the bitmap cache, in which case it takes a small amount of time to decode the image, which produces the flash that you are seeing. 
  I'm cleaning up very old issues. If this still causes problems please comment and we can re-open.  Are you able to use an overlay color to do your rounding for you? http://frescolib.org/docs/rounded-corners-and-circles.html#_
 Modified the documentation. FItXY is not supported with BitmapOnly rounding, except in the case of @hendrawd's workaround.
  Duplicate of #484 
  It's not clear what your question is I'm afraid. Please see the docs at http://frescolib.org/docs/index.html#_ for advice on getting started. 
  We will have a solution for PNG resizing soon - watch this space! 
  What kind of GIF is this? Where are the images coming from - are they network images, or local images? 
 Unfortunately you will see the background since they need to be decoded and that takes a non-trivial amount of time, even for relatively small GIFs. 

You'll have to prefetch (carefully) if you want to avoid seeing the background briefly. 
  I'm afraid this isn't possible at the moment - we'll see if there's a lot of demand for this feature. 
 I'm afraid that I have no update on this. However, we are always welcoming pull-requests that add support for this in a maintainable way :) @oprisnik is working on a new architecture for animations that hopefully make support for this easier  We don't have a use case for this so we're probably not going to work on it internally. However, I think the use case is valid and it would be a good feature to have, so we would still appreciate a PR for this, even though I'm closing the issue now.  It shouldn't. But this is a pretty big image so could cause problems, what Android version are you running? What is the stack trace from the crash? 
 Is this a JPEG or a PNG? 
 The limit is device-specific, and is imposed by OpenGL. See http://stackoverflow.com/questions/10271020/bitmap-too-large-to-be-uploaded-into-a-texture for example. In this case it is 4096x4096, which should be plenty. You might need to use an image that doesn't have such a huge aspect ratio. 
  On Art, bitmaps are allocated on the java heap, and it looks like this is causing you to OOM. Perhaps this is because you are now caching the postprocessed bitmaps too, so you are using more memory? It looks like the postprocessed image is 5MB, does it need to be that big or could you resize the original image first? 
  Yeah, you can - either via XML (http://frescolib.org/docs/using-drawees-xml.html#_) or via code (http://frescolib.org/docs/using-drawees-code.html#_). Just set the fade duration to 0. 
  Is this an animated or static image? Can you give me the url so that we can test it our end? It sounds like it's taking a long time for the image to load after it is downloaded/retrieved from cache, but I'm not sure why that would be the case. 
 It looks like this is a bug in Fresco - when we fetch an image from disk cache successfully, we say that the request is 100% completed, when we fact we still need to do the decode. For an animated GIF like the above one, the decode can take a long time, leading to the gap that you notice above. 
 Can you use it in conjunction with the `onFinalImageSet` callback?
 Don't you have access to the ProgressBarDrawable when you construct your listener for the DraweeController? 
 You need to add a ControllerListener to the DraweeControllerBuilder that overrides onFinalImageSet
 Yeah the problem is that the progress bar gets faded out when the progress is set to 100. 

I wonder if it's possible to make this work by setting the progress bar to be the placeholder image too? Can you try that? 
 We should handle this on the pipeline level. It is hard to estimate the decoding time, but my hunch is that there are two main components here: the size in bytes of the image and the decode queue length (in bytes).

We could make decode producer do some heuristics like:
`out_progress = f(in_progress, estimated_decode_wait_time)`
`out_progress` is the progress that decode producer reports to its parent
`in_progress` is the progress of the child producer (e.g. network fetch progress)
`f(in_progress, wait_time)` could be something like `in_progress * 0.9 + exp(-C1 * wait_time) * 0.1`.
`estimated_decode_wait_time` could be something like `C2 * (total_bytes_in_the_decode_queue_including_the_current_image)`
There is no optimal solution to this problem, all we can do is to provide an estimate. This is just one idea.
 I believe this should be solved by da9b7f162bb31f538bda2f34e83ac505f0e67a39.
  I guess this is what you are looking for: https://github.com/facebook/fresco/releases? If not, please provide more details.
  We have made significant improvements to this problem in version 0.6.0, please use that instead of whatever you are using at the moment. 
  Where are you initializing Fresco? It looks like it is complaining because you initialize Fresco using MainActivity, and then Fresco keeps the reference to MainActivity after the activity has been destroyed, causing the leak. Is that possible? 

If so, consider passing Fresco the application context, or initialize Fresco in a subclass of android.app.Application. 
 In that case I'm not sure how SimpleDraweeView could have a DraweeControllerBuilderSupplier that references MainActivity. Perhaps you can do some logging to see where it gets set to that value? I'm afraid I can't really help any more than that without the code in front of me.
  This is intentional. If the cache is full of images that cannot be evicted it won't accept any more images. Image cannot be evicted if there is a reference from outside of the cache pointing to that image. Try to release more images if you hit this problem
 If images cannot be evicted it is because there is still another reference to them somewhere, and that is usually because they are on the screen (or you are not releasing your references correctly). Your best bet is probably to use a larger cache, if you are able to. 
 Yeah, if you're using SimpleDraweeView it will do all the work for you. 
  Do you control size of displayed images ? If images you display are arbitrary big, you should resize them: http://frescolib.org/docs/resizing-rotating.html#resizing
 Not yet. But it should be coming in a future release. 
 You can now use [downsampling](http://frescolib.org/docs/resizing-rotating.html#downsampling).
  Can you turn on verbose logging and check whether there are any error messages in the logcat ?
 Never heard back.
  It is normal that there are no OOMs pre to Lollipop. It would be useful to know some numbers here: how many bitmaps do you display simultaneously ? And what are their sizes ?
 On pre-Lollipop androids we store images off the java heap. Google killed that trick in Lollipop.

Each of those images seem to be ~ 1024 x 700 pixels, which gives us 2.7MB per Bitmap. There should be enough place to store a few of those.

What is the max heap size ? You can try making Bitmap cache smaller: http://frescolib.org/docs/configure-image-pipeline.html#configuring-the-memory-caches
 @LinJZong: please open separate issue and include more details, like what are the dimensions of decoded Bitmaps and what container view do you use (ListView, ScrollView, RecyclerView etc).
  Does your app have multiple dex files ? If yes, do you follow all steps listed here: https://developer.android.com/tools/building/multidex.html ?
 No reply, reaping
  how do you set ndk location ? Did you follow instructions here: http://frescolib.org/docs/building-from-source.html ? What ndk version do you use ?
 Please follow instructions here instead: http://frescolib.org/docs/building-from-source.html. Our gradle script does not use the location set in android studio.
  In scenario where new buckets may be created (mAllowNewBuckets == true) we rely on pool's soft cap to limit memory consumed by entires in all buckets.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Is transforming sequence of pngs into single animated webp image an option here ? Note that you would probably save a lot of bytes this way. There is no support for assembing animations from multiple frames right now.
 The loop count specified in the GIF image should be respected. If that's not the case then it is a bug.
 The bug is tracked separately in #180 
 Cleaning up old issues  Fresco does not require these permissions. You can see that our sample apps do not have these permissions in their manifests.

Why do you think this is required?
  Is this art specific ? Is this vendor specific ? NativePooledByteBuffer implements PooledByteBuffer interface: https://github.com/facebook/fresco/blob/96d74f385b297f364db1f719dd6ee61fc380d0d4/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/NativePooledByteBuffer.java which indicates that the issue is not within the Fresco library. I don't think we can help with this one. Don't you see similar exceptions for other classes ?
 This smells like a Samsung issue. @droidwolf, does this happen on several different devices?
 Yeah, on my SGS5, Uber, GTalk, Strava and some other apps are consistently insta crashing with similar stack traces. Unfortunately we do not yet know the root cause of this.
 Closing as this has not been updated for almost 2 years  This does not seem to be legit stack trace: https://github.com/facebook/fresco/blob/96d74f385b297f364db1f719dd6ee61fc380d0d4/fbcore/src/main/java/com/facebook/common/references/CloseableReference.java#L265 there is no String operation in this line
  Try playing with abiFilters. You might find this link useful: http://tools.android.com/tech-docs/new-build-system/tips. abiFilter should allow you to select single architecture to include in your app, abiFilters should let you do the same with multiple archs.
  I see you are reporting a lot of Lollipop related issues. Obvious bug here is the fact that there is a memory leak. Finalizer timeout itself, however, has most likely nothing to do with Fresco. I am pretty sure you also see timeouts related to finalizing instances of other classes as well.

Memory leak is a bug, so let's fix it. Let me know how you use fresco. Do you use DraweeView ? What is the container view ? (ListView, ScrollView, something custom ?)
 No reply, reaping
  I assume that the problem has been resolved. Please let us know if you're still experiencing this issue.
  Sorry for the extremely slow reply. 

The failure image is a drawable that you set on the hierarchy, so I'm not sure what you mean by "even if it is in the cache". I think it will always be present in the drawee hierarchy. If you do it this way, then the failure image will be faded in as you wish. 

Are you loading a new image on failure that is found in cache and then shown immediately? Can you give a code snippet? 
  use abiFilter in your gradle file, find more information here: http://tools.android.com/tech-docs/new-build-system/tips
  Could you rebase ? I could not patch your commit on top of master cleanly.
  Is that the complete code sample?
- You're using the same image as a placeholder and a failure. The scale type you supply for the failure is the default for placeholders too, so they will be the same.
- What are you passing as roundingParams?
- What is the implementation of `MyCustomProgressBar` ?
 Reaping. 
  Do you build fresco from source or do you use aars ? Which fresco version do you use ? This bug looks suspicious. Exception is thrown in static initializer that initializes static array of 16 elements. I don't know why it tries to access 16th element of 0-length array. It should be another way around - array should have 16 elements and elements 0-15 should be accessed after the array is created. It looks as if 2 bytes are swapped in byte code. If you use aar, can you try redownloading and building once again ?
 I assume that the problem has been fixed with newer Fresco versions. Please let us know if you're still experiencing this issue.  No, disk cache does not take any http headers into account. But you can disable it and use OkHttp as a network backend and you can use OkHttp's cache. I expect that OkHttp's cache is aware of some metadata that come as part of http response (this is my guess here, you should verify that)
  Which version of Fresco do you use? Are there any modifications to the library ?
 Does this happen with the latest Fresco version?
 We are investigating.
 Fixed in 0.7.0.
 Hi @sourabhv, your issue seems to be a duplicate of https://github.com/facebook/fresco/issues/1482. @kirwan put a fix up with https://github.com/facebook/fresco/commit/573986ac0530300a42941534898b534234745c24 .

Please update to 0.14.1 in order to fix this issue :)  We won't be able to do this, unfortunately, because ZoomableDraweeView is available under a different license. You should be able to include its source code in your app.
  I assume the problem has been resolved. If not, please let us know.  This is a bad practice so we don't support this. You should probably rethink how you display the content because blocking the user until the images are loaded seems like a really bad user experience. What if the images have to be downloaded? Do you really want to wait for dozens of seconds until all of them are downloaded?
  Sorry for the delay, and thanks for this awesome improvement! I'm going to review this in a moment.
 I just commented about two really small things, but looks good otherwise.
@s1rius, if you could please address those nits and then retest the scenarios you showed on the screenshot, we'd be good to go!
Sorry for delays, it's been summer time and a lot of people were on vacations (myself included). Thanks again for making this pull-request!
 @facebook-github-bot shipit
  Can you provide more code ? Are you sure that context is not null ?
  The fix is in 0.7.0 already.
  Closing as this is most likely not as relevant any more due to the obsolescence of these devices.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Investigating...
 This was likely fixed in 0.6.0 or even earlier.
  Have you tried [Resizing](http://frescolib.org/docs/resizing-rotating.html#_)?
 We are working on improving the thumbnail support, but regardless of that, you should still specify the resize options. If you don't specify the resize options, Fresco doesn't know how big image you need and will return the original size which is probably not what you want for camera images.
  That is correct. Fresco at the moment doesn't take into account the view size automatically, but we are working on it. For now you need to manually specify the resize options.
The difficulty is that the image request gets built before the layout happens. We are investigating ways of dynamically passing the view size down the pipeline but this is not as trivial.
  We tested it and the image loads for us. Can you give us more context? Are you sure that it is Fresco and not a networking issue for example? If you turn on verbose logging, what do you get for AbstractControllerListener in your logcat? 
 You need to grep for what you are looking for, the whole logcat output is useless otherwise.
Can you do `adb logcat -v threadtime | grep -iE 'LoggingListener|AbstractDraweeController'`?
 Have you set the logging level for your application to `VERBOSE`? I think the default logging level is `WARN`. You should be getting something like this:

```
07-09 16:23:38.934 17755 17755 V myapp(:<default>):AbstractDraweeController: controller 33531f16 140: submitRequest: dataSource: 22fdfb9e
```
 VERBOSE, not DEBUG.
 We've added log setup instructions here: http://frescolib.org/docs/troubleshooting.html#using-the-logcat
  What compile error do you see? I wonder why didn't we spot it yet.
  We need more details. What Android version? You coudl also look up in the Android source yourself and see what is null on ContextImpl.java:943
 Can you please provide the full stack trace?
 It seems that the application context is not initialized yet (mBaseContext is still null).
@droidwolf: where are you doing this initialization code?
Can you check two things?
1. sContext.getApplicationContext() is not null
2. sContext.getBaseContext() is not null

I think this might be because the Application si not initialized yet: see the analysis here: http://stackoverflow.com/questions/24883903/when-is-getapplicationcontext-of-application-class-called
 After calling super?
Also: can you check this two things?
1. sContext.getApplicationContext() is not null
2. sContext.getBaseContext() is not null
 Closing as there has been no further reports of this since 2016  I think there has been a similar issue. Let me try to find it.
 See #97
  What device and OS are we talking about? How many images / rows are visible at the same time? Scrolling issues might be due to a several animations being visible and running at the same time.
 Awesome!
  Sadly, XML attributes on Android need to be globally unique. That's a fundamental design flaw if you ask me, but there is little we can do about it (other than perhaps prefixing all of our attributes, sigh).
That being said, some other library defines an attribute with the same name (`viewAspectRatio`) as Fresco.
You can either remove one of those libraries, or, you can fork Fresco and rename that attribute.
  Do you get random crashes for the same build, or?
 `W/unknown:CloseableReference` is not related to UnsatisfiedLinkError.

I need more details to help with the crash:
- does this happen on particular devices or all devices ? What is the architecture of processor (x86, armv7, 64bit) ?
- is os version relevant ?
- what version of Fresco do you use ?
 @agoodcoolman : do you use proguard ? does it happen all the time or sporadically ? Have you seen https://github.com/facebook/fresco/issues/172 and https://github.com/facebook/fresco/issues/105 ?
  I am not sure what might be the cause, but we are investigating it.
 Closing as there has been no updates for 2 years, and this seems to mostly concern (by now) obsolete Android versions  The inflation fails because the app is running out of memory. You need to track down the real cause of the memory leaks.
Just to narrow down the issue, are you still getting these errora if you remove the `holder.icon.setImageURI(...)` line? (Note, you won't see the images after that, but that's expected.)
  Have you updated the Fresco from some older version to 0.5.3, or you just freshly added it?
  You can achieve that by setting the placeholder programmatically. See [Using Drawees in Code](http://frescolib.org/docs/using-drawees-code.html#_).

```
Drawable[] layers = new Drawable[] {placeholderBackground, placeholder};
hierarchy.setPlaceholderImage(new ArrayDrawable(layers));
```
  Are you properly calling `Fresco.initialize(context)` and where?
 Sounds good. Please reopen or create a new issue if you encounter this again.
  You may have 16MB available in total for your app, but the free space doesn't necessarily have to be continuous. For example, you may have the two free chunks, one of 6MB and the other of 10MB, but you still don't have one continuous chunk of 14MB and the allocation will therefore fail.
  I am not sure I understand the issue. Can you please clarify?
 You can just submit a new image request in order to show the "default image". 
  Unfortunately this is not supported out of the box. You could try by setting the matrix instead of the scaletype with `GenericDraweeHierarchyBuilder.setActualImageMatrix`. Then you could perhaps animate the matrix from one to the other. But we'd first have to expose `GenericDraweeHierarchy.setActualImageMatrix`, and even then this would be tricky to do.
If you decide to play with this, you can use ScalingUtils.getTransform to get the actual matrix for a particular scale type.
  Something is causing executor congestion. We'll take a look.
 Actually I am not sure now. How are you calling this data source?
  If by `cacheSize` you mean the size in bytes currently occupied by our caches, I don't think we expose that. We do however have the limits in place and you can control the maximum allowed size for our image caches.
Also, I don't think we expose `clearCache` at the moment, but it is on our TODO list.
 The methods to evict and clear memory and disk caches are now available for the ImagePipeline starting from here:

http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/core/ImagePipeline.html#clearCaches()
  Thanks for the detailed report, we'll investigate ASAP.
 Fixed in v0.8.0
  One thing that is wrong with your code is that you are setting both the controller and the uri. You should only do one of those.
Also, I am not sure that the problem is in the SimpleDraweeView as those listeners look sketchy too.
One way to narrow down the issue is to completely remove the following two lines and see whether you still have memory leaks:

```
        simpleDraweeView.setController(controller);
        simpleDraweeView.setImageURI(uri);
```

Note, for this experiment you won't see the images, but that's expected. Please let me know if you are still observing the leaks after removing those two lines and we can continue from there.

Also, how many instances of SimpleDraweeView are there? Easy way to check would be to just log the reference of `simpleDraweeView` in the logcat from the `setupImage` method.
 Hmm, there may be some issues with Drawee + RecyclerView combination. If you are familiar with MAT, it would be very helpful to see what is referencing the leaked Bitmaps. We will also investigate on our own, but since you are able to reproduce the issue, any help would be greatly appreciated!

As for the Android version, Fresco on Lollipop keeps the bitmaps on the Java heap and that's why you are getting OOMs. That doesn't mean that the leak is not happening on older Android versions where we keep bitmaps in the native memory. The leak may still be there, but it won't be detected by the Java VM.
 Oh yes, you should only call Fresco.initialize once, near the application startup. Doing it in each Activity is wrong. We shall update the documentation to reflect this more clearly.

Also, this might be of interest:
http://android-developers.blogspot.co.uk/2011/03/memory-analysis-for-android.html
http://www.eclipse.org/mat/
 @mheras There is no other option - you have to pass `Context` to `Fresco.initialize` once and before it is used for the first time. `Application` is convenient place to do this initialization. You should either ask your users to initialize Fresco in `Application` or initialize your library there (and your library would in turn initialize Fresco).
 The app author shouldn't have to initialize Fresco just because you are using it. However, if they happen to be using Fresco on their own, your library has to reflect their config. 

You should offer two initialization methods: one that takes an ImagePipelineConfig object, and one that doesn't. Only the second should call Fresco.initialize; the first should assume the app will do it.
  Most likely this is a compile error. Run gradle with the -d option to see what it is.
  Where do you get the bitmap from? You shouldn't be using `setImageBitmap`, but I need more context in order to answer the question.
 Fresco manages Bitmaps on its own, and it does not support providing Bitmap instances created elsewhere. This is necessary because of how Fresco manages memory.
You could save the modified image to disk and then just normally load it with Fresco.

Alternatively, you could create a BitmapDrawable out of your Bitmap and set it as a placeholder to the SimpleDraweeView (You will also need to set the null url). With this approach however you lose all the memory benefits that Fresco provides and you may run into memory issues.
 You can supply a custom `DrawableFactory` that just returns your BitmapDrawable. Example for Keyframes: https://github.com/facebook/fresco/blob/master/samples/showcase/src/main/java/com/facebook/fresco/samples/showcase/imageformat/keyframes/KeyframesDecoderExample.java#L165  If use fresco to load an png with some error, like: http://img.wdjimg.com/mms/icon/v1/9/f4/e2fed53a563d696d990484de34729f49_256_256.png , the whole fresco my be blocked, any image could be loaded any more.
 Log like this:

V/RippleFresco:BufferedDiskCache( 6689): Did not find image for http://img.wdjimg.com/mms/icon/v1/9/f4/e2fed53a563d696d990484de34729f49_256_256.png in staging area
V/RippleFresco:BufferedDiskCache( 6689): Disk cache read for http://img.wdjimg.com/mms/icon/v1/9/f4/e2fed53a563d696d990484de34729f49_256_256.png
V/RippleFresco:AbstractDraweeController( 6689): controller a735665 25: submitRequest: dataSource: 2d536948
V/RippleFresco:BufferedDiskCache( 6689): Found entry in disk cache for http://img.wdjimg.com/mms/icon/v1/9/f4/e2fed53a563d696d990484de34729f49_256_256.png
V/RippleFresco:NativeMemoryChunkPool( 6689): Used = (11, 954368); Free = (6, 97280)
V/RippleFresco:NativeMemoryChunkPool( 6689): get (reuse) (object, size) = (3db4425b, 32768)
V/RippleFresco:GenericByteArrayPool( 6689): Used = (1, 16384); Free = (1, 16384)
V/RippleFresco:GenericByteArrayPool( 6689): get (reuse) (object, size) = (2d3823e9, 16384)
V/RippleFresco:GenericByteArrayPool( 6689): release (reuse) (object, size) = (2d3823e9, 16384)
V/RippleFresco:GenericByteArrayPool( 6689): Used = (0, 0); Free = (2, 32768)
V/RippleFresco:BufferedDiskCache( 6689): Successful read from disk cache for http://img.wdjimg.com/mms/icon/v1/9/f4/e2fed53a563d696d990484de34729f49_256_256.png
V/RippleFresco:BitmapPool( 6689): Used = (11, 16141328); Free = (0, 0)
V/RippleFresco:BitmapPool( 6689): get (alloc) (object, size) = (25554bb6, 65536)
V/RippleFresco:AbstractDraweeController( 6689): controller 21389a90 null -> 26: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 21389a90 26: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@3f91df89
V/RippleFresco:AbstractDraweeController( 6689): controller 21389a90 26: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 21389a90: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 21389a90 26: submitRequest: dataSource: 2ddb2faf
V/RippleFresco:AbstractDraweeController( 6689): controller 2f06ced8 null -> 27: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 2f06ced8 27: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@2bfc1231
V/RippleFresco:AbstractDraweeController( 6689): controller 2f06ced8 27: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 2f06ced8: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 2f06ced8 27: submitRequest: dataSource: ac4dd16
V/RippleFresco:AbstractDraweeController( 6689): controller 609c7f null -> 28: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 609c7f 28: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@220b844c
V/RippleFresco:AbstractDraweeController( 6689): controller 609c7f 28: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 609c7f: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 609c7f 28: submitRequest: dataSource: 84311aa
V/RippleFresco:AbstractDraweeController( 6689): controller 2d53cc81 null -> 29: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 2d53cc81 29: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@1c39126
V/RippleFresco:AbstractDraweeController( 6689): controller 2d53cc81 29: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 2d53cc81: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 2d53cc81 29: submitRequest: dataSource: 3fe29167
V/RippleFresco:AbstractDraweeController( 6689): controller 5e4ad0a null -> 30: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 5e4ad0a 30: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@ed2e97b
V/RippleFresco:AbstractDraweeController( 6689): controller 5e4ad0a 30: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 5e4ad0a: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 5e4ad0a 30: submitRequest: dataSource: 23131398
V/RippleFresco:AbstractDraweeController( 6689): controller 238e1374 null -> 31: initialize
V/RippleFresco:AbstractDraweeController( 6689): controller 238e1374 31: setHierarchy: com.facebook.drawee.generic.GenericDraweeHierarchy@2d23d09d
V/RippleFresco:AbstractDraweeController( 6689): controller 238e1374 31: onAttach: request needs submit
V/RippleFresco:PipelineDraweeController( 6689): controller 238e1374: getDataSource
V/RippleFresco:AbstractDraweeController( 6689): controller 238e1374 31: submitRequest: dataSource: 206518e3
 @TarangS Do you know how to avoid this bug? I try it, but can not find the solution. thanks...
 Which Fresco version do you use ? Does this happen for any png image or just that one ?
 And what do you mean by "png with some error" ? Is that png corrupted or something ?
 @michalgr The newest version (0.5.3, and all versions are same). The png some bytes was not correct, I can not avoid all png images which app loaded are right format.

If any image was corrupted, all images followed can not be loaded. Following log, non callback was done.
 My phone is Nexus6, android 5.0+
 This issue just in android 5.0+, maybe the bitmap pool (for 5.0) has bug?
 @bluef This a bug of android 5.0, the BitmapFactory decode a image which some bytes are not correct, the method would be block, no response...

I don't know how to avoid that...
 Is this still happening ? There are a few things worth trying here: we can supply 0 bytes if BitmapFactory repeatedly asks for more data even though there is none left, we can throw something or decode pngs from byte array.

@duguguiyu : Did youinvestigate why BitmapFactory blocks ? Can you point us to the offending line if so ? 
 Closing as there are no updates or further reports for almost 2 years  http://frescolib.org/docs/multiple-apks.html  
Are you using the split for 64 bit as mentioned in the link. 
 Are you experiencing this on all devices or just on 64-bit?
 see also details in #732 
 Let's try to figure out what is going on here. Could you please unzip your apk and examine content of `lib` directory ? Things that would be suspicious:
- `lib` directory in the apk is empty
- lib directory contains multiple subdirectories and not all of them contain `libmemchunk.so`
 Yep, that would cause the crash on MIPS devices. Do you have a breakdown by the processor architecture ?
 Can you try with the solution in #933?
  Bugs are unrelated, please open separate issue for OutOfMemoryError.

Do you use proguard ? What device do you reproduce this on ?
 Reaping; this is probably a duplicate of #410 anyway.
  Use a different URI for the new image. 

If you want to change the image returned by the same URI, then this is a duplicate of #124.
  By default the disk cache goes in the application context's cache dir. You can change this by calling ImagePipelineConfig.setMainDiskCacheConfig when [configuring the image pipeline](http://frescolib.org/docs/configure-image-pipeline.html).

The recommended way to clear the disk cache is to implement a [DiskTrimmableRegistry](http://frescolib.org/docs/caching.html#trimming-the-caches) object. This must keep a list of DiskTrimmable (cache) objects, which it can trim whenever it wishes.
  Can you explain why you are doing this?
 We indeed have had issues with the Chinese and Korean documentation. It is not always up to date. 

However there is a problem. We do accept external pull requests. But we are not yet ready to grant commit rights to non-Facebook employees. If the translators have their own repos, they can make changes quickly. They don't have to wait for our approval.

There is also a problem for China. The web site frescolib.org is blocked in China, but fresco-cn.org is not. So we want the Chinese documentation to continue to live on fresco-cn.org. But I believe GitHub lets you have only one CNAME per repo.
  The bytes of an individual frame, or of the entire animation? We only expose the individual frames.

What is your custom GIF view? Why do you need the bytes? Can you try using [manual playing](http://frescolib.org/docs/animations.html#playing-animations-manually)?
 I would suggest not to make your users download a 2M image over a bad network! 

We do have support for showing a progress bar: http://frescolib.org/docs/progress-bars.html#_
 No. Unless your server has another uri you can use to query it.
  Are you following the rules for DraweeHolders? See http://frescolib.org/docs/writing-custom-views.html#responsibilities-of-custom-views.

Are you putting your custom views inside a ScrollView? Don't. Use a RecyclerView instead.
 Android 5.0 will always be the first to suffer OOMs, because it doesn't have the ashmem capability we had in Android 4.x. But that doesn't necessarily mean your app is correct.

The allocation you describe is of a 2.2MB image. On most devices, that's large enough to cover the entire screen. In that case, every other image on your screen should not be visible. Has your appropriate Activity / Fragment .onStop method been called?
  Track this in #260.
  Tracking in #260.
  Did this not work? http://frescolib.org/docs/animations.html#playing-animations-manually

What happened exactly? Is the image a GIF or a WebP?
 Please follow the the instructions in the link I posted above.
 @liyuehui is correct, you can supply value animators to modify the repeat count. Nice trick :) The problem here is not the version but that you are casting to `AnimatedDrawable`, which will be `AnimatedDrawableSupport` on older Android versions. It should work if you cast it to `AbstractAnimatedDrawable` instead. See https://github.com/facebook/fresco/issues/1863 for a solution.  inPurgeable, with Fresco's memory management, is better than inBitmap, since we can bypass the Java heap entirely. 

If inPurgeable had not been removed in Android 5.0, we would have kept using it. 
 No, it can't. The two options are not compatible. If you use inBitmap, inPurgeable will have no effect. 
  I think there is an easy fix to this. Let's track this in #912.
  We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs that is way more performant, especially in the case where you display multiple GIFs. Let us know if you're still experiencing problems with 1.4.0.  Please leave comments in English as otherwise we are not able to help you. 
 Try http://frescolib.org/docs/progress-bars.html#_.
  What are the bitmaps? Images from the Internet or local images on the device?
 Can't proceed without more data.
  Weird.

```
Caused by: java.lang.NullPointerException
   at com.facebook.drawee.view.DraweeView.toString(DraweeView.java:179)
```
 Looking at the [DraweeView](https://github.com/facebook/fresco/blob/96d74f385b297f364db1f719dd6ee61fc380d0d4/drawee/src/main/java/com/facebook/drawee/view/DraweeView.java), this can only happen if super class calls `toString` from their constructor which seems odd.
 We have a fix ready.
 This was fixed in https://github.com/facebook/fresco/commit/80b9ed848582c331f1e00302c896d0be8d11d625
 @PriyankaKamthe please file a new issue.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  How did you modify the source code? This argument will happen if Bitmaps.BITMAP_CONFIG was not changed.
 RGB_565 doesn't support transparency and this may be the reason why BitmapFactory fails to decode a PNG into it.
Anyways, we do not support RGB565 at the moment.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
  Your problem is that you are using `wrap_content` - see http://frescolib.org/docs/using-drawees-xml.html#wrap-content
 Yes, per the docs you can use `wrap_content` with an aspect ratio - you could do this in xml if you know the ratio in advance. 
  This is not one of the Fresco's libs. The 'out of memory' suggests examining memory usage. What device do you use to reproduce this ? Do you use custom Fresco configuration ?
  You should never do `CloseableImage image = imageReference.clone().get();` When you call `imageReference.clone()` you need to keep a reference to that clone so that you can close it at the correct time (when you no longer need the bitmap). Instead, that clone get finalized and the bitmap gets released before you're finished with it. 
  You need to set a hierarchy first. 
  Have you read this: frescolib.org/docs/multiple-apks.html ? You can build your apk per architecture and those build should be smaller. I would suggest this.

Another option is to play with productFlavors and abiFilter (example here: https://github.com/facebook/fresco/blob/v0.5.0/samples/comparison/build.gradle#L43). You should be able to specify a build flavor that includes native libs for multiple architectures you want. If you specify x86, armeabi and armeabi-v7a then you'll end up including the same libraries as previous versions of Fresco.
  We've already added this and it will be pushed soon.
  There are a couple of similar issues - the solution in #124 and #275 should work for this case. 
  Now fixed. 
 No it is now `newDraweeControllerBuilder` instead of `newControllerBuilder`
  The purpose of Fresco is to load images, not to manipulate them natively, so this is not something that we will be adding, sorry. 
  Unfortunately extracting image type is based on industry standards. We can't just assume that the image resolution width and height is stored at the very beginning of the image as it may be stored elsewhere in the header of the image. See https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imageutils/JfifUtil.java#L88-L118 for how we extract this information. 
  Hey everyone, this should be fixed with 4326935ca115422a9aa77505e66cc68bbc76a76c and 4326935ca115422a9aa77505e66cc68bbc76a76c that I've landed last week. This will be available with the next 1.3.0 release. Released yesterday with https://github.com/facebook/fresco/releases/tag/v1.3.0  We don't have this problem, as we're not using inInputShareable.

Android makes the deep copy, which I believe lives in ashmem and is controlled by the system. This will use more memory but as you have discovered, inInputShareable isn't really always safe to use.
  I don't know whether it is related or not. Do you use any non-fresco native libraries ? What do you do to reproduce this ?
  Oh sorry. I just pushed out a similar fix. Thanks for noticing this!
  What version are you using? It looks like that was fixed in #23, but that was a long time ago. 
 I believe this was fixed in v0.8.0.
  Can you access the same URI from a browser on the same device?

Google URIs are blocked in some countries.
 Same issue as #321.
  I'm afraid I can't read the Chinese docs, but did you add all the projects?

Or are you using Proguard perhaps? 
 The call to `Fresco.initialize` must take place **after** your application has called `setContentView`. Are you doing this? It looks as though the Chinese docs don't state this.
 What changed? Could you have exceeded the 64k method limit recently? 
 Are you building from source? Or are you using Eclipse or Android Studio? 
 This seems to be a problem with the environment on your other pc. Have you set up eclipse per the instructions here: http://frescolib.org/docs/index.html#_?
 Great! 
  http://frescolib.org/docs/using-drawees-code.html#change-the-placeholder
  It would be a bit of a challenge, since ImageGetter returns a Drawable, not a Bitmap.

You could conceivably build your app such that DraweeHolders or SimpleDraweeViews are created for each HTML img tag. Even then, it would be awkward to use a Drawable-returning method like this.
  http://frescolib.org/docs/configure-image-pipeline.html#using-a-memorytrimmableregistry
  A case can be made that Fresco is too large, but that is a duplicate of #260.
  Fresco was built to solve Android-specific problems and would not be of much use on another platform.
  Hi @freddy24 
does this stlil happen with release 0.10.0?

Thanks
  Can you give an example of such a gif?
 This should be fixed, see #1275  We hope to soon release a sample library showing how to use Fresco with touch gestures.
 See the sample at https://github.com/facebook/fresco/tree/master/samples/zoomable/src/main/java/com/facebook/samples/zoomable
  Please follow the [instructions for OkHttp](http://frescolib.org/docs/using-other-network-layers.html#using-okhttp).
  Duplicate of #341.
  What does your `build.gradle` file look like?
  You should [resize](http://frescolib.org/docs/resizing-rotating.html#resizing) such a large image.
  I'm closing this issue since this has been opened a while ago and there are newer IntelliJ versions and we cannot reproduce the issue. Feel free to comment here if this is still a problem for you.  The amount of file handles that can be open is a global limit for all processes, so it's hard to say if this is a device specific issue or perhaps some other background process causing it.
Closing as there has been no further reports of this.  Why would it be wonderful? Your users would just see grey boxes as they scroll. 

Are you suffering performance issues?
 Duplicate of #512. Closing this one as the other has more discussion.
  No, we didn't do anything special. I would think that it just so happens that as you release and assign more memory, the memory used stays at about 100MB, since the pixel data gets freed pretty quickly even if it is not synchronous. 
  The deep copy is carried out by Android itself - I believe the source code is in [BitmapFactory.cpp](https://github.com/android/platform_frameworks_base/blob/kitkat-release/core/jni/android/graphics/BitmapFactory.cpp#L212).
  Can you clarify what you are trying to do? Are you trying to install your app on an external SD card?
 Probably not supported.
  OkHttp supports this behavior, and we support using it with Fresco. See http://frescolib.org/docs/using-other-network-layers.html#using-okhttp
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Native memory is used by Fresco to store encoded data. This is not trimmed by Fresco, but normally it doesn't need to; native memory use is bounded by the encoded memory cache and the number of active decodes in the pipeline. What is your application doing?
 No, there should be an upper limit on the amount of memory used so that the app never crashes. 
  It is not clear to me how using view and Drawee scaling simultaneously will play out. Try using an ImageView and the [image pipeline directly](http://frescolib.org/docs/using-image-pipeline.html#_).

If you do this, you can override the [same methods](http://frescolib.org/docs/writing-custom-views.html#handling-attach-detach-events) as a Drawee-based custom view. Instead of calling DraweeHolder.onAttach/Detach, you'd call `CloseableReference.close` to detach and send an image pipeline request from the attach.
  This is by design. First the image gets rounded, and then the border gets drawn on top of it. The border is centered on the edge of the rounded image, meaning that half of its width gets drawn outside of the image, half of it inside the image. Furthermore, your border color has alpha set to 0x40 which makes it semi-transparent. That's why you see the image underneath the inner part of the border.
It also seems that you are using a wrong scale type as the bottom image looks smaller, so check that out too.
  Let us know if this recurs.
 We should figure out what was causing this and which diff fixed it (if that is the case).

Do you use static gif images in your app ?
  Bitmap.recycle is all we do.

Purgeable bitmaps hold a memory reference to the original encoded memory area. We don't use inInputShareable so we can safely delete the image pipeline's copy of the encoded data.

NativeMemoryChunk stores the encoded data on the native heap.
 Stepping back - may I ask why you are implementing another library? What do you need that Fresco does not provide?
 Native memory is indeed fast and does not GC.

The deep copy is made into ashmem, and is controlled by the system.

decodeFileDescriptor I believe reads only from disk. We may revisit this later.
 I'm afraid this isn't really an issue with Fresco itself, and is beyond the scope of what we can support.
  Is this only the case in AndroidStudio preview? Also, does the image show if you don't specify roundedCornerRadius?
  Duplicate of #159
  Yes, set the old image as a low-res and the new image as a high-res while building a drawee controller. 
See [Requesting Multiple Images](http://frescolib.org/docs/requesting-multiple-images.html#_)
  64bit libraries are not included in the fresco aars. This is fixed in master.

I think you use some other native libraries as well, and those do have 64bit binaries in your apk. Because of that runtime does not accept fresco's 32bit libs. Can you try compiling and using master rather than aars from maven ?
 This should be fixed in v0.5.1. File a new bug if this is not the case.
  Duplicate of #80
 Also, see [ImagePipeline.prefetchToDiskCache](http://frescolib.org/docs/using-image-pipeline.html#_)
 Duplicate of #80.
  Adding an OkHttp interceptor is the preferred way to do this. There is also a discussion going on in #1459 with alternative solutions, so just monitor the discussion in the PR.
  It is possible that you are looking at the total memory usage of your app and Fresco is not the only part of the app that uses memory.
How did you get the amount of the native/java heap size?
  In short, yes, you'll have to provide your own implementation of MemoryTrimmableRegistry.
MemoryTrimmableRegistry should maintain a list of registered trimmables and should also listen for the system events in order to detect the low-memory conditions. When low-memory conditions occur, registry should notify its trimmables in order to release some memory.
We shall amend the documentation on how to do that.
 See http://frescolib.org/docs/configure-image-pipeline.html#using-a-memorytrimmableregistry
  Do you mean clearing disk cache, clearing memory cache or both?
 ``` java
    ImagePipelineFactory imagePipelineFactory = Fresco.getImagePipelineFactory();
    imagePipelineFactory.getBitmapMemoryCache().removeAll(AndroidPredicates.<CacheKey>True());
    imagePipelineFactory.getEncodedMemoryCache().removeAll(AndroidPredicates.<CacheKey>True());
    imagePipelineFactory.getMainDiskStorageCache().clearAll();
    imagePipelineFactory.getSmallImageDiskStorageCache().clearAll();
```
  Please read [Writing Custom Views](http://frescolib.org/docs/writing-custom-views.html#_).
 ControllerListener will tell you when the image is loaded.

You don't need to invalidate the view for that reason, though. Fresco takes care of that for you.
  Are you doing any post-processing on the images?
How many images do you have to scroll back until you reach the top image? Maybe the images are big and our bitmap cache cannot fit them all, meaning that the oldest one will have to be evicted and then  decoded again later (therefore, not being able to display immediately).
What are the dimensions of those images? If they are much bigger than the view, you should resize them first. See [Resizing](http://frescolib.org/docs/resizing-rotating.html#_).
 If the image is in bitmap cache, we don't do a fade-in animation. If it fades in, that means the image has been evicted from cache.

You can as we said reduce the footprint of the images in cache by resizing them. You can also experiment with [increasing your cache size](http://frescolib.org/docs/configure-image-pipeline.html#configuring-the-memory-caches), although that may hurt the rest of your app.
 A prefetch at that point won't do any good. You need to prefetch an item 2-3 rows _ahead_ (or behind, depending on the scroll direction) of the item in the current row.
 The onAttach call occurs when the image comes on-screen, so the behaviour of Glide and Fresco is the same. 

The question is whether the image is in (bitmap) cache when the image comes on-screen - if so, it will be shown immediately, if not, there will be a delay. As others have mentioned, if you need it to be available immediately you should prefetch to bitmap cache ahead of time. 
 There is no point in calling `prefetchToBitmapCache` in `onBindViewHolder`, since that is the point that the image comes onto the screen. 

You should call `prefetchToBitmapCache` at some earlier point, e.g. when you set the adapter for your recycler view (as long as it is not too big). Apart from that, your code looks good. 
 Fresco handles the caching for you. Take a look at http://frescolib.org/docs/caching.html to see how this works and how this can be configured.
If you want to prefetch images, check out http://frescolib.org/docs/using-image-pipeline.html Well, everything depends on when you do the caching. RecyclerView doesn't have an API for prefetching items. There's a good article [here](https://medium.com/google-developers/recyclerview-prefetch-c2f269075710#.nueasdahh) how this could look like and the pros / cons. Whenever you want to do the prefetching, just call `prefetchTo...` if you don't pre-create views (or if they are not attached to a window) or just set the URI if you're using a Drawee view.  We're looking at this issue of bitmap pooling again now but have found some issues internally when enabling it.

In the meantime, this is a very old issue so I'm going to close it.  No, you do not have to create drawee holder each time. You only need to set a new uri / controller whenever the image changes.
Please read [Writing custom views](http://frescolib.org/docs/writing-custom-views.html#_)
  When load a large image(3k*5k), the app may be no response...
 In nexus5 (4.4.2), it's ok. In nexus6 (5.1), the app is no response...
 Perhaps you should resize your image first. See [Resizing](http://frescolib.org/docs/resizing-rotating.html#_).
 Normally, we do not support that big images. 3k \* 5k \* 4Bpp = 60 MB. On 5.1 (Lollipop) that single image (unless resized) would eat the whole java heap of your application. On older versions of android we will allocate that image on the native heap which doesn't have such strict limits as java heap, but it is still not okay to load a 60MB image in memory. You should really resize the image first. Let us know if that helps. 
 I know the Resize Option, but i don't know the image's size (load from web), how to deal with it?
 You don't need to know your image's size. You only need to know your view size. If you don't know the exact size, estimate. You could start with the screen resolution of your device, if a full-screen image. If you think it would be, say, one fifth of the full screen, choose the resolution / 5.
  Can you provide a sample url and a screenshot. 
 You are correctly trying to use `OVERLAY_COLOR` are your rounding method, but it doesn't look like your code ever assigns the params you create with that rounding method. 

When you build your hierarchy in the first place you should set the RoundingParams that you are creating in the last line of your code snippet. 

```
RoundingParams roundingParams = RoundingParams.asCircle().setRoundingMethod(RoundingMethod.OVERLAY_COLOR).setOverlayColor(getResources().getColor(R.color.white));
builder.setRoundingParams(roundingParams);
```
 Your overlay color in the xml is `transparent`, so it gets ignored. Also, in your code you need to set the overlay color to the rounding params that you create. (Really, you shouldn't need the code at all if you set your xml up properly). 
 What do you mean by "creating the problem"? What exactly is the problem now? 

In your xml, you have both `roundAsCircle=true` and `roundedCornerRadius=5dp`. If you want it to be rounded as a circle, you need to remove the second of those. 
 No worries - glad it's working now!
 that class cast exception is a bug - the fix will be in the next version, and then you will be able to change to any rounding params you want dynamically, which will give you what you want. 
 Should be fixed, yes.
  @johnzheng00 it would be useful if you could tell us the use case which fresco falls short on. 
 Fundamentally Fresco is a raster graphics library, not a vector images library. It's not likely we'd ever support this.
  Did I miss something or is the title misleading? 
Please use match_parent instead of fill_parent. 
Also why do you think this is a bug in the DraweeView? Need more details. 
 Also
- What version of Android are you running?
- What are you passing to the Drawee, as either XML or code? Specifically, what is the placeholder and how large is it?
 Something seems odd about this PNG. The stack trace shows you're trying to allocate a 38 MB placeholder. That works out to a size of 3000 x 3000, not 500 x 500. Can you upload it?
 The image requires 12MB and you only have 4MB available.
  Fresco only supports ARGB_888 config right now. The format of the encoded image (png/jpg) does not matter when reusing the bitmap.
  @mrlongtt does this happen for local images or images downloaded over the network or both? 
 Are these animated images? We don't support resizing them. Only JPEGs can be resized.
 How large are the images? There is an issue for images where either dimension is longer than the OpenGL texture limit (usually either 2048 or 4096).
 The improvements made in 0.6.1 should help with this. Also try the new experimental [downsampling](http://frescolib.org/docs/resizing-rotating.html#downsampling) facility.
  Thanks for reporting. We are aware of this and it would be fixed in the next release. 
 There was a known problem with the S6's 64-bit hardware that has been fixed in v0.5.1.
 Laces, your issue is different from the original as it occurs on non-S6 devices.

What kind of images fail to appear?
 No new reports of this for more than a year, closing issue.  Thanks for reporting, This would be fixed in the next release
 I believe 0.5.1 takes care of this. File a new issue if not.
  Writing code like this I can see the image without the mentioned problem. Do you have any updates?

```
Uri uri = Uri.parse("http://www.titus.de/product-images/details/3D/Skatewachs/Banana_815739.jpg");
ImageRequest request = ImageRequestBuilder.newBuilderWithSource(uri).build();
DraweeController controller = Fresco.newDraweeControllerBuilder()
                                          .setImageRequest(request)
                                          .build();
mDraweeView.setController(controller);
```
 @cabbage Thanks for you reply. 
  Does adding `CloseableReference.closeSafely(ret.first);` to the line below this one https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ResizeAndRotateProducer.java#L161 make any difference? That is a bug that will be fixed in the next release. 

If not, do you get anything in logcat? 

Thanks for your help.
 Call FLog.setMinimumLoggingLevel(FLog.VERBOSE) to see all logs.
 v0.6.0 and 0.6.1 improved handling of local images.
Also consider using our [downsampling](http://frescolib.org/docs/resizing-rotating.html#downsampling) feature.
  Can you try configuring size of the memory cache to be smaller ?
 Stepping back - this is a 34 MB decode you attempted. What is the URI of the original image? It seems much too large for mobile.
 In both stack traces allocation fails simply because there is no memory left.
Requested 3.5 MB, available 1.6 MB.
Requested 8 MB, available 0.5 MB.

There can be many things causing the memory issues:
- You may have a leak in the application. Check the heap dump with MAT.
- You may have been displaying too many images at once, and not all of them can fit in the memory at once.
- You may need to downscale / resize the image before displaying them.
  You also need to depend on the okhttp libs. See http://frescolib.org/docs/using-other-network-layers.html#using-okhttp
  Hi and sorry for the late answer. Your idea is basically to provide prebuilt .so files developers can add to the jniLibs if needed. This could be an approach but we prefer to built our code from the source. If the problem is the number of .so you can change the Android.mk files in order to merge the libraries into a single one. Anyway we're working to make all Fresco modules optionals so very soon you can decide which library include or exclude. 
  Please see https://github.com/facebook/fresco/blob/master/drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchyBuilder.java#L130
  You are probably not using closing the CloseableReference properly. Please refer to http://frescolib.org/docs/closeable-references.html#_ for the proper usage.
 You dont need to use the Imagepipeline explicitly. SimpleDraweeView does it for you. Also if you use the SimpleDraweeView then you dont have to worry about closing the references as DraweeHierarchy in the SimpleDraweeView handles that. 

In your code snippet, a ControllerListener is not required
So effectively you only need to do:

---

Uri uri;
DraweeController controller = Fresco.newDraweeControllerBuilder()
    .setUri(uri)
    .setAutoPlayAnimations(true)
    . // other setters
    .build();
mSimpleDraweeView.setController(controller);

---

For Understanding Drawee better read these, however you only need anything other than the above snippet for ur purpose.
http://frescolib.org/docs/using-drawees-xml.html#_
http://frescolib.org/docs/using-drawees-code.html#_
http://frescolib.org/docs/animations.html#_
http://frescolib.org/docs/using-controllerbuilder.html#_
 The original cause here should be fixed. However, this also happens if you re-initialize Fresco (call `Fresco.initialize(...)`) more than once. I guess you're doing that according to your other issue (#1397). 
  Hang on. Hopefully soon we will release a sample library that demonstrates how to create zoomable DraweeViews.
 Sorry for the delay. The long-promised sample library is out: https://github.com/facebook/fresco/tree/master/samples/zoomable/src/main/java/com/facebook/samples/zoomable
  10mb per image is a lot more than what I would expect for a single 256x256 pixel image. Why do you multiply number of pixels by 5 \* 6 \* 5 in your formula ? Single pixel occupies 4 bytes. Let's double check how is this big number produced.

For sure the most efficient thing to do is to ask for an image of exactly the size that you want to display.

When it comes to trimming the cache - you can do that. You can use either this method: https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/imagepipeline/src/main/java/com/facebook/imagepipeline/core/ImagePipeline.java#L200, or similar code of your own.
However, I am not sure how much benefit there is in clearing the cache, it probably will be populated with new things soon. I would rather suggest configuring the size of the cache, so that it never goes above a threshold you are comfortable with.
 You should map 50x50dp to your screen pixel size and resize to that. 256x256 is likely too large. When you need the 1080x display, you can issue another request without the resize options. This will not download the image again, the original, unresized image remains in disk cache.
 Please open a new issue if you need more help.
  You could use the imagepipeline to download the pic and then write it to a file. http://frescolib.org/docs/using-image-pipeline.html#_

Make sure you close the references properly. 
http://frescolib.org/docs/closeable-references.html#_
  See here: https://github.com/facebook/fresco/releases 

If you look at the previous releases you can see the number of commits that have been made since that release, and if you click on the link it will show you which commits those are. 
  Yeah that makes sense. 
  One of my colleagues took a look at your sample code.

You load the URI in MainActivity line 101 by parsing a string directly:

```
Uri.parse(arrayList.get(arg0))
```

Because it contains special characters, it should be escaped properly, like:

``` java
String escapeUrl(String url) throws UnsupportingEncodingException {
  return URLEncoder.encode(uri, "UTF-8").replace("*", "%2A");
}
... 
Uri.parse(escapeUrl(arrayList.get(arg0)))
```
  This is a known limitation, which we may fix in the future. If you wish to do it yourself, let me know and I can provide some pointers (it is a pretty easy change). 
 @johnzheng00 I believe this is implemented now with the new 0.9.0 release. Can you check please?
  Looks like a duplicate of #84 
  - Use a ControllerListener as shown here http://frescolib.org/docs/listening-download-events.html#_
-  Note that "onFinalImageSet()" of the ControllerListener would be the ideal place to fire the event and not the postProcessor. If you are using a DraweeView the image would be set in the view automatically. 
- To learn more about the usage of Postprocessor, refer to this:http://frescolib.org/docs/modifying-image.html#_

Hope this answers your question. Please feel free to point out anything which is not clear.
  Can you elaborate? What does not work, exactly? What happens?
  We don't resize images if any of the dimensions is already smaller than what we asked for. We plan to have more resizing options, but for now the workaround would be to specify smaller dimensions: https://github.com/facebook/fresco/blob/master/samples/comparison/src/main/java/com/facebook/samples/comparison/adapters/FrescoAdapter.java#L63
 Fixed in 0.5.2.
  At the moment static gifs go through the same path as animated gifs. They are not represented as Bitmpas but instances of CloseableAnimatedImage. To get that image please use BaseDataSubscriber<CloseableReference<CloseableImage>> instead of BaseBitmapDataSubscriber
  What exactly is the problem ? The image does not load ?
 Do you still experience these problems for Fresco v0.13 and Genymotion 2.8.0? If so, which AVD?
 I'm closing this then. Let us know if you still have issues.
  Do you mean BitmapDrawable$BitmapState ? You should have separate instances of them per every view, but all of them should point to the same placeholder or failure bitmaps. Is that not the case ?
 We should investigate that.
The reference chain should be something like this: View -> Hierarchy -> Drawable -> Bitmap. If the bitmap drawables are piling up, there may be a memory leak somewhere.
 Do **NOT** share the same drawable instance across multiple hierarchies/views. Here is an example of what can go wrong:
Let's say that there are two profile pictures on the screen that are not loaded just yet. Both are displaying a placeholder. Now one of the images load and we fade out its placeholder and fade in the actual image. If you are using the same placeholder instance, both of them will be faded out which is incorrect thing to do.

Perhaps the leak is higher in the stack, rather than in the hierarchy itself. If so, what you really need to do is to find out why do you have that many DraweeHierarchy instances alive. What keeps them alive?
 Also, unless there is a bug in Android framework, there should only be a single Bitmap object on the heap per resource image. There might be many drawables referencing that same bitmap, but it should really be only one Bitmap out there. Is that not so?
However, BitmapDrawable and its BitmapState does not consist only of Bitmap. Other additional information take up some space and if your app is leaking DraweeViews or DraweeHierarchies and therefore Drawables, there will be a memory leak. How many instances of DraweeHierarchy do you see on the heap?
  Quick player refuses to play the video, should I use something else to view it ?
 Normally your placeholder should be specified? What is your placeholder?
 Closing as no response made.
  You need to specify WRITE_EXTERNAL_STORAGE permission in your manifest, don't you ? http://developer.android.com/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE
  Fresco.initialize needs to be called before setContentView in your app.
 You only need to call initialize once per application. You shouldn't be calling shutdown at all, ordinarily.
  Interesting. Cache is one of the places that can keep big bitmaps around. Another place is a view. Do you use Drawee to display images ? Is it SimpleDraweeView or something else ?
 Placeholders are loaded by using the Android's built-in facility `resources.getDrawable`. Fresco doesn't do anything special there.
  Something was wrong with the roundingBorderWidth you specified. What was avatar_border_width?
  Can you try resize the image ? http://frescolib.org/docs/resizing-rotating.html#resizing
  Can you paste here the actual error message you are receiving? 

Did it work when you added all four projects as dependencies?
 Because the Drawee library provides XML attributes, you have to include it as an Android project. It will not work if you add it as a jar.
  Most likely Bitmap class fails to load native code in its static initializer. Can you tell us what is the content of the 'lib' directory in your apk ? (you can unzip the apk to see the directory)
 I see. Can you reproduce this once again and check logcat for earlier errors that happened when bitmaps library was being loaded ?
 Do you have any non-fresco native libraries ? What is in the mips subdirectory ? I could totally imagine this happening on non supported architectures - mips or one of the 64 bit architectures (see https://github.com/facebook/fresco/pull/176). But none of the devices you mentioned seem to fall into this category.
 Reaping.
  Fixed docs.
  Can you paste the XML as well?
 I don't understand the attached image. Where is the background image coming from? or is this the actual image? What are those red circles?
 Reaping.
  BitmapFactory.decode does not allow us to create purgeable bitmaps on 5.0 anymore: http://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inPurgeable
 5.0 IS api 21.
  Fresco does not depend on particular format of url, there is no difference whether there is a suffix or not. There are some limitations when corners of the image can be rounded, see here: http://frescolib.org/docs/rounded-corners-and-circles.html#caveats

Can you provided more details about your use case ? Can you provide more xml and code setting the url ?
 I don't think this has anything to do with urls. Both of them are nearly identical. Also, I've tested both urls and they are properly rounded on my device and with latest Fresco.
 Also, there are some limitations when it comes to rounding animated images, so please check that your image is not animated, or specify or use `OVERLAY_COLOR` rounding mode.
  Please see this blog post: https://code.facebook.com/posts/366199913563917. We are able to do both as explained in the section "Having our cake and eating it too"
  Yes, the ashmem is more efficient. This places bitmaps off the Java heap entirely. We would have preferred to use this solution even on Android 5.0, but unfortunately Google dropped support for it in that release.
  Can you give the full stack trace where the error occurs please? 
 I'm not sure I quite understand your problem then? Which cache file is not found? What are you doing when it is not found? 
 No, we do support custom cache directories. Are you sure that no images are being loaded from disk cache? Can you verify that? What happens when you try to load an image from disk cache? If the cache isn't present I would expect an error of some sort. 
 I understand that. But what happens when you actually try to load an image using Fresco? 
 Are you loading images from network? If the disk cache put fails then I would expect to see this error message: https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/BufferedDiskCache.java#L236

No, if you configure your own custom cache dir then that will be enabled automatically. 
 Ah. Local files are not stored in Fresco's disk cache. 
  Did you follow all the instructions in here: http://frescolib.org/docs/building-from-source.html#configuring-gradle
 duplicate of https://github.com/facebook/fresco/issues/237
  Why do you not want to use the pipeline? I can't think of a disadvantage of accessing it using the pipeline
 You do not need to use extension to detect type of the image, see https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/imagepipeline/src/main/java/com/facebook/imageformat/ImageFormatChecker.java. Checking file name to determine image type is not reliable, images often do not have extension and sometimes they have extensions indicating wrong format.

File names and even the fact that there are multiple files used by the cache are its internal details and you should not depend on that.

What is the problem you are trying to solve that ImagePipeline does not allow you to solve through its API ?
  are you sure it's caused by having the color filter? Can you show me the code that rounds the corners, I suspect it is actually that which is wrong? Also can you give the Uri of the image that you are trying to round the corners of?
 Since the color filter is applied after the image is rounded, it means that the cropping is not applied to it. A potential workaround would be to use a post processor to apply a color filter + round the image.  Please try again with the latest release: https://github.com/facebook/fresco/releases/download/v0.5.0/frescolib-v0.5.0.zip
 File a new issue if this persists.
  You can do `ImagePipeline.evictFromMemoryCache(uri)`. However, that will not remove the image from the disk cache that is #124 (there is a workaround you can use for that specified there too). 
 Is the new image coming from the memory cache or the disk cache? (you might have to add a `RequestListener` to determine this).
  So if I understand correctly, you want to load a picture that is _bigger_ than 4096 \* 4096? What size are you trying to resize it to? 

for 2, can you give a code snippet and also the urls that are failing to load? I wouldn't expect to see these transparent images. 
 What is the image format? Currently only JPEGs get resized
 Ok the issue with 4096x4096 has since been fixed. Latest Fresco will always resize the image to be less than 2048x2048 which is guaranteed to load across all devices.

For the transparency issue, can you show:
- what is the placeholder drawable? It looks like it is transparent
- what is the actual image? same issue
- how are you setting the controllers to the MultiDraweeHolder?
 The latest version of Fresco is 0.5.2.

Your StatusPicView should override the methods as described here: http://frescolib.org/docs/writing-custom-views.html#handling-attach-detach-events. I think the Chinese translation may not be quite up to date.
 I don't know what you mean - 'carton' is probably not the right word.

Non-JPEG images must be less than 2048 x 2048 or they will not be displayed. Resize options do not apply for non-jpegs, even in the latest version.

I am going to close this issue for now; open a new one if you need it. Please only ask one question per issue. If you have more than one question, open more than one issue.
  I'm not totally clear on the relation between the error, and the code you have given that presumably is part of your build.gradle. Do you think that part of your build.gradle is causing the problem, or what? 
 Do you get this behavior on 64bit device ? Can you unzip the apk and tell us what is there inside "lib" directory ?
 reaping
  The maven docs will be done in due course. What is it that you would like the Intellij docs to contain? I.e. what is your use case? 
 Yeah it was removed as there were problems - it will be added back in by @tyronen once it is fixed. 
  Do you get any other logs? Can you give examples of uris that fail to load? 
 It looks like images are not properly released. They should be released when you scroll an image off the sceen, but aparently they are released only by garbage collector. Could you verify SimpleDraweeView gets all the attach/detach events ? https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/drawee/src/main/java/com/facebook/drawee/view/DraweeView.java#L101-L123
 None of the 4 methods is executed ? Do you use custom views ? Can you share content of adapt_refresh_item.xml ?
 This issue has been untouched in over two years so I'm going to close.

If this is still causing an issue for anyone, please reopen.  Same as #22 
  You should do `getResources().getColor(R.color.red)`
  Fresco currently does not support such big images. 12000 pixels in one dimension seems pretty big...
 Fixed in 0.5.2. We now resize your image to a max of 2048 x 2048 in either dimension.
  There seem to be two separate issues here. For the first, I have updated the example in the docs to include the executor, which I guess is what you mean. 

For the second, I suggest you do not use RelativeLayout.setBackground(drawable), but instead have a SimpleDraweeView that is the same size as the RelativeLayout. That will ensure that your memory is released when it should be, rather than you having to worry about that yourself. 
  Hi,
At first it does not sound like an issue with fresco but rather gradle or gralde build script. I expect that the libraries are not included when packaging the final apk. You can unzip your apk and check if files are there. If no, can you provide more details on how do you tell gradle to include 2 missing libraries in the final apk ?
  Please can you give more of the stack than this - we can't work anything out from the small sample that you've given. 
 Is this in your app, or the sample app?

This happens if a CloseableReference has not been finalized. Are you calling the image pipeline directly or using Drawee? If the pipeline, are you closing all your CloseableReferences correctly?
  I just retested this and it works fine, can you provide a code snippet so that we can try to work out what's going wrong? 

Also, why do you have a transparent overlay?
 Oh okay. That is fixed now though so you shouldn't need it. 
 Can you provide the code snippet that you are using? It is strange that this is not working for you. What version of Fresco are you using? 
 reaping
  We're working on reducing size library making all modules optionals. Stay on tune!
 With v0.10.0 we split Fresco up in a couple of separate AARs to make the core library smaller, see http://frescolib.org/docs/index.html
  Could you give a code snippet please? 
 The problem here is actually related to your use of rounded corners - please see the caveats section in the docs: http://frescolib.org/docs/rounded-corners-and-circles.html#caveats. If you want to use CENTER_INSIDE then you are advised to use the OVERLAY_COLOR rounding method rather than the default BITMAP_ONLY rounding method. 
 There is a fix coming for this, but it still breaks if you set RoundingParams with each corner having radius 0. Can you remove the `.setRoundingParams` line and see if it works after that? 
  As NNirvana says, please don't keep filing issues for the same problem. If you are able to investigate yourself, that would be great. We have many things on our to-do list at the moment. 
  Can you print out your uri please? It needs to match something on this page: http://frescolib.org/docs/supported-uris.html#_
 Please see the `Note:` section here: http://frescolib.org/docs/supported-uris.html#_

It sounds like you are trying to load an XML drawable - instead, please set the drawable to be the placeholder and set the image URI to be null. 
  Can you give us a code snippet please? (that constant is not the problem)
 Hmm...what version of Android are you using? 

Do you have any errors in logcat that might be related? We'd expect to see something here. 
 Unfortunately we are not currently sure what is causing this issue, and we don't have time for an in-depth investigation right now. 

I suggest you try adding a listener to your drawee controller, and maybe to the image pipeline too, that will enable you to help debug where the images are getting lost.

What format are your images? We currently only resize JPEG so perhaps that is causing a problem? 
 There were issues with loading large numbers of images at once. Things should be better in v0.6.0.
  Can you try again? Seems like it's probably a transient issue. 
 Looks like you're having trouble connecting to sourceforge. There are two options for you: 

1, Do you have to build from source, or can you just use the instructions on this page: http://frescolib.org/docs/index.html#_

2, Try downloading the sources you need directly from sourceforge and put them into nativedeps/downloads. The sources you need are all specified here: https://github.com/facebook/fresco/blob/master/imagepipeline/build.gradle#L70-L96
  What is the image that is failing to load? 
 reaping
  You can do the following: 

`Fresco.getImagePipelineFactory().getMainDiskStorageCache().getSize();`
  Can you post a code snippet please? 

Also, what do you mean by "occasionally appear in the list"? Does this also happen for some other urls? 
  If you don't need to do anything at all with the bitmap, then why have a postprocessor at all? Can't you just use `ImagePipeline.fetchDecodedImage(..)` and subscribe to that `DataSource`, which will give you a bitmap? 
 Yes, you are right that the requests will only download one image because they use the same uri. 

Can you explain what you want to do with the Gaussian Blur bitmap? Are you putting it into the same SimpleDraweeView as (1), or somewhere else? It seems like for (2) you should be using a postprocessor, but not for (1). 
 In that case you should use a Postprocessor to do the Gaussian Blur. 
 Subclass BasePostprocessor, and then if you are able to do Gaussian Blur in-place, you should override `process(Bitmap bitmap)` (the pipeline will then return this bitmap) or otherwise override `process(Bitmap destBitmap, Bitmap sourceBitmap)` (the pipeline will return `destBitmap`)
 You always need to copy the source bitmap if you are going to do a Gaussian Blur on it, since that source bitmap might be used in other places (e.g. for you, it will be used in request (1) that you mentioned above). 

Therefore you should use one of the methods I suggested - which one you use depends upon whether your blur is done in-place or not, but either way you should not touch the source bitmap. 
  You just need to make sure that you close the bitmap you have once you've finished with it. In the case of sharing to a social app, I expect that the app will make its own copy of the bitmap, so you can use BaseBitmapDataSubscriber just fine. 

If you need the bitmap to stay around longer than the life of `onNewResultImpl(Bitmap bitmap)` then you should instead subclass `BaseDataSubscriber` and extract the bitmap yourself - then you can close it when you want to (just make sure you do!). 
 Depending upon your pipeline configuration, you may run out of memory if you have too many bitmaps at once - are you resizing them? If not then it's quite likely that you will run out of memory. 
 you should see some errors logged if that is the case
 What format is the image that isn't loading? 
  Can you just use standard Android click events to achieve what you need? 
 Can you use GenericDraweeHierarchy.getActualImageBounds for your use case perhaps? 
  If your images are too large, then you will run out of memory. Can you try setting a size for the images too so that they can be resized, and then hopefully you won't run out of memory?
 Because you have run out of memory - if the other 25 images are still in memory, then that's likely to be too many. Are the other images being removed from memory? What are you using to lay out the 30 SimpleDraweeViews (ListView, RecyclerView etc)? 
 Hmm...that is a crazy number of bytes, I am not sure what's going on there. Are you getting this warning when trying to load the single image? Could you give a code snippet and the url that you are using.  
 Fresco will refuse to decode more images if you hit one of the limits: https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/BitmapCounterProvider.java (on dalvik) and https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/imagepipeline/src/main/java/com/facebook/imagepipeline/memory/DefaultBitmapPoolParams.java#L34-L41 (on art).

For changing the limit on art have a look at PoolConfig, PoolFactory and configuring ImagePipeline (http://frescolib.org/docs/configure-image-pipeline.html, http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/memory/PoolConfig.html, http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/memory/PoolFactory.html)

I don't think we have an API for changing the limit on dalvik, we probably should have. 
 Anyway, bumping the limit is not necessarily the right solution. Can you use smaller images instead ?
 "View too large to fit into drawing cache, needs 198223200 bytes, only 8294400 available"

Do you realize that 198223200 is nearly 200MB?
 Fixed in 0.5.2. Fresco will resize your image down to 2048 x 2048 maximum.
 Not yet, but we are looking into adding this feature.
  Thanks for pointing these out - should now be fixed! 
  Please note the caveats section of the docs (http://frescolib.org/docs/rounded-corners-and-circles.html#_) - only `BitmapDrawable`s and `ColorDrawable`s can be rounded. If you're using a different type of drawable, perhaps consider using the `OVERLAY_COLOR` rounding method instead. 
  When the log "Draw requested for a non-attached controller ..." show, the app can't show any image via fresco (any image view, any images).

Kill app and restart IT IS only temp solution.

The log like:

> Draw requested for a non-attached controller 2ccc3dce. DraweeHolder{controllerAttached=false, holderAttached=true, drawableVisible=false, activityStarted=true, events=[ON_DETACH_CONTROLLER, ON_CLEAR_OLD_CONTROLLER, ON_SET_CONTROLLER, ON_ATTACH_CONTROLLER, ON_DRAWABLE_HIDE, ON_DETACH_CONTROLLER, ON_ATTACH_CONTROLLER, ON_DETACH_CONTROLLER, ON_CLEAR_OLD_CONTROLLER, ON_SET_CONTROLLER, ON_ATTACH_CONTROLLER, ON_DRAWABLE_HIDE, ON_DETACH_CONTROLLER, ON_ATTACH_CONTROLLER, ON_DETACH_CONTROLLER, ON_CLEAR_OLD_CONTROLLER, ON_SET_CONTROLLER, ON_ATTACH_CONTROLLER, ON_DRAWABLE_HIDE, ON_DETACH_CONTROLLER]}
 Are you using a SimpleDraweeView or using DraweeHolder directly? If the latter, make sure you are handling [attach/detach events](http://frescolib.org/docs/writing-custom-views.html#handling-attach-detach-events) correctly.

If you are, please post a code snippet to help debug.
 I am not custom the SimpleDraweeView and not using DraweeHolder directly.

Sometime, the app would could not show any images, until I clean all file cache...
 ``` java
final SimpleDraweeView imageView = (SimpleDraweeView) view;
      // Initialize controller, to support callback.
      final PipelineDraweeControllerBuilder controllerBuilder = Fresco.newDraweeControllerBuilder();
      if (imageUrl != null &&
          backupUrl != null &&
          !backupUrl.equals(imageUrl)) {
        // Has backup.
        ImageRequest imageRequest = ImageRequest.fromUri(imageUrl);
        ImageRequest backupRequest = ImageRequest.fromUri(backupUrl);
        controllerBuilder.setFirstAvailableImageRequests(
            new ImageRequest[] {imageRequest, backupRequest});
      } else {
        // No backup, simple set url.
        controllerBuilder.setUri(imageUrl == null ? null : Uri.parse(imageUrl));
      }
      controllerBuilder.setAutoPlayAnimations(true);
      final DraweeController controller =
          controllerBuilder.setControllerListener(
              callback == null ? null : new BaseControllerListener<ImageInfo>() {
                @Override
                public void onFinalImageSet(String id, ImageInfo imageInfo, Animatable animatable) {
                  if (callback == null) {
                    return;
                  }
                  if (imageInfo == null) {
                    callback.loadCompleted(imageView, null);
                    return;
                  }
                  callback.loadCompleted(imageView,
                      new Image(imageInfo.getHeight(), imageInfo.getWidth()));
                }

                @Override
                public void onFailure(String id, Throwable throwable) {
                  if (callback == null) {
                    return;
                  }
                  callback.loadCompleted(imageView, null);
                }
              })
              .build();
      // Initialize hierarchy to support default image.
      if (defaultImage != NULL_IMAGE_RESOURCE) {
        GenericDraweeHierarchy hierarchy = imageView.getHierarchy();
        if (hierarchy == null) {
          hierarchy = new GenericDraweeHierarchyBuilder(imageView.getResources())
              .build();
          imageView.setHierarchy(hierarchy);
        }
        hierarchy.setPlaceholderImage(defaultImage);
      }
      // Start to load.
      imageView.setController(controller);
```
 What are the parent views/layouts of SimpleDraweeView? It is possible that one of them is not sending attach/detach events reliably.
 We use it everywhere, maybe a RecyclerView, a ViewPager, a FrameLayout ...

And sometime, the app can not load any image again, until clean cache and kill the app.
 The RecyclerView children should be fine, but FrameLayout and ViewPager may not be sending the attach/detach events.

If you know when your child image is going off-screen, call onStartTemporaryDetach at that point. When the image comes back on screen, call onFinishTemporaryDetach. (RecyclerView will do this automatically). 
 @tyronen If don't do this, what happen? The app may not load any images?
 Fresco needs to know when your image is off-screen in order to release the images' memory. And it needs to know when your image is on-screen, or you'll get the error above.
 @tyronen I know that, it's hard to know when to off-screen and in-screen in my app, any best practice?

And if the error throw, what's happen?
 I'm cleaning up very old issues and this should no longer result in errors anyway.  Why, this is splendid! ëŒ€ë‹¨ížˆ ê°ì‚¬í•©ë‹ˆë‹¤! Yes, we welcome more translations.

Please be sure to keep the documents up to date when the English ones are updated. I believe GitHub lets you subscribe to notifications of changes.
  Most apps only use one cache. So by default, the small disk cache is the same as the main disk cache.

You have to explicitly call `setSmallDiskCacheConfig` with a different config, as explained in http://frescolib.org/docs/caching.html#using-one-disk-cache-or-two
  An image of this size is much too large for a mobile screen, and the device's OpenGL subsystem won't be able to handle it. You have to [resize](http://frescolib.org/docs/resizing-rotating.html#resizing) it first.
  Can you share a code snippet?
 We don't support postprocessing for animated images: http://frescolib.org/docs/modifying-image.html#things-to-know

You also can't use BaseBitmapDataSubscriber for an animation. Use [BaseDataSubscriber](http://frescolib.org/docs/datasources-datasubscribers.html#general-purpose-solution) instead.
  When configuring the image pipeline [to use OkHttp](http://frescolib.org/docs/using-other-network-layers.html#using-okhttp) you pass it the OkHttpClient. You can hold onto that reference and call any of its methods whenever you need to.
  You could add the individual artifacts to your .pom file, does that work?
 It looks like this is a bug in Gradle. The fix is to add '@aar' to the compile dependencies in the build.gradle files.
  Please also set a size for your cache using `setMaxCacheSize`
  The most recent releases of Fresco don't require libgnustl_shared.so anymore though. What version are you using?
 Fresco does not put any libraries in "lib/arm64", it will be fixed by https://github.com/facebook/fresco/pull/176 soon. 

There is something about the stack trace I cannot explain though. System tried to load gnustl_shared, @elikohen did you get this stack trace with fresco earlier than 0.3.0 ? Since v 0.3.0 NativeMemoryChunk does not depend on stl and unless you used old fresco version there is something else wrong as well.
 We have improved 64-bit handling in v0.5.1. If this issue persists there, please file a new issue.
  You can use the [low-res/high-res scheme](http://frescolib.org/docs/requesting-multiple-images.html#going-from-low-to-high-resolution) for this purpose. Despite the name, the low-res request can be for any image; it will be the placeholder for the 'main' request.
  You can simply use the [image pipeline](http://frescolib.org/docs/using-image-pipeline.html#skipping-the-decode) to retrieve the encoded image out of cache. Then just save it to a file.
  Can you post a snippet of the code that is not working?
 reaping
  Can you provide a snippet of your code and XML, if you are using it?
 Hi @nikslushkin - I'm just wondering why you have the `setImageFromCache` code. Drawee will automatically look in the cache first, so you should just remove the line beginning `boolean imageSet...` and remove the `if (!imageSet)`, and then it will work again for you. 
  Yes please update your proguard config to match what rockerhieu has pointed to. 
  I don't understand what you are trying to say. I don't think "fluency" is the right word?
  Can you provide a sample URL and screenshot?
 Yes, this is a limitation. We don't support rounded corners for animated images.
 Hi Chad. You will be able to round an animated image if you use the `OVERLAY_COLOR` rounding method, rather than `BITMAP_ONLY` rounding method (which is the default). Try using: `RoundingParams.asCircle().setRoundingMethod(OVERLAY_COLOR).setOverlayColor(your_color)` instead. 
  The server has to support these URLs though. We can't build a general-purpose solution.

Glide does provide an API for this, but the only two implementations I could find are specific to Giphy and Flickr.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 Thanks for this change! Sorry for the delay in getting back to you.

Unfortunately this didn't quite work as is. Can you rebase it? 

Also, rather than repeating the versions in each gradle file, could you put them in the gradle.properties file instead?
 Added in modified form.
  The [web site](http://frescolib.org/docs/configure-image-pipeline.html#_) has the most up-to-date documentation.
 Fix is on its way. 
  Do you have more of the stack trace than that? Can you show us the XML or code you built the hierarchy with?
 reaping
  Please provide screenshots and code snippets.
  This is on its way. 
  You need to add either fresco or drawee-volley. We recommend fresco - drawee-volley doesn't use the image pipeline but Volley image loader instead to power drawees.

We are aware of the apk size issue and are working on it.
  What version of Android are you running? What versions of Android do you support in your manifest file?
 What do you have for minSdk and targetSdk in your `AndroidManifest.xml` file?
 Ok I now think your logcat messages have nothing to do with it. Actually the problem is that you are using layout_height wrap_content. [Fresco does not support this type](http://frescolib.org/docs/using-drawees-xml.html#wrap-content).
  There was an error in the uploaded Eclipse zip file. This has been fixed.

Can you try again using the [instructions here](http://frescolib.org/docs/index.html#eclipse-adt)?
  I doubt we will have time to do this properly anytime soon. However, if you wish to make a pull request and add it yourself, then I don't think it would be too difficult. You would just need to add `CENTER_TOP` to the `ScaleType` enum in `ScalingUtils`, and then add an extra case in `getTransform` - the new case will be very similar to `CENTER_INSIDE`, except that `dy` will be 0 (at least, I think that's what you want from the description you've given). 
 Great news! We're going to release this very soon.
 This has been added a while ago, see http://frescolib.org/docs/scaling.html for more details!
  The ones you list are in alphabetical order. It's of the variable name, not the type.
  The comments are a leftover from earlier implementations. We originally didn't load images while scrolling, but discovered that Fresco is fast enough that users vastly prefer it when we do.
  Download the [okio jar](https://search.maven.org/remote_content?g=com.squareup.okio&a=okio&v=LATEST) and put it in the frescolib/imagepipeline-okhttp/libs directory. I'll fix future zip files to include these automatically.
 That wouldn't help this problem - you have to have the okio jars.
 There was a problem with the [zip file](http://frescolib.org/docs/index.html#eclipse-adt) which is now fixed.
  Follow in #213.
  The general solution to this is to make use of a [MemoryTrimmableRegistry](http://frescolib.org/docs/caching.html#trimming-the-caches):

``` java
class MemoryManager implements MemoryTrimmableRegistry {
  List<MemoryTrimmable> trimmables;
  void registerMemoryTrimmable(MemoryTrimmable trimmable) {
    trimmables.add(trimmable);
  }

 /// some code that gets called when memory is low, or when you get this exception
 for (MemoryTrimmable trimmable : trimmables) {
    trimmable.trim(/* choose appropriate type here; OnAppBackgrounded will clear the cache */);
}
```
 However, step back a bit. TooManyBitmapsException usually means you have too many bitmaps open. What is your application doing?
 What are the parent views/layouts of the DraweeViews?
 Are you using Drawee, or are you just using the image pipeline directly? 
 http://frescolib.org/docs/caching.html#clearing-the-cache
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Are you doing anything combining Weibo with Fresco? eg using Fresco images to pass to Weibo? Can you also post a code snippet?
  When [constructing the hierarchy](http://frescolib.org/docs/using-drawees-code.html#customizing-the-hierarchy), use the [setActualImageMatrix](http://frescolib.org/javadoc/reference/com/facebook/drawee/generic/GenericDraweeHierarchyBuilder.html#setActualImageMatrix%28android.graphics.Matrix%29) method.
  Does this happen without proguard as well ?
 @duguguiyu your config looks good to me :)
We'll put something about configuring proguard in the docs.
  It seems that the easiest solution right now is to use `OVERLAY_COLOR` instead of `BITMAP_ONLY` for  rounding the corners, see [the documentation for rounded corners](http://frescolib.org/docs/rounded-corners-and-circles.html).

You can take a look at the discussion in #153 for more details why this is happening @show111.
  These are not actually Fresco logs, but logs from the Android OpenGL subsystem. They are at the debug level, so [setting your log level](http://developer.android.com/reference/android/util/Log.html#isLoggable%28java.lang.String, int%29) to info or higher will do it.
  This does count as a bug, but a low-priority one.

.BMP files are not compressed. They will take up excessive space on your users' disk, and if downloaded will eat their data usage and slow down their download. Are you sure you really need to use them?
 Yes.
 Fixed in 0.5.1.
  1) Only the decompressed version. The resized encoded image is not yet cached.
2) Yes.
3) Yes, but for most apps this isn't going to make much difference. 
  Is your problem:
1) the images do not load at all?
or 2) the images do load, but are unclear?

I also do not recognize the `Device` class you are using. Try this instead:

``` java
DisplayMetrics metrics = new DisplayMetrics();
getWindowManager().getDefaultDisplay().getMetrics(metrics);
... newResizeOptions(metrics.widthPixels / 6, metrics.widthPixels / 6)...
```
 reaping
  The easiest way for a Notification is to [use BaseBitmapDataSubscriber](http://frescolib.org/docs/datasources-datasubscribers.html#i-just-want-a-bitmap). Inside the `onNewResultImpl` method, you can call [NotificationCompat.Builder.setLargeIcon][http://developer.android.com/reference/android/support/v4/app/NotificationCompat.Builder.html#setLargeIcon\(android.graphics.Bitmap\)). Then you don't have to worry about closing the bitmap.
 No. Internally, Android copies the Bitmap in order to send the data over to the notification or remote view process. So you don't need to keep a reference to it after you have copied it. I can add this to the docs.
  Does your project already depend on nineoldandroids? If it does, try excluding it:

``` groovy
compile('com.facebook.fresco:fresco:0.4.0') {
  exclude group: 'com.nineoldandroids', module: 'library' 
}
```
 Is there a library-2.4.0.jar file inside your libs directory? If so, delete it.
  You can [configure the image pipeline](http://frescolib.org/docs/configure-image-pipeline.html#_). Use [DiskCacheConfig.setBaseDirectoryPath](http://frescolib.org/javadoc/reference/com/facebook/cache/disk/DiskCacheConfig.Builder.html#setBaseDirectoryPath%28java.io.File%29) and setBaseDirectoryName to determine where the cache goes.
  RoundingMethod cannot be changed when changing dynamically.
http://frescolib.org/docs/rounded-corners-and-circles.html#_

This was the issue:

```
 RoundingParams roundingParams = view.getHierarchy().getRoundingParams();
 roundingParams.setRoundAsCircle(true);
```

The workaround is to build a new hierarchy as you already did in your next comment.
  So the image does load, but shows a bogus error message? Not sure that's worth worrying about, or do you mean that the image does not load? Can you upload the image?
 Fixed in v0.8.0.
  Bitmap should be ARGB_8888.
What color is set to `mask.getPaint()`? On some Samsung devices default paint color is FF000000, i.e. black, not transparent. Can you do `mask.getPaint().setColor(0)` before calling mask.draw?
Also, I don't see what is mask doing exactly, so can't provide more help without having more details.
 Can you try this:

```
result.setHasAlpha(true);
```

Let us know if that works.
  There was an issue with non-animated GIFs that was fixed in 0.5.1.
 @markfili, thanks for the info ðŸ‘ 
  See #178 
  Are you setting the low-res and image request to the same URL? Can you tell us one such URL that is failing?
What does holder.imageProduct1 look like?
 reaping
  Hmm is this using #176? I think we'll need to edit the productFlavors closure in the sample app's build.gradle.
  Can you try again and see if this is still happening in v0.5.1?
 I'll take it that's a no.
  This is the same as #181.
  wrap_content in both dimensions is [not supported](http://frescolib.org/docs/using-drawees-xml.html#wrap-content).

In the example you gave, you should just set the XML width and height to the values you want.
 See your comment in #753
  Can you upload a video? What format of images are you showing, and are they network, or local?
 Can you show us a code snippet?

I also wonder why only one image is affected. What kind of image is it (gif, jpeg, etc)? Is it animated?
 @raylee4204 - you will see this because your request includes a postprocessor, and at present postprocessed images are not stored in bitmap cache, so the postprocess step has to take place again which causes a flash. 

@lushan1314 - please can you answer @tyronen's latest question so that we can try to help you? 
 It's #14 - but I don't know when/if it will get done unfortunately. 
 Can you give a uri for the image that failed please? 
 As @IanChilds explained, the flash may happen if you are re-setting the image to the view and the image is not found in the bitmap cache.
Postprocessed images are not stored in the bitmap cache, but we are working on supporting this as we speak.
Animated images are also not stored in the bitmap cache and therefore they are susceptible to this issue. Up until recently, Fresco didn't distinguish between animated and static GIFs so the issue used to affect the static GIFs as well. This has been fixed and static GIFs should no longer be affected by this issue.
That being said, with the current version of Fresco, you should only experience this issue with animated and postprocessed images.
 This may have been fixed now.
  What was the problem?

Was the link you posted the original image, or what it looked like with Fresco? Please post both so we can have an idea. Also please tell us the XML or code you used to round the image.
 Can you post a screenshot of what the image looks like in your app?
 It turns out that this image is actually a GIF, rather than a JPEG. 

We currently have a bug whereby we always decode GIFs as animated GIFs, even if they are not animated, and we don't round animated images when the rounding method is BITMAP_ONLY. I suggest perhaps using the rounding method OVERLAY_COLOR, which looks like it will work for you if you use the same overlay color as your background. 
 Fixed in 0.5.1.
  1) Can you attach a stack trace of the OOM?
2) Are you using `roundWithOverlayColor`? If you do, do you still get the OOM? 

But in general, very large images should indeed use ResizeOptions. You can try something like this:

``` java
LayoutParams layoutParams = simpleDraweeView.getLayoutParams();
int width = layoutParams.getLayoutWidth();
int height = layoutParams.getLayoutHeight();
ImageRequest request = ImageRequestBuilder.newBuilderWithSource(uri)
    .setResizeOptions(new ResizeOptions(width, height))
    .build();
PipelineDraweeController controller = Fresco.newDraweeControllerBuilder()
    .setOldController(mDraweeView.getController())
    .setImageRequest(request)
    .build();
mSimpleDraweeView.setController(controller);
```
 Okay, so what did you see? If your app crashed, please provide a dump of [logcat](http://developer.android.com/tools/debugging/debugging-log.html).
 Yes, your bitmap is too large. You have to resize it.
 The crash isn't caused by running out of memory. It's caused by the OpenGL hardware that actually displays the image. This cannot render a resolution greater than 4096 x 4096, as your earlier log indicated.

You must always resize your images to smaller than 4096 x 4096.
  The disk cache does not expire anyway.

Using all the disk space is possible, but you should only do it if your app is the only app on the device. Otherwise, other apps won't be able to run if your app is hogging all the disk space.

You use the [DiskCacheConfig](http://frescolib.org/docs/configure-image-pipeline.html#configuring-the-disk-cache) class. Set a cache size equal to the physical storage space available on the device.
  XML drawables are indeed supported. The limitation is only that they cannot be rounded.

Pressed-state overlays are, indeed, an overlay - they don't hide the original.

Thinking out loud, you might be able to get this to work with a `StateListDrawable`, but you'd need to use Java rather than XML. You would have to make use of a [DraweeHolder](http://frescolib.org/docs/writing-custom-views.html#_):

``` java
DraweeHolder holder;
StateListDrawable selector = new StateListDrawable();
selector.addState(new int[] { android.R.attr.state_enabled }, holder.getTopLevelDrawable());
selector.addState(new int[] { android.R.attr.state_pressed }, pressedStateDrawable);
imageView.setImageDrawable(selector);
```

You would still have to handle attach/detach events, as explained in the docs.
 I'm just curious, is the pressed image just a darker variant of the original image?
Are both images network/local fetched images or are those resources bundled with the apk?
  You retrieve a file from cache the same way you originally requested it. The pipeline checks for it in cache first, and resizes it according to your request.
 Ah, what you are asking for is the resized image to be kept in disk cache.

I wouldn't recommend using a sync call though - you generally don't want to block the UI waiting for a disk read. 
 We have recently introduced [downsampling](http://frescolib.org/docs/resizing-rotating.html#downsampling), which, although not the default yet, will mean there is no longer a resized image to be kept in cache.
  Hm, it looks like cancellation is not being implemented correctly.

As a workaround you can use [OkHttp](http://frescolib.org/docs/using-other-network-layers.html#using-okhttp).
 Stepping back - what kind of pictures are these? Network images, local files, resources, content provider?
 Yes, a video would be helpful.

Are these images JPEGs? Are you resizing or scaling them?
 Also please try again with today's release (0.4.0). It's possible that will fix this issue.
  We don't yet support this.
 Pull-requests are welcome. Just saying :)
 We're internally working on an improved version that supports this - but it's going to take some time until it is ready. So if you need it sooner feel free to submit a PR.
 We've released [Fresco v1.4.0](https://github.com/facebook/fresco/releases/tag/v1.4.0), which includes a new implementation for animated GIFs and animated WebPs.

You can now set  an [animation listener](https://github.com/facebook/fresco/blob/master/animated-drawable/src/main/java/com/facebook/fresco/animation/drawable/AnimationListener.java) to get notified about these events.

You can use a `ControllerListener` to attach the `AnimationListener`:
```
Fresco.newDraweeControllerBuilder()
      .setImageRequest(imageRequest)
      .setAutoPlayAnimations(true)
      .setControllerListener(
              new BaseControllerListener() {
                  @Override
                  public void onFinalImageSet(
                          String id, 
                          @Nullable Object imageInfo, 
                          @Nullable Animatable animatable) {
                      if (animatable != null) {
                          AnimatedDrawable2 animatedDrawable = (AnimatedDrawable2) animatable;
                          animatedDrawable.setAnimationListener(yourAnimationListener);
                      }
                  }
              })
      .build()
```  OK I see. I was able to reproduce this too.
 Fixed in v0.8.0.
 Hi @haseebrabbani and @nicolasbrugneaux,

The loop count for GIFs should be fixed by https://github.com/facebook/fresco/commit/95359b9cb7650cf00b362ffbc018e90d503d476b which is included in 0.13.0. If you upgrade to the latest release, things should be alright for GIFs.
  It works because `RequestLevel.DISK_CACHE` means that we just look in Fresco's disk cache, whereas `RequestLevel.FULL_FETCH` means that we actually look in the file that you have specified. 

It does look like you have uncovered a bug though - we should fix that but you can proceed using `FULL_FETCH`. 
 Sorry, my answer was not clear. It is not a bug that we just look in Fresco's disk cache when using `RequestLevel.DISK_CACHE`. But it is a bug that if we don't find anything in the disk cache, then we get the NullPointerException you pasted above. That's what we will fix. 
 Fixed in source.
  The most likely reason why it doesn't work is because the drawable used by Drawee doesn't expose its intrinsic dimensions (i.e. it always returns -1). Because of that `PhotoViewAttacher` cannot determine the size of the image.
The reason why Drawee top-level-drawable doesn't expose its intrinsic dimensions is because intrinsic dimensions change when the image loads. In particular, first the placeholder drawable is displayed and therefore the intrinsic dimensions should be that of the placeholder drawable. Then once the actual image loads, for a brief period of time, during the fade animatiom, both placeholder and the actual image are visible. It is not clear what intrinsic dimensions should be reported at that time (perhaps max of the two?). Finally, once the fade animation is over, the intrinsic dimensions should be that of the actual image. Drawee knows how to handle those changes gracefully, but we cannot assume the same for the containing image view. Therefore, we decided not to return intrinsic dimensions and to handle scaling internally instead.

I don't think PhotoView / PhotoViewAttacher can easily be made work with Fresco because PhotoViewAttacher relies on ImageView and Drawee doesn't support ImageView attributes. For example, PhotoViewAttacher sets `MATRIX` scale type and then tries to set the matrix to the ImageView.

There is however a way to make Drawee work with some zoomble logic. First, you need to specify a controller listener while building the controller, so that you can intercept the load events (onFinalImageSet for example). See http://frescolib.org/docs/listening-download-events.html#_
Then, when the image gets loaded, you can enable your zoomable logic and inform it about the image dimensions. To get the bounds of the image in the view, see [GenericDraweeHierarchy.getActualImageBounds](https://github.com/facebook/fresco/blob/e46dab3c2beac3f16163e8593f8a74840606aaef/drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchy.java#L599).
  setThreadStatsTag would have to be called from the thread itself, so right now we don't have such a hook.

It wouldn't be hard to add it - the tag could simply be specified at image pipeline configuration, and HttpUrlConnectionNetworkFetcher could kick off its threads will a runnable setting the tag.
 Closing as a possible solution was suggested and nothing further has been updated for 2 years  I'll run some tests before merging.
 Sorry for keeping you waiting, we are still waiting for 64bit device.

Fortunately the issue happens on all architectures, so I am able to repro this. There are some leftovers, new long fields are accessed as int fields. I was able to mark 4 of those places in the diff, but there are 8 more. To get all of them covered we would have to replace all occurrences of "I" (with double quotes) in webp.cpp and gif.cpp with "J" (this will tell JNI that we are looking for long fields rather than int fields), as well as "(I)V" in the same files with "(J)V" (this will tell JNI that the constructors we are looking for take long as the only argument. With those changes I am able to run this on non 64 bit device.
 You have to use the correct ABIs, see http://frescolib.org/docs/multiple-apks.html    ./gradlew clean and try again

If that does not succeed, try `cleanAll` instead, and remove the `imagepipeline/nativedeps` directory.
 It's hard to tell. Probably there was a problem with the original download, and trying it again is all it takes.
  Duplicate of #138 
  `wrap_content` is not supported for SimpleDraweeViews, unless you call `setAspectRatio` in Java code.

If you want the image to keep its original aspect ratio, and at build time you know neither what that is nor the size of the parent, you can do this in your SDV:

```
android:layout_width="match_parent"
android:layout_height="0dp"
android:layout_weight="1"
```
 The reason why `wrap_content` and `adjustviewBounds` are not supported is explained in http://frescolib.org/docs/using-drawees-xml.html#_
If you absolutely need to achieve this functionality (even though it would not look pleasant to the users as the views will jump on screen as images start to arrive), you can do it as follows:

In XML do:

```
android:layout_width="match_parent"
android:layout_height="0dp"
```

In Java, instead of just setting the URI, you'll have to build a controller and set both URI and a controller listener, like explained here: http://frescolib.org/docs/listening-download-events.html#_
In `onIntermediateImageSet` and `onFinalImageSet` methods do this:

```
mSimpleDraweeView.setAspectRatio((float) imageInfo.getWidth() / imageInfo.getHeight());
```
 `wrap_content` should work correctly as long as the other dimension is not `wrap_content` too and aspect ratio other than 0 is set.
Yeah, in some cases `0dp` doesn't work and `wrap_content` has to be used, we should amend the documentation.
  Do you use proguard ? If so, please include this in your proguard script: https://github.com/facebook/fresco/blob/master/fbcore/src/main/java/com/facebook/common/internal/proguard_annotations.pro
  Can you tell us about your build setup? How is Fresco included in your build.gradle file?
 Is this caused by proguard as well ? (https://github.com/facebook/fresco/issues/172, https://github.com/facebook/fresco/issues/105)
 @gewuxy Please update to a newer release of Fresco, the latest is 1.2.0. It is much safer not to use + in a gradle import since that means that you can get mismatched versions (like in your case).  Can you tell us the difference between the first and second folders' URIs?
 Are these two images the same format? ie are they both JPEG images? or is one of them different from the other?
 Cleaning up old issues.  Rounded corners are supported for GIFs. If the GIF is an animation, you must specify an overlay color for it to work.  Something like:

``` xml
fresco:roundWithOverlayColor="@color/blue"
```

Let me know if this works for you.
 There is no way (as far as I know) of PorterDuffXfermode being sufficient to draw rounded corners (unless, of course, a temporary bitmap is being used). I've seen some attempts that might happen to work in some cases, but this is Android bug and/or yet another software/hardware rendering inconsistency.

For Executor, see http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executor.html
We should probably add some documentation on when to use a background thread executor, ui thread executor or same thread executor.
  Can you give us the uri of the GIF that failed please?
 reaping
 EricRGC: can you provide urls ?
 @IanChilds @plamenko 
i use 0.8.1 it still happend and http://ww4.sinaimg.cn/bmiddle/6d87e02fjw1ezjzc314x2g20ao0607uw.gif
 hope fix this and release 0.8.2 soon we are wait for this to be fixed to upload our app
Thank you for your great jobs!
 this still not fixed in 0.9.0 
 http://p3.pstatp.com/large/2ce000064e9f0b034f1
 Gif and animation support has been rewritten since 0.9.
If the problem still exists in the latest release, please file a new bug report.  Hi. No, this is not a proper way of doing it as the source bitmap can be recycled immediately after this method finishes. I'd strongly suggest that you don't deal with CloseableReferences as it is easy to get the things wrong. 
One question to answer first: Do you really have performance problems because the postprocessor makes a copy or is this really a premature optimization?
If it's the later, then I suggest that you just override `public void process(Bitmap bitmap)` and do `Palette.generate` there. No need for `Palette.generateAsync` as postprocessors run on the background thread anyway.
If you however do see perf issues, then I'd suggest that you don't use postprocessor at all. Postprocessor is intended for modifying the image (in which case we have to make a copy, otherwise you'd overwrite the source bitmap that is cached and may be used by other clients).
Instead, use the image pipeline directly to get the bitmap and then generate the palette information from it. See http://frescolib.org/docs/using-image-pipeline.html#_ and how to use `BaseBitmapDataSubscriber` in http://frescolib.org/docs/datasources-datasubscribers.html#_.
 I wouldn't use `UiThreadExecutorService`. You have two options:
1. You can use some background executor. Once the pipeline has the bitmap ready, it will execute your callback on that background executor. Since the callback is executed on a background thread, it is fine to do a longer operation synchronously. I.e. you can just call `Palette.generate` directly.
2. You can use `CallerThreadExecutor.getInstance()` which will execute your callback on whatever thread the image pipeline was executed last. This is going to be the main (UI) thread if the image is found in the bitmap cache, or some other background thread if the image had to be decoded. Since your callback may get executed on the main thread, you shouldn't do long running operations on it so you shoul use `Palette.generateAsync` in that case.

If you choose the option 1., don't forget to clone your reference in order to keep it alive even after your callback is executed, as the asynchronous work started from it may still require that reference. Also, don't forget to close the clonned reference properly after your heavy work is complete. See http://frescolib.org/docs/closeable-references.html#_

To summarize, you want to avoid doing any heavy work on the main thread, as that would block the UI. To achieve that, you can either tell the pipeline to execute your callback directly (CallerThreadExecutor) and then you have to manually submit the heavy operation on some background thread (luckily `Palette` has the `generateAsync` method). Or, you can tell the pipeline to execute your callback on a background thread, in which case you can do the heavy work in the callback (i.e. call `Palette.generate` directly).

If you are familiar with executors, I'd suggest using some background executor and just do `Palette.generate` in your callback. This is definitely the easiest and the safest option.
  Yes, the default network fetcher provided by Android doesn't handle redirections automatically. We do provide OkHttp integration for Fresco, which does that.
See http://frescolib.org/docs/using-other-network-layers.html#_
 We don't use `OkHttp` nor `HttpURLConnection` within the Facebook apps. But in order to be able to open source Fresco as a complete solution, we provided two additional network fetchers:
- A simple one that is built on top of `HttpURLConnection` and doesn't require any additional networking library, but also has limitations such as inability to cancel the network request or to handle redirections properly.
- A wrapper around OkHttp that supports cancellation and handles redirections, but has other limitations.

If neither of those two network fetchers are sufficient for you, you are welcome to implement your own :)
Plugging OkHttp fetcher shouldn't be difficult and it solves the problem you have.
 Should be fixed in 0.5.1.
  OSï¼š mac 10.10.3
Error:Execution failed for task ':imagepipeline:ndk_build_bitmaps'.

> A problem occurred starting process 'command 'ndk-build''
## help
 Do you have the Android NDK installed? Have you followed the [build instructions](http://frescolib.org/docs/building-from-source.html#_)?

If so, please run gradle with the --debug option to get further details.
  Error:Unable to expand TAR '/Users/jason/AndroidStudioProjects/fresco/imagepipeline/nativedeps/downloads/libjpeg-turbo-1.3.1.tar.gz'
  The tar might be corrupted or it is compressed in an unexpected way.
  By default the tar tree tries to guess the compression based on the file extension.
  If you need to specify the compression explicitly please refer to the DSL reference.

> Could not copy tar entry /Users/jason/AndroidStudioProjects/fresco/imagepipeline/nativedeps/downloads/libjpeg-turbo-1.3.1.tar.gz!libjpeg-turbo-1.3.1/jmemmgr.c to '/Users/jason/AndroidStudioProjects/fresco/imagepipeline/build/tmp/expandedArchives/libjpeg-turbo-1.3.1.tar.gz_2ellol30305se3ut6goaazaeq/libjpeg-turbo-1.3.1/jmemmgr.c'.
  This is a good question. I've spent a fair amount of time thinking about whether to expose this or not, and concluded that it is better not to do that.
Namely, SimpleDraweeView can also accept a DraweeController, in which case it would be hard to get the URI from the controller. The reason for that is that even though the custom controller is usually built by setting an URI and some other additional options, the controller can also be built with multiple URIs set (http://frescolib.org/docs/requesting-multiple-images.html#_) or even with a custom DataSource. In those cases it is not clear what URI should SimpleDraweeView report.
So, for the sake of consistency, I've decided not to expose that.
 Yes, but then someone will build a controller, again "just with the uri", and ask why `SimpleDraweeView.getImageURI` doesn't work.
We can reconsider adding this functionality, but can you give us some more context on why do you need it?
 It seems that you have some sort of slide show and to display the next image you need to know what is the currently displayed one.
Given that you already need some extra data associated with your SimpleDraweeView, namely the list of the URIs you are iterating over, I see no reason why not having another `mCurrentUri` or `mCurrentIndex` field next to that `mUris` field, wherever it is being stored. What am I missing?

When it comes to controllers, "getImageUri() can simply be overridden", I'm afraid, is not possible. Controller does not know about URIs. All controller knows about is a `Supplier<DataSource>` that it uses when it needs to get the image(s). `DataSource` is like a Java `Future`, except that it can return multiple results. And this is all controller cares about (the images its data source returns). It does not care about how those images get there and what is their source (be it an URI, be it multiple URIs, or be it some completely different source that has nothing to do with URIs).

I know that it seems simple and it is very tempting to just add those methods there, but I strongly believe that this would be a bad design choice in the long run. There is no need to bloat the controller's interface. Narrow interfaces help keeping the design cleaner and make maintenace and refactoring easier in the long run. There has to be a really good reason to add yet another method, (let alone a several of them) to an interface.

Now to get back to your example, even if there is `getUri` method, **I would advise you not to use it for your usecase**. It doesn't seem right from a design point of view. For argument sake, suppose that you need some additional state along with the list of uris and the currently selected one. How would you add that? SimpleDraweeView would definitely not be a right place to store that data, so you might as well make your design flexible right now and create a class to store all those things.

That being said, the usecase you explained is not convincing enough to break the ancapsulation and degrade the interfaces.
 You're welocme.
  Hi, yes, this is a known limitation. Only images that resolve to `BitmapDrawable` or `ColorDrawable` can be rounded. Rounding `NinePatchDrawable`, `ShapeDrawable` and other such drawables is not supported (regardless whether they are specified in XML or programmatically).
Please see Caveats section in http://frescolib.org/docs/rounded-corners-and-circles.html#_
 Can you please attach a screenshot? Is it possible that your placeholder image is too small?
 Is it possible that the image is actually a GIF (even though the extension says PNG)?
Can you upload this image please?
 Can you remove `fresco:failureImage` from XML?
 Rounding is not supported for the failure image at the moment.
See http://frescolib.org/docs/rounded-corners-and-circles.html#_

If failure image is not specified, the placeholder image is shown in case of a failure, so if those two images are the same, it is redundant to specify `failureImage`
See http://frescolib.org/docs/drawee-components.html#_
  Actually @kooze's issue is a different stack trace and not the same issue.

The size of the allocation gives me pause - this is a 39 MB image, which would be around 3000 x 3000 pixels, more than most mobile devices will need. If it is a JPEG, try [resizing](http://frescolib.org/docs/resizing-rotating.html) it first.
 @ivfuricks, the animations code in Fresco is very new and there are still a few issues with it. We are working on resolving all of them. I am aware of this particular issue and I already have some changes ready in order to fix those.
 OutOfMemoryError is a Throwable and can be caught, however that is not a solution, nor an advisable approach.
 The animations code has been rewritten since this issue was filed.
If the problem still persists in the new implementation please file a bug.  @pedant is correct. BaseDirectoryName is a mandatory parameter. 

We should probably add string-comments to all the preconditions.
  We don't support that functionality at the moment. Can you give us some context on why do you need that?
 Correction: we do support this. It's not yet in the docs, but maybe we should add it.

You can provide an implementation of the [CacheKeyFactory](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/cache/CacheKeyFactory.html) interface when [configuring](http://frescolib.org/docs/configure-image-pipeline.html) the image pipeline. I would recommend subclassing [DefaultCacheKeyFactory](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.html).

Use this feature with great caution. If you do it wrong, your app could be a lot slower or show the wrong images entirely.
 @tyronen , I am aware of that class, but I don't think this is what @mohammedhammouri need. If I understood correctly, he wants to use a custom key on per request basis, not a mechanism for different uri mapping.
CacheKeyFactory  is intended for mapping image requests to their cache keys based on their uri and possible other options. Uri normalization is one possible use case.
However there is currently no option in our image request to use a custom key, which means that the key will have to be derived from the uri to avoid collisions which then means that whole this effort of writting a custom CacheKeyFactory is useless as you still need the uri.
I might have misunderstood the question though.

@mohammedhammouri, can you give us more context on what are you trying to achieve?
 Oh, in that case Tyrone's answer should help you :)
  Looking at the [source code](https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v7/palette/src/android/support/v7/graphics/Palette.java) class, it doesn't look like it holds onto a reference to the passed-in reference.

So actually I think the postprocessor is the simplest way for your needs, even if you're not actually modifying the Bitmap.

There is no future-proof way of getting a Bitmap from a Drawee. You could alternatively, in addition to your Drawee, send a second [image pipeline request](http://frescolib.org/docs/using-image-pipeline.html#_). But honestly, the postprocessor is simpler.
  Can you send us a pull request of the changes you made to the sample app? This will be helpful in debugging.
 We have made improvements in 0.6.0.
  Does this persist after running a 'gradlew clean' ?
 Respond if it does.
 Closing as there has been no response for 2 years  Yes, this is a known limitation. It is an Android bug when using BitmapShader. I'm afraid there is not much we can do. You can try using the other rounding mode by specifying the overlay color.
 @Armaxis, I wouldn't use controller listener for that. See whether a different rounding mode (`OVERLAY_COLOR`) would work for you: http://frescolib.org/docs/rounded-corners-and-circles.html#_
If not, then try using some scale type that ensures that the whole view is filled, like center-crop.
Performance shouldn't be affected dramatically, and `OVERLAY_COLOR` is even more performant than the default mode, but the limitation is that it only looks good if the background is of the same color.
 Sure, I'll update the docs.
  This is not consistent with results we've found in the sample app. Can you share the URLs you were testing and source snippets?
 I will have a look at those URLs.

I actually would call this a bug in UIL. Although your app appears faster with UIL, it's because it is holding onto memory even while in the background. This takes away memory other apps could be using, and makes them slower. It also increases the chances that Android will terminate your app, especially on low-memory devices.

If Fresco did that, the consequence would be even worse, since Fresco is using ashmem memory which is shared among applications. Using a lot of it while in the background would be bad for the entire system.
 Yes. We intentionally clear the memory caches when the app gets backgrounded. This is a proper policy in order to be a good citizen in a larger system. Imagine if all the apps with bunch of images never reclaim their resources. As Tyrone said, the app would likely get killed, which is worse than doing another decode.
 Nothing extra to do here - of course reading from disk cache is slower than reading from memory, and we're doing the correct thing in releasing memory when the application is closed. Let's close the issue. . 
  Yes, unfortunately our unit tests only work in our internal build environment. We hope to fix this soon.
 This is now fixed in source.
  I think we will have this ready soon.
 This has been added in today's release, 0.4.0. It is called `fresco:viewAspectRatio`.
  We don't support multi-touch to zoom right now.
 See a duplicate issue: https://github.com/facebook/fresco/issues/86
And @nbarraille's implementation: https://gist.github.com/nbarraille/eb5d0da20bc813969b08
  Not yet, though this could be added. Note that similar functionality can already be done with [resizing](http://frescolib.org/docs/resizing-rotating.html).

Can you give me an example where that doesn't meet your needs?
 I think this is very similar to https://github.com/facebook/fresco/issues/4
  This is deliberate. An image in cache is usually one that has been on-screen recently. It's jarring to have it fade back in.
 When you say "they do not fade in", do you mean they appear immediately without a fade effect, or is there a period when the image is not loaded and then it just pops in?
  If you are using a SimpleDraweeView, you can simply `setImageURI` to null, which will cancel the request unless it has already started loading.

If you are using OkHttp, you can use the OkHttpClient.setReadTimeout method to set a timeout.
 If the image fails to load - a default timeout, no internet connection, connection reset etc, you will see the failure image. 

Note that a bad URL shouldn't be slowing your app down at all. If the server doesn't have the image you ask for, it should give you a 404 right away - usually faster, in fact, than a found image.

If you had a slow server or slow internet, the download might take a while, but that alone isn't enough to slow your app down. Unless you are requesting a large number of images one by one in a slow network environment.
  See http://frescolib.org/docs/using-image-pipeline.html#_
 Our image pipeline requires bitmaps to be manually disposed once not needed anymore and this is hard to do. That's why it is highly recomended to use Drawee for displaying images, as it takes care of all that.
  Can you explain more what you want to do?

http://frescolib.org/docs/listening-download-events.html shows how to listen to download events.
 If you want to display the download progress, you should set some progress bar drawable to the hierarchy.
See example usage:
https://github.com/facebook/fresco/blob/53e1317d47e0e33d9927740ad4974cc479d8cc2a/sample/src/main/java/com/facebook/fresco/sample/adapters/FrescoAdapter.java

And example implementation of a progress bar drawable (onLevelChange is the important method):
https://github.com/facebook/fresco/blob/53e1317d47e0e33d9927740ad4974cc479d8cc2a/drawee/src/main/java/com/facebook/drawee/drawable/ProgressBarDrawable.java
  We have a pending commit that should fix this.
 The most recent head should take care of this issue. Let us know if it doesn't.
  I am not able to say what the fix is by just looking at the crash dump. Can you tell us how is the Fresco used in the app and what steps exactly do you take to reproduce this ?
 And which version of fresco do you use ? Is it 0.1.0 or 0.2.0 ?
 And on more question, the code you posted, which method is it part of ?
 I wonder if this is a duplication of https://github.com/facebook/fresco/issues/140. In your crash dump I see that the crash happened when skia's webp decoder was executing. The other issue is exactly about a native crash happening on Android 4.3 when displaying webp images. Does the one here happen when there are no webps as well ?
 Over two years has passed so I'm closing this issue.

Please reopen if anyone is still seeing this issue.  Can you share some information on how you reproduce this ? What version of fresco do you use ?
 Closing this for now, as I don't actually see any Fresco libraries in the trace. Reopen if you have reason to believe this is a Fresco issue.
 OK we need more information:
- What device you are running
- _Exactly_ what version of Android it is running - need all three digits
- A sample of the WebP images causing the crash
 Closing old issue  Use the image pipeline directly: http://frescolib.org/docs/using-image-pipeline.html.

Use the `fetchEncodedImage` method to get the image encoded. Then simply use a Java `FileOutputStream` to write it to a file.
 No, it is the original image.
 Hi @hubcin, you do not want to use the post-processor for saving a Bitmap.

From `fetchEncodedImage` I guess that you want to fetch an encoded image. If you look at the return type, you see that you are getting a `DataSource<CloseableReference<PooledByteBuffer>>`. Subscribe to that in order to get the original image data. See http://frescolib.org/docs/using-image-pipeline.html  What URI are you hitting?
 I took a look at the image in a hex editor. I am not sure the contents of the file are correct.

A progressive JPEG should have a SOF2 marker (0xFFC2). Your image has a SOF0 marker (0xFFC0) which indicates it is a baseline image.

I do see that you have three SOS markers, which would be consistent with a progressive image with three scans. You may want to check the encoding of this image.
 That image loaded in a baseline fashion for me as well. IT seems that the image is not a progressive jpeg. Not all jpegs are progressive.
 What do you mean by making a progressive jpeg? If you are downloading the image from network, then there is not much you can do if the image is not already in the progressive format, as you'd have to download it fully after which makes no sense transcoding it.
If you'd like to save a local image as a progressive jpeg, we use lib-jpeg-turbo library under the hood, but I'm not sure whether it can produce the progressive jpegs or not. Even if it can, at the moment we don't expose this functionality. We can only read progressive jpegs.
Keep in mind that even if you upload some progressive image from your phone to some server, there is a good chance that the server will transcode that image in which case it makes very little difference in what format you've sent the image.
 Ok, I see. Yes, that image does load as a baseline.
 I am working on fixing this bug.
 Fixed in release 0.5.0
 The source of 0.5.0 is already released. From the repo, just select the tag v0.5.0.
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
  Are you trying to show an animated image in a circle? You must use an overlay color to do that:

``` java
  RoundingParams.asCircle().setOverlayColor(R.color.white);
```

Also, you probably don't need to use `InstrumentedDraweeView`. Use `SimpleDraweeView` instead.
 It is not clear to me what's the issue. Please take a look at http://frescolib.org/docs/rounded-corners-and-circles.html#_
  We don't yet support deletion of an individual image.

The cache has a size limit which it does not exceed, and when it comes up against this, old entries will be evicted.

If you are having an actual issue with low disk space, you can use a DiskTrimmableRegistry. See the [instructions](http://frescolib.org/docs/caching.html#trimming-the-caches).
 Duplicate of https://github.com/facebook/fresco/issues/124
  I believe this issue was fixed in version 0.2.0 of Fresco. Are you using the latest version?
  Resize options will only work if the source image is a JPEG.
 We are working on supporting downscaling for other image formats.
  Please open a new issue and post your XML. Make sure you are calling Fresco.initialize.
  Are you running the build from the correct directory? It should be from the 'fresco' directory, not the 'imagepipeline' directory.
 We are no longer using git-clone-task, so from latest head you should not be experiencing this.
  Setting the uri won't cause a network fetch if the image was previously loaded as it will be found in cache.
  Are you sure that the filename is correct and that the file exists?
Does `FileInputStream("/storage/emulated/0/Tencent/QQfile_recv/PL6YD4~F{T)9)TBLX2%IB%C.png")` work?
 Closing this as we haven't heard back. Please reopen if this is still an issue.
  Can you clarify the question?
 http://frescolib.org/docs/using-image-pipeline.html and the next two pages after that show you how to get a CloseableReference out of a DataSource, and how to get a Bitmap safely from a CloseableReference. Be sure this is really what you need, though.
  I assume this code lives in an activity. If so, you can have something like this:

```
class MyActivity {
  DraweeHolder<GenericDraweeHierarchy> mDraweeHolder;

  onCreate {
    Resources resources = getContext().getResources();
    Fresco.initialize(getContext());
    GenericDraweeHierarchy gdh = new GenericDraweeHierarchyBuilder(resources)
        .setPlaceholderImage(resources.getDrawable(R.drawable.app_background))
        .build();
    mDraweeHolder = DraweeHolder.create(gdh, getContext());
    getWindow().setBackgroundDrawable(mDraweeHolder.getTopLevelDrawable());
  }

  onStart() {
     ...
    DraweeController controller = Fresco.newDraweeControllerBuilder()
        .setUri(Uri.parse(Constants.URL_API_APP_COVER))
        .build();
     mDraweeHolder.setController(controller);
     mDraweeHolder.attach();
  }

  onStop() {
     ...
     mDraweeHolder.detach();
     mDraweeHolder.setController(null);
  }
}
```
 Unfortunately, we do not support invalidating/removing the files from disk cache yet.
 https://github.com/facebook/fresco/issues/124 tracks that
  We don't expose that functionality yet, but that shouldn't be hard to support. 
 There is an expiration time for disk cache. If I remember correctly it is set to 60 days.
There are other things on our priority list at the moment, but if one of you sends a pull request for adding `evictFromDiskCache` we will take a look.
 @danilobertelli , yeah this should work. We should simplify the API though (like we have for removing from memory cache).

Also, one thing to watch out for is when using a custom CacheKeyFactory (unlikely, but possible).
The default one does what you do, so if the default one is used, it hsould be fine.
https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/imagepipeline/src/main/java/com/facebook/imagepipeline/cache/DefaultCacheKeyFactory.java
 Added in v0.6.0. See http://frescolib.org/docs/caching.html#evicting-from-cache
  I don't understand the issue. If you have a big rounded frame and a small picture inside it, the image won't be rounded, of course. You either need to use a smaller view or scale the image (with scale type, not with the resize options.)
See http://frescolib.org/docs/resizing-rotating.html#_ for why you shouldn't be using resizing in this case.
See http://frescolib.org/docs/scaling.html#_ for how to use scaling.
  LGTM
  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
 Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!
 @orospakr thanks!
 We are merging https://github.com/facebook/fresco/pull/176
  I am closing this so that we can continue discussion in #121 
  Pull request #53 should take care of this. Stay tuned.
  Can you give more details on what custom drawing you are doing and why it needs a Bitmap?
 Yeah, bitmap obtained by postprocessor should never escape the scope of `process` method.
What do you mean by "sample the image"?
 You can implement a custom view as explained in http://frescolib.org/docs/writing-custom-views.html#_.
E.g.

```
canvas.save();
canvas.clip(...);
canvas.translate(...);
mHolder.getTopLevelDrawable().draw(canvas);
canvas.restore();
// repeat above code for each section you need to draw
```
  Also sync to head - we are no longer hitting the googlesource.com url.
  You do not need the sources.jar or javadoc.jar in order to build.

However, we haven't entirely got the import into Eclipse working. Please track this in issue #96.
  Are you still experiencing this on latest head? What operating system are you on?
 Please sync to latest head, do a ./gradlew clean, and follow the current [build instructions](http://frescolib.org/docs/building-from-source.html#_). Respond if the problem persists.
  yes
  Thanks ! Wow, we didn't see this happening :)

I will make sure it does not happen in next releases.
 I believe this has been fixed.
 @michalgr would know for sure, but i believe it is https://github.com/facebook/fresco/commit/8665fbdbd181dac69d3be52379a01c80108fde1e
  Hi ! Have you tried setting up 'ndk.path' in C:\Users\tbarthel.gradle\gradle.properties ? Does that work for you ?
  Please run gradlew.bat again with the --info option so we can see the detailed error message.
 Try again from latest head. Reply if this issue persists.
  Please see https://github.com/facebook/fresco#using-fresco-in-your-application
  Duplicate of #82 
  Can you remove imagepipeline/build directory and try again ?
 I assume that the advice helped. Please reopen if not.
  Make sure you have the most recent version of the NDK - current release is 10d. You need 10c or higher.
 @ljnalex I think it is a separate issue.
  I guess you use proguard and it removes `nativeReadByte` which appears to be unused.

Can you try to instruct proguard not to remove anything annotated with @DoNotStrip ? Example: https://github.com/facebook/fresco/blob/master/fbcore/src/main/java/com/facebook/common/internal/proguard_annotations.pro
  The problem is that drawing a border outside of the view bounds would make it appear cropped. The grayed out parts would not be visible and you would only see what's depicted by a red color:

![outside](https://cloud.githubusercontent.com/assets/3705123/7025823/f3b14014-dd3d-11e4-8df9-b1fdf06c2a92.png)
  This is a library included by default by C++. We are working on a way of excluding it.
 I suspect that if libgnustl_shared.so is missing then all our native libraries are missing.

So how exactly do you build the app ? I just cloned the repo, imported fresco into Android Studio, executed installDebug and now I am playing with the app - no crash.

I understand that you compile it in Android Studio ? What operating system do you use ? And what device do you test this on ? Can you extract the apk and check whether libgnustl_shared.so is there inside lib/armeabi-v7a directory ?
 Please try it again from the latest head, using the latest [build instructions](http://frescolib.org/docs/building-from-source.html#_). Comment here if it still does not work.
  Code doing something similar is now in master.
  Can you try it again from the latest head?
 We do know that :imagepipeline:clean fails if there is nothing to clean in imagepipeline subproject. I'll fix that.
 workaround for ndk_clean_\* specific failures is now in master
  Use #22 to track this issue.
  Can you try once again ? We depend on libwebp and we clone source from google's repo. The issue you describe could be caused by some temporary factors (quota ? temporary outage ?). I'll provide workaround if the issue does not disappear.
  We don't yet officially support it, and it looks like you can't yet import Gradle files into Eclipse. However, you might be able to make use of Eclipse's Maven plugin, called m2eclipse. See if the following helps:

http://books.sonatype.com/m2eclipse-book/reference/repository-sect-repo-view.html
 Ok my earlier comment about m2eclipse was incorrect. Instead, we've uploaded a [zip file](https://github.com/facebook/fresco/releases/download/v0.3.0/fresco-v0.3.0.zip). If you expand it, it creates the following directory structure:

```
frescolib/
  drawee/
  fbcore/
  fresco/
  imagepipeline/
```

In your Eclipse workspace, import all **four** of these subdirectories as Eclipse projects. Use File, Import, Android, "Existing Android Code into Workspace".

Then in your app's own project, add a dependency on 'fresco'. Right-click on your project, choose Properties, then Android. Click Add and select fresco.

Please let me know if this works, or doesn't work, for you, and I will add it to the official documentation.
 Ha, I forgot to specify the URI: https://github.com/facebook/fresco/releases/download/v0.3.0/fresco-v0.3.0.zip. You can get to it from the Releases page.

Updated the comment above.
  Pull request #21 will deal with this.
 Duplicate
  I imported fresco project into Android Studio. However i am not able to run the sample . It gives the following error:
Error:Cannot expand TAR '/home/Documents/fresco-master/imagepipeline/build/downloads/giflib-5.1.1.tar.gz'.

> Unable to create gzip input stream for resource /home/Documents/fresco-master/imagepipeline/build/downloads/giflib-5.1.1.tar.gz.
 @ljnalex , I Imported the project in a new Workspace. Dont know how weird that was. But i havent got this issue again.
  See http://frescolib.org/docs/listening-download-events.html#_
In `ControllerListener.onFinalImageSet` you have `ImageInfo.getWidth` and `ImageInfo.getHeight`. You can then set a layout params to your view based on the image dimensions.

Although this is doable as suggested above, I wouldn't recommend doing it. Changing the size of the view when the image arrives is usually unpleasant to the user, and rarely desireable. Consider an user that is reading a story that contains a photo. It'd be very disruptive if the text suddenly jumps up or down as the image appears. That's probably true for pretty much any content.
Could you give us more context on why do you need this? (I am still looking for a legit use case of this "feature".)
 I see. Yeah, if you could get the dimensions of the image along with its uri, that would be the best. As for animation, you can do whatever you want. `ControllerListener` will notify you when the image is loaded and it will provide the dimensions of the image. At that point you can start your custom animation or something.
  I only added this functionality recently. The changes has been pushed to github, but I'm not sure that they made it to Maven yet. Until then, you can use this functionality if you are building Fresco from source.

So, to display the progress, you need to set a progressbar drawable that knows how to interpret drawable level. You can implement your own drawable, but we also provide one:
https://github.com/facebook/fresco/blob/53e1317d47e0e33d9927740ad4974cc479d8cc2a/drawee/src/main/java/com/facebook/drawee/drawable/ProgressBarDrawable.java

For usage example see:
https://github.com/facebook/fresco/blob/53e1317d47e0e33d9927740ad4974cc479d8cc2a/sample/src/main/java/com/facebook/fresco/sample/adapters/FrescoAdapter.java#L54
  Duplicate of https://github.com/facebook/fresco/issues/80
  Your build.gradle file should point to Maven Central. 
  Does your app have this line in its `AndroidManifest.xml` file?

``` xml
<uses-permission android:name="android.permission.READ_CONTACTS" />
```
 Fixed in v0.8.0.
  Accepted and exported.
  You can implement your own zoomable view by extending SimpleDraweeView and overriding its `onDraw` and `onTouchEvent` methods:

```
@Override
protected void onDraw(Canvas canvas) {
  int saveCount = canvas.save();
  canvas.concat(mZoomableController.getTransform());
  super.onDraw(canvas);
  canvas.restoreToCount(saveCount);
}

@Override
public boolean onTouchEvent(MotionEvent event) {
  return mZoomableController.onTouchEvent(event) || super.onTouchEvent(event);
}
```

All you need to do now is to implement your zoomable controller that, based on touch events, image bounds and view bounds, computes the transformation matrix. Unfortunately, I can't provide more information on how to do that, but it seems that the link you provided does something similar...

Getting the view bounds is pretty straightforward: `(0, 0, getWidth(), getHeight())`. To get the image bounds, Drawee provides `mSimpleDraweeView.getHierarchy().getActualImageBounds(RectF outBounds)` which will populate the given rect with the image bounds. You should do that only after the image is set, of course, and you can use controller listener to detect when this happens.
 No, this is not expected to change. 
  Thanks for finding this. Docs are corrected now.
  Are you using OkHttp networking stack? 
There is an issue with OkHttp networking stack that it cancels requests on the calling thread (which is going to be the main thread). We have a fix ready for that.
Other than that, SimpleDraweeView should not be doing anything heavy on the main thread. If you give us more context on how you use Fresco, we may be able to isolate the issue more easily.
 What's `CircleView Adapter`?
 I'll investigate
 That's really helpful information, thanks!
 @fuwaneko , yeah OkHttp cancellation is a known issue and we have a fix for that. However, local content uri is something we yet need to figure.
 I deleted the two comments related to OkHttp cancellation as they are not related to this issue and has already been fixed.
 @mikeknoop , I missed part of your commend earlier, where you said "If I comment out the setResizeOptions line the performance problem comes back."
Can you please check what are the dimensions of those local images? If the image is much bigger than the view than there is going to be a noticeable overhead unless we resize the image first. Resize has to be explicitly specified as calling `setImageURI` won't do that.
 @mikeknoop, yes, please see http://frescolib.org/docs/resizing-rotating.html#_
 You should definitely specify resizing, but`ResizeOptions(1, 1)` doesn't seem right, why don't you pass the view's dimensions?
Btw, if you do `.setLocalThumbnailPreviewsEnabled(true)` with `.setResizeOptions(new ResizeOptions(1, 1))`, and also do `setControllerListener` with the following listener, what do you get in the adb logcat?

```
ControllerListener listener = new BaseControllerListener<ImageInfo>() {
  @Override
  public void onIntermediateImageSet(String id, ImageInfo imageInfo) {
    android.util.Log.w(TAG, "intermediate: width " + imageInfo.getWidth() + ", " + "height " + imageInfo.getHeight());
  }
  @Override
  public void onFinalImageSet(String id, ImageInfo imageInfo, Animatable a) {
    android.util.Log.w(TAG, "final: width " + imageInfo.getWidth() + ", " + "height " + imageInfo.getHeight());
  }
};
```
 Setting ResizeOptions is indeed the correct solution. The reason frames were skipped is that Android was struggling to scale such a large image in a small view.

At most we could make this automatic some of the time - when the view is specified with an explicit size - but that won't work for match_parent type layouts.
  It sounds like you are looking for a binary download of Fresco? You can use Gradle or Maven for that; see the instructions in [English](http://frescolib.org/docs/download-fresco.html#_) or [Chinese](http://fresco-cn.org/docs/download-fresco.html#_).
  If you compile aars separately and copy them into your project then you have to make sure that all dependencies are copied as well. It is much more convenient to use maven or gradle and let them handle this stuff.
  Hmm...possibly another Windows issue, there sure are a lot of these. Can you try gradlew.bat clean and then build again?
 If `gradlew.bat clean` fails then removing `C:\code\sample\fresco\fresco\imagepipeline\build` directory manually should help.
  May I ask why do you need to know whether the image is cached or not? I think in most cases this is not what you really need. I mean, this information on its own is useless, what's important is what do you intend to do after you would find out whether the image is cached or not.

For the second question, this is already possible. You can submit image request to the pipeline and the pipeline will return you the image. You can request encoded bytes (usually the bytes of the JPEG image) or decoded image (usually the Bitamp). In both cases you can tell the pipeline how deep it is allowed to go to satisfy your request. There are 4 levels: `BITMAP_MEMORY_CACHE`, `ENCODED_MEMORY_CACHE`, `DISK_CACHE` and `FULL_FETCH`.
So, if you ask pipeline for an encoded image, and specify `DISK_CACHE` with  `ImageRequestBuilder.setLowestPermittedRequestLevel`, the pipeline will return you the JPEG bytes if the image is found anywhere up to disk cache, or `null` if the image is not found and a full-fetch would have to be performed.
Then, when the pipeline returns you the image bytes, save them to some temporary file and use that file.

We can't/won't expose the real file name in disk cache because:
1. The image may have been found in memory cache, so there is no need to engage with disk cache at all.
2. Disk cache may evict the file on its own discretion at any time, and therefore passing that file name around would not be safe (Even if the other app would be able to access your app's internal storage which I doubt). 
 Alright, it shouldn't be hard to add `isCached` methods.
 @leelei Fresco was not built with that big images in mind. 
 You need to subscribe to the datasource. See http://frescolib.org/docs/datasources-datasubscribers.html#_
 Added in 0.7.0.
 See http://frescolib.org/docs/caching.html.
  This is a known issue on Windows; please see issue #24. 

On other platforms, you can eliminate this error by downloading the Android NDK and adding its location to your system PATH variable.
 First of all, be sure you need to build from source. We have install instructions for both [Gradle and Eclipse](http://frescolib.org/docs/index.html#_).

Please follow the most recent [instructions](http://frescolib.org/docs/building-from-source.html#_) to build from source.
  What is `ic_image_placeholder` (what kind of drawable)?
 Hmm, that's weird. If the placeholder gets resolved to `ColorDrawable` or `BitmapDrawable`, then it should get rounded. Can you give us more information? 
Btw, are you able to debug? This is the place where rounding should be applied:
https://github.com/facebook/fresco/blob/53e1317d47e0e33d9927740ad4974cc479d8cc2a/drawee/src/main/java/com/facebook/drawee/generic/GenericDraweeHierarchy.java#L165
  Can you clarify the question?
 We have a sample app in the repo if that's what you mean:
https://github.com/facebook/fresco/tree/master/sample
  Is there anything else in the error message? That should probably be `fb:placeholderImage=` instead of `app:placeholderImage=`
 Is this the same stack trace as issue #395?
  Please see #24 - it will be resolved soon
  This is now fixed in source
  Open Android SDK Manager. In the Extras section, make sure both Android Support Library and Android Support Repository are installed.
  Because, on Android 4.x, the bitmaps are purgeable - the big pixel data lives in the ashmem heap, not the Java heap. If you use the Bitmap.copy operation this will put all the pixels on the Java heap, the very thing Fresco is designed to avoid.

Internally, Fresco copies the Bitmap for you, so that any changes you make to it don't affect the version in cache. Moreover, Fresco's copy is done safely, keeping the pixel data in ashmem.

Can you tell us what operation you are doing that is hard to do in-place?
 Hi, we are aware of this and I already proposed that we change that. This should be easy to solve though. We should just pass both source and destination bitmap. And one should not modify the source bitmap. One limitation of that is that the output bitmap would have to be of the same size, but we can change even that by allowing clients to create their own output bitmap. Let me make a solution for that.

Caching is as separate issue, and we will consider implementing that as well.
 I have a fix ready for this.
 amitshekhariitbhu: see http://frescolib.org/docs/modifying-image.html
 I refactored postprocessors so that the client has more flexibility. This is soon going to be pushed to maven, and if you are building from source you should extend BasePostprocessor:

https://github.com/facebook/fresco/blob/29080993fce3ccfcdc83a03f1d0a533ee18f72aa/imagepipeline/src/main/java/com/facebook/imagepipeline/request/BasePostprocessor.java
 This is included in Fresco 0.3.0 which has just been released. See the updated [documentation](http://frescolib.org/docs/modifying-image.html#_).
  Hi ! Thanks for reporting.
Do you use windows, mac or linux ? Do you have ndk-build in your $PATH ? Do you build from command line or from Android Studio ?
 Windows build is not yet working. Please use issue #24.
  This looks like another Windows issue - but we'll probably have to fix #24 first.
 Duplicate
  Pull request #54 should take care of this.
  Hi, can you try to build once again ? Fresco depends on libwebp and we do clone it directly from google's repo. You might be over their quota currently.
 Duplicate of #52 
  Yes, we are aware of the fact that Fresco does not build on windows. I am trying to fix this. Closing this issue, lets follow up in https://github.com/facebook/fresco/issues/24
  Can you paste the exact command you ran, and the output?
 I admit I don't understand what you are writing.

Can you see if the answer to your question is found in our documentation? It is available in [English](http://frescolib.org/docs/index.html) and [Chinese](http://fresco-cn.org/docs/index.html).

If your native language is not English, it may be clearer to repeat your question in that language, and we may be able to find someone to help you.
  If you are specifying SimpleDraweeView in XML, then do `roundAsCircle="true"` there. If you are creating the hierarchy programmatically, then specify rounding params while building the hierarchy.
Basically, you need to tell the hierarchy at its construction time that you are going to use roudned corners, in order for hierarchy to preallocate some stuff. Only then you'll be able to change roundign params later (except for rounding method)
  I think the OkHttp stack handles this correctly and we do provide OkHttp backend for our pipeline.
See: http://frescolib.org/docs/using-other-network-layers.html#_
  There currently isn't.

Fresco itself was designed around the Android view and memory system. A comparable iOS product would be relatively different.

If and when Facebook has an announcement to make in that space, we will make one :)
  The thing is that we do not apply rounding on overlays and backgrounds when using the `BITMAP_ONLY` mode (which is default). I'll try to send a fix for that.

But, we do provide `RoundedColorDrawable`, so as a workaround, you can use that if you are creating your hierarchy programmatically. 
https://github.com/facebook/fresco/blob/847851a8de6d223c0a6634447bddee1252e01c64/drawee/src/main/java/com/facebook/drawee/drawable/RoundedColorDrawable.java
 Fixed in 0.3.0.
  We don't currently support this. We are considering adding RGB_565 for images that don't use alpha.
 This was added in v0.8.0.
  Not sure what you mean. 

Are you asking for the content on the [Getting Started](http://frescolib.org/docs/index.html#_) page to be moved to the [main page](http://frescolib.org/)?
 There are two Getting Started buttons on the main page already, plus the Docs link at the top.

The text on the main page introduces what the library is and why anyone would use it. It seems logical to me to have that before actual coding instructions.
  This has been merged.
  Guava in its current form is not suitable for mobile, though if a mobile version were prepared it would indeed be very elegant. We do have a very small fork of it in fbcore's common/internal package, but it doesn't have ImmutableSet. To do that properly means using its immutability to gain efficiency, a nontrivial problem beyond the scope of the Fresco project.

For now I think you're good using a regular Java Set, as this isn't being passed around. You'll also need to rebase off head.
  Unfortunately Google imposes a per-IP quota on accessing its servers. Here is a possible workaround: https://groups.google.com/a/chromium.org/forum/#!topic/chromium-dev/ITllccBdd5I
  Yeah, using the same builder is fine, but you need to be careful. The builder is not reset after build, so all previously set options remain.

You can either do:

```
GenericDraweeHierarchy hierarchy = builder
  .reset()    // <=======
  .setXxx()
  ...
  .build()
```

OR, you need to make sure that you don't use the same drawable instances for multiple hierarchies. 

In short, if you are reusing builder, doing `reset()` before setting options is the safest approach.
  It looks like you've provided the wrong path in the `exclude` line - does fixing that up do the trick? 
 Comment again if this is still happening.
 https://code.google.com/p/android/issues/detail?id=158630&q=Error%3A+duplicate+files+during+packaging+of+APK&colspec=ID+Type+Status+Owner+Summary+Stars

I am afraid gradle does not handle conflicts in so files. What we can do is hide libgif under different name or link it into something fresco-specific.
 Let's keep this open until fix lands in master.
 This is now in master.
  Of course it's not working. You need to provide an actual executor to be used for callbacks. Once the data source finishes, we will call your callback on the provided executor. The executor you provided does nothing. See our `CallerThreadExecutor.getInstance()` or `UiThreadExecutorService.getInstance()`

Please read the documentation of: http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executor.html

Unrelated thing, `callerContext` is not Android context, it's the tag/object that you can use for instrumentation (use null if you don't need it). Therefore you should not pass `getAppContext` there.
  blackiedm is correct. I'll make this clearer in the docs.
 http://frescolib.org/docs/gotchas.html#_
  Duplicate of issue #24 
  This has already been done.

There is an alternate Gradle target you can use called fbcore.

This isn't yet documented, as that library isn't comprehensive but merely support utilities used by Fresco.

``` groovy
compile 'com.facebook.fresco:fbcore:0.1.0+'
```
  Hi, we'll look into it ASAP. Can you please provide more information on how you use Fresco? This will help us in isolating the issue.
 Thanks, for the scenario, I am able to reproduce - fix is coming soon.
 The crash is happening when calling recycle on already finalized Bitmap. It is fixed in master now.
  The docs have been corrected. Thanks for reporting this!
  Looks like this is handled by your pull request #54.
  Can you give us more context on that? Since this is not an image that is being fetched from the network / file / whatever, why don't you do this instead:

```
mSimpleDraweeView.getHierarchy().setPlaceholderImage(resId);
mSimpleDraweeView.setUri(null);
```

Then if you actually need an actual image, rather than just XML drawable, switch back again:

```
mSimpleDraweeView.getHierarchy().setPlaceholderImage(palceholderId OR null);
mSimpleDraweeView.setUri(uri);
```
 One important difference that one should be aware of is that Uri is used to specify an actual image that goes through the pipeline. That means fetching, caching, transcodng, resizing, postprocessing, etc.

Drawables are not those kind of images, don't confuse those two. Shape and similar drawables cannot go through the pipeline. What the pipeline does with images, doesn't apply to drawables.

One important consequence is the difference between the two when the resource is actually an image (e.g. PNG):

This will fetch the given PNG from the internal storage and cache it in our memory caches:

```
simpleDraweeView.setImageURI(Uri.parse("res://" + resPackage + resId));
```

This will inflate the BitmapDrawable via `Resources.getDrawable(resId)`, which is subject to Android's built-in drawable cache, etc:

```
mSimpleDraweeView.getHierarchy().setPlaceholderImage(resId);
```
 I think it's safe to close this issue.
 The solution I provided above is as good as ImageView. In fact, it does exactly the same thing. So, you don't really lose anything by switching from ImageView.

In short, it is very unlikely that we will add a more sophisticated support for what you described.
One can specify an arbitrarily complex hierarchy of drawables in XML and parsing that XML to get to the leaf nodes that are the actual images and then rebuilding that same hierarchy, but with leaf nodes replaced with the BitmapDrawables that wrap images obtained by our pipeline seems very unfeasible. This would require us to rewrite the Android's XML inflation logic. In my opinion it's not worth the effort.

If you give us more context on what are you trying to achieve, we may be able to help you better.
 You are welcome. But as I said, if you give us more context, we may be able to devise a better way of solving your issue.
 What kind of change happens when the image is selected? If it's some simple color manipulation (like making it darker), or adding some overlay, then this can be achieved easily with:  `overlayImage`
 Fresco stores all images in ashmem on Android 4.x and lower. On Android 5.x, they are stored in the Java heap.
  It is in the [GenericDraweeHierarchy](http://frescolib.org/javadoc/reference/com/facebook/drawee/generic/GenericDraweeHierarchy.html#setPlaceholderImage%28int%29) class.
 mSimpleDraweeView.getHierarchy().setPlaceholderImage(...)
 You can specify the placeholder image while building hierarchy:

```
GenericDraweeHierarchy hierarchy = new GenericDraweeHierarchyBuilder(resources)
    .setPlaceholderImage(...)
    .build()
mDraweeView.setHierarchy(hierarchy);
```

But, you can also change the placeholder view of the existing hierarchy:

```
hierarchy.setPlaceholderImage(...);
OR
mDraweeView.getHierarchy().setPlaceholderImage(...);
```

Note: I suggest that you always use `SimpleDraweeView`. However, if you are using `DraweeView`, rather than `SimpleDraweeView`, make sure that you parametrize your DraweeView.

   `DraweeView<GenericDraweeHierarchy>`

otherwise `getHierarchy()` won't return `GenericDraweeHierarchy`, but a more restricted interface `DraweeHierarchy`. In that case you would have to cast.

```
 // don't do that, this is not safe. parametrize your view instead
 ((GenericDraweeHierarchy) mDraweeView.getHierarchy()).setPlaceholderImage(...)
```
  `file:///android_asset` is only for use with `WebView`. For example, `Universal Image Loader` uses `assets://image.png`. So, I'm afraid there is no standard convention here. The fact that `FileInputStream` cannot open `/android_asset/...` is enough to disqualify the `file` scheme from being used for this purpose.
  The `src` attribute in XML is not supported by SimpleDraweeViews. Use the `setImageURI` method instead.
  I'll double check that, but can you clarify what "document" are you referring to? Do you mean the documentation on frescolib.org/docs/ ?
 We have placed the documentation under the CC BY license, except for sample code which is under a separate sample license. See links on the footers in frescolib.org.

You may certainly translate the documents. We will be updating them frequently, though, so it may take a lot of effort to keep them up to date.

We're still looking into a proper i18n solution that might let you send us the translations as a pull request.
 Thanks @liaohuqiu , that's awesome!
  This looks like a bug. I'll look into it.
 Yeah, NPE slipped, i'm sending a fix.
 Fixed in source.
  You have to download the Android NDK and add its location to your system PATH variable. If using Android Studio, do the first build from the command line.
 We are sending a fix for gradle file so that native stuff can be built with AS. Stay tuned :)
  You also need to add the NDK to your system PATH variable. See http://www.computerhope.com/issues/ch000549.htm
  I have changes ready to add a real progress information to Fresco, so expect this very soon.

The way the progressBar works at the moment is: display progress bar image until the final image is ready. This is just a drawable and at the moment we provide the AutoRotateDrawable which can be used for displaying an indefinite spinner until the image is ready. You can specify `progressBarImage` and `progressBarAutoRotateInterval` in XML. You can also use your own drawable if you wish.

What I am adding now is real progress, so that as the bytes are downloading, we set the level to the progressbar drawable (0 to 10000). That means that drawable is now aware of the real progress and based on its level can display that progress in whichever way it wants. We'll provide a ProgressBarDrawable that just draws a line based on the percentage, but you can implement your custom drawable to do whatever you want.
 This is possible, but in order to be able to answer on how to do it, I need the information on where do you get the GIF image from?
 Also, you can try using low-res image as explained in the documentation: http://frescolib.org/docs/requesting-multiple-images.html#_

```
DraweeController controller = Fresco.newDraweeControllerBuilder()
    .setLowResImageRequest(ImageRequest.fromUri(gifPlaceholderUri))
    .setImageRequest(ImageRequest.fromUri(uri))
    .setOldController(mSimpleDraweeView.getController())
    .build();
mSimpleDraweeView.setController(controller);
```
 http://frescolib.org/docs/supported-uris.html#_
 Default rounding mode, BITMAP_ONLY, doesn't support animations. Please check if `OVERLAY_COLOR` rounding mode would work for you. For best appearance, you should use the same color that is beneath the DraweeView for overlay color (e.g. the ListView background color if DraweeView sits in the ListView).
See http://frescolib.org/docs/rounded-corners-and-circles.html#_
 Hi. Nope, I said that you can use whatever drawable you wish, but at the time we didn't support real progress. Now we do support real progress too, we just need to do a github push.

`progressBarImage` can be an `AnimationDrawable`, it's just that we don't call start/stop on it. I should probably add that logic.
 Progress bars have been supported since v0.2.0. See their [documentation](http://frescolib.org/docs/progress-bars.html#_).
  This is a typo in the docs. one "s" is missing, it should be `setAutoPlayAnimations`. I wonder if it would be easier to just try autocomplete instead of opening issue.
 Ah sorry, this is a controller builder setter, not image request builder setter
  Can you give us more context on what are you trying to achieve? I'm pretty sure we already support what you need, but I need some clarifications in order to be able to help.
 If I am interpreting your example correctly, you want only a part of the image to be blurred?
Or do you want to display those two side-by-side (but this seems not to be the case based on your example)?
Or do you want to display first the original and then the blurred image?
 The easiest solution would be to use the post-processor that blurs the part of the image only.
Post-processor provides you a bitmap to modify, so why not just blurring the part of it?

Can you give us more context on why do you "want both the original and the blurred image get returned to DraweeView"? To solve the problem you described, this is not necessary and by providing a more context, we may be able to devise a better solution.
 Okay, if you are not actually changing the blurred area, but rather just sliding in the blurred image, then you can have two SimpleDraweeViews: the original one below, and the blurred one on top that slides in.

```
                       middle of the animation      end of the animation
 visible portion:           |            |               |            |
 blurred view on top:   [ABCDE]--->      |               [ABCDE]      |
 original view below:       [abcdefghijkl]               [abcdefghijkl]
```

If you do want to expand the blur area, you can use the same trick. Just this time instead of sliding in the blurred image, just make width of the blurred view expand:

```
                         middle of the animation      end of the animation
 visible portion:          |            |                |            |
 blurred view on top:      [AB]--->     |                [ABCDE]      |
 original view below:      [abcdefghijkl]                [abcdefghijkl]
```
  Yeah, there was a typo in the documentation. This has been fixed now.
 @LarsLiden, the code in the link above is: http://frescolib.org/docs/progressive-jpegs.html and is not the same as stated above. Which code are you looking at? 
 The `build()` method will return you a `PipelineDraweeController` from the `PipelineDraweeControllerBuilder`, which can be passed to the `SimpleDraweeView`. 
  Thanks for reporting!

Could you check if replacing "ndk-build" with "C:\android-ndk-r10d\ndk-build.cmd" in imagepipeline/build.gradle resolves the issue ?

If no, can you cd to imagepipeline directory and see if there is anything suspicious in the output of following command:
C:\android-ndk-r10d\ndk-build.cmd NDK_APPLICATION_MK=../Application.mk NDK_OUT=build NDK_LIBS_OUT=build -C src/main/jni/gifimage
There are couple of hardcoded "/" in the build script, I wonder if replacing them with "\" solves the issue.
 Also, the Android NDK on Windows requires that [Cygwin](https://www.cygwin.com) 1.7 or later be installed. When using the Cygwin installer, make sure that the 'devel' tree is installed - by default, it isn't.
 The ndk-build command is supposed to get NDK_PROJECT_PATH from the NDK_APPLICATION_MK passed in on the command line, but for some reason this does not seem to work on Windows.
 Hi, note for everybody:

We understand people are frustrated that there are multiple issues with the Windows build. We take responsibility for it - as you might have guessed, our team develops on Mac OS and Linux and missed Windows. We are committed to making it work on all three.

Our office is closed for the Easter weekend right now but we will be back on Tuesday and will fix this as soon as we can.
 Stay tuned, I think @michalgr got windows build working. We'll update gradle files and provide how-to instructions on Tuesday.
 I am using Ubuntu , 
I have set the Path variables using the following commands
export NDK=~/home/joysonf/android_ndk/android-ndk-r10d
.But when i Build the project i still get the same error
Error:Execution failed for task ':imagepipeline:ndk_build_gifimage'.

> A problem occurred starting process 'command 'ndk-build''
 @jalpesh , Thanks for your quick reply.
I have set the following path in build.gradle (imagepipeline) :
 ndk.dir=/home/joysonf/android_ndk/android-ndk-r10d
But when i build the project it still gives the above error.
 @jalpesh , Thanks Mate.It works.
 We should create a separate issue for linux
 Sync to head and you should now be able to build on Windows.

Please file a new issue if any other problems appear.
  SimpleDraweeView was not initialized. You should make sure that you initialize the Fresco properly before instantiating SimpleDraweeView.
See: http://frescolib.org/docs/index.html#_
 Okay, we can delay that check until after setUri gets called. Let me fix that.
 Yeah, I made a fix to do nothing if in edit mode. We'll upload it soon.
 Fixed in source.
  Can you give us more details? What exactly did you try to do, and what happened instead?
 I suspect this has to do with attach/detach events that view gets when in transition. We'll have to investigate that. 
 The `ChangeImageTransform` uses the intrinsic dimensions to determine the transformation matrix. Our implementation of `DraweeView` uses a `DraweeHierarchy` which that has intrinsic dimensions equals to -1 for `width` and `height`. This is because `Drawee` already applies correct scale type scaling and hence there is no need for a view to do so. Furthermore, `ImageView` can only apply one scale type whereas drawable hierarchy can use separate scale types for each image branch (placeholder, failure image, actual image, etc.). Returning actual intrinsic dimensions to the view just puts as on risk of having sizing bugs.
If you want transition working you should use `ChangeBounds`. 
 @boxcounter At the moment we think what we have now is ok. But you could create a pull request for your proposal :)
 @burzumrus that's amazing! Thanks for implementing it. That's exactly what I had in mind with `InterpolatingScaleType`. Consider making a pull-request for Fresco if not done already.
 See #1446  Hi Andrew, thanks for doing this.

I see here though that, if the Executor is not supplied, you're creating a whole new thread pool just for cancellations. 

OkHttpClient itself doesn't seem to expose its thread pool, nor offer an async cancel method which would be a proper solution. 

A workaround might be to use [ExecutorSupplier.forBackground](http://frescolib.org/javadoc/reference/com/facebook/imagepipeline/core/ExecutorSupplier.html#forBackground%28%29) method.

What you can do is make an instance of this an optional argument to OkHttpImagePipelineConfigFactory.newBuilder. If it isn't supplied, use DefaultExecutorSupplier. Then pass it to OkHttpNetworkFetchProducer, and before returning call ImagePipelineConfig.Builder.setExecutorSupplier.
 client.getDispatcher is a better solution anyway. The network library's threads should be used for network operations.
 Hi sorry for the delay in getting back to you, it was Easter holiday. We have some other changes in head that you'll need to rebase off of.
 LGTM
  You can do this with [ControllerListeners](http://frescolib.org/docs/listening-download-events.html).
  Fresco has a [postprocessor](http://frescolib.org/docs/modifying-image.html) facility which sounds like what you are looking for.
  Thank you, there was a typo in the documentation. The following should be enough:

```
compile 'com.facebook.fresco:fresco:0.1.0+'
compile "com.facebook.fresco:imagepipeline-okhttp:0.1.0+"
```
 @xbroak : would you mind creating separate issue for the missing class ?
  One way of achieving that is to subclass the view in question (E.g. TextView). In that subclass you can have a DraweeHolder and you can use its top-level-drawable as a regular drawable. You must be careful to forward attach/detach events properly to the holder.
See: http://frescolib.org/docs/writing-custom-views.html#_
  If I am not wrong, jar is not as generic as aar, and we need aar in order to include native code.
 Also, see http://stackoverflow.com/questions/23915619/android-archive-library-aar-vs-standard-jar
 @mufumbo can you tell us more about your use case so that we know what should we optimize for? How would you use the aars without gradle or maven ?  providing links to Fresco aars is not enough, you probably also need links to Fresco's dependencies. To make it more convenient we could provide zipped bundle of all aars - depends on what people need.
  You should be able to use the ImagePipeline with BaseBitmapDataSubscriber for this - have a look [here](https://github.com/facebook/fresco/blob/master/imagepipeline/src/main/java/com/facebook/imagepipeline/datasource/BaseBitmapDataSubscriber.java#L23:L46). You need to make sure you pass the bitmap to the system in the `updateStatus` method as the bitmap will be cleaned up when `onNewResultImpl` finishes. 

Let me know if you have any problems. 
 As Ian explained, after submitting the request to the pipeline, pipeline returns a DataSource. Attach your BaseBitmapDataSubscriber to that DataSource.
Important note is that the bitmap we provide is valid only until onNewResultImpl finishes.
See `BaseBitmapDataSubscriber.onNewResultImpl(@Nullable Bitmap bitmap)`.
That means that you cannot hold onto the reference of the bitmap we provide, either you have to copy the bitmap manually, or, If I am not wrong, the system will do just that for you when passing the Bitmap to the Widget, as this is another process and reference cannot be shared.
  We don't support that at the moment. We were considering doing that, but there are some non-trivialities when it comes to bitmap-cache-key creation. Cache-key must reflect mutation, but we don't want to kick every other image from cache by filling it with many variants of the same image.
In short, it's doable, we just haven't implemented it yet.
 Yeah, agreed. I'm working on it.
 Added in v0.6.0. See http://frescolib.org/docs/modifying-image.html#caching-postprocessed-images.
  Can you try asset://...jpg? See http://frescolib.org/docs/supported-uris.html
 No problem. Hope you find Fresco useful! 
  Do you see the rounded corners correctly? Is it just the border that is the problem? 
 Also, if you add .setOverlayColor(0xFFFFFF00) while building RoundingParams, what happens? This will help us diagnose where the issue might be.
 Yes, this should be ARGB color, not a resource reference. Both of those use `int` type, and it makes more sense to interpret it as a color than as a resource id.
 You can always get the color value from the resource id with `getResources().getColor(R.color.holo_blue_bright)`
I'm glad that you resolved the issue.
  Have you tried to verify whether all *.so files are included in the final apk ? This might help establish what is going on.

To check that just unzip your apk and examine content of 'lib' directory
 Closing this as we haven't heard back. Please reopen if this is still an issue.
  That's strange. Since there was a similar report, I wonder whether there is some systematic issue.
Can you please try `fresco:roundWithOverlayColor="@android:color/red"` and tell what happens? That will help us narrow down the issue.
 It seems that for some reason our attrs.xml is not included in your app:
https://github.com/facebook/fresco/blob/master/drawee/src/main/res/values/attrs.xml
 Actually, I may have made a mistake, can you just specify some color instead of `@android:color/red`?
 It looks as though the issue is a typo in the documentation. It should be http://schemas.android.com/apk/res-auto rather than http:/schemas.android.com/apk/res-auto (note the extra '/')
  Maven central knows about that artifact (http://search.maven.org/remotecontent?filepath=com/facebook/fresco/fresco/0.1.0/fresco-0.1.0.aar) and I am able to successfully build a project depending on it. However, I had similar problem earlier today with one of the other artifacts. It seems that clearing local cache helped resolve my issue. Warning though: I removed entire ~/.gradle/caches directory and as a result the very next build was very slow.
  Have you added the namespace to the top-level element in the XML file?
xmlns:fresco="http:/schemas.android.com/apk/res-auto
 It looks as though the issue is a typo in the documentation. It should be http://schemas.android.com/apk/res-auto rather than http:/schemas.android.com/apk/res-auto (note the extra '/')
  Yes, there is a typo in the documentation, it should be just `.setOldController(view.getController())`, thanks.

For initialization, see our "Getting started with Fresco" page, it's on the very beginning:
http://frescolib.org/docs/index.html#_
Your code looks fine, you are just missing: `Fresco.initialize(context);` somewhere near the app startup.

No casting is necessary, you can just build `DraweeController`. See the example in our sample app:
https://github.com/facebook/fresco/blob/master/sample/src/main/java/com/facebook/fresco/sample/adapters/FrescoAdapter.java#L63
 ...continuing discussion from reddit comment.

"SimpleDraweeView was not initialized" is thrown if `SimpleDraweeView` is instantiated without previously initializing it (static method). `Fresco.initialize` does exactly that:
https://github.com/facebook/fresco/blob/master/drawee-backends/drawee-pipeline/src/main/java/com/facebook/drawee/backends/pipeline/Fresco.java#L44

So, I suspect that you are not calling `Fresco.initialize` early enough. Where are you doing that call?
 Uri.parse(url) should do the trick. 
 How do you build the Uri?
 There is a bug in our default network fetcher that I'm hunting now. We also provide OkHttp fetcher that doesn't suffer this issue. See: http://frescolib.org/docs/using-other-network-layers.html#_
 Closing this issue because it's not focused. Please create separate issues to track one thing at a time.
 For the record, I found the issue:

```
<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a href="https://freeme.blob.core.windows.net/posts/25_8cb72bffeee54d50bc075be2ad3cf56a_o.jpg">here</a>.</h2>
</body></html>
```

HttpURLConnection does not follow redirection.
 @xbroak , it would help if you could create a separate issue for each problem you have rather than just dumping all of them in one issue.
The URI redirection issue can be solved by using some smarter networking library, rather than the default one which is pretty cumbersome. We do provide OkHttp integration and it should be pretty straightforward to set it up. There is a section in our documentation.
As for the other issues, I don't know what else is there left? There were a couple of typos in the docs, but I believe this has been resolved?
  Please make sure to have ndk-build in your $PATH. Our build.gradle depends on this.
 @dp-singh, are you using AndroidStudio or are you building from command line? We will support building from AndroidStudio soon, but for now the console should do. 
Can you try clearing Gradle cache by removing `.gradle` directory and try again ?
 @dp-singh I would like to fix whatever build issue you are facing. Would you mind letting us know what os (mac / linux / window) you use ? And also, could you try to run ndk-build from imagepipeline directory on its own, so that we can see what is the actual error, provided that it comes from ndk build:
path_to_your_ndk-build NDK_APPLICATION_MK=../Application.mk NDK_OUT=build NDK_LIBS_OUT=build -C src/main/jni/gifimage
 giflib is supposed to be downloaded by imagepipeline/build.gradle. Can you try first running gradlew :assembleDebug (it will fail after downloading dependencies) and then repeating the same once again ? And one more question, what is your ndk version ?

Thanks for helping.
 @KennethYo did you add ndk-build to $PATH variable ? If so, then gradle should be able to find ndk-build without specifying full path, unless you run it from Android Studio - we don't support it yet, but this is about to be fixed.

@appledong , @BaronZ, @littletanker - lets keep this issue mac only - as title states. There is similar issue for windows: https://github.com/facebook/fresco/issues/24 lets continue windows related discussion there.
 Too many issues are being reported in this thread. Closing it.
- For Windows build issues, please see #24
- For duplicate-giflib issue, see #50 
- For WebP quota issue, see #52 
  If the image is JPEG, you can try [resizing](http://frescolib.org/docs/resizing-rotating.html) it first. The resize happens before decoding, which is generally where OOMs occur.
 I would have to see how SubsamplingScaleImageView works. If the image file is very big, then it might not be feasible to load the whole image in memory even in encoded format. That means that subsampling or cropping has to happen during decoding from file.
I am not sure what is the API that SubsamplingScaleImageView  uses, but perhaps it is possible to get the File in our disk cache and let SubsamplingScaleImageView  then read directly from it.
 Thanks @jparkie . BitmapRegionDecoder is API10 which is good as GB MR1+ is supported. We should definitely make use of this.
 Hi @davemorrissey ! I am thinking of adding a support for getting a File handle to our disk cached resources so that the file can be read directly rather than going through our pipeline. That would help integrating SSIV with Fresco backend.
We use libjpeg-turbo, but I am not sure whether it supports region decoding. I am sure that the JPEG format is suitable for that as the image is split into 8x8 pixel blocks, but whether the library makes use of that I am not sure. It would be worth checking though.
 Please also see our sample code for pinch-to-zoom with Fresco: https://github.com/facebook/fresco/tree/master/samples/zoomable/src/main/java/com/facebook/samples/zoomable
 I guess it should be possible to add a custom Fresco decoder that supports something like this: 
You get the `EncodedImage`, create a new `CloseableImage` type that holds the required data and then use a `DrawableFactory` that creates a new `Drawable` type that uses that data. This could be combined with our sample code for zoooming with a new View that can update these special drawables to decode the correct region. I started working on region decoding support that can right now be used from a custom decoder. I'll add a quick sample so that this can be enabled before the full support is available in Fresco. A really basic example for this is now available in the Showcase app, see baa629dd46797a3342a50b918ea0989b63819c87

Keep in mind that this only works for JPEGs right now and that this still needs some work if the image is resized / downsampled since the `BitmapFactory.Options#inSampleSize` value is not correctly handled.  We are thinking of supporting something very similar (basically either a custom uri handler or specifying InputStream Supplier while building image request).
 I'll have to refactor some of the fetching logic to make this plugin-like, but hopefully I'll get to this some time soon.
 I don't think we're likely to get to this any time soon. If someone would like to offer a pull request, I'd be willing to offer support.

We're currently cleaning up old issues which aren't progressing but I'll leave this a little longer in case anyone is interested in pursuing this. Closing this as part of our cleanup of old issues.

If anyone requires this feature, please consider implementing it and submitting a pull request.  Thanks for the correction! I'm traveling now but should be able to get to this next week.
 This has been merged.
