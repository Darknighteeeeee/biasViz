```bash
rico345100ui-MacBook-Pro:jasmine rico345100$ npm install --save-dev nightmare
Mmm, that's troubling.
D'aw.  I can't take hardly any credit, but thank you anyway.
Popups are not directly supported by Nightmare, and while I am certain the `preload` script doesn't get inherited with popup windows, I would not be surprised if other settings such as proxy are also not inherited.  This seems like an issue you should open with the `DefinitelyTyped` project, as we don't have any control over their typedefs. Closing as this is a `DefinitelyTyped` issue.  I haven't had a chance to dig into load testing Nightmare recently, and now you have me curious.  I'll see if I can carve out some time to tinker with this at some point soon.  I suspect you're _probably_ right, that this is a memory issue, but I haven't seen Nightmare start popping up windows unless they're generated from the site, and even then, I can't remember exactly the last time I saw that behavior.
I'd be curious if you set up something like [`nightmare-crash-reporter`](https://github.com/rosshinkley/nightmare-crash-reporter) if that might yield any useful information.  (I kind of doubt it, but hey, can't hurt to look.)
nightmare
var Nightmare = require('nightmare');
while(yield nightmare.exists("some-button-selector")) {
yield nightmare.end();
If you move the Nightmare instantiation into the Express `post` method, you will likely have better luck, but be careful: this method will not scale particularly well.
var Nightmare = require('nightmare');
Nightmare.action('show',
Nightmare.action('hide',
As for why it freezes: I guess my first question would be, how many containers are there, and second, how are you ending the Nightmare instance?
let m = new Nightmare({
.goto('http://www.ttilgb.com/main/index.do')
.wait(`#pUsrPwd`)
.insert("#pUsrId", hanjin_credentials.id)
.insert("#pUsrPwd", hanjin_credentials.pw)
return m.end(() => { console.log(green(`\nSuccessfully grabbed ${chalk.bgRed.white.bold(count)} containers release information from [${chalk.bgCyan.white.bold(`HANJIN`)}] terminal.`)) })
It acts as a proxy, produce reliable HAR and I can still use Nightmare if you loke.  How are your Nightmare instances getting created?  It looks like the instance isn't ever created based on your source.  Also, what version are you using?  Are you getting errors for the instances that are hanging?
@jekku Babel inserts a function to handle this for us:
Under Nightmare 2.9.1, I could not recreate the behavior you're seeing.  Out of curiosity, what are you returning from `.evaluate()`?  There are multiple questions here, I think.
> Can Nightmare do multiple requests in parallel?
No.  Think of a Nightmare instance as a single tab on a web browser - it wouldn't make much sense to ask a tab to go to multiple locations at once, for example.
Yes, you'll need to end the Nightmare instance.  I doubt you'll want to reuse Nightmare instances across requests.
nightmare
nightmare
If you move the `done` call to the line after `clearCache`, does the cache actually clear?  This may be worth opening with Electron.  Thoughts?
This is a somewhat complicated topic.  See #646.
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.goto("https://google.com")
return nightmare.screenshot('abc.png');
//error condition?
.then(function(){ return nightmare.end(); })
.catch(function(){ return nightmare.end(); })
I re-read what you had done and tinkered for a bit, I'm going to go ahead and say LGTM and that this should get included.  Thanks!  You can certainly do a conditional injection.  From the hip, something like:
var nightmare = Nightmare();
nightmare
return nightmare.inject('js', 'jquery.min.js');
nightmare.click(mySelector) ...
nightmare
Is [`.action()`](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) what you're after?  That gives you the ability to define custom actions on the Electron instance.
@zatziky upload dialogs are _very_ tricky, requiring tapping into the debugger API.  There is a plugin for that: [`nightmare-upload`](https://github.com/rosshinkley/nightmare-upload).  Sending keyboard events to Electron for upload dialogs won't work.
The answer is no.  Nightmare is a wrapper for Electron, and will not work without it.
nightmare
@anperez78 Did you take a look at `nightmare-download-manager` or `nightmare-inline-download`?  The short answer is no, not out of the box.  New `BrowserWindow` instances are created under Electron and are not created with all of the Nightmare sugar for interaction.  (It's planned for a future release, see #593.)
nightmare
.then(() => nightmare.end().then());
I don't know that this is possible (someone correct me if I'm wrong).  This is tantamount to asking for a promise to come through a promise resolution unresolved itself, which (memory serving) breaks Promise standards.
Your `.use()` function calls `.then()`.  That's almost certainly going to lead to unintended side effects with queue management, so I'm not terribly surprised you're seeing strange behavior.
> What criteria nightmare uses for choosing when it is going to queue or when it is going to run the queued operations?
var Nightmare = require('nightmare');
var nightmare = Nightmare();
return function(nightmare){
nightmare
return nightmare.use(functionToUse('p'));
var nightmare = new Nightmare();
nightmare
.goto(site)
return nightmare.click()
Looping over Nightmare chains as you have it won't behave as you'd expect, and can cause unexpected problems.  I suggest you read [Asynchronous Operations and Loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md).  That might not solve all of the problem, but it will eliminate any strange behavior from looping on the same Nightmare instance.
This is because Nightmare uses the same callback style that Node uses where the first parameter is an (optional) error.  Consider:
var Nightmare = require('nightmare');
Nightmare()
var Nightmare = require('nightmare');
Nightmare()
I [found the original conversation](https://gitter.im/rosshinkley/nightmare?at=574b580aa78d5a256e38f3cd), and I _thought_ there was an outline on logs/testing for verifying that was the problem, but it's not jumping out at me.
The "button" part of your question confuses me: what are you trying to do?
Ah, I think I misunderstood the problem you're trying to solve.  You're after something blocking, I take it?  That's trickier, but there are a couple of options.  You could manually block using `.wait()`, which would solve your asynchronicity problem.  Or if you really want to get crazy, you could take a look at implementing a soft-blocking action to wait for your page errors, akin to how [`nightmare-inline-download`](https://github.com/rosshinkley/nightmare-inline-download/) works.
nightmare
@cagataycali In addition, you're not passing values to `.evaluate()` to print.  From the hip, this should work:
nightmare
Taking a stab in the dark, would something like this help?
nightmare
return nightmare
nightmare
return nightmare
nightmare
return nightmare
Poking a head in: Thank you @Mr0grog:
The downside is that (I think) it would be a breaking change to Nightmare 2.x, which I'm not against, but it would have to be handled ... carefully.
What are you trying to do?  There might be another angle.
It looks like you're trying to call `.action()` on a Nightmare instance instead of the Nightmare prototype.  Is that the case?
Setting that aside, and this is kind of offtopic: I'm not certain Nightmare is the best tool for converting SVGs to PNGs.  Have you considered using something like [ImageMagick](http://imagemagick.org/script/index.php)?  `convert` will give you _much_ more flexibility for image manipulation.
nightmare: 2.7.0
Navigate to wells fargo and try to do anything.
var Nightmare = require('nightmare');
nightmare
return nightmare.end();
```  `Nightmare.action()` does not work as I would've expected it to, where `done` is always the last argument.
Nightmare.action('iframeHeight', function(selector, done) {
Nightmare runner error:
Nightmare.action('iframeHeight', function(selector, done) {
Defining multiple arguments is a bit weirder:
Nightmare.action("broquire", function(id, browserValue, done) {
Optional arguments are even weirder:
Nightmare.action("broquire", function(id, browserValue, done) {
// Avoid weird magic with `nightmare.broquire(id)`
var Nightmare = require('nightmare');
var breadcrumb = nightmare
Are you trying to bundle Nightmare into an Angular2 application?  I'm not exactly clear on what the problem is.  Could you provide more information?
I don't _think_ it's a security problem, and what's truly unfortunate is that the code is the generic networking timeout.  What version are you using on your headless setup, and how are you executing headlessly?
In your `.catch()` block, you're trying to use jQuery from within your script, which isn't going to work.  You have access to the failed URL - you're creating it in `.goto(endpointPsicos + i)`.  Couldn't you push that + the error?
@ivan-kleshnin What version of Nightmare are you using?  When I run your second example with 2.6.0, I get the expected behavior of typing in `#email`.
I'd be curious to know what operating system and version of Nightmare you're running.  Electron (and Chromium) misbehave beyond the texture size limit (see #616 and possibly #695) - is it possible you're hitting that?
@Mr0grog hm, that's odd.  I'm curious what changed, but in this case, I _imagine_ fixing it first might be simpler.
@voidmonk Out of curiosity, what version of nightmare are you using?
@Mr0grog is right, the provisional load failure is causing an exception.  In your last comment, that exception is handled, and should work fine (although your `.then()` that handles the status code will not be called).
(Also: Possibly related to #405.)
Could you do something like `DEBUG_FD=3 DEBUG=nightmare*,electron* node my-script.js 3>log.txt`?
(Alternatively, I think you should be able to use `nightmare.on('log', fn)` to capture log messages.)
@Stankye: @vshvydky's answer is on the right track, but unfortunately won't work: `document.querySelectorAll` returns a DOM element collection, which like `arguments` isn't actually an array.
nightmare.goto(someUrl)
nightmare.goto(someUrl)
nightmare
What do you mean "don't appear to do anything"?
var browser = new Nightmare();
.goto("etc")
var Nightmare = require('nightmare');
nightmare
I have some error :
Again, the `DOMRect` that `getBoundingClientRect()` returns won't serialize nicely, and won't cross the IPC boundary between Electron and Nightmare.  You'll lose the properties and be left with an empty object.
nightmare
nightmare.on('did-get-response-details',
resourceType
@AVVS Is this resolved?
@diverse-soles Out of curiosity, what library were you using?
@goddyZhao This is one of the things that #573 was attempting to address.  Currently, there is no way to allow for asynchronous actions in `.evaluate()` out of the box.
Two problems afoot here.
var Nightmare = require('nightmare');
Nightmare.action('envtest',
var nightmare = Nightmare();
var Nightmare = require('nightmare');
yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');
var currentHeight = yield nightmare.evaluate(function() {
var Nightmare = require('nightmare');
yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');
Merging into rosshinkley/nightmare-inline-download#6.
Is this possibly the same problem as #596?
Hm, that's ... odd.  I would not expect a texture tile to be rectangular.  This makes me wonder if it's something perhaps Windows-specific.
@trompx `XRANDR` being missing is not that big of a deal; unless you're explicitly loading it with `Xvfb` (or whatever X buffer you're using), that line is going to show up, serving as a warning that you will not be able to resize and rotate your buffer.  The original problem with this thread had to do with how Electron was being started, and on certain flavors of Linux, was crashing, which would cause Nightmare to misbehave.
Hm, out of curiosity, what version of Nightmare are you using?
I'm not sure I follow: when you click `#submit1`, the browser you click in closes?  Have you tried this with `.catch()`?  Also, are you sure the popup does not appear?  (The base Nightmare window is set to be always on top.  Try moving it around to see if the popup is hidden.)
Interacting with a Flash application is going to be difficult with Nightmare.  What are you trying to do?
var Nightmare = require('nightmare');
You should see the Flash intro animation letting you know it is working properly.
var browser = Nightmare({
var browser = Nightmare({
nightmare
nightmare
> I had tried that as well. I tried again and neither of the examples you change anything i.e. I could change the switch (proxy-server) to lkjlkj-weioruweoriu and the code still runs the rest of the program.
Hm, setting `proxy-sever` to a bogus URL (or even a malformed URL) causes provisional load and load failures, at least with 2.5.0.  Out of curiosity, what version of Nightmare are you running?
nightmare
.then(() => nightmare.end());
I am guessing you're referring to `.action()`?  This is a very different mechanism - `.action()` adds an action directly to the Nightmare prototype, also adding all of the sugar required to execute a method inside of Electron.
Nightmare.action('selectHasOption', (selector, option, done) => {
I'm not saying it's correct.  Scope and use of Nightmare has changed.  A lot.
@kuyoonjo Be sure you're calling `.then()` after `.end()`.  That will run the queued actions (if any) and end Nightmare gracefully.
@kuyoonjo also, if you have a more complete example, I'd like to see it.  I might be able to help more that way.
return nightmare.end();
Ah, that's a good call.  I'll have to look into that a little deeper, what do you think is reasonable?  Latest 4, latest 5, latest 6?  Something like that?
@Mr0grog Thoughts?
Mmm, _maybe_ - this feels a bit out in the weeds, though.  I say let's not complicate the method signature until it's demonstrably useful.  Thoughts?
related: #593, #645, #646
@RoryJShevin Can you post a minimum reproduction of this problem?  Also, what version of Nightmare are you using?
Related: #646, #593, #645
@albinekb This will get pulled into the next version. :)
@Muyv Is this resolved?
Hey Nightmare Team,
In the case of the new promise-based nightmare, the failure is just a timeout since I have yet to figure out a way to have an intermediary step.
Hey @Mr0grog,
return nightmare
// this might only be possible with VO.
// const image = yield nightmare.screenshot();
// only way to get yield to work, sort of in a promise
// fun way of trying generators, but doesn't work either.
//  yield *nightmare.screenshot();
nightmare.end();
@atomless Is this issue resolved?
nightmare
var Nightmare = require('nightmare');
yield nightmare.goto('http://someInfiniteScrollPage.tld');
var currentHeight = yield nightmare.evaluate(function() {
yield nightmare.end();
Node 4.x+ is recommended for Nightmare, but I see now that it's not listed as the engine in `package.json`.  (I also know that assertion had been made before, but it's not jumping out at me where.)
@dcshapiro What version of node and nightmare?
nightmare
Scratch that, I'm wrong, [jsbin](http://jsbin.com/coxekatofe/1/edit?html,js,console,output) to prove it.
I'd like to (like you) see more usage before making the change, but I also agree this feels much more in the spirit of "doing things as an actual user would", which is in keeping with the spirit of Nightmare.  Given that it seems to be causing enough problems, I'd be open to moving it into core.  Thoughts?
I suspect that DOMElement's parts are non-enumerable, and as such not crossing the IPC boundary.  In other words, it's not going to serialize well.
var Nightmare = require('nightmare');
nightmare
.goto(startingLink)
Interesting. Thanks @lukehorvat.
- can't you async/await now? nightmare implements thenables, which are basically lazy promises and should give you all the advantages of promises, without cluttering up your API with promise-specific syntax
i'm going to leave it up to the others to decide to merge or not, since i haven't been actively working on nightmare lately.
var Nightmare = require('nightmare');
nightmare
You're using `yield` outside of a generator, and I don't think that's legal.
> Other note: if engineVersions is only available on a Nightmare instance, maybe no great need for execSync.
... also to add another possible wrench to the mix, and maybe another point for the original incarnation, this will cause a process to never quit:
var Nightmare = require('nightmare');
var nightmare = Nightmare();
Poking a head in:
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');
partition: 'custom'
nightmare
@yotamlaufer Awesome, thank you.
With please. I love nightmare!
It will be really useful to set chromium arguments, allowing tweaking of the runtime.
- Native `iframe` support and management - #203, #496
- Manipulating elements with custom predicates - #867
...to something more like....
Me too.  And I _wrote_ the [expletive redacted] thing.  I'm going to go on a limb and say it's the most unwieldy part of Nightmare, and humbly apologize.
> maybe a subtype, like NightmareError or something
This is a case I would not have thought of.
I'm wondering now is if instead of exiting, the Nightmare instance should be put into an error state where any further calls would cause exceptions as the IPC parts are no longer reliable.
1. Should Nightmare override the environment variable for `ELECTRON_ENABLE_LOGGING`?
var nightmare = Nightmare({});
return nightmare.goto(url);
My first off-the-cuff idea would be to wrap `.on()` and/or `.emit()` to warn of safety concerns when it is used in plugins (although I can think of situations where one might want to manage events themselves).  What change were you planning to propose that would break plugins?
> So do you think it should throw an exception? Or maybe just log a warning?
@Mr0grog Good.
Related: #563, #572, and an attempt at fixing in #576.
@lzrski Off the cuff, I'd say have the Nightmare process to wait for the promise to be settled, yes.
var nightmare = Nightmare({waitTimeout:500});
return nightmare.goto(fixture('navigation'))
nightmare
Some off-the-top-of-my-head solutions:
nightmare
.goto(url)
@mxmz- Are you still having this issue?
Hm, that might be related to #602.
@mxmz- Did you get this resolved?
var element =  document.getElementById('hplogo');
> What is that weird object with the __jsaction property?
Changes the makefile to run tests under an `xfvb` wrapper called `bb-xvfb` under one or more the following conditions:
@silenceisgolden Can you upgrade to 2.3.4 and see if you're still getting this issue?  I wonder if it has to do with #375 or possibly #553.
@JWMarchant @misbach @Mr0grog for what it's worth, #640 has been released with 2.5.0.
What bothers me about your particular case is the "exited with code null" bit: The only time that happens (at least that I'm aware of) is when a segmentation fault occurs in Electron.  Could you provide a minimum case that reproduces the issue?
@lunow if that's true, it's likely got a different cause.  Could you open a new issue with a minimal reproduction case?
Digging into the test failures that happen intermittently, it looks like the behavior that causes the tests to fail also will present in regular applications (albeit seemingly not as often).  Consider the following (extremely contrived) case:
var Nightmare = require('nightmare');
return (Nightmare())
.goto(url)
Some other peculiar (possibly unrelated?) things that cropped up as a result:
To that end, I think this might be `xvfb`-specific.  Anyone else having hanging problems with `xvfb`?
_(Warning: this thread is about to go offtopic.)_
- Constructing Nightmare-compatible `BrowserWindow`s would probably need to be broken out into its own class, somewhat similar to how you implemented `FrameManager`, and a similar class in the calling process will probably need to be constructed.
- I'm betting you had parallel execution in mind as well, which makes the problems in #493 all the worse.
Oooh, I'm not sure I agree.  `child` may take on a different meaning (eg, a Nightmare `BrowserWindow` could be attached to an Electron `BrowserWindow`, and I'll get to more on that in a minute).
I _also_ like to live dangerously.
@djdavidi I'd be open to including a bit about unicode characters.
How are you getting these errors?  Are you using custom plugins?
@GautierT I think this is in reference to rosshinkley/nightmare-download-manager#14, picking up this conversation there.  I suspect you're hitting a device limitation.  Electron is kind of resource-intensive, and even on the best of machines, I suspect that the number of concurrent instances you can run is pretty low.
nightmare.goto(url.link)
return nightmare.end();
cargo.push({
@Mr0grog re your previous comment: like I said, my knowledge there was limited.  Thanks for setting me straight.  :)
> Side note: I realized while looking at https://circleci.com/gh/Mr0grog/nightmare/13 that I didn’t really do a very good job with the “fail if the response dies in flight” test. Going to rewrite it by adding a server endpoint that just kills the socket, which should make the test reliable.
I'm still having failures, but I think it's for an entirely different reason.  I'm not sure if it's a resource issue or what, but somewhere in the neighborhood of 50-60 runs, my sandbox (on my low-powered laptop) will hang when starting an Electron process.  (I feel like there's an open issue for this already - #238, maybe?)
Offtopic, but do you (or anyone else) know why `dom-ready` events are emitted even for provisional load failures?
No, it was one of the `.type()` tests, but that family of tests has been flaky for a _long_ time.  It's spookily similar behavior to this: doesn't fail on decent machines, intermittently fails on modest machines, and seems to almost always fail in CI (at least, the first time).  It's next on my bug hunt docket.
@Mr0grog _Awesome._  I'll put this out as soon as I can carve the time out.
, nightmare = Nightmare({
nightmare
@khafan246 Are you still having this issue?
@suhaotian Turns out I was wrong.
@yoz Any updates?
Oh boy, I didn't read carefully either.  I apologize.  Good catch, @kuraga.
> P.S. @rosshinkley , Add queue argument to callbacks, maybe? And why result of nightmare.then(cb) isn't chainable?
nightmare
.goto(url)
//do some other logic
return nightmare.end();
//nightmare is now ended
@Mr0grog This is about a thousand miles offtopic, but would it be worth implementing a crash report server internal to Nightmare so the child Electron instance submits crash reports directly to the parent process?
Hm... that sounds like something strange in the input bindings on the site.  It's almost like the changes to the input aren't being picked up by whatever the site mechanism to issue a search is.
nightmare
@sanathko I think so.
I need nightmare to make the app I'm working on to run, as I've not found a better alternative for electron.
> @Velissel I understand you want to preload the cookies before navigation, but I don't think Nightmare allows for adding cookies prior to navigation. I still don't think adding cookies across domains like you're doing is permitted.
@antpaw Yeah, there are intermittent failures I haven't gotten to the bottom of.  Have you had any luck?
@antpaw Have you given this a try with later versions?  I wonder if you're hitting the `Xvfb` hang from #561.
@antpaw Do you have `DEBUG` output?  What version of Node are you running?
Can you run it again with `DEBUG=*,-mocha*` under 2.5.0?  Also, what operating system/version are you running?
@Mr0grog Yeah, this may be a case of me trying to do an awful lot of work to save someone (me, if I can be totally selfish) ten seconds of setup grief.
> Maybe start xvfb separately
Yes - from within Nightmare - but not without a bit of patching to how `.action()` works.  (It doesn't have an ambient reference to `process`.)  With that, you can bubble the Electron PID up to the parent process.  It's ugly.
> Obviously this whole method requires more bookkeeping: whenever an Electron process ends, you’d have to check and see whether any others are running in order to know whether to stop xvfb.
It's not _just_ `xvfb` but also `dbus` that would need to be tracked.  I also wonder if running them independently but started in series if that's going to have any ill effect?  At any rate, I understand what you're getting at.  It's worth a look.
This would not break anything as it requires an environment variable to be set to be used.  Currrently, I have it set up to pick up if Nightmare is running under Circle, but I think I may remove that.  I don't want to add new behavior to existing builds that may already account for Nightmare/Electron's special needs.
I (embarrassingly) had forgotten about the Chromium command line switches.  No, I have not, and will carve out some time to give that a whirl.
I wasn't trusting anything to come out of Electron.  I didn't know how reliable the information that fell out would be.  I can give this another peek and report back.
> But if this is all proving too crazy and problematic, than letting it lie and taking the timeout/retry approach might be the right thing to do.
nightmare
.goto(url)
nightmare
.goto(url)
nightmare
.goto(url)
@LinusU Are you referring to `*sync` methods and when they except, maybe?
@tiangolo I think this would be better served as a plugin for Nightmare.  Thoughts?
@tiangolo I saw the comment, thanks for the pointer.
@tiangolo I'd suggest opening issues at nightmare-iframe-manager.  (Looking at it offhand, I'd bet there's a problem with the Nightmare version.  I put the plugin together more as a proof of concept than anything.)  Time permitting, I'll see if I can fix the glaring problems.  If you could report the issue(s) you had there, that would help tremendously.
nightmare
.goto(url)
.someOtherAction()
return nightmare.goto(anotherUrl)
I'm guessing you'd expect the first three actions to execute prior to the actions in `.then()`, right?  Are you envisioning `.then()` being an action that acts like Underscore's/Lodash's `.tap()`, or would there be a differentiation between the queue being executed and the queue that is accruing tasks?
This could also lead to unintended consequences with memory for sufficiently large sets, but I'm okay (at least for the moment) with assuming that if you're using Nightmare to do an arbitrarily large number of tasks, you already Know What You're Doing&trade;.
nightmare
.parallel([
nightmare.action().anotherAction(),
nightmare.action().yetAnotherAction(),
nightmare.anotherActionStill().somethingElse()
There are a couple of things with this approach that bother me.  For one, I _think_ the Nightmare instance doing the queueing would arguably need to be a full-on capital-P Promise implementation (whether that's done explicitly or with inheritiance).  That would let it remain compatible with existing tools like the `vo`/`co`/`mocha-generators` family of libraries.
nightmare
return nightmare.action2();
nightmare
nightmare
return nightmare.action2(); // implicit then caused by return
nightmare
(Aside: you're right, this gets nightmarish [har] in a hurry.)
And ultimately, I'm still head-tilting at arranging Nightmare calls in this way.  It would run deterministically (unlike the wild of now), but I still don't think it would Do What You Mean&trade;.  A naive reading of the above makes it look like you're doing two completely independent chains of actions on a single nightmare instance, and based on what we're describing here, that's just not the case.  (Nor should it be.)
@Mr0grog you mentioned a lot here so let me address a few things:
thanks @Mr0grog !
Nightmare (via Phantom):
Nightmare (via Electron):
depends on the use case :-) i'd probably prefer a plugin, but i think there could be an argument for providing a high-level way to intercept requests in nightmare.
Killer. Great fixes. Thanks!
@rehael I'd be curious if NTLM causes the [`login` event](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-login) to be fired.  I suspect the answer is no - which would explain why `.authenticate()` doesn't work - but I'd appreciate it if you (or someone else) would double-check.
This could be confusing with how `.action` works, but is sort of inline with `.use`. I'm not crazy about having all these sorta different, but obscure ways to extend nightmare. I think it was discussed a bit in https://github.com/segmentio/nightmare/issues/379.
> Adding Nightmare and Electron actions together makes more sense to me than adding Electron actions alone. Thoughts?
Yah, I think you're right, but maybe actions/use could be nightmare-side only and there's an optional electron side.
Some general aestetic thoughts: I'm not crazy about passing an object in with `nightmareAction`, `electronAction`. I think two functions would make more sense since folks are used to `.evaluate(browser_fn, server_fn)` but I'd be open to other solutions too :-)
closing since this is a dup of #224
I am too, and I apologize if I didn't make that clear.  I wanted to float the idea to see what everyone thought.  I was tinkering with the idea more seriously after you (@Mr0grog) submitted #579: With the progress events, it might be helpful to add logging there, but would make running Nightmare with DEBUG _wildly_ verbose.  There are probably other events - like any of the events that are simply forwarded - that could be dropped to a lower log level.  My main goal was to help manage verbosity, but that may very well be a misguided early optimization.
@Mr0grog Yeah, it's getting a _bit_ into the weeds. :)
@kanethal No problem!
@kanethal Did you have any luck with an upgrade?
/cc @zcbenz in case he has any other ideas :-D
Nightmare()
.goto(url)
Unfortunately, creating a new Nightmare instance for every request seems to also have issues. See #561.
@contra Are you still experiencing this problem?
@LikeJasper I don't think I've ever seen `debug` behave like that... I wonder if it's interpreting a backspace or non-character escape?  If you could put together a minimum case that reproduces that behavior, I'd love to see that too.
@rosshinkley I am new to nightmare, could you please explain how to use partition to share session between multiple instance of nightmare?
weirddd. can you give me the code snippet you're using?
@dingziran Oh, I think it might be electron renaming it's options, try `webPreferences`.
interesting, can you explain to me a little more about what the advantage would be? it seems like the module you linked is also a node process that manages electron processes, it can just manage more than one.
@rosshinkley yah, terrible names haha, should probably change them to `node_process`, `electron_process`, and ... `render_process` (?). yah, I'd like to see what you have in mind. PR or commenting in this issue seem reasonable. Would be nice to see some example code, like how a dev would extend it.
open to ideas.
I believe before 2.1.5, the keydown/keypress/keyup events were not getting sent through Nightmare, and I wonder if that's causing you problems.  Could you upgrade and try again?
yield nightmare
One thing we should also consider is... does nightmare even need to support downloads? Or can we get away with:
var url = yield nightmare
Nightmare.action('download', function () {
Nightmare.action('evaluValue', function*(value, cb, done) {
yield Nightmare().evaluValue('some value', function cb() { ... } )
yield Nightmare()
@contra ahh, are you seeing it hang forever if the initial page load fails? right now it's only initialized when you call `.wait()` before a click or something. that should be fixed.
@joychester I wrote two quick test cases:
**nonexistent element**
nightmare = Nightmare();
**function that never returns true**
nightmare = Nightmare();
@joychester A quick look yields that `webBrowser.evaluateJavaScript` is hanging once in a while and not calling back.  Electron doesn't have any errors when it happens.  This problem is not unique to StubHub - it happens with Yahoo and Youtube as well.  I'm not 100% sold that waiting for an element created after DOM content loaded is the cause, or that the site is an SPA.
(As an aside, I can hack around it by forcing the `javascript` handler to poll if the callback has been called, but that is terrifyingly hacky.)
yah me too :/, but the added complexity wasn't worth it imo
let's see if more people need this. there's a million things nightmare _could_ do, it's up to us to make sure the API remains simple, while not being limiting.
// custom event triggered
`nightmare.scrollTo(top, left)`
@Kreozot haha, yah i was thinking about that... not sure how it'd look unless we break the API. I guess we could maybe do:
Okay, I've added `Nightmare.action` to support this PR. Here's how you'd do it:
Nightmare.action('screenshotSelector', function (path, selector, done) {
yield Nightmare()
@felixcrive, sorry i'm not sure what you mean, do you mind showing me what you mean?
@fentas Custom eventing is now a plugin: [nightmare-custom-event](https://github.com/rosshinkley/nightmare-custom-event).  I'm going to go ahead and close this item.  If you have any more questions, feel free to reopen/open another issue.
@yonatanmn Everything passed from Nightmare to Electron is serialized, and functions do not serialize nicely.  If you find that you need methods in `.evaluate()` commonly, you may want to look into defining a custom preload.
nothing planned, but we'd like to support proxies at some point, here's a good place to start #241. We'd gladly accept a PR :-)
Closing since this is a dup of #372
@ilabvb did you get this resolved?
may i ask what the usecase is here? the window should be hidden in nightmare, so i'm not sure why you'd want to move it.
yah, i think you'd want to do this outside of nightmare, unless electron provides support for it as an option, i don't think we'll support this in core.
i think this might be an underlying electron issue?
@chentsulin @TonyWang031 Depending on the version of jQuery being injected, they could end with sourcemap comments, which would cause the end of the calling function that encapsulates the injected script to be commented out, causing a runtime error.  I would be willing to bet this is what you were hitting, given the unminified version worked but the minified version wouldn't.
@edasque @smallcar88 @davis Are you still experiencing problems with `.evaluate()` and fat-arrow functions?
Wow. This would explain a lot of the inconsistencies.
@Zn4rK Awesome!! Thanks!
@juliangruber nice!
@scarletsky as far as i know you'd need to filter for the resource you are looking for yourself
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
var link = yield nightmare
yield nightmare.end();
thanks @antpaw !
@miaomi Hm, the errors look like `electron-prebuilt` is either not installed or didn't install properly.  Try wiping `node_modules` and running `npm install` again.
@WMeldon It's best practice to end the Nightmare instance when you're done.  Otherwise, the child process will remain running forever and you will (rightfully) get Mocha timeouts.
i do agree that `exports` shouldn't have made it into the spec though.
Thanks @antpaw !
awesome, thanks! i went ahead and bumped these deps
@tejasmanohar yep, i like that more. I think we should keep the makefile, but the other stuff looks good!
You have to wrap it in `co` or `vo`
var Nightmare = require('nightmare');
yield Nightmare()
return yield Nightmare()
var response = yield nightmare
.goto(page)
@jney Is this still an issue?
@toppetoppe i modified your example slightly and ran it locally:
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
var count = yield nightmare
.goto(url)
yield nightmare.end();
yield Nightmare()
Guys, I can see why this is confusing but you are thinking about it in terms of how it should work with promises, which is part of the private API and undocumented.
nightmare
nightmare
}, onerror)
whoa i totally jumped to an early conclusion on this one, confusing `run` with `end` — my apologies!
is there a specific behavior you're looking to see documented? thanks for the find!
yield Nightmare()
Nightmare()
var nightmare Nightmare()
nightmare.end(onEnd)
It really should propagate through. Are listening to the `nightmare.on('error')` event?
Wow awesome! Definitely think both of these features should be in Nightmare.
Looking forward to seeing these features in nightmare!
anything more (promises/yields) than just do some argument checking with
Re: proxy Api. I think you should support whatever mongodb
@ndamjan Are you still experiencing this problem with more recent versions of Nightmare?
:dancer: code deletion i love it
yikes, it shouldn't have. x-ray will be a user of new nightmare very soon though ;-) just trying to work out the details
var url = yield Nightmare()
closing as dupe of #224
Hey there! I'm not sure exactly what's going on here just yet — what version of nightmare do you have installed? (looks like 1.x, have you checked out 2.x?)
var body = yield nightmare()
closing as a dupe of #228
Yikes, major issue.
libasound2 libxtst6 libxss1 libnss3 xvfb
npm install segmentio/nightmare
# Start Xvfb
@richard5mith i'm not very familiar with `xvfb`, by `xvfb-run` do you mean the instructions i provided? or is there a simpler way?
``` docker
xfonts-cyrillic \
libxss1 \
gcc-multilib \
g++-multilib
Trying to legitimize this a bit for us all, but major strugglez :-P
@pelhage well, Electron sure doesn't take _a few seconds_ to open like PhantomJS does.
var Nightmare = require('nightmare');
yield Nightmare()
var Nightmare = require('nightmare');
Nightmare()
Or even promises (well, thenables):
var Nightmare = require('nightmare');
Nightmare()
got it, yeah that's a dependency of nightmare unfortunately. in v2 (see #200) we've moved away from phantom and i've just verified that the latest build of v2 runs fine on v4:
Run nightmare one time
yield nightmare
yield nightmare
yield nightmare
<iframe name="formIframe" src="somelogin.php" />
nightmare
.withFrame('formIframe', function (nightmare) {
nightmare
.type('#username', 'rclai')
nightmare = Nightmare();
.then(() => nightmare.cookies.get())
//end the nightmare instance
return nightmare.end()
var nightmare = new Nightmare();
yield nightmare.close();
if you have other feedback or frustrations at this deeper level, please let us know!
cc/ @reinpk @amillet89
yield Nightmare()
yield Nightmare()
@myrubapa gotcha, you can always continue pulling `1.x` or fork from that commit. phantomjs had SO many weird issues upstream that we had constant reliability problems with it. we opted for a smaller feature set that worked reliably in our testing.
@myrubapa can you give an example of how phantom was better for you?
@abe-winter @fpinzn in v2 we're moving to using generators and an explicit `.end()` method, which should bring the benefit of stronger flow control.
Like CDNs.
nightmare
yield nightmare.someQueuedCalls();
@lvyachao You could use [`.inject()`](https://github.com/segmentio/nightmare#injecttype-file) to add jQuery to a page and then use `.evaluate()` to execute DOM actions.  There's a [unit test](https://github.com/segmentio/nightmare/blob/master/test/index.js#L231-L247) that injects jQuery to get specific tags, as a reference.
@shri3k's example is problematic, at least with the Electron implementation: a single Nightmare instance wraps one Electron instance, meaning in general you should not try to do parallel operations on the same instance.  Those actions will enter into a race condition and (probably) behave poorly.
i think daydream is probably where i'd start... becomes pretty obvious what the code is doing :)
1. daydream
that is very strange, when you debug do you see it hitting this line at all?
"gzip"
"ATS"
"vary":[
"http/1.1 ir32.fp.gq1.yahoo.com (ApacheTrafficServer)"
1) Nightmare multiple should run fine with two instances in parallel:
1) Nightmare manipulation should emit the timeout event if the check does not pass while waiting for fn==val:
Hey, thanks for using Nightmare and surfacing this issue! Seems reasonable, I'll add it now.
var Nightmare = require('nightmare');
new Nightmare()
var Nightmare = require('nightmare');
new Nightmare()
Another thing to keep in mind is that the `.wait()` function can take a selector, of which the Nightmare instance will wait until it appears.
var nightmare = new Nightmare();
nightmare.goto('https://github.com')
hey @ybak i just tested your script locally and it executes for me in about 4 seconds... since i have two-factor auth enabled i end up on the two-factor auth code page, but it successfully passes the first step of the login process with my own credentials in about 4 seconds.
new Nightmare()
Just curious, how are you using Nightmare?
interesting, looks like a weird problem related to:
from the way the screenshots look, it seems like there's something strange happening with element focus:
unfortunately it's happening a level deeper in phantom
when i run with nightmare@1.6.1 i see the expected behavior:
and then the most recent nightmare version works fine:
yeah totally agree, this is the next major improvement for nightmare i think
Hey @mickaelandrieu, I'm Andy and I'm helping maintain this library.
Hey @mickaelandrieu,
Found this with a quick Google search, using Nightmare with Mocha, Chai for e2e testing:
http://weblogs.asp.net/mikaelsoderstrom/writing-end-to-end-tests-with-nightmare-js
We're seeing a wide variety of use-cases, would love to hear what you've been using it for, thanks!
hey i think that was a circleci issue, can you rebase to master to pick up a few circleci updates and then those tests should pass
rebased but still an issue there :)
weird! i'll bug you about it tomorrow.
yeah, that's a different test failing for some weird timeout issue on CI, unrelated
haha, what?
thanks guys i think it's a weird globals problem, investigating now.
fix released with nightmare@1.6.3
released with nightmare@1.6.2
code:
var Nightmare = require('nightmare');
var nightmare = new Nightmare(options);
nightmare
.goto('http://www.whatismyip.com/')
.screenshot('hasdasda.png')
.run(function( err, nightmare){
phantomjs://webpage.evaluate():6
phantomjs://webpage.evaluate():6
http://www.whatismyip.com/:376
Another Question that i have is : how can I specify the screenshot path into a folder is it .screenshot('/img/hasdasda.png') ? because it doesn't work :(.
var Nightmare = require('nightmare');
goCards = new Nightmare()
this produces a nice stream of what requests are being made. based on that it looks like there may be a javascript validation step on the page, and when the pin is invalid it seems to just clear it... could you post your gift card pin obfuscated but still regex-happy so that i can test a request to the server? don't have any apple gift cards lying around...
could be something funky with ssl as well:
ahhhhh, running the nightmare code in the browser directly:
hmmm, seems like this may be an underlying issue with phantom:
but i'm seeing the same error with phantomjs 1.9.7.... so maybe this is an issue that just isn't being addressed until 2.0
yield Nightmare({ show: true })
@leesei added :)
released with nightmare@1.6.2
@fbm-static that wouldn't be a good abstraction though, that just reveals all the underlying complexity
coming through #241 or related
check out #76 to see what i mean as an alternative implementation
`phantom-node` seems only offer `phantom.addCookie: (name, value, domain, cb=->)` , not `page.addCookie`
2. `self.ph.addCookie('test', 'testValue', cookies[0].domain, callback)` seems need `async` to iterator
ah, bummer, not sure i haven't had a chance to investigate 2.0.0 at all yet
thanks @johntitus!
var Nightmare = require('nightmare');
new Nightmare()
.run(function (err, nightmare) {
this is a mess -- closing and opening a new pr
i think i did this because of irregular event triggering by phantomjs, where oftentimes a timeout was a false negative (i.e. everything had worked correctly, but phantom was being uncommunicative).
thanks! LGTM
nightmare
.goto(url)
Nightmare()
nightmare = Nightmare({show: true});
nightmare
.type('#username', 'blablabla')
nightmare queuing process start +0ms
nightmare queueing action "type" +1ms
nightmare queueing action "wait" +0ms
nightmare running +4ms
nightmare
.goto(anypage)
var x = somelib();
nightmare
if i something wrong?
2. x means the process result (it can be understood here as a verification code), then i'll using the 'x' to fill the form.
nightmare
.goto(anypage)
nightmare
I try to render the page http://mar.mil.br/ which contains this html:
<meta http-equiv="refresh" content="1;url=&quot;https://www.marinha.mil.br/&quot;">
nightmare queuing process start +0ms
nightmare queueing child action addition for "getHAR" +0ms
nightmare queueing action "useragent" +1ms
nightmare queueing action "viewport" +0ms
nightmare queueing action "goto" for http://mar.mil.br/ +0ms
nightmare running +0ms
nightmare:actions .viewport() +2ms
nightmare:log Navigating: "http://mar.mil.br/",
nightmare:log             timeout: 60000 +3ms
nightmare:log page-favicon-updated [{},["http://mar.mil.br/favicon.ico"]] +1ms
{ url: 'http://mar.mil.br/',
server: [ 'Apache' ] } }
nightmare queueing action "wait" +4ms
nightmare running +0ms
nightmare:actions .wait() for body element or 5000msec +1ms
nightmare queueing action "wait" +1ms
nightmare running +0ms
nightmare:actions .wait() for 800ms +0ms
nightmare queueing action "evaluate" +802ms
nightmare running +1ms
nightmare:actions .evaluate() fn on the page +0ms
nightmare running +3ms
nightmare queuing process start +0ms
nightmare queueing child action addition for "getHAR" +1ms
nightmare queueing action "useragent" +1ms
nightmare queueing action "viewport" +0ms
nightmare queueing action "goto" for http://mar.mil.br/ +0ms
nightmare running +0ms
nightmare:actions .viewport() +5ms
nightmare:log Navigating: "http://mar.mil.br/",
nightmare:log             timeout: 60000 +4ms
nightmare:log page-favicon-updated [{},["http://mar.mil.br/favicon.ico"]] +1ms
{ url: 'http://mar.mil.br/',
server: [ 'Apache' ] } }
nightmare queueing action "wait" +6ms
nightmare running +0ms
nightmare:actions .wait() for body element or 5000msec +0ms
nightmare queueing action "wait" +1ms
nightmare running +0ms
nightmare:actions .wait() for 1000ms +1ms
nightmare:log will-navigate [{},"https://www.marinha.mil.br/"] +984ms
`"nightmare": "^2.10.0",`
my code part:
return nightmare
.type('#ap_password', password)
.type('#ap_password_check', password)
return nightmare
nightmare({
.wait('#ap_customer_name')
"chai": "^3.5.0",
"randomstring": "^1.1.5"
code:
const assert = require('chai').assert,
const ua = USER_AGENTS[Math.floor(Math.random() * USER_AGENTS.length)];
const password = 'zdes23dsksfzz';
nightmare
.useragent(ua)
.authentication('lyft', 'Bbm7XSdP0KJi')
return nightmare
return nightmare
return nightmare
.type('#ap_password', password)
.type('#ap_password_check', password)
return nightmare
return nightmare.end();
``` @chtrinh trouble not in registration form. Trouble with waiting for new page DOM loading @mymtwcom: again... `.wait('#ap_customer_name')` sometimes your form will load before you execute `type()`and since `type()` doesn't raise an exception you'll just hit `.wait('.nav-line-1')` and timeout. Nowhere in the code snippet are you waiting for the `<form>` to be load on the DOM.
So sometimes you get lucky and sometimes you don't and your test fails.. which is the behavior you are seeing.
nightmare
.goto(url)
allowRunningInsecureContent: true
nightmare.goto('http://www.google.com')
return nightmare.url();
However, i got an error like:
javascript @ VM106:3
``` hi  @entrptaher,
nightmare queuing process start +0ms
nightmare queueing action "type" +23ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +1ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
- `yarn add nightmare`
- `yarn add --verbose nightmare`
You don't have to share the whole log directly, you can see where it gets stuck and tell us.  subj  I have a code:
var browser1 = Nightmare({
var browser2 = Nightmare({
var Nightmare = require('nightmare');
var browser1 = Nightmare({
var browser2 = Nightmare({
var Nightmare = require('nightmare');
var browser1 = Nightmare({
var browser2 = Nightmare({
const page = await nightmare.goto("https://google.com")
I don't know whether this is a Nightmare issue or an Electron issue, so I'd be interested to hear whether anyone can provide some insight into it, and whether it can be replicated. The same issue doesn't seem to happen in Chrome. I should also note that the bleed is quite fast: the usage seems to grow ~100M every few seconds. Is there any good workaround for this issue, or is it just the case that some sites are going to suck?
partition: 'nopersist',
return nightmare
nightmare
Who, Update, Help!  First off, I have to thank everyone who has worked on nightmare! Coming from phantom, it's been such a relief and pleasure to use so far.
```javascript
workers[i] = nightmare;
```javascript
return await nightmare
```javascript
Looking at activity monitor, I'm going from about 7gb of used memory to 14gb of used memory by the end (out of my total of 16gb). This seems to confirm that it is indeed a memory issue. @louisscruz I'm just curious - what happens if you use different partitions? In your code, e.g.:
workers[i] = nightmare;
here my code:
```Javascript
nightmare
at TypeError (native)
```Javascript
false)
It's strange.  I can visit the sites using Chrome, or Firefox.
The error is this:
code: -138,
nightmarejs latest version
return Nightmare({show: true, dock: true, openDevTools: {mode: 'detach'}})
// Search for the special e2e test account
// This .then() is called after the whole Nightmare session is over
nightmare
.goto(url)
const HANJIN_RELEASES = function (){
let m = new Nightmare({
.goto('http://www.ttilgb.com/main/index.do')
.wait(`#pUsrPwd`)
.insert("#pUsrId", hanjin_credentials.id)
.insert("#pUsrPwd", hanjin_credentials.pw)
return m.end(() => { console.log(green(`\nSuccessfully grabbed ${chalk.bgRed.white.bold(count)} containers release information from [${chalk.bgCyan.white.bold(`HANJIN`)}] terminal.`)) })
await nightmare.click('#element');
await nightmare.goto('...');
await nightmare.click('#loginHeader > li:nth-child(2) > a');
await nightmare.type('#password', 'randompassword')
await nightmare.click('#submitButton');
// but I want to able to use nightmare.on() HERE, not globally though.
Nightmare.action('waitForResource',
Nightmare.action('waitForResource',
EditShipment(/* custom arguments ...*/);
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
code: -501,
import Nightmare from 'nightmare';
import Promise from 'bluebird';
class MyCrawler {
this.nightmare = Nightmare();
The problem here is the `Promise#isFulfilled()` method that is a Bluebird-only method, forcing me to wrap `Nightmare#then()` in an awkward `Promise.resolve(...)`.
import Nightmare from 'nightmare';
import Promise from 'bluebird';
Nightmare.Promise = Promise; // Option #1
class MyCrawler {
Does nightmare have any monitoring capabilities? I need to export the requests/responses as HAR, but can't seem to find any docs in how to.
nightmare
.goto(url)
.getHAR()
An exemplary process for the code of a nightmare:
let nightmare;
await nighmare.authentication(params.user, params.pass);
let resp = await nightmare.evaluate((selector)=>{
await nightmare.end();
await nightmare.end();
throw new Error('PARSER_ERROR');
}, 120000, nightmare);
import {default as Nightmare} from 'nightmare';
import Nightmare from 'nightmare';
For me though, there could be some benefit on the es6 examples change - but it has subtle drawbacks as well.
```javascript
import Nightmare from 'nightmare';
describe('avatar', () => {
await nightmare
nightmare
"test": "jest"
"jest": "^18.1.0",
nightmare.test.js
nightmare.js
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
return nightmare
![](https://i.imgur.com/X2ACH7M.png) @rosshinkley I am using both Node 7, but also babel mostly for jsx and generators  Can we use all actions within a Nightmare custom action?
Nightmare.action('login', function (done) {
Nightmare({show: true})
I'm sure I'm missing something simple here - or perhaps custom actions were not designed for this purpose?
I currently use agousti ( golang) with different web drivers.
return nightmare
.wait(waitInMs)
nightmare queuing process start +4ms
nightmare queueing action "goto" for http://www.gamestop.com/pc/consoles/alienware-steam-machine-i7-1tb/121863 +0ms
nightmare queueing action "wait" +1ms
nightmare queueing action "evaluate" +0ms
nightmare running +0ms
Windows 10 x64 + Nightmare 2.9.1 + Electron 1.4.15
`nightmare.halt()`;
Not sure why that was added, but probably solves another kind of problem.
I can not help much more, I started using the nightmare only just a few days ago.
If typing out letter by letter annoys you, you can use nightmare.insert(<String>). I think tho this would be useful in making tests for a webpage that disallows pasting to fields. A PR would be nice! :) Didn't know about `insert`...
I tried it (replaced `type` with it) and it doesn't work, maybe I'm not selecting the precise selector and `.insert` would need that level of detail, or maybe it needs a `paste` or `keyboard event` (quite the custom design on the `input` in question...). @rosshinkley Sorry, not a small one...
var Nightmare = require('nightmare');
yield nightmare.end();
Mabe add this too examples? It will be useful for beginners.  ```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
.type('#city', 'BE')
nightmare
Nightmare.action('sendKeyPress',
keyCode: unicodeValue,
keyCode: unicodeValue,
nightmare
And i have error:
var Nightmare = require('nightmare');
Nightmare.action('clearCache',
nightmare
.goto('ulr')
.goto('http://ya.ru')
//.then(nightmare.end())
var Nightmare = require('nightmare');
Nightmare.action('clearCache',
nightmare
Nightmare verision `2.9.1`.
```javascript
Nightmare.action('clearCache',
nightmare
```javascript
nightmare
```javascript
Nightmare.action('clearCache',
nightmare
- The ```Nighmare.action``` interface to register action is weird because of it's (name[, childFn], parentFn) signature. It must be clarified what the "child" and "parent" process are - and the optional value should be at the end - I can imagine the reason was the order, whyever - it's really more confusing. I just say:
- document the rest of the members of the nightmare object
Nightmare.action('testAction', function(name, options, parent, win, renderer, done) {
nightmare
.goto('https://www.everlane.com/collections/womens-newest-arrivals/products/womens-penny-loafer-black')
nightmare
Nightmare.action('changeScreen',
window.screen = __nightmare.ipc.sendSync('set-screen-params', 'aah');
I would like to have this option too, url params don't work for me, provided here action too. I ended up writing new script every time I open new session. In my case I have to initialize several options for the window object + local storage.  So I managed to get nightmarejs up and running and it was working perfectly for a while and now it just works sometimes and with some websites not at all..
https://github.com/segmentio/nightmare
https://github.com/segmentio/nightmare
https://github.com/segmentio/nightmare
var w = Nightmare({
.goto(anondefault)
.insert("Password", '*censored*')
.wait("#txtBookNbrs")
.click("#txtBookNbrs") // add container # field
.insert("#txtBookNbrs", 'TCLU7777777')
Impossible modals no more!  Hello,
However for some reason when passing the nightmare instance through the resolve it gets `undefined` on the other end.
See repro:
function getNightmare() {
var nightmare = Nightmare({});
nightmare
res(nightmare);
rej(error)
getNightmare().then((inst) => {
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
undefined
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
> Isn't this because the Nightmare instance is a .then()able itself? If
> <https://github.com/notifications/unsubscribe-auth/AM_RxyOjanMpmFSAw1C3bYhhZ0K-1MFBks5ra8kzgaJpZM4LePHs>
function getNightmare() {
var nightmare = Nightmare({});
return nightmare
getNightmare().then((inst) => {
function getNightmare() {
var nightmare = Nightmare({});
return nightmare
getNightmare().then(printLog)
var Nightmare = require('nightmare');
function getNightmare(url) {
var nightmare = Nightmare({show: true});
return nightmare
.goto(url)
// Opens two nightmare instances async
getNightmare("http://github.com").then(printLog)
function getNightmare() {
return nightmare
getNightmare().then(printLog)
nightmare;
return nightmare
nightmare;
return nightmare = Nightmare();
return nightmare
.goto(url)
resolve(nightmare)
nightmare
visitRandomSite()
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: false, width: 1980, maxWidth:100000, maxHeight:100000 });
nightmare
nightmare.click([href=TCLUZZZZ004]);
var Nightmare = require('nightmare');
Nightmare().goto("https://google.com")
.screenshot("abc.png")
Nightmare version is 2.9.0
Nightmare().goto("https://google.com")
.screenshot("abc.png")
`DEBUG=* node nightmaretest.js
nightmare queuing process start +0ms
nightmare queuing process start +3ms
nightmare queueing action "goto" for https://google.com +2ms
nightmare queueing action "screenshot" +0ms
nightmare running +0ms
nightmare:actions .screenshot() +1ms
nightmare:actions .screenshot() captured with length 361068 +467ms
The update here works a treat and I get the then-able nature of Nightmare now.
After hours of research I found issues regarding nightmare & vfb on Ubuntu Server. So I thought it might be a good idea to try the thing with Ubuntu Desktop VM.
- want to manually test nightmare scripts in that Putty shell  So I am new to Nightmare, I am trying to simply run a few checks on my staging environment and for whatever reason I am getting very inconsistent results. For the following code:
```javascript
function createNighmare (options) {
return Nightmare({
function loginToJiveweb (nightmare, {username, password}) {
return nightmare
nightmare:actions .wait() for form[id="jlf"] element +0ms
nightmare:actions .click() on form button#go-button +1s
nightmare:actions .wait() for #tos-accept-button element +2ms
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
.run(function (err, nightmare) {
I think the current branch still does. It just isn't documented. The top level callback is bubbled down as a callback to fs.writeFile.  I've seen several threads and issues about mimicking a user hitting the enter or delete keys, but can't find anything about arrow keys. I've already tried converting the keycode values to hex ie. `40`, which is the down arrow on a Mac, would be `\u0028` I suppose, but that is `(`. I tried every variation I could find, including a hex value I found in some Apple native API, can't find anything that works for arrow keys in Nightmare.js.
So, is this even possible?
wait is tiemout!!!
This is relevant since the electron 1.4.4 documentation describes the option of specifying a custom page size when generating PDF-files.  In certain cases in angular, if there is a select box with an event listener that has no options populated and an event if dispatched, it will trigger change detection within angular, which will throw errors and cause electron to crash/freeze. @reinpk What do you mean by test case? Like a unit-test? Or a codepen that shows the issue? @reinpk This issue might be difficult to reproduce in a unit-test since it's an interaction between angular2 and nightmare, afaik. I'll do my best to isolate the underlying cause over the next couple weeks.  duplicate of #923
var Nightmare = require('nightmare');
nightmare.downloadManager();
nightmare
Nightmare.action('clearCache',
Nightmare()
```javascript
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare
return nightmare
nightmare.end(function(){
It's weird and I have no idea what's the issue, can you help check on this issue? I was using the same user.
const pageInfo = await nightmare.goto('http://www.google.com');
And a lot of script never end.
nightmare report
@GautierT, did you ever figure this out?  I'm having the same problem.  One instance/process of node/NightmareJS runs great.  However, running more than one gives me plenty of issues.  Usually only one of the parallel executions will successfully run.  The others give me timeout errors.  I'm experiencing the same behavior when using `Xvfb` and `xvfb-run`. Adding a bit more info:
The random partition name didn't seem to help me either.
I don't seem to experience this problem when running my NightmareJS script on my local machine (OS X) natively.  (I just ran 6 parallel processes of the script via Terminal, and they worked as expected)
Nightmare.action('preloadCookies',
Nightmare().preloadCookies().goto(url);
Nightmare.action('preloadCookies',
Nightmare().preloadCookies(cookies, url).goto(url);
```ts
>   nightmare: '2.9.1',
`.goto(url, { 'mail': 'blabla@mail.com' })`
Nightmare.action('customHeaders',
What is different with how electron handles the session's custom request headers?
Fixes segmentio/nightmare#916
I would like to build a plug-in for web page automation. The result I need to deliver is when user type a keyword on the plug-in, there will be a window popping up and showing the process of manipulating an [e-commerce website](www.taobao.com).  The target user would be ordinary people who don't use terminal.  Is it possible to run nightmare.js not through node on terminal but through other system with GUI? I am a junior programmer. Hope someone can shed me some light. Thanks for your response. In the end, I used jQuery for the plug-in. It works quite well as well.   The goal of my sketch is to get product information from an e-commerce website. The code is very similar to the yahoon example code but the result is always null. I tried to put console.log to debug and realized the mistake might lay in the querySelector.
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
.goto('https://www.taobao.com')
var Nightmare=require('nightmare');
var nightmare=Nightmare({show:true,maxHeight:100000,maxWidth:10000});
nightmare
.goto('http://google.com/', [], Nightmare.CONTINUE_LOAD)
.goto('http://google.com/', [], Nightmare.CONTINUE_DOMREADY);
new Nightmare({
'load_policy': Nightmare.CONTINUE_DOMREADY
``` Without this, some sites don't load, such as http://eluniversal.com.mx/
nightmare
.goto(url)
for (var i = 0; i < PARALLEL; ++i) { dequeue(new Nightmare()) }
```javascript
.nightmare
nightmare
nightmare
nightmare
.type('.inputbox', 'chicago bulls')
return nightmare
```  Does nightmare can work on centos which has no desktop?
nightmare queuing process start +0ms
nightmare queueing action "wait" +2ms
nightmare running +1ms
nightmare electron child process exited with code null: undefined +19ms
nightmare electron child process not started yet, skipping kill. +1ms
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: false });
nightmare
nightmare queuing process start +0ms
nightmare queueing action "type" +2ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +1ms
nightmare queueing action "evaluate" +0ms
nightmare running +0ms
nightmare electron child process exited with code null: undefined +6m
nightmare running +4ms
nightmare queueing action "evaluate" +0ms
nightmare running +4ms
nightmare electron child process exited with code null: undefined +2s
nightmare electron child process not started yet, skipping kill. +2s
nightmare start:
libasound2 libxtst6 libxss1 libnss3 xvfb
ARG NPM_TOKEN
# Start Xvfb
__nightmare.webFrame.registerUrlSchemeAsBypassingCsp("http");
Not sure if what i am doing makes any sense, still pretty new to electron.
```javascript
```javascript
Nightmare.action('sendKeyDown',
keyCode: unicodeValue,
keyCode: unicodeValue,
nighmare
```javascript
Nightmare.action('sendKeyPress',
keyCode: unicodeValue,
keyCode: unicodeValue,
I'm wondering if it's possible to run it under 0.12 if you guys have some knowledge on a project that does that? I'm thinking that porting it with babel perhaps could work? Thank you for the response.
In this case it seems there is space for a `nightmare-babel` sort of package, but then it would be a different project. I might take some time off this December and be able to tackle it, but no guarantees atm.
nightmare.on("foo", function (a, b) {
Why this issue has been closed? What if I don't want to "ignore downloads"? is there a way to make it work with nightmare? E.g. I need to click on a link (which triggers a PDF download) and check the response HTTP code is 200.  In Selenium, we can do it by using window_handles and switch_to_window method.
Is there any way to do it with nightmare?  I can't provide the exact code to reproduce this but I wondered if someone might know why evaluate would return a boolean rather than the expected value (I am assuming this is on the `evaluate` sender and not the `then` receiver).
````javascript
return Nightmare.evaluator(function(text) {
nightmare.click(byText('Create Project'))
nightmare
> nightmare:actions .evaluate() fn on the page +24ms
I have tried with nightmare versions `2.8.1` and `2.7.0`.
Is it because it a Single Page Architecture (SPA)? I also had to use another `.click()` method to make a click (`nightmare-real-mouse`).
return nightmare
![nightmare](https://cloud.githubusercontent.com/assets/74385/19912725/9777cb92-a0d7-11e6-8644-1a7ca6987a33.gif)
Because the Nightmare instance is a thenable, the following will return a Promise that resolves to undefined:
async function createNightmare () {
return nightmare
Nightmare Version: 2.8.1
Mocha Version: 3.1.2
Nightmare()
Nightmare()
2. In @nguyenchr’s example above, the specific issue isn’t in the DOM node but in the jQuery metadata attached to it. Most specifically, it’s an AngularJS `$scope` object attached to the node, which is both very deep and highly recursive.
Not sure if there are also things worth doing in Nightmare ahead of Electron improving on their side:
- Special case DOM nodes and just send back some particular meaningful properties and NOT metadata attached to them? Or send back an error instead for DOM nodes? (This won’t fix the real issue of sending deep/recursive data structures, but would make it less likely to happen.)
I'm using Nightmare in a VirtualBox vm running Linux Mint as a guest. I have to disable hardware acceleration in Google Chrome so my VM doesn't lockup.
Today I have stumbled to create any custom action which does actions both on server and page context. I have spent the last three days trying every possible combination of Nightmare.action with evaluate and with evaluate_now, and .use(), with no success.
But even such a task is herculean when dealing with Nightmare.
nightmare
nightmare
new Nightmare()
.goto(site)
@rosshinkley You said that the first `.then()` returns a `Promise`. Can this promise be converted to `bluebird` Promise so to be able to use `.each()` and others from specified library, at a later point in Nightmare chain? Something like this:
var Promise = require('bluebird');
var nightmare = new Nightmare();
nightmare
.goto(site)
// log
doSomething(colElem);
Nightmare.action('assert', {
nightmare
I am running into an error, when including vanilla JS in nightmare.js. I want to make sure that every email in my array is inputted into the system.
var Nightmare = require('nightmare');
var siteName = "*********";
var password = "*********";
"email_username": "array1",
nightmare
nightmare queuing process start +0ms
nightmare queueing action "type" +2ms
nightmare queueing action "type" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +1ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +3ms
nightmare queueing action "type" +1ms
nightmare queueing action "type" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
var Nightmare = require('nightmare');
Nightmare()
var Nightmare = require('nightmare');
Nightmare()
1. Opens hacker news.
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
var keyword = "Foo";
// Click it somehow???
const nightmare = Nightmare({webPreferences: {partition: 'nopersist'}});
nightmare
.then(() => nightmare.end());
fmm... the problem was unexpectedly sophisticated and
and making `0` into the unexpected number.
I couldn`t find right way to escape these characters.
And note, I found this error makes users be able to inject **arbitrary code** into the nightmare environment.
const nightmare = Nightmare({webPreferences: {partition: 'nopersist'}});
nightmare
.then(() => nightmare.evaluate(() => document.title))
return nightmare.click(selector);
.then(() => nightmare.evaluate(() => document.title))
.then(() => nightmare.end());
nightmare-test.html:
"coffee-script": "^1.9.3",
"lodash": "^4.15.0",
"mandrill-api": "^1.0.45",
"orm": "^3.1.0",
It certainly doesn't seem possible since there's no way to get access to the result of evaluate function other than by calling 'end' followed by 'then'.
Tue, 18 Oct 2016 20:24:07 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Tue, 18 Oct 2016 20:24:08 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
nightmare
My code that is using Nightmare is a little convoluted, so let me know if it'd be useful, thanks!
>  You also may run into an issue with /dev/shm being too small, which manifests itself as Electron crashing after a few operations in Nightmare.
@jussch @rosshinkley I tried all sorts of acrobatics to make it work on heroku until I emailed their tech support and confirmed that dev/shm is fixed to 5mb on all dynos.
Well that is unfortunate. NightmareJS has been doing wonders for me, especially over PhantomJS.
Regardless, thanks for the help and for the info. I'll keep looking into it, but it doesn't appear to be a Nightmare issue, so I'll close this.
Nightmare({
Creating a nightmare window without calling end()
// We allow nightmare to wander in the global scope by defining it here,
var Nightmare = require('nightmare');
var nightmare;
// Here we start the Nightmare Instance
nightmare
nightmare
@entrptaher Wow, tnx a lot for trying to help mate, really appreciate!
@entrptaher how can I get in contact with you ?  My email is stefan@vanila.io, so you can reach me there or join our internal chat on https://chat.vanila.io
Thank you @entrptaher
I'm using nightmare to navigate between various pages and log page errors. Due to the asynchronous nature of `url().then()` I need a way to get the URL at the time of the page error. Would something like this be acceptable?
Actually I don't want to block per se. I'm happy for nightmare to continue its merry way, I'd just like to make sure I know where the error came from, even if electron has moved on to another page already.
puu.sh/rHtgK/89af757a71.png
nightmare
That result will undefined
@cagataycali, maybe thats not the problem you are trying to solve. If you are trying to use download manager, then probably you should try their example first.
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare
nightmare
var Nightmare = require('nightmare');
nightmare
nightmare
return nightmare
.then(() => nightmare.end());
nightmare
nightmare.end().then();
nightmare
nightmare
return nightmare
return nightmare
nightmare.end().then();
nightmare
return nightmare
.then(() => nightmare.end());
.then(() => nightmare.end())
return nightmare
nightmare
return nightmare
nightmare
return nightmare
@Mr0grog thanks for explaining
Would be curious how do modify that, tho. Hi There,
```ts
import Nightmare = require('nightmare');
.goto(url)
```ts
nightmare queuing process start +0ms
nightmare running +1ms
nightmare:actions .authentication() +427ms
did-start-loading: {}, undefined, undefined, undefined, undefined, undefined, undefined
nightmare:log did-fail-load +2ms [{},-323,"ERR_UNEXPECTED_PROXY_AUTH","https://www.google.ca/",true]
```ts
nightmare queuing process start +0ms
nightmare running +2ms
You'll notice from debugging output that authentication (or the 'loginListener' set in the nightmare.js runner) is executed after 'did-start-loading' whereas in the failed example the login listener is not called.
I really really hope that these features get implemented on Nightmare in the future! Looking forward to it!
``` javasctipt
var customCode = "";
// Create the nightmare options
let n = new Nightmare({
@IonicaBizau Thank you!
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
nightmare
nightmare.action('realClick',
Trying to leverage `nightmare` in order to be able to convert an svg to a png.
nightmare
.goto(url)
return nightmare
nightmare.end()
nightmare queuing process start +0ms
nightmare queueing action "useragent" +2ms
nightmare queueing action "wait" +1ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
nightmare:actions .evaluate() fn on the page +6ms
nightmare queueing action "viewport" +3ms
nightmare queueing action "screenshot" +0ms
nightmare running +0ms
nightmare:actions .viewport() +0ms
nightmare:actions .screenshot() +29ms
I am using nightmare.js (awesome work by the way) to detect variables attached to the window object by some script.
The way this page is used, with nightmare, is like so :
var n = Nightmare();
// this is where the wtf happens
foo = new SOMECLASS();
foo2 = new SOOOOMECLASS();
foo3 = new SOMECLASSYCLASS();
qux = new SOMEOTHERCLASS();
- nightmare injects the scripts
I need to access new window from nightmare and manipulate it as I do in main window. Is that even possible?
nightmare
Calling `nightmare.wait('#someID')` while executing in Strict Mode (ie `node --use_strict`) causes the following error:
at Object.waitelem (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/actions.js:384:29)
function waitelem (self, selector, done) {
Sam
var Nightmare = require('nightmare');
var nightmare = new Nightmare();
nightmare
Nightmare Version - 2.7.0
var Nightmare = require('nightmare');
var Nightmare = require('nightmare');
nightmare
else
else
>     return nightmare.end();
nightmare
.goto(URL)
Nightmare.action('getText', function (selector, done) {
Gustavo
Gustavo
So my question is: Can I use Nightmare, somehow, to post some data through the HTTP body?
The second option would be quicker as I would skip the first page. I wondered is such a thing is possible with Nightmare. Something like:
It seems like this is a core electron problem.
So running arbitrary js fun is the only way.
I'm trying to run nightmare example but no luck at all. This is what I have so far:
var Nightmare = require('nightmare');
var breadcrumb = nightmare
This is what the DEBUG flag is showing:
nightmare queuing process start +0ms
nightmare queueing action "viewport" +2ms
nightmare queueing action "wait" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "type" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
Gustavo
It seems that nightmare is not running unless I chain a `.then()` (or other promise 'handler') at the end of the promises chain. I can see the actions get queued, but not ran.
Is this expected behaviour?
this.nm = Nightmare();
This code doesn't run Nightmare, unless I change `runScript()` to `runScript().then(...)` (or put a `then()` after the last nightmare function in `doSomething()`.
var
yield nightmare
.goto(link)
yield nightmare.end();
Starting nightmare
nightmare queuing process start +0ms
nightmare queueing action "goto" for http://albertsons.com +4ms
nightmare running +1ms
nightmare:log did-get-response-details +0ms [{},false,"http://platform.twitter.com/widgets.js","http://platform.twitter.com/widgets.js",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=1800"],"content-encoding":["gzip"],"content-length":["32660"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"e8aa035a6c270053d1775e4d45a6eb60+gzip\""],"last-modified":["Fri, 26 Aug 2016 17:43:48 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4AA)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"script"]
nightmare:log did-get-response-details +0ms [{},false,"http://ad.doubleclick.net/activity;dc_pre=CN_629e66c4CFQIYgQod8D0PVQ;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833","http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833?",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
nightmare:log did-get-response-details +27ms [{},false,"http://ad.doubleclick.net/activity;dc_pre=CIz429e66c4CFUoHgQodvggJrQ;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469","http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469?",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
nightmare:log did-get-response-details +103ms [{},false,"http://bcp.crwdcntrl.net/5/c=3841/rand=615391281/pv=y/rt=ifr","http://bcp.crwdcntrl.net/5/c=3841/rand=615391281/pv=y/rt=ifr",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-length":["163"],"content-type":["text/html;charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=NOI DSP COR NID PSAa PSDa OUR UNI COM NAV"],"pragma":["no-cache"],"set-cookie":["_cc_aud=\"ABR4nC2We1CWVRCH3%2FMikDrcZcSUS4CgKDexyTEDLajBxhJQgcrAQbPRbMYpMrKkLJsSiwGjm1CIRngrJUQQLEjBksbyIy5FZCSGyXSBKMrsMvwe%2BeN72HN29z27Z8%2BeY1mWld5SedS69mdqLHtCoP71XyLExIOfhPmfC0k3CBlXZPPAj5JGDgsFDWO%2FdsT7zH2vwapPhP50IeVJoXep8PMuobgBL7uFkwfBAbBfzqYWCV%2BNF3wXCIvWCyueEpZECSsPo2mEDWEYxIE58tlORCPVQtAZzZX1sOpm4XZ%2FNC9KqjJIRNTex6pLkc7jOhjpG6Xg%2BrvJxGVhsbdUuvulUoHBigykHvC1BqfvkbRwWHalHWimoNIB2jVYp4js7peEzf%2BguRi7MuHPxjE4uXgKk%2Beh%2Bbu89L%2BG9JukD3xx%2FTFQCuwTsUgf8T1Ko6IRaRrLvVWavW0M%2BuHzAppHUWGr6iYhzdfcolXYketxL2tw1IkMvqFB52UsQnZWjHbaCvpUoQQMofkiyaLcxj0myfNNSUl1klLasbPxksrXHxZig%2FSFQ4l4eRufjwrF0fIyidPRjkEQlezxFs4StBb3zdI8xubELAA3C16umGcyqPq0AtnwQDb8EsV%2BoUTSWmKIbQbaDtN9p9a5Xim3NrLFU55lLdl8IUKDpc6Sdt6Ez8eFIlWr3VghqSIGRONzAhjP4CwS6Yk0A4TjbJ3mQvcRdKgkZ0KpWSmkFjHHOhfOBlqZFd1FlpRI40sRLd%2Bmr0cMIm0V1nzB4C%2BYT5HPgFTM7xWSQpjzIiE6m%2FZDBwkznbSSAg8C8yAvCaNIFIMHZ9r9P0JZLslxmsEr4C%2FsBpEwd2hX7HXKhJX9gsxzB1D5lWgLwQ7mzuOFZFVr1Sa9gYhoMwmqHtvvX7z0MkjDdadQTq%2BWVHSfJB%2BdMfOqdsXa%2BwyaMjBddMyuKgzS5LqA45tNBnN1OkyY4rOTsavcK9TXEKYKzMltuwZDyaCDg%2BCg7w60IT1ItNS8g3U6suX6ulW4VimaEDZ1mLujay2DbP%2BaSOw4og7uh6KJ8vLE81JJVJhm2VnBaS5QH7QCToGTqNDIAriPtp9AMwRwgQUrMPsqe7t7Lolki49wuI5sBWQ3IRkpH2zBtZJsSgZYoBq1PaMen0EazKXvdqrhmlZaZW0e5iXgFQ3uu4hUDIpAIeukJUTR%2FBPnAA7s6DvC6jNkl%2BIbpqmWj5KQjcTgJpz7ToO2g%2BUSbQLtt%2FySBn03SGrewme5ls59prn9f8i8sxtwtG1Kyj4GagVvCjpKSzJxZaAU7AL06zh1feu5L4WsTYB2mJXLh44LAzwBBlwAhRmXAyi%2B%2BFPk%2Bh7SQ8ec%2FSFzWqDdcwjorFh9XcwdYJBW2adjYWfqbrRdlQkz%2BC5zuojsPAzy8OK2h9iz8MLt1DxZ0nEeEp1ERCbsiVOFeRmofAt60eSo1boTih%2BSN%2BC63hZNdmeyCLrpVY5M3tOAai3Xc8QEdwrebHj8tWSpe5s0Dkka92Y5t3Z9NaEkgzs0eJmW3rpTUqaya3Jola2vI1F1ORSK7YE0IpWmVmGojrQS2JDqxUrk%2Buzk%2BRNOEbnSOONvRPM9DRo6tH%2BBpBY2vIULs6VJc3c9Ii8udJvbuI8iqeT7eZx0MJfDE8dQyW2cacP2h5NIFxYRyaP0lr%2BRaLH%2B9Cx%2FelZkOeCV4FOJMx7IhZuQVHzmB2IPxs5HXcMsLeMLZ%2FE5C8wEXMlNvAf9w8D0sV%2Bnadxq%2BS6AY5E%2FDnC086VivMYulP8BTZWnMw%3D%3D\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT;Max-Age=23328000","_cc_cc=\"ACZ4nJXU204TQRjA8S4RCaWhb2BIvDMhCkUJD%2BAzeF1QnkMQOTUqoMGAEgIIxigXaowCPdDDVo4FgW4pZYEiFDmUk1QQgRVJ2%2Bz879yLzfz2m5md75vdMeRZrMXWwoLi8nJrUYHlRon1XvHNotK7ltKyQmvZraLyEsP5dUfu%2BeTx%2BDWzIXV96XfnZ45LjqeaZtYk6cnt05Ozi5b9WqpVccVwft%2FNSPUx9P3%2FkMkaT1byqSGmTJulkTz1KBmLw7ZowCi5MzpSfj0yLngltmuSPl5%2Fc5j0dzjSv5Grd7Oj3ah3VWuN0D%2BK8dvBnWzpQ%2F77X0lvKaIV2AfLsAvuhjvgNrgZtsF1cBV8hHwScByOwavwMrwEL8AqHIYVOAhPwQF4FB6Gh%2BCvsAz7YA%2Fshl3wfuOMUe81eBVehqPwIjwHz8IKHISn4DHYBztf2M1CPWEv7IHd8CDsgh1w9K0srGcJXoQXYBWehyPwHByG3Q1KzvlZlkgkPdP22KR3sOHirEu7Gd7q8gpusYnxxF5rtt6z8Xph%2Ft521SStXe1L2QY%2Fgr2donvUpkwpkuWIJ31g7zNJB9lp78N78A68DcfhLXgTXodX4RW4e7P6Xz3SjiF%2BGGoU8nMiX7n2%2BLK%2B%2F27lgDDfBubzB%2Bpy9R6GR%2BGfGD%2BJ%2BDRsX2kQ3j9QLa6v1xXK0bsGrnfUZenzewhXwPdhzS76DD6B%2F8C%2F4a7%2BFqP08lLaa%2FNi%2FU9hDV5CfRZgFZ6HI%2FAcHIZn4RAchGfgb%2FAEHIDH4TF4CJZhH%2ByFPbAbHoSd8AA8%2Beq5Ub8%2FE3D4s7jfITgIj8DDsB92wu%2FgTvzfbXAL%2FAxugmvhB3AlfIbv9wQ%2BhtfhH3AMVuEQ%2FBfikeCP\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT;Max-Age=23328000","_cc_id=3a7a217ffa41309ae754bd3bc2ac64f9;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT"],"x-server":["172.20.10.119"]},"subFrame"]
Closing nightmare
nightmare running +17ms
undefined
Starting nightmare
nightmare queuing process start +0ms
nightmare queueing action "goto" for http://albertsons.com +5ms
nightmare running +2ms
Has error
code: -7,
`nightmare 2.6.1`
nightmare
Is this a problem in Nightmare or Electron? Is there anything I can do to work around it?
I did go back through the electron-prebuilt tags and it looks like this problem is Electron-specific and was introduced in v1.2.6 and remains a problem at the current version (v1.3.4). Should I report this over on their repo? If so, do you think the snippet above would be sufficient as a recreation?
Someone from the Electron team has pointed out that the problem seems to be caused by a redefinition of String.prototype.startsWith() done by this specific site. So, bad on them, and I'm closing both issues. Thanks for your time on this.
Bellow is simple example that I am trying to make work, but no success. It don't have much sense and purpose. I am just trying to figure out how to make script go to some another page and then execute some function inside `.evaluate()` if possible. Or if can't be done inside `.evaluate()` , what is the way and best practice?
var Nightmare = require('nightmare');
nightmare
Here's the code
var nightmare = Nightmare({show: false, gotoTimeout: 400000});
console.log(endpointPsicos + i);
nightmare
.goto(endpointPsicos + i)
//Pega o id ou espera 200 seg
.wait('#tblMedicos', 200000)
if ($('#tblMedicos')) {
$('#tblMedicos').find(("[data-medico-id][data-nome-medico]")).each(function () {
I don't know I'm only guessing. I'll continue to investigate, the API in this thing seems really cool, and Electron should be fine for my tests.
@shanewignall Well, my use case was way simpler I'm afraid :sweat_smile: but then again I believe it seems to be similar in nature. In my case I was only filling a form and clicking submit. Yet, my field selectors where actually incorrect. So, my selectors were not returning any elements so when nightmare tried to move from field one, to let's say field two (calling blur() on field one) the result is this error.
.goto(urlBase + 'frmLogin.aspx')
.type('#txtPassword', password)
doTheThingWhichSometimesDoesntWorkButCasuesAPageNagivationWhenItWorks()
yield nightmare
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
var nightmare = Nightmare();
yield nightmare
What's the status here?
if (process.platform !== 'darwin') {
and in the nightmare.js replace line 211 with this
Use https://github.com/rrva/nightmare-752-repro to reproduce
~/Devel/Temp
Cloning into 'nightmare-752-repro'...
~/Devel/Temp
❯ cd nightmare-752-repro/
app@1.0.0 /Users/albinekb/Devel/Temp/nightmare-752-repro
@albinekb: To reproduce, you have to use the instructions in the README, i.e. run it in the environment provided in the Dockerfile. For example, this uses node v5.12.0 if this matters.
When looking at the require error in electron-userland/electron-prebuilt#178 and here, it seems like it's not a problem with nightmare, maybe it's a problem with the prebuilt electron/electron itself.
Great that you got it working @rrva 😊
I'm curious how to capture this, so I can kill the main process? The supervisor, a process control system will restart  it for me. Thanks in advanced！
@Snake4life ,  you may give this code a try -
nm.goto("...")
Possibly noob question (sorry)... but I just can't explain this behavior:
Any clues what's going on?
Nighmare: 2.6.0
nightmare
Sometimes it even was one character in one field and two subsequent in another field!
var Nightmare = require('nightmare');
nightmare
return nightmare
return nightmare.screenshot('test.png', dimensions);
nightmare.end(function() {
With the events? TBH, I don’t really want to do the dig-through-the-event-and-find-all-the-problems-and-patch-them-then-lobby-electron-for-a-fix-then-see-this-break-later dance again. It seems prone to having serialization issues, and I don’t think that should be a problem Electron cares about—there’s great utility in having some oddball structures and/or exotic objects in the event, just not for Nightmare. Better to leave it alone and only surface the bits that are meaningfully additive here.
@RichardJECooke perhaps this docker image https://hub.docker.com/r/smtx/nightmarejs-webservice/ helps you build your nightmare app inside a docker container.
var nightmare = Nightmare({show: true});
nightmare
nightmare.end();
nightmare queuing process start +24s
nightmare queueing action "useragent" +0ms
nightmare running +1ms
nightmare
.goto(url)
return nightmare
.then(_ => nightmare.end());
@rosshinkley Using Nightmare 2.5.3 (latest on npm I suppose).
var nightmare = Nightmare();
nightmare
.goto(url)
return nightmare
.then(_ => nightmare.end());
nightmare.proc.disconnect();
@Mr0grog That's strange. It just hangs for me on HTTP 304 until timeout. I'm using:
Nightmare v2.5.3
nightmare electron child process not started yet, skipping kill. +1ms
@Mr0grog Ah ok. So it this a bug in Electron or Nightmare? Any workaround to it?
@voidmonk It’s more a bug in Nightmare than anything else, but only caused because Electron changed its behavior ¯\_(ツ)_/¯
Updated to Nightmare v2.6.0 (Electron 1.3.2) which seems to include the fix. Now the test code ([same as above](#issuecomment-236326180)) logs:
Thanks to segmentio and all Nightmare contributors!
nightmare
return nightmare.evaluate(function() {
return nightmare.viewport(data.width, data.height);
return nightmare.inject('js', './localScript.js');
return nightmare.evaluate(getScrollPositionFromPage);
return nightmare.scrollTo(scrollPosition.top, scrollPosition.left);
return nightmare.evaluate(fillInputsOnPageWithValues);
return nightmare.screenShot(imageLoc);
return nightmare.end();
This is a _censored_ gist
I am currently attempting to take a screenshot using **Nightmare JS** where it also includes the dropdown (`<option>`) of a `<select>`.
👍  Ah, so this is why everything is blowing up! `nightmare` doesn't support concurrency. 👎
- Nightmare.version: 2.5.3
var Nightmare = require('nightmare');
nightmare
> Nightmare({
> nightmare
let win = Nightmare({
.type('input[name="st_username"]', "alextuteur44@gmail.com")
.type('input[name="st_passwd"]', "leboncoin123")
.insert("#body", "ad text just for exmaple")
.click("#newadSubmit")
.wait(".confirm a:not(:first-child)")
.click(".confirm a:not(:first-child)")
Nightmare.action('something', function (done) {
But I only triggered nightmare successfully in first time with my api,
when I call again my api I can't trigger nightmare any more :(
another question, in below case, I need to instantiate new Nightmare object individually , so that I can scrap three different site, have any smarter way to achieve that?
import Nightmare from 'nightmare';
let nightmare = Nightmare({show: false});
let nightmare2 = Nightmare({show: false});
let nightmare3 = Nightmare({show: false});
nightmare
return document.querySelector('.ninenine').innerHTML;
nightmare2
return document.querySelector('.ninenine').innerHTML;
nightmare3
@inakianduaga : how to run electron with verbose flag ? @rosshinkley recent versions seem fine & thanks for the tips  Is it possible to re-inject (manually or otherwise) previously injected files when the electron app refreshes due to file change (via watcher). The goal being to inject test files every time I update them (without having to restart nightmare).
nightmare
return Nightmare(nightmareOpts)
'Authorization': 'Bearer ' + superSecretToken
Here is my code:
var Nightmare = require('nightmare');
yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');
var currentHeight = yield nightmare.evaluate(function () {
yield nightmare
yield nightmare.screenshot('screenAfter.png');
yield nightmare.end();
partial code:
nightmare.goto('https://www.homesavings.com')
return acc.then(function(results) {
return nightmare
nightmare:actions .evaluate() fn on the page +3ms
nightmare:actions .select() select[name="acctRef"] +4ms
nightmare:actions .click() on input[type="submit"] +2ms
nightmare:actions .click() on td a +7s
nightmare:actions .wait() for select[name="acctRef"] element +2s
nightmare:actions .select() select[name="acctRef"] +1ms
nightmare:actions .click() on input[type="submit"] +1ms
nightmare:actions .wait() for td a img element +7s
nightmare:actions .click() on td a +2ms
nightmare:actions .wait() for select[name="acctRef"] element +1s
nightmare:actions .select() select[name="acctRef"] +1ms
nightmare:actions .click() on input[type="submit"] +1ms
nightmare:actions .click() on td a +2ms
Can I change the screen resolution in nightmarejs?
For example, how it works in Casperjs:
I'm using nightmare to build scrapers,
LGTM
LGTM
var dimensions = yield nightmare.goto('http://bbc.com')
.join(__dirname, 'bbc.png'));
yield nightmare.end();
Nightmare.action('dimensions', function (done) {
Try this code,
var nightmare = new Nightmare({ minHeight:7119, minWidth:1000 });
I should add, the output of `console.dir(dimensions);` is `{ height: 7144, width: 993 }`, so there is also a discrepancy between how big Nightmare measures the target to be, and what the output is, at least with the setup from the initial post updated with the above. Yeah I ended up changing maxHeight to 16384, anything higher will cause #906  I use `xvfb-maybe` to run electron in Docker but since 2.5.1, it seems to crash with no further indication.
`nightmare@2.5.1`:
nightmare queueing action "wait" +1ms
nightmare queueing action "viewport" +0ms
nightmare queueing action "screenshot" +0ms
nightmare queueing action "viewport" +1ms
nightmare queueing action "screenshot" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
nightmare electron child process exited with code null: undefined +21ms
`nightmare@2.5.2`:
nightmare queueing action "wait" +1ms
nightmare queueing action "viewport" +0ms
nightmare queueing action "screenshot" +0ms
nightmare queueing action "viewport" +1ms
nightmare queueing action "screenshot" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
nightmare electron child process exited with code null: undefined +22ms
nightmare electron child process not started yet, skipping kill. +1ms
close? @oncletom
Please bump the dependency in Nightmare before closing
Nightmare: 2.5.3
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
linusu:test Queueing read of state +24ms
nightmare:actions .evaluate() fn on the page +5ms
linusu:test Got state "null" +2ms
nightmare:log page-favicon-updated +0ms ...
linusu:test Queueing read of state +90ms
nightmare:actions .evaluate() fn on the page +1ms
nightmare:log page-favicon-updated +1ms ...
It's a bit spammy, sorry about that, but as you can see it prints my first debug statement (`linusu:test Queueing read of login status +90ms`) and then nightmare runs the action (`nightmare:actions .evaluate() fn on the page +1ms`), but then it never returns to me so that my second debug statement can run.
``` diff
Basically, what I did make a lot of instances of nightmare until the nightmare stuck up when I stopped the process the electron still running in background even though I already stopped the process.
It's orphaned Renderer/Helper processes, not Main.
As I said I don't think it is a Nightmare issue, and at this stage think it may have only been happening on Windows.
nightmare.end();
nightmare.proc.disconnect();
```javascript
new Nightmare({
gotoTimeout: 10000
.goto(url)
```javascript
gotoTimeout: 10000
return nightmare
.goto(url)
@itomas i'm unable to reproduce the issue
```javascript
var Nightmare = require('nightmare');
gotoTimeout: 10000
return nightmare
.goto(url)
`os` Microsoft Windows [Version 6.3.9600] - Windows 8.1
`nightmare`  2.9.0
is there any idea regarding that issue.
(e.g load spotify with nightmare)
/Users/justaman/projects/ifetch/node_modules/nightmare/lib/nightmare.js:178
at endInstance (/Users/justaman/projects/ifetch/node_modules/nightmare/lib/nightmare.js:178:20)
@gjmveloso, please, see my answer in related bug #680
I've started playing around with Nightmare on **Windows** and I'm receiving the _TypeError: Cannot read property 'connected' of undefined_ error every time I try to run my basic code:
var browser = Nightmare({
_Nightmare Version:_ 2.5.1
var browser = Nightmare({
But I think I'm still doing something wrong :cry:
var browser = Nightmare({
nightmare
Imo, there should be one of the following:
nightmare
.goto(page)
nightmare
return nightmare.refresh().then();
return nightmare.goto(page).then();
return nightmare.goto(page).then();
return nightmare.doStuff();
And objectively speaking, I don't see why the current behavior is like it is. I used `zombiejs` before which admittedly is not a reference, but looking at phantomjs' `.open()` they too seem to load the page anyway. Without the programmer asking _not to reload if url is same_, it seems strange to me.
const url = 'https://www.whatismybrowser.com/detect/what-http-headers-is-my-browser-sending';
var nightmare = new Nightmare();
yield nightmare
var Nightmare = require('nightmare');
new Nightmare({show : true})
.run(function (err, nightmare) {
> In versions prior to 2.5.0, this (cryptic) error generally meant that one
> https://github.com/notifications/unsubscribe/ALcELemYikc_Fm8QHeQ59rEbk5JpUK0qks5qJgEjgaJpZM4IqMpX
return el.innerHTML
console.log('run here', nightmare)
nightmare is awesome ^^. But need more documents.
var Nightmare = require('nightmare');
var testbot = new Nightmare({
testbot
var Nightmare = require('nightmare');
var testbot = new Nightmare({
Nightmare({
I had tried that as well. I tried again and neither of the examples you change anything i.e. I could change the switch (proxy-server) to lkjlkj-weioruweoriu and the code still runs the rest of the program. It seems to me that for some reason the switches part is totally ignored at the moment, because it can be changed to anything without any effect on the rest of code. Thank you for the plugin tip, though it would be great if this could work as in the examples you had provided given how amazing Nightmare otherwise is!
I got the proxy authentication to work on Electron, but would prefer to use Nightmare if possible. At the moment, given that there are no specific detailed answers to this issue, unless someone provides a working code example, my suggestion is to assume that proxy authentication does not work.
Nightmare({
.goto('http://whatismyip.com')
@mikkokotila:
nightmare
//since Nightmare has an internal `.then()`, return the instance returned by the final call in the chain
return nightmare
nightmare.use(NightmareSelect)
await nightmare.goto('http://...')
if (await nightmare.selectHasOption('select.color', 'blue')) {
if (await nightmare.selectHasOptionWithText(select.color, 'Blue color')) {
I don't like the idea of encouraging my users to patch the _global_ `Nightmare` object, as that is considered a bad practice and could potentially have side effects on other libraries.
nightmare.use(NightmareSelect)
await nightmare.goto('http://...')
if (await nightmare.selectHasOption('select.color', 'blue')) {
if (await nightmare.selectHasOptionWithText(select.color, 'Blue color')) {
Yes, but the problem with that I don't see a way of using that without going down a path of anti-patterns. The use case here is that I want to distribute a third party "plugin" to nightmare.
NightmareSelect.patch(Nightmare)
also, Nightmare is really awesome and it beats all the other similar tools I've used, keep up the good work!
var Nightmare = require('nightmare');
nightmare = Nightmare();
nightmare.goto('http://cnn.com')
nightmare = Nightmare();
nightmare.goto('http://cnn.com')
I use Nightmarejs for a long time, but was unaware of such small modules.
^ Log ^
my code:
2 changes:
@Mr0grog @rosshinkley,
Hey @rosshinkley and @Mr0grog,
horseman
.open('http://en.wikipedia.org/wiki/Headless_Horseman')
I'm thinking in implementing it myself to nightmare, but want to be sure this doesn't exist already?
VIOLENT AGREEMENT! Anyway, back to the main topic here: figuring out the current state of affairs:
**goto**
- Return: string
- Return: string
**inject**
@oliviervaillancourt Right, your issues are with:
Thanks for taking the time to help me understand.  I'll continue to play around with nightmare
Ping @Mr0grog 😃
@Mr0grog Thanks for the comments!
const browser = new Nightmare()
object
string
import Nightmare from 'nightmare';
const browser = new Nightmare({
``` Bash
Also, what versions of Node, Nightmare, and Electron are you using?
Nightmare runner error:
Nightmare.action('test', electronAction, nightmareAction)
const browser = new Nightmare()
I'm affected by electron/electron#5444 so it would be really nice to be able to upgrade to version 1.0.2...
npm ERR!
I’m imagining you might have had code like…
var image yield nightmare.screenshot();
return nightmare
var image yield nightmare.screenshot();
Oh no, I think you might have some crossed wires here about how promises and generators work, probably caused by a **horrible** copy/paste error in my initial reply. So sorry about that :(
var image yield nightmare.screenshot();
return nightmare.screenshot().then(function(imageBuffer) {
return nightmare
return nightmare.screenshot().then(function(imageBuffer) {
return nightmare
// make sure to end nightmare in case something went wrong along the way
return nightmare.end();
return nightmare.screenshot().end().then(function(imageBuffer) {
nightmare
There are _a lot_ of ways to formulate this. What works best will depend on exactly what it is you want to do.
@Mr0grog Thanks.
I agree with @Mr0grog, and I think that it would be weird API-wise if `wait` returned a `Promise<bool>`.
Nightmare({waitTimeout: 5000})
@Mr0grog even better - thanks!
Is not more easy use `JSDOM` instead `Nightmare` for your test?
But if you really want use `AVA` + `Nightmare` you can use `test.cb`
test.cb('apenas um show', t => {
Nightmare()
touches: [
new Touch({
nightmare
wrapfn(fn, select)(ctx, nightmare)
nightmare
ctx:
at test/phantom.js:26:23
Nightmare.action('scrollPage', function (done) {
SyntaxError: Unexpected token =>
SyntaxError: Unexpected token >
I would like to know if it is possible to simulate a mouse click in a position x,y with nightmare.
@maiopirata your code above seems perfectly correct. What are you expecting to have happen? Do you have a `click` event listener on the `div` or on an element that contains it? When you dispatch a simulated event this way, an element _inside_ the div at the given position _will not receive the event._ This will also not automatically trigger the relevant `mousedown` and `mouseup` events, so if you are actually listening for those, your listeners will not be triggered.
For this specific use case, I was able to get sendEvent working with PhantomJS events, but would prefer Nightmare because it's just a lot nicer/cleaner overall. Initially I just assumed it was an Electron bug/ swallowed event, but figured I'd ask first if it was working as intended.
@rosshinkley do you have any idea why the `click()` (and `mouseover/mousedown`) action doesn’t use `sendInputEvent`? Assuming no, since according to git, they pretty much appeared out of whole cloth, but asking just in case.
var Nightmare = require('nightmare');
var nightmare = Nightmare({show:true});
nightmare
.goto(startingLink)
ming_o01 (master) nightmare1 $ DEBUG=nightmare node stackoverflow.js
ming_o01 (master) nightmare1 $ ^C
@rosshinkley @mingsterism
var Nightmare = require('nightmare');
nightmare
.goto(startingLink)
oNightmare
.goto('http://www.taoism.net/ttc/complete.htm')
var Nightmare = require('nightmare');
'http://tiendas.mediamarkt.es/',
'https://www.kairos.com/',
nightmare.goto(website.url)
``` cli
nightmare:actions .viewport() +14ms
nightmare:actions .viewport() +31ms
nightmare:actions .viewport() +11ms
nightmare:actions .viewport() +51ms
nightmare:actions .viewport() +56ms
nightmare:actions .viewport() +29ms
nightmare:actions .viewport() +162ms
nightmare:actions .viewport() +108ms
nightmare:actions .viewport() +114ms
nightmare:actions .evaluate() fn on the page +1s
nightmare:actions .evaluate() fn on the page +1s
nightmare:actions .evaluate() fn on the page +1s
nightmare:actions .evaluate() fn on the page +1s
nightmare:actions .evaluate() fn on the page +24ms
nightmare:actions .evaluate() fn on the page +1s
nightmare:actions .evaluate() fn on the page +372ms
nightmare:actions .evaluate() fn on the page +695ms
nightmare:actions .evaluate() fn on the page +2s
@JWMarchant it might be helpful to see the logs with `nightmare:*` instead of just `nightmare:actions` — anything happening in the electron process goes under `nightmare:log`, so there might be some good details missing in your debug output above.
``` cli
nightmare:log navigated to: http://imgur.com/ +0ms
nightmare:log did-get-response-details +20ms [{},false,"https://pixel-geo.prfct.co/tagjs?a_id=57309&source=js_tag","https://pixel-geo.prfct.co/tagjs?a_id=57309&source=js_tag",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["17"],"content-type":["text/javascript"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 09:40:05 GMT"]},"script"]
nightmare:log did-get-response-details +9ms [{},false,"http://now.eloqua.com/visitor/v200/svrGP.aspx?pps=70&siteid=937&ref=http://www.adp.com/&ms=778","http://now.eloqua.com/visitor/v200/svrGP.aspx?pps=70&siteid=937&ref=http://www.adp.com/&ms=778",200,"GET","http://www.adp.com/",{"cache-control":["private"],"content-encoding":["gzip"],"content-length":["106"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:39:42 GMT"],"p3p":["CP=\"IDC DSP COR DEVa TAIa OUR BUS PHY ONL UNI COM NAV CNT STA\""],"vary":["Accept-Encoding"]},"script"]
nightmare:log did-get-response-details +2ms [{},false,"https://s.yimg.com/wi/ytc.js","https://s.yimg.com/wi/ytc.js",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"age":["6013"],"cache-control":["max-age=7200"],"content-encoding":["gzip"],"content-length":["3553"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 07:59:53 GMT"],"expires":["Tue, 03 May 2016 09:59:53 GMT"],"last-modified":["Fri, 18 Dec 2015 17:04:06 GMT"],"server":["ATS"],"status":["200"],"vary":["Accept-Encoding"],"via":["http/1.1 spdc0005.pbp.ir2.yahoo.com (ApacheTrafficServer), https/1.1 l6.ycs.loa.yahoo.com (ApacheTrafficServer [cRs f ])"],"y-trace":["BAEAQAAAAAA_KEHMzv2q0gAAAAAAAAAAuBdjTtNEHAkAAAAAAAAAAAAFMezk6dcYAAUx7OTp2D32vfT0AAAAAA--"]},"script"]
nightmare:actions .evaluate() fn on the page +1ms
nightmare:log did-get-response-details +2ms [{},false,"https://px.steelhousemedia.com/st?fdx=1&dxver=4.0.0&shaid=12271&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750&shpn=treehouse&shpi=http%3A%2F%2Fblog.teamtreehouse.com%2Fwp-content%2Fuploads%2F2016%2F04%2FGitHub-Basics.png&shps=treehouse","https://px.steelhousemedia.com/st?fdx=1&dxver=4.0.0&shaid=12271&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750&shpn=treehouse&shpi=http%3A%2F%2Fblog.teamtreehouse.com%2Fwp-content%2Fuploads%2F2016%2F04%2FGitHub-Basics.png&shps=treehouse",200,"GET","https://teamtreehouse.com/",{"access-control-allow-origin":["*"],"connection":["close"],"content-encoding":["gzip"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NON DSP COR NID CURa ADMa DEVa PSAa PSDa OUR STP UNI COM NAV INT STA PRE\""],"set-cookie":["guid=b1965d13-9e87-426b-bca9-509290aec6cb;Path=/;Domain=.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT","rt=\"MTIwNzY6MTQ2MTg1OTU2OCwxMTg5OToxNDYxNzUyNDk5LDExNTc2OjE0NjE3NjY4MzgsMTIzMDg6MTQ2MTc2MDk2NywxMDU3OToxNDYxNzY3NTUwLDEyMjcxOjE0NjAxMzAwMjgsMTE3MjM6MTQ2MTc1OTk4Mw==\";Path=/;Domain=.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT","tt=\"H4sIAAAAAAAAAG1USZIkMQj7S537gDGL3Y+Yw3ygftGXjvn7eMGZoqpOGUHKIITg9/Hn77OQNX8yKz++y9eKlO785FbbiXTxAfFeXwNyvSH1/pT++GYE6A0orffIITvClVpE/OuRqooVt6JiVnqAidvKf9I513hcDwPKJK+I5M7es0yaFXtH4kFzRjzlrfpSCRQ7eTKbUat5uTHqFhGGLq/qhch6ksRrlzolCVbXr87qzCwl5UnV/aSKWmvuocUhd1VSUWnKOiuVxfL8akZt5J+Vxif/GtSaMBsU+NQwkmjUk9zLODChALzrCFoHjVvH7T6E7PaXFTg9Qi6BqSsSGmLf7uKlxXP2cniRTQUX0RuupZKRpM5PblAH27hHGkbjYuUFsyOg6bIejNGTYawRU5e5Xsvq9y/xPoTUOn9pGuN4NUzmQuilQyJxCjCNwadxJeXHabkjOJmt0rASFUsqKUxpybzxZKDT7NixwrU0+9CAlVm6mk4NMJvYMKqa+ZgS5EHr7bxhPdygWEYdiUnhkszHFYS4xgKz3stqY1t7Pid4cpbGp/LPi2cSkj77ChcGBJGMgcM4lb/PN7plOgSHuHqfN6DqtThUP12bD4Ncxk2D3DFPXluof/8Bdr88B58GAAA=\";Path=/;Domain=.px.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT"]},"script"]
nightmare:log did-get-response-details +20ms [{},false,"https://m.addthis.com/live/red_lojson/300lo.json?si=572871f50a2f09e9&bl=1&pdt=2528&sid=572871f50a2f09e9&pub=ra-54e5170351df8b3a&rev=v5.12.0-wp&ln=en&pc=men&cb=0&adu6=0&ab=-&dp=www.kairos.com&fp=&fr=&of=0&pd=0&irt=1&vcl=2&md=0&ct=1&tct=0&abt=0&cdn=0&lnlc=gb&pi=1&rb=0&gen=100&chr=UTF-8&mk=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&colc=1462268406335&jsl=8193&uvs=572870bf6d54f42c008&skipb=1&callback=addthis.cbs.oln9_32281651723402070","https://m.addthis.com/live/red_lojson/300lo.json?si=572871f50a2f09e9&bl=1&pdt=2528&sid=572871f50a2f09e9&pub=ra-54e5170351df8b3a&rev=v5.12.0-wp&ln=en&pc=men&cb=0&adu6=0&ab=-&dp=www.kairos.com&fp=&fr=&of=0&pd=0&irt=1&vcl=2&md=0&ct=1&tct=0&abt=0&cdn=0&lnlc=gb&pi=1&rb=0&gen=100&chr=UTF-8&mk=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&colc=1462268406335&jsl=8193&uvs=572870bf6d54f42c008&skipb=1&callback=addthis.cbs.oln9_32281651723402070",200,"GET","https://www.kairos.com/",{"cache-control":["max-age=0, no-cache, no-store, no-transform"],"cf-ray":["29d2bfe3a76934dc-LHR"],"content-encoding":["gzip"],"content-length":["110"],"content-type":["application/javascript;charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"NON ADM OUR DEV IND COM STA\""],"pragma":["no-cache"],"server":["cloudflare-nginx"],"set-cookie":["bt2=572871f60023s00060027s0004002cs0001001qs0003001rs0007001ss0003001ts0002008ts0002001us0003001vs0002001ws0002001xs0003001ys0006001zs0005001Cs000O001Ds0002001Fs0005001Gs000Q001Is0002004Js0006001Js0002001Ks0006001Ls0002002Ls0002002Ns0002001Ns0007001Ps0006007Rs0004002Rs0004001Ss0002007Ss0002003Ts000200aTs000101wVs0002002Ws0001003_s0002;Path=/;Domain=.addthis.com;Expires=Sat, 14-Jan-2017 09:40:06 GMT","uid=5720d7483fba8713;Path=/;Domain=.addthis.com;Expires=Thu, 03-May-2018 09:40:06 GMT","vc=92;Path=/;Domain=.addthis.com;Expires=Thu, 03-May-2018 09:40:06 GMT"],"status":["200"]},"script"]
nightmare:actions .evaluate() fn on the page +0ms
nightmare:actions .evaluate() fn on the page +0ms
nightmare:log page-favicon-updated +2ms [{},["http://d243u7pon29hni.cloudfront.net/images/favicon.ico"]]
nightmare:actions .evaluate() fn on the page +0ms
nightmare:log did-get-response-details +35ms [{},false,"https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=9C3FE81A557C64BA279FC45FEBF2A634A453C1F9.4C9ED20D5E30EDA1EA9D4A1ABB6958AD258D7611&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.921&sver=3&source=youtube&mime=audio%2Fwebm&pl=18&initcwndbps=4077500&itag=250&lmt=1461579958404327&clen=3436&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-3435&rn=0&rbuf=0","https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=9C3FE81A557C64BA279FC45FEBF2A634A453C1F9.4C9ED20D5E30EDA1EA9D4A1ABB6958AD258D7611&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.921&sver=3&source=youtube&mime=audio%2Fwebm&pl=18&initcwndbps=4077500&itag=250&lmt=1461579958404327&clen=3436&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-3435&rn=0&rbuf=0",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-origin":["https://www.youtube.com"],"access-control-expose-headers":["Client-Protocol, Content-Length, Content-Type, X-Bandwidth-Est, X-Bandwidth-Avg, X-Walltime-Ms"],"alt-svc":["quic=\":443\"; ma=2592000"],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=21300"],"connection":["keep-alive"],"content-length":["3436"],"content-type":["audio/webm"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Tue, 03 May 2016 09:40:10 GMT"],"last-modified":["Mon, 25 Apr 2016 10:25:58 GMT"],"server":["gvs 1.0"],"timing-allow-origin":["https://www.youtube.com"],"x-content-type-options":["nosniff"]},"xhr"]
nightmare:log did-get-response-details +4ms [{},false,"https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=A4AF0885CE94F03AC3B5FD67DC3645C8DDFC1931.DF0DFB662A60883D4F59781C4328C6AADE0B81BC&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.880&sver=3&source=youtube&mime=video%2Fwebm&pl=18&initcwndbps=4077500&itag=244&lmt=1461580131350055&clen=389559&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-122614&rn=1&rbuf=0","https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=A4AF0885CE94F03AC3B5FD67DC3645C8DDFC1931.DF0DFB662A60883D4F59781C4328C6AADE0B81BC&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.880&sver=3&source=youtube&mime=video%2Fwebm&pl=18&initcwndbps=4077500&itag=244&lmt=1461580131350055&clen=389559&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-122614&rn=1&rbuf=0",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-origin":["https://www.youtube.com"],"access-control-expose-headers":["Client-Protocol, Content-Length, Content-Type, X-Bandwidth-Est, X-Bandwidth-Avg, X-Walltime-Ms"],"alt-svc":["quic=\":443\"; ma=2592000"],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=21300"],"connection":["keep-alive"],"content-length":["122615"],"content-type":["video/webm"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Tue, 03 May 2016 09:40:10 GMT"],"last-modified":["Mon, 25 Apr 2016 10:28:51 GMT"],"server":["gvs 1.0"],"timing-allow-origin":["https://www.youtube.com"],"x-content-type-options":["nosniff"]},"xhr"]
``` cli
Treehouse happens to use ETags and set relatively long expire headers, which may be causing/exacerbating the issue.
I've been forward porting pulls when they were committed to nightmare. While the commits aren't 1:1 the functionality should be close nee identical to what is in the base fork.
If you would, please check it out and see if these changes align with Nightmare's goals.
const browser = new Nightmare()
const browser = new Nightmare()
@shesmu no, it doesn’t. Are you referring to #602, or are you seeing that error independently (and do you have a reproducible test case)? I can see, where that error is happening, but can’t see how the conditions that cause it would ever be true. I’d love to know if you have a way to make it reliably happen.
var Nightmare = require('nightmare');
nightmare
ming_o01 (master) nightmare1 $ DEBUG=nightmare node --harmony yahoo.js
nightmare queueing action "type" +19ms
nightmare queueing action "click" +17ms
nightmare queueing action "wait" +2ms
nightmare queueing action "evaluate" +2ms
nightmare running +3ms
ming_o01 (master) nightmare1 $
ming_o01 (master) nightmare1 $ DEBUG=nightmare node yahoo.js
nightmare queueing action "type" +14ms
nightmare queueing action "click" +7ms
nightmare queueing action "wait" +1ms
nightmare queueing action "evaluate" +1ms
nightmare running +3ms
'Cannot read property \'blur\' of null'
ming_o01 (master) nightmare1 $
var link = yield nightmare
SyntaxError: Unexpected identifier
this is the actual code.
var Nightmare = require('nightmare');
var link = yield nightmare
`npm i nightmare`
`npm i segmentio/nightmare`
Are you running the install commands inside your virtual box or on OSX? Nightmare has a dependency on electron-prebuilt, which downloads a platform-appropriate binary on install. So if you're installing on OSX but running on Linux it won't find the Linux binary.
var Nightmare = require('nightmare');
partition: 'custom'
nightmare
nightmare queueing action "evaluate" +5ms
nightmare running +7ms
nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly +7ms
nightmare queueing action "evaluate" +7ms
nightmare running +1ms
@Mr0grog Do I need to? I was working under the assumption that nightmare would start the virtual display itself. Maybe that was my problem.
Okay. I'm currently trying out Phantom+Casper+Spooky, seeing if that works a lil better. If I can't get that running, I'll probably switch back to nightmare again. I'll be sure to update this issue provided that doesn't go well.
My code:
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');
partition: 'custom'
nightmare
Nightmare is async, so at least part of your problem is this:
Nightmare(...)
Nightmare(...)
// wait to stop xvfb until nightmare is actually finished
nightmare queueing action "evaluate" +1ms
nightmare running +0ms
Nightmare runner error:
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');
partition: 'custom'
nightmare
This outputs nothing again. Changing to `DEBUG=nightmare` outputs:
nightmare queueing action "goto" for https://google.com +0ms
nightmare queueing action "evaluate" +3ms
nightmare running +3ms
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');
partition: 'custom'
nightmare
nightmare queueing action "goto" for https://google.com +0ms
nightmare queueing action "evaluate" +9ms
nightmare running +8ms
var user_marks = yield nightmare
- Nightmare itself
Here is my code:
`Nightmare({ show: false })
.goto('http://www.taoism.net/ttc/complete.htm')
Curious question: why name this `chromiumArguments` when the corresponding switches version is just `switches` (no “chromium” prefix)?
Also, tests?
Maybe something like (totally untested):
Nightmare.action(
Nightmare.action('stopRenderStream', function(done) {
Nightmare()
We used to support `javascript:` URLs, but lost that feature in #553. TBH, I’m slightly skeptical on bringing it back, _but_ #553 got released in an extra-minor update, so it seems worth fixing since it actually broke some people.
The more I think about it, the less I want to do it. It’s pretty edge-casey.
Please give to nightmare consumer decide when to kill process.
> I'm wondering now is if instead of exiting, the Nightmare instance should be put into an error state where any further calls would cause exceptions as the IPC parts are no longer reliable.
I definitely think this would be great. But some thoughts: there are two different kinds of `uncaughtException` handlers and I think the story is a little different for each.
1. Exceptions in the child (electron) process. This is what #558 was about. I think the reality here is that when this happens, we pretty much have to assume everything in the process (and therefore in the Nightmare instance controlling it) is hosed. I think you’re on the right track here, @rosshinkley:
The implementation basically wraps the Nightmare constructor used in tests and watches Electron’s `stderr` for deprecation warnings, then throws an exception at the end if there were any.
Note the tests _should_ fail, since we are using some deprecated APIs :P
1) Nightmare "after all" hook:
Oh, ha, sorry. Violent agreement!
We were using a few deprecated Electron APIs in various spots. Best to fix that before they disappear entirely and break! Happily, they were all just renamings or moves to other locations, so this was very straightforward.
var nightmare = Nightmare({});
nightmare.goto(url);
The main idea here is that Nightmare’s IPC objects gain two methods, each to be used in opposite processes:
if (error) { return console.error('UHOH!', error); }
Under the hood this is accomplished by having three special IPC messages:
I think I mistyped it on the issue thread, but I was originally thinking of _replacing_ `emit/on` with `call/respondTo` instead of having differently-named methods.
So do you think it should throw an exception? Or maybe just log a warning?
Definitely out of scope, but if `call` returned a scoped IPC instance instead of the emitter it does…
function Nightmare(options) {
Nightmare({
My 2 cents, without getting into the whole history here, is the syntax of `run()` is nice, and I don't really understand why it can't/shouldn't be a wrapper. But whether it is supported or isn't supported, a decision one way or another would be nice :)  Hi, we're trying to do something crazy here at https://github.com/resin-io/etcher. We're trying to automate the process of taking screenshots to our application (for the website, etc) by controlling the real Electron app with Nightmare.
In [this comment](https://github.com/segmentio/nightmare/issues/242#issuecomment-142985863), the user seems to be running scripts using `require()` with NightmareJS. I'll try various NightmareJS versions to see if it makes any difference.
Well, Nightmare is primarily meant to be a scripted _web browser,_ and loading any content from the web into an environment where `nodeIntegration = true` makes your whole machine extremely vulnerable to all manner of crazy attacks.
Github also released [Spectron](http://electron.atom.io/spectron/) sometime after this issue was originally posted. It’s probably a much better way to accomplish this stuff.  If a function passed to `.evaluate` return a promise then nightmare will wait for it to be resolved before sending the value (or reject before sending an error). This allows to execute async tasks in `.evaluate` and closes #552.
What do you think should be expected behaviour of wait when promise is returned? I guess Nightmare should wait for it to be settled.
yield nightmare
const beggening = Date.now();
yield nightmare
var nightmare = Nightmare({waitTimeout:1000});
return nightmare
then Nightmare's timeout is never enforced. It's Mocha that times out after 10s. I think it's a legitimate issue and we should deal with it.
``` diff
🤔
Hello, I'm playing with Nightmare and mostly love the experience. Thanks for this tool.
Nightmare
nightmare queueing action "wait" +1ms
nightmare running +0ms
nightmare:actions .wait() for 2000ms +1ms
nightmare electron child process exited with code null: undefined +396ms
nightmare running +9s
2) Nightmare devtools "after each" hook for "should open devtools":
There’s a patch for Nightmare: #576. It just needs review.
I have been battling this issue for some time now and can not seem to find a solution. When running tests with NightmareJS on mocha on the server they fail.
Do you have XVFB installed and running on your Bamboo server? It’s been a long time since I’ve touched anything with Bamboo and am not sure if it’s built-in. You need it to run Nightmare (well, Chromium, really) without a screen.
Maksim Luzik
maksim.luzik@gmail.com
What is internal/external concerns? :confused:
I love using Nightmare so far, thanks for creating it :tada:
var Nightmare = require('nightmare');
var n = Nightmare();
.wait('#hplogo')
return document.getElementById('hplogo');
return document.getElementById('hplogo').height;
2. What is that weird object with the `__jsaction` property?
> What is that weird object with the __jsaction property?
> wild guess, though.
> been curious if it was coming from Nightmare somehow (good to know it's
nightmare queueing action "goto" for http://2ality.com +0ms
nightmare queueing action "wait" +2ms
nightmare queueing action "evaluate" +1ms
nightmare running +1ms
nightmare:log did-get-response-details +14ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://yandex.st/highlightjs/8.0/highlight.min.js","http://yandex.st/highlightjs/8.0/highlight.min.js",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=315360000","public"],"content-encoding":["gzip"],"content-type":["application/x-javascript"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["W/\"34293900-75de\""],"expires":["Thu, 31 Dec 2037 23:55:55 GMT"],"last-modified":["Wed, 24 Sep 1997 16:00:00 GMT"],"server":["nginx/1.9.4"],"timing-allow-origin":["*"]}]
nightmare:log did-get-response-details +137ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://syndication.twitter.com/i/jot?dnt=1&l=%7B%22widget_origin%22%3A%22http%3A%2F%2Fwww.2ality.com%2F%22%2C%22widget_frame%22%3Afalse%2C%22widget_id%22%3A%22372995588821757952%22%2C%22query%22%3Anull%2C%22profile_id%22%3Anull%2C%22widget_in_viewport%22%3Afalse%2C%22item_ids%22%3A%5B%22719856924687278080%22%2C%22719843752534220801%22%2C%22719543539542192128%22%2C%22719286885898719232%22%2C%22719262180215037952%22%5D%2C%22item_details%22%3A%7B%22719856924687278080%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719856963304210435%22%7D%2C%22719843752534220801%22%3A%7B%22item_type%22%3A0%7D%2C%22719543539542192128%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719543689278791685%22%7D%2C%22719286885898719232%22%3A%7B%22item_type%22%3A0%7D%2C%22719262180215037952%22%3A%7B%22item_type%22%3A0%7D%7D%2C%22_category_%22%3A%22tfw_client_event%22%2C%22triggered_on%22%3A1460476753773%2C%22dnt%22%3Atrue%2C%22client_version%22%3A%221fee1b0%3A1460048100015%22%2C%22format_version%22%3A1%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22component%22%3A%22timeline%22%2C%22element%22%3A%22initial%22%2C%22action%22%3A%22results%22%7D%7D","https://syndication.twitter.com/i/jot?dnt=1&l=%7B%22widget_origin%22%3A%22http%3A%2F%2Fwww.2ality.com%2F%22%2C%22widget_frame%22%3Afalse%2C%22widget_id%22%3A%22372995588821757952%22%2C%22query%22%3Anull%2C%22profile_id%22%3Anull%2C%22widget_in_viewport%22%3Afalse%2C%22item_ids%22%3A%5B%22719856924687278080%22%2C%22719843752534220801%22%2C%22719543539542192128%22%2C%22719286885898719232%22%2C%22719262180215037952%22%5D%2C%22item_details%22%3A%7B%22719856924687278080%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719856963304210435%22%7D%2C%22719843752534220801%22%3A%7B%22item_type%22%3A0%7D%2C%22719543539542192128%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719543689278791685%22%7D%2C%22719286885898719232%22%3A%7B%22item_type%22%3A0%7D%2C%22719262180215037952%22%3A%7B%22item_type%22%3A0%7D%7D%2C%22_category_%22%3A%22tfw_client_event%22%2C%22triggered_on%22%3A1460476753773%2C%22dnt%22%3Atrue%2C%22client_version%22%3A%221fee1b0%3A1460048100015%22%2C%22format_version%22%3A1%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22component%22%3A%22timeline%22%2C%22element%22%3A%22initial%22%2C%22action%22%3A%22results%22%7D%7D",200,"GET","http://www.2ality.com/",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-encoding":["gzip"],"content-length":["65"],"content-type":["image/gif;charset=utf-8"],"date":["Tue, 12 Apr 2016 15:59:12 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 12 Apr 2016 15:59:12 GMT"],"pragma":["no-cache"],"server":["tsa_a"],"status":["200","200 OK"],"strict-transport-security":["max-age=631138519"],"x-connection-hash":["463d5e670b6a2fea4f8cc1891dce5829"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["7"],"x-transaction":["0b5c58d40287d643"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["1; mode=block"]}]
nightmare:log page-favicon-updated +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},["http://www.2ality.com/favicon.ico"]]
nightmare:actions .wait() for body element +1ms
nightmare:actions .evaluate() fn on the page +4ms
nightmare queueing action "viewport" +14ms
nightmare queueing action "wait" +0ms
nightmare queueing action "screenshot" +0ms
nightmare running +0ms
nightmare:actions .viewport() +0ms
nightmare:actions .wait() for 1000ms +52ms
nightmare:actions .screenshot() +1s
var dimensions = yield nightmare.goto(inputURI)
yield nightmare.end();
"nightmare": "^2.3.1",
Nightmare did hang, after 60 seconds no response.
var Nightmare = require('nightmare');
'http://tiendas.mediamarkt.es/',
'https://www.kairos.com/',
nightmare.goto(website.url)
``` cli
nightmare:log did-get-redirect-request +10ms [{},"https://match.adsrvr.org/track/cmf/generic?ttd_pid=steelhouse&ttd_tpi=1","https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919",false,302,"GET","https://teamtreehouse.com/",{"cache-control":["private,no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["189"],"content-type":["text/html"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"location":["https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919"],"p3p":["CP=\"NOI DSP COR CUR ADMo DEVo PSAo PSDo OUR SAMo BUS UNI NAV\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"set-cookie":["TDID=4a61710e-63ae-4def-8ca5-734dc833a919; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/","TDCPM=CAESFwoIZmFjZWJvb2sSCwiwjZvH7OjvMxAFEhkKCmktYmVoYXZpb3ISCwikvd3M6+jvMxAFEhQKBXRhcGFkEgsIiNzE5ezo7zMQBRIZCgpkcmF3YnJpZGdlEgsIhu/q5ezo7zMQBRIWCgdhZGJyYWluEgsI9Iin6uzo7zMQBRIWCgdibHVla2FpEgsIuue21e6J+DMQBRIWCgdydWJpY29uEgsIiOns/PXo7zMQBRIXCghwdWJtYXRpYxILCPKmwdH26O8zEAUSFQoGY2FzYWxlEgsI1qb+ncCg9zMQBRIZCgpzdGVlbGhvdXNlEgsImPDhrdLO+TMQBRIVCgZnb29nbGUSCwi67KC+v6D3MxAFEhgKCWJpZHN3aXRjaBILCICDhqjE8+8zEAUSGAoJbW9va2llLXBzEgsIuvqHy9Xz7zMQBRIYCgljcm9zc3dpc2USCwjcw+De1/PvMxAFEhgKCVF1YW50Y2FzdBILCPaN+q6W9fYzEAUSFgoHYWRkdGhpcxILCODP+Y+k9vYzEAUSGQoKcmlnaHRtZWRpYRILCIC1y+yMq+wzEAUSFwoIYXBwbmV4dXMSCwjczKbl4In4MxAFEhIKA2FhbRILCPrO2Pek9vYzEAUSFgoHZXhlbGF0ZRILCKzPm/ek9vYzEAUSFgoHbmV1c3RhchILCMyP4fyk9vYzEAUSFQoGbW9va2llEgsIhL6m5K329jMQBRIYCglhb2xhZHRlY2gSCwiEvqbkrfb2MxAFEhQKBXNwb3R4EgsIvOiNmK729jMQBRIYCglzdGlja3lhZHMSCwj8sM+10/v2MxAFEhUKBmFkYXB0dhILCK6Hjp2Y/PYzEAUSFAoFb3BlbngSCwie7YbBnqD3MxAFEhUKBmFkbWFucxILCPT1tsK/oPczEAUSGgoLc21hcnRzdHJlYW0SCwjM+sGZv6D3MxAFEh0KDnNtYXJ0LWFkc2VydmVyEgsIjvbTleeJ+DMQBRIVCgZzb25vYmkSCwior43PyKD3MxAFEhUKBmxvdGFtZRILCIzNxa+2ofczEAUSFwoIbGl2ZXJhbXASCwjShr/xt6H3MxAFEhQKBXRlYWRzEgsIrOjptqWu9zMQBRIdCg5mZWRlcmF0ZWRtZWRpYRILCIqG+86VpfczEAUSGAoJYWRhZHZpc29yEgsIkJba9I6s9zMQBRIaCgthcmV5b3VodW1hbhILCJ6i1I6RrPczEAUSGwoMY2hvaWNlc3RyZWFtEgsI2tqko6qs9zMQBRIWCgdyYWt1dGVuEgsIyLX/2euJ+DMQBRIZCgpjcm9zc3BpeGVsEgsImMWls7Ou9zMQBRgBIAEoAjILCJjo5NrozvkzEAU4AVIZCgppLWJlaGF2aW9yEgsImJG688Pz7zMQBVIWCgdhZGJyYWluEgsImJG688Pz7zMQBVIUCgV0YXBhZBILCJiRuvPD8+8zEAVSGQoKZHJhd2JyaWRnZRILCNjC1LzX8+8zEAVSFgoHYmx1ZWthaRILCNjC1LzX8+8zEAVSFQoGY2FzYWxlEgsI2MLUvNfz7zMQBVIYCgljcm9zc3dpc2USCwiQkIigiPXvMxAFUhcKCHB1Ym1hdGljEgsIkJCIoIj17zMQBVIVCgZnb29nbGUSCwiQkIigiPXvMxAFUhcKCGZhY2Vib29rEgsI0rXGiZb19jMQBVIYCgliaWRzd2l0Y2gSCwjStcaJlvX2MxAFUhgKCW1vb2tpZS1wcxILCNK1xomW9fYzEAVSFgoHcnViaWNvbhILCLTlyqGa9fYzEAVaCnN0ZWVsaG91c2VgAmoOVW5pdGVkIEtpbmdkb20=; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/"],"x-aspnet-version":["4.0.30319"]}]
nightmare:log did-get-response-details +3ms [{},false,"https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NOI DSP COR NID CURa ADMa DEVa PSAa PSDa OUR BUS COM INT OTC PUR STA\""],"pragma":["no-cache"],"server":["nginx/1.7.10"],"set-cookie":["tuuid=ed0ec49d-62d8-4c67-a4da-f48084302b86; path=/; expires=Wed, 03-May-2017 08:54:28 GMT; domain=.bidswitch.net"]},"image"]
nightmare:log did-get-response-details +13ms [{},false,"https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919","https://match.adsrvr.org/track/cmf/generic?ttd_pid=steelhouse&ttd_tpi=1",200,"GET","https://teamtreehouse.com/",{"connection":["close"],"content-encoding":["gzip"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["CP=\"NON DSP COR NID CURa ADMa DEVa PSAa PSDa OUR STP UNI COM NAV INT STA PRE\""]},"image"]
nightmare:log did-get-response-details +14ms [{},false,"https://pub.weatherbug.com/RealMedia/ads/adstream.cap/123?c=crwe&va=1&e=30d","https://pub.weatherbug.com/RealMedia/ads/adstream.cap/123?c=crwe&va=1&e=30d",200,"GET","",{"cache-control":["no-cache,no-store,private"],"connection":["Keep-Alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Fri, 30 Oct 1998 14:19:41 GMT"],"keep-alive":["timeout=60"],"p3p":["CP=\"NON NID PSAa PSDa OUR IND UNI COM NAV STA\",policyref=\"/w3c/p3p.xml\""],"pragma":["no-cache"],"server":["Apache/2.2.15 (CentOS)"],"set-cookie":["crwe=1; path=/; expires=Thu, 02-Jun-16 08:54:29 GMT; domain=.weatherbug.com","NSC_pbt.d18ef_c_wtfswfs_ttm=ffffffff090b8e5a45525d5f4f58455e445a4a423660;expires=Tue, 03-May-2016 08:56:29 GMT;path=/;secure;httponly"]},"image"]
nightmare:log did-get-redirect-request +1ms [{},"https://d.agkn.com/pixel/5500/?atr=000&fl=&age=&gender=&st=&sk=164451201942000149264&pd=&cbr=&mip=&dm=&py=&l0=https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264","https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264",false,302,"GET","https://society6.com/",{"cache-control":["no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"location":["https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264"],"p3p":["CP=\"NOI DSP COR CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Apache-Coyote/1.1"],"set-cookie":["uuid=513230237341791276; Version=1; Domain=.agkn.com; Max-Age=157680000; Expires=Sun, 02-May-2021 08:54:28 GMT; Path=/","u=C|0GEoeshUXHrsjxAAAwAAiAAABAC0BB-gWAgYBDI4BAIYHEUEABwAACi8ABgAACiwABgAACikABgAAEVcABgAABykABAAAARYAAAAABAAjAAAAAAAEx7D__z_Bl-ZTAuMn4wAAAAAAAAHLAAAAAACkbQoAAAAAAqQeKwAAAAAAJJwZAAYAGwAAAAAAF9j3__8vG_1tBzf9FHkAAAAAAAAAAQAAAAAAJ9QfAAAAAAEagHwABgAHAAAAAACPoUP__z4AAAAAABinDgAAAAAHn80uAAAAAAQWKYUAAAAAEfFKnAAGAAcAAAAAAIoyiP__PgAAAAAAInN7AAAAAAdMnSYAAAAAA-XYZwAAAAARnnHXAAU; Version=1; Domain=.agkn.com; Max-Age=63072000; Expires=Thu, 03-May-2018 08:54:28 GMT; Path=/"]}]
nightmare:log did-get-response-details +7ms [{},false,"https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264","https://adadvisor.net/adscores/g.js?sid=9212244187&_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a238-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=195 t=1462265667790037"],"x-served-by":["beacon-a238-dub.krxd.net"]},"image"]
nightmare:actions .evaluate() fn on the page +0ms
nightmare:log did-get-response-details +2ms [{},false,"https://pixel-geo.prfct.co/seg/?add=4728398&source=js_tag&a_id=57309","https://pixel-geo.prfct.co/seg/?add=4728398&source=js_tag&a_id=57309",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT"]},"image"]
nightmare:log did-get-response-details +0ms [{},false,"https://ad.afy11.net/ad?mode=7&publisher_dsp_id=7&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://ad.afy11.net/ad?mode=7&publisher_dsp_id=7&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"access-control-allow-origin":["*"],"cache-control":["private, max-age=0, no-cache, no-store, must-revalidate, proxy-revalidate"],"connection":["close"],"content-length":["45"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 1 Jan 2000 01:01:00 GMT"],"last-modified":["Sat, 1 Jan 2000 01:01:00 GMT"],"p3p":["policyref=\"https://ad.afy11.net/privacy.xml\", CP=\" NOI DSP NID ADMa DEVa PSAa PSDa OUR OTRa IND COM NAV STA OTC\""],"pragma":["no-cache"],"server":["Microsoft-IIS/7.5","AdifyServer"],"set-cookie":["s=1,5*57209ad3*Zk3gbkYIp8*ZvwHIUWA5Po9pZL5*,7*571f589b*h6gOK2F5xT*FiwRBjv8dwBmTtSWACW2sHiYz9UStlMlZfL1VXxnbPSPK8A3*; path=/; expires=Thu, 03 May 2018 08:54:28 GMT; domain=afy11.net;"],"x-powered-by":["ASP.NET"]},"image"]
nightmare:actions .evaluate() fn on the page +1ms
nightmare:log did-get-response-details +0ms [{},false,"https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NOI DSP COR NID CURa ADMa DEVa PSAa PSDa OUR BUS COM INT OTC PUR STA\""],"pragma":["no-cache"],"server":["nginx/1.7.10"],"set-cookie":["tuuid=ed0ec49d-62d8-4c67-a4da-f48084302b86; path=/; expires=Wed, 03-May-2017 08:54:28 GMT; domain=.bidswitch.net"]},"image"]
Hi @rosshinkley & @Mr0grog,
Here is my code:
var Nightmare = require('nightmare');
'http://tiendas.mediamarkt.es/',
'https://www.kairos.com/',
'http://aflcio.org',
'http://afvclub.com',
'http://allyou.com',
'http://amleo.com',
'http://animoto.com',
'http://areyoulivingsocial.com',
'http://avaaz.org',
'http://ayi.com',
'http://gardenguides.com',
'http://gazelle.com',
'http://gigapan.com',
'http://gohawaii.com',
'http://gybo.com',
'http://insidermonkey.com',
'http://inyopools.com',
'http://ipage.com',
nightmare.goto(website.url)
To use memory partitions, construct a Nightmare instance like:
(And I should also note that 50 Nightmare windows is _way_ more intense on your system than just 50 tabs in Chrome.)
var instance = Nightmare();
.goto(url)
nightmare electron child process exited with code null: undefined +4s
Given that Chromium has also hit this, if we add a pooling mechanism as above, that also gives us a way to cap the number of Nightmare instances running simultaneously. We can just queue up the rest to run when a window becomes available.
Indeed :D    I have a private laundry list of things I’d love to see changed in Nightmare, but the only one that is a Big Deal™ (aka the one that gives me that good old “is this a jenga tower” feel [I kid, but still]) is that one. However! I think that issue is _largely_ independent of this one (save that care should be taken not to make it worse).
No idea, but:
I guess I was thinking this would be the role of some component that is entirely private—a new nightmare instance would ask that manager for a communications channel to a window when created and would close the channel/tell the manager it’s done when `end`-ed.
Ah, hadn’t thought about child windows. This would still necessarily require new API for interacting with those child windows, though, right? Or I guess you could have an event for `new-child-window` or something that includes as a parameter a wrapper for the window. That could definitely be a `Nightmare` instance, though. (_Seems_ like it would be the nicest way to do it for users at first blush.)
Toooootally. Said much more clearly than my “wobbly heuristics” note :P
> Reorganizing how Nightmare and Electron interact seems like a good time to think about simultaneous calls/multiple runs/handling messaging spaghetti.
`Nightmare runner error:`
These seem to hang Nightmare - they log an error to the console and end the child process. However, I'd like to be able to catch such errors in my code that is using Nightmare. Is there a good way to do this?
@yoz ah, that’s frustrating. It sounds like the issues in Electron are fairly thorny.
Nightmare runner error:
at Error (native)
I'm on nightmare 2.10.0 / electron 1.4.4.
var nightmare = Nightmare(size);
@AaronTrazona: how do you do, in order to make it work? Sorry, problem solved mostly thanks to #104: "`new Nightmare()`".
var n = Nightmare();
nightmare
Additionally, there’s some serious craziness around `webRequest.onBeforeRequest()`. Between the fact that calling that method with a new listener (or no listener) removes any existing listener and the fact that plugins now have access to the Electron process, a plugin could easily clobber the mechanisms `goto` relies on (or vice versa). So I had to do some wacky gymnastics to protect against that.
Side note: I realized while looking at https://circleci.com/gh/Mr0grog/nightmare/13 that I didn’t really do a very good job with the “fail if the response dies in flight” test. Going to rewrite it by adding a server endpoint that just kills the socket, which should make the test reliable.
> From that, I think it's increasingly likely this is a race condition, and as such, swapping out for did-fail-provisional-load is a decent call. Thoughts?
OH MY GOD THE TESTS PASSED ON CIRCLE
navigator.api.
.waitForThing
, nightmare = Nightmare({
nightmare
var N = require('nightmare')
.type('#kw', '哈哈哈')
var N = require('nightmare')
I'm using Nightmare in conjunction with tape in order to produce TAP output from my automated tests.
I've noticed some weird behaviour in ending Nightmare, I cannot call `.end()` after a `.then()` or within a `.then()`, which would be the logical place to put it, example:
return Nightmare({show: false}).goto(url);
…but either way, yeah, this is definitely a little confusing :\
@rosshinkley @Mr0grog your explanations are very helpful but you confuse `t.end()` and `window.end()`. I won't check your code snippets but this works, @wcjohnson11 :
var Nightmare = require('nightmare');
tape('Nightmare test', function (t) {
var nightmare = Nightmare();
nightmare
P.S. @rosshinkley , Add `queue` argument to callbacks, maybe? And why result of `nightmare.then(cb)` isn't chainable? Is it good that `TypeError: nightmare.goto(...).wait(...).exists(...).then(...).end is not a function`?
@kuraga Augh, sorry. Did not read carefully :(
@rosshinkley @Mr0grog @wyqydsyq
@kuraga Does your expectation (`expect(text).to.match(/Информация об узле 1:/)`) fail? If so, `console.log(3)` _shouldn’t_ be called, because that’s in a success handler. The failed expectation will throw an exception, which will cause the promise returned by the `then` that it’s in to _reject_ instead of resolve.
@wyqydsyq you also can use [`t.plan()`](https://github.com/substack/tape#tplann)
const browser = new Nightmare({
.type('#login_password', '12345678')
- [ ] @reinpk
A value where `!value` is `true`.  `undefined`, `null`, `0`, `false` are all falsey.  In Nightmare's case, empty string (`''`) is also included.
nightmare.proc.disconnect();
nightmare
Nightmare's `.type()` splits the string into characters blindly, causing `\n` to be typed as `['\', 'n']`.
nightmare
I just need to include nightmare in a electron application
.....That is, it's really reliable on our development machines and mac minis in our office. We tried to upload our code to an AWS instance running ubuntu 14.04.3 and had no success. After some research, we discovered that electron was the problem. For whatever reason, electron-prebuilt does not come with the right stuff to be run off of ubuntu and work as expected.
Is there a way around this? Maybe a different version of electron can be used? Has anyone else had problems running nightmare on an AWS instance, or been able to get nightmare working on one?
If I absolutely cannot get [zombiejs](http://zombie.js.org/) to work, which is what I am now trying to use, I will go back and try your suggestion.  It sounds like the guys who were participating in your linked thread were having to try some very involved processes which is a red flag for me.
I have gotten it working on travis-ci using this script:
addons:
- xvfb
How best way to get in cecle?
nightmare
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.end(function(){
@Velissel's example appears to be trying to put cookies from one domain onto another, which is forbidden to the best of my knowledge.
@rclai _might_ be talking about something different: are you trying to reuse cookies from the same domain across Nightmare instances?
@Velissel I understand you want to preload the cookies before navigation, but I don't think Nightmare allows for adding cookies _prior_ to navigation.  I still don't think adding cookies across domains like you're doing is permitted.
I'm skeptical it works in exactly the manner you're describing under Phantom.  I'd have to put together an experiment to see for myself.
In attempting to explain the behavior of `run` and `then` for #516, I realized the details of how Nightmare’s `then` method works means you can’t just say “works like `promise.then`.” The difference is minor and the likelihood of it tripping someone up is probably low, but it could still happen, especially given the promise-y expectations the method’s name sets up. Since `then` is now the preferred API, it should really be documented and, in doing so, the details of `then` should be made clear.
It might be helpful to understand _why_ Nightmare’s `then` method does not behave in accordance with a promise’s `then` (or any Promises/A+ compliant thenable) in order to better document it.
Is this difference intentional? If so, what was the intent behind that decision? What was it meant to enable or prevent, if anything? If not, is this a bug to be fixed?
I suspect the difference is a side effect of ensuring `vo`, `co`, and possibly `mocha-generators` Just Work&trade;.  Consider the following (admittedly contrived) example:
yield nightmare
yield nightmare.end();
var nightmare = Nightmare();
nightmare
which is only very subtly different (namely, it conflates an error in the thing being promised [actions in Nightmare] with an error in user code _handling_ the promise). More below…
Nightmare.prototype.then = function(fulfill, reject) {
var nightmare = Nightmare();
nightmare
var nightmare = Nightmare();
nightmare
var nightmare = Nightmare();
nightmare
That’s why I don’t think a lot of people will trip over this—the above is generally the recommended way to do things (to ensure you catch your own errors in your handler) and it behaves just fine with Nightmare right now.
> And with that in mind, I played around with Nightmare in an attempt to address this issue.
In your experiment, you’re handling a lot of different conditions explicitly, but still using the `then(onSuccess).catch(onError)` construct, which is the source of the difference in behavior. That is to say, I don’t think your change there would “solve” what I was trying to get at with this issue, though it might solve something else I wasn’t thinking about :)
I'm following now, and thank you for the clarification.  I can see why you were confused, though: I had gotten it in my head that the way Nightmare implemented `.then()`, it might be eating the exception, making a `.catch()` at the end of a chain never get called.  Clearly not, as `.then()`/`.catch()` with falsey arguments still returns a promise.  Looking over my original notes and sandbox, I'm not entirely sure how I got to the "eats exceptions" conclusion.
> Looking over my original notes and sandbox, I'm not entirely sure how I got to the "eats exceptions" conclusion.
> Is there something I'm not thinking of? More to the point, would there be a reason for Nightmare's .then() not to behave like Promise's .then()?
nightmare
.goto(url)
.goto(url)
getLinks(blogUrls);
return nightmare
.goto(url)
The flow is a little more complicated there, but you can avoid running lots of electron processes at once this way.
I need to add custom header to the every request. Using `nigthmare.header()` method sends those only with `goto` call, so for instance if I have an XHReq in the app I'm automating with `nightmare`, the header isn't sent with it. Is there any way to make it happen?
... would add `'x-foo'` to every request
Anyway, is there a chance to have a feature like this in Nigthmare? Or how to achieve this in Electron?
yield nightmare
Nightmare.prototype._inject = function(js, done) {
nightmare
nightmare
As for evaluate: I think you're hitting a problem with element existence and Nightmare not being terribly good at warning you when you're performing actions on elements that don't exist.  The following will complete and print out the result of the `href`, but I doubt it does exactly what you want:
nightmare
.type('#yschsp', 'ghosts')
The second search doesn't clear the searchbox, and will prepend "ghosts" to the original "github nightmare" search term.
Hmm, which version are you using? I have just tried "nightmare": "^2.2.0" and I cannot execute multiple evaluate calls
nightmare = Nightmare();
nightmare
return nightmare
return nightmare.end();
"test": "mocha --harmony"
This is a little tangential, but #571 made me wonder if the scripts added in #565 should really be part of Nightmare itself instead of the tests. That is, using Nightmare as a testing tool on a CI server somewhere seems like a major use-case. As it stands now, every user of Nightmare will have to know that they need to replicate Nightmare’s testing setup. If Nightmare just did all of that on its own before launching Electron, that would not only solve the deadlock for Nightmare’s own tests but also for other tests that leverage Nightmare.
Is that https://github.com/rosshinkley/nightmare/tree/502 ?
I wasn’t suggesting that it shouldn’t! Obviously this whole method requires more bookkeeping: whenever an Electron process ends, you’d have to check and see whether any others are running in order to know whether to stop xvfb. For that purpose, though, it could be as simple as a counter.
Side note: I _suspect_ the `xvfb-run` method will cause problems for dealing with the exit code of the Electron process (https://github.com/rosshinkley/nightmare/blob/502/lib/nightmare.js#L128), since `xvfb-run`’s manpage makes it sound like the exit code is not preserved.
Sorry for being unclear, I'm referring to the asynchournous version when they are not being given a callback.
``` diff
Nightmare.prototype.run = function(fn) {
``` diff
Nightmare.prototype.run = function(fn) {
``` diff
Nightmare.prototype.run = function(fn) {
``` diff
Nightmare.prototype.run = function(fn) {
+    throw new TypeError('Expected callback to be a function')
Nightmare()
.goto(url)
var nightmare = Nightmare();
nightmare
.goto(url)
return nightmare
nightmare.end(function() {
var nightmare = new Nightmare();
nightmare.viewport( 1024, 768 )
// just gets the dimentions
return nightmare.scrollTo( rect.y, rect.x )
nightmare = Nightmare({show:true});
@mousemke sorry if this is obvious and you already thought of it, but are you on a device with a retina or other high-res display, like a Chromebook pixel, Retina MacBook Pro, etc? Electron will definitely give you a screenshot with “double the pixels” (or something else if you have a more than 2x display). The viewport dimensions you set are in “effective pixels” or “CSS pixels,” not device pixels.
@Mr0grog  I'm struggling on this one, how do you access WebFrame to do the zooming, from `evaluate()` ? I get a `webFrame is not defined`. Thx `WebFrame` and `screen` are Electron APIs, so you either need to get them by writing a plugin using [the `action` method](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) or by using a [custom preload script](https://github.com/segmentio/nightmare#custom-preload-script).
var rect = yield nightmare
.goto(url)
yield nightmare
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.exitIframe();
nightmare.end();
Tryit Editor v2.6
Tryit Editor v2.6
It works great @tiangolo, thanks for this. I haven't seen any issues so far.
Nevertheless, I think none of the other methods check or throw any error, for example, if you run `nightmare.type('.weird .non .existent .selector', 'some text that never gets typed')` you don't receive any error either.
@rclai: It modifies internal stuff (quite "core" internal stuff).
I actually first tried creating a plug-in, but it wouldn't work without changing the core, or I would have had to override every method (and every future method) in Nightmare...
nightmare
Bottom-line, though, it seems to me that there are a lot of caveats to this that haven’t been talked through here.
@rosshinkley, I tried at first all the ideas I had to make it a plug-in, but I had to throw all that code away and start from scratch because I found that I had to modify deeper functionality in Nightmare.
For the other Nightmare users in this thread that wanted this functionality (with all the risky security concerns already mentioned), using @rosshinkley's plug-in is working now.
Please consider the way of working except name of api.
hi, how can i use nightmare-webrequest-addon?
@skysilence See https://github.com/kyungw00k/nightmare-webrequest-addon/blob/master/README.md first
If two queues on the same Nightmare instance are operating simultaneously and both call the same action (e.g. `evaluate()`), it is possible for one call to pick up the results from the first call and finish early, continuing its cue with the wrong data.
var Nightmare = require('nightmare');
var page = Nightmare({show:true}).goto('http://yahoo.com');
return document.querySelector(".darla").firstChild.nodeName === "IFRAME";
// Inifnite wait finished, but shouldn't have! (uhoh)
var Nightmare = require('nightmare');
var page = Nightmare({show:true}).goto('http://yahoo.com').run(function() {
// Typed 'github nightmare'? goikt
// Typed 'ok'? goikt
Obviously this is a little edge-case-y, but I suspect users will hit things like this more now that the "official" way to use Nightmare is via the `then()` API instead of with generators (where you have to go out of your way to trigger simultaneous actions).
It might also be worth noting that, while this is generally an edge-case, deep extensions of the sort that #425 aims to enable might be more prone to triggering these sorts of issues if they are slow and highly asynchronous.
High-level goals:
(If we wanted to change Nightmare’s API for actions to be promise-based, then I’d say this new API should be promises, too, but I don’t think anybody is pushing to do that).
> Are you envisioning .then() being an action that acts like Underscore's/Lodash's .tap(), or would there be a differentiation between the queue being executed and the queue that is accruing tasks?
nightmare
return nightmare.action2();
nightmare
That is to say, I do not think this would be acceptable because it either violates the expectation of promises/then or puts you in a deadlock (can't continue to action3 until action2 is done but action2 can't be performed until after action3):
(Except the above _is_ what would theoretically happen if `then1` didn’t _return_ the nightmare instance (no more deadlock concern). But, mechanistically, it would be complicated to differentiate between the two. Hmmm.) Not to mention the question of what happens here:
nightmare
return nightmare.action2();
return nightmare.action4();
nightmare
But then I want to imagine a magical land of fairies and unicorns where this works:
nightmare
return nightmare.action2();
I think (if I’m thinking right, but I’m getting a headache now) that emulates the behavior of the first timing chart but under the implementation that matches the second (very complicated timing chart). Or, under the first technical approach, the two code snippets function the same, while they function differently under the second.
nightmare
return nightmare.action2(); // implicit then caused by return
nightmare
And this is starting to get crazy enough that I’m almost beginning to regret coming down this path. Sigh.
nightmare
return nightmare.action2();
nightmare
Being one of:
Do you have some idea to help me debug that ? Thanks ! @GautierT I think you might be a bit mixed up here—nothing on this issue is about problems running multiple instances of Nightmare at once (in fact doing so *solves* the issues here; this is about doing multiple sets of actions with *one* Nightmare instance).
// it is probably a different one than any we've used before.
partition: 'nopersist'
- Mocha-generators, Jasmine-co, etc. (for testing)
@Mr0grog no problem.  I apologize if I zapped any of your efforts, but I saw #490 this morning and figured that since I was in there, I may as well patch up the other stuff you pointed out.
The biggest thing I'm concerned with about moving away from generator-based examples is that several things are buggy in Nightmare if you ask it to handle multiple queues at once—and that's easy/inviting to do if you focus on the run/end/then API. See, for example, #465. On the other hand, I'd bet those issues exist because early authors focused on using generators and so rarely tripped over bugs that happen when multiple operations are going on simultaneously. But all that is a big discussion that is somewhat separate from how things are documented! So I'll shut up on that for now.
Ooh, definitely! I think the documentation, in general, could be vastly improved. Several of the issues and questions in #472 are ones I ran into when I first started looking at Nightmare, too (I also think it would be great if all methods returned a promise or thunk—there's no reason a nightmare instance can't actually be one of those things, but that's _way_ out of scope here).
(And to be clear, none of that is to say that Nightmare is a bad or project or that anybody is doing bad work—merely that it's not super friendly to big outside contributions.)
> The biggest thing I'm concerned with about moving away from generator-based examples is that several things are buggy in Nightmare if you ask it to handle multiple queues at once—and that's easy/inviting to do if you focus on the run/end/then API.
That said, I am very interested in the outcome of #465.  I suspect there's other issues in the guts of Nightmare to getting single-page parallel operations to work.  I haven't carved out time to really get into it, though.
>  But all that is a big discussion that is somewhat separate from how things are documented! So I'll shut up on that for now.
As you pointed out, this is also kind of out in the weeds, but I just wanted to quickly point out that all of the methods _do_ return a thennable as Nightmare itself (partially) implements promises.  Having Nightmare directly inherit from `Promise` opens a bit of a can of worms.  (I touched on this briefly in #472.)
> [Rant warning:]
> @Mr0grog
> @Mr0grog
Based on my observations in this project, the direction (at least since moving off of Phantom and onto Electron) has been ad hoc.  Folks wanting certain functionality ask for it, and in general, that piece is discussed and added or fixed in isolation.
Technical notes first, feelingsy stuff about how stuff gets done second:
> Having Nightmare directly inherit from Promise opens a bit of a can of worms. (I touched on this briefly in #472.)
Glad to know I’m not just a crazy man off screaming in the corner! Thanks for your feedback, too, it was probably clearer and more concrete than mine :D
I need use proxy credentials but how to do this in nightmare ?
But how to do this in nightmare ? I need send event.preventDefault(), but how it can over ipc ?
Greets
@abacaj if you can use a headless browser with a fake DOM implementation, then you should. Last I checked zombie was still using jsdom, you could improve that further with cheerio. Nightmare is built for sites that are javascript heavy and need to be able to run the client-side javascript code. https://github.com/laggingreflex/scrapers-benchmarks
Run 1 { request: 747, zombie: 2895, phantom: 4406, nightmare: 7854 }
Run 2 { request: 627, zombie: 2008, phantom: 4486, nightmare: 7522 }
Run 3 { request: 620, zombie: 1807, phantom: 4736, nightmare: 11186 }
Run 4 { request: 631, zombie: 2025, phantom: 4810, nightmare: 8878 }
Run 5 { request: 615, zombie: 2122, phantom: 4864, nightmare: 7726 }
Average: { request: 648, zombie: 2171, phantom: 4660, nightmare: 8633 }
//<![CDATA[
var nightmare = Nightmare();
yield nightmare.end();
Nightmare gives me a "_ is not defined" error
@Mr0grog Would [window.requestAnimationFrame()](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame) trigger the render tree?
Is it possible to upload files using nightmare.type('#input-element-id', '/tmp/img001.jpg'), similar to what selenium supports?
yield nightmare.click(link).wait(return_button);
yield a = nightmare.evaluate(function() {return "hello"});
yield nightmare.back().wait(refine_button);
yield a = nightmare.evaluate(function() {return "hello"});
The former waits for an assignment of what `.evaluate()` returns, which is a Nightmare instance.  The latter awaits fulfillment of what `.evaluate()` yields.
whats the best way to get access to `win.session.webRequest` object through Nightmare?
@yoshi95 I added `nightmare.webRequest.onBeforeRequest` in PR #495
@kyungw00k the API you're requesting is done.  For more information, read through #391 and #425.
@kyungw00k Correct.
If you're seeing exit code 127, you may not have electron installed correctly.
If you're seeing exit code 126, you may not have all the necessary dependencies for electron (:wave: gtk).
If you're seeing exit code 1, xvfb is a likely suspect in my experience.
If you're seeing exit code 0, electron appears to be working fine and it's something else.
Is there some way to use nightmare without a headless browser, like include it tampermonkey plugin?
For clarity: are you asking if Nightmare could be used under TamperMonkey?
I'm not writing an extension for TamperMonkey. I just want to use nightmare API to write scripts in TamperMonkey. Thank you for your replies.
You're very welcome, Nightmare has been a huge help in my work and I'm happy to contribute where I can.
When using Nightmare 2.1.2 and 2.1.3, we see the following warnings,  but only on Windows.
var nightmare = new Nightmare();
document.getElementsByClassName('ac-21th')[0].href;
* @param {Nightmare} self
var Nightmare = require('nightmare');
new Nightmare({ show: true })
Oh..which version of nightmare are you using?
I want it to run headlessly. I have changed it to `new Nightmare({ show: false })` but it hasn't made any difference.
@inversion I think the issue you were trying to solve here was fixed when @matthewmueller changed `.then()` to return a promise: https://github.com/segmentio/nightmare/commit/54f81d3dd9e6e4dad861f749a4a3064e2ce98dd0
bug introduced by: #438
It appears to be pretty random.
Also, for the odd (isn't it?) case when a ms timeout is >= than the optionWaitTimeout, what is the benefit in waiting for a guaranteed failure?
@squirmy , yep it is kind a negative case to have timeout wait value >= the option WaitTimeout i tested :)
lol
abstracts the user from Nightmare's internals.
`app.dock` seems to be `undefined` in CircleCI, which I believe happens when nightmare is run in a platform other than OS X.
@matthewmueller I'm shipping an electron app which uses Nightmare under the hood, and thus a new electron icon is shown in the dock for a while, which looks very awkward.
at Nightmare.<anonymous> (lib/nightmare.js:316:10)
2. Adding Nightmare and Electron actions together makes more sense to me than adding Electron actions alone.  Thoughts?
var Nightmare = require('nightmare');
Nightmare.action('requireSomething',
Nightmare.action('requireSomething',
In other words, it's complicated, and probably too much complexity to introduce when 1) using `require` from Electron is probably going to be rare and 2) passing the path explicitly avoids complication entirely.
Can anybody else have such issues?
https://github.com/segmentio/nightmare
nightmare starting...
nightmare queueing action "type" +5ms
nightmare queueing action "click" +2ms
nightmare queueing action "wait" +0ms
nightmare queueing action "evaluate" +0ms
nightmare running +1ms
Without spinning up a Centos VM, this sounds suspiciously like there's no X-compatible framebuffer running.  Take a look through #224, possible duplicate of #269.
Le mar. 5 janv. 2016 00:13, rosshinkley notifications@github.com a écrit :
>   inside of the Nightmare pipeline. It may also be worth reading #332
var n = new Nightmare;
nightmare running +3ms
- loglevel is great for when you need something light and simple, especially in the browser. That said, switching to it will sacrifice some nice things Nightmare currently has: automatic coloring, prefixing, and timing in log output, plus automatic filtering of loggers by environment variable. That will all have to be re-coded (if we still want it). (Also full disclosure: I wrote loglevel’s multiple-logger support, so I may be somewhat biased in regards to it.)
Any tips on how to tone down the noise? Thanks!
Interesting... I really have no idea what is causing the behavior. I
does that state persist after closing powershell? Thanks for responding,
in powershell and look for the `DEBUG` flag.
![nightmarejserrors](https://cloud.githubusercontent.com/assets/8418137/13235833/73517546-d97d-11e5-98ef-4740b673a5ea.jpg)
enabled in the nightmare package? I'm using v2.0.2. Thank you so much for
"nightmare": "^2.1.2",
└─┬ nightmare@2.1.2
var Nightmare = require('nightmare');
dream = Nightmare();
dream.end();
@erch Are you still experiencing this problem?
Eric
Workarounds of course include writing, rather verbosely,
https://github.com/nodaguti/nightmare-type-issue
You can easily end up with fun stuff like a username set to `userna` and a password set to `mepassword`.  I found that adding a long enough `wait` call between two `type` calls avoids this for now.
Nightmare works fine when we start with...
var Nightmare = require('../nightmare');
var nightmare = Nightmare();
yield nightmare.end();
Hey, can we change proxies on the fly or just on the opening of nightmare?
![](https://cldup.com/KVjMblaitc.png)
nvm: I had an old version.
var Nightmare = require('nightmare');
function *renderInNightmare(url, savePath) {
yield Nightmare()
.goto(url)
yield *renderInNightmare(url, savePath);
Nightmare runner error:
nightmare:actions .click() on #todo-4 .toggle +59ms
nightmare:actions .click() on #todo-8 .toggle +1ms
nightmare:actions .click() on #todo-7 .toggle +0ms
nightmare:actions .click() on #todo-6 .toggle +0ms
nightmare:actions .click() on #todo-2 .toggle +1ms
nightmare queueing action "wait" +50ms
nightmare queueing action "wait" +0ms
nightmare queueing action "click" +0ms
nightmare running +0ms
nightmare:actions .wait() for 200ms +0ms
Nightmare runner error:
Uncaught ReferenceError: __nightmare is not defined
var Nightmare = require('nightmare');
yield nightmare
.type('.gsfi:fist-child', 'hello world')
yield nightmare.end();
Two methods, depending on what you need:
partition: 'your-unique-partition-name'
@dingziran _Great_ question.  I'd suspect the answer to that is not a clear "yes" or "no" - it'd probably depend on how strict the site-in-question's security policy is and if it does any sort of request origin validation.
nightmare.goto('http://www.cnn.com')
url = yield nightmare.url();
yield nightmare.end();
For some odd reason, the path to `url = yield nightmare.url()` gets called instead of an exception being thrown.
url = yield nightmare.url();
yield nightmare.end();
undefined [Error: .wait() timed out after 1000msec]
This is not always happened but also specific page cause it.
new Nightmare({
Ans also "Uncaught ReferenceError: __nightmare is not defined"
partition:"persissdfsdft"//+username
if(nightmare.state==="initial") {
yield nightmare
yield nightmare
partition:"persissdfsdft"//+username
After updating to nightmare@2.1.0 the way the `.type()` method works seems to have changed. In 2.0.9 and before, `.type()` would clear out the element and then enter the specified text, but after updating to 2.1.0, the specified text is typed in, but the existing text is not cleared out. Is this the desired outcome or a bug? If this is the desired behavior, is there a way to delete the text inside an element? With 2.0.9 I could just do `.type(selector, '')` to clear the text from an element, but now that will just add an empty string to the beginning of the value already there.
- a new option to the nigthmare constructor? (`Nightmare({ nativeElectronApp: true })`)
the important difference is that currently if i put nigthmare behind a node cluster it will mean that 1 task = 1 electron process (created by `nigthmare`), so if my application need to do 100 tasks in parallel it will mean creating 100 electron process.. there is no electron process re-use and there is the initial overhead of creating and electron process each time per task.
another advantage gained with `nigthmare` supporting this feature is that the developer can have control of the electron process by itself, so anyone can implement custom funcionality (#391, #373)
yes, that was not my intention :smile: just figure out how to make it run stand-alone.. let me experiment with a run-time condition (detecting if nigthmare is running inside a electron app) and see how it looks!
An issue with Nightmare not running inside Electron just became real.
@bjrmatos hi there!
@matthewmueller I should have been more specific, and the naming conventions are also probably not helping: in `runner`, `parent` is defined as the IPC process.
yield nightmare
so it goes something like this in nightmare:
yield nightmare
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
It works fine by typing `film` inside seacrhbox. electron ui will also show `autocomplete` class ... but iam not able to fetch html contents within `autocomplete` .. is there any ways to fix this?
> Potentially support progress events via nightmare.on('progress', fn) if that's supported
The more I think about this, the more sense it makes, and maybe should redirect my attention to #391.  I was thinking about how to extend the Electron process earlier today, because, well...
Nightmare.action('evaluValue', function*(done, value, cb) {
Nightmare.action('googleto', function(page, done) {
var t = yield Nightmare().googleto('/').evaluate(function(){
var Nightmare = require('nightmare');
Nightmare.action('googleto', function(page, done) {
return yield Nightmare({show: true}).googleto('/').title();
var Nightmare = require('nightmare');
return yield Nightmare({show: true}).goto(url).title();
nightmare queueing action "googleto" +0ms
nightmare running +3ms
var Nightmare = require('nightmare');
Nightmare.action('googleto', function(page, done) {
return yield nightmare.title();
var Nightmare = require('nightmare');
return function(nightmare){
nightmare.goto(url + page);
var nightmare = new Nightmare({show:true});
yield nightmare.end();
var Nightmare = require('nightmare');
//define a new Nightmare action named "foo"
Nightmare.action('foo',
parent.respondTo('foo',
// Do whatever with args here...
var nightmare = Nightmare();
nightmare
I agree with @shadowmint; there definitely needs to be more documentation for passing parameters to custom actions. There's almost nothing in the documentation that I could find, and the actual way you need to do it is not super intuitive - a bad combination.
Also seeing this :rotating_light: When a page fails to load it just hangs forever and never calls waitTimeout
@rosshinkley , Thanks for your info , is that possible to be an issue with Electron? hack way may not elegant, but once you have more insights, please let us know :)
javascript @ VM106:3
allowRunningInsecureContent: true
nightmare.goto('http://www.google.com')
return nightmare.url();
Would it be acceptable to just hardcode `will-download` event prevention in Nightmare?
@pkawiak no problem.  I can't imagine this particular issue is going away as there are already a couple of other open download questions akin to this one.  Plus, willfully not supporting a common browser activity would be sort of silly.
@pkawiak I didn't mean to step on your toes, but I've put together (a hopefully reasonable?) PR #382 to handle downloads.  I'd like to get your feedback. :)
yield nightmare
.headers({ 'X-Nightmare-Header': 'hello world' })
yield nightmare
nightmare
.bind('some-custom-event')
nightmare
//custom event handler
@yoz I thought about this when I was going through this last night, and decided that I'd address your immediate problem first.  I'm planning to look at confirm and prompt as time permits.
Nice catch, I was having an issue making Electron crash and adding Math.round solved it
First time I've wanted to add scroll functionality to this function (to prevent cases when selection is outside visible area), but then I've decided to keep it clean ([YAGNI](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it) principle)
@yhuard :+1:
But it still really confusing if you call screenshotElement and getting a random screenshot back.
nightmare
window.nightmare(myobject)
function nightmareMessage(mixed) {
var nightmare = new Nightmare();
var myobject = yield nightmare
nightmareMessage(myobject);
var message = yield nightmare.evaluate(function() {
nightmareMessage(message);
Can't I utilize somehow `__nightmare.ipc.send` ? (or I am on the wrong track..)
@fentas Ah, I see.  Using `yield` and `evaluate` in this manner probably wouldn't work then. :)
I also take it you're trying to go beyond using `console.log` and the `DEBUG` environment variable?
I think I'm on the same train of thought - I was tinkering with adding user-customizable events to accomplish what @fentas needed and have at least some of the basic mechanics down.  As time permits, I'll see if I can pull together the changes + documentation required. :)
Hah yep, that's a typo. Should be good to go now.
nightmare queueing action "evaluate" +52ms
nightmare queueing action "evaluate" +13ms
I can keep cookies in a file with phantoms.
Since nightmare moved to  Electron, is there any document about how to store cookies so that I needn't to do the login trick again and again.
var test = new Nightmare()
.goto('https://en.wikipedia.org/wiki/Ubuntu')
function (err, nightmare)
var Nightmare = require('nightmare');
var test = new Nightmare({ show: true })
.goto('https://en.wikipedia.org/wiki/Ubuntu')
.run(function (err, nightmare) {
Is there any way to have Nightmare store a csrf token?
![eoscarlist](https://cloud.githubusercontent.com/assets/9448070/11098209/0e8acbc2-8869-11e5-9bb9-e83ee801c464.png)
Also, how to you access GET/POST pages within Nightmare?
recently I use nightmarejs with robotjs for complex test that needed real mouse event.
Hi @matthewmueller , the use case for us is that our application logs messages to error, warn, info, log depending on severity and these are useful to capture in our tests (we're mainly using nightmare for UI testing). I think a nicer implementation would be a generic `console` event which captures all console output but also adds a `type` or similar field indicating the 'level' (dir, trace, info, error) etc.
I started using Nightmare yesterday with node v0.10.36 (no generators) and it seems to be working fine. Am I going down a road that will lead to :broken_heart:?
new Nightmare()
Adding support for download would be important in Nightmare IMHO it's something missing in most headless browser automation solution.
3. I realize that multiple downloads is a _bit_ of a corner case, but a problem nonetheless.  In my sandbox, I have the `will-download` event emitting a `download-start` event, and when the item is done, emitting a `download-done` event from the DownloadItem's `done` event up to Nightmare.  My sample application simply keeps track of the number of downloads in progress and uses (more or less) the same approach as `wait` until all of the downloads are complete.  In other words, it's hacky and works, but I'm struggling to come up with a less-hacked together approach.
var dimensions = yield nightmare.goto('http://www.gmail.com')
yield nightmare.end();
A couple of notes and questions:
There are minor rendering differences for Nightmare on OSX and Linux that are causing [tests](https://travis-ci.org/dbkaplun/domscii/jobs/88532553) to fail. Certain pixel values are off by one.
extraHeaders: 'Accept-Encoding: gzip;q=0,deflate;q=0'
My question is the following, is it possible to change it to phantom headless browser?
.goto(url)
yield nightmare.end();
nightmare queueing action "evaluate" +1ms
I have this issue occasionally. Like a random event
_Somewhat_ offtopic, could this (and #320) also be related to #345?
@rosshinkley i haven't used nightmare in a long time, but yes it was with fat arrow functions, thought it shouldn't have mattered either way because I was transpiling down to es5 before running...
of actions, resulting in flaky behavior and hangs depending on the
transitions to false.
I'm trying out nightmare, and so far it looks like it can be a good replacement for CasperJS.
I did some experimentation and it looks like a combination of Electron event's "will-navigate" and "did-get-response-details" could make this happen.
var login = yield nightmare
The site in question is poorly written.
var postInformation = yield nightmare
.type('textarea#information', 'Hello, this is posted from Nightmare')
var login = yield nightmare
Nightmare.action(
'waitForUrl',
Which meant that nightmare just continued with the other yield's.
var page2 = yield nightmare
.click('a.pn')
at doNTCallback2 (node.js:439:9)
Mac Os 10.10.5
Yeah i am archaic, can you guys provide es5 examples aswell?
In Nightmare v1 there was an option to timeout .wait(), i added this back in to v2
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
var breadcrumb = yield nightmare
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
var link = yield nightmare
.wait('.ac-21th')
return document.getElementsByClassName('ac-21th')[0].href;
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
var expect = require('chai').expect // jshint ignore:line
var link = yield nightmare
.wait('.ac-21th')
return document.getElementsByClassName('ac-21th')[0].href;
There are two ways of getting an exception in Nightmare, one is to inject some "bad" code via .evaluate(), this will stop nightmare and even call done() in mocha. But there is also the issue with already existing code, that has errors, now there is an option to listen for this.
> yield Nightmare()
. no luck at all. is that what it's supposed to do ? give me nightmares ?
var Nightmare = require('nightmare');
yield Nightmare()
1) Nightmare rendering should take a clipped screenshot:
2) Nightmare rendering "after each" hook for "should take a clipped screenshot":
var Nightmare = require('nightmare');
var nightmare = Nightmare();
var n = yield nightmare
.goto(link)
if(/^https:\/\/www\.cordbloodbanking\.com/.test(links[i].href) || /^\//.test(links[i].href)){
yield nightmare.end();
Rahuls-MacBook-Air:nightmare rahuldesai$ DEBUG=nightmare node --harmony index.js
nightmare queueing action "goto" for undefined +0ms
nightmare queueing action "evaluate" +4ms
nightmare queueing action "goto" for undefined +0ms
rahul@rahul-Inspiron-N5010:~/stuff$ DEBUG=nightmare node --harmony nig.js
nightmare queueing action "evaluate" +7ms
undefined
rahul@rahul-Inspiron-N5010:~/stuff$
yield nightmare
.goto(link)
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare.end();
return yield Nightmare()
return yield Nightmare()
Everytime I try to call `Nightmare()` (in any code) it just stop on the function.
"npm -v nightmare": 2.7.4
npm install --save nightmare
var Nightmare = require('../nightmare');
var nightmare = Nightmare();
yield nightmare.end();
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare.end();
nightmare queueing action "evaluate" +5ms
mocha 2.3.3, node 4.1.2, nightmare 2.0.7
It seems to me that using nightmare in a long running/concurrent setup is prone to many errors and can cause all kinds of hiccups.
4. Exceptional exit
3. Handle abnormal exists (such as electron SIGSEGV/SIGBUS, exit code != 0, exceptions)
1. The most obvious one is of course, that the event listeners are registered on `process` (which is _global_) whenever a new Nigthmare instance is created and them not being removed after an instance is shut down.
2. Set a `failed` state on the instance of nightmare such that failure can be detected
As a general note: It does seem a bit unsafe to use `once` on the IPC as a control flow structure without handling exceptional cases...
Is it expected behavior?
If no, is it Nightmare issue?
yield nightmare.end();
``` es6
const objects = yield nightmare
.goto(url)
return 'noop'
i just tried it now (i don't use nightmare for now) and it works !
Untested, but I'm wondering if perhaps https://github.com/kyungw00k/nightmare-webrequest-addon might be of some help. Might be a way in there to listen for certain types of resources and block their loading
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
var breadcrumb = yield nightmare
"chai": "^3.3.0",
"co-mocha": "^1.0.1",
"mocha": "^2.3.0",
"nightmare": "^2.0.7"
Added `mocha.opts`
--require co-mocha
The mocha result:
@segmentio , can you help us, please?
@kuraga did you get the example working, I switched to your suggested `mocha-generators` library which seems to at least output errors. I am not sure why spawning an electron process fails ?
That's something else. Reinstall Electron and Nightmare?
True that's something else, made clean install and now it's working. Actually it seems the original test case should "work" from the test execution part. The only problem is that some of the test steps seems to fail which does not throw errors but instead timeout. This is really annoying problem when you have no clue where the test just broke.
var breadcrumb = yield nightmare
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
nightmare
I wonder if there is any way better for a paste action, so we can do that in nightmare.
Add a comment about the `co-mocha` package, fixes #261
I'm running some basic NightmareJS code on my Macbook and it works perfectly. But when I do the same on my CentOS cloud server on debug mode, I see all actions being queued and then the script terminates without any results. It's like the actual actions are never run.
`Uncaught Exception:
at TypeError (native)
$ DEBUG=nightmare & mocha anonymous.spec.js
var chai = require('chai');
var Nightmare = require('nightmare');
var expect = chai.expect;
var nightmare;
new Nightmare()
Should I open a pull request to at least throw a more helpful error here? Other people might get tripped up by copying/pasting examples online like I did.. :P (Example: http://weblogs.asp.net/mikaelsoderstrom/writing-end-to-end-tests-with-nightmare-js, a top result for using nightmare for testing)
var chai = require('chai');
var Nightmare = require('nightmare');
var expect = chai.expect;
var nightmare;
new Nightmare()
`self` is not used in `waitms`
![image](https://cloud.githubusercontent.com/assets/420754/10215197/a4993186-681f-11e5-9514-86a45bafafab.png)
im using the following code:
import Nightmare from 'nightmare';
var nightmare = Nightmare();
var count = yield nightmare
.goto(url)
yield nightmare.end();
count is always undefined. Anyone know if this is possible?
Hi @toppetoppe, I was having some issues with the loading of XHR/AJAX calls and using the option `show: true` when creating the Nightmare instance helped me debug, as you can see the window and how the page is loading with the console on the side.
var nightmare = Nightmare(opts);
@toppetoppe This has nothing to do with Nightmare, but have you tried running the code directly in the Dev Tools console? Maybe there is another element matching your selector and `querySelector()` is returning only the first one in the DOM.
Yeah, I have retrieved the selector using X-ray and that works just fine, but i would prefer to use nightmare.
Then my only theory is that `selector` might not being correctly passed to the function to evaluate. I wonder if you'd be able to double check this by running Nightmare with with `show: true` and then:
Electron ftw!
nightmare.end();
nightmare.end(function() {});
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.end(function () {});
nightmare
nightmare
nightmare
myPromise = nightmare
Which could then be consumed in a number of ways:
nightmare
And saw that the next action didn't hook up with the previous part of the chain. I think this is why the `.then()` after the `.screenshot()` didn't run. Please correct me if I'm wrong as I'm still trying to get the inner workings of Nightmare.
var Nightmare = require('../nightmare');
var nightmare = Nightmare();
yield nightmare.end();
var Nightmare = require('../nightmare');
var nightmare = Nightmare();
yield nightmare.end();
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare.end();
nightmare:actions .wait() for fn +26ms
nightmare:actions waitfn +0ms
nightmare:actions _evaluate +3ms
nightmare:actions waitfn +254ms
nightmare:actions _evaluate +2ms
nightmare:actions waitfn +251ms
nightmare:actions _evaluate +191ms
nightmare:actions waitfn +252ms
Rodrigo
OK, so I may have gone too far down the rabbit hole:
},sel, attr)
.goto(scraper.start)
for (el in sel){
if(!!q){
},sel, attr);
.goto(url)
var n = new Nightmare();
PS, I'm wondering if I'm violating the purpose of this forum, and if I should post these kinds of help requests elsewhere. I'm really very new to this whole scene, and figured this is probably where people who are familiar with nightmare will be lurking. If I should put this kind of content up on stackOF instead, just let me know :) Thanks for all your awesomeness!
3am jibber jabber, sorry.
I haven't used Nightmare in about a month; I came back this morning, and it seems that a lot has changed, including removing any mention of plugins and .use(). Are they still available to use?
+1, i rely heavily on plugins
This weird Nightmare "behaviour" took me some time to figure how to fix it. Nightmare should have an option for reporting all Electron error or debug messages.
Also i thought that you should set proxy as
You guys have been so great getting to my questions. I'm still struggling up the learning curve with nightmarejs and vo.js and am hoping to get some help on syntax here.
be happy to submit some of the learning process I went through to get up
> 1) vo uses a technique called currying
I am attempting to use NightmareJS to test a Polymer v1.0 application. So far I have been unsuccessful. I assume electron is the problem, but can't access any electron debugging information to verify this. Is there any way to get some feedback from electron while running NightmareJS?
Did anyone else also try this, does nightmare support such use case at all? Thanks for feedback!
var Nightmare = require('nightmare');
return new Nightmare({timeout: 7200000})
test.run(function (err, nightmare) {
Do you have an idea if the problem is somewhere in nightmarejs or in electron? Would be very interested in helping to fix it.
So I'm a big fat liar, no x-ray-phantom module in nightmare. I don't know what I was thinking. Many apologies :)
Help, I broke nightmare :(
Nightmare()
Nightmare
at process.<anonymous> (/home/yoihito/Work/expedite/ls-portal/node_modules/nightmare/lib/nightmare.js:58:15)
var n= new nightmare()
> bit differently:
var nightmare = Nightmare();
var a = yield nightmare
.goto('http://somewebpage.com')
nightmare queueing action "goto" +0ms
nightmare queueing action "evaluate" +5ms
I've tried various other examples from Nightmare < 2 from around the web, and I can't get any of them to work either. Nothing ever errors, I just never seem to get any screenshot, pdf or elements pulled off the page in the output.
nightmare queueing action "goto" +0ms
nightmare queueing action "evaluate" +1ms
Breaking News, U.S., World, Weather, Entertainment & Video News - CNN.com
.goto('https://cas2.northport.com.my/myapp/wa/r/nmbctr')
yield nightmare.end();
nightmare queueing action "goto" +0ms
nightmare queueing action "evaluate" +1ms
Using the shippable container to run nightmare and mocha.
nightmare queueing action "goto" for https://www.taobao.com +0ms
nightmare queueing action "evaluate" +6ms
nightmare queueing action "evaluate" +2ms
# uname -a
Breaking News, Daily News and Videos - CNN.com
xfonts-cyrillic \
libxss1 \
gcc-multilib \
g++-multilib
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare.end();
I have the same problem, I don't know what the cause is yet. I thought it might be in the encoding of the quotes & such but I don't think so anymore. Might be helpful to tail the logs if you know where the xvfb stuff goes (`docker exec nightmare tail -f /var/log/whatever_it_is.log`)
@sriducati did you try using DEBUG=nightmare ? I think there might be a way to alter the verbosity but I can't recall.
@edasque  ya i tried debug mode below is the result...
nightmare queueing action "evaluate" +21ms
nightmare running +3ms
Breaking News, Daily News and Videos - CNN.com
nightmare queueing action "evaluate" +5ms
nightmare running +4ms
I tried with `xvfb` but still the same issue
nightmare queueing action "evaluate" +5ms
nightmare running +2ms
I need to get Nightmare.js running on a remote headless server.
nightmare queueing action "useragent" +0ms
nightmare queueing action "viewport" +3ms
nightmare queueing action "wait" +1ms
nightmare queueing action "screenshot" +1ms
nightmare running +0ms
xfonts-cyrillic \
libxss1 \
gcc-multilib \
g++-multilib
RUN npm install vo segmentio/nightmare
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
var link = yield nightmare
.wait('.ac-21th')
return document.getElementsByClassName('ac-21th')[0].href;
yield nightmare.end();
**msokk** thanks,
nightmare queueing action "useragent" +0ms
nightmare queueing action "type" +4ms
nightmare queueing action "click" +1ms
nightmare queueing action "wait" +1ms
nightmare queueing action "inject" +1ms
nightmare queueing action "evaluate" +0ms
nightmare running +2ms
Air:nm sagi$ npm -l version
nightmare queueing action "evaluate" +9ms
nightmare running +11ms
#1 0x000001af6bab <unknown>
#2 0x000001af716d <unknown>
#5 0x000001af083e <unknown>
#6 0x000001af06a8 <unknown>
#7 0x000002b6e10d <unknown>
@gabrielperales No, I haven't found a solution yet. The next thing I was planning to try is the [Headless](https://www.npmjs.com/package/headless) module, a wrapper for Xvfb directly from Node. But I don't know if it will play well with Nightmare. Let me know if you try it!
+-- nightmare@2.2.0
This is not a nightmare issue but an electron (chromium really) issue. @rosshinkley maybe this should be closed?
FROM node:argon
libasound2 libxtst6 libxss1 libnss3 xvfb
# Start Xvfb
nightmare = Nightmare();
nightmare.goto('http://cnn.com')
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
- Xvfb -ac -screen scrn 1280x2000x24 :9.0 &
"script"      : "Xvfb",
**DEBUG=nightmare\*  Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 & node --harmony app.js**
Centos Version
Do centos work nightmarejs?
@pelhage I haven't used phantomJS since Nightmare decided to bundle electron instead of webkit.  I think there are many reason you should choose Electron instead of phantom's webkit such as but not limited to :
nightmare
.click('._aj7mu._taytv._ki5uo._o0442')
.insert('form input[type="password"]', 'xxx')
// some handlers
However to run nightmare in a docker a few things to keep in mind:
@matthewmueller @rosshinkley  Will this change in Chromium make any difference here?
Nightmare is awesome, and a headless mode (without xvfb) would be very useful! 🥇
> linchang@0.0.0 test /var/lib/jenkins/workspace/customer-client-wx
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
03 03 2017 15:24:47.156:INFO [launcher]: Trying to start Nightmare again (1/2).
at doNTCallback2 (node.js:429:9)
@yoz I doesn't work I have electron-prebuilt@0.36.2 and Nightmare@2.1.2 pointing to electronPath.
@pastawoua at least the `input` or `change` event you dispatch is missing some properties like `keyCode`, etc? it's not certain, and it might probably make something broken
@pastawoua wrote a nice solution that works for me. But if you want to follow the code style, then check this:
.type('input[name=password]', '1234')
@zerkalica Yes, I have a full end-to-end test for my Angular 2 app working using Nightmare. I work around the digest/diffing by `wait()`ing for DOM elements. It works surprisingly well (much easier than setting up Protractor, and less tightly coupled to Angular, too). Eg:
yield nightmare
.goto(URL)
Some patch:
import Nightmare from 'nightmare'
class MyNightmare extends Nightmare {
nightmare
.input('input[name=password]', '1234')
@zerkalica Cool!
var Nightmare = require('nightmare');
yield Nightmare()
import Nightmare from 'nightmare';
.goto('https://cas2.northport.com.my/myapp/wa/r/nmbctr')
yield nightmare.end();
Hi, @idrakimuhamad.
.goto("https://cas2.northport.com.my/myapp/wa/r/nmbctr")
yield nightmare.end();
nightmare queueing action "goto" for https://cas2.northport.com.my/myapp/wa/r/nmbctr +0ms
nightmare queueing action "goto" for https://cas2.northport.com.my/myapp/wa/r/nmbctr +0ms
Running the following code causes the spawned window to be shown for the duration of script. I left `nightmare.end();` out to exaggerate the issue.
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare
//yield nightmare.end();
> myrubapa@myrubapa:~/httpdocs/phantomjs/tests$ npm install nightmare
> > weak@0.4.1 install /home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak
> make: Entering directory '/home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build'
> ../node_modules/nan/nan.h:672:67: error: call of overloaded ‘New(v8::Isolate_, const char_&, uint32_t&)’ is ambiguous
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:31:40: note: v8::MaybeLocal<v8::Object> node::Buffer::New(v8::Isolate_, v8::Local<v8::String\>, node::encoding) <near match\>
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:31:40: note:   no known conversion for argument 3 from ‘uint32_t {aka unsigned int}’ to ‘node::encoding’
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:43:40: note: v8::MaybeLocal<v8::Object\> node::Buffer::New(v8::Isolate_, char_, size_t) <near match\>
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:43:40: note:   no known conversion for argument 2 from ‘const char*’ to ‘char*’
> make: Leaving directory '/home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build'
> gyp ERR! cwd /home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak
> gyp ERR! not ok
var Nightmare = require('nightmare');
var nightmare = Nightmare();
yield nightmare.end();
Only way I can think of atm, is to run nightmare two times. First time to
El lunes, 31 de agosto de 2015, Jure Polutnik notifications@github.com
> Only way I can think of atm, is to run nightmare two times. First time to
Nightmare.prototype._run = function(callback) {
Nightmare.prototype.run = function(callback) {
Is anyone getting this to work?  If so, can you point out the version of phantomJs you have?
Here's a quick demo on how to use [select](https://jsbin.com/becowa/edit?html,js,output) within DOM. However, in `nightmare` you have this:-
@sinkingshriek Thanks!  I'll downgrade a bit and see what I get.
Here is my code:
nightmare
.run(function (err, nightmare) {
I wanna send some test data to KAFKA when using nightmare.
gyp ERR! build error
de-gyp\lib\build.js:271:23)
gyp ERR! node -v v0.10.40
gyp ERR! not ok
Why do I get an exception?
npm install --save nightmare-iframe
So, how can we navigate through iframes with the new Nightmare built on Electron? It seems Electron has no support for iframes.
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.exitIframe();
nightmare.end();
Tryit Editor v2.6
Tryit Editor v2.6
- using plain nightmare (doesn't work): `.wait('[name=card.number]')`
- using `nightmare-iframe`
- using tiangolo's patch
PS. I'm using Electron, I see references above to phantom.js which confuse me even more, because I thought that was for Nightwatch, not Nightmare.
@RichardJECooke here's the summary.
- Initiate your Node / Nightmare project with npm filling the package data:
var Nightmare = require('nightmare');
import Nightmare = require('nightmare');
manageNightmareIframesPlugin(nightmare);
import Nightmare = require('nightmare');
manageNightmareIframesPlugin(Nightmare);
new Nightmare({webPreferences: {webSecurity: false})
Otherwise, an error
Kind of a bummer, as I was hoping to use nightmare as part of a build on our Jenkins server (Ubuntu server 16.06).  Hello there! It seems as if there's no function for removing cookie(s) stored? By any chance could someone add this? I think it would be super useful
That's the one thing I hate @alfonsomga , I love NightmareJS, but there's no functions built-in for manipulating cookies. I'm going to start looking at the NightmareJS code soon, and perhaps I can figure out a way to do such.
@johanneslumpe Unless I'm missing something (a very real, very big possibility), you'd have to use `.evaluate()` to retrieve and parse the cookie names yourself.  Then you could iterate over them and use `.cookies.clear()`.
var browser = Nightmare({
@Mr0grog I don't understand how handle `.cookies.get()`
nightmare
.goto(url)
//now here I want to go forEach with cookies, but how?
@littleguga You can do it the same way you work with any nightmare actions that return values:
nightmare
.goto(url)
I use nightmare for electron and my opinion nightmare for phantomjs was better.
**Soruce Code**
var Nightmare = require('nightmare');
new Nightmare({
nightmare@1.8.2
Source Code
phantom.exit(0);
phantom.exit(1);
phantom.exit(1);
@rclai are you sure? I don't think `use()` gets a chance to modify the nightmare task queue after `run()` has started.
@rclai It doesn't
@abe-winter I think that's pretty useful if you check there's an open pull request for exactly that https://github.com/segmentio/nightmare/pull/59
At the end I just went the trivial way: no flow control login inside the nightmare instance.
Uncaught Error: listen EADDRNOTAVAIL
new nightmare()
.run((err, nightmare) => {
What is the best way to get the content is nightmarejs?(I can see evaluate can help but I think it is not very good solution)
new Nightmare(options)
.goto('http://www.blablabla.com/')
).run(function( err, nightmare){
new Nightmare()
new Nightmare()
.goto(fixture('auth'))
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
new Nightmare()
ϟ test  mocha
phantomjs://webpage.evaluate():3
at SockJSConnection.ondata (stream.js:32:26)
new Nightmare()
new Nightmare()
Hi, I'm new to nightmare and phantomjs.
using the same `nightmare` instance,
I really like how nightmare magically connects to PhantomJS on node but at this point I really need to know how to control this connection for setting cache and other settings too
@fritx @a7madgamal @luatnd Is this still an issue since the move to Electron?
@rclai Definitely! When the `wait` function times out, it emits a `timeout` event that can be handled using the [`Nightmare.on` method](https://github.com/segmentio/nightmare#onevent-callback).  All `.on()` calls must happen before the first `.goto()` so consider it more of a configuration step.
var Nightmare = require('nightmare');
new Nightmare()
.run(function (err, nightmare) {
new Nightmare()
nightmare
TIA
// still works because Nightmare#setupInstance() checks
// TODO this is a nasty hack that may cause other unexpected problems
Nightmare.prototype.oldTeardownInstance = Nightmare.prototype.teardownInstance;
Nightmare.prototype.teardownInstance = function() {
// mocha is finished running
@nylen Thanks for your feedback. After a couple of days I came up with a conclusion that this project is not actively maintained. FWIW we decided to switch to [navit](https://github.com/nodeca/navit) which is designed for testing right from the start.
var nightmare = new Nightmare();
nightmare.setup(done);
nightmare.click('btn--primary')
nightmare
nightmare.teardownInstance();
As for automated tests (with Mocha), this solution fits the bill ideally: async tests work like a charm and you also gain a significant performance boost by instantiating PhantomJS only once per `describe` or even per entire spec.
nightmare .goto() url: https://wordpress.com/post/89812188/2 +5ms
return function( nightmare ) {
nightmare
Nightmare
.goto(url)
.run(function (err, nightmare) {
phantomjs://webpage.evaluate():3
phantomjs://webpage.evaluate():3
nightmare
nightmare
@shri3k @rauchg Is this still an issue?
var nightmare = new Nightmare({ cookiesFiles: "./cookie.txt"});
var nightmare = new Nightmare({ cookiesFile: "./cookie.txt"});
nightmare
.screenshot("./onedrive.jpg")
But how would you go in teaching somebody about nightmare and how to use it? I'm asking because every business owner loves to have automated testing, but training people to do it is a bit of a challenge, unless they are already devs. But especially with helpers like
e) phantomjs
f) nightmare?
Very strange that wait(2000) is executing in 500ms. I see this affecting timing in a lot of places.
nightmare queueing action "goto" +0ms
nightmare queueing action "screenshot" +1ms
nightmare queueing action "wait" +0ms
nightmare run +0ms
nightmare .setup() phantom instance created +752ms
nightmare .wait() for 2000ms +504ms
nightmare .teardownInstance() tearing down +2s
I don't think you can just turn javascript off that easily, I think the way to do this is to list to `resourceRequestStarted` and abort it's network request e.g.
However not sure if that would break the connection between phantomjs and nightmare/phantomjs-node
@petecoop, That's in fact quite possible in `nightmare`. Just did a quick test and seems to me that it's working.
* Enable/Disable JavaScript.
nightmare
.noJS(true)
https://github.com/ariya/phantomjs/issues/10185
Although this is "only" a passion project, I really would like to hear your thoughts, critique and suggestions. Your status page is http://inch-ci.org/github/segmentio/nightmare
at ChildProcess.<anonymous> (/Users/izelnakri/newkamernet/node_modules/nightmare/node_modules/phantom/phantom.js:153:28)
That code was never triggered.
Then [someone mentioned](https://groups.google.com/forum/#!topic/phantomjs/JChUakj--24) onFileDownload, but that also didn't work.
nightmare.evaluate(
It's not very async, but you get the idea.
expecting a high-level api in nightmare
Downloads can be triggered in a number of tricky ways (javascript redirect, iframe, etc).  Being able to plug into the `will-download` event would be huge.
http://www.fangraphs.com/projections.aspx?pos=all&stats=bat&type=steameru
Any idea what might be going on?
i have a Nightmare instance in which i click a button that opens a new window.
Due to the lack of answers i moved to casperjs, it solved all the problems i had and it works nicely.
I wish I understood more on how you are using electron in place of phantomjs. Maybe then I would understand why you say that you don't think it's possible.
```javascript
await nightmare
new Nightmare()
.goto(uri)
//some code
- Sometimes a website with a hashtag in the URL doesn't load
If you call `nightmare.screenshot()` with a `path` which lacks an extension, the function seems to silently fail and not create any file at all.
Look at this https://github.com/Buzzvil/ghost-town
var Nightmare = require('nightmare');
new Nightmare()
.run(function(err, Nightmare){
nightmare queueing action "goto" +0ms
nightmare queueing action "type" +5ms
nightmare queueing action "type" +0ms
nightmare queueing action "click" +1ms
nightmare run +0ms
nightmare .setup() phantom instance created +2s
nightmare .type() mypassword into input[name="password"] +23ms
nightmare .click() on .pure-button +13ms
nightmare .screenshot() saved to test3.jpg +0ms
Iam new to nightmarejs. i have one requirement like reading some data's from browser and put it into file.I really don't know where to run and what are all the tools  needed.can any one help me for the same.please provide the beginners link if any. Thanks
As seen with `DEBUG=nightmare`:
nightmare .type() Lydia into input[name="firstname"] +503ms
nightmare .type() Homenick into input[name="lastname"] +4ms
nightmare .type() Hessel_Jeanne@Herzog.com into input[name="email"] +17s
nightmare .type() New Frances into input[name="city"] +24s
More experiments:
nightmare .type() passwordz into input[name="password"] +7ms
nightmare .click() on button[type="submit"] +21s
// Monkey patch for https://github.com/segmentio/nightmare/issues/126
if ( ! ( 'heartbeat_delay' in options ) ) {
var Nightmare = require('nightmare');
var instance = new Nightmare()
.wait('.signin > a:nth-child(2)')
.click('.signin > a:nth-child(2)')
Maybe it's the internal nodule:phantmjs's problem.
var nightmare = new Nightmare();
nightmare.goto('https://github.com')
I just tested with  wait(selector),  not good:
mocha:suite bail undefined +0ms
mocha:suite bail undefined +4ms
mocha:suite bail undefined +1ms
mocha:runner globals ["ArrayBuffer","Int8Array","Uint8Array","Uint8ClampedArra
mocha:runner globals [] +3ms
mocha:runner start +1ms
Nightmare
nightmare queueing action "goto" +0ms
nightmare queueing action "click" +0ms
nightmare queueing action "wait" +2ms
nightmare queueing action "visible" +1ms
nightmare queueing action "type" +1ms
nightmare queueing action "type" +1ms
nightmare queueing action "click" +1ms
nightmare queueing action "wait" +1ms
nightmare queueing action "visible" +1ms
nightmare run +1ms
nightmare .setup() creating phantom instance with options {"timeout":5000,"int
nightmare .setup() phantom instance created +892ms
nightmare .click() on a[href="/login"] +504ms
nightmare .visible() for div#login +615ms
mocha:runner finished running +55s
mocha:runner end +1ms
nightmare .type() asdf into #login_username +505ms
nightmare .type() xyz into #login_password +0ms
nightmare
nightmare .click() on #loginbutton +25s
nightmare .wait() for 500ms +25s
Very odd.
nightmare .setup() phantom instance created +3s
nightmare .type() bob333@gmail.com into input#id_email +111ms
nightmare .type() password123 into input#id_password +3ms
@rosslavery If you are still having this problem revert the `exports.type` method
@reinpk do I need to contribute something to revert this change, or would you like to do it? I'm tired of pulling from a fork of Nightmare just because of this small issue
In other words, changing this:
nightmare
nightmare
Imo, casperjs has some cons:
- a lot of weird behaviors
casperjs have also some pros:
- fast, realy fast / Selenenium
Hi @lambtron,
I think we don't need to make another testing library (casperjs'one was a mistake from his creator opinion) but maybe we can work on how to ease the use of major testing libraries (mocha/chai/jasmine/jest) with nigthmarejs.
Like you, I don't want a big API but many useful middlewares: if nightmare offer same features as casperjs I think we wont release after the 1.1.x anymore /c @n1k0
phantomjs://webpage.evaluate():2
phantomjs://webpage.evaluate():3
phantomjs://webpage.evaluate():3
When i tried with DEBUG=nightmare prefix, I get this :
nightmare queueing action "goto" +0ms
nightmare queueing action "type" +5ms
nightmare queueing action "click" +0ms
nightmare run +0ms
nightmare .setup() creating phantom instance with options {"timeout":5000,"interval":50,"weak":true,"loadImages":true,"ignoreSslErrors":true,"sslProtocol":"any","proxy":null,"proxyType":null,"proxyAuth":null,"cookiesFile":null,"webSecurity":true} +0ms
nightmare .setup() phantom instance created +192ms
nightmare .click() on .searchsubmit +9ms
phantomjs://webpage.evaluate():3
phantomjs://webpage.evaluate():3
nightmare .teardownInstance() tearing down +21ms
Have a great day and keep up the good work! :octocat:
<title>Nightmare not lading fonts - DEMO</title>
font-family: Oswald;
<h1>This should be written in Oswald.</h1>
This looks like this when viewed in Safari:
And like this when captured with nightmare:
Looks like it's a Phantomjs issue:
https://github.com/ariya/phantomjs/search?q=web+fonts&type=Issues
@dzignus if you need all the CasperJS API, the best way will be to use ... CasperJS.
Yep, that's the point, my opinion is that many people are using Nightmare as a replace of casperjs, for that many are demanding features like my example of above.
@reinpk @sperand-io ?
var Nightmare = require('nightmare');
nightmare.goto('http://www.yahoo.com')
I just upgrated nightmare  and run mocha tests.
https://circleci.com/gh/segmentio/nightmare/168
nightmare
@bahlo I don't see what's the problem with testing the clipRect method.
@bahlo Oh great can't wait to use it xoxo. Sorry if I sounded rude and for my impatience .
var nightmare = new Nightmare();
nightmare.goto('https://accounts.google.com/SignUpWithoutGmail?service=youtube')
nightmare.clipRect(rect, './rect.png')
.run(function (err, nightmare) {
var nightmare = new Nightmare();
nightmare.goto('https://accounts.google.com/SignUpWithoutGmail?service=youtube')
.run(function (err, nightmare) {
'Accept-Language': 'de'
var Nightmare = require('nightmare');
var nightmare = new Nightmare();
nightmare
Gecko) Chrome/41.0.2228.0 Safari/537.36')
Note: This issue initially came up when using Nightmare 1.6.0 with async 0.9.0 (https://github.com/caolan/async).  There's an example at https://gist.github.com/gwintrob/67e44b851d435509097b, but the underlying issue seems to come from using multiple Nightmare instances.
I also have an problem with `async`, maybe they're somewhat related (if not, I'm happy to create a new issue).
new Nightmare()
.goto(url)
.wait('#my-elem')
Hmm , having issues since 1.6.3. With a single Nightmare() instance, i can only do 1 .run() operation, the second .run() will result in EADDRINUSE .. Not sure about why , will hopefully write an isolated test case for this tonight, but it seems it's trying to create a new phantom instance (listening on the port provided in Nightmare constructor options ), but the old instance hasn't been fully discarded yet ..
Awesome , but now if we provide a port in the options when constructing the nightmare instance , that test fails ..
I'm running Nightmare through grunt-mocha-test with Chai assertion library.  This works great part of the time but if a test fails for some reason all subsequent tests will timeout.  Also, if the initial test fails, it seems to fail silently, and finish by timing out, rather than calling the `done` callback.  I know some of this behavior is mostly likely related to Mocha/Chai integration, but is there a teardown issue with the Phantom Instance potentially causing all subsequent tests to a failed test to timeout?
If you switch to an older version of Nightmare you will see the behavior I'm talking about:
@kevva @reinpk
and instantiate nightmare the same way
`new Nightmare({phantomPath: phantomPath})`
.goto()
[pseudo-code...sort of]
global var2 // bar
new Nightmare()
some code
console.log(param1 + " " + param2);  // foo bar
nightmare
nightmare
.goto(url)
var Nightmare = require('nightmare');
goCards = new Nightmare()
.type('#gift-card-balance-content-pin', "MYUBERSECRETPIN")
I think timjacobi might be right.  Is there a workaround that I can use in the meantime?  Maybe something like:
new Nightmare()
.click('#gbqfba')
I've been working on a fork of nightmare, and I've included this. The syntax is slightly different, but if someone wants to nightmare-ize the code, it should be fairly straightforward.
Updated nightmare's package.json to phantom 0.7.0 and all tests passed. However, I don't have phantom 2.0 as that thing would take years to build on my box, and pre-built packages aren't available yet.
@reinpk what exactly do you want to happen. I think they look better that way.
var Nm = require('nightmare');
.screenshot('httpbin_org.jpg')
.screenshot('gfycat_com.jpg')
`twitter_com.jpg` will become a black image.
var Nightmare = require('nightmare');
new Nightmare()
@ryanmcdermott this is just "wrong".
However the code you added is inconsistently formatted in regards to itself. Sometimes you put spaces inside parentheses `if ( foo == bar )` and sometimes you don't. When submitting pull requests, you should make an attempt to match the coding style of the project you're contributing to.
new Nightmare()
new Nightmare()
This request's git history is fubar. I'm going to close and reopen with a new pull request.
B) how to execute nightmare
http://zachlatta.com
https://github.com/zachlatta
https://twitter.com/zachlatta
http://zachlatta.com
https://github.com/zachlatta
https://twitter.com/zachlatta
`phantom stdout: XMLHttpRequest cannot load http://localhost:12301/dnode/info. Cannot make any requests from null.`
new Nightmare()
phantomjs://webpage.evaluate():4
phantomjs://webpage.evaluate():4
nightmare queueing action "evaluate" +0ms
nightmare run +5ms
nightmare .setup() creating phantom instance on port 12301 +1ms
This could definitely be an issue with `phantomjs` on 10.10, but any ideas?
Oh, it could also be because I'm running `2.0.0`:
@mariodu The problem lies in a package that nightmare depends on.  I have created a ticket under that project here: https://github.com/sgentle/phantomjs-node/issues/208
@fernandopasik are you sure the problem isn't in your code?  I'm not finding "x.options" anywhere in nightmare or phantomjs-node.
Fork: https://github.com/dtothefp/phantomjs
var nightmareOptions = {
--javascript injection
var Nightmare = require('nightmare');
nightmare
phantomjs://webpage.evaluate():8
phantomjs://webpage.evaluate():8
which would allow something like this in the nightmare chain:
nightmare
I can't seem to figure out a way to do this without dropping down to raw JS for that alternate flow in an `evaluate` -- which kind of defeats the whole purpose of using this abstraction. I thought about adding the control flow in the callback used in `run()`, but it seems that the `nightmare` instance returned as the second argument there has already been deconstructed, meaning I can't queue up any further interactions with it.
var nightmare = new Nightmare();
if ( nightmare.exists("input") ){ //returns true/false synchronously
// do something else
nightmare.close();
It'd be a major change, and I know forcing synchronicity on Node may make some people grab their pitchforks, but I think it would make Nightmare easier to use.
https://github.com/petecoop/phantasma
> https://github.com/petecoop/phantasma which uses Promises to handle the
> https://github.com/petecoop/phantasma
nightmare
var Nightmare = require('nightmare');
new Nightmare()
.click('button#gbqfba')
at SockJSConnection.ondata (stream.js:51:26)
In the [simple api](http://www.nightmarejs.org/#simple-api) section of the website, the code formatting(?) is converting the double-quotes to &amp;#x201d; (ironically enough, not 201f for the opening quote) and the apostrophes to &amp;#x2018; and &amp;#x2019; in the code snippets.
nightmare.run();
Nightmare()
var val = nightmare.metadata.value
return function (nightmare) {
Nightmare.prototype.agent =
Nightmare.prototype.useragent = function () {}
I ran into a scenario where multiple Nightmare instances would be spun up at the same time, but in separate node processes, and found that the ports were colliding between the two processes.
new Nightmare()
nightmare
new Nightmare()
return function (nightmare) {
new Nightmare()
.run(function (err, nightmare) {
which doesn't make sense, right? It should first report the `1` and then it should invoke the callback from `.run()`. Right now it's the opposite. Couldn't figure out why though.
There are some major problems with node-phantom:
hacks.
new Nightmare()
alexscheelmeyer/node-phantom#83
new Nightmare()
.goto( './pulse/jasmine/specrunner.html' )
new Nightmare()
}, noop, 'test')
new Nightmare()
new Nightmare({
Nightmare()
