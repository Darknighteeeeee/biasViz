prettyPrint(new ABRecord());
// => Immutable.Record "ABRecord" {a: 1, b: 2}
prettyPrint(new ABRecord());
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
*bug*?
When deleting something from the global `window` scope during 2 test runs, the behavior is different when using for example Node.js `7.4.0` _(2nd test passes)_ and `7.9.0`/`7.10.0` _(2nd test fails)_.
https://repl.it/IVBE/7
Jest: `19.0.2` and `20.0.4`
@ljharb ah.. i see. Yeah, that might be a bug.
This PR replaces Jasmine with `jest-circus`
- The API is exposed in `jest-circus/src/index.js`
3. Extensibility.  Because we don't have control over Jasmine, adding features to it is pain. Snapshot functionality is built on hacks and monkeypatches. And every new feature is harder and harder to add (we have a plan to introduce interactive snapshot updating). But with FLUX architecture all we need to do is to add another handler. e.g. snapshot logic looks like this right now:
const {addEventHandler} = require('jest-circus');
@pedrombafonso move `identity-obj-proxy` to `moduleNameMapper` and it will work.  Run with --no-cache flag once.   thank you!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
@Damine0n do you mind signing the CLA?  you fixed them all! :)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
(i ran a spellchecker on Jest source code comment blocks)
function useSinon(mySinon) {
mySinon = sinon.sandbox.create();
mySinon.restore();
let mySinon;
useSinon(mySinon);
mySinon.stub(...);
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
cc @wtgtybhertgeghgtwtg  closing for now  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. https://xkcd.com/327/ I can understand that it may be confusing. I also think "Bobby Marley" is funny. I'll miss our little Bobby Tables though, farewell!  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
```bash
Assuming `upstream` is the name of original Jest remote.
```diff
+++ b/packages/jest-runtime/yarn.lock
randomatic@^1.1.3:
This is probably the most annoying bug that i was never able to reproduce :)
To: facebook/jest
Subject: Re: [facebook/jest] Can I configure "Your test suite must contain at least one test." so it not a failure? (#3558)
Bug
**Repro**
See following issues for details:
When publishing Jest 20, this was quite the funny error on CI ;)
So please complain less, read more, and be grateful for all the time OSS community spends on building better software and fixing your issues for free. If this is something that would have helped you save some time, feel free to send them a PR with these adjustments, I'm sure they'll appreciate :)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
// stuff
Highly unstable solution, but it works:
As a side note it might be good to add canonical/hreflang tags to improve search engine indexing. At least a redirect from non-en to en might be helpful since these pages are now already indexed and users who come from there will still land on these pages _(the sidebar isn't fully rendered there for some reason)_.
Looks like a regression after rewriting our Jasmine bindings.
To: facebook/jest
* this diff:
That's DOUBLE the speed, wow.
This has one behavior change:
jest
Here is an alternative:
// string
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
jest
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
This PR adds Localization support for Jest.
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
packages/babel-jest/src/index.js
jest  **Summary**
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
jest
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
To: facebook/jest
(To clarify; I'm saying that requiring "it"s to be unique makes no sense and runs counter to the entire point of BDD-style test frameworks like jasmine, jest, and mocha)
To: facebook/jest
* I'm a bit unsure why the yarn lockfile changed in jest-runtime, that's odd.
cc: @bestander
jest
cc @abdulhannanali  Bunch of comments but feel free to merge it after one more iteration. Please don't forget to document the reporters option in the docs and adding "Available in Jest 20.0.0" like we do for other things (Like the expect.resolves API). I left a few comments inline. The one missing piece is that the `<rootDir>` replacement and proper resolution using `jest-resolve` (we do this in normalize.js for all other fields) must be added, otherwise resolving reporters works differently from every other config option. Mind adding that? Alright, good to go.  This should be pretty straight-forward change in `babel-jest` package, so I'll tag it as "Good first task" :)  **Summary**
Date.now = jest.fn(() => 1490760656000);
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
@cpojer any special reason, why we're doing this?
cc @thymikee @zouxuoz
jest  **Summary**
cc @abdulhannanali
Subject: [facebook/jest] Can't access Discord (#3277)
I'd like to join the Jest discord chat, but the chat link on the bottom of the page doesn't work for me.
Is there some trick to getting on the Jest chat ??
I'd like @wtgtybhertgeghgtwtg to have a look. Closing in favor of #3267  this is likely related to some other packages that were updated (istanbul, babel)
**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! @orta do you mind looking at this? thank you!
cc: @gaearon @zouxuoz @rogeliog  @dmitriiabramov if we don't have breaking changes in master, we could roll v19.1 release. üéâ
On Mon, Apr 3, 2017 at 5:42 PM YULONG SONG <notifications@github.com> wrote:
> import Apis from '../Apis';
www.abramov.io
With every promise. `expect` throws an Error, so you either have to catch it with returned promise, or with `done()/done.fail()` callback, since this is an async test.    hm. i'm not sure if we can do this right now, but i'm sure we can have it after the custom reporters work is done (https://github.com/facebook/jest/pull/3064) and when @wtgtybhertgeghgtwtg replaces jasmine :) You can use `testResultsProcessor` for this.  thanks @danharper!
Thanks @jwbay.
cc @chenglou
console.warn = jest.fn(warn => {
‚óè lol
CI green
To: facebook/jest
hey @mrharel
sorry, i'm not familiar with dynamic requires.
To: facebook/jest
so in the jasmine hook that you used it will be:
false,
// do wathever the default jasmine behavior is
this way whenever we kill jasmine (it is happening) we can still reuse the logic and it'll be fairly independent.
'abc'
'cde'
Difference:
This is how I print custom message assertion message:
And more complex matchers:
To: facebook/jest
"jest": {
"runInBand": true
The lack of this feature may potentially confuse other developers on my team who attempt to run the jest tests without being explicitly aware the tests are dependent on the --runInBand flag being present, thus observing a broken test suite.
jest.useFakeTimers();
jest.runAllTimers();
anyway, right now it is still in `global` so we should probably add it here We will remove this global. We don't officially support it. We are diverging from Jasmine to build a better test runner. The current set of globals that is in our documentation is the only official interface. Anything else may change at any time.  @aaddaamm does this help?
The logic controlling watch mode is inside jest-cli package (watch.js file) so you could start from that place. I imagine we could add another key listener and invoke a function which will spawn asynchronously one of these commands, depending on OS: open, xdg-open, start. As an argument you'd pass a path to coverage directory (from config).  Yeah, now that we collapse usage, I'm not super opposed to this. We can show it only if `config.coverage` is true, as well. @anilreddykatta this is because `coverageDirectory` was not set explicitly and defaulted to "coverage"   Test pass because nothing throws inside `it`. UnhandledPromiseRejectionWarning is a warning, not thrown error. And it's probably problem in your code. This blog post should help you with tracking the root cause: http://2ality.com/2016/04/unhandled-rejections.html  @thejameskyle could you review? Please hold off on this, let's not change around the licenses until we're sure we're doing the right thing. It's been confusing in other situations to have multiple licenses within a single repository so there may be some other way of peacefully resolving this. I will follow up with folks offline.  unfortunately it's not possible now because that will be very very hard to implement.
Test Suites: 1 failed, 1 total
i'm really happy that istanbul is finally moving to monorepo! :)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
Ideas welcome! Then I strongly recommend the watch mode üòÑ. I like the idea of `notifyType`, but just thinking it can be too much. I wonder if anybody uses "Run again" option from notifications.  @mikaelbr did you have any suggestions for this?  @wtgtybhertgeghgtwtg can you weigh in?  @rogeliog mind looking at this? @timjacobi I think that it's an interesting point.
Jest needs to support different platforms when it prints its output (terminal, nuclide, html, terminal with no color support, snapshots)
type JestFormatedString = string;
type JestPrintUtils = {
dim: (input: string) => JestFormatedString,
const jestFormattedString = `hey, i'm ${green('green')}. and i'm ${red('red')}`;
console.log(jestFormattedString);
JEST_UUID_TAGS: {
Which then would go through Babel to output something like this:
$$typeof: Symbol.for('JEST_FORMAT'),
Error: expected value to be (using ===):
<received>"foo"</received>
https://jsfiddle.net/fjfuabya/ @kentaromiura that looks amazing!
Error: expected value to be (using ===):
// jest's copyright header
// Jasmine license.
Adds Deezer to the list of jest users.
![20-multi-runner](https://cloud.githubusercontent.com/assets/13352/23987088/ff3b9ec8-0a6a-11e7-8e36-bf4e04ec6a49.gif)
* `cd examples`
* `jest --experimentalProjects */ --no-cache`
More TODOs:
Todo:
TODO:
* Make modules in `jest-jasmine2` generic so that the setup-pieces can be shared across test runner adapters.
* Build a complete replacement for Jasmine.
cc @MarcoWorms  @jeanlauliac mentioned it would be great if Jest could come with a kick-ass fs mock out of the box.
* Ships as part of Jest, no configuration.
(As for sockets/HTTP, that'd be amazing to be able to create a completely virtual network of machines and being able to test client/server interactions, etc.)  thanks @ErnestoLCortez!
you should run `jest` with `-u` flag
dabramov-mbp ~ node
undefined
I would like to add two thoughts:
@mpontus @okonet you can use `jest@next` where it's fixed or otherwise you need install `babel-polyfill`.
@wtgtybhertgeghgtwtg is already making some awesome work to make that happen.
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
@dmitriiabramov I don't like that this test is testing private properties in the first place :( @cpojer agree! but it does the job! :)
although an integration test should be enough here @cpojer If you don't mind me asking, I read this yesterday http://blog.thecodewhisperer.com/permalink/integrated-tests-are-a-scam . Are they really a scam?  People have strong opinions on how to write tests. I recommend ignoring them and just pushing forward by working on making testing actually easier. People can have opinions on top of what we do, but it shouldn't discourage us. @abdulhannanali i actually really like this talk, but unfortunately it is very biased and focuses only on one side of the problem and ignores the rest. For people who are just starting to test this talk can give a very wrong idea I'll close this one for now. Please reopen or send a new PR when this becomes current.  Yeah this sounds good. Would you mind sending a PR for this? :)  @dmitriiabramov Interesting stuff would love to take a look into it and help resolve this bug. This seems to be an issue probably with jest-resolve or jest-mock. However, I'll definitely give a shot at resolving this.
cc @wanderley who's been working on jest-resolve  This is really super awesome. I didn't expect that we could find such an elegant solution not just for `toThrow` but for all matchers. Nice!
* `await expect(banana).resolves.toBe(‚Ä¶)` ‚Äì your proposal.
* `await expect(banana).resolves().toBe(‚Ä¶)` ‚Äì explicit function call.
* `await expect(banana).<insertProposalHere>.toBe(‚Ä¶)` ‚Äì is there anything else we can come up with?
@Phoenixmatrix you are actually making a good point. What is the incremental value that is added when doing something with one of the more complex matchers. For example returning a mock function from a Promise and calling
// vs
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
Integration tests for custom reporters are work in progress.  The first custom reporter is going to be a Nyan Cat, as it's trivial to implement @thymikee I am interested in knowing how we can add a better validation check for the Reporters being imported, @dmitriiabramov  In a Test Suite, Can we consider the the fullPath of the test as the value for the `classname` and `package` attribute within tescase and testsuite tag.?  Not adding it in this PR as @dmitriiabramov suggested, but here's the initial version of XUnitReporter written to be used a Custom Reporter. Any feedback is welcomed. https://gist.github.com/abdulhannanali/6560aa5f53e65ca3cf92fb9ad0836d02 . I was going to push this too, but thanks to @dmitriiabramov  for pointing it out that it should be a separate PR. One of the major concern I need to clear out is how the path resolution for the reporters will work. I am currently working on Integration Tests for Custom reporters and for this purpose I am writing a simple reporter, which just checks if the whole integration of reporters work fine. @dmitriiabramov The Reporters in the Jest extend from a BaseReporter, but in Mocha the biggest difference is that the BaseReporter is responsible for keeping track of the whole progress of the tests within it's stats object while the BaseReporter within the Jest is just exposing two more methods and removing the `preRunMessage`.
We can even remove the BaseReporter. However, it has a few advantages, as the code in the TestRunner would break if the reporters don't implement all of the methods on the base reporter. Also, we can additionally check in the code if the reports are inheriting from BaseReporter, adding kind of a validation check, but we definitely need a way to expose BaseReporter to the application.  @abdulhannanali super excited you are working on this! Would you mind also including the Nyan reporter example in this diff so that we can see what it may look like? We should make sure that the API that Jest exposes to add reporters is actually useful and won't change too often. Btw. there is also this proposal: https://github.com/js-reporters/js-reporters ‚Äì I'm not sure if we should integrate with this. @cpojer Thank you for sharing this `js-reporters` proposal seems quite nice of Qunit team. Something similar also came up in my mind after seeing the Mocha's Test Reporter interface, which is based on an EventEmitter, instead of calling methods on a class.
I am trying this `_validateReporter` approach, let me know if we need this here. Interested in hearing your thoughts about this. Thanks a lot!
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
roots: [
jest
After the change:
This change has a side effect:
`yarn jest`
run `jest --json` and look for `jasmine`
// jest-environment-*
Uses Yarn for lerna: https://github.com/lerna/lerna/releases/tag/v2.0.0-beta.38
pictures!
jest
if you run exactly the same test suite then it's indeed strange! is it an open source project that i can look into?
hey @Yayuro!
‚îú‚îÄ‚îÄ __mocks__
To: facebook/jest
Thanks @wyze! Thanks for helping out on Jest.  cc @mikaelbr Closing this from the Jest side. Thanks @mikaelbr for working on this!  You are right. Do you mind removing "browser: false"? It doesn't really do anything and confuses me :)
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
Also, Jest 18 didn't have this feature in the first place, did it? Oh sorry, I was in an "old" master üòû
cc @zouxuoz  I like that idea, it sounds really interesting  I agree that the testNamePattern still needs more exploration to find the best UX What about hiding it form _Watch Usage_ prompt until we make it work flawlessly? It would still be there but just hidden, because it's like still experimental feature? Yeah, but it still tells you how to exit :D Or, maybe it makes sense to change the wording?
Makes babylon parser the default for jest-editor-support, create a second package that contains the code for the typescript parser
Feel free to adjust the description
cc: @cpojer
Biggest Jest release ever. @rogeliog and @thymikee wrote this blog post.
``` Stellar work @zouxuoz. This really makes the developer experience a lot better when people use Jest for the first time since an upgrade.
Thank you @amasad!  This doesn't happen for core modules, like `fs`. You have to manually call `jest.mock('fs')` on them. They don't exclusively work for node modules. They also work for haste modules which is Facebook's custom module system.  **Summary**
cc @bestander
But you can still nest `__mocks__` whatever you like.  **Summary**
yarn test @orta you are the native speaker. Mind sending a PR with better wording?  Duplicate of #1874.  This is not a bug, it's intended behaviour and it tells you exactly this. You can however require the module directly from a mock implementation. Exactly, you should use require within your mock implementation. Think of the function you pass to `jest.mock` as a separate module factory as if it were in a separate file.  This should be a three column layout:
cc @leebyron can you help us out a bit? What's the best way to find out whether a value is from immutable.js and what type it is without explicitly requiring immutable.js? @cpenarrieta the way you test for Immutable is totally OK.
require('Foo');
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
As a workaround run `jest -u` in these dirs:
examples/react-native
// Jest Snapshot v1
and then validate Jest and throw if the snapshot version doesn't match, like:
``` @anilreddykatta no, it's a version that we define in jest-snapshot, like:
To: facebook/jest
expect('coca cola "yoko \\son (*)\d o".').toMatchSnapshot();
jest
cc: @cpojer @vjeux
And I'm thankful for your work, it's great. Hope we'll get to merge something from you in the future üôÇ  Keep getting knowledge while you're motivated and make it a habit so you can keep doing it when motivation passes :) wow our travis queues are really fucked. I'm gonna merge this and deal with a fix on master if necessary.  sweet!  Which version of Jest was that? @Matzielab would you mind providing a repro or a PR with failing test?  closing as duplicate.  You can do "transform: {}" in Jest or customize your transformers.
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
``` @cpojer I'm not sure that I understood, aren't they achieving the same thing?
```javascript
```javascript
Although it would be a breaking change.
```bash
```bash
Another solution could be to add a "__resetForTest" method to your native module that resets it in C++.  Unfortunately this is most probably problem with your user (or process like `node`) permissions, not with Jest.  As a workaround you can create the directory manually or with some kind of script with right permissions.  This works for me also on mac os. It may be an odd ubuntu thing, @avaly do you mind investigating further? works for me on slackware64 14.2 tried with both node 6.9.4,  and 7.5.0 :-/  Yes, we are doing that going forward (waiting for a website push) to Jest 19 and beyond, we won't be doing it for older versions.  Thanks for sending a PR!  Would you like to send a PR to fix this? :)  Your regular expressions are intersecting with each other, so e.g. `assets/test.png` will match both. One of them will take over and hence the behaviour.
expect(randomCoolNames()).toEqual(
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
cc: @pedrottimark who might be interested as well good work!  @thymikee is the architect you need to convince. I'm for separation of concerns, especially if it's reasonable, but `normalize` is actually used in couple of places in `jest-config`, so I'm not sure what's the benefit here? Or maybe I'm missing something? No worries! I love all the work you're doing to get rid of unnecessary code in Jest ‚ù§Ô∏è   Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
* People mis-use testPathDirs to limit the tests they are using but it shouldn't be used for that, renaming it to roots.
jest finally managed to find some time to fix things here.  **Summary**
TypeScript is a 20Mb dependency of editor-support, this should allow using editor-support without TypeScript and not incur into any penalties.
cc @orta
value: 'kappa'
**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions.  Doesn't it work right now? I think we don't strip comments while transforming, so `istanbul` should receive the information. Yeah!  <!-- Thanks for submitting a pull request! Please provide enough information so that others can review your pull request. The two fields below are mandatory. -->
jest
This may be tricky, because lots of folks out there are using `babel-preset-es2015` which transforms to regenerator under the hood.
`console.log` never prints unless jest is run with `--verbose` mode. That can be very confusing when trying to debug a failing suite.
// jest-jasmine2 or wherever
* Moving `expect.addSnapshotSerializers` to jest-jasmine2.
- [x] [Redux](http://redux.js.org/docs/recipes/WritingTests.html) Here's great @kentaromiura post about Vue.js integration. So good! https://medium.com/@kentaromiura_the_js_guy/jest-for-all-episode-1-vue-js-d616bccbe186#.d573vrce2 @abdulhannanali you're more than welcome! @thymikee We can include Redux's Documentation part [Writing Tests](http://redux.js.org/docs/recipes/WritingTests.html) as it prefers Jest for JavaScript Testing. However, It uses enzyme for testing React Components. I've also tried it couple of months ago without luck, but will try to tackle it some time soon, although I'm not so optimistic. We'll see!  This is how jasmine behaves, I'm afraid this is a wontfix for now. btw cc @dmitriiabramov who wants this changed.  Pretty sure that's not a Jest issue. Can you provide a repository with a repro? maybe something is wrong with the regex.  This is not possible, Jest transforms when a module is being required (like "require('Foo')") which has to be synchronous.  Isn't this related? https://github.com/facebook/jest/pull/2467 Are you able to provide a minimal repro for this case? Thank you!  Dude, this code is mixing so many of `beforeEach` and `beforeAll` in different contexts that I'm not even sure which should be invoked when.
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
'summary'
'nyan-cat',
@thymikee what do you think? To me, since it's `stringMatching` not a `stringContaining`, it implies that is should be rather a RegExp or glob match.
But I'm not convinced this should be a part of Jest.
this should definitely work if you are using babel-jest.
* Measure the time it takes to run the first piece of Jest ("runJest") and bring that down.
We should focus on reducing the amount of dependencies that are shipped with Jest. Is there somebody that could do an analysis? ah, it sucks that all of these are transitive dependencies and that we don't really have much control over it. note-notifier dropped the cli: https://github.com/facebook/jest/pull/2718 Nice! Nice work, thanks @wtgtybhertgeghgtwtg for working on this and getting back with more data :)  The changed files only mode is "best-effort". Sometimes Jest cannot accurately predict what the dependency graph will look like. In this case, I think you might have either had a local change that triggered this (like a change to Radium or something) or that there is some other confusion.  @dmitriiabramov is this the issue you had with babel and bigger files? That message should be unrelated and is coming from babel. It seems like there is an issue with your code here and without a repro (a github repo that can be cloned and `npm test`ed) we are unable to help. @thymikee should not be related.
// A.js
// B.js
jest.resetModule('A');
jest.doMock('A', () => 43);
Jest was not matching any tests when the pattern was a directory
Jest will automatically adjust slashes based on OS. @dinukadesilva any updates?  Thank you!  You should pass a `done` callback because this is async code
**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. @eskimoblood we're in the middle of rewriting docs. Can you please check if its already fixed on `new-docs` branch and if no, address this PR there? Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks! Please send it against the new-docs branch. We'll merge it into master any day now.  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
I've add a small configuration that should enable to change the parser if in the future we or someone else needs it, as well as the plugin array @orta we are still getting the missing @flow annotations on test files :( Once danger support is solid it would be nice to add it to the lint script in the package.json. Nice! I think we are getting closer to something we can ship! :) @bookman25 is right, Snapshot should be exported in index.js. :( Feel free to bring back this pull request and address all the outstanding comments, we are more than happy to merge it! :)  I'm generally scared of supporting these things because `getOwnPropertyDescriptor` etc. is really really slow over things like "Object.keys" and in 99% of the cases it isn't what people want or expect.  `jest.fn` creates a new function every time. It seems like you made a mistake somewhere with your memoization function. Note that this is not a help forum; please ask on stackoverflow or on our discord channel. You can also create a repro here: https://repl.it/languages/jest and share that to stackoverflow or discord.  Running Jest with `--bail` will prevent other test _suites_ from executing.
jest
This is kind of critical for Jest's ongoing success.
jest
Also nothing prevents you to create `test` and `test-integration` npm scripts, running different configs with `--config` flag. @kentaromiura talked about this before, it's similar to snapshots: find a way to record remote data through Jest. @reggi can you design an API that makes sense either within Jest or as a third-party module?  I think it is time for emoji. We should double down on üÉè. I think üö´ and üöß are specifically nice for `jest-validate`. We need to detect windows (see "Yarn") because it doesn't support emoji and add a --emoji flag (so it can be disabled through --no-emoji).
üèÉüèª‚Äç‚ôÄÔ∏è RUNS
Where do you think we could add emoji in a way that they aren't annoying yet provide good signal for what's going on?
‚ö†Ô∏è Jest Deprecation Warning
‚ùå Jest Validation Error
``` I think emojis are great add could add a delightful touch, but I agree with @thymikee on the places that might make sense to add them... I'll try to hack a prototype to see how the experience feels and post a gif of it I think it's overkill to add it instead of PASS etc. but I think showing the üÉè on a successful run is cool :) It's 2017.  _crawl should be super fast if you have watchman installed: it will only look at the delta of the filesystem since the last time you invoked Jest. I'm curious how your idea would work: when would we reconcile changes in the file system. One simple example is adding a test file, before the haste map is built, we don't know which tests are available in the system so we need to wait for the haste-map to be built completely to know which tests to run.
Can we make the following changes:
@cpojer what do you think? > But it won't be high on our priorities list I guess.
@cpojer why would we do that? The problem is that function names are not reliable and they also aren't visible in the real user output. It's like testing a private function of a module ‚Äì if it is important, you should expose it somehow.
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
Hey! Thanks for your PR, it looks pretty good however I feel like this is overly complex from a design perspective. Right now, if you'd like to use multiple results processors you could create a third processor that uses composition to bring the other two together. I believe that's the better approach and with Jest 18 where the results processor requires to return the modified value it will work better. I'm happy to reopen this if you can convince me it's better to turn this option into an array as generally singular values are always more problematic than array configurations.  This is by design. We do exactly what node does here and that is requiring JSON files by stripping BOM and calling JSON.parse on it. That is true. Mainly because there haven't been any use cases to modify JSON files. I'm not opposed to it, just saying it is not a use case that benefits us at Facebook so we'll relying on the community to fix this :)  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
File names are taking up different number of characters which results in the divider(`>`) being in different position in each row. I feel that this makes is a bit hard to glance at the results and identify where does the test name start. I have no idea what is the best way to solve this, it could be something like https://github.com/facebook/jest/pull/2568#issuecomment-278302817 or other ways to deemphasize the file names cc: @cpojer
![flickery](https://cloud.githubusercontent.com/assets/574806/22858830/a13a2724-f07d-11e6-8258-bfc351b47140.gif)
This is awesome work @zouxuoz. There are definitely ways we can make this even better but I think it is ready to be merged. We can do small follow-ups to make this really solid ‚Äì looking forward to more of your contributions. If you don't mind, please send me your email address: cpojer@fb.com so I can invite you to our jest-core chat.  you need to do this:
jest.mock(`Picker`, () => {
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
// Do my own custom stuff.
How do we upgrade that? Thank you @amasad!  rebase pls. I'm gonna wait for CI this time.  `lodash.includes` should be an explicit dependency of the `package.json` file in the danger folder.  This seems odd, why is your file name so long? Can you set a "name" field in your Jest config or package.json? If there is no name in your package.json or config, Jest has to find a way to identify what to use as the cache key. The only thing we have available at that point is the path to the project. If you send a PR that hashes that, I'm ok with it. I'd prefer to hash the path. Package names may not be unique (maybe you have two checkouts of the same project).  **Summary**
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
@cpojer what do you think?
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
So, this is pretty large diff, I know. I'll try to guide you here a little @cpojer.
* I think it is time for emojis. We should double down on üÉè. I think üö´ and üöß are specifically nice for jest-validate. We need to detect windows (see "Yarn") because it doesn't support emoji and add a `--emoji` flag (so it can be disabled through `--no-emoji`). I'll create a task for that, let's do it in a follow-up and not in this diff :) I decided to change the `options` a bit. Since the errors and warnings are quite generic, most of the time users of this package would change only titles and footer, hence new options:
titleError: 'Custom Error',
titleWarning: 'Custom Warning',
I also decided to go red with errors, as it looks more obvious that's something's wrong is going on and looks far better on light-themed terminals.
Dark theme:
For this issue in particular, I agree it is an odd setup but if npm isn't giving us the necessary information, we'd probably have to do something hacky to get to the real command. I'd also like to call out that we don't print `yarn test -u` yet because we have no code to detect yarn yet. @xjamundx is there any particular reason why are you using `npm start test.server` command? `npm start` is intended to just run `start` script. `npm run test.server` should be used instead and in this scenario, Jest works correctly.
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
I understand a bad patch release of a transitive dependency can break your entire test suite and that is unfortunate. The reason we are unaffected of issues like this at Facebook is precisely because we are using yarn lockfiles and an [offline mirror](https://yarnpkg.com/blog/2016/11/24/offline-mirror). Version updates are always explicit and run through our entire CI system to make sure they are safe. If you are scared of patch or minor version updates breaking your product, I suggest fixing it in a similar way. I'm open to listen to actual workable solutions to this problem and especially pull requests that don't compromise how semver is supposed to work rather than expressing your disappointment. @bcoe thanks for the perspective, this is much appreciated. I think running `yarn test` inside of the Jest repo *may* have caught this; I guess it shouldn't be too hard to verify.
jest
The failure message is a bit confusing:
Difference:
Comparing two different types of values:
Comparing two different types of values:
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
- Double quote escaping was overzealous and also escaped single quotes
- Regex escaping didn't escape all the control characters that should be
"this \" is a quote"
`this " is a quote`;
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
But having --no-status, or --no-interactive would still be great to have  Thank you for your pull request and welcome to our community. We require contributors to sign our Contributor License Agreement, and we don't seem to have you on file. In order for us to review and merge your code, please sign up at https://code.facebook.com/cla - and if you have received this in error or have any questions, please drop us a line at cla@fb.com. Thanks!
As to why this happened in a minor, here is what happened:
we now have `clearMocks` back.
</thead>
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
@hramos for documentation support: Can you add this to the new-docs branch? Also afaik is possible to pass an array by repeating the `--collectCoverageOnlyFrom` multiple times, some tools that generates it programmatically might prefer that way, honestly I don't like it too much.
For the `__proto__`, that's the official ES2015 way to specify it.
Alternative fix for #2457.
jest passes on node 7.3 again.  Let's wait for @cpojer or @dmitriiabramov to leave a comment on the topic. yeah this looks like a bug and it would be good to create a failing test for it. Yes please! :smile: There's a CONTRIBUTING.md file in the repo, which should point you in the right direction. For the repository and check it out   Is this a request for `pretty-format` package or Jest diffs? Feel free to send a pull request. We aren't taking feature requests for pretty-format like this. You can use `min: true` option to display Array in a single line
Just updated to node 7.3 and it seems indeed that logging is broken in that version using jsdom. Ugh, that's annoying. Maybe it is a regression in node that needs to be fixed? @italoacasas thanks. I created an issue here: https://github.com/nodejs/node/issues/10492 but I'm on vacation right now and don't have time to create a more succinct and detailed repro. :( I put up an alternative fix that's a bit simpler based on @dairyisscary's comments. It simply uses a non-strict module to set the console. This is a bit hacky and I expect this to break again in the future but it seems to me like this is a node/vm or jsdom issue as console should definitely be assignable or at least writable through `Object.defineProperty`, no? I realized this doesn't just expand to `console` but also applies to `setTimeout`, `setImmediate` and all other timer globals. I applied the same hacky fix for now to make sure Jest works again and will publish 18.1 shortly. @dairyisscary thank you so much for this PR and figuring out all these issues. I went ahead merging my own PR, which also fixes this issue for timers in node 7.3 and is a bit more minimal. Publishing 18.1 now but I'm hoping that this can be fixed in node or jsdom properly soon.  Hey @benweissmann thanks for catching this!
I'll create a new issue just for that.  @afaayerhan this regex is correct and can be copy-pasted into your config.
Although the whole expression is wrapped in extra parentheses, which may cause confusion if copied "too fast".
throw new Error();
But this is not a relevant issue to discuss it, you can post your ideas elsewhere.  Upgrade to the latest version of nodejs, please. It's a known issue in node ~7.3.  In the new-docs branch there is an entire guide about snapshot testing and at the bottom we added a few practical links. Would you mind sending a PR against that branch and adding the video there? :)  This should already be fixed in the new-docs branch where we are auto-generating this :) Thanks!  We are rewriting the website docs on the new-docs branch. If you feel like this is still applicable, would you mind sending a PR agains that branch? Thank you!  Hey @sapegin, this is already addressed here in this issue #2166.  No worries! :) Actually this was a different issue and we fixed it in 18.1.  The workaround makes sense to me. You are loading an html file, and Jest interprets it so you either need to mock the file, transform it or make sure that code is not run.
``` @hramos what is your node version?  i just tried on node@4 and yeah. it broke.
Snapshots
module.exports = () => 'banana';
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
* warn/throw if both testGlob and testRegex are given.
jest
Don't forget we have these views as well:
It seems like that would cause the first snapshot overwritten with the second and reporting one snapshot as obsolete. Seems like we need to change this to make sure names are unique when we store them and throw otherwise? yeah, that makes sense! And if it does fires twice per key it should throw in the second matcher; that way we never get two snapshots with a potential collision in the first place. @gaelduplessix thanks for editing your post to reflect what I was going to propose ;)  but now flow is unhappy! Thanks for pushing this through. I'm a bit worried still about the parsing; at FB we don't have a `.babelrc` for example. I think the way to go for this is to add a method `parse` to the transformers like `babel-jest` to allow hooking in a customized parse function. I was also wondering whether `babylon.parse` can read `.babelrc` files automatically just like babel.transform does?
(I got a bit confused by the Twitter poll and what everybody referred to as ‚Äúhighlighting‚Äù.)
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
Test Suites: 2 passed, 2 total
I'm unsure whether this is a Jest issue tbh. We aren't doing anything to pause or close any streams so I'm unsure what's happening here.
see https://twitter.com/cpojer/status/806235376058712065/photo/1 for an example of how `arc diff` looks once integrated into Phabricator. cc @ide is this something you are interested in trying out to see if it works with your version of phabricator? This seems to have a lot of flow errors. To unblock shipping 18, I did the extraction in #2332. Can you rebase on top of that? Thanks flow, I've forgot to add a file to my previous commit with a very little change to bypass that flow error, rebasing right now. I think we can make this more efficient and less hacky, back to you for another iteration :)  This is not actionable. Can you provide a repository that shows this issue? Jest does not support requirejs. If you'd like to support it, you'll likely need to build your own transformer that injects requirejs like functionality into specific files.
@cpojer anything else you'd like to add?
Set `setupFiles`, in Jest config, e.g.:
If we special case Promise, should we also add special helpers for other primitives and built-ins, like `mockMapReturnValue` or `mockBooleanReturnValue`? Unless there is a strong reason why we need to increase the API surface here that I can't think of, I'd prefer to keep these helpers in userland. I'm going to close this for now ‚Äì thank you for starting the discussion and sending a PR. Feel free to continue the conversation and convince us why this is needed :) Yeah, that's a good point. However, the difference between `fn.mockReturnValue(Promise.resolve(value));` and `fn. mockResolveValue(value)` is very minor. I'm in favor of changing jest-mock around with a lot of shortcuts for things that make sense but as it is, this doesn't really simplify the API enough to warrant adding more surface area.  Feel free to send a PR for this. I don't think worker-farm supports the notion of ids but you can add the state in `runTest` here: https://github.com/facebook/jest/blob/master/packages/jest-cli/src/runTest.js @evantahler are you interested in implementing this? Sad to hear that üòû. If you have some time to point out what we could make better, please file a new issue for that. Feedback is always welcome!  Yes, this is because we are rendering using react's `test-renderer` which allows to bottom out at string based components. We don't have access to native components so we need to render to strings, instead of a native View, we render to a "View (string)".  The API Reference is missing some definitions:
**If you are contributing on behalf of someone else (eg your employer)**: the individual CLA is not sufficient - use https://developers.facebook.com/opensource/cla?type=company instead. Contact cla@fb.com if you have any questions. Thank you for signing our Contributor License Agreement. We can now accept your code for this (and any) Facebook open source project. Thanks!  Thanks for your contribution @pugnascotia, much appreciated!
Thanks for reporting! It's already known bug, we discuss it here: #2059 Unfortunately, it's still an open issue. There are but workarounds, which you can check out in #2059   @dmitriiabramov any ideas on why is this happening?  The hanging means that you aren't tearing down your resources properly at the end of the test run. Use afterAll or afterEach to do that. The hanging suggests otherwise. You can use `--forceExit` if you are absolutely sure but Jest doesn't leave any network resources or similar open after testing. Potentially but it seems like an istanbul issue, you may want to file this there. Might also depend on your node version? Try upgrading node and removing all your node_modules and reinstalling. ok, closing here because it isn't actionable from our side. Ahh, nice!  Instead of enabling automocking, can you try disabling it and calling `jest.mock('aws-sdk')` explicitly? Does that work? We aren't currently investing in improvements to the automocking system. I suggest disabling automocking and explicitly mocking `aws-sdk`. If you are interested in a PR for this, please take a look at jest-runtime and how it handles mocking. Yes, automocking is disabled by default. We'll still have the ability to automatically mock modules using the same system but even at Facebook we are moving away from automocking by default.  Thanks @rogeliog for the thorough explanation. It is correct, we don't mock core modules by default because it is very rare you'll want a mocked version of them. `jest.mock('fs')` is the way to go. @cpojer @hramos this should definitely land in the documentation yeah that's a good point. I'm not sure where though :D  Thanks @pedrottimark for pointing to the duplicate!
* Split jest's watch feature into a separate package and refactor it.
doesn't `<rootDir>`'s value has a slash at the end already though? Everywhere throughout the project `<rootDir>` is followed by a slash, so I don't think so, but I don't know everything about it. It passed here but this cannot possibly be the fix for the segfault. Thanks for fixing this, though :D  Expose the `testResultsProcessor` option on the cli
Finally, I am gonna put the hammer down a bit on "power-assert". I think it is way too crazy as a default. I don't wanna do anything to prevent you from using it though and you should already be able to, no? If no, then that should be fixed separately. We spent a ton of time making failures look really good and helpful this half and while we could bikeshed forever, the status quo is pretty and gives good signal.
however, when using assertion like this:
let foo;
~ @cpojer
simply tweak clear codes and check 'em in different envs
```diff
I'm happy to add more, granted it isn't going to slow down the normalization process more.  What about `Object.defineProperty(store, 'doOneThing', {value: jest.fn()})`?  This seems like a Babel issue.
```diff
// .jestrc
"jest": {
what value does it serve?
‚îú‚îÄ‚îÄ __mocks__
const applieModified = apple.eat();
* Fix insane clowniness in static analysis.
Is there a reason you cannot use Jest's lovely output?
* Jest is retaining information or the vm context after a test has completed in a process and the test data has already been sent back.
If you have any ideas on how to improve it further, please do so in separate issues üôÇ   Thank you! Can you make the same change to react-native here: https://github.com/facebook/react-native/blob/master/jest-preset.json#L4 ‚Äì we are actually merging the preset into react-native at the moment! :)  How are type errors thrown by the TypeScript compiler? If it throws a type error on a file, Jest should catch that and show it inline. If the type error is thrown in a file that hasn't changed, Jest will not compile that particular file because it has a transform cache based on when files change. If that's the case, I'm afraid there is nothing we can do except for you to always run with the (slow) `--no-cache` option. Feel free to send a PR to change the TypeScript example to use `ts-jest`. Indeed, TypeScript support is not "official". You can use any transformer and TS is just one of them ‚Äì the problems of showing type errors or source maps etc. are entirely on the transformation side and Jest merely provides hooks for these things. That would be incredibly slow as we'd have to recompile everything on every run. Jest caches transform results.  Closed related issue: #1877. Moving discussion here @scwood.  @migomipo have you managed to solve it?
```javascript
The first step could be to merge the pieces of resolve that we need into jest-resolve, then get rid of the "browser-resolve" module and then update the whole thing for performance ‚Äì all of this can happen in individual PRs. @yanivefraim looks like this was added in node-resolve v1.2.0: https://github.com/substack/node-resolve/commit/c2cbdddcc2aa1c427ccd8a7c1784c745093f836f
cc @gaearon  üíú * Let's halve it every time. No need to waste cpu cycles.
in our `.babelrc` we have `es2015-destructuring` but we don't have `es2015-spread`, i'm not sure what exactly `[...Arrat(10)]` is, so i just rewrote the breaking code using `for` loop :) nice work @dmitriiabramov. I'll publish a new release this week.  Is there anything that prevents you to await this code in `beforeEach()` hook? We'll not be adding this for now as the complexity isn't really worth it. The recommended solution is to create a test utils file and use it like so:
Are you using Jest at Buzzfeed? Ok I see, yeah that makes sense. I encourage you to just go with @shanewilson's workaround then.
hey @khejing
het @browniefed
This will be in the next Jest release as `expect.assertions(number)`.    Duplicate of #1652.  Hi @albertolive, would you mind providing a reproduction of your case? Ideally you could set up a separate repository with a single test causing this issue There'a an open issue for that in Istanbul's repo: https://github.com/gotwarlost/istanbul/issues/735, which I guess is better place to discuss the issue.
@acateland your example is valid too.
This deduping would likely go into https://github.com/amasad/sane
are you sure you are using babel-jest 18 and jest 18 together? Please let me know if you have a consistent repro in a repository on github and we'll fix this.  @gre can we close the issue then? So this is apparently possible with extending `haste` configuration (a node modules resolution mechanism used by Facebook and it's not quite documented here) and resetting `coveragePathIgnorePatterns` as it defaults to `["node_modules"]`.
"jest": {
What does your Jest config look like?
Oh, so when you overwrite "transform" in any way, babel-jest is not automatically being used. Should we change that default?
unclear, this is probably not a Jest bug ‚Äì if you can make this repro consistently and can share it on github, please show me!
That's odd. Do you have watchman installed and are you on Mac OS Sierra? Can you check the bottom of #1767?
It's hard for me to understand how this could even be possible in JavaScript. Which is why I'm worried: there might be a larger issue of `refs` not being passed, or cleared at the wrong time.
Hey @jsomsanith!
Currently snapshots have known problem with escaping single `\r` character, which is being inserted in 2 of your icons ‚Äì `talend-arrowright` and `talend-arrowleft`. As a temporary solution, please remove `\r` from those icons if possible.
export JEST_USE_BASENAME_FOR_CACHING="true"
$ jest
What you think? It's a sort of hack or it's ok?  :wink:
"!src/foo"
@EnoahNetzach what if someone have same names for app module and module from node_modules?
"autoMockingPaths": [
import _ from 'lodash';
"autoMockingPaths": [
#### auto mocking... wait!
may be just introduce special value for `automock`? at least it will not break people's configs
To: facebook/jest
Can you confirm this is happening for you on projects that are not react-native?
That is of course because it is `jest.resetAllMocks()` and I didn't use the right name in the documentation.
undefined
* replacing `node-haste` with `jest-haste-map` in RNP.
@matryoshcow @davidaurelio
jest
hey @iamchenxin
Our version of jasmine is actually a fork. We have comments in the code though, if you can preserve them, the test should keep passing after the upgrade.
bug
What is the expected behavior?
this definitely sounds like a very interesting thing to add and I'd be happy to support this in Jest. I don't think we'll be able to spend time on this ourselves at the moment but is this something you are interested in building?
Does this still repro in Jest 19?
Long standing "bug" in Jest that was confusing to people and required them to run with `--no-cache` once.
cc @taion @kentcdodds
jest
cc @domenic in case he knows whether there is another way.
jest (+ will add an integration test)
Somehow this doesn't work.
hey @Kamaraju333!
Can you try to update Jest? We published a patch to pretty-format that should fix this.
The problem here is the istanbul coverage transform which makes functions anonymous when it shouldn't :(
@0xR can you not do `jest.resetModules()` and then re-require your modules?
Test Suites: 4 failed, 4 total
yes. this was always a very dangerous thing.
I didn't really realize that there was a "test-summary" reporter that does exactly what we do in Jest. I send an alternative PR in https://github.com/facebook/jest/pull/1999 that simply removes our custom printing and always uses `test-summary`. It's a little less pretty but it's also less code and the info comes directly from istanbul without having to do anything special :) Thanks for your contribution and for making me aware of this.
It just looked at it, the test run should certainly complete in less than a second. This is really odd.
Closing for now as I don't think this is actionable. If there are issues in Jest that we can fix, please comment here or send a PR and I'll reopen this issue.
Jest does require a ton of modules, yes, but normally that shouldn't take more than ~10ms. The paths very much look like the node_modules folder wasn't deduplicated, which is really odd. You should only have `jest-*` modules on the top level of your node_modules folder. Would you mind wiping away node_modules and installing Jest again? @apieceofbart can you try `testEnvironment: "node"` in the config? The 2s overhead is odd; I'm assuming it is because of loading jsdom.
@wez any idea why watchman might point to the homedir instead of the project's folder?
which throws before calling `expect`. The closest try-catch block is somewhere in Jasmine that will mark the test as failed.
I'd recommend trying again with Jest 17.
but this API doesn't really look that good.
jest.debug('write something only if it fails');
hey @biphobe!
in Jasmine, matchers don't throw and let the test continue execution with a failure at the end.
hey @Alivejke!
what version of jest are you using?
we rewrote this matcher completely as we are trying to kill parts of Jasmine that we don't like :)
(Jest in open source also comes with its own require implementation, not just at FB.)
3. Check if Foo.native.js exists
5. Last attempt: Foo.json
oh hello, @LegNeato! Good to run into you.
I don't think I'd like to support this weirdness in the module loading that `node-forge` does. I recommend building a manual mock for it or sending a PR to the maintainers of `node-forge` to provide a better versions that uses CommonJS properly. This will make it work with Jest automatically.
it would be cool to have a separate package (`jest-awesome-matchers` or something) that provides all those neat things that you could just plug into jest
it's complicated because there's no easy way to pass an array through yargs and we have to pass a serialized json instead :(
`yarn link jest-cli`
Unfortunately that's a problem in istanbul: https://github.com/istanbuljs/babel-plugin-istanbul/issues/63
@orta I'm totally happy to support this if you send a PR. If the data is big and takes a lot of time to calculate, I'd prefer it to only happen with the verbose flag. Otherwise, if it's quick to compute and not that much more info than we already have, feel free to expand the existing `--json` behavior with all the information you think is valuable. We can then discuss on the PR about specifics :)
@pavloko Your repro on Jest v15 works fine. You can easily migrate to Jest v17 by replacing `scriptPreprocessor` with:
this diff is amazing! super excited about this feature
BTW, I appreciate your help on investigating that so much, thank you! Sure I have tried that and it indeed worked for me (but didn't check in the inspector). I need to find some time to test it better in Jest, because last time it was a really quick check, where I could miss something! @jakubzitny thanks for sharing your story!
I'll try to make this issue a priority for the next couple of days. The difference is probably that in mocha, everything is within one context. In Jest, every test has its own context and is isolated from each other. It seems like it creates some cycles that can't be GC'd, unfortunately. UPDATE: I'm not yet sure why, but just tested it on latest master build with and without `babel-jest` and the leak is gone, so it was probably somewhere on our end. This was fixed accidentally with this commit https://github.com/facebook/jest/commit/8256904751d85e16909152ddaf8395d7c2b60eba and I have no idea why this works, seriously.
Anybody have any ideas? Maybe it's some kind of weird edge bug in Node. I wish this was that simple. Try running `env.dispose()` in the next tick and see the results. This is weirder than it seems It will land in Jest 19. We plan to release it in a week. This should be fixed now for the most part, right? :) I apologize. I forgot to merge https://github.com/facebook/jest/pull/2755 into the release (honestly I thought I did), it will be part of the next release. No, there is no fixed release schedule here. There may be one next week. Can you try `jest@next` for now and see if it helps?  @cpojer's time off mainly. Although there's a chance we could roll out 19.1, but @dmitriiabramov is the one to decide. @mlanter @jedmao I encourage you to debug your tests with `--inspect` flag for Chrome Debugger and try to figure out where the leak may come from (it's likely something in your tests). To simulate slow CI environment, you can throttle the CPU a bit:
@cpojer do you have an idea what could go wrong?
This seems like an npm problem, not a Jest problem.
It looks like the issue is in how mongoose/mockgoose is used.
SyntaxError: Unexpected token )
i tried to debug it and stress test with multiple concurrent writes and wasn't able to reproduce. What i noticed is that it almost never happens on hot cache. What happens on our CI servers is that we get this failure on the first day after we check in a new test, and then it goes away after a few days. This is unrelated. It seems like lodash-es is not compiled to ES5, therefore you need to either import regular lodash or whitelist lodash-es so Jest can compile it with babel or other compiler of your choosing, look here for details http://facebook.github.io/jest/docs/en/tutorial-react-native.html#transformignorepatterns-customization Oh, sorry then!  I'm unsure whether this is an issue with Jest. I'm not very familiar with rxjs. How does Observable deal with thrown errors in a test? `expect` in Jest throws directly so you need to handle that and call `done.fail`.
Hey, sorry, I've been busy with Yarn (see https://code.facebook.com/posts/1840075619545360 ). I'll look at this soon.
The reason we disabled it wasn't just node but also istanbul which doesn't guarantee that function names stay the same when it adds coverage transformation. If you can get them to fix that, I'm more than happy to add an option back. Otherwise I'm afraid it will always cause trouble and I'm not excited to support something that is half-broken half the time.
While working on adding tests to my application [Mady](https://github.com/guigrpa/mady), I thought that the snapshot workflow may improve if the snapshots could be reviewed _graphically_, especially when they are created (but also after updates). This would not replace, but rather _complement_, a careful review of the text-based snapshots, which obviously contain more information.
Beyond the scope of this PR, but related:
@suchipi Thanks for the feedback! Regarding PNG snapshots, I think they can also be a useful tool, but I believe a browser gives you a lot of flexibility. Not only you can have the same "at-a-glance" impression on whether your snapshot is utterly wrong (a _smoke_ test), but you can also open up the DevTools and explore its internals: invisible/transparent divs, CSS attributes, dimensions, accessibility properties (including `title` attributes for tooltips), etc.
@cpojer  I'm using standart terminal app
I'm happy to support this in Jest but I want to get some input from @gaearon first. Also, how does this behave on windows? Do we need to do a platform sniff and print different things or will this work on both?
- Remove `.babelrc`
@difelice does it work if you provide the argument `--collectCoverageFrom` twice (with different arguments)?
@maiis @difelice is right; `collectCoverageFrom` shouldn't contain `rootDir`.
Which version of react-native are you using?
Yes, `testPathDirs` is actually a different name for "roots". We should really rename this and fix it. Jest only looks in folders that are called "testPathDirs" and it doesn't look anywhere else.
@jasonmerino try `jest@test`
You also need `jest-react-native@test`
this issue happened to me after upgrading react-native to 0.38 and react to 15.4.1
@Richard-Cao you've mention that on your local PC all is fine, and it breaks on CI server. May be it because You have case-INsensitive FS on local PC, and Linux FX is case-sensitive? Sorry for triple comment.
If you'd like to use the new features, try out `jest@next` :)
- If you like chai, you can upgrade to Jest and continue to use chai.
This should work in `jest@next`. Would you mind trying this out?
Which version of Jest are you using?
jest
Now it's able to mock `arrow-style` components aka `stateless components` aka `lambdas`
the API i was thinking about is
Hmm.. this is very odd. Jest should always escape quotes. Would you mind letting me know which systems all your engineers are using?
* This will remove the obsolete snapshot, write the one in `test.only` and use the existing value of the third snapshot because the test wasn't run; that third one will not use the proper escaping mechanism. Unfortunately since the way we encode/decode strings currently, I cannot think of a good way to fix this :( cc @dmitriiabramov had an idea. The problem is that we rely on pretty-format to escape quotes in strings, like `"foo\'bar"` but these go away when we require the file as JS. When we write a snapshot file, we use the data from pretty-format of the real value (passed to `expect`) so everything is escaped properly. When we write a snapshot file with data we read from a snapshot because we don't run the test that generates it, we don't have the data from pretty-format. This is also affecting @pieterv and myself if that's of any use :) @vjeux it's not, but thanks! Can you fix it? :) @jlongster when a snapshot file is written (either through -u or a new `toMatchSnapshot` call), we take all of the values passed to `expect` and call `pretty-format` on them and write a completely new snapshot file. When a test is disabled, we don't have the generated value so we use pretty-printed string from the snapshot file, which is what is causing the problem here. @vjeux is actually investigating a fix right now :) Seems like I might a bad call with regards to escaping. This will be fixed in Jest 19 thanks to @vjeux. It's a breaking change for snapshot and we'll try to message it appropriately.  Are you using create-react-app? Jest should exit normally assuming you clean up all your resources.
Why dogscience? I can publish a new version of jest-react-native anytime. As long as semver works as expected and the rc version will also include the actual release, this should be fine, no?
var elem = document.createElement('div');
cd react-jest-bug-repro
git checkout jest-bug
npm test -- JestBug
@cpojer Do you have a Sierra? Have you tried 6.6.0 on it?
A few other _possibly_ related threads:
@gaearon I'm using node 6.6.0 on Sierra with watchman and everything is fine.
Usually when this happens it is a sign to restart the computer. This happens frequently at FB too (unrelated to Jest) :(
@hmeerlo watchman is a file watching service built by FB to make file system operations faster. Jest will run much faster on a big repo if watchman is installed and it brings the startup overhead of Jest to practically nothing as it will only statically analyze files that have changed.
watchman version
interesting. this is definitely an issue with instrumented code.
@seethroughtrees  can you confirm that it works when you run it without `--coverage` flag, or with `collectCoverage: false`?
this is very, very strange then.
those are definitely some kind of coverage instrumentation
case /* istanbul ignore next */(++_cover__().s['5'], 'SORT_POLL_BY'): /* istanbul ignore next */++_cover__().b['1'][0]++_cover__().s['9'];
that is causing an error.
thanks for investigating @seethroughtrees!
right now `fail` comes from jasmine, but we might drop support for in in the future versions
@mandysimon88 is that a third-party library that provides `.equals` method on its classes or a custom code?
toCustomEqual(received, expected) {
flow + jest
cc @hzoo this might be interesting to you.
Updated lerna; made a test more consistent.
jest
@alansouzati that happened to me a few times and using `-i` helped.
the reason this was happening was conflicting subprocesses that i spawned from my jest tests. after switching to `-i` there was only 1 subprocess running at a time and it fixed the issue. It was not reproducible locally as well
I think it's because of code instrumentation
``` diff
`jest`:
Degugging:
I think this issue comes from **istanbul**, I can investigate it tomorrow
Yes, this is istanbul.
Related issue: https://github.com/gotwarlost/istanbul/issues/699
``` diff
``` diff
segments={
However, this is a hack...
in theory it should be possible for istanbul to keep the names of most of the functions using only static analysis, right?
How can it be?
const Banana = () => {};
It works fine when you aren't using coverage but when you do, here is what istanbul does to your code:
const Banana = (__cov[‚Ä¶], () => {});
console.log(Banana.name) // empty
and then jest add a condition to the `extendJasmineExpect`
// do all the extending magic
alternatively we can either introduce `--no-expect` flag or `--no-globals`
@suchipi let me know if it works with chai snapshots!
@suchipi we can probably just add another dependency injection here
I added this ugly special case a while back when we didn't have great react-native support. Now we don't actually need this any more as I expect the community to fully switch over to the preset.
the react-native example still passes.
jest
jest
@suitupalex you can also probably just do `Object.defineProperty(window.location, 'href', {value: 'http://my.website.com', configurable: true});`
Also cc @gaearon because he requested this feature. Try it out!
@gaearon you are saying that any existing command should cancel if a test run is active?
![jest-interrupt](https://cloud.githubusercontent.com/assets/13352/18941777/cb0176dc-864e-11e6-90f9-96921bb47650.gif)
Happy to reopen if this turns out to be a Jest issue.
Have you considered switching graphql to Jest? :P
hey @thangngoc89!
you can pass a testRegex directly to cli
@cpojer , with help of @kulshekhar we came to the conclusion that it is, in fact a problem with Jest.
https://github.com/kulshekhar/jest_bug_test
For now we don't support source maps in babel-jest so I'll close this as wontfix but if transforms become more advanced some day we'll reconsider adding support for them to show more accurate stack traces.
cc @mxstbr
please rebase and then merge. LGTM.
In particular I‚Äôm not sure why [this function](https://github.com/dmitriiabramov/react-boilerplate/blob/09250fa870cca05a80ff8d45b50d234e5873a848/app/containers/HomePage/tests/sagas.test.js#L85-L91) (presumably being the reason for this PR?) is a generator. It doesn‚Äôt `yield` anything, does it? Are there some special semantics I‚Äôm missing?
password: 'foo'
@vjeux is helping out to make this a reality.
* Remove the dependency on jasmine: #2389
* Move asymmetric matchers from jasmine to Jest: #2396
jest-matchers:
* `jest-matchers` is now standalone and works in the browser.
Todo:
yes. this is directly proxied to istanbul. we should add it to the docs!
If you called Jest like that, then it always used `development` as env.
This is indeed odd. Do you have react-native installed? There is some magic Jest is doing that we don't need to do any more, I should clean that up.
One of the problems with this is that you can get the global variable other than `global` that we pass to a file run in a Jest context. I'd really like to figure out how the node team could fix v8, that seems like the long term fix :( This is not a Jest issue. This is a bug in v8/node, see https://github.com/nodejs/node/issues/7593 ‚Äì please express your concerns there and ask the node or v8 teams to fix this within vm/contextify. I'm going to close this issue because it isn't actionable from our side. Some workarounds were documented above, that may or not work for you. Once this is fixed in node/v8, it will automatically start working eventually.  snapshots are colocated with tests and they are definitely not meant to be for machine readability. They are meant to be reviewed by humans, both the author of a test and the code reviewers.
we should probably throw when `it` is used during the test execution to avoid this kind of confusion, but we won't be able to do this until we replace jasmine.
I think this was meant to say `interactive watch mode`. Would you mind changing it into that? Thank you!
Yeah, in Jest the resolution algorithm always looks at core modules first and returns them, you'll probably need to rename it. I'm sorry, we can't really fix this :(
> Error: EPERM: operation not permitted,
Hey @insin, you can avoid that issue by using an administrator command prompt. Windows requires admin rights to create symlinks, and Lerna does not have an option to use NTFS junctions (which don't require admin rights)
(yolo)
This is really odd. Can you potentially do this:
context
xcontext
that is a ton of new globals.
import {it, describe} from 'jest';
sorry. the build was red because i broke master :)
this is transformative.
the backslashes.
> https://github.com/notifications/unsubscribe-auth/AAFnHa6NuhHHyoAKKcMssLFa379tGsO8ks5qnh1qgaJpZM4J02fw
@Daniel15 i'll look inside istanbul coverage reporters. most likely it's something in there that's causing this
Wow, good catch @kwonoj!
a.test.js
@anilanar hm, are you sure? Is the original issue report not valid any more? If it is, would you mind sending a PR to fix it?
ping @yaycmyk are you willing to help out with a PR for this?
Uses the AppVeyor Jasmine reporter from the `jasmine-reporters` project to report test details to AppVeyor.
This is gonna be fun when we kill jasmine!
you can try `jest@test` which has a fix for this.
Seems like lerna might not work so well with spaces in the path. cc @hzoo
The reason I‚Äôm saying it is as much as I like Jest, I just feel uncomfortable replacing `expect.createSpy()` in my code with `jest.fn()`. It feels wrong to use something implicitly injected called `jest` for something non-Jest-specific like creating a spy.
I can understand `jest.mock()` or `jest.useFakeTimers()` because those are Jest-specific features, but typing `jest.fn()` for every spy feels like Jest is trying to tie me down to itself.
Won't `jest.spy` get confused with `jasmine.createSpy`, which can also be used in Jest tests?
> It's actually closer to a stub than a spy I think.
jest.spyOn(MyClass.prototype, 'onClick');
which would return a mock function. Therefore I'm unsure whether spy is really a good terminology for this.
If you are using Jest 15 it should definitely be printed unless you also add `--silent` or something else is happening.
Ohh noo, seems like istanbul doesn't respect our options. Is there a way to tell istanbul which pipe to use?
- No preprocessor is used, babel-jest is used for coverage transforms with istanbul.
- babel-jest is used by default, it also transforms for coverage in a single transform step.
- A different preprocessor is used. Then we apply the transforms from the user's preprocessor (TypeScript etc.) first and then run babel-jest with istanbul.
cc @davidaurelio what do you think?
awesome, thank you so much for the quick fix. I'll publish a fix for Jest tomorrow morning.
cc @kyldvs
‚Ä¶add some mocks
Inspired by https://github.com/mochajs/mocha/pull/641.
Ah, this might be a real issue with Jest 15. Can you try, as a workaround, to call:
This should be easy to implement: just overwrite beforeEach/afterEach the same way we overwrite `it` with `jasmine-pit`.
lol!
@cpojer has a different implementation
In jest 15, it fails
I was thinking of running Jest inside of electron and rendering real apps inside of an iframe, including images and wanted to preserve option value :D
How are we adding these categories?
i remember we had it in ruby :)
but that specific implementation was a mess.
i don't really want to overload jest functions though.
cc @gaearon
Thanks! However we cannot break usage of `jasmine.any` for these. We use it heavily at FB.
This diff:
cc @gaearon
"!**/__mocks__/**`,
I'm not sure I follow, RandomView is only rendered once?
cc @gaearon ‚Äì we talked about this before but then I got a bit confused about what exactly to do in the pretty formatter.
hey @sibelius !
I feel like we should kill the jasmine matcher completely, tbh. No need :)
@maximderbin thanks for making it work with jest!
hey @alansouzati
hey @cpojer
2. We add `/* istanbul ignore next */` to nodes added by babel
i'm not even sure how to approach thing bug. can we configure which transforms can add `/* istanbul ignore next */`?
babel-jest adds this but I don't think we can customize it.
@alansouzati what is in your babelrc file?
We are unsure what exactly is happening here, this issue might be in Jest 15 :(
cc @gaearon
and that blurs the difference between `expected` and `received`.
expect('abc').toBe(getValue()); // weird
but in the case of `toContain`, the value types are very different.
I think it is ok for now to have `toContain` be a tiny bit weird.
here's the `cat` of some of the snapshots
hey @alansouzati !
hey @alansouzati !
jest --config '{"rootDir": "/a/b-c", ...}'
@alansouzati `jest.config.js` are coming for sure! :)
![jest-reporter](https://cloud.githubusercontent.com/assets/13352/18780476/b2db8b0a-81b8-11e6-9c7f-bcf1bcc82bf3.gif)
I'm closing this for now because we can't really do much if it isn't part of Jest.
Can typescript somehow retain lines, just like babel can?
@AriaFallah they're not documented yet, but you can see the full list of new globals in https://github.com/facebook/jest/pull/1632
hey @orta !
jest is a monorepo and this repo contains multiple packages.
You can wrap babel-jest and create your own preprocessor by just passing in the options you want. That should be sufficient.
@tizmagik as i understand you're trying to pass a parameter from your build process (e.g. `grunt` or `gulp` pipeline) into jest transform, so that jest transformation is affected by outer process?
// babelConfig.js
// transformer
@tizmagik i think the biggest thing here is being able to pass config to child processes, when we run tests in parallel.
@cpojer - What do you think of this approach for now? I simply make Windows builds skip all the tests that fail on Windows. It's not ideal and I do plan on going through and fixing the tests incrementally, but at least it makes a Windows build actually possible and will still help catch some regressions.
I'm having some trouble getting Jest running on my work laptop, so I'll do those changes tonight on my home PC instead üëç
We have an integration test for that, however that uses Jest too, so if Jest breaks like this, we won't actually know :D
Hmm, that's tricky... I feel like the exit code should actually be non-zero
> https://github.com/notifications/unsubscribe-auth/AAFnHaOB2ebBFJeeuWoUCeakdkgfoHMUks5qmTV0gaJpZM4JoL_3
- The regex in `package.json` wasn't working correctly for some reason. Moving the `\` to the right spot (before the `.`) fixed it. (6c7620237ba9fa3a441bb7f26aabc59e9df85467)
The question is whether we could figure out a way for Jest to say "Looks like some tests aren't cleaning up after themselves. here is what is going on".
`npm info istanbul-api`. They have the typo in their version, lol.
- Use jest@test (the latest development version)
So after trying to write my tests again today I came across another bug with using Nightmare. This time I took the time to figure out exactly what it was.
Is there a way to disable the mocking of timers in Jest?
also the fact that `actual` value is passed into the function that is called `expect` naturally confuses the human brain
I'll send a new PR that uses jasmine's toEqual matcher for now and then another PR on top of that to polish all the messages and their colors.
Please update Jest to 14.
also now you can add something like this to your jest config
"jest": {
@cpojer can you look at it?
later we can kill jasmine part and `toBeCalled` part if we want to
@suchipi yeah absolutely, we just had absolutely no time at all to think about this or review code. I'm sorry. We'll get back to this soon and are working on merging the snapshot feature into the new matchers and I'll take a look at your PR.
Hey @suchipi,
hey @ffxsam !
Also, we should update our contributing guideline for Jest.
Amazing.
Nice work! Promises are complicated and over time this happened, I guess :D
Hmm, that is very weird. Is the file system access slow, that's really the only thing that should be different here between Jest and mocha? Jest crawls the file system from the root (package.json) and looks at all the files for static analysis. How many cores does the system report that it has? Can you try invoking Jest with `-i`?
@bear2029 are you running `--watch` and `--coverage` at the same time?
we rewrote the way coverage is collected in the latest version of jest, and if `--coverage` is not specified, the threshold should not be checked either
Can we just do "passPerPreset: true" and put the babel-preset-jest into the last list and then try to see when they run?
that should work fine, right? And people can continue to use babel-jest.
@taion yeah that would be great. Maybe can you add a note to the bottom that talks about webpack two and state it is experimental?
it('works on jest.fn', () => {
const foo = jest.fn();
.toHaveBeenCalledTimes() ‚Ä∫ it works on jest.fn
- Error: toHaveBeenCalled matcher can only execute on a Spy function
LGTM.
@yaycmyk hm. we rewrote the whole collection/instrumentation flow this months.
did it just start happening or does it also happen in jest <14.0?
@yaycmyk are you using only babel-jest or a custom preprocessor?
@countoren
@cpojer i would rather keep it secret and undocumented for a while. I want to see how easy it is to use it and how it performs. I'm not really a fan of having both regexes and globs together :)
@faisalil it'll first run the files through your preprocessor and then through the coverage instrumenter.
- We didn't think `.not` is useful. How would it provide any value? Which snapshot would you test against?
# Jest and contributions
You can find a high-level overview of our plans in the [Jest 14.0 blog post](http://facebook.github.io/jest/blog/2016/07/27/jest-14.html#what-s-next-for-jest) and I'm happy to share more details. We literally want to redo everything about Jest that sucks and one project that I'm excited about and am hoping that someone from the community could take on is to rewrite the reporter code and what Jest outputs when run from the CLI ‚Äì it could be so much prettier than it is. However, if you'd like to start using Jest, I'd be happy to listen to your pain points and what you'd like to change to better suit your needs. I'm sure we can make it work well for you.
I recommend to send a pull request that refactors the matcher into two parts: one that returns `{pass, actual, expected}` and one (the jasmine matcher) that wraps the raw matcher and transforms it into `{pass, message}`. This way you can do whatever you'd like with the actual and expected value.
### Counter
- `jest-snapshot.createSnapshotState(filePath)`
- `jest-snapshot.patchJasmine(jasmine, snapshotState)`
- Split up the matchers into a raw matcher and a jasmine matcher.
- "re-run with `-u`" when invoked with Jest.
cc @gaearon
Yes this is indeed a React issue.
Snapshot mismatch:
- missing string
+ added string
Thank you! Must have come from copying the post from quip :(
On Wed, Jul 27, 2016 at 10:26 PM +0900, "marudor" <notifications@github.com<mailto:notifications@github.com>> wrote:
switching to jsdom make it work again.
@jdalton would you be willing to add a simple Jest test for lodash that uses:
"jest": {
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
@Bhullnatik can you try `--no-cache`?
That seems odd, the stack trace you posted points to inline requires still being on...
Is this issue still present on Jest 15?
Which version of Jest are you using? Are you using babel-jest? Can you try `jest --no-cache`?
you can simplify some tests using `jasmine.createSpy`
@cpojer i'm a little worried that it will slow us down when we start working on our mocking functionality.
React repo is full of `SpyOn`, and if we ever change mocking API we'll have to stop and refactor entire react repo first
I don't think that makes sense. The Jest matchers support both Jest mocks and Jasmine spies, so just aliasing them to the jasmine ones makes sense to me, as it will deduplicate the matcher code (and those are 6 matchers, and it could be only three).
In Jest we reset the module registry in `beforeEach`. I suggest using `require` inside of `beforeEach` which will reset all modules instead of top-level requires.
Personally, I don't see a big reason to use ES modules in test files but people want it, so they can use it but there are some drawbacks with the current spec, unfortunately.
wait... why would you use `--watch` and `--coverage` at the same time? i used to throw an error in this case before, because the coverage will never be accurate
@tonyxiao i think if there is any valid use for it, we should make it work. But if not, i think it's better to just throw an error and kill the process. Wrong information is worse than no information :)
Jest would print a message if it can't find tests, so this seems like it is crashing for some reason.
@bravely you might be on an older version of Jest if that's the case?
Here are a few ways to work around this issue:
It's definitely ok if we go down this route. I wouldn't mind for everything that doesn't use babel already.
- babel-jest should do coverage instrumentation and hoist Jest calls.
- babel-jest will be used to transform coverage even when a different transformer is used.
- [x] toBeFalsy
- [x] toBeUndefined
- [x] toBeNaN
@cpojer my plan was to create `jest-jasmine-support` and move all spies, `jasmine.addMatchers` and similar stuff in there, so that projects that are built around jasmine can still run their test suites.
Just bumped into another case where `toHaveBeenCalled` behaves differently from `toBeCalled` and I forgot `toBeCalled` is the one to use.
I think it wasn't working with jest.fn() for me. Maybe I was doing something wrong.
lerna is failing me :(
This diff:
I believe there is quite a lot of impact to be had if you'd like to work on improving code coverage support in Jest and I'm happy to meet sometime this or next week to chat and also happy to put this on the H2 plan for Jest. Here are a few thoughts about this:
- `jest -i --coverage` is broken for some reason.
hey @umgupta
`collectCoverageFrom` accepts a list of globs, and not regular expersions
- Needs @flow everywhere, sorry!
- Can you add toEqual and all the other `diffable matchers` (see JasmineFormatter) as well?
Some more considerations for the output format:
Yeah. this was more of a POC PR. If it looks good i'll add flow and other things.
let me try to integrate it with jest
Thank you for your contribution @ethemes and sorry for the long wait without a response. We've been pretty busy recently.
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
This unfortunately has to use regex to stay consistent with the rest of Jest.
Changing Jest to other matching algorithms is part of our plan to rewrite configs, but shouldn't be done in this change :)
Nice work @dhe128!
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
Does growl support images at 2x for retina displays? If so, can you add a file that is 2x as big? Most Mac users nowadays use a retina display, so it should be the default :)
I'm also sorry for our silly abc style guide. I wonder if there is a lint rule for this.
I will update the code with the abc rule.
For Growl, I can only give one image. Do you know of a way to figure out if the machine has a retina display - from node?
cc @marcelerz
console.log = jest.fn();
I'm gonna close this for now as Jest by default ships without automocking and it isn't likely we'll get to fix this anytime soon, unfortunately.
It seems like you aren't properly using `jest.mock`. The error clearly says the second argument must be a function:
jest.mock('fetch', () => require('fetch-mock'));
or a manual mock:
jest.mock('fetch', () => require('fetch-mock'));
Uh oh, this is not good. Did you try master or is this a fresh install of Jest?
![Imgur](http://i.imgur.com/d2TKgYq.png)
@Volune would you like to send a pull request with a proper default that works both on windows, linux and mac os? If that is not possible, we could detect whether the user is on a windows machine and set a different default.
(Also, tabs, wtf?)
// in a promise chain:
Thanks @mateuszsokola for helping out on issues! :)
Yeah it is probably what @mateuszsokola said. Let me know if this is still an issue and I'll reopen :)
myName = jest.fn();
module.foo = jest.fn();
Can we use `\u203A` instead of `*`? It's what we also used for failed tests (it's a fancy version of `>`).
@ColCh we already have an integration test for coverage. You could add a manual mock there, load it in the test and make sure it isn't part of the coverage output.
@mateuszsokola yeah, we should completely change collectCoverageOnlyFrom, I agree. I think we should also only turn on coverage after we run the setup files, need to think about this a bit :)
Thanks! I wasn't aware of this error code.
btw. this is mostly a React issue, as it has special cases for React classes but not functional components.  See https://github.com/facebook/react/issues/6932
Here are a couple of ways to mitigate this:
testRegex: ‚Ä¶
cc @lencioni @trotzig
"jest": {
* @jest-environment node
switching to yargs seems fine so I'll close this PR and merge the other one after switching the error to a warning.
<img width="526" alt="screen shot 2016-05-19 at 2 46 38 pm" src="https://cloud.githubusercontent.com/assets/87300/15395686/af7fae6a-1dd0-11e6-9de5-c4ff55cc08a2.png">
Are you trolling me? You mentioned coffeescript in a code comment in a project I work on? What!?
I'm happy to reopen if this turns out to be a Jest bug. Feel free to continue commenting.
@ankitrg into your configuration file/object, for example in your `package.json`:
"jest": {
- fixes broken jasmine formatter when the environment is not passed
What's `babel-jesta`? :D
Sorry for the issue, it'll be fixed in the next Jest update next week :)
var a = new RegExP('/abc');
the next time `jest` runs it will check against it to see if something has changed.
- Create a class SnapshotState and instantiate it in `jest-jasmine2/src/index.js`.
I'm going to close this out because it doesn't seem like a bug in Jest. Thank you so much for providing a repository with a repro, I hope that someone working on istanbul can take a look at this. If this does turn out to be a bug in Jest, I'm happy to receive any PRs that make this situation better for you.
Can you explain how your change helps? Don't you mean `require.resolve(rootDir, path)`?
Probably not, looks like a different bug unfortunately :(
expose DIFFABLE_MATCHERS to allow customizing it
const JasmineFormatter = require('jest-util/lib/JasmineFormatter');
JasmineFormatter.DIFFABLE_MATCHERS.toMatchSnapshot = true;
Can we do `Jasmine.addDiffableMatcher` instead? A function API is more future-proof.
Fixed in #1515 and Jest 15 (released sometime this week).
client.on = jest.fn();
jest.unmock('supertest').unmock('../appServer');
The docs in react-native about Jest testing are unfortunately entirely outdated and no one is bothering to update them :(
Is this a yubikey?
‚óè Runtime Error
last_name: 'Freddie\'s',
"jest": {
Are you using babel-jest as well? Does it get printed when you run Jest?
yeah using `babel-jest` @ "^12.0.2"
Am i correct in assuming this is some kind of babel related issue? Having trouble diagnosing it...
@cpojer
@dmnd I think we should error in the transform when incorrect casing is detected. Would you like to send a PR for this feature? The transform code is pretty simple and can be found here: https://github.com/facebook/jest/blob/master/packages/babel-plugin-jest-hoist/src/index.js ‚Äì simply doing a case-insensitive check first and throwing if the case-sensitive check for the method names doesn't match should be good enough :)
"defaultPlatform": "ios",
"platforms": ["ios", "android", "native"]
wait, are they? In Jest, modules definitely behave differently based on whether "use strict" is given and I believe in nodejs too.
This has been confusing to me when using these matchers.
Example Repro:
const fn = jest.fn();
fn('abc');
expect(fn).toBeCalledWith('abcd');
Major because we rewrote `node-haste` as `jest-haste-map` and we updated Jasmine which throws on some things and is more strict than before.
@skawian are you willing to make this change? That would be great. Also, I think we should leave the defaults the way they are and provide additional documentation for this.
myModule.foo = jest.fn();
module.foo = jest.fn();
Upgrading to Jest 12.0.2+ should resolve your problem.
If it doesn't, it is probably another dependency that hasn't been updated (like babel, where I've seen this happen).
Oh sorry, I didn't understand your comment the first time reading it. What you say is correct, some APIs are a bit more strict and the fix for Jest is to update to the latest version (12.0.2 onwards) :).
The new API is `jest.disableAutomock()` when used together with babel-jest, it will work properly.
to the Jest config however. There might be a minor bug there, individual from your issue and I will try to repro that :) Thank you for your patience!
There are a few things we can do:
jest --all --new
jest --all --new
I actually believe that if we add this directly to our fork of jasmine 2 instead of wrapping it, that would be fine with me too if its in the interest of perf.
The docs in react-native about Jest testing are unfortunately entirely outdated and no one is bothering to update them :(
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
@duongphuhiep the issue you might be experiencing is that `jest --watch` by default runs tests related to changed files that have not been committed. If it works for small projects but not for bigger ones the problem might be either that the dependency graph that is being built is not entirely correct or that your setup is weird. If you could share an example repo where `jest --watch` does not work with certain changed files, I'd be happy to take a look.
jest --watch=all
- `packages/jest-haste-map/src/crawlers/`
cc @amasad ‚Äì if you could take a quick look, I would greatly appreciate it :)
- Yes, we should probably write a dex :D
- Yes, Map and Set are super fast but they don't serialize well to JSON. Is writing to a Map or Set as fast as it is to an Object? We are doing so many writes during startup, which is quite critical when you have 100k+ items. https://github.com/cognitect/transit-js could help to speed up serialization ‚Äì it is basically a custom serializer that is really fast and can encode/decode to immutable data structures. I think right now that is more than I need but if it yields real performance gains, I'd consider going for it :)
Is there a reason you closed this PR? I'm sorry I didn't have time yet to work on this more and merge it. And unfortunately it doesn't seem like you actually properly signed the cla as requested by the bot :( Please try signing it again, the bot usually works properly and I've not experienced any issues with it yet.
Oh, I didn't realize you were using webpack alias. I don't officially support it and it is likely not a problem with Jest that you are running into.
Woah, I didn't realize babel-jest would even work with babel 5. We don't really support it any more‚Ä¶
"jest": {
thank you so much Joe!
There are two solutions:
Jest config:
return processSass(src);
return babelJest.process(src, filename);
cc @appden
Thank you for your patience. We launched Jest 14.0 with experimental react-native support:
This is most definitely not normal and I'm unable to reproduce this locally. If this happens only on the first run, it most likely means that your babel configuration is messed up and that babel is doing something that it should not. On the first run, babel transforms all files under test.
@kalisjoshua we are talking about `jest -o` (the default for `--watch`) which uses static analysis to find related test files based on the set of changed files. This doesn't apply to `jest` itself or `jest --watch=all`.
cc @zpao :P
that actually sounds like a pretty good idea! However, is there a reason why wrapping Jest isn't an option for you? This was the original intention:
wouldn't that also work and give you more freedom to do whatever you want?
- ship jest-jasmine and jest-util to the browser. Might require a tiny bit of refactoring.
I appreciate this discussion got started again. To me this has always been exciting but also risky for the project. I'll support this as much as I can and have some thoughts as well.
// How it could work, using a babel transform:
I'm going to close this because we can't reproduce this unfortunately. If this is just an issue with the reporter it might be a bug in istanbul. I'm happy to reopen if you can provide a sample repository where we can run Jest and try to reproduce the issue :)
Hey! I believe this is definitely an issue with either babel or istanbul or how they are connected and all of this isn't super great right now. It seems like the coverage report itself is correct (100 %), which is important. It might just collapse two lines into one or something.
@yaycmyk I have created an account but didn't get to set it up for Jest yet. I want to point out that we don't prioritize Windows support at Facebook. We rely on awesome contributors, like you, to help us out with that. That being said, we should make sure we don't regress on any existing features.
I would like the API to be this:
jest.mock('foo', () => {
myMock.foo = jest.fn();
And also I wanna say: thank for the hard work you are putting into Jest. This is invaluable and I appreciate the support I'm receiving from you. Thank you.
It seems to me like these are things that should be fixed in babel instead of in Jest.
@ola-g86 are you using any custom preprocessors? is your project open sourced?
Thanks @kmagiera! Seems like we had this issue since forever and obviously Jest should be a much smaller install. Looks like 0.9.3 will be going out this week, then ;)
Ok definitely a bug in Jest. I'll try to fix this for the next release but as a workaround I suggest changing to `throw new Error()` :) Thanks so much for creating a concise repro case!
Or well, you can also use jasmine1 for now to unblock yourself :)
What about just `babel-plugin-jest-hoist`?
I think the description inside of Jest makes sense but it might make sense to add this to the top of https://facebook.github.io/watchman/docs/troubleshooting.html @wez what do you think?
Yes, that is basically the idea! It allows to map arbitrary modules to other strings. Ideally we'd also support backreferences, so something like "foo(.*)": "<rootDir>/bar/\1" would map "foobar" to "<rootDir>/bar/bar" but that should be done in a follow-up ‚Äì I haven't created a task for this, but I'd be happy to if you want to tackle this :)
Hey @pvolok!
jest.setMock('foo', someFn);
That's a great explanation @mbrio. Thanks so much for the fix, I'll publish a new version today or tomorrow :)
@mbrio I'm unsure whether it is wise to use babel-runtime. I'm still not entirely sure whether people should use the polyfills or the runtime. It seems like babel-polyfill is what is generally recommended.
cc @thejameskyle and @hzoo who might be able to enlighten me
yes, I agree. If the comment printing is broken in babel, I feel like you should open an issue on the babel bug tracker for it.
@mbrio I see. I wasn't aware of the difference between Jasmine's reporting and Jest's reporting. We never reported pending tests before (not even when Jasmine 1 was the default). Would you be interested in fixing the reporting around this so that at the end we say `2 passed, 1 pending`, for example? :)
throw new Error();
paths‚Ä¶ :confused: :question:
Discussion: https://www.facebook.com/groups/reactnativeoss/permalink/1528961550733807/
Reviewers: @vjeux @yungsters @voideanvalue
cc @appden @ms88privat @ide @brentvatne
I'm pretty sure this works with jest 0.9.0. Would you mind trying with that?
"jest": {
"jest": {
We are good :) Just re-tried your Toy-Box example and it works with jest 0.9.0 and node-haste 2.6.1. Sorry for the hiccup!
@ms88privat would you mind also pasting your package.json? Your directory structure would also be good to know, for example, where is your `.babelrc` (and what is in it) and what does `require.resolve('babel-jest')` give you from the root of your project?
jest.unmock('Foo');
@nitsujri hey! Not sure if you are using react-native or react, but whichever one you are using needs to be part of your `unmockedModulePathPatterns` or you need to call `jest.unmock('react-native')` before importing it.
"defaultPlatform": "ios",
"ios",
"react-native"
@yaycmyk would you mind taking a look at this? Seems like the remaining code blocker (besides documentation and all :) ).
What do you mean exactly? :) Feel free to make any updates to the docs! I myself will start improving them sometime next week, at last :)
@yaycmyk by both ways you mean it works on windows and linux/mac?
See http://astexplorer.net/#/SSAVF697Ro/4
Let me know if there are any other issues with jest 0.9.0 ‚Äì I think my explanation covers both issues that you pointed out earlier.
Hey @vdvleon,
@yaycmyk What happens when you comment out this part: https://github.com/facebook/jest/blob/master/src/resolvers/HasteResolver.js#L117 ?
@irudoy is this still an issue?
I think I'm going to be a bit bullish on lodash, as said I don't wanna add the dependency unless we absolutely need it ‚Äì I hope that's fine with you.
There is already and experimental setting that you can use to include your own environment for your tests :)
![Imgur](http://i.imgur.com/gGFpObi.png)
`jest.addMatchers` doesn't exist any more with jasmine2. The solution, as you found, is to use `jasmine.addMatchers`. Thank you for the report!
@mc-zone in Jest 0.9 errors should properly be rethrown, that was an unfortunate bug :)
Are you using npm3? In that case, for now, you'll also need to put chalk and has-ansi into the unmocked patterns.
Woah, JavaScript is so weird :)
Yeah this sucks and was a change in babel 6 that I didn't anticipate. There are a number of ways to fix it and I haven't settled on one yet.
@5amfung I recommend unmocking the parse SDK. With jest 0.9 you should be getting a helpful message linking you to  http://facebook.github.io/jest/docs/manual-mocks.html
Yeah I think this is unrelated to Jest. Either an istanbul or a babel issue, I'm afraid.
Seems like you found an actual bug in your code with Jest, then ;)
This should work using `jest@next`, fixed in #599.
Hey @bigblind. This is a good point but this is actually by design and JS doesn't really allow to call the constructor with variadic arguments and a bound context. I think the wrapper you have is the only proper way to solve this for now.
Yes, babel6 changed its behavior. We'll fix this soon.
diff applied:
‚óè babel-relay-plugin ‚Ä∫ it has been built properly
‚óè babel-relay-plugin ‚Ä∫ it has been built properly
That sounds like a bug!
it's all green :(
if (foo !== bar) {
if(foo!==bar){
Thanks @Jarlotee, sorry for the late response, just got back from a vacation :)
jest.dontMock('foo');
will transform to
jest.dontMock('foo');
I'm going to close this PR because this is not what I would like people to write and I'll figure out the fix around babel-jest.
@amasad does the new resolver fix this use-case? What does it give preference to?
@hgezim did the module resolution algorithm change at all with npm3?
@hgezim would you mind retrying with jest@next (0.9.0-fb1) and reporting whether it resolves your issue?
Please let me know if this is still a problem with `jest-cli@next` and I will reopen and investigate.
Right now this option is consumed by Jest, but it's not used anywhere.
yeah it would be great to update the example to work with babel 6!
Closing this; we'll publish jasmine2 support soon and it is tracked in the PR.
Hi @CodeFred,
- Numerous bugfixes and cleanups all around Jest.
![Imgur](http://i.imgur.com/6Yj0qHa.png)
"defaultPlatform": "ios",
"react-native",
![Imgur](http://i.imgur.com/KbrCB0J.png)
@irudoy can you try passing `watchman: false` to your jest run?
Published jest@next again as 0.9.0-fb2 which should resolve the watcher issues.
(I meant to say that I'm always around on discord, not stack overflow :) )
this is because we are not buffering console outputs any longer and we are printing them as they happen. This is a bit unfortunate ‚Äì @amasad can you think of a fix?
Hey! Are you using jest 0.7.0? This was fixed recently.
Oh man, did I mess up this thing in Promise.resolve? I thought Promise.resolve calls the passed in function. That is messed up. I'm sorry!
that sounds like a good idea. I've been wondering why jest depends on coffee-script and haven't gotten around to look at the jasmine part of jest yet, unfortunately.
For some reason react is being mocked even though it shouldn't. This is weird.
which version of node and which version of jest are you using?
That's weird. Feel free to send a Pull Request :)
cc @vjeux ^
exports.something = Symbol
This is a problem with reserved keywords. Merging with #394
fixed via 38a364f63ba25dadfe757f229b943a9d8c2b1033 and 5039aadbeb12686834ee5a1e455f23b3eb4d922a
@iandanforth do you think you can submit a pull request for this? :)
I think this is a jasmine issue that we can't fix. Sorry about that, using a different string should work. Maybe jasmine2 will fix it.
Yes I think @yudoufu's suggestion makes the most sense.
We are currently working on adopting jasmine 2. jest also integrates pit, which should work as well.
https://github.com/chalk/has-ansi/blob/77fd627fb18b9740518a7bb65e9c3a68b9e51cf2/index.js#L3
In the following `ansiRegex()` will return undefined because it's a mock
var ansiRegex = require('ansi-regex');
Normally svg update so fast. It's so weird. The latest version of jest-cli which shown on npm pagehttps://www.npmjs.com/package/jest-cli is 0.4.19, and version installed by npm install jest-cli also 0.4.19. Maybe some npm bugs here?
cc @DmitrySoshnikov why are we using runInContext here?
Thanks for the list @domenic. On it.
CC @ide, @cpojer, @amasad
There is also nomnom which we have been using for https://github.com/facebook/jscodeshift
@fkling what would you recommend? I remember we had this discussion around jscodeshift as well.
@mbrio it would be awesome if you could take this on! I'll try to merge #800 today, it probably makes sense to wait for that first :)
CC @ide, @domenic
return foo;
return foo;
undefined:6
return foo;
ReferenceError: foo is not defined
This might be a problem in Jasmine itself. Perhaps when/if we upgrade to a newer version of that this will just work.
Hey @blainekasten,
how do you feel about changing this to recommend babel-jest and then explain how to customize the transform if necessary?
CC @AsaAyers
There is no way to do this during runtime but I have ideas on turning this into a babel-transform in the future:
CC @AsaAyers
I like it! nit: can we call it `--bail`? inspired from mocha.
@akheron I suggest using a preprocessor to compile your code to ES5 before running test. Look at the `babel-jest` npm module.
@amasad can you elaborate on how the new dependency resolver resolves modules in this case?
So there are two issues here:
@domenic, would be great to have some workaround if the global object is a private data (any suggestions?). Or, could we just expose getter for the global object for public API?
@domenic, in the view of io.js and Node projects rejoining, does it still make sense to explicitly disallow Node for `jsdom`? Although, as official [documentation](https://nodejs.org/download/) says "io.js releases will continue in parallel". This "in parallel" makes me worried, since if we're gonna work only with io.js, there will be no way to return to Node, if node 0.13, 0.14, etc will appear, and devs will stuck forever with io.js, and probably will have to maintain different versions of node.
Feel free to reopen if this is still an issue with the latest version of jest (0.7.1+).
:shipit:
@latkinsa what's an example of it running in a subshell?
@vjeux @amasad @zpao, what you guys think?
let me know if this is still an issue with the latest version of jest and feel free to reopen this task.
Foo.bar(mockCallback); // somtimes throws here (race condition)
- If yes, and we have this race condition, how to test this use case?
CC @wwalser, @leebyron, @amasad, @zpao
@wwalser, thanks for the explanation (didn't mean to interrupt your vacation, sorry :)).
Foo:
jest.runAllTimers();
both calls to `it` will receive different versions of A.
@graue @mrsharpoblunto please feel free to send a PR to fix this behavior.
@felipeochoa I have no smart thoughts on this to be honest, so feel free to send a pull request with the changes and with tests and we'll see where can take it.  I recommend using jest.mock('path/to/module/name', () => {‚Ä¶}) for this. I don't think we'll add support for nested manual mock files.
cc @jquense who offered to write some documentation for the website and who implemented this feature into jest-resolve.
do {
// ["toString", "m5", "m6", "m1", "m2", "m3", "m4", "p1"]
:santa:
Do you guys have any numbers on the performance impact of switching to jasmine2?
I'd prefer to bump the version of jest and use jasmine2 exclusively however!
Ok, as a first step I'm elevating jasmine-pit into the jest repo. There is no point in keeping it in a separate repo. Going to get code-review for this and push it out.
@flarnie added a warning for this for Jest 16. Finally :)
I cannot do that @cpojer, because @akutz does not have an active CLA on file.
I'm going to close this. I don't consider CS actively supported from us at FB and we'll rely on external contributions for future support of it in Jest. That being said, it shouldn't be a big deal for someone else to figure this out :)
This is a known problem. #243
@fabiomcosta is the comment about why it couldn't be used was wrong? We are still using the function constructor in this file.
@supasate you can make use of [`transformIgnorePatterns`](http://facebook.github.io/jest/docs/configuration.html#transformignorepatterns-array-string). And another example from RN tutorial: http://facebook.github.io/jest/docs/tutorial-react-native.html#transformignorepatterns-customization  jest has some problems with 0.12 so for the time being that node preferred version checking is actually a good thing. We're tracking that in #243.
This shouldn't be an issue any more with Jest 0.9.0.
The fact that it no longer works in Node at all I s pretty disappointing and makes it a challenge to consider upgrading :(
Weird, Travis says 'failed' here in github...but when you go over to the travis build page it says passed...
@fkling - I don't think that's true, we have a huge list of people telling us Jest isn't working in #243
Hello @emmenko,
@atridgedcosta (and anybody else doing that) just FYI. `npm rebuild` will rebuild binary packages for the current version of node so you don't have to `rm -rf node_modules`.
@chapinkapa, would you consider switching to `io.js` (and installing Jest form `0.5.x` branch), or do you have some blockers in other software that don't run on `io.js`? We had dependencies issus with 0.12, especially with jsdom which doesn't support 0.12 either.
@nkbt your option is to use:
cc @sebmarkbage
@kentaromuria this might be a good ask to look into to get started with Jest! Absolutely agree we should make this better soon.
jest.unmock('Bar');
jest.setMock('Foo', {‚Ä¶})
Yeah the solution here is to use jest.mock. We are unlikely to extend manual mocks to have sub folders for now but I might revisit this decision in the future.
The mock that people are using here is working well, so closing this issue.
jest now has a `--watch` command.
Thanks for your patience @wwalser - this is great work.
setImmediate is defined with different semantics on different platforms (it's not a standard) -- so it wouldn't be possible to define one that works properly for everyone.
As per the edge-cases, I think as long as the described execution order is upheld then you're in good shape. I can't seem to find any documentation that IE/W3C vs Node real implementations would cause the execution order to differ dramatically, so I agree with you on this @wwalser that the difference shouldn't mean much for mocking. If they did differ dramatically in execution order and behavior, then we're fucked anyway for using setImmediate in both environments and it's use in Jest is the least of our worries. Also: `nextTick` and `setTimeout` do not co-exist in any browser, so we only need to consider Node's behavior for the interaction between these two.
Hmm, oops! That does seem wrong...
That's weird, which version of Jest are you using? npm modules should definitely have transitive dependencies unmocked. If that's not the case, then that is a bug (the test for this is passing in Jest right now, though).
@ondrejhanslik I would recommend giving Jest another try. We have essentially rewritten Jest to be much better and easier to use, although some of the areas you mentioned we are still working on at the moment :)
@cpojer before i do that i wanted to do two things:
$ jest
Hi @awei01, appreciate your time/effort on this, really do.  This issue was happening in a bigger, more complicated AngularJS program, and definitely not because of the exports. I quickly cut it down to this test case and as you saw it was a bad job.  I'll go back to the AngularJS program and see if I can put together a better test case.  I'll close this and re-open if I get around to doing this.  Thanks. :)
https://github.com/bjfletcher/jest-issue
I'm hoping that there's something we can fix on the `Jest` side rather than on the `body-parser` side - although admittedly `body-parser` really shouldn't be using `function` as a method name.
#commentraceconditions
Jest is annoying to do simple things with and as we continue forward, we're working on making that easier.
@hankhsiao
This will be fixed in the next Jest release.
#herostatus
tests is very slow, sometimes it's possible that Jest looks like it has
(3) Mock timers - My initial thoughts: It seems likely to be more work than it's worth to maintain a separate package for FakeTimers + express all of the (fairly jest-oriented) guarantees and features; Therefore I don't know if this would be a good idea or high value. If you feel strongly about this, I'd be willing to talk more about specifics if you could outline exactly what aspects want to use in isolation?
This shouldn't be an issue with jest 0.9 any more. Let me know if this still comes up and I'll re-open and take a look.
But cc @amasad who hooked these up.
derp...
fuckyeadancingbear
@adaschevici are you still interested in providing a proper fix for this issue?
> Either way, I really really need my tests to be fast for my workflow. I still need to figure out how to at least run a single suite. In jasmine I could use "ddescribe" or "iit" instead of "describe" and "it" to run a single test or suite. Jest is SO nice, I just need a fast workflow now.
@songawee It doesn't but want to send a PR to have it as an option? I don't think we should have it on by default because it's sometimes impossible to know when to break the cache. For example, if you change your compiler options, the cache should reset. Another option is to have a reset-cache option in addition to caching.
Also I'm not quite sure what you meant by tests executing synchronously -- but test files themselves run asynchronously, so a failing test would not stop the Jest cli in it's tracks
Awesome, thanks a ton @jquense !
@SevaUA: What happens if you run istanbul with single-process jest? (i.e. with the `--runInBand` command line option)
@sbrekken: Good to know, WRT async tests -- we should look into that. I've been pretty pre-occupied with vacation/travel the last month or so...but I'm ramping back up now so hopefully I can devote some more time to this stuff again in the next couple of weeks.
@amasad are you still working on this?
@spicyj if this is still happening please reopen the issue.
@fkling are you ever going to build this?
undefined = 2;
then I get `undefined` when executing the code directly but `number` within jest.
You can take a look at the existing `jasmineTestRunner`:
It should be possible to build a `jasmine2TestRunner` that matches the same API as that runner function. Then it'll be easy to toggle between the two test runners (and even other test runners!) via this config option:
jest 0.8.0 was published just now with optional jasmine2 support! Thanks everyone and I'm deeply sorry for the long wait.
Odd. I see this on a narrow window:
Test Plan: jest
Going to go ahead and close this issue out because I'm not sure there's anything to be done from the Jest side of things
(Possibly related to https://github.com/facebook/react/issues/812, but I'm guessing a different issue.)
Yea, I've been tracking this confusing error message here: https://github.com/facebook/jest/issues/14
Thanks a ton, @harshadsabne!
We might be able to work some crazy `child_process` hackery in the bin/jest.js file if we detect that `--harmony` wasn't used to execute the file...
@gbbr Are you trying to mock $.ajax or have it actually perform the network request?
Jasmine indeed
`jest` probably makes sense, but it'll take a little more hackery: The `jest` object comes from inside the module loader -- and the setupEnvFile get's executed outside the module loader (...although maybe it shouldn't be executing from outside the module loader...)
Random guess: Are you by chance on a windows machine?
Also cc @mwolson and @ColCh
at visit (mocks.js:275:5)
I also considered making jest throw with an error that suggests that, when `undefined` is encountered as an `exports` object, you should refer to this issue as it's likely that you're doing something like:
Thanks @wyze!
http://localhost:8080/jest/docs/getting-started.html
(I'm not sure exactly why these use different css...but I bet @vjeux might know)
![Before](https://github.com/duailibe/jest-snapshot-colors/blob/master/screens/actual.png?raw=true) | ![After](https://github.com/duailibe/jest-snapshot-colors/blob/master/screens/expected.png?raw=true)
There's a repro case in http://github.com/duailibe/jest-snapshot-colors
```diff
Branches        6        6
Partials        3        3
```diff
Branches        6        6
Partials        3        3
```diff
Branches        6        6
Misses       2495     2495
Partials        3        3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
```bash
Config:
"roots": [
"**/*.jest.js"
```diff
Branches        6        6
- Misses       2495     2502       +7
Partials        3        3
At the beginning, I searched `window` through jest document, but got nothing...
But...It's kind of weird.
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
this is my .babelrc:
```jsx
this is the code that breaks:
**Versions**
- jest: v20.0.4
**Code**
"jest": "^20.0.4"
"jest": {
user : 'aaronmcleod',
database : 'aaronmcleod'
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
I am new to `jest`, there might be other options which are undocumented too.
```bash
> jest
Difference:
‚úì Native global Object (6ms)
Test Suites: 1 failed, 1 total
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
There is an introspective API, for example:
prettyPrint(new ABRecord());
``` If you are fine with `Immutable.ABRecord {a: 1, b: 2}` then it looks the best solution. With a fallback to `Immutable.Record` if no custom name is defined.
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
I believe this is a *bug*
### Repro
### Versions, etc
```diff
Branches        6        6
- Misses       2812     2816       +4
Partials        3        3
Fix unexpected comma
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
‚Ä∫ by Slug
‚Ä∫ by Slug
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
- `jasmineStarted` (not equivalent to the custom reporter's `onRunStart` because the former happens *after* loading the test file unlike the latter, which is an important difference for us)
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
```diff
Branches        6        6
Partials        3        3
https://github.com/orta/vscode-jest/pull/73
> <https://github.com/notifications/unsubscribe-auth/AAC_jkVkHFULcxbcvWTe3ugoDpBOgfAPks5r9pvggaJpZM4NnXvB>
|_Autosuggest.test.js
PS C:\Users\smurugana\Desktop\MyWorkspace\MyUnicorn\unicorn> npm test
> unicorn@0.0.1 test C:\Users\smurugana\Desktop\MyWorkspace\MyUnicorn\unicorn
> jest --verbose --coverage && yarn run lint
Verifying Unicorn Server Status and hitting Auto-Suggest API
Hitting Unicorn with Bad data
Test Suites: 2 passed, 2 total
PS C:\Users\smurugana\Desktop\MyWorkspace\MyUnicorn\unicorn> npm test
"test": "jest --verbose --coverage && yarn run lint",
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
throw new Error('1234');
throw new Error('1234');
throw new Error('1234');
throw new Error('1234');
throw new Error('1234');
}).toThrow(/1234/); // regex to match message
throw new Error('1234');
throw new Error('1234');
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
"jest": {
"jest": {
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
```javascript
const banana = require('../banana');
jest.enableAutomock();
```bash
at Object.<anonymous> (node_modules/has-ansi/index.js:3:32)
at Object.<anonymous> (jest-examples/orange.ts:1:24)
jest
Node v7.7.2, Jest v20.0.4, Yarn v0.24.5, no extra jest configuration Will look into that, thanks for the quick response üôÇ If anyone stumbles over the issue looking for the same thing. I ended up with [skip-if](https://github.com/relekang/skip-if).  Fixes #3574
FIxes #3619
```diff
Branches        6        6
Partials        3        3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
If this is by design, maybe it should be documented? It is surprising behavior.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug.
"name": "carecru",
"axios": "^0.9.1",
"babel-eslint": "^7.2.3",
"bcrypt": "^0.8.7",
"bootstrap-sass": "^3.3.6",
"cors": "^2.8.1",
"crypto": "0.0.3",
"ejs": "^2.5.2",
"express-jwt": "^5.1.0",
"faker": "^4.1.0",
"jsdom": "^7.2.2",
"kue": "^0.11.2",
"lodash": "^4.4.0",
"mandrill-api": "^1.0.45",
"mime": "~1.2.11",
"node-sass": "^4.5.2",
"redux-form": "^6.6.3",
"redux-saga": "^0.11.0",
"rimraf": "^2.5.1",
"sass-loader": "^6.0.3",
"twilio": "^2.11.1",
"@kadira/storybook": "^2.35.3",
"@kadira/storybook-addon-knobs": "^1.7.1",
"babel-jest": "^20.0.3",
"chai": "^3.5.0",
"jest": "^20.0.1",
"mocha": "^3.3.0",
"nodemon": "^1.10.2",
"sinon": "^1.15.3"
`.babelrc`
"react-hot-loader/babel"
bug
Log:
"jest": {
"snapshotSerializers": [
SyntaxError: Unexpected token .
SyntaxError: Unexpected token .
Jest config
"jest": {
"^.+\\.(js|jsx)$": "babel-jest"
`.babelrc`
"react-hot-loader/babel"
Fix typo for #3633
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
get some human eyes to verify üòÑ
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
multiple was spelled wrong
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
```diff
Branches        6        6
Misses       2494     2494
Partials        3        3
*Bug*
The current behavior means I have to remove `jest` from the dev build, so that I can build reliably, which sucks.
```diff
Branches        6        6
Misses       2497     2497
Partials        3        3
function useSinon() {
this.sinon = sinon.sandbox.create();
this.sinon.restore();
useSinon();
this.sinon.stub(...);
function useSinon(context) {
context.sinon = sinon.sandbox.create();
context.sinon.restore();
useSinon(this);
this.sinon.stub(...);
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
I report an issue to `ts-jest` but no result.
https://github.com/kulshekhar/ts-jest/issues/218
Expect not to scan node_modules exclude `node_modules/lodash-es`
jest test/*.js
```diff
Branches        6       6
Misses       2496    2496
Partials        3       3
jest ^v19.0.2
jest-config.json
1. react-native init test
```javascript
4. react-native run-ios
5. „Ö†„Ö†
During investigating this, read a lot of code and eventually come to jest-haste-map - the one which required by react-native.
```javascript
```javascript
@cpojer @nixoz I added
"defaultPlatform": "ios",
"ios",
"react-native"
/Users/nithyamathews/Projects/wm/application/src/main/webapp/media/scripts/webpack/assignments/templates/details/employee.hbs: Unexpected token (1:0)
```javascript
import 'react-native';
Bug
`jest` does not exit after test suite completes successfully.
- https://github.com/rockchalkwushock/jest-playground
## Jest Config
@cpojer
// Connection to Mongo killed.
await mongoose.disconnect();
‚ûú  my-project git:(master) jest "my.*(complex)?pattern
```diff
Branches        6       6
Misses       2496    2496
Partials        3       3
jest cache's all transforms.
jest 20.03
Bug
2. I ran `jest --runInBand`
finally, here is my jest configuration:
"jest": {
p.s. jest is great, I really enjoy using it so far (it's been my second day) so thanks!
```diff
Branches        6       6
Misses       2496    2496
Partials        3       3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
"jest": {
Not sure if anyone has found a way to do this with the current Jest build but it would be very helpful.
Bug
"!src/shared/services/raven/**"
jest 19: https://coveralls.io/builds/11407983
jest 20: https://coveralls.io/builds/11453060
Jest 20
"roots": [
"snapshotSerializers": [
FAIL  test/integration/lerna-init.test.js
‚óè lerna init ‚Ä∫ initializes empty directory
at _callee$ (test/integration/lerna-init.test.js:31:33)
at test/integration/lerna-init.test.js:8:548
‚óè lerna init ‚Ä∫ updates existing metadata
at _callee2$ (test/integration/lerna-init.test.js:42:33)
at test/integration/lerna-init.test.js:8:548
lerna init
[~/github/lerna] (bump-jest)$ (node:54328) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): RangeError: Maximum call stack size exceeded
"jest": {
"roots": [
.jestrc-ci for Jenkins :(
@serginator oh but it is working with a custom config, it's just not picking up the `.jestrc` (IDK why)
**The motivation for this change is why the output for current example (in verbose mode) is very strange**
```diff
Branches        6        6
Misses       2496     2496
Partials        3        3
```diff
Branches        6        6
Misses       2496     2496
Partials        3        3
*bug*?
jest.mock('net')
jest.resetModules()
const fn = jest.fn();
@philipp-spiess I guess we can add custom matchers like `toHaveBeenCalledWithImmutable(map1, map2)`.
\\ Pretty hacky way to do it
Bug
Jest: 20.0.1
To work around I defined a explicit cache directory on jest config:
```diff
Branches        6        6
- Misses       2495     2502       +7
Partials        3        3
origin	git@github.com:lindgr3n/jest.git (fetch)
origin	git@github.com:lindgr3n/jest.git (push)
> Your branch and 'origin/issue-1888' have diverged,
`$ git reset --har issue-1888`
```diff
Branches        6       6
Misses       2496    2496
Partials        3       3
Race conditions are tricky to reproduce, hence only manual testing.
SyntaxError: Unexpected token ...
```diff
Branches        6        6
- Misses       2496     2498       +2
Partials        3        3
-    "jest": "^20.0.1",
+    "jest": "Vanuan/jest#fix-race-condition",
Resulted in error:
Directory: /src/node_modules/jest
Setting up Jest's development environment...
$ /src/node_modules/jest/node_modules/.bin/lerna bootstrap
```diff
Branches        6        6
Misses       2502     2502
Partials        3        3
Done.  Hi, I'm pretty new to Jest.
```diff
Branches        6        6
Misses       2529     2529
Partials        3        3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
**bug**
https://github.com/tolu/jest-coverage-bug
Just tested with my case by manipulating local jest with changes from #3554 and it seems to work perfectly!
```diff
Branches        6        6
Misses       2529     2529
Partials        3        3
Bug. Related issues (Jasmine-related): https://github.com/facebook/jest/pull/3506 https://github.com/facebook/jest/issues/3505
/* eslint-env jest */
I should see `"hi"` printed twice. Instead, I see `undefined` printed twice.
Jest 20.0.1.
Typo in PACAKAGE_JSON
```diff
Branches        6        6
Misses       2529     2529
Partials        3        3
Jest: v20.0.1
> My issue started with RN@0.43 and jest@19
```diff
Branches        6        6
Misses       2529     2529
Partials        3        3
We are porting our tests from Mocha to Jest and encountered this weird problem.
bug
The following spec tests login and fetching data for an authorized user in Express.js server using Supertest. Before each test suite, it initializes an agent that does the login. In Mocha the test runs without problems. In Jest, however, it successfully logs the user in `beforeEach` part, but the subsequent requests don't use the same credentials, hence, get rejected as unauthorized.
agent = request.agent(api);
password: 'testerPassword',
Jest 20.0.0
Whereas in Mocha we have two strings:
Mocha has both:
```javascript
secret: 'asdfasdfasdfasdf',
$ jest
res.headers { 'x-powered-by': 'Express',
etag: 'W/"2-eoX0dku9ba8cNUXvu/DyeabcC+s"',
res.headers { 'x-powered-by': 'Express',
etag: 'W/"2-eoX0dku9ba8cNUXvu/DyeabcC+s"',
res.headers { 'x-powered-by': 'Express',
etag: 'W/"2-eoX0dku9ba8cNUXvu/DyeabcC+s"',
'set-cookie':
res.headers { 'x-powered-by': 'Express',
etag: 'W/"2-eoX0dku9ba8cNUXvu/DyeabcC+s"',
``` @zandaqo Thanks for the suggestion.  # [Codecov](https://codecov.io/gh/facebook/jest/pull/3546?src=pr&el=h1) Report
```diff
Branches        6        6
Misses       2525     2525
Partials        3        3
```diff
Branches        6        6
Misses       2525     2525
Partials        3        3
```diff
Branches        6        6
Misses       2525     2525
Partials        3        3
**bug**
I'm unsure what's happened, but maybe a diff will help reveal what's going on.
```diff
index 242ccad0ed..9abc83cdb3 100644
--- a/tests/jest.config.client.json
+++ b/tests/jest.config.client.json
"roots": [
-  "testEnvironment": "jest-environment-jsdom",
**bug**
"jest": {
```diff
Branches        6        6
Misses       2528     2528
Partials        3        3
```diff
Branches        6        6
Partials        3        3
```diff
Branches        6        5       -1
Misses       2528     2528
+ Partials        3        2       -1
> Powered by [Codecov](https://codecov.io/gh/facebook/jest/pull/3537?src=pr&el=footer). Last update [afb4f7c...682995e](https://codecov.io/gh/facebook/jest/pull/3537?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).
```diff
"snapshotSerializers": [
I've got some code here:
Giant Machines is a techology consultancy that authors primarily in React and React Native.  Our clients include many Fortune 500 companies.
```diff
Branches        6        6
Misses       2528     2528
Partials        3        3
> Powered by [Codecov](https://codecov.io/gh/facebook/jest/pull/3533?src=pr&el=footer). Last update [afb4f7c...0a230bf](https://codecov.io/gh/facebook/jest/pull/3533?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).
Unsupported
return nightmare
.goto('/en-gb/home')
return nightmare.end();
test('en-gb home looks the same', () => {
let screenshotBuffer = nightmare.screenshot();
```javascript
const b = new Error ('foo')
```javascript
if (a instanceof Error && b instanceof Error) {
**Jest Version**
*bug*
Jest 20.0.0
*bug*
Jest 20.0.0
OSX Sierra
const fn = jest.fn();
[undefined, {"fizz": "buzz", "foo": "bar"}]
http://facebook.github.io/jest/docs/es-ES/getting-started.html
Bug.
It's broken
const isCurrentlyBuggy = true;
function sometimesBuggyFunc(callback) {
if (isCurrentlyBuggy) {
// to hang until jasmine default timeout is reached.
sometimesBuggyFunc(actual => {
expect(actual).toBe('foo');
<polyline
The **second** problem I found while studying the code in `pretty-format` and its plugins. It might become a more than theoretical problem when React components can render fragments.
because the total indentation at that point is used incorrectly as one level increment.
Jest 19.0.2 and Node 7.10.0
There is some irony in the digital archaeology or cultural anthropology:
* over-indented props or children **child elements**
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
* `jest@20.0.0`
* `jest-cli@20.0.0`
* `babel-jest@20.0.0`
*bug*
Jest 20
I've been thinking some more about a non hack way to fix the test on windows. I really like the slash idea, so I was thinking that something simple like this could do the job.
```javascript
```javascript
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
```diff
- Misses       2525     2529       +4
Partials        2        2
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
- jest: 20.0.0
```ruby
"name": "auth",
"test": "jest"
"babel-jest": "19.0.0",
"jest": "19.0.2",
"jest": {
But I want `toContain()` to behave like `toContainEqual()` (to match jasmine behavior).
```diff
Misses       2525     2525
Partials        2        2
```diff
Branches        5        6       +1
- Misses       2525     2528       +3
- Partials        2        3       +1
Feature request and/or unexpected behavior
undefined
```diff
Misses       2525     2525
Partials        2        2
```diff
Misses       2525     2525
Partials        2        2
Bug
nano .jestrc.json
Jest config:
"vue"
See the [CI build](https://circleci.com/gh/aurelia/skeleton-navigation/322) output, the step named: `cd skeleton-typescript-webpack && yarn start -- test.all`:
[jest] All files         |    14.49 |     2.44 |    26.83 |    14.14 |                |
[jest]  src              |        0 |        0 |        0 |        0 |                |
[jest]   blur-image.ts   |        0 |        0 |        0 |        0 |... 316,317,318 |
[jest]  src/src          |    90.91 |       50 |    78.57 |    89.13 |                |
[jest]   app.ts          |      100 |      100 |      100 |      100 |                |
[jest]   child-router.ts |      100 |      100 |      100 |      100 |                |
```bash
- Jest 20.0
"jest": {
"<rootDir>/test/jest-pretest.ts"
"aurelia-(.*)": "<rootDir>/node_modules/$1"
*bug*
Jest: 20.0.0
```diff
Misses       2525     2525
Partials        2        2
BUG
Error: Cannot find module 'ansi-regex'
npm i -D jest@20.0.0
Jest configuration from the package.json:
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
‚óè Validation Error:
In /Users/evgueni.naverniouk/Git/ux
"jest": {
I opened #3613 for that @bumbu yeap. Found the culprit to be this line: https://github.com/facebook/jest/blob/master/packages/jest-config/src/index.js#L50.
```diff
Misses       2525     2525
Partials        2        2
> jest --runInBand
Error: Cannot find module 'ansi-regex'
If one has to dive into the transpiled code in Jest, having it be pretty is a good thing.
```diff
- Misses       2525     2542      +17
Partials        2        2
```diff
Misses       2525     2525
Partials        2        2
2 outstanding issues:
1. 2 failing tests
Bug
Jest 20.0 (Previously used 19.0.2)
Running `jest --coverage` in my repo reports undefined under the Uncovered Lines column, while previously it was left empty.
```diff
Misses       2525     2525
Partials        2        2
Bug
Jest deserves a favicon üòä
```diff
Branches        6        6
Misses       2529     2529
Partials        3        3
I can't manage to fix the favicon for safari. Even after deleting the cache, I have the same favicon.
```diff
Misses       2525     2525
Partials        2        2
```diff
Partials        2        2
bug
```diff
Misses       2526     2526
Partials        2        2
```diff
Misses       2526     2526
Partials        2        2
Jest website shows an errors that I don't know what is this.
at /home/ubuntu/jest/website/node_modules/react-page-middleware/src/guard.js:27:12
at renderReactPage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/renderReactPage.js:130:17)
at renderComponentPackage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/DefaultRouter.js:331:3)
at routePackageHandler (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/DefaultRouter.js:274:5)
at onComputePackage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/index.js:100:9)
at /home/ubuntu/jest/website/node_modules/react-page-middleware/src/guard.js:29:10
at onWarmed (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/Packager.js:270:9)
```diff
Misses       2525     2525
Partials        2        2
"jest": {
"istanbul",
```diff
Partials        2        2
Though, granted, it‚Äôs an advanced use case, you cannot expect the config to fully address it. For the record, it looks like that‚Äôs (*i.e., using a custom transformer*) how [typescript does that](https://github.com/facebook/jest/blob/master/examples/typescript/package.json#L16), along with a bunch of other frameworks. Reporting back as a responsible citizen :)
This is the transformer that I used:
```javascript
plugins: [ 'istanbul', 'transform-es2015-modules-commonjs' ]
```javascript
"jest": {
And, yep, my transformer is named **Optimus Prime** üöö ü§ú ü§ñ
```diff
- Misses       2525     2526       +1
Partials        2        2
> oh! hey @scamden <https://github.com/scamden>! this is random üòÑ
> babel, parse, transpile, etc..)
> <https://github.com/notifications/unsubscribe-auth/ABE5mLi3sCoIQJUMnU8QqJUhbEkwwRezks5r4QhkgaJpZM4NRbaU>
- make consumers provide the babel global runtime (but gives a pretty bad DX)
```diff
Misses       2525     2525
Partials        2        2
@cpojer will you do a beta release of this? Seems like `ansi-styles` uses some syntax phantom is not happy about.
```diff
- Misses       2382    2384       +2
Partials        2       2
```diff
- Misses       2382     2525     +143
Partials        2        2
```ansi-escapes
ansi-regex
ansi-styles
babel-core
babel-eslint
babel-plugin-istanbul
babel-plugin-jest-hoist
babel-preset-jest
babylon
diff
fb-watchman
halk
is-ci
istanbul-api
istanbul-lib-coverage
istanbul-lib-instrument
istanbul-lib-source-maps
jsdom
pify
slash
throat
worker-farm
yargs
Bug
See https://github.com/gotwarlost/istanbul/issues/397 Aww snap  # [Codecov](https://codecov.io/gh/facebook/jest/pull/3469?src=pr&el=h1) Report
```diff
Partials        2       2
```diff
Partials        2       2
```diff
Partials        2       2
Jest 19.0.2, Node 7.9.0 on macOS 10.12.4
verbose: false
// js
verbose: false
Bug
/cc @vjeux  Thanks for doing this, and so sorry for the churn :( # [Codecov](https://codecov.io/gh/facebook/jest/pull/3460?src=pr&el=h1) Report
```diff
Partials        2       2
```diff
Misses       2384     2384
Partials        2        2
Sorry for the confusion.  # [Codecov](https://codecov.io/gh/facebook/jest/pull/3455?src=pr&el=h1) Report
```diff
Misses       2384     2384
Partials        2        2
```diff
Misses       2384     2384
Partials        2        2
jest.setEnvinroment({node: false, browser: true});
In regards to the use of "use strict" there remains to be an issue with following file:
Find files processible by babel with "use strict" (should be no files)
packages/jest-jasmine2/src/jasmine/createSpy.js
packages/jest-jasmine2/src/jasmine/Env.js
```diff
Branches        6        6
Partials        3        3
A bug.
Jest Config:
"jest": {
Jest Version: 19.0.2
```diff
Branches          ?        5
Misses            ?     2376
Partials          ?        2
Bug
```javascript
<summary>.jestrc</summary>
``` Not sure how i should replicate our private monorepo setup publicly. ü§î
Your right, O(n*m) is more accurate.
```diff
- Misses       2356    2404      +48
Partials        2       2
```diff
- Misses       2365     2371       +6
Partials        2        2
```diff
Partials        2        2
```bash
- jest: 19.0.2
- mac: Sierra 10.12.4 (16E195) This problem exists with the following versions
```bash
Jest v20.0.4
```diff
Partials        2        2
```diff
Branches        4        5    +1
Partials        2        2
```diff
Branches        6        6
- Misses       2529     2534       +5
Partials        3        3
```diff
Branches        4        4
- Misses       2365     2367       +2
Partials        2        2
**Baseline diff** is less clear:
```diff
```diff
```diff
Branches        6        6
Misses       2812     2812
Partials        3        3
| [packages/pretty-format/src/plugins/convert\_ansi.js](https://codecov.io/gh/facebook/jest/pull/3429?src=pr&el=tree#diff-cGFja2FnZXMvcHJldHR5LWZvcm1hdC9zcmMvcGx1Z2lucy9jb252ZXJ0X2Fuc2kuanM=) | `100% <100%> (√∏)` | :arrow_up: |
The last two items bring up a question about an inconsistency:
Thanks go to @cpojer for giving me the little encouragement for which I'd hoped!
Even without the coverage area (which I could disable) jest has a lot of verbal cruft that takes up at least 16 lines.
jest -i
jest --immersive
2. set `verbose=false`
/cc @anilreddykatta
```diff
Branches        4        4
- Partials        1        2       +1
@SimenB Awesome! Thanks üòÑ
- yarn
```diff
Branches        4        5       +1
- Partials        1        2       +1
```diff
Partials        2        2
yarn jest-coverage v0.23.3
‚óè Unrecognized CLI Parameters:
If I'm misunderstanding the issue this is supposed to fix I can open up a separate issue for it üòÑ It does work now! Should support kebab in addition to camel cased, though üòÑ
yarn jest-coverage v0.23.3
‚óè Unrecognized CLI Parameter:
Unrecognized option "coverage-reporters". Did you mean "coverageReporters"?
```diff
Branches        6        6
Partials        3        3
```diff
Branches        4        4
Partials        1        1
```diff
Branches        4        4
Partials        1        1
jest.dontMock('yargs');
Current jest config is:
"jest": {
```diff
Branches        4       4
- Misses       2361    2365       +4
Partials        1       1
```diff
Partials        2        2
import sortBy from 'lodash-es/sortBy';
```diff
Partials        2        2
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug.
jest: 19.0.2
```diff
Branches        4        4
Misses       2349     2349
Partials        1        1
```diff
Branches        4        4
- Misses       2349     2352       +3
Partials        1        1
> Powered by [Codecov](https://codecov.io/gh/facebook/jest/pull/3411?src=pr&el=footer). Last update [ff48178...b5baabe](https://codecov.io/gh/facebook/jest/pull/3411?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).
```diff
Branches        4        4
Partials        1        1
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
```diff
Branches        4        4
- Misses       2335     2345      +10
Partials        1        1
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
Bug
Jest configuration: default
Jest version: v19.0.2
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
```diff
Partials        2        2
```diff
Branches        4        4
- Misses       2335     2339       +4
Partials        1        1
> Powered by [Codecov](https://codecov.io/gh/facebook/jest/pull/3399?src=pr&el=footer). Last update [33dceab...21622c3](https://codecov.io/gh/facebook/jest/pull/3399?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
```diff
Branches        4        4
Misses       2335     2335
Partials        1        1
```diff
Branches          ?        4
Misses            ?     2342
Partials          ?        1
Bug
https://facebook.github.io/jest/ displays
Error: Error: Requiring unknown module "./i18n/af.js". It may not be loaded yet. Did you forget to run arc build? at /home/ubuntu/jest/website/node_modules/react-page-middleware/src/guard.js:27:12 at onOutputGenerated (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/index.js:96:9) at Object.done (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/DefaultRouter.js:345:7) at renderReactPage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/renderReactPage.js:130:17) at renderComponentPackage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/DefaultRouter.js:331:3) at routePackageHandler (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/DefaultRouter.js:274:5) at onComputePackage (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/index.js:100:9) at /home/ubuntu/jest/website/node_modules/react-page-middleware/src/guard.js:29:10 at onWarmed (/home/ubuntu/jest/website/node_modules/react-page-middleware/src/Packager.js:270:9) at /home/ubuntu/jest/website/node_modules/async/lib/async.js:116:25
Open https://facebook.github.io/jest/
Change to babel-jest had been reverted.
> running yarn and reverting the change to babel-jest?
```diff
Branches        4        4
Misses       2342     2342
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
Because of the way jest packages are set up, if you:
The exact version of jest should be installed.
"jest-cli": "^18.0.0"
So it is certainly a bit of an edge case and not really a blocking/high-priority issue in my case.
```diff
Branches        4       4
Misses       2342    2342
Partials        1       1
```diff
Branches          ?        4
Misses            ?     2335
Partials          ?        1
```diff
Partials        2        2
Bug
1. Go to https://facebook.github.io/jest/
By the way, here are two alternative concise solutions from other repositories:
```diff
Branches        4        4
Partials        1        1
```diff
Branches        4        4
Misses       2342     2342
Partials        1        1
Bug
RAM
Disks
jenkins should perform the jest command to the end.
RAM
Disks
14. Under "Source Code Management", select the radio "git" and add the following repository url : `https://github.com/kopax/jest-crashing-jenkins`
abf10c67f072        jenkins                 "/bin/tini -- /usr/lo"   About an hour ago   Up About an hour    0.0.0.0:8080->8080/tcp, 50000/tcp   reverent_saha
"cpus": 2,
"mode": "RW"
"mode": "RW"
"mode": "RW"
"mode": "RW"
It's only in mesos where the container get killed with an exit code 137 :
```diff
Branches          ?        4
Misses            ?     2342
Partials          ?        1
```diff
Branches        4        4
- Misses       2355     2361       +6
Partials        1        1
```diff
Branches        4        4
Misses       2288     2288
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
jest mocks do not track return values. This is a feature that is supported by sinon spies.
jest.spyOn(MyComponent.prototype, 'loadUser');
```diff
Branches        4       4
Partials        1       1
test('dir defaults to YARN_CACHE_FOLDER env var', async (): Promise<void> => {
process.env.YARN_CACHE_FOLDER = tempFolder;
// restore env
```diff
Branches        4        4
Misses       2288     2288
Partials        1        1
```diff
Branches        4        4
Misses       2288     2288
Partials        1        1
```diff
Branches        4        4
- Misses       2288     2294       +6
Partials        1        1
```diff
Branches        4        4
Misses       2288     2288
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
"jest": "~19.0.2",
"jest-cli": "~19.0.2",
"jest": {
"roots": [
```diff
Branches        4        4
- Misses       2288     2342      +54
Partials        1        1
Bug üêõ
jest v19.0.2
@thymikee
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug (?)
yarn jest
"jest": "^19.0.2"
However, i'm getting this strange error in the last test where it tests for calling componentDidMount
import { expect } from 'chai';
import sinon from 'sinon';
return 'someToken';
<App>
<div className='unique' />
sinon.spy(App.prototype, 'componentDidMount');
"babel-jest": "^19.0.0",
"chai": "^3.5.0",
"jest": "^19.0.2",
"node-sass": "^4.5.2",
"sass-loader": "^3.2.0",
"sinon": "^2.1.0",
Reviewers: adr
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
Bug
```JS
```JS
```JS
Do you want to finish it? I feel bad for not checking the issue before doing that üò¢  @mxstbr I will take a look at it! @mxstbr I was not able to update pull request raised by you. I raised one more incorporating your changes along with feedback from @cpojer. Let me know if I need to add any more changes. Thanks üòÑ  Yay! Thanks @cpojer @mxstbr @thymikee   Replaces Object, any or Function types with stronger types # [Codecov](https://codecov.io/gh/facebook/jest/pull/3358?src=pr&el=h1) Report
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
`yarn jest`
```diff
Branches        4        4
- Misses       2352     2355       +3
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2288     2288
Partials        1        1
import { expect } from 'chai';
import sinon from 'sinon';
<App>
<div className='unique' />
sinon.spy(App.prototype, 'componentWillMount');
"babel-jest": "^19.0.0",
"chai": "^3.5.0",
"jest": "^19.0.2",
"node-sass": "^4.5.2",
"sass-loader": "^3.2.0",
"sinon": "^2.1.0",
Bug
- "jest": "^19.0.2" Because you're calling the factory function in both your test and the file you're testing, you're creating two different loggers. To address this you could mock the logger factory such that it always returns the same object no matter how many times it's called.  That makes total sense @jwbay, thanks for pointing that out.
```diff
- Misses       2365     2404      +39
Partials        2        2
```diff
Branches        4        4
- Misses       2283     2288       +5
Partials        1        1
Documenting an undocumented function.
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
In future we want to have a way to use `.babelrc` (or similar) for babylon, but we are not there yet.
//cc @orta
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
Testing Asynchronous Code
An Async Example
Manual Mocks
Migrating to Jest
API Reference
Globals
The Jest Object
Jest CLI Options
Jest 19.0.2
"jest": {
"./.jestsetup.js"
"node_modules/(?!(jest-)?react-native|react-navigation)"
"snapshotSerializers": [
// .jestsetup.js
openURL: jest.fn(),
canOpenURL: jest.fn(),
getInitialURL: jest.fn()
React.NativeModules.RNBranch = {};
> Closing, after deeper debugging while writing a test for it, turned out to be an internal Jest thing. Thanks anyway! :)  Hello Jesters,
I've never used Travis before but give me a couple minutes I'll add it. OK I tested, the test passed on Travis with node 5, 6, 7 and on Circle with node 6.10. Pretty weird.. OK finally found the bug! Jest was actually working and mocking Date.now() correctly but I'm on Australian timezone when I'm running my tests locally and the CI servers are on UTC. As my tests had snapshots, the code is time dependant and uses 'moment.js'. I suppose there is a timezone handling system in the moment.js code that checks what your timezone is. This means that my code was working well and the mock as well but the snapshot where different because the time they received was different. I managed to fix it by adding a timezone setting in my CI file. I should have tried it before but really I wasn't expecting something like that. Feel free to close the issue =D  Fix issue #3335.
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
Wow, that was fast! Thanks @liubinyi!  # [Codecov](https://codecov.io/gh/facebook/jest/pull/3339?src=pr&el=h1) Report
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
Branches        4       4
Misses       2342    2342
Partials        1       1
"antd-mobile": "^1.0.8",
"lodash": "^4.17.4",
"react-native-gesture-password": "^0.2.0",
"react-native-smart-gesture-password": "^2.1.0",
"babel-jest": "^19.0.0",
"babel-plugin-dva-hmr": "^0.3.2",
"jest": "^19.0.2",
3. <b>.babelrc</b>
"presets": ["react-native"],
"presets": ["react-native"],
import 'react-native';
![img](http://imgur.com/T9rnAAL.jpg)
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
Warning:
Warning: Shallow renderer has been moved to react-test-renderer/shallow. Update references to remove this warning.
Jest spits out each error individually without any summary at the end of run about which tests failed (individual files)
```diff
Branches        4        4
Misses       2283     2283
Partials        1        1
```diff
--- i/packages/jest-mock/src/index.js
```diff
Branches        4        4
- Misses       2283     2284       +1
Partials        1        1
```diff
Branches        4        4
Misses       2284     2284
Partials        1        1
```diff
Branches        4        4
+ Misses       2284     2283       -1
Partials        1        1
```diff
Branches        4       4
- Misses       2283    2293      +10
Partials        1       1
‚óè Validation Error:
/cc @jkimbo  I'm not good enough at Flow to resolve the type error... Too bad eslint does not have an official flow typing.
```diff
// only a few properties are allowed
// matcher was not called
``` @wyze Thank you, I could remove the suppression now!
TBH I don't get why that should matter (I tried doing `const grandparent: MemberExpression = node.parent.parent;` inside the `if`, but that made it complain more).
```diff
Branches        4        4
Misses       2336     2336
Partials        1        1
```diff
Branches        4       4
Misses       2336    2336
Partials        1       1
```diff
Branches        4       4
Misses       2336    2336
Partials        1       1
```diff
Branches        4       4
Misses       2336    2336
Partials        1       1
(I'm coming from the KaTeX development side, so I'm a little lost on the sense in which Jest even has a web browser in it... DOM simulation perhaps?  Apologies if this issue is actually farther upstream, or if there already is an option to override...)  # [Codecov](https://codecov.io/gh/facebook/jest/pull/3298?src=pr&el=h1) Report
```diff
Branches        4        4
+ Misses       2336     2300      -36
Partials        1        1
- `jest --showConfig` outputs config and exits.
```diff
Branches        4        4
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
yarn add --dev jest
./node_modules/.bin/jest
```  **bug**
"jest": {
"roots": [
```diff
Branches        4        4
Misses       2336     2336
Partials        1        1
```diff
Branches        4        4
Misses       2336     2336
Partials        1        1
```diff
Branches        4        4
Misses       2336     2336
Partials        1        1
Bug
Couldn't find preset "react-native" relative to directory "demo/sub/ux/node_modules/my-linked-module/node_modules/react-apollo"
(My modules have no direct dep on "react-native", but there's a transitive dep via "react-apollo")
jest: v19.0.2
"jest": {
.babelrc
Bug
"snapshotSerializers": [
```diff
Branches        4        4
Misses       2336     2336
Partials        1        1
Jest configuration can be found in the provided repo. I'm using node 6.9.2, npm 3.10.9 and yarn 0.19.1. I'm on MacOS Sierra 10.12.4.
```diff
Branches        4        4
Misses       2300     2300
Partials        1        1
The new tests were adapted from a similar set of tests in Jasmine.
```diff
Branches        4        4
Misses       2300     2300
Partials        1        1
<img width="929" alt="screen shot 2017-04-09 at 09 11 46" src="https://cloud.githubusercontent.com/assets/19558321/24835519/ab1a92c0-1d04-11e7-818b-36c35d51e38c.png">
1. The comments at the top of the test still refer to `try-catch`, this is inconsistent with the code contained in the code snippets.
Adds support for Babel 7:
```diff
Branches        4        4
Misses       2300     2300
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
When running jest tests after updating to react 15.5.0 and migrating to the new external proptypes package all specs give the deprication warning
## Jest v19.0.2
"jest": {
"snapshotSerializers": [
"name": "wheniwork-js",
"jest": {
"snapshotSerializers": [
"babel-jest": "^19.0.0",
"babel-plugin-istanbul": "^3.0.0",
"faker": "^3.1.0",
"gitlab-yaac": "^0.0.4",
"isparta": "^4.0.0",
"jest": "^19.0.2",
"knox-mpu": "^0.1.6",
"lolex": "^1.5.1",
"node-sass": "^4.1.1",
"lodash": "^4.17.4",
"redux": "^3.5.2",
## Versions
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug üêõ
Errors thrown in `afterAll` are caught somewhere in Jest, and can cause a test suite to fail silently.
description: 'Jasmine2Reporter',
fullName: 'Jasmine2Reporter',
error:
Error: asdf
"morgan": "~1.7.0",
"jest": "^19.0.2",
"jest-cli": "19.0.2"
## Code
![Forcing a jest error](https://cloud.githubusercontent.com/assets/19743416/24774759/6b8bec26-1b1a-11e7-857f-a6040de99e4f.png)
password        : 'pass',
/dao
/src/catalog/dao|
```diff
Branches        4        4
- Misses       2299     2341      +42
Partials        1        1
Bug
```diff
Branches        4        4
Misses       2300     2300
Partials        1        1
```diff
Branches        4        4
Partials        1        1
```diff
Branches        4       4
Partials        1       1
```diff
Branches        4        4
Partials        1        1
at NodeWatcher.watchdir (/home/fooBar/.config/yarn/global/node_modules/sane/src/node_watcher.js:148:20)
at /home/fooBar/.config/yarn/global/node_modules/walker/lib/walker.js:69:16
at go$readdir$cb (/home/fooBar/.config/yarn/global/node_modules/graceful-fs/graceful-fs.js:149:14)
``` @cpojer  not sure if you read the issue, but;
jest --watch
```diff
Branches        4       4
Partials        1       1
- Jest: 19.0.2
@thymikee many thanks, especially for the super fast reply :+1:   **Do you want to request a *feature* or report a *bug*?**
Jest v19.0.2
Mac OS X 10.12.3 @dmitriiabramov when you guys thought about this before, did you have anything specific in mind? @dmitriiabramov would it be possible to save the stack trace for the errors as well? if you're messy like I am and coming back into some code after time away and you're not certain where your tests are timing out at, it just takes longer. Thanks in advance! I'm on vacation for the next few weeks, but I'd be happy to have a go at this when I'm back! A small workaround I've figured out. Use `setupFiles` configuration option and create a simple file like this. If you need it for a browser, just [check out this.](http://2ality.com/2016/04/unhandled-rejections.html).
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
jest should mark the test as failure
import axios from 'axios';
import Apis from '../Apis';
api: Apis.getActivationApi(99),
api: Apis.getActivationApi(98),
```diff
Branches        4       4
Partials        1       1
```diff
Branches        4       4
- Misses       1953    2340     +387
Partials        1       1
~/project/abc
In the above example, the `.snap` files will be output in `~/project/abc/__snapshots__` directory.
_**Note:** There is some extra noise in `failures-test.js` and `BabylonParser.js` that I got when I ran the code through prettier. No actual changes were made in those files._
I agree @thymikee. I know he was hesitant to add it at first, then had a direction he wanted to go with it and then was against it. So hopefully, one way or another we can get a feature like this merged. :) I've probably ranted enough about this in the original thread, but just so as the comment is attached here. I don't really understand why i'm still being forced to accept the \_\_snapshots\_\_ directory naming in my source tree. That's a very stylistic opinion to be enforced upon the users of a testing tool in my opinion.
Hey @cpojer, glad to have you back!
I will probably spend a bit of time looking for a hack that lets me do something like \<ROOT\>/.jest/snapshots, because I think, ultimately, this will give us more consistency with the way some of our other tools work.
Meanwhile though, I am aware that I am perhaps starting another rant here and should step back and leave all this in the far more capable hands of yourself and @wyze.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
console.error = jest.fn((error) => {
console.error('foobar');
```diff
Branches        4        4
Partials        1        1
- Mocha: https://mochajs.org/
- AVA: https://github.com/avajs/ava
1 verbose cli [ '/home/xin/.nvm/versions/node/v7.5.0/bin/node',
1 verbose cli   'run',
1 verbose cli   'test:jest:watch' ]
4 verbose run-script [ 'pretest:jest:watch',
4 verbose run-script   'test:jest:watch',
4 verbose run-script   'posttest:jest:watch' ]
14 verbose stack Exit status 1
16 verbose cwd /home/xin/work/desktop-frontend
21 error code ELIFECYCLE
23 error     jest --watch
```diff
Branches        4        4
- Misses       2300     2301       +1
Partials        1        1
Bug
Rewrites `TreeProcessor` (now `treeProcessor`) and pulls it out of `jasmine`.
Hard to describe but I think this will help illustrate what I mean:
- jest: `master@4 hours ago`
```javascript
```javascript
```javascript
If i remove the `jest.mock` line then i get the following error:
- babel-jest: "19.0.0"
- jest: "19.0.2"
I am not sure, but i think this was working when we used `proxyrequire` and this was broken when we switched from `ava` to `jest`.
Bug
Jest:
```bash
Mocha:
```bash
You may be interested in this: https://github.com/kentcdodds/ama/issues/233 @kentcdodds That's great! Thanks for the advice.
```diff
Branches        4       4
- Misses       2300    2335      +35
Partials        1       1
Test Suites: 1 failed, 128 passed, 129 total
"jest": {
"runInBand": true
The lack of this feature may potentially confuse other developers on my team who attempt to run the jest tests without being explicitly aware the tests are dependent on the --runInBand flag being present, thus observing a broken test suite.
$ jest
Unknown option "runInBand" with value true was found.
### Bug 1
### Bug 2
**Jest** v19.0.2
¬ª jest 20.0.4
Would it be possible to add an option for watch to not clear the screen? Perhaps something like --watch --noclear.
My jest config:
"jest": {
"babel": {
"jest": "18.1.0",
Another variation, propesed by stackOverflow has some interesting results:
jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000;
@thymikee,
Please not that I have set the jasmine default timout interval to 10s in order to compensate for the 1sec timer.
I was calling `jest.useFakeTimers();` in a previous test - this is why the mock setTimeout test timed out. After setting up a separate project and running only this test I can see that everything is working as expected.
"jest": {
"jsx"
.babelrc
"es2015": {
"react-hot-loader/babel",
"lodash"
"babel-jest": "^19.0.0",
"jest": "^19.0.2",
"jest": {
jest version = 19.0.2
test framework = jasmine2
"cacheDirectory": "/var/folders/kz/gn_dfwpd5w19y1dbt5gpmxl40000gn/T/jest",
"jsx",
"roots": [
"presets": ["es2015", "stage-1", "react", "flow"],
* Use ‚Äòlemon‚Äô/‚Äòoctopus‚Äô in Expect API docs.
```diff
Branches        4        4
Partials        2        2
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
-a.c.js
-a.g.js
@thymikee
|- foo.js
* in *Jest* it requires `foo.js`
Bug found on
osx
Jest 19.0.2
Please let me know if you need more information to find the underlying issue. Thank you. And thank you for the time spent on Jest!
`eslint-plugin-jest` hard codes an env.
## Caveat
<Icon glyph="icon-fontello-save" /> Save </button>
This throws an error saying Icon is not defined in the SomeComponent.js. I'm not using any icon library(may be I'm ==>"fontello"), if so how do I let know the jest test that Icon is valid. Thanks. The work around was to use a span instead of Icon.
<Icon glyph="icon-fontello-save" /> Save </button>
<span glyph="icon-fontello-save" /> Save </button>
```diff
Branches        4        4
Misses       2482     2482
Partials        1        1
A **bug** in snapshots.
$ cd ant-design-issue_5428
"antd": "^2.8.2",
Jest: ^19.0.2
Jest config: default
Running: jest --verbose --no-cache
> jest --verbose --no-cache
```diff
Branches        4        4
Misses       2482     2482
Partials        1        1
Unclear, hopefully just a bug?
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
Rewrites `QueueRunner` (now `queueRunner`) and pulls it out of `jasmine`.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
mbroadst@gorgor:~/Development/jest-arraybuffer-issue (master %)$ node --version
mbroadst@gorgor:~/Development/jest-arraybuffer-issue (master %)$ node
mbroadst@gorgor:~/Development/jest-arraybuffer-issue (master %)$ node --version
mbroadst@gorgor:~/Development/jest-arraybuffer-issue (master %)$ node
Pulls `expectationResultFactory` out of `jasmine`.
In `jest`?  Nowhere, really.  But it's used in `Spec` and `Suite`, so it's a prerequisite to pulling those out of `jasmine`.
>       at Object.<anonymous> (tests/abc/Something.test.js:27:67)
>     "material-ui": "^0.17.0",
>     "babel-jest": "^19.0.0",
>     "chai": "^3.5.0",
>     "jest": "^19.0.2",
>     "moxios": "^0.3.0",
https://github.com/rachelrab/jest-test
The comments are at file - src/utils/AbcUtils.js
npm ERR! Darwin 15.6.0
npm ERR! argv "/usr/local/bin/node" "/usr/local/bin/npm" "i" "-D" "jest"
Adds Kickstarter to list of Jest users.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
## Config
"jest": {
"snapshotSerializers": [
@thymikee oh im aware of the messaging in the notification, my discrepancy is that it used to just exit, it would be nice if that could be re-enabled with a flag or what have you. My initial thought was to have a way to change the notification type i.e.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
```javascript
if (code !== 0) {
jest 19.0.2
```javascript
```javascript
```javascript
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
```bash
@cpojer I don't _really_ know, but a quick google suggests not usually but that some people do. I prefer none, but this is a crazy thing to bikeshed so I'm happy to add them if you'd like hehe.
Reference: https://github.com/eslint/eslint/issues/8173 I'm willing to implement this if I could get some direction. I'm working on this right now (just fudging with my local `node_modules` to start) and I'm finding that `jest-jasmine2` has an odd sort of build or something because even though the file you referenced is `src/jasmine/Spec.js`, the file that code is in is `vendor/jasmine-2.5.2.js` and I'm unable to require anything in it (`require is undefined`). I need to get `diff` (from `jest-diff`), `matcherHint`, `printExpected`, and `printReceived`. Any tips on a good workflow for developing this? Also, when I add a `message` to the `addExpectationResult`, I don't see any change in the output, but if I change the `matcherName` to some value other than the empty string it is now, then I see the message I provided. Sounds like black magic. Any tips on what I should do there? Oh, and also `jest-jasmine2` does not currently depend on `jest-diff` so I'll need to add that to the dependencies. Any reasons to not? HOORAY!!!! Thank you @thymikee, @dmitriiabramov, and @cpojer! This is going to make my ASTs Workshop soooo much better. Developing the fixer function for ESLint will be much improved. Thank you thank you :)
```diff
Branches        3        3
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Interactive watch mode
29 of these fall under the conditions enforced by dangerfile:
Only 13 of those will be processed by babel:
It does indeed break tests for Node 7.3.
https://github.com/mpontus/jest
```bash
```bash
@cpojer
```diff
Misses            ?     2615
Partials          ?        1
Bug
Jest: v19.0.2
"jest": {
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
"jest": {
Ouch, I didn't notice that. I'm +1 to reopening this, or some sort of similar issues that resolves the use case of selectively disabling coverage from the command line without duplicating configuration. @cpojer could you please reconsider your decision? At least three people are voting for reopening this issue (at least to discuss it). Personally I would prefer having more options exposed as command line flags, or having a flag similar to `--config` that combines options instead of replacing them entirely. I think it would be confusing to need to have a JavaScript based config in a different place just to change certain features at the command line (or a build tool that calls the command line interface). However, I'm not against the JS config otherwise since it could be useful for automation.  I don't think there's any way to detect the new line from code.
foo
bar
Splits `jasmine-light` over multiple files.  Removes unused exports as a side-effect.
I didnt know that jest use istanbul
If I have to report this to someone else i have to know how jest interact with istanbul .. or something else @rogeliog @cpojer istanbuljs-archived-repos/istanbul-api seems to be a bit dead
lol `archived`-repos .. i just realized.
Where i can report an istanbul issue? ..xdd trying to get help from everywhere The problem is about `eval` sentence. Which is often used in my library because I have to mutate some methods/expressions.
The solution is about tell istanbul to bypass these declarations.
```diff
Branches        3        3
Misses       2632     2632
Partials        1        1
```diff
Branches        4        4
- Misses       2276     2284       +8
Partials        1        1
```diff
Branches        3        3
Misses       2632     2632
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
```javascript
jest - v19.0.0
Coming from a Jasmine background, it feels a bit _clunky_ having to manually specify the test suite, specially when switching between many suites:
$ jest -i -t <pattern>
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
Error
Difference:
Error
Difference:
fix-eqeqeq
Test Suites: 1 failed, 1 total
"jest": {
"roots": [
"jscodeshift": "^0.3.30"
```diff
Misses            ?     1694
Partials          ?        1
"jest": {
The hope here is two things:
To to use `toEqual` matcher in `expect.extend`, one needs to call `jasmine.matchersUtil.equals`.
"test": "jest"
"jest": "^19.0.2"
mod.asyncMethod = jest.fn();
```diff
Branches        3        3
Partials        1        1
```diff
Branches        3        3
Partials        1        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
https://github.com/Lokua/throw-away-jest-repro.
Now, change `.bablerc` to look like the following:
jest 19.0.2
OSX El Capitan 10.11.5
```diff
Misses            ?     1705
Partials          ?        1
```diff
Branches          ?       3
Misses            ?    1699
Partials          ?       1
Test Suites: 1 failed, 1 total
``` @cpojer
```bash
cd /jest
```diff
Branches        3       3
Partials        1       1
Using `toBe` is fine. However, I've seen people not that familiar with Jest/Javascript testing frameworks (and even people who were, to be honest) to use `toBeTruthy` and `toBeFalsy` for that purpose because it sounds close enough to what they mean, and because they found those in the documentation.
```diff
Branches        3       3
- Misses       1686    1702      +16
Partials        1       1
I know this would be a breaking change for people who rely on the chaining behaviour, but maybe it could still be considered?
Hoists calls to `normalize` in `jest-config` from `readRawConfig`, `loadFromFile`, and `loadFromPackage` to `readConfig`.
```diff
Branches        3       3
Partials        1       1
"babel-jest": "^18.0.0",
"jest-cli": "18.1.0",
"jest-react-native": "16.0.0",
babel-jest@19.0.0
babel-plugin-jest-hoist@19.0.0
babel-preset-jest@19.0.0
jest@19.0.2
jest-changed-files@19.0.2
jest-cli@19.0.2
jest-config@18.1.0
jest-diff@18.1.0
jest-environment-jsdom@18.1.0
jest-environment-node@18.1.0
jest-haste-map@18.1.0
jest-jasmine2@18.1.0
jest-matchers@18.1.0
jest-message-util@19.0.0
jest-mock@18.0.0
jest-regex-util@19.0.0
jest-resolve@18.1.0
jest-runtime@19.0.2
jest-snapshot@18.1.0
jest-util@18.1.0
jest-validate@19.0.2
"babel-cli": "^6.24.1",
"babel-jest": "^19.0.0",
"jest": "^19.0.2",
"lodash": "^4.17.4",
"proxyquire": "^1.7.11",
"redux-form": "^6.6.3",
"sinon": "^2.2.0",
"@kadira/storybook": "^2.21.0",
"faker": "^4.1.0",
```yml
```bash
Test Suites: 9 failed, 9 total
This change serves the purpose of making clear that Jest can be used also in combination with Yarn and it shows the command to do so.
```diff
Branches        3       3
Partials        1       1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug (regression)
Jest 19.0.2:
> jest
Jest 18.1.0:
> jest
** Jest: 19.0.2
** Jest: 19.0.2
** Jest configuration: default
Error: Parse error on line 2:
```diff
Branches        3        3
Partials        1        1
Bug
23 | @observer
- "jest": "^19.0.2"
- "babel-jest": "^19.0.0",
.babelrc
```diff
Branches        3        3
Partials        1        1
```diff
Branches        3       3
Partials        1       1
But it fails as the syntax for running multiple commands is different on windows.
C:\work\jestpete>yarn run watch
bug
Bug.
Jest v18.0.0, node v6.7 linux/amd64
Test Suites: 1 failed, 1 passed, 2 total
at Error (native)
Test Suites: 1 failed, 1 passed, 2 total
OK, this is because Jest repl has this setting:
I pinged @amasad about this. Oops. N00b. Will push a fix today.  [The test repo with the error](https://github.com/mderk/bugs_demo/blob/master/buggy.js)
Jest 19.0.2
The error happens to be related to a particular code. Test is passed ok, but when `jest` is run with `--coverage`, a Syntax Error happens. I made a minimal code example in the `buggy` function:
```javascript
Seems to be a code generation issue.
SyntaxError: Unexpected token (
// theseOptions.auxiliaryCommentBefore = ' istanbul ignore next ';
Bug
```javascript
```javascript
jest: **19.0.2**
Jest would turn it into this by looking at the shape of the mock:
functionValue: jest.fn(),
prototypeMethod: jest.fn(),
```diff
Branches        3        0       -3
+ Partials        1        0       -1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
> jest
"jest": "^18.1.0",
"babel-jest": "^18.0.0"
"jest": {
- jest: 19.0.2
Config:
```bash
$ ./node_modules/.bin/cross-env BABEL_ENV=commonjs ./node_modules/.bin/jest --debug
jest version = 19.0.2
test framework = jasmine2
"jsx",
"roots": [
- Jest: 18.1.0
@cpojer, could you please check it?
[repo with reproduction code](https://github.com/harinsa/jest-mongoose-mock)
```diff
Misses            ?     1681
Partials          ?        0
I've been using orta's great [vscode-jest](https://github.com/orta/vscode-jest) extension and noted that it doesn't work correctly on spec files containing JSX. So have [others](https://github.com/orta/vscode-jest/issues/80). I could trace the issue back to the `parse` function in  `jest-editor-support`.
**Repro**
One could argue that it's intentional behavior because `./a` and `a` are different paths, and Node is known to treat different paths as different modules, so Jest should do the same.
Node will still execute the module just once. This means that the module ID should be based on path after resolving, and I argue that `jest.mock()` should also treat them as the same module. @abdulhannanali I face the same problem. Had you any success so far? Maybe we could join forces.
jest runtime line 274 called with absolute and relative modules resulted in following states:
@cpojer
> await expect(banana).resolves.toBe(‚Ä¶) ‚Äì your proposal.
await expect(banana).resolvesToBe(‚Ä¶) ‚Äì this looks less like chai. I may actually prefer this one.
await expect(banana).resolves().toBe(‚Ä¶) ‚Äì explicit function call.
await expect(banana).<insertProposalHere>.toBe(‚Ä¶) ‚Äì is there anything else we can come up with?
// fails (?)
// bad
Cf. https://github.com/domenic/promises-unwrapping/blob/master/docs/states-and-fates.md Just a devil's advocate-ish thought (and I already probably know the answer, but I figure I'd post it anyway, hehe).
> A Promise is in one of these states:
rejects: {not: {}},
rejects: ({
This change cut the execution time down by more than 50%! Just an unexpected result that I thought I'd share;)
@cpojer
```diff
Branches        3        3
Partials        1        1
await expect(banana).resolves().toBe(‚Ä¶)
*bug*
jest: 19.0.2
"test": "jest --no-cache --verbose",
"material-ui": "^0.17.0",
"babel-jest": "^19.0.0",
"jest": "^19.0.2",
"babel": {
const regex = new RegExp('^test/([^/?]+)', 'i');
And the error:
> jest --no-cache --verbose
Test Suites: 1 failed, 1 total
Test Suites: 1 failed, 1 total
```diff
Branches        3        0       -3
- Misses       1677     1681       +4
+ Partials        1        0       -1
To make it more robust, `jest` could be made so as to expect a particular token from a `Promise`, given by the test case as a proof that the test was successful. For example:
bug
Jest config:
"roots": [
Jest-cli version: 19.0.0
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
```diff
- Misses       1652     1684      +32
Bug
jest 18.0.0
@thymikee
@cpojer
"api_key": "xxx"
beforeAll(() => pagarme.client.connect({
api_key: 'abc123',
const mongoose = require('mongoose');
unique: true,
Test Suites: 1 failed, 1 total
name: 'MongoError',
Bug
Jest fail to mock a dependency and throw an error
Reproduced on jest v19.0.0 and v19.0.1.
```diff
```diff
Misses            ?     1735
Partials          ?        1
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
"jest": {
"jest": "19.0.2",
Mac osSierra 10.12.3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
My jest suite ran in 9s in version 18 and now runs in 15s in version 19
osx: 10.12.3
enzyme: 2.7.1
jest: 19.0.2,
jest-cli: 19.0.2
**15s** <- anomaly
Alright, it was a bit trick. Here's some data:
The most dramatic perf hit came from this commit: b2b203903ef28df92a1f912c6f334be6df82756e
@thymikee  sorry :( that's from two bisects and I've tossed my notes.  Here's a little bit tho
```diff
```diff
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Currently, the JavaScript code included in docs is not standardized at all, according to the JavaScript standards jest uses, which has lead to inconsistency in the docs. One such example, the use of semicolons and indentation is not consistent really.
- `jest-benchmark` needs to be published or the CI build fails as it can't pick it up. Unless I'm missing something with Lerna and how it bootstraps on CI?
```diff
- Misses       1681     1684       +3
![jest](https://cloud.githubusercontent.com/assets/1404810/23455410/ce579638-fe6f-11e6-9857-22efb9305b7a.gif)
jest version = 19.0.2
test framework = jasmine2
"jsx",
"roots": [
With this diff
```diff
```diff
```javascript
```diff
Abort trap: 6
If I find some time then I will try to find the source of the leak and check how much of it is caused by jest vs other sources.  Hello,
"jest": {
Or maybe I'm doing something wrong?
jest@19.0.2
jsdom@9.11.0
macOX@10.12.3 (16D32)
jestsetup.js
```javascript
```javascript
### You may ask, why does shallow rendering matter when you have mocking?
jest --findRelatedTests='foo.bar, foo.baz'
jest --findRelatedTests='foo.bar foo.baz'
Admittedly, that was mostly due to the misleading doc.
```diff
Misses       1719     1719
```diff
- Misses       1681     1724     +43
```diff
Misses       1719     1719
```diff
Misses       1719     1719
config.verbose
? NullConsole
# Bug
Jest version: jest-cli@^19.0.2
I am also having this issue. Memory usage steadily has been climbing (and continues to). I was running Jest with watch mode.
"name": "jest-cli",
bug
Jest config:
"roots": [
Jest: 19.0.0
let tid = Symbol();
"react-hot-loader/babel"
"react-hot-loader/babel",
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
"jest": {
"babel-jest": "19.0.0",
"jest": "19.0.1",
"jest-react-native": "^18.0.0",
- Mac Sierra 10.12.3
```diff
- Misses       1707     1710       +3
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
Test Suites: 1 failed, 1 total
Jest 19.0.1
```javascript
```javascript
https://github.com/facebook/jest/compare/master...vibhavsinha:master
``` @holi-java The `expect()` call with throw an error due to the assertion failing, causing the `done()` call to be skipped. Since `done()` never gets called, Jest will not know whether the test succeeds or fails until the timeout is hit.
let tid = Symbol();
* Colors type is unfinished because of edge cases with options in general and theme in specific.
```diff
```diff
- Misses       1729    1734       +5
üëç   As already mentioned in #1749, could `spyOn` have automatic restore as jasmine has?
Well, I hope that's clear my and @mrhyde replies and that it's just a result of misunderstanding. @cpojer [cosmiconfig](https://github.com/davidtheclark/cosmiconfig)
### Config
**jest-config/index.js**
### Pseudo
const config = require('jest-config');
```bash
it('should be a foo', () => {})
It will find `should be a foo` but not `should get drunk`. @thymikee please open the ticket again, I had a typo and corrected it. ```
"jest": {
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
jest.restoreAllMocks();
Jasmine's `spyOn` behavior automatically does this between tests. ```javascript
Side Note: I'm running `jest@18.0.0`.
```diff
Misses       1729     1729
This solve the issue by updating [sane](https://github.com/amasad/sane) to 1.6.0 and passing a regular expression passed on the the `testPathIgnorePatterns` config option. This allows `sane` to never apply the watchers.
## Reproduction
## Questions
`git clone https://github.com/ro-savage/jest.git`
`yarn link "jest-cli"`
```diff
Misses       1729     1729
Tested by linking updated jest. Would crash with when package.json was using `testPathIgnorePatterns` to filter `node_modules` and ran perfect when using`modulePathIgnorePatterns` to filter `node_modules`.
and was taking a regex in the first PR as well which has been more extensively tested.
I am not sure why it's ducked typed?
Do you mean changing
packages/jest-haste-map/src/index.js:697
^^^^^^^^^^^^^ RegExp
My guess is this is because RegExp aren't callable in their [type definition](https://github.com/facebook/flow/blob/v0.40.0/lib/core.js#L383). But I don't understand why it doesn't use the `Function` definition but instead only regex. (It should never reach this call if RegExp is used). Dang. Spent a while trying to figure that one out.
Hi @thymikeee,
```diff
```diff
Misses       1729    1729
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
```yaml
```diff
Misses       1723     1723
```diff
> Powered by [Codecov](https://codecov.io/gh/facebook/jest/pull/2950?src=pr&el=footer). Last update [ad93432...7697811](https://codecov.io/gh/facebook/jest/compare/ad93432b966a87ebb0b9b0913d6a1afb42822626...769781146ec9539a5420be0b3fc5517a7f099c52?el=footer&src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).  I'm trying to run Jest on a React app that I have which uses Vue.js for some components, but I keep running into an error that says `Block-scoped declarations not yet supported outside strict mode`. I've looked into issues filed on this repository, along with on Stack Overflow, with the same error, but nothing that I tried from those sources has worked. One solution that was presented was to put `use strict` at the top of my files, but since my project contains hundreds of files, I'd rather not do that. I'm posting here in the hope that I can finally find a solution. I am using the latest version of Jest, I have tried re-installing my `node_modules` folder, and I have run Jest with the --no-cache option with no success. Attached are what I believe are the relevant files. The complete text of the error:
supported outside strict mode
Test Suites: 1 failed, 1 total
Apologies for the `.txt` extensions. Couldn't upload the files otherwise.
Jest 18.0.1 stores a snapshot:
* active ‚ÄúWe recommend‚Ä¶‚Äù instead of passive wording as a rare exception to the guideline to avoid the first person
```diff
```diff
- Misses       1701     1723      +22
"babel": {
I understood both should work. Is there something I'm missing, or is this a (Babel) bug?
"babel-jest": "^18.0.0",
"jest": "^18.1.0",
> jest
> jest
Unauthenticated usage
Test Suites: 1 failed, 1 total
> jest
Unauthenticated usage
```diff
```diff
Bug
Installed jest-canary in existing project:
npm install -D jest@canary
https://github.com/pedrottimark/jest-canary-18.5.0-alpha.7da3df39
```diff
```diff
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
Different parts of the doc seem to indicate different things.
If you have this fs tree :
```bash
```diff
Though you could reasonably argue they are users of Jest, but the context of the message does not imply that. Of course  **Do you want to request a *feature* or report a *bug*?**
bug
SyntaxError: Unexpected token )
SyntaxError: Unexpected token )
- jest 18.1
- jest confing
@jakubzitny did you get any solution regarding the same?
yarn jest v0.20.3
To work-around this, I would have to import Response like so:
jest: 18.1.0
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
```diff
The Algolia logo added in #2887 was very nice, but in this size the version with text isn't very legible. Changed by a square version without the text.  That's weird, it doesn't happen in Safari, but it does in Chrome. What decides the size of the icons? If `.logos img` max-width becomes width, it looks the same for all icons on Safari and Chrome (and Algolia would be big in both)  **What is the current behavior?**
```diff
- Misses       1719     1722       +3
// teardown
Should we use the undocumented Jasmine support, i.e. the global `spyOn`, or is there a way to cajole Jest into doing something similar without digging into something that is already deprecated behavior?
```javascript
describe('<Chaotic />', () => {
spyOn(Chaotic.prototype, 'getRandomInt').and.returnValue(42);
<Chaotic />
spyOn(Chaotic.prototype, 'getRandomInt');
shallow(<Chaotic />);
expect(Chaotic.prototype.getRandomInt).toHaveBeenCalled();
expect(Chaotic.prototype.getRandomInt.calls.count()).toBe(48);
const wrapper = shallow(<Chaotic />);
// Jest's version of expect doesn't let us chain. :(
__mocks__/
@foo/
bar.js
btw, I think the Algolia svg is not working great...
```javascript
var globalStateKey = Symbol.for('$$jest-matchers-object');
```diff
- Misses       1700     1701       +1
> +script:
</thead>
Generated by :no_entry_sign: <a href="http://github.com/danger/danger-js/">dangerJS</a>
Do I understand correctly that all tests in one file run in parallel? @lamartire  @ai How I know, Jest executes the specs in declared order for each test file and may parallel running for different files.
* user-defined asymmetric matchers
No hard feelings if y‚Äôall say too complicated.
* added 2 tests with unexpected types for `ArrayContaining` and `ObjectContaining`
```diff
Misses            ?     1686
Partials          ?        0
Adds Audiense to the list of Jest users.
Launch the website and a new logo should appear in Jest users (the last one):
I am getting this warning when I run my Jest test cases through Circle CI.
Bad object: {}
Minimized `jest_logo.png`; it shoed not be 18 KB.
```diff
```diff
$ cd jest-bug--bail-flag/
![jest-bug2](https://cloud.githubusercontent.com/assets/77495/22860018/18303502-f0b6-11e6-93b3-2087554683d4.gif)
the `cacheDirectory` path. (e.g. `/foo/tmp/jest/`)
```diff
Referenced from: $PWD/.eslintrc
Referenced from: $PWD/.eslintrc
+      Error"
StringContaining "Jest"
Difference:
Comparing two different types of values. Expected object but received string.
// Rolls n virtual dice
Difference:
Difference:
Difference:
Test Suites: 1 failed, 1 total
```diff
- Misses       1685     1691       +6
```diff
Jest seems not to work with Node 4 or 5.
SyntaxError: Unexpected token {
Versions of Node/NPM obviously vary:
Did I have something wrong? hi @thymikee, I've tried `jest@19.0.2` and I don't think it does what @shallwefootball is trying to achieve (which, incidentally, is also what I'm trying to do).
```javascript
fetch.req = jest.fn();
expect(mock).toBeCalled();
accessibilityTraits: undefined,
tvParallaxProperties: undefined,
hitSlop: undefined,
'$$typeof':
* Does not add `istanbul ignore next` comments if you're not instrumenting.
* The transform cache key now depends on `bebel-jest` itself as well.
/Users/matzie/Gimi/vp
* @environment jsdom
‚îî‚îÄ‚î¨ jest-cli@18.1.0
‚îî‚îÄ‚î¨ jest-runtime@18.1.0
‚îî‚îÄ‚îÄ babel-jest@18.0.0
Is this intended or is there a way to tell jest to not use babel? To me it looks like it might not be needed and this is actually a (potential performance) bug, but it is the first time I look at the jest src.
I can create a PR to remove `babel-jest` from `jest-runtime` (The tests work just fine without it and it is not used in the src)
I noticed this while trying to move babylon from ava to jest. There we run the tests agains a rollup-bundle that is already transpiled.
ReferenceError: babelHelpers is not defined
- Jest version: 18.1.0 Looks like another one that might be fixed with the slash package as per #3121   I uninstall watchman and install it again, the problem is solved.  <!--
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Bug
"jest": {
```diff
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
console.log(require('../../styles/img/ic_menu_black_24dp.png')); // 1
"jest": {
"defaultPlatform": "ios",
"platforms": ["android", "ios", "native"],
"react-native"
jest/mediaFileTransformer.js:
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Here is my **jest-config.json** file:
"react-hmre"
Am I missing something out, or is this really a lack of a feature giving the ability to provide a "root" for babel-eslint or something?
jest-cli: 18.1.0
Edit: also explicitly tried to write down the path to babel-jest:
Edit2: also tried to map babel-jest to its path:
With the following .babelrc jest doesn't work correctly (it doesn't use babel at all: `SyntaxError: Unexpected token import`):
"name": "airmedia-client",
"@kadira/storybook": "^2.21.0",
"jest": "18.1.0",
"babel-jest": "18.0.0",
"lodash": "4.17.4",
"redux-form": "6.5.0",
When I run tests in bash (Windows 10), tests using React fail. Other unit tests execute without a probelm. This test suite seems to run fine on OSX.
An example of this error is:
"babel": "^6.5.2",
"babel-cli": "^6.22.2",
"babel-jest": "^18.0.0",
"jest": "^18.1.0",
"babel": {
"jest": {
"snapshotSerializers": [
```diff
```jsx
<Foo />
```jsx
<Foo
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
exports[`Foo bar 1`] = `
<foo
<foo
exports[`Foo bar 1`] = `
<foo
<foo
Jest 18.1.0
Feature, unless I'm just using jest totally wrong.
"jest": "^18.1.0",
bug
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
Report Bug
"jest": {
jest: 18.1.0
With Enzyme
drwxr-xr-x.   3 root root   4096 Feb  7 13:52 jest
-rw-rw-rw-.   1 root root 168719 Feb  7 13:51 yarn.lock
Uploading artifacts...
"jest": {
*Bug*
Jest should run the test file.
* Jest: 18.1.0
- Jest: 18.1.0
Something like [`lodash`](https://lodash.com/docs) document would be great. (check out the version under their functions)
Fixing the "babylonParser" expects that "plugins" is set in error #2819
in the function "babylonParser" we see..
bug?
```diff
- Misses       1642     1643       +1
prop: 'foo',
baz: 'foobar',
As an alternative to:
`toHaveBeenCalledWith(jasmine.objectContaining({}))`
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
‚óè randomCoolNames only returns cool names
`it` is wrongly written as `test`  in the doc
import 'react-native';
My jest configuration is:
Jest: 18.1.0
√¢ÀÜ≈° mysql connection not called
"handler.items": bad query parameters
√¢ÀÜ≈° mysql connection not called
√¢ÀÜ≈° mysql connection not called
Test Suites: 2 passed, 2 total
I can confirm that the issue is still present with Jest v20.0.1.
17:02:41     > jest
content: 'Lorem Ipsum'
content: 'Lorem Ipsum'
content: 'Lorem Ipsum'
This is my jest --debug output:
jest version = 18.1.0
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"jsx",
Test Suites: 2 failed, 2 total
"babel-jest": "^16.0.0",
"jest": "^16.0.2",
"jest-cli": "^16.0.2",
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
bug
jest: 18.1.0
tried with jasmine: 2.5.3
```javascript
const what = 'asdf';
$ jest foo
‚úì foo (3ms)
console.log __tests__/foo.test.js:2
console.log __tests__/foo.test.js:5
* back: received in picture is **Instagram** but change in code is **Jest**
#### Changes
- Add test cases to validate jasmine‚Äôs special handling of equality
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
`jest-config` exports two functions, `normalize` and `readConfig`.
`jest@18.1.0`
![Test Output](https://i.imgur.com/8J0jDQx.png) Hrm, It seems that the tests are failing on windows parsing the JSON output from running the integration test. My initial analysis turned up nothing:
```diff
Branches        4       4
Misses       2336    2336
Partials        1       1
Jest testing is limited to execution in a node JS context currently. Since it's javascript, it's useful to run it in a real browser context at times, or at east run portions of it.
```diff
import { withKnobs } from '@kadira/storybook-addon-knobs';
+import expect from 'jest-matchers';
storiesOf,
It's absent for some reason üòÇ
Jest replaced 5 testing modules I used in every project (mocha, chai, istanbul, proxyquire, sinon, ...).
Jest integration with Babel is seamless.
import { Pills, Pill } from 'supernova-inloco'
"apiaryio": "^1.0.5",
"babel-jest": "18.0.0",
"cross-spawn": "4.0.2",
"drakov": "^1.0.1",
"fs-extra": "0.30.0",
"jest": "18.1.0",
"node-sass": "^4.2.0",
"strip-ansi": "3.0.1",
"axios": "^0.15.3",
"redux-form": "^6.5.0",
"supernova-inloco": "git+ssh://git@bitbucket.org/ubeedev/supernova.git#master",
"jest": {
"babel": {
ExpectAPI.md
* to `packages/jest-jasmine2/src/jest-expect.js`
- jest 18.1.0
Ok, new info again... This is crazy.
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
- Jest 18.1.0
encounted a declaration exception
Config:
NPM 2.15.3
JEST-CLI version: 18.1.0
I've tried importing reflux in the .test file, but still have the same error.  @cpojer I've removed mocksPattern in this PR #2705 *
```diff
Misses            ?     1642
Partials          ?        0
3. Run `jest`
Thanks @cpojer! üëç   <!--
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
"jest": {
"jsx"
jest.mock('fs');
jest.dontMock('path');
value: 'kappa'
jest.fn(() => {
value: 'kappa'
expect(config.test.value).toBe('kappa');
And i get error
jest.fn(function () {
value: 'kappa'
If you are experiencing problems with setting up Jest, please make sure to visit our Help page:
https://facebook.github.io/jest/help.html
`jest@18.1.0`
```diff
Bug
Repl.it on page http://facebook.github.io/jest/blog/2016/12/15/2016-in-jest.html  looks odd
Drops `jest-jasmine2` from `jest-cli`. It doesn't seem to be used there, or be a peerDependency.
Bug
Bug
@thymikee hmm, no seems to have been transient.  Weird.  Sorry for the false alarm  **Summary**
* The existing tests for `foo` and `bar` in `integration_tests/snapshot_serializers` verify that replacing `addPlugins` with `addSerializer` works for `config.snapshotSerializers` of `package.json`
``` Are you sure it is okay to leave the extension point in jest-matchers, though? Your thoughts on what is happening now are welcome. Why tests pass one way but not the other.
```diff
"babel-core": "^6.2.1",
"babel-jest": "^18.0.0",
"babel-preset-jest": "^18.0.0",
"jest": "^18.0.0",
"jest-cli": "^0.8.2",
"jest-webpack": "^0.2.1",
"node-sass": "^3.4.2",
"sass-loader": "^3.1.2",
"jest": {
"jsx"
"jsx"
my .babelrc
extensions: ['', '.scss', '.js', '.json']
preLoaders: [
Bug.
‚îú‚îÄ‚îÄ INTHEWILD.md
‚îú‚îÄ‚îÄ karma.conf.js
‚îú‚îÄ‚îÄ ShallowWrapper.js
TODO
```diff
Partials          0          0
```diff
Misses         1622       1622
Partials          0          0
Bug
Jest: 18.1.0
basedir=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")
"name": "Debug Jest",
"args": ["--runInBand"],
What I am concerned about is that Jest functions differently with `--legacy-bundling` vs not. Most NPM users are not going to think to use `--legacy-bundling`. I ran across this fix by accident. Are you mainly focused on using Yarn and does it default to not flat? I'll reach out to the NPM team and see if there is a way to determine what the causes the difference. Just did some more playing and found that using `npm install --global-style` works as well. Interesting, have you tried yarn too? I hadn't before, but yes the issue appears when using yarn as well.
I'm still blown away that --global-style made a difference. With only one dependency, it doesn't seem like there would be much of a difference between having Jest's deps in a child folder vs a sibling folder.
```diff
Misses         1622       1622
Partials          0          0
```diff
Misses         1622       1622
Partials          0          0
"snapshotSerializers": [
exports.api = {
```diff
Partials          0          0
any lucky with an Ember example? I've tried, but the QUnit looks like a black-box-magic üòÖ   When beforeAll throws an error, or returns a Promise that rejects, the tests are still run. I would expect the tests to not even run at all.
https://github.com/dirkmc/jest-before-all-error-handling
Test Suites: 1 failed, 1 total
```  Jest v18.1.0
Jest is correctly using babel to transform the files.
And throws `unexpected token` on spread operators and others.
My .babelrc:
and when i remove, the regex, I get `unexpected syntax import...` message.  so i'm fairly certain its something else.  I'd like to suggest a feature:
with `jest.runAllTimers`
and with hack
* I'm using `jest.useFakeTimers();` (with `"timers": "fake"` result is same)
I think it's related to jest fn mocking... But I may be wrong Yes, it's here
https://github.com/ColCh/jest-timers-bug
~P.S. Please, tell me if something is wrong with my deps, not with jest itself~
Sorry, I've mixed up hacked version with `jest.runAllTimers`. It didn't work with ES6 class too OMG, that's was actually my fault...
```diff
addAnswer = jest.fn();
submitResult = jest.fn();
nextTask = jest.fn();
Presumably a bug
```bash
at resolve (/Users/sullenor/Documents/repo/jest-path-resolver/node_modules/jest-config/build/normalize.js:48:11)
at Object.keys.map.regex (/Users/sullenor/Documents/repo/jest-path-resolver/node_modules/jest-config/build/normalize.js:354:9)
Jest will execute any test
```bash
```diff
Thanks for all your work @ColCh, and appreciating the clear, kind and constructive way you host this community @cpojer :1st_place_medal:   This is used in modern es module codebases to designate the entry point for code that makes use of import/export instead of commonjs. Jest doesn't need to care about whether or not that destination code is actually an ES module, just that the path gets resolved üôÉ
```diff
- Misses       1655     1661       +6
"main": "build/foo.js",
"module": "foo.js"
Should this allow the ability of passing in a custom reporter?
In the example above, `sample` is set to be `*this part*`, which is an invalid regExp. This can cause confusion in some cases (e.g. trying to match a bold string in markdown syntax).
Jest: 16.0.2
```diff
Misses         1601       1601
Partials          0          0
```javascript
} from '../somelib';
```javascript
export * from './otherfoo';
export * from './otherfoo2';
export * from './otherfoo3';
```javascript
```javascript
```javascript
Thank you!  This is a proposal for a new feature that I feel would work very well with Jest and in general be of use by many in the community.
Lastly, Jest could output a pretty summary at the end, for example:
performance could vary on different browser (an optimisation on chrome can be slower en FF).
![giphy](https://cloud.githubusercontent.com/assets/1500684/22338493/6038d7f4-e39c-11e6-8d9f-4feccd25f0c8.gif)
http://pkgsize.com/jest.html (select an area to zoom in and hover to see the event that caused the change)
The big ones there are:
- http://pkgsize.com/istanbul-api.html due to
- http://pkgsize.com/istanbul-lib-instrument.html due to http://pkgsize.com/babel-generator.html due to http://pkgsize.com/babel-runtime.html due to the ever increasing http://pkgsize.com/core-js.html
- http://pkgsize.com/istanbul-reports.html due to http://pkgsize.com/handlebars.html due largely to http://pkgsize.com/uglify-js.html (kind of unfortunate that the handlebars package includes both the runtime and CLI)
- jest 18.1.0
Repo: https://github.com/ffxsam/jest-watch-strangeness
SyntaxError: Unexpected token =
bug (apparently)
`$ jest
2. react-native init test
4. jest
OSX:      El Capitain
jest:       18.1.0
babel-jest: 18.0.0
"name": "apitest",
"test": "jest"
"babel-jest": "18.0.0",
"jest": "18.1.0",
"jest": {
Config:   "jest": {
}  ```javascript
throw new Error('nooooo')
Test Suites: 1 failed, 1 total
Would be great if Jest solved this problem out of the box (i.e. mocking `Date` as well as `setTimeout` and friends).
describe('api', () => {
```diff
Misses         1604       1604
Partials          0          0
```diff
- Misses         1601       1623    +22
Partials          0          0
```jsx
{meow: true, nya: false},
{meow: true, nya: true},
{meow: false, nya: false}
TEST_CONDITIONS.forEach(({ meow, nya } => {
it(`does some things when meow is ${meow} and nya is ${nya}`, () => {
expect(myCoolThing(meow, nya)).toMatchSnapshot();
```diff
- Misses         1603       1604     +1
Partials          0          0
```diff
Partials          0          0
Bug.
```diff
- Misses         1603       1630    +27
Partials          0          0
```javascript
Jest: `it` must return either a Promise or undefined.
``` @cpojer  This is sucks, because I use redux-saga.
```diff
Partials          0          0
```javascript
<App />
```javascript
"jest": {
```javascript
|-fonts
|-img
\_styles
"jest": {
```javascript
```diff
Partials          0          0
The original code is:
Env:
- jest 18.1.0
- ts-jest 18.0.1
Jest config:
"jest": {
cd ShorcutJS
Would this be something for Jest?
"babel-jest": "17.0.2"
"jest": "18.1.0"
(I'm new to Jest so perhaps I could be missing something obvious; I'm sorry if that's the case...)
**jsdom:**
u8arr = new Uint8Array(n);
type: mime
var imageB64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAGFElEQVR4nM2Y+W8bVRDHZ96xa3ttJ61zN0lJCbSiKkdVVUgIfgIk+GeBH5BACH7iKFfLVYLahJSQo07tuL539703ww8bCoXEu+tElPnNkvftZ2fefOfAz7eH8P8z8aQBjrZTwGIAPvkpj5sa+0kGAGaBKAQmv4mZmQEAEPGJYDGDlKilHMY2GlpmUEr4WnhaIYBx5BwDwNh042Axg1bYGZibdxu7jX5oHDMrKUq+qlULC7XSwlQwGXgMYCwx8xi+w7yZyAxKYmdg3vtss9WLtUpiiAxMxI4YAUoFvTgdXFqaXJ4pS4GRIcjpudzeImYhxFe/7Ld6cVBQRMltAgSUCjUgABhLd35vr++0F2rBS89MrcxViNg4EpnRcmAxgxRYKMhBZPcOBp4Wj5ge/SHJBETwPQnAO43+TqO/eq76yuW5icALjctIljWIzKyV7Ifmx82DnUa/2Q6ziAIiAGAY20pRv3518fxsOSNZJqzkPrV60fs3tg66kZKoZA7BE4jGEQC8fX35wnwlC1mm0xGBmD++udPqRUFBaZVPhIlZSYEIH93cbnRCrQSnuTr9BcTsa/n9RnPvYFD0lSNOPfTfxsxKiDC2n/9UR0gPYgoWM2glHrTDb+80PC2Jxi8zyedtPejtNfupDkv1FgvEGz/Xw9jKk1YUQEDraLvRlwJ5ZCEdhcXMvlbrO52NvY7vKRojeP84EAAAugPDkBLIUViIGFv37d0HAuEUu4TD0j4eFjN7Wm7e79ZbA0/JE3sK4E8PTQQepn3lCG8hM9/dbgPgaTmKmD0lztUCRzw6H4/FEgL7oW20h0riOJLwL0PE2NJCLZg5UzSWRufP0VjMIBBi42JLWWQmkzELhJdWpzDDTT0aCxGIoeBJX0tmPjlX4qqV+erybDk2LrUDOzaIjigo6KXpsnF04h4YAIAB5GEOniATEdASX7lw1tfy5IoFwIjQHxoiznIpjsdCMNbNTBZfXJ0KY5dFbEYaMkPBU0JgFgUcJacCMTLu2rPTSzPlMM7awR0NBcDMtaovMKXspGPBnyn5xtXFakkbl5LVo84BlgLnawFximJlwkIE46ga6LeuLyuJROMwIYBzPBF4s5NF6zjLt6X3W0koF2qlV6/MG5ee20dgIRpHSzPlUkG5bF+Wqc8UiMPIXn7q7KWlM5GxeS8ZAyspVhcmKK3m5MMCAEB0jl5+brbk62QYzPwcxJbmzhTna6U48+3MipWM8JOB9/yFs6GxeUKJzPDc+TNKiuy1Nd8AExl39Znp1YWJMM5EJhCJuFrST81VjM0hMflmGAYA4LeuL6/MV2Obfv0j4/qheXphouTrXHNAvmE/SfVSQVYDj4hHdHNJBbx2cXqy7K/MVfKmcO4dBCJax+1eNEKvEdEYtzhXee3KvHVkbO6imnsbiAhhbA+6sZSjqhsze0pExg0iO4YGZ8Xiw2UfBAV17363M4ilECOohMDu0GglSr6SiPxoUXhaWMmBWomipxBhfadzY21fSYTjX8MMUopmJ/rk1u6v97uhcb6WvqdEZr5RqxFiFoielkRUbw03djtb+72DboQIEjPNHZFxArFS0vNnS+dnK+emgmpJA0BsKTk8H1ayWfS1jIz7da+ztvVwt9k3lpQUKs/QmKSFI7aOgKFc1IvT5dVz1cWpcsGTsSVHR+/ijsBKJkTr+M72wx82mvsPQ0TQSiTvGK9RTdTBEVlLiDhVLVxcnry4NFkp6sg45n+uMB/DSrorT8t79e6Xa/u7zb4UqJWEcWmO4WPr2DqaCLwXnq49v1IDAEePNTx/YTGzktISfXG7/uNmEwA8Jcd2TxpcMitQbGhlrvLmtUVPS/e3VuwwE4nZU7IziN/9dPPWekMroZWgfEmdwxK5kYhBQW3e7374zTY8HkcBh9InG53wnU83661hqaCYR6T/6cEBOOJECG/effD3EUsAgBAYxu6Dr3/vDY3vnWi3NoY5Yl/L7zaaB91Iy0OJFkn4bqzVG+3wv2dKTAocRHZtq/WoJxO+lrvN/tpvreITYoLDbBPru51BZJPJWyDi7Xut05rox8QCUBLbvajeGiopmOEPMVdhsiuhIicAAAAASUVORK5CYII=';
**Jest:**
bstr = atob(arr[1]),
u8arr = new Uint8Array(n);
type: mime
var imageB64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAGFElEQVR4nM2Y+W8bVRDHZ96xa3ttJ61zN0lJCbSiKkdVVUgIfgIk+GeBH5BACH7iKFfLVYLahJSQo07tuL539703ww8bCoXEu+tElPnNkvftZ2fefOfAz7eH8P8z8aQBjrZTwGIAPvkpj5sa+0kGAGaBKAQmv4mZmQEAEPGJYDGDlKilHMY2GlpmUEr4WnhaIYBx5BwDwNh042Axg1bYGZibdxu7jX5oHDMrKUq+qlULC7XSwlQwGXgMYCwx8xi+w7yZyAxKYmdg3vtss9WLtUpiiAxMxI4YAUoFvTgdXFqaXJ4pS4GRIcjpudzeImYhxFe/7Ld6cVBQRMltAgSUCjUgABhLd35vr++0F2rBS89MrcxViNg4EpnRcmAxgxRYKMhBZPcOBp4Wj5ge/SHJBETwPQnAO43+TqO/eq76yuW5icALjctIljWIzKyV7Ifmx82DnUa/2Q6ziAIiAGAY20pRv3518fxsOSNZJqzkPrV60fs3tg66kZKoZA7BE4jGEQC8fX35wnwlC1mm0xGBmD++udPqRUFBaZVPhIlZSYEIH93cbnRCrQSnuTr9BcTsa/n9RnPvYFD0lSNOPfTfxsxKiDC2n/9UR0gPYgoWM2glHrTDb+80PC2Jxi8zyedtPejtNfupDkv1FgvEGz/Xw9jKk1YUQEDraLvRlwJ5ZCEdhcXMvlbrO52NvY7vKRojeP84EAAAugPDkBLIUViIGFv37d0HAuEUu4TD0j4eFjN7Wm7e79ZbA0/JE3sK4E8PTQQepn3lCG8hM9/dbgPgaTmKmD0lztUCRzw6H4/FEgL7oW20h0riOJLwL0PE2NJCLZg5UzSWRufP0VjMIBBi42JLWWQmkzELhJdWpzDDTT0aCxGIoeBJX0tmPjlX4qqV+erybDk2LrUDOzaIjigo6KXpsnF04h4YAIAB5GEOniATEdASX7lw1tfy5IoFwIjQHxoiznIpjsdCMNbNTBZfXJ0KY5dFbEYaMkPBU0JgFgUcJacCMTLu2rPTSzPlMM7awR0NBcDMtaovMKXspGPBnyn5xtXFakkbl5LVo84BlgLnawFximJlwkIE46ga6LeuLyuJROMwIYBzPBF4s5NF6zjLt6X3W0koF2qlV6/MG5ee20dgIRpHSzPlUkG5bF+Wqc8UiMPIXn7q7KWlM5GxeS8ZAyspVhcmKK3m5MMCAEB0jl5+brbk62QYzPwcxJbmzhTna6U48+3MipWM8JOB9/yFs6GxeUKJzPDc+TNKiuy1Nd8AExl39Znp1YWJMM5EJhCJuFrST81VjM0hMflmGAYA4LeuL6/MV2Obfv0j4/qheXphouTrXHNAvmE/SfVSQVYDj4hHdHNJBbx2cXqy7K/MVfKmcO4dBCJax+1eNEKvEdEYtzhXee3KvHVkbO6imnsbiAhhbA+6sZSjqhsze0pExg0iO4YGZ8Xiw2UfBAV17363M4ilECOohMDu0GglSr6SiPxoUXhaWMmBWomipxBhfadzY21fSYTjX8MMUopmJ/rk1u6v97uhcb6WvqdEZr5RqxFiFoielkRUbw03djtb+72DboQIEjPNHZFxArFS0vNnS+dnK+emgmpJA0BsKTk8H1ayWfS1jIz7da+ztvVwt9k3lpQUKs/QmKSFI7aOgKFc1IvT5dVz1cWpcsGTsSVHR+/ijsBKJkTr+M72wx82mvsPQ0TQSiTvGK9RTdTBEVlLiDhVLVxcnry4NFkp6sg45n+uMB/DSrorT8t79e6Xa/u7zb4UqJWEcWmO4WPr2DqaCLwXnq49v1IDAEePNTx/YTGzktISfXG7/uNmEwA8Jcd2TxpcMitQbGhlrvLmtUVPS/e3VuwwE4nZU7IziN/9dPPWekMroZWgfEmdwxK5kYhBQW3e7374zTY8HkcBh9InG53wnU83661hqaCYR6T/6cEBOOJECG/effD3EUsAgBAYxu6Dr3/vDY3vnWi3NoY5Yl/L7zaaB91Iy0OJFkn4bqzVG+3wv2dKTAocRHZtq/WoJxO+lrvN/tpvreITYoLDbBPru51BZJPJWyDi7Xut05rox8QCUBLbvajeGiopmOEPMVdhsiuhIicAAAAASUVORK5CYII=';
import LocalizedStrings from 'react-localization';
const strings = new LocalizedStrings({
optSelect:"Select_fr",
lblDisplayName:"Display Name_fr",
expect(localizedStrings.mock.calls[0][0]).toMatchSnapshot();
expect(localizedStrings.mock.calls[0][0]).toMatchSnapshot();
expect(localizedStrings.mock.calls[0][0]).toMatchSnapshot(); //didnot work
expect(localizedStrings.mock.calls[0][0]).toMatchSnapshot();
expect(localizedStrings.mock.calls[0][0]).toMatchSnapshot(); //didnot work
@cpojer @gaearon What do you think about the balance in this situation between ‚Äúzero-configuration‚Äù goal for what many people need and ‚Äúlocal configuration‚Äù ability for what a few people need?
*bug*
node_modules/eslint-plugin-jest
‚îú‚îÄ‚îÄ lib
ok this is very weird.
```diff
Partials          0          0
We are migrating our large testing code base from Mocha to Jest. From the Jest documentation, especially the [Configuration](https://facebook.github.io/jest/docs/configuration.html) part I have not been able to understand few details.
2. The `testRunner` config option is `jasmine2`¬†by default. Is there any other available option besides the custom test runner path? What are the requirements for custom test runner implementations?
I have no clue if it'll work out, just playing around with it to see what it feels like and what the api could be.
The error is:
All files |  Unknown |  Unknown |  Unknown |  Unknown |                |
Test Suites: 1 failed, 1 total
"jest": {
SyntaxError: Unexpected token <
All files |  Unknown |  Unknown |  Unknown |  Unknown |                |
Test Suites: 1 failed, 1 total
```diff
Misses         1598       1598
Partials          0          0
```diff
- Misses         1601       1602     +1
Partials          0          0
```diff
Misses         1598       1598
Partials          0          0
```javascript
momo[f] = result;
bug
All tests are run even though `--bail` was used.
See https://github.com/julien-f/issue-jest-bail
```diff
Misses         1598       1598
Partials          0          0
```bash
```diff
Partials          0          0
> <https://github.com/notifications/unsubscribe-auth/AAC_jgKkvA0GSQzfJuikyueLl02vfFt5ks5rS-kBgaJpZM4LlBS_>
- Does it print them in special colors?
```diff
Partials          0          0
```diff
Misses         1582       1582
Partials          0          0
```diff
Misses         1582       1582
Partials          0          0
I would love to have an option to log only failures ‚Äî¬†and the final summary information. What do you think? @cpojer maybe I can convince you, do I need to create a new issue or is better to discuss in this one? I also asked this question on SQA.SE: https://sqa.stackexchange.com/questions/25820/rerun-failed-flaky-tests-with-jest  **What is the current behavior?**
Just one paren typo. Currently displaying "If you are using Mocha), AVA, chai or Tape, ..."
```diff
Misses         1617       1617
Partials          0          0
import Promise from 'bluebird'
if (INTERGRATION) {
throw new Error('need intergration')
react-native/Libraries
```diff
- Misses         1582       1598    +16
Partials          0          0
@cpojer something like this?
@gaearon @cpojer yeah, that's better
"jest": {
"jsx"
"coverageCollector": "jest-babel-istanbul"
"jest": {
"babel-jest": "^18.0.0",
"jest": "^18.1.0",
polyfills.js           |    66.67 |       50 |      100 |    66.67 |            5,6 |
Routes.js              |    27.27 |    21.43 |        0 |    14.29 |... 13,15,16,19 |
TagStore.js            |       70 |       60 |    42.86 |    55.56 |    36,37,42,45 |
rainbowUnicorn.js      |    46.43 |    22.22 |    33.33 |       75 |          74,82 |
globals.js             |    59.26 |        0 |        0 |    59.26 |... 70,74,80,81 |
this is on jest `18.1.0` @jwbay @dmitriiabramov @hzoo (@ party, sorry).
https://github.com/istanbuljs/nyc/blob/master/index.js#L94
I know babel itself has a cache? is there a way we could take advantage of this in Jests' test-suite, and projects that rely on Jest?
```diff
- Misses         1637       1644     +7
Partials          0          0
Bug
Here's my example of a mock:
Bug
```bash
* Jest 17.0.3
* NPM 3.10.7
describe('Saga', () => {
"@@redux-saga/IO": true,
"@@redux-saga/IO": true,
```diff
- Misses         1628       1629     +1
Partials          0          0
```diff
+ Misses         1712       1629    -83
Partials          0          0
```diff
+ Misses         1712       1629    -83
Partials          0          0
```diff
Partials          0          0
```diff
Partials          0          0
Bug
```diff
jest -v
```diff
Partials          0          0
```diff
- Misses       1685     1689       +4
@rogeliog @cpojer please give me feedback about UX of new features, while I'm refactoring code, and writing tests for that üòâ
I'm can try to add output something like verbose reporter.
‚Ä∫ Runs Jest once by default and shows usage
jest.mock(`Picker`, () => {
```bash
Invalid variable access: React
I tried `babel-jest@test` and they run as expected but all my snapshots fail, looks like more props are coming through which is probably unrelated to this.
```javascript
jest.mock(`Picker`, () => {
```javascript
jest.mock(`Picker`, () => {
```diff
Partials          0          0
```diff
Misses         1617       1617
Partials          0          0
(I am looking at you, Java) and therefore cause jests haste-map can cause an ENAMETOOLONG error.
(I am looking at you, Java) and therefore cause jests haste-map can cause an ENAMETOOLONG error.
oh boy i had a very old checkout of jest, brb :P bringing this up to date  After updating from `^17.0.3` to `^18.1.0`, I get the following warning, followed by an error:
"transform": {".*": "undefined"}
"jest": {
"/.vagrant/",
However, the error persists.
```diff
Misses         1713       1713
Partials          0          0
```diff
- Misses         1713       1715     +2
Partials          0          0
[libs]
[options]
[libs]
```diff
Misses         1713       1713
Partials          0          0
```diff
Misses         1713       1713
Partials          0          0
Test Suites: 1 failed, 1 total
Why is `export` unexpected here?
>so you have to explicitly tell jest to transpile it with babel transform
"jest": {
"jsx",
strange but the same happens when I try to add `transform` option.  >Are you trying this under jest key?
// .jestrc
/Users/Babu/Projects/swish/gitworkspace/ui/ui-app-mobile/node_modules/@swish/ui-components/di
Test Suites: 1 failed, 1 total
My solucition with react-router-native
my jest config.
"@types/jest": "^19.2.3",
"jest": "^20.0.3",
Bug
I've submitted a [PR to `node-fetch`](https://github.com/bitinn/node-fetch/pull/220) switching from `instanceof Array` to `Array.isArray` to address the immediate issue, but the Jest behavior still seems unexpected and it took quite a while to track down.
Jest - 18.1.0
This is likely due to the behavior of `vm`; see https://github.com/nodejs/node-v0.x-archive/issues/1277
However, turns out, the raw matchers from jest-matchers arent actually exposed to the outside world.
is this intentional or an oversight?
(running on Jest 18.1.0) hi @thymikee i think im either missing something or wasnt clear before.
```javascript
```javascript
//packages/jest-matchers/src/index.js
Uses relative import for lodash instead of global imports
This replaces the array includes with a lodash one, which comes from Danger's dependencies.
bug
i run jest in my CI and it "explodes" with Error: ENAMETOOLONG: name too long, open '/tmp/jest/haste-map--\<some-really-long-filename\>-\<some-fairly-long-hash\>'
```diff
- Misses         1714       1748    +34
Partials          0          0
```diff
- Misses         1812       1819     +7
Partials          0          0
```diff
- Misses          206       1812   +1606
Partials          0          0
```diff
+ Misses         1592       1582    -10
Partials          0          0
Bug
```javascript
import 'react-native';
```javascript
**jest version**: `18.1.0` (also present in at least one version of 17)
```javascript
import 'react-native';
```javascript
```javascript
// ... other timers
// ... other timers
It gets a little weirder though. `defineProperty`, in this case, calls [defineLazyObjectProperty](https://github.com/facebook/react-native/blob/9ee815f6b52e0c2417c04e5a05e1e31df26daed2/Libraries/Utilities/defineLazyObjectProperty.js), which defines a getter and a setter:
```javascript
// WORKAROUND: A weird infinite loop occurs where calling `getValue` calls
Here is where the two diverge.
```javascript
// ... other timers
// ... other timers
```javascript
```javascript
```javascript
```javascript
expectfunc1('abc')).toBe(false);
SyntaxError: Unexpected reserved word
can someone tell me what I am doing wrong, or what is the problem?
*bug*
I run jest with this weird command:
- jest 18.10
- jest 16.0.2
"jest": {
Benjamins-MacBook-Pro:tmp benjamincoe$ tar -xvf foo.tgz
x package/bin/jest.js
x package/build/jest.js
@cpojer I'm not quite sure what the issue is either:
Adds [Danger](https://github.com/danger/danger-js).
With initial Danger rules:
This Dangerfile does not have the FB Copyright Header, so once Danger is set up she should fail this build.
- [x]  Danger relies on Jest's packages, should/can I make the deps local paths inside yarn? So there's no duplication confusion
After that you'll need to add a token to travis for `DANGER_GITHUB_API_TOKEN`. I think these CI fails are from our usage of `jest-transform` in Danger, so, this question becomes more important
> Danger relies on Jest's packages, should/can I make the deps local paths inside yarn? So there's no duplication confusion
Jest: 17.0.3
Thanks for all the work that has been put into Jest!  It is a really great tool that I am glad is getting TLC! <3
**BUG**
jest.useFakeTimers();
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
serves me right for playing Fallout New Vegas for three hours last night; one argument I'll put out there, a 6 hour turn around is pretty darn good -- would have been 2 had it not been for super-mutants. @cpojer I like the [citgm](https://github.com/nodejs/citgm) project too, and have been thinking of figuring out a way to get a similar suite up and running for `babel-plugin-istanbul`/`nyc`. @bcoe I need to look into `bundled-dependencies` as well - looks good. And I was definitely happy with the 6 hour turnaround time for the regression fix!
- When a snapshot comparison fails, jest returns a whole message which makes it difficult to tie in with reporting in other test runners
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
ERROR
‚îî‚îÄ‚î¨ jest-cli@18.1.0
```diff
- Misses         1628       1630     +2
Partials          0          0
```javascript
```bash
/Users/alvarojosepl/workspace/jest_syntax_error/node_modules/native-base/index.js:4
i am not sure what is being taken there as a reserved word (remove the line will actually solve remove the specific error).
https://github.com/kanekotic/jest_syntax_error
"react-native": "^0.39.2",
"jest": {
"babel-jest": "18.0.0",
"jest": "18.1.0",
"jest-react-native": "18.0.0",
"jest": {
When writing tests with Jest, I found that even after registering a virtual `jest.mock` for the absolute path of a config file, Jest was throwing `Cannot find module '/absolute/path/to/foo.config.js' from 'loadConfig.js'`
const configPath = 'foo.config.js';
Updated `jest-runtime` to make the test pass:
```diff
Misses          206        206
Partials          0          0
anyway we can access `jasmine` in the global scope already.
Before (Jest loads the actual package):
```diff
Partials          0          0
Test Suites: 1 failed, 1 passed, 2 total
‚úì should handle failed status
‚úì should handle success status
Test Suites: 2 passed, 2 total
import { expect } from 'chai'
import mq from 'mithril-query'
A bug!
TestCase(-1, -1, -2),
TestCase(-1, -1, -2),
```diff
+ Misses         1713       1592   -121
Partials          0          0
`'/fruits/__mocks__/subdir1/blueberry.js'`
`'subdir1/blueberry'`
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
Bug
```bash
else
fi
<environmentVariables>
</environmentVariables>
```diff
Misses          206        206
Partials          0          0
It seems like such a breaking change should not have been introduced in a point release.
Jest 18.1.0
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
Main changes:
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
Bug
```javascript
```javascript
```javascript
(havent cloned the Jest repo yet to test it more thoroughly)
```javascript
bug - related to react-native
```javascript
// This is a react-native app
**Package Versions**
"babel-jest": "17.0.2"
"jest": "17.0.3"
"jest-react-native": "17.1.0"
"jest": {
+-- ChildClass.ts
+-- ChildClass.test.ts
at Object.<anonymous> (tests\childCass.test.ts:3:20)
+-- jest-cli@18.0.0
> jest
While people are digging into this I'm going to look into adding jest to citgm so we can catch breakages like this earlier
bug
```javascript
```javascript
This is the Firefox and Google Chrome behavior when the source code runs on a page whose document.location is `about:blank` what is not expected as the `window.location.href` property is defined by ([Issue#890][1])
```javascript
```javascript
* Jest: v16.0.2
* NPM: 2.14.12
Isn't this a [jsdom][1] issue?
I think exposing `jsdom` would make sense, but I am not sure about the consequences to the jest philosophy.
Bug
Bug
https://github.com/voliva/jestpeer
Notice how while when running through node MyLib doesn't get loaded twice, while when running through Jest it does
"jest": {
#2970 on contrary sounded to me like an issue about solving _particular issues_ in Facebook repositories (yeap, despite it tries so hard to look like an issue about solving community issue).
"babel": {
import('./Home').then(function (mod) /* istanbul ignore next */{return mod.default;}));});
"jest": {
1) Jest runs a test
jest v18.1.0
**Versions**
Jest: 17.0.1
"jest": {
"roots": [
Issue:
* I am running `jest --watch --verbose` (v19.0.2)
* If I invoke jest with `--runInBand`, I see all the `console.log` statements.
I did find the --verbose flag on Friday, which gave me enough output to fix my issues.
Again, sorry for being such a dick about it. any news on this? how to show console.log? very interesting behaviour, after banging my head couple of times (more like several times) figured out that --verbose is indeed the culprit to not having console.log printed out.
throw new Error();
throw new Error();
@thymikee, my example wasn't a good one since `setTimeout` has issues relating to promises that have nothing to do with jest...
I tried to add `--runInBand` or `--verbose`, but didn't help.
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
```diff
Misses          206        206
Partials          0          0
A bug.
$ jest
$ jest
I am module
bug
```javascript
SyntaxError: Unexpected token <
jest: v18.0.0
```javascript
@cpojer sorry, would you mind expanding a bit? I am now at a point where I need to be able to test the webView functionality (namely, talking back and forth between RN and the WebView). Is this possible using a custom transformer?
```javascript
SyntaxError: Unexpected token )
```javascript
@orta fyi yeahhhhhhhh ## [Current coverage](https://codecov.io/gh/facebook/jest/pull/2430?src=pr) is 87.53% (diff: 100%)
```diff
Misses          206        206
Partials          0          0
2. cd jest
"test": "jest"
"test": "jest"
"jest": {
"timers": "fake"
```diff
Misses          206        206
Partials          0          0
```diff
Partials          0          0
```diff
Partials          0          0
```diff
Partials          0          0
```diff
Misses          206        206
Partials          0          0
```javascript
```javascript
Is it `const fetchMock = jest.mock('isomorphic-fetch/fetch')` or something? Any help would be appreciated, but I think this might be worth a documentation note more generally.  ## [Current coverage](https://codecov.io/gh/facebook/jest/pull/2419?src=pr) is 89.23% (diff: 100%)
```diff
Partials          0          0
**package.json | jest.config.json**
const createReporter = require('istanbul-api').createReporter;
const map = istanbulCoverage.createCoverageMap();
@ardok Thanks for dropping in with your experience! I use https://www.npmjs.com/package/istanbul-merge to merge istanbul reports - with that and #2861, it should be trivial.  **Do you want to request a *feature* or report a *bug*?**
ReferenceError: Thrift is not defined
Test Suites: 1 failed, 1 total
"jest": {
jest test.js
Belated thanks @cpojer
const content = fs.readFileSync('path\\to\\Thrift.js');
```diff
+ Misses          206        187    -19
Partials          0          0
Is there any chance that jest will be added as supported protractor assertion framework?
```diff
Misses          206        206
Partials          0          0
```diff
Partials          0          0
```diff
Partials          0          0
Trace
Also please avoid stage numbers for experimental features because they are a moving target To y‚Äôall who improved the React docs: Thank you! Thank you!! Thank you!!!  Repo: https://github.com/jcollum/kishar-nine/tree/05-testing
OS:
"jest": {
"jest": "~18.0.0",
> jest
Invariant Violation: Native module cannot be null.
import 'react-native';
1. git clone https://github.com/jcollum/kishar-nine.git k9fresh
1. cd k9fresh/
"jest": {
"babel-jest": "17.0.2",
-    "jest": "17.0.3",
+    "jest": "~18.0.0",
collumj@por-collumj-m ~/research/kishar-nine (05-testing) 12:02:12
> jest
Invariant Violation: Native module cannot be null.
"lodash": "~4.17.2",
"jest": {
"babel-jest": "~18.0.0",
"jest": "~18.0.0",
+    "react-native": "~0.39.1",
Jest 18
```diff
Partials          0          0
```diff
Partials          0          0
@orta fyi ## [Current coverage](https://codecov.io/gh/facebook/jest/pull/2377?src=pr) is 89.23% (diff: 100%)
```diff
Partials          0          0
```diff
Partials          0          0
1) for jest
Can somebody please tell me how to use jest with Node.js v7 without babel?
```diff
Partials          0          0
```diff
Partials          0          0
```diff
Partials          0          0
"jest": {
"react-native",
"react-native",
"fbjs"
Invariant Violation: Native module cannot be null.
**Known issues:**
```diff
+ Misses         1812       1789    -23
Partials          0          0
* The following are incorrect as of **Jest 18** which is what caused me to notice:
```diff
With command `jest` it will print
Bug
See https://github.com/ph3b/jest-snapshot-error
Jest: 18.0.0
This weekend, with the help of @lukyth, I updated  `istanbul-api`'s dependencies -- mainly in the hopes that we could remove this ugly little warning from Jest:
`npm cache clear; npm i istanbul-api@next`
If everything looks good, I'll get the new version of istanbul-api published early in the week.
**FEATURE**
__mocks__/
jest.unmock('package1').unmock('package2');
__mocks__/
**Versions**
"jest": {
```diff
Partials          0          0
Report a **bug** in Jest **18.0.0** running on Node 7.2.1 with npm 3.10.9
```diff
-  Install Jest
+    "Install Jest",
const onClick = jest.fn();
```diff
Install Jest
const onClick = jest.fn();
If you need, I am glad to create a test repo on Monday. P.S. to Christoph: what I mentioned about objects with Symbols for keys or values of properties as JS but not JSON was technically correct, but my now-you-see-it-now-you-don‚Äôt confusion about `$$typeof` in `console.log` was caused by enumerable versus non-enumerable :) By the way, the case that still confused me until now is that the diff is JSX for non-enumerable `received` and enumerable `expected` because `received.hasOwnProperty(key)` is true and `received[key]` accesses the value of the non-enumerable property:
**BUG**
Even if the mock didn't throw, Jest is still tries loading it with no explicit desire:
**Versions**
```javascript
```javascript
jest.unmock('redis');
```javascript
```diff
Partials          0          0
```diff
- Misses          158        160     +2
Partials          0          0
As an aside, I think it's really weird that new stuff is red with a plus. I get that it's the unexpected part so it's red, and it's an addition, so it's a plus, it just looks _really_ weird.
An option to invert the current schema would be greatly appreciated (I can provide a PR for it if you want?). My problem might be that the diff looks too much like a git diff, and I conflate the two when I look at it. I'm used to `expected` being green and `actual` being red. But when I look at hundreds of git diffs every day, having something be the same structure, but different colors, throws me off...
This is a diff like GH renders it:
```diff
index 8d4aaab..0bbaf76 100644
"jest": {
--- i/preact/yarn.lock
chokidar "^1.6.0"
strip-ansi "^3.0.0"
bug
When running jest on circle ci, we are having our processes killed due to high memory usage, > 4G.
"babel-jest": "16.0.0",
"jest": "16.0.1",
"jsx",
- `jest help`
![jest-help-alias](https://cloud.githubusercontent.com/assets/434470/21252892/85fbe434-c328-11e6-92d5-2b7db8b5f3e9.gif)
```diff
Misses          158        158
Partials          0          0
@cpojer @orta I'm willing to fix, just want someone to verify what I'm saying actually makes sense :) Happy to have that use `jest --version` - it will need to be split up though, the scope of this class was to grab this config JSON:
Here is my `.babelrc`:
![image](https://cloud.githubusercontent.com/assets/5677929/21237851/abfe7a70-c2ce-11e6-8ee1-5737cf0cf93d.png)
```diff
Misses          158        158
Partials          0          0
- `micromatch` also has more support for extglobs
```diff
Misses          158        158
Partials          0          0
```diff
Misses          158        158
Partials          0          0
```diff
Misses          158        158
Partials          0          0
There was a typo (aplha), so newer versions weren't picked up.
```diff
Misses          158        158
Partials          0          0
Probable bug.
SyntaxError: Unexpected token }
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: Unexpected token )
jest version = 17.0.3
test framework = jasmine2
"/Users/sapegin/Dropbox/Projects/_Repos/react-styleguidist/test/jestsetup.js"
"snapshotSerializers": [
"usesBabelJest": true,
"jsx",
```javascript
* Parsing JS is done in babylon
```diff
Partials          0          0
@cpojer I found #2251 really interesting, so I started working on it just to get a bit more familiar with the internals of Jest, of which I know nothing.
This is a really primitive prototype, which still has several issues that need to be address, as well as testing.
- [x] A better understanding of Jest's architecture to figure out if that is the right place to put that logic.
- [x] Some weird cursor positioning
```diff
+ Misses         1714       1636    -78
Partials          0          0
jest version = 17.0.3
test framework = jasmine2
"name": "-home-awel-Projects-HueEmulator-repo-cloud-CertificationProxy",
"/home/awel/Projects/HueEmulator/repo/cloud/CertificationProxy/node_modules/babel-jest/build/index.js"
"usesBabelJest": true,
"jsx",
Test Suites: 1 failed, 1 total
1. Decide to try jest
As someone who codes I completely understand this, but this is the way you lose users!
My apologies, it was not written with a negative intent, hence the "as someone who codes" part, but to point out the unintended or perhaps unanticipated consequences. This was meant to be helpful and I am sorry I did not phrase it better. The solution of adding a 'not released' note is great, thanks.
However, after a short dive into the way the Jest run-time works, how the Haste resolving works it seems like there is no way to do this.
const replPort = 1234
r.context.nmos = nmos
```bash
I need some help with this. I've tried to work on this a bit but I'm not completely sure how this one is supposed to look? Is this supposed to work 'out of the box' or do we require some configuration? @gaearon was pushing to make the use of `src/node_modules` an official solution for this problem (https://github.com/facebookincubator/create-react-app/issues/1065) so it might make sense to make Jest work with that 'official solution' by default. But curious to hear what the Jest folks think about it. @cpojer can you or someone else knowledgeable about haste help me out on this? I don't really understand how to get the tests passing here.  @cpojer could you reply to my comment? (https://github.com/facebook/jest/pull/2318#issuecomment-266976051) I'd love to work on this pull request but I'm not sure if you want this to work out of the box or should be configurable. IMHO, only `testPathIgnorePatterns` should be needed: using `<rootDir>` or anchoring it at the start (`^/node_modules/`) should be enough.
```diff
+ Misses         1713       1597   -116
Partials          0          0
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
**Code blocks**
**Double quotes**
jest version = 17.0.3
test framework = jasmine2
"snapshotSerializers": [
"jsx",
Thanks in advance! I love using Jest üíØ
@thymikee
https://github.com/facebook/jest#babel-integration
Jest version - 17.0.1
Running N - 5.11.1
I apologize in advanced if this wastes anyone time, and should be posted elsewhere, but the only issue I seem to have is currently with jest. Any help would be appreciated, even if it's go somewhere else to ask them.
Bug
```son
jest version = 17.0.3
test framework = jasmine2
"name": "-Users-ohohoh-Projects-npp",
"usesBabelJest": true,
"jsx",
I don't know what is dynamic require, I'm using `import { MyClass } from "../../../src/MyClass";` syntax.
which relies on: `jest --no-cache --verbose --watch --notify`
@rogeliog you save me man. I'll use this **hack** for now, but
```diff
Misses          156        156
Partials          0          0
Following is the error thrown by jest
bug
**Bug**
[Jest --debug output](http://paste.fedoraproject.org/505250/37864148/)
`jest`
TODO:
```diff
Branches        0        3       +3
- Misses       1685     1693       +8
- Partials        0        1       +1
* Coffeescript is basically all over the place.
A bug.
- **jest** config:
"^react-native$",
"react-native-web"
"jsx",
I'm not entirely sure this is a **jest** bug.
jest version = 17.0.3
test framework = jasmine2
"jsx",
"usesBabelJest": true,
```diff
Misses         1812       1812
Partials          0          0
bug
import 'react-native';
<App />
I made this change because @gaearon [tweeted](https://twitter.com/dan_abramov/status/806554466325504000) about a nasty regex he ended up needing to write.
```diff
Misses          158        158
Partials          0          0
at /src/api/__tests__/acl.test.js:104:19
npm ERR!
npm ERR!
Bug
`npm @3.10.8`
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
```javascript
at ReportNode.Node.visit (/Users/patricklewis/Documents/sites/uTu/console-graphql/node_modules/istanbul-lib-report/lib/tree.js:126:5)
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
api                  |    85.42 |       70 |    77.78 |    84.44 |                |
org-acl.js          |    81.82 |      100 |    66.67 |       80 |          18,42 |
api/models           |      100 |      100 |      100 |      100 |                |
imports.js          |      100 |      100 |      100 |      100 |                |
api/models/agent     |       75 |    55.56 |      100 |    81.82 |                |
mutations.js        |       75 |       75 |      100 |       75 |          10,34 |
schemas.js          |      100 |      100 |      100 |      100 |                |
mutations.js        |      100 |      100 |      100 |      100 |                |
schemas.js          |      100 |      100 |      100 |      100 |                |
schemas.js          |      100 |      100 |      100 |      100 |                |
schemas.js          |      100 |      100 |      100 |      100 |                |
mutations.js        |    83.33 |       50 |      100 |    83.33 |              9 |
schemas.js          |      100 |      100 |      100 |      100 |                |
api/util             |      100 |      100 |      100 |      100 |                |
convert-mongo-id.js |      100 |      100 |      100 |      100 |                |
at ReportNode.Node.visit (/Users/patricklewis/Documents/sites/uTu/console-graphql/node_modules/istanbul-lib-report/lib/tree.js:126:5)
Test Suites: 2 passed, 2 total
The other thing that is odd is that it seems to hang at the very end like the process is still running? It never exits basically. @cpojer i am pretty sure we are doing that correctly
``` @cpojer is it possible tho that this error could be stoping jest from doing things correctly? @cpojer you were correct about the hanging turns out the DB wasn't closing its connection, so that fixed the hanging, but we are still getting the same error.
> jest
at Object.<anonymous> (node_modules/xmlbuilder/node_modules/lodash/lang/isNative.js:26:3)
Test Suites: 1 failed, 1 total
The missing parens have been corrected on master in https://github.com/facebook/jest/commit/97a3ab6544a666c30418b86b9fc2ba14aa202b41 Is the "next release" available? I saw another thread implying that it's available by now, but I did an update and still get the error. Guys, happy new year, still can't use `toMatchObject()` :/ Guys, but I think a good idea would be to add *require Jest 18+* to Asymmetric Jest Matchers section in the docs, I spent like 1 hour trying to make it work.  I definitely agree the behavior is initially confusing, but I think coverage + watch mode does enable a pretty nice workflow after you realize it's only reporting on what ran last. I keep thinking how nice it would be to pair Jest's watch mode with some kind of coverage server that could reload the html report when it changes. No more alt tab and refresh, just write tests and watch the red code change to green code.
> jest
Test Suites: 1 failed, 1 passed, 2 total
Hi @thymikee,
It looks like `json` was a typo for `jest` because:
jest version = 17.0.3
test framework = jasmine2
```diff
Misses          156        156
Partials          0          0
```diff
Misses          156        156
Partials          0          0
When running jest I get the following error:
-- React Native `0.39.0`
jest version = 17.0.3
test framework = jasmine2
"ios",
"react-native",
"%sagas",
"rootDir": "/Users/jdario/Development/netbeast",
"name": "-Users-jdario-Development-netbeast",
"usesBabelJest": true,
"jsx",
"react-native",
"name": "netbeast",
"ios": "react-native run-ios",
"log": "adb shell logcat * | grep com.netbeast.yeti",
"dgram": "react-native-udp"
"bluebird": "^3.4.6",
"lodash": "^4.15.0",
"react-native-localization": "^0.1.22",
"react-native-udp": "^1.2.6",
"react-native-uuid": "^1.4.8",
"redux": "^3.5.2",
"babel-jest": "^17.0.2",
"jest": "^17.0.3",
"jest": {
"platforms": ["android", "ios", "native"],
"react-native"
``` Hey @cpojer, thanks for answering.
Indeed, I am wondering if the docs are good enough for a migration from mocha to jest, as is my case.
```diff
Misses          156        156
Partials          0          0
It would be awesome to have nice error messages for `assert` built-in by default, like [Ava](https://github.com/avajs/ava) does, because `assert` has a lot less downsides than `expect`.
I realize this is going to be potentially controversial, since many people use `expect` as their main assertion library, but please hear me out, because I think there are some pretty objectively good reasons to offer an alternative...
### 2. `expect` has inconsistent naming schemes.
### 3. `expect` uses incorrect grammar.
```diff
In that case, the user doesn't need to be aware that describe is "special" because it is run at the very beginning synchronously, and that even though it co-exists with all of the other Jest-related functions, it doesn't act in the same way.
Jest being the killer testing tool it is for React, tailoring for this pattern for Redux (which 90% of all serious react apps use) makes a lot of sense.
```ts
https://github.com/skovhus/jest-codemods now support Mocha and chai asserts (see https://github.com/skovhus/jest-codemods/issues/16).
```diff
Misses          156        156
Partials          0          0
findCacheDir({name: 'unicorns'});
//=> '/user/path/node-modules/.cache/unicorns'
```diff
Misses          156        156
Partials          0          0
With Sinon's spy I could do something like `spy(store, 'doOneThing');` but I haven't figured out how to accomplished this with Jest.
SyntaxError: Unexpected reserved word
And extra code for support `check.it`
Duplicate module name: lodash
"lodash": "^4.16.4",
"lodash": "^3.10.1",
"lodash": "^4.17.4",
"babel-jest": "19.0.0",
"jest": "19.0.2",
bug
"jest": {
- jest 17.0.3
```Json
"ts-jest": "latest",
"jest": {
```Json
"ts-jest": "latest",
Same behavior seems to work for `babel-jest`.
```diff
Misses          156        156
Partials          0          0
- bug
jest: 17.0.3
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
```diff
Misses          156        156
Partials          0          0
bug.
Here `spec.getFullName()` equals to `test one-package`. Hard-coded prefix `test` is used.
b: jasmine.objectContaining({
I expect to have printed special format for asymmetric comparison value.
For example, pure Jasmine detects special value and formats it accordingly:
Object({ a: 1, b: <jasmine.objectContaining(Object({ test: true }))> }).
```diff
- Misses          156        206    +50
Partials          0          0
@just-boris Hello! Thank you for the issue about formatting. Here is a question:
Do you ever use asymmetric matcher as argument to `expect(‚Ä¶)` in Jasmine?
Jasmine code allows it there, it confuses me to put in `expect(‚Ä¶)` instead of `.toEqual(‚Ä¶)`
Because of the double overloading of arguments, Jasmine has special code to detect if there are matchers at left and right, that is arg of `expect` and also `toEqual` and then compare them as objects instead:
* Would it be possible to write a codemod to adapt existing tests with Jasmine matchers?
* Would it help us to implement more helpful format of Jest output?
* defining a new Jest assertion to make it explicit that its argument is from new `expect` versions of these valuable matcher factories, including especially the custom matcher interface
* still continue to allow Jasmine matchers in `.toEqual` but maybe deprecate in the future
P.S. At this moment, I don‚Äôt have any inspiration what might communicate clearly as the suffix word X for a new `.toMatchX` assertion for these more flexible or custom matchers. > Do you ever use asymmetric matcher as argument to expect(‚Ä¶) in Jasmine?
An inconsistency that might be a **bug** in `toMatchObject` assertion.
I tried writing a test for it, but there's no tests actually testing the default regex, AFAICT. It's a common pattern in small modules (which normally has just an `index.js` and a `test.js` in the root of the project), both Mocha and Ava supports it out of the box Good point, updated.
```diff
Misses          156        156
Partials          0          0
```diff
Misses          156        156
Partials          0          0
A bad translation from mocha -> Jest had tests that looked like this:
(Started migrating to jest today, and the only thing I'm really missing from Ava is the Eslint plugin (and no globals, but that is more of a style, it doesn't really matter)) I'll happily contribute to the eslint plugin! @cpojer I am very happy in making it more official! Anything I can do to help let me know and always happy to accept pull requests. This thread went perfectly üëç  @cpojer I've created a pull request for it: https://github.com/facebook/jest/pull/2214 and I've added you to the npm package. One thing I really like about [tap](https://github.com/tapjs/node-tap), is that you **must** either use `t.end()` to signify that your test is over, or `t.plan(/*number of assertions*/)`. That's one of the things I dislike about tap... :laughing: `end` should only be needed in callbacks, `plan` should really only be used if you assert in catch clauses or loops for instance. IMO it just adds noise to the test, making me read more to see what's actually tested
bug
Invariant Violation: Native module cannot be null.
Darwin 16.1.0
openURL: jest.fn(),
canOpenURL: jest.fn(),
getInitialURL: jest.fn(),
The problematic line is `const Linking = require('react-native').Linking;` from the [react-native-experimental-navigation](https://github.com/aksonov/react-native-experimental-navigation) fork that react-native-router-flux uses.
"test": "jest"
"jest": {
"babel-jest": "17.0.2",
"jest": "17.0.3",
openURL: jest.fn(),
canOpenURL: jest.fn(),
getInitialURL: jest.fn(),
"jest": {
openURL: jest.fn(),
canOpenURL: jest.fn(),
getInitialURL: jest.fn(),
requestPermissions: jest.fn(),
openURL: jest.fn(),
canOpenURL: jest.fn(),
getInitialURL: jest.fn(),
"jest": {
"jest": {
```javascript
FAIL  js/sagas/App/__tests__/watchCheckDevicePermissions-test.js
```javascript
```javascript
jest.mock('Pusher', () => {
This is my jest config in package.json:
"jest": {
React version: 15.4.2
```javascript
requestPermissions: jest.fn(),
done: jest.fn()
NativeModules: {
RNPasscodeStatus: {
status: jest.fn(),
get: jest.fn()
width: jest.fn(),
height: jest.fn()
jest.mock('react-native-camera', () => {
requestPermissions: jest.fn(() => Promise.resolve()),
getInitialNotification: jest.fn(() => Promise.resolve()),
```tree
__mocks__/
How can I help support that? Makes sense to me.  I know I've seen this done similarly in Babel:
<Foo>
* ‚Äúextra‚Äù props, for example `<Bar who="John" what="person" />`
https://jasmine.github.io/edge/introduction#section-Custom_asymmetric_equality_tester
> ‚Äúextra‚Äù props, for example `<Bar who="John" what="person" />`
Here come **incorrect vdom** for the previously proposed shape (`<Foo><Bar who="John" /></Foo>`):
<Foo />
<Foo />
<Foo>
<Baz />
<Foo>
<Bar who="Michael" />
``` @pedrottimark
Following up on https://github.com/facebook/jest/pull/2213#issuecomment-264733764 I would welcome any thoughts from @just-boris or examples from experience with `jasmine.objectContaining` which sounds similar to `.toMatchObject` The `.toMatchObject` assertion can **match a subset of the props** of rendered DOM nodes:
// 3 alternative ways to declare the assertion
http://reactkungfu.com/2015/07/approaches-to-testing-react-components-an-overview/
whimper: '',
```diff
+      small but powerful: ha * ha === ha ** 2
If you think there is a case to propose a change, are you willing to take the role of ‚Äúchampion‚Äù if I am willing to do the work? Aha, at this very moment, the situation has become more complex:
### Part A: differential snapshot
**Opinion 4**: Is irrelevant descendants sentinel value needed? What to call it? How to import it?
* how, where, and whether it fits into Jest code
* `<` for removed to contrast with `-` for expected in Jest or removed in GitHub
```diff
-<   Off
+    Off
The **alternative** API with `toMatchDiffSnapshot` answers how to use it (except maybe for **options**). To avoid duplicated code, I think it would imply refactoring in:
<Foo>
<Foo>
I'll be sure to post a gist back to this thread once it's ready--it might be worth bringing into Jest even in that form, since it should actually be consistent with React's transformations in theory (`virtual-dom` appears to use the same constraints for diffing as React, for example its treatment of keys and type changes). Starting from Fiber (available as `react@next` on npm), writing custom renderers really is a bliss and doesn't really require any React knowledge anymore (everything can fit in a single file!). I've documented which functions need to be implemented [here<sup>1</sup>](https://github.com/manaflair/mylittledom/blob/master/sources/term/react.js#L232), if you're interested to take a look.
https://jasmine.github.io/edge/introduction#section-Custom_asymmetric_equality_tester
<div role="menubar">
<div role="menuitem">Save</div>
<div role="menuitem">Edit</div>
<div role="menubar">
<div role="menuitem">Save</div>
<div role="menuitem">Edit</div>
Invalid:
<div role="menubar">
<div role="menuitem">Save</div>
<div role="menuitem">Edit</div>
<div role="menubar">
<div role="menuitem">Save</div>
<div role="menuitem">Edit</div>
Oversimplified diff when test fails:
```diff
<div role="menubar">
<div role="menuitem">Save</div>
<div role="menuitem">Edit</div>
P.S. If the `accessibleSubset` function also omits **props** which are irrelevant for this type of test (for example, event handler functions) then you might not even need to consider replacing `toMatchSnapshot` assertion with `toMatchObject` assertion as discussed in this issue :) As a quick follow up for those that are interested, I finished my diffing module and have released it as an npm package, [`diff-react`](https://www.npmjs.com/package/diff-react). I didn't end up using a custom Fiber renderer, but it does all that I planned it to do at first using `virtual-dom` and should work for React, React Native, and React VR (the purpose for which I created it).
I don't want to distract from @pedrottimark's point though, because I agree that the original subset matcher has merit of its own, so if anyone has any questions on `diff-react` feel free to open an issue on [its Github](https://github.com/0x24a537r9/diff-react/issues). Thanks! The sort of thing that @jessebeach was suggesting is _exactly_ what unexpected-react does (just not with the accessibility tree), and can confirm it makes for great non-brittle tests
<div className="foo bar baz">
```diff
Misses          156        156
Partials          0          0
```diff
Misses          156        156
Partials          0          0
Allows using `async` functions inside the jest codebases.
To address both of the issues:
- no access to the `expected` and `actual` values for `jest` built-in and custom matchers, and generally no access to a matcher result,
- no access to a custom assertion library error, in case if a custom assertion library, such as `chai` or [anything else](https://twitter.com/bruderstein/status/798440122844872704), is used with `jest`,
We [have been supporting](https://twitter.com/wallabyjs/status/599120830090465280) `jest` since jest v0.4.3, so way before it was as popular as it's becoming now :)
The way wallaby integrates with `Jest` is by using the [`TestRunner`](https://github.com/facebook/jest/blob/master/packages/jest-cli/src/TestRunner.js) directly and providing `setupTestFrameworkScriptFile` with a custom jasmine reporter to subscribe and handle jasmine's `specStarted`/`specDone`/etc. events.
> Is there a reason you cannot use Jest's lovely output?
**Hypothesis** to discuss: accurate decision = clear purpose + definite expectation + relevant details
Here are 3 **use cases** for y‚Äôall to challenge or confirm.
Could we balance snapshots that make claims about everything‚Ä¶
Install Jest
"Install Jest",
"Install Jest",
href="http://facebook.github.io/jest/"
Jest
href="http://facebook.github.io/jest/"
Jest
## Interaction: only diff
Moar **use cases** are welcome!
This came up while I am adapting a subset of Whinepad from Stoyan‚Äôs book for a potential meetup presentation about Refactoring confidently with checks and tests (Flow and Jest). Let‚Äôs keep it as an open possibility that I might learn enough to work with y‚Äôall on it in some way. My mascot is a turtle, if you need a mental picture :) üëã I thought I'd chime in with responses to some of the comments above and other feedback from my experience with snapshot tests.
- @pedrottimark What do you think is the danger of having snapshots that are *too large*? What is the motivation for excluding parts? Jest already does a great job displaying a diff that shows you the specific location of a divergence ‚Äî and version control diffing tools will also do that, at least as well ‚Äî¬†so why is it a problem if, say, four test cases produce thousand-line snapshots that only vary in one line? Performance? Or is it that you don't want to test parts of the UI. If that's the case, why not? Would improvements to the process of updating snapshots make you less concerned about large snapshots?
‚úã mee too
Important question: if I gave impression that size itself is the danger, then I miscommunicated.
If you pretend that the red and green GitHub convention is green and red Jest convention, can you interpret the result as a possible mistake related to internationalization of the component?
```diff
-- Off
++ allum√©
Or is -- -+ +- ++ from snapshot diff and state change too confusing?
If you pretend that the red and green GitHub convention is green and red Jest convention, can you interpret the result as a possible mistake related to internationalization of the component?
```diff
+> allum√©
* double quote marks around the entire difference
```diff
Major misunderstanding to avoid: if there is a change in a **sequence**, for example, of todos:
```diff
-<   Off
+    Off
```diff
-<   Off
+<     Off
```diff
-<   Off
+      Off
const onClick = jest.fn();
Install Jest
const onClick = jest.fn();
Install Jest
In general, your workflow goes from what you're doing now, which is looking at pass/fails of tests you spent a lot of time optimizing to give you a relevant *but not too noisy* perspective of your code **to** quickly analyzing your snapshots in this "3D" time-traveling differ app. You're now a detective armed with all the tools you need to get to core of the problem--and you do so continually as part of your workflow--rather than perhaps over-confidently relying whether your tests pass.
tree,
return tree
tree
SUPER QUICK USAGE using `snap()`:
//It's all redux-connected and reactive internally, which otherwise jest doesn't
//you start mocking in order to get the "zoom" level that provides the best
So the conclusion is we're doing too much work, and we do the above for now, but instead of thinking about how to best optimize our "zoom" level of snapshots, we need to take a step back and build a snapshot browser built from the ground-up with these problems in mind. Jest is so good. It's changed the game. These options wouldn't be available to us if it wasn't for Jest, React and Redux. I think we have no choice but to double down and see the whole new world that is available to us and build for that, rather than build for the micro problems of yesterday that will all seize to exist under one fell of something like this. Where do we start? How do we get the electron diffing app up asap? We open source that and get it going, and then we all contribute the various pieces as part of a plugin system. Lets go!  A DISTILLATION OF THE CORE CONCEPTS:
jasmine.addMatchers({
```jsx
``` @cpojer I just wanted to point out and let the Jest community know that WallabyJS in the meantime has become the perfect snapshot browser, especially since its creator @ArtemGovorov added a feature I requested to show snapshot diffs inline as you browse your tests:
https://twitter.com/wallabyjs/status/819121381002489856
![wallaby](https://cloud.githubusercontent.com/assets/154732/22279190/f1c91988-e27d-11e6-9c76-4a91cc13fb3c.png)
Obviously the plan I laid out above is the basis for a company and a massive undertaking, but with Wallaby *today* you can achieve the foundation of the strategy. Wallaby is the perfect match for Jest. It's a match made in heaven. The combination has take my workflow to a whole new level.
jest version = 17.0.3
test framework = jasmine2
"rootDir": "/Users/carlos/src/gitlab.com/citygro/broken-test",
"usesBabelJest": true,
"jsx",
// for app
gaearon/redux-thunk#115
const myFn = jest.fn()
### TODO
```diff
Misses          156        156
Partials          0          0
"axios": "^0.15.*",
"lodash": "^4.16.4",
"react-native-i18n": "^0.1.1",
"tcomb-form-native": "^0.6.1"
"babel-jest": "^17.0.2",
"faussaire": "^0.2.2",
"faussaire-util": "^0.1.0",
"jest": "^17.0.3",
"jest-enzyme": "^2.0.0",
"jest-react-native": "^17.0.3",
"react-native-mock": "^0.2.7",
"jest": {
Thanks.  I'm adding Jest Testing framework to my React Native project that has lot of native dependencies. I'm getting the following error:
import 'react-native'
"jest": {
### TODO
- [x] Convert from mocha -> Jest
```diff
Misses          162        162
Partials          0          0
```javascript
Bug.
git clone git@github.com:Moeriki/jest-test.git
cd jest-test
npm prune
Jest still works after `npm prune`.
jest version = 16.0.2
test framework = jasmine2
"rootDir": "/Users/moeriki/Projects/jest-test",
"name": "-Users-moeriki-Projects-jest-test",
"testRunner": "/Users/moeriki/.nvm/versions/node/v4.4.7/lib/node_modules/jest-cli/node_modules/jest-jasmine2/build/index.js",
"jsx",
"/Users/moeriki/Projects/jest-test"
Aborted (core dumped)
One branch `master` is running Jest, the `mocha` branch... mocha.
- the Jest version is slower and does not exit automatically after test is completed.
- Mocha version is way faster, and container exit after test is completed.
jest -w='2' --no-cache --coverage
PASS  lib/utils/__tests__/isOnlyWhitespace.test.js (1381 MB heap size)
It's worth pointing out here that the rule test files, which are causing this memory failure, do not look like standard Jest tests. In order to try switching to Jest without rewriting all of the tests (which would be either a huge manual pain or a moderate jscodeshift pain, would have to try it out), I wrote [a setup file that exposes a `global.testRule` function that then calls `describe` and `it`](https://github.com/stylelint/stylelint/blob/master/jest-setup.js). I wonder if that's some kind of antipattern, and Jest makes assumptions that it violates. I think I have some evidence that the memory problem is likely within Jest, rather than stylelint, because it looks to me like the same problem occurs with very simple tests.
Just chiming in after doing some more investigation it seems like `Runtime` is a bit out of control.
The context in the majority of these objects seems to point to graceful-fs and `gracefulify`.
Hi @cpojer thanks for the quick reply.
Just wanted to clarify that this analysis was run in the actually Jest repo by running the following commands:
```diff
Misses          162        162
Partials          0          0
```diff
Misses          162        162
Partials          0          0
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
JestCacheTest
Unnecessary word ('get') in document.
```diff
Misses          161        161
Partials          0          0
```diff
Misses          161        161
Partials          0          0
git clone git@github.com:gyzerok/jest-ts-bug.git
cd jest-ts-bug
Hello @cpojer
By writing this I am now thinking that it has nothing to do with Jest. But still maybe it would be nice to use [ts-jest](https://github.com/kulshekhar/ts-jest) in the example instead of providing preprocessor which is kind of broken in so many ways. And of course it would be nice to be explicitly notified about problems with type errors in TypeScript, so one could see the trade-offs before putting his time in technology adoption. @cpojer actually if Jest would provide ability to use stuff like `babel-register` or `ts-node/register`, like mocha do, issue would be solved I guess. BTW, `ts-jest` doesn't currently display type errors either. I've opened [this ticket](https://github.com/kulshekhar/ts-jest/issues/79) to request that feature.  I've been trying to combine Jest with Mongoose and Mockgoose to run tests with a mocked database. When I run the tests in https://github.com/migomipo/jest1, which contains an intentional test failure, the Jest CLI behaves strangely. Rather than reporting the failures as usual, it crashes¬†with this message, without even reporting the results of the rest of the tests:
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
RUNS  __tests__/mongoose.test.js
Hey @migomipo, I wanted to take a look at the repro, but it throws error on clean build:
at Db.<anonymous> (/Users/akukolu/myproject/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:170:10)
at Server.listener (/Users/akukolu/myproject/node_modules/mongodb/lib/db.js:1786:14)
at Server.<anonymous> (/Users/akukolu/myproject/node_modules/mongodb/lib/server.js:274:14)
``` > It definitely looks like mongoose / mongo / your tests are not cleaning up after themselves
The babel-jest package can sometimes be used to transpile and instrument
at the same time. Only jest-runtime was passing CWD properly to
istanbul. This pull mirrors this behavior in babel-jest as well now.
After this change, any usage of istanbul that I can see is properly passed a 'cwd' variable equal to the config.rootDir option. No tests or APIs should be impacted by this.
```diff
Misses          161        161
Partials          0          0
```diff
Misses          161        161
Partials          0          0
```diff
Misses          161        161
Partials          0          0
It's annoying to have to mock AsyncStorage myself - other people might find it annoying too! üò∏
Some AsyncStorage methods are a little complex, like getItem, etc. and require the user to manually mock these out with their desired return values. No attempt is made to accomodate this workflow.
fn.mockThrowError('abcd');
expect(fn).toThrowError('abcd');
fn.mockThrowError(new TypeError('abcd'));
```diff
- Misses          156        158     +2
Partials          0          0
// This seems hacky
```javascript
```jsx
```javascript
```javascript
```javascript
jest.flushAllPromises();
I've tried `runAllTicks` and `runAllTimers` to no effect.
```javascript
``` @jwbay that's some nice sugar right there üç†!
@pekala the one liner IMO doesn't provide the required behavior because it will not wait until the following pending promise is resolved:
.then(() => { jest.runOnlyPendingTimers(); })
.then(() => { jest.runOnlyPendingTimers(); })
.then(() => { jest.runOnlyPendingTimers(); })
Thanks!  I run jest in Travis CI, get this error:
"jest": {
"babel-jest": "^17.0.2",
"jest": "^17.0.3",
"jest-react-native": "^17.0.3",
"jest": {
"jest": {
"jest": {
What we should choose? @ColCh Thx~  <!-- *Before creating an issue please make sure you are using the latest version of Jest, try re-installing your node_modules folder and run Jest once with `--no-cache` to see if that fixes the problem you are experiencing.* -->
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
jest version = 17.0.3
test framework = jasmine2
"usesBabelJest": true,
"jsx",
my fight has lasted 3 days already and I simply cannot get Jest to work.
SyntaxError: Unexpected token .
jest version = 17.0.3
test framework = jasmine2
"\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$",
"usesBabelJest": true,
"cacheDirectory": "/var/folders/7n/rt2dyl55515d73sz0kt797z80000gn/T/jest",
"jsx",
SyntaxError: Unexpected token .
Test Suites: 1 failed, 1 total
jest.unmock('enzyme');
"jest": {
"babel-jest": "12.0.2",
"happypack": "2.1.1",
"jest": "^17.0.3",
"jest-cli": "*",
"rimraf": "2.5.2",
"lodash": "3.10.1",
"material-ui": "0.13.4",
"node-sass": "3.4.2",
"redux": "3.5.1",
Hi @azrahel!
Hope that helps you to resolve the issue, but it's most likely not a problem with Jest. Adding
"jest": {
jest version = 17.0.3
test framework = jasmine2
"jsx",
"jsxm",
"rootDir": "/Users/fkretzer/development/mayycon",
"name": "-Users-fkretzer-development-mayycon",
"usesBabelJest": true,
Looks like a typo.
```diff
Misses          161        161
Partials          0          0
Jest reports "No tests found" even when there are tests
jest version = 16.0.2
test framework = jasmine2
"jsx",
"/Users/justinfalcone/work/modernserf/test-jest/config/jest/FileStub.js"
"/Users/justinfalcone/work/modernserf/test-jest/config/jest/CSSStub.js"
"/Users/justinfalcone/work/modernserf/test-jest/config/polyfills.js"
"/Users/justinfalcone/work/modernserf/test-jest/(build|config|node_modules)/"
"/Users/justinfalcone/work/modernserf/test-jest/node_modules"
"testEnvironment": "/Users/justinfalcone/work/modernserf/test-jest/node_modules/jest-environment-jsdom/build/index.js",
"rootDir": "/Users/justinfalcone/work/modernserf/test-jest",
"name": "-Users-justinfalcone-work-modernserf-test-jest",
"scriptPreprocessor": "/Users/justinfalcone/work/modernserf/test-jest/node_modules/babel-jest/build/index.js",
"usesBabelJest": true,
"/Users/justinfalcone/work/modernserf/test-jest"
testPathDirs: /Users/justinfalcone/work/modernserf/test-jest - 12 matches
Hey @modernserf
I ran into the same issue and adding the following to my Jest config helped:
// .jestrc
Bug I think.
jest version = 17.0.3
test framework = jasmine2
```javascript
const obj = { biz: 'baz', foo: 'bar' };
cesar@fozzie:~/demo$ ls -ald /tmp/jest/
drwxr-xr-x 3 jenkins jenkins 4096 nov 20 23:13 /tmp/jest/
cesar@fozzie:~/demo$ ./node_modules/.bin/jest --debug --no-cache
jest version = 17.0.3
test framework = jasmine2
"rootDir": "/home/cesar/demo",
"name": "-home-cesar-demo",
"/home/cesar/demo/node_modules/babel-jest/build/index.js"
"usesBabelJest": true,
"jsx",
"/home/cesar/demo"
Error: EACCES: permission denied, open '/tmp/jest/haste-map--home-cesar-demo-90020ade716ebf28b3b7c8845c128649'
Or it could append the username to the `cacheDirectory` like `/tmp/jest-cesar`, but it seems very strange. Could I request that this be re-opened?
Right now the only supported format for the config is JSON. But it might be very handy to support JS with all the power of require/resolve in order to reduce code duplication. For instance, this would allow much less code duplication in case of webpack:
Imagine:
@okonet
```javascript
1. When the application talks to my mongoose model
// Mocking express req and res
jest.mock("../model/mymongoosemodel", function() {
//mocking the behavior of the mongoose model (find and sort => chainable) returning a promise
jest.mock("../model/mymongoosemodel", function() {
//mocking the behavior of the mongoose model (find sort and skip => chainable) returning a promise
If i run this, the second test fails because there is no skip in my mongoose model.
I analyzed that and found that the second  `jest.mock` call on `../model/mymongoosemodel` did not override the first one.
jpolack
jest version = 17.0.3
test framework = jasmine2
"cacheDirectory": "/var/folders/1n/wqmw_88514g656zcmvsp0gvc0000gn/T/jest",
"jsx",
mock({
two: jest.any(Number) //like jasmine.any(Class)
four: jest.match.has('x')
value: sinon.match(v => v >= 100 && v < 200)
```jsx
value: FAKE_PASSWORD,
I've set `jest.useRealTimers()` and use the `setTimeout` and `done` functionality as shown in the test, which works for `expects` that pass. But if an `expect` fails, I don't get the normal nice output, I just get `Timeout - Async callback was not invoked within timeout specified by jasmine.DEFAULT_TIMEOUT_INTERVAL`, which makes me feel like I'm doing something funky here.
Let me know if not. Thanks! I have the same problem - failures inside a setTimeout function don't get printed, and the test takes the full `jasmine.DEFAULT_TIMEOUT_INTERVAL` time to timeout, too. Is there a better way to test async code when it doesn't expose a promise?
```javascript
```javascript
```javascript
```javascript
https://github.com/acateland/jest-mock-issue
The differences between these are slightly tricky:
``` diff
Partials          0          0
- jest-snapshots relies on a context that has `dontThrow` function - that however depends too much on the implementation
``` diff
Partials          0          0
``` diff
Partials          0          0
Bug
"jest": {
// INTERESTING IMPORT ‚Üë
jest version = 17.0.3
test framework = jasmine2
"name": "-Users-moox-...",
"usesBabelJest": true,
"/Users/moox/..."
``` diff
Partials          0          0
``` diff
Partials          0          0
Bug
jest version = 17.0.2
test framework = jasmine2
"usesBabelJest": true,
"cacheDirectory": "/var/folders/d_/b1bghypn20lgq2b24v7396pr0000gn/T/jest",
"jsx",
``` to me it sounds like a Jest bug. Here's a minimal repro anyway:
return drown(euron)
However if the `drown()` returns a fulfilled promise, the test will pass, which is wrong.
``` diff
Partials          0          0
jest 16.0.1
Bug
When I run `jest --no-cache --coverage` I see in my generated html of istanbul that my tests are not completely at 100%. Mostly in the Statements and Branches tab.
- Jest: 17.0.2
"/Users/albertolive/Cornerjob/webApp/cfg/preprocessor.js"
"/Users/albertolive/Cornerjob/webApp/cfg/mocks/fileMock.js"
"/Users/albertolive/Cornerjob/webApp/cfg/mocks/styleMock.js"
"/Users/albertolive/Cornerjob/webApp/(dist|coverage|node_modules)/",
"rootDir": "/Users/albertolive/Cornerjob/webApp",
"name": "-Users-albertolive-Cornerjob-webApp",
"testRunner": "/Users/albertolive/Cornerjob/webApp/node_modules/jest-jasmine2/build/index.js",
"cacheDirectory": "/var/folders/yk/yplyrtvd3vs5mxtp2mthjqp40000gn/T/jest",
"/Users/albertolive/Cornerjob/webApp"
https://github.com/albertolive/jest-ES6
Bug
```javascript
jest.mock('./doBar', () => {
jest version = 17.0.3
test framework = jasmine2
"jsx"
"usesBabelJest": true,
```javascript
``` diff
Partials          0          0
> @ typecheck /Users/zcho/src/jest-work/jest
packages/jest-util/src/FakeTimers.js:90
^^^^^^^^ property `nextTick`. Property not found in
I'm trying to run jest and now the following error is occuring:
> jest
2. `cd jest\examples\getting_started`
> jest
"jest-cli": "*"
bug
bug I guess?
and conf:
``` diff
Misses          162        162
Partials          0          0
"jest": {
`.babelrc`
jest 17.0.2
I'm always running jest with `--no-cache` flag when upgrading or changing configs.
> What does your Jest config look like?
"jest": {
See: 8d05bec.
Jest produces (type object):
Which is completely different to the expected value (type array):
Right now to trick jest into working for me I have to use `/__tests__/([^\\.]*)(?!\\.it)\\.(tests|spec)\\.(js|jsx)$` as my `testRegex` which is not very optimal. Good to now. Maybe the documentation in that case should be adjusted as I expect a pathIgnore to work only on the path not necessarily on the path including file name.  It would be great if we could have tests fail when they produce a console error, instead of just outputting it. I've seen components getting updated, but not their tests. This goes unnoticed because it doesn't cause a failure.
(Nb: We also have code that is supposed to produce a console.warn, which shouldn't cause a test fail.) Thanks for your reply! I will try to get a PR in next week. @cpojer @thymikee @hkrutzer It doesn't look like there was a PR created for this, correct?  Is this still something you think we should add?   Planning on it - but since this will be my first time contributing here, it might take some time. any movement on this? I might try to work on this if not. @uxtx Please do!  Sorry I have not had time to make any meaningful progress. No problem! I've got some time this weekend. I'm thinking this should be a config option you could set in package json... maybe something like `throwOnConsole` that would accept either an array of console types to error on or Boolean to throw on all/none console errors... defaulted to false. Thoughts? My thoughts exactly.   **Summary**
``` diff
Misses          162        162
Partials          0          0
bug
> jest
Good catch! `brew remove watchman` did the trick, thanks for pointing out the right direction! üëç
``` diff
Misses          162        162
Partials          0          0
jest version = 17.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
FAIL  .\savage-overwrite.test.js
"osef"
Difference:
Comparing two different types of values:
Received: string
"osef"
Difference:
Comparing two different types of values:
Received: string
Test Suites: 1 failed, 1 total
``` diff
Misses          162        162
Partials          0          0
jest version = 16.0.2
test framework = jasmine2
"jsx",
"jest": {
Currently, my Jest config is:
"jest": {
"jsx"
both *feature* and *bug*
``` diff
Misses          162        162
Partials          0          0
Done @cpojer
@gaearon I came up with a slightly different approach to fix the issue here: https://github.com/thejameskyle/pretty-format/pull/50
@cpojer looks like @gaearon is good with this change. Anything blocking acceptance?
Bug
`  "jest": {
To retain the ability to process files through babel-jest and also run them through custom transforms.
`jest version = 17.0.0
test framework = jasmine2
"jsx",
All this worked correctly in jest 14
npm test /datat
"jest": {
Bug.
```ts
SyntaxError: Unexpected identifier
```ts
Bug
- s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L8.4,11H15c0.6,0,1-0.4,1-1S15.6,9,15,9z" />
id="talend-arrowright">
*Jest --debug log*:
jest version = 17.0.0
test framework = jasmine2
"name": "-home-jsomsanith-Documents-dev-workspace-react-talend-components",
"/home/jsomsanith/Documents/dev/workspace/react-talend-components/node_modules/babel-polyfill/lib/index.js"
"usesBabelJest": true,
"jsx",
Error
- s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L8.4,11H15c0.6,0,1-0.4,1-1S15.6,9,15,9z" />
id="talend-arrowright">
id="talend-badge">
Test Suites: 1 failed, 1 total
Thank you in advance for your time, Jest rocks ! Hi @thymikee,
$ yarn
bug
`jasmine.DEFAULT_TIMEOUT_INTERVAL = 30000;`.
jest version = 17.0.0
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"snapshotSerializers": [
"ios.js"
"usesBabelJest": true,
jest version = 17.0.0
test framework = jasmine2
"usesBabelJest": true,
Here's the offending code:
Though the workaround is trivial (s/schema/MyWhateverSchema/), it feels like a bug to rename and restructure non-test code to make jest happy üêû .
Cool. I might find some time tomorrow to cook up a patch, but no promises though üòÖ
@cpojer how about a flag? Would you accept a pr that enables/disables this with a flag?
@cpojer right - which parts of jest does this touch?
I just tried with a [new repo](https://github.com/EnoahNetzach/jest-duplicate-manual-mock), using two versions of jest (`^15.0.0` and `^17.0.0`) and, although the latter gives the warning, the test behaves as expected.
‚îÇ   ‚îú‚îÄ‚îÄ __mocks__/
‚îÇ   ‚îú‚îÄ‚îÄ __mocks__/
``` diff
Misses          162        162
Partials          0          0
"ghooks": {
"commitizen": {
"jest": {
When I use `yarn add jest`, I get the following warning:
`warning jest > jest-cli > istanbul-api > fileset > minimatch@2.0.10: Please update to minimatch 3.0.2 or higher to avoid a RegExp DoS issue`
```"jest": {
I use babel-jest
@cpojer I understood that but my babelrc is as follows
"react-native",
Should test against dom not native.
"@kadira/storybook": "^2.29.3",
"babel-jest": "^16.0.0",
"jest-cli": "^16.0.2",
"jest": {
Bug
"jest": "^16.0.2",
"jest-react-native": "^16.1.0",
"babel-jest": "^16.0.0",
> jest
All files |  Unknown |  Unknown |  Unknown |  Unknown |                |
Test Suites: 1 failed, 1 total
I assume that is supposed to mean `Jest works with`
``` diff
Misses          145        145
Partials          0          0
```javascript
```javascript
while the other two tests correctly reporting back the failed expectation. Correctly works in Jasmine.
```javascript
``` diff
Partials          0          0
species: {
name: "Droid"
species{
and the .babelrc
"presets": ["babili"],
/Users/kennetpostigo/Projects/greed/__tests__/greed.test.js:1
``` Hi @kennetpostigo, are you sure you have `babel-jest` in your deps?
```javascript
```javascript
``` diff
Misses          151        151
Partials          0          0
How would i do that? Is there any configuration option? Those features come from Jasmine (https://jasmine.github.io/), which is used under the covers in Jest.
bug
If it rejects Jest waits for it.
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
Unfortunately, I'm not sure how to handle them ‚òπÔ∏è
|  jest  |
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
*bug*
Ok, [here's the repo](https://github.com/kentcdodds/jest-globals-bug). Here's the source:
I realize this is kinda weird. I'm actually not even sure whether this is specifically what's causing issues in my app, but my slice-js project does this to work some of its own magic for tests and I've definitely run into the problem (so far I've been able to work around it ok).
Error: confit
So I'm thinking that confit is being compiled via Jest.
Error: confit
Note, if I change that line in `confit` to be:
Then that fixes the problem (and I'm pretty sure it also preserves the behavior, even if it is a bit hacky).
Also, thanks so much @cpojer :) Jest does quite a bit of magic under the hood which leads to odd things like this sometimes, but for the most part, I've never been happier with a testing framework, so thank you so much for all your work on Jest!
Weird... `JSON` isn't listed in the [node docs](https://nodejs.org/api/globals.html), and it behaves weirdly in the repl, too:
I ran into this same issue when using [`node-fetch`](https://github.com/bitinn/node-fetch) in some tests. Internally it has an `instanceof Array` check that unexpectedly fails in Jest. For anyone else who may run into this issue, I've [opened a PR](https://github.com/bitinn/node-fetch/pull/220) there switching to `Array.isArray`. What if we added transformations for eg. `instanceof Array` to `Array.isArray` to `babel-jest`? For those who aren't aware that jest uses `vm`, this error could be really weird/annoying to debug. Unless that transformation is less intuitive/more dangerous @cpojer I'm still seeing this in Jest 18.1 - reproduced here: https://github.com/thomas-huston-zocdoc/jest-fetch-array-bug You got it! https://github.com/facebook/jest/issues/2549  **Do you want to request a *feature* or report a *bug*?**
**Workarounds**
Other thoughts
Also, I'm wondering if it would be easy to support a Stream as well?
I'm not sure how easy it is to implement this in Jest but, yeah, I might try to work on this.
@thymikee sorry  - I don't read my Git emails by default (as I get 100's). I've got another issue https://github.com/facebook/jest/issues/2038#issuecomment-271368503 that almost allowed me to do what I wanted, but I abandoned it. I'll see if I've still got the code and resurrect it. Seems unfortunately my approach (https://github.com/facebook/jest/issues/2038) doesn't really fit well with the Jest matchers, which was my way of trying to do it without modifying much of the Jest internals :( +1 on this issue. I'm generating screenshots using nightmare which I want to compare to the expected look. I've hacked something on top of Jest to accomplish this for now (using the snapshot serializer) but it's terribly hacky. I would suggest re-opening this issue. @thymikee I only have a hack right now, I'll see if I can find some time to write a proper implementation in jest  **Do you want to request a *feature* or report a *bug*?**
ReferenceError: moment is not defined
Not sure if this is Jest-specific or just a general node issue, but running `jest --watch` causes:
5: printObject(aka printObject) [/Users/esj/code/lion/c...
Would it be possible to make `toMatchSnapshot()` return a `bool` to indicate success or failure? Or alternatively expose a variable somewhere else I can get to to determine this? I had a look at making this modification in a fork, as it seems a pretty simple fix, but I'm having some real trouble getting the tests to pass Wondering if someone can help me? I've forked and committed a fairly innocuous change: https://github.com/IPWright/jest/commit/6bf49b7be31c3123343bb5354deec876b4368a54
Unexpected return from a matcher function.
'undefined' was returned
``` diff
Misses          151        151
Partials          0          0
> https://github.com/notifications/unsubscribe-auth/AAACzmH-ujemQFDDewWN6H2GX0HbjHK3ks5q5podgaJpZM4Klior
@cpojer thank you for the clarification!
FYI, I was about to submit a PR but I could not find the source code for the site. Is that open source as well? @alansouzati hey. I was making changes to make it work both on github and website but github anchor generation is really weird.
@alansouzati that's the file you need to edit to fix it https://github.com/facebook/jest/blob/master/website/core/Header.js
I got really desperate and implemented Mocha with the identical tests.
And then I came back to Jest and tried the same trick of increase timeout. However, the problem still persists with Jest üòû
Now I have lost all my confidnece against Jest... Would you please tell me how I can fix this simple test in Jest?
"jest": {
and everything just worked =) @fdaciuk The thing is, firebase should be able to run in both browser and node environments (it uses the browserify "browser" flag), so it could still need to be tested in the default browser environment. In my case,  firebase starts up fine, and I get a response from firebase.io; but trying to login/register or change any data fails with a network connection interrupted error.
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
‚óè foo
Test Suites: 1 failed, 1 passed, 2 total
!object
More work to do tomorrow. @mcrawshaw I made that change and my yarn tests were able to run successfully multiple times. We're not doing anything more than creating the GL context in our tests, but they were able to run multiple times. @thymikee given the above efforts, shall we reopen this? interesting! thanks  ```
This behavior suggests to me that the bug is somewhere in the code that diffs or stringifies the diff. However, I'm having trouble finding anything more specific to point to because I don't end up with a full stack trace, just a crashed app (after a little wait) with a little hint pointing at `pretty-format`.
@gaearon Yes, probably! Closing.
Here is a very recent article related to this issue that is interesting:
``` diff
Misses          151        151
Partials          0          0
bug
Coverage is wrong.
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
using mocha + istanbul prints:
using jest + babel-plugin-istanbul + nyc prints:
using jest (+babel-jest) prints:
Different repro cases:
jest+nyc+babel-plugin-istanbul: https://github.com/babel/babel-loader/tree/eslint-nyc `npm run test-ci`
``` diff
Misses          151        151
Partials          0          0
``` diff
Misses          151        151
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
ExperimentService.get=jest.fn(()=>{
``` diff
Misses          150        150
Partials          0          0
BUG
requireindex does not work with jest
~/dev/paypal/p2pnodeweb (pr/jest-all-the-things-2) $ ./node_modules/.bin/jest --no-cache --debug --env node my.test.js
jest version = 16.0.2
test framework = jasmine2
"rootDir": "/Users/jamuferguson/dev/paypal/p2pnodeweb",
"usesBabelJest": true,
"jsx",
Test Suites: 1 failed, 1 total
Because `require.extensions === {}` inside JEST-land.
The more you use jest with node, the more it get annoying, and your answer is definitly not a valid one for the reported issue
jest version = 16.0.2
test framework = jasmine2
"jsx",
jest version = 16.0.2
test framework = jasmine2
"jsx",
jest version = 16.0.2
test framework = jasmine2
"jsx",
jest version = 16.0.2
test framework = jasmine2
"jsx",
``` diff
Misses          150        150
Partials          0          0
And this is my jest config in `package.json` file:
"jest": {
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
aspect={undefined}
```diff
```diff
+            bsSize="small"
So Windows is ok, but Mac for some reason fails. @cpojer yes, node 6.6.0 with jest 17.0.2 `npm i babel-plugin-istanbul@next` fixed a similar issue for me.
import 'react-native';
``` diff
Misses          150        150
Partials          0          0
Is that a typo? Bit confused.
And sorry, I've should have mentioned it earlier‚ÄîI'm a big fan of Jest‚Äîit's a real pleasure to work with such wonderful and thoughtful tooling.
a Node issue.
``` diff
Misses          150        150
Partials          0          0
@cpojer The main reason I wanted it to be a breaking change is that I wanted to be able to continue using the clearAllMocks config value to automatically clear all mocks after each test. Since it looks like changing the behavior is a no-go I'd have to add a new config value resetAllMocks so that we could get this desired behavior - in addition I guess there should also be a jest.resetAllMocks function to keep the API consistent.
@cpojer whoops, typo on my part %s/module/mock/g - I meant the mock registry, not module registry i.e. in jest-mock/src/index.js
‚îî‚îÄ‚îÄ code (imported via relative paths)
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
Does not seem to work :/
``` diff
Misses          150        150
Partials          0          0
I was trying out Jest and started to write some tests around expected errors.
const expect2 = jest.fn(expect)
I'm not sure if it's just that I'm still thinking in terms of `tap[e]`, or if this really is a problem, and how you would solve it elegantly in a Jest style.
Jest.plan(2);
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
``` diff
Misses          150        150
Partials          0          0
"title": "returns initials for strings with unconventional orthography",
"title": "is a little weird for numbers",
"title": "returns enabled hero units for martsy only",
"title": "returns `true` for Strings",
"title": "returns `true` for `NaN`",
"title": "works with PNGs",
``` diff
Misses          150        150
Partials          0          0
Bug/question?
https://github.com/laggingreflex/jest-test
"rootDir": "C:\\Test\\jest-test",
"usesBabelJest": true,
"jsx",
`jest -i` didn't help, unfortunately.
@laggingreflex  thanks!
It's a bit different in my case.
@laggingreflex
> @apieceofbart can you try testEnvironment: "node" in the config? The 2s overhead is odd; I'm assuming it is because of loading jsdom.
This is the last test I need to get working to switch to jest from jasmine which unfortunately its blocking me
- Jest: 19.0.2
Running `jest` lasts about 5-10 minutes before the test completes, leaving the message:
``` diff
Misses          150        150
Partials          0          0
Test Suites: 1 failed, 1 total
Problem is fixed after I change Jest config:
``` diff
"jest": {
I think it is a **bug** in Jest. I am running NodeJs in server side, it should not require JsDOM etc.
Maybe this is just out of scope for the Jest snap shotting :(
I think so. Maybe `jest-diff` also?
``` diff
Misses          153        153
Partials          0          0
So I'm posting this issue because I do not understand the behaviour of the `.toThrowError()` method in Jest.
I'm very new to Jest so please forgive any stupid error or incorrect assumption.
Whenever the `--coverage` flag is passed, jest exits with `0` even if the threshold requirements are not met.
"name": "jest-example",
"jest": {
"jest": "^16.0.2"
``` diff
Misses          153        153
Partials          0          0
"test": "jest"
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
at new RegExp (native)
Invalid state
But I think is not a problem come from Osen.
Invalid regular expression: /\\__tests__\\.*|\.(test|spec))\.(js|jsx)$/: Unmatched ')'
t.deepEquals(api(), [], 'api without magic provides no items')
t.deepEquals(api(0), [], 'api with zero magic also provides no items')
It seems the only way to attach human-readable information to errors with `jest` is to wrap everything in an additional `it` which is unnecessarily verbose IMO.
describe('api works', () => {
Is it possible that this pattern has been adopted less because it's better or worse, but more just for consistency with the existing tests? or perhaps not knowing the feature exists? I didn't know this was in Jasmine.
Are you looking for something simpler, or different?
t.deepEquals(api(), [], 'api without magic provides no items')
t.deepEquals(api(0), [], 'api with zero magic also provides no items')
// jest
describe('api works', () => {
// jest
describe('api works', () => {
@cpojer it's unclear if the jasmine (and others) way of `expect(value).toBe(something, 'because message')` has been ruled out?
bug
"jest": {
Running `jest`, I see in red text:
jest version = 16.0.2
test framework = jasmine2
"usesBabelJest": true,
"jsx",
macOS Sierra
Jasmine v2.4.1 output ([fiddle](http://jsfiddle.net/Biphobe/gkh3gjbv/)):
Jest v16.0.2 with jasmine v.2.4.1 output:
I couldn't find a reasonable explanation for this so I assume it's a bug related somehow to Jest's modifications of Jasmine.
} from 'react-native';
import 'react-native';
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
1. include `expect(checkbox.find('.abc')).toBe(true)`
This is all I changed, I tried with ava + enzyme
Bug? Could also just be new expected behavior in Jest 16, but that's not clear.
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
"jest": {
let fn = jasmine.createSpy();
This mostly concerns mocking behavior.
jest.enableAutomock();
const add = require('add');  // !!! note - noncapitalized
At the very least, couldn't we warn in case-insensitive OS's like unix? I've seen this waste a lot of developer time as there is no easy explanation why a mock isn't being called.
different capitalizations?
> https://github.com/notifications/unsubscribe-auth/ACx-t--jx4s21h2DqSJL92lhFT5kKX8Eks5q3GTHgaJpZM4KaN24
In a general sense, I completely agree with you. The only part where I get iffy about it is in the fact that you have a special implementation of `require`. Even if node has the same issue, it more seems like a bug in every case.
This diff adds support to mocking Symbols
I added a test that ensure Symbols get mocked correctly
``` diff
Misses          153        153
Partials          0          0
import 'react-native'
<App/>
jest --no-cache
import 'react-native';
``` diff
Misses          153        153
Partials          0          0
Now, I don't understand the nature of this problem, so maybe the problem is me (I'm new to Jest). My _actual_ scenario is that I'm testing one of my own modules that happen to require 'passport-saml', which in turn requires 'node-forge', and so this error occurs.
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
"/Users/torarvid/src/jest-test"
‚óè  ‚Ä∫ should foo
Test Suites: 1 failed, 1 total
From what I can tell, when run under jest the dynamic exports aren't getting set, which makes the return value from the dynamic`require` call `undefined`, which then throws an error when looped through.
``` diff
Misses          153        153
Partials          0          0
‚îú‚îÄ‚îÄ babel-jest@9.0.3
‚îú‚îÄ‚îÄ babel-polyfill@6.16.0
‚îú‚îÄ‚îÄ babel-preset-es2015@6.16.0
‚îî‚îÄ‚îÄ jest-cli@16.0.1
> jest
‚úì tests error with promises
‚îú‚îÄ‚îÄ babel-jest@16.0.0
‚îú‚îÄ‚îÄ babel-polyfill@6.16.0
‚îú‚îÄ‚îÄ babel-preset-es2015@6.16.0
‚îú‚îÄ‚îÄ babel-preset-react@6.16.0
‚îú‚îÄ‚îÄ jest-cli@16.0.1
> jest
‚îî‚îÄ‚îÄ jest-cli@16.0.1
> jest
‚îú‚îÄ‚îÄ jest-cli@16.0.1
> jest
Test Suites: 2 passed, 2 total
‚îî‚îÄ‚îÄ jest-cli@16.0.1
> jest
‚îú‚îÄ‚îÄ babel-jest@16.0.0
‚îú‚îÄ‚îÄ babel-polyfill@6.16.0
‚îú‚îÄ‚îÄ babel-preset-es2015@6.16.0
‚îú‚îÄ‚îÄ babel-preset-react@6.16.0
‚îú‚îÄ‚îÄ jest-cli@16.0.1
> jest
‚îú‚îÄ‚îÄ babel-jest@16.0.0
‚îú‚îÄ‚îÄ babel-preset-react-native@1.9.0
‚îú‚îÄ‚îÄ jest-cli@16.0.1
‚îú‚îÄ‚îÄ jest-react-native@16.0.0
‚îú‚îÄ‚îÄ UNMET PEER DEPENDENCY react@15.3.0
> jest
‚îú‚îÄ‚îÄ babel-jest@16.0.0
‚îú‚îÄ‚îÄ babel-polyfill@6.16.0
‚îú‚îÄ‚îÄ babel-preset-es2015@6.16.0
‚îú‚îÄ‚îÄ babel-preset-react@6.16.0
‚îú‚îÄ‚îÄ jest-cli@16.0.1
‚îú‚îÄ‚îÄ UNMET PEER DEPENDENCY react@15.3.0
> jest
‚îî‚îÄ‚îÄ jest-cli@16.0.1
> jest
Test Suites: 2 passed, 2 total
‚îú‚îÄ‚îÄ jest-cli@16.0.1
> jest
bug
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
Test Suites: 1 failed, 1 passed, 2 total
If I take the input and run it directly in the live previewer on the babel site, the results are fine. This leads me to wonder if its one of the plugins that jest/babel-jest register or something to do with istanbul maybe.
const babelJest = require('babel-jest');
var result = babelJest.process(content, path);
And this is the malformed output that jest/babel-jest/babel creates:
/* istanbul ignore next */'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.UrlText = undefined;var _createClass = function () {function defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}return function (Constructor, protoProps, staticProps) {if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;};}();exports.
} /* istanbul ignore next */exports.default =
/* istanbul ignore next */(0, _reactRedux.connect)(mapStateToProps)(UrlText);
You can see that for some reason, babel is placing a number of line breaks just after the `exports.` which is causing the following exception:
SyntaxError: Unexpected token .
jest version = 16.0.1
test framework = jasmine2
"jsx"
"cacheDirectory": "/var/folders/jh/_qfb31ks75s36xc8_llzs4t40000gn/T/jest",
@avanderhoorn can you test against `jest-cli@15 babel-jest@15` and see if you have the same issue?
["external-helpers"]
``` diff
Misses          153        153
Partials          0          0
``` diff
- Misses          153        154     +1
Partials          0          0
ü§òüòé
> jest
host: '--TESTHOST--',
at errnoException (dns.js:28:10)
I have this issue with all ^9.0.0 versions of babel-jest ( '9.0.1', '9.0.2', '9.0.3'). '10.0.1' works and so does 16 and 17.
edit: tested here on a Windows 10 machine, babel-jest ^9.0.0 not working, 16 and 17 works fine.
@frevib
bug
doesn't work with `proxyquire`
Thanks @cpojer. That's too bad. I was hoping to use jest as a drop in replacement for mocha because of its superior watching abilities and for snapshotting.
For Jest, in addition to the update snapshot parameter it would be great to have a `--resolve` or `--merge` switch which would write out a `.received.snap` file next to the actual then launch a difftool in merge mode, the user can easily merge the received.snap file into the .snap file. Shouldly and ApprovalTests just have a collection of supported difftools and will simply use the first one it finds.
That patch form is awesome!
Addresses #1928. The test time was being printed in red, which is potentially confusing because it could be seen as an error or a problem.
``` diff
Misses          153        153
Partials          0          0
SyntaxError: Unexpected token :
use this jest configuration
`jest version = 16.0.1
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"jsx",
SyntaxError: Unexpected token :
Test Suites: 1 failed, 1 total
Did you have setting jest config on package.json ?
"presets": ["react-native"]
1. `jasmine.addMatchers` calls `expect.extend`
2. `jasmine.addMatchers` properly gets the API coerced into `expect.extend`
`npm run build && npm run jest jasmine-uses-jest`
This appears to be a bug
Suspect this is a feature request
It would be great to have more sophisticated logging in Jest, for example:
jest.log.info("Info message");
jest version = 16.0.1
test framework = jasmine2
"scriptPreprocessor": "C:\\Users\\alfie\\gb\\misc\\gb-ui\\node_modules\\babel-jest",
"testEnvironment": "C:\\Users\\alfie\\gb\\misc\\gb-ui\\node_modules\\jest-environment-node\\build\\index.js",
"rootDir": "C:\\Users\\alfie\\gb\\misc\\gb-ui",
"name": "C:-Users-alfie-gb-misc-gb-ui",
"testRunner": "C:\\Users\\alfie\\gb\\misc\\gb-ui\\node_modules\\jest-jasmine2\\build\\index.js",
"cacheDirectory": "C:\\Users\\alfie\\AppData\\Local\\Temp\\jest",
"jsx",
"C:\\Users\\alfie\\gb\\misc\\gb-ui"
Hello Team Jest,
Thanks for working so hard on this wonderful test runner. I just recently gave jest another spin after trying it when it first came out, and I love all the progress you all have made.
One thing I am missing from mocha/sinon is nicer mocks for functions that return promises.
I specifically used to use http://npmrepo.com/sinon-as-promised for easy promise mocking.
I'll give it a shot, any advice on where to look? Talked about this a bit with @gaearon already üòÑ
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"cacheDirectory": "/var/folders/rl/98bml8qx57n3b6xgsgyvbxtr0000gn/T/jest",
"jsx",
jest.mock('left-pad');
jest.unmock('left-pad');
``` diff
Misses          153        153
Partials          0          0
I am using istanbul to get the converage information.
.pipe(istanbul({
.pipe(istanbul.hookRequire());
expect("OK").toEqual("BLABLA"); // This line raise the exception (See output)
"BLABLA"
Plus jest doing some bad magic with replacing `global.Promise` object in node.
2. `expect("OK").toEqual("BLABLA")` executed
``` diff
Misses          153        153
Partials          0          0
It should blame me about `Duplicate` Mocks.
``` diff
Misses          153        153
Partials          0          0
bug
tracking cookies
Test Suites: 1 failed, 1 total
tracking cookies
Test Suites: 1 failed, 1 total
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
``` diff
Misses          153        153
Partials          0          0
cc @cpojer
@keyanzhang thanks for clarification.
``` diff
- Misses          150        151     +1
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
In the example for `toBeLessThan(number)` the text says 20 ounces but the code says 10 ounces.
``` diff
Misses          153        153
Partials          0          0
`jest pattern-to-match`
Bug
npm install jest babel-jest jest-react-native
"jest": {
jest version = 16.0.1
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"/Users/chirag/Desktop/qsi/comlink/node_modules/babel-polyfill/lib/index.js",
"/Users/chirag/Desktop/qsi/comlink/node_modules/jest-react-native/build/setup.js"
"testEnvironment": "/Users/chirag/Desktop/qsi/comlink/node_modules/jest-environment-node/build/index.js",
"rootDir": "/Users/chirag/Desktop/qsi/comlink",
"name": "-Users-chirag-Desktop-qsi-comlink",
"testRunner": "/Users/chirag/Desktop/qsi/comlink/node_modules/jest-jasmine2/build/index.js",
"scriptPreprocessor": "/Users/chirag/Desktop/qsi/comlink/node_modules/babel-jest/build/index.js",
"usesBabelJest": true,
"jsx",
"/Users/chirag/Desktop/qsi/comlink"
jest
"test": "jest"
"jest": {
"babel-jest": "16.0.0",
"jest": "16.0.2",
"jest-react-native": "16.0.0",
jest": "^16.0.2",
"jest-react-native": "^16.0.0",
@cpojer
"babel-jest": "16.0.0",
"jest": "16.0.2",
"jest-react-native": "16.1.0",
@tigerohuang just change the version to `test` like so:
`"jest-react-native": "test",`
"jest-react-native": "test",
@tigerohuang I did an npm uninstall on both (npm uninstall --save jest-react-native & npm uninstall --save jest) then npm install --save again without the @test
I'm still having problems (with jest util) but am raising a new issue to this regard
> jest
"test": "jest"
"jest": {
"babel-jest": "^16.0.0",
"jest-react-native": "test",
~/projects/snowflakework/snowflake-pr184 (siemiatj-master)$ npm test
1:34     error  Infix operators must be spaced                                 space-infix-ops
155:6   error  Extra semicolon                                                semi
156:5   error  Extra semicolon                                                semi
158:44  error  Extra semicolon                                                semi
npm ERR! Darwin 15.5.0
npm ERR!
npm ERR! If you do, this is most likely a problem with the snowflake package,
npm ERR!     npm bugs snowflake
~/projects/snowflakework/snowflake-pr184 (siemiatj-master)$ npm --version
~/projects/snowflakework/snowflake-pr184 (siemiatj-master)$
"jest": {
"apsl-react-native-button": "3.0.2",
"react-native-i18n": "1.0.0",
"tcomb-form-native": "0.6.5",
"undefined": "0.1.0",
"babel-jest": "16.0.0",
"istanbul": "0.4.5",
"jest": "16.0.1",
"jest-react-native": "16.1.0",
This is another approach of #1947
BUG
Right now when I execute the jest command and it never give me 100% of coverage.
`npm -g i jest-cli`
Could this to be done in karma or another tool?
``` diff
Misses          153        153
Partials          0          0
bug
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
or is this a feature of jest? i see that, sometimes, when i run tests after an `npm install`, it runs in series. i'd prefer to turn off this behavior
@cpojer
AVA `time`:
Jest `time`:
As soon as I fix all Jest issues that prevent me from using (e.g. #2114), I will send PR.
Jest heuristic logic is ok for me and I like it.
Ugh :( Because `concurrent` implemented currently in a hacky way, timings for concurrent tests are not correct ‚Äî several ms because concurrent test just returns already executed promise. Yeah, Jest is not suitable currently if your tests perform a lot of IO.
Following notes seems a bit controversial/confusing to me:
"testCases": [
WRT error messages, the current message is for the whole suite, and so it would be hard to pull out specific metrics for an individual test, so Iv'e adde dit into the JSON example.
``` log
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
Bug
Test Suites: 23 failed, 56 passed, 79 total
It looks like it is coming from the new flow syntax:
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"cacheDirectory": "/var/folders/y0/8wln1fl90sggrb91q4x_kr140000gn/T/jest",
"jsx",
Hi all, I've encountered the following error when running jest with Typescript. Running jest with --no-cache flag results in the same error. I'm running jest with global jest-cli.
Output running Jest --debug:
jest version = 16.0.1
test framework = jasmine2
"/Users/pavloko/Projects/experiments/helloReact/config/polyfills.js"
"/Users/pavloko/Projects/experiments/helloReact/config/jest/FileStub.js"
"/Users/pavloko/Projects/experiments/helloReact/config/jest/CSSStub.js"
"/Users/pavloko/Projects/experiments/helloReact/(build|.storybook|node_modules)/"
"testEnvironment": "/Users/pavloko/Projects/experiments/helloReact/node_modules/jest-environment-node/build/index.js",
"name": "-Users-pavloko-Projects-experiments-helloReact",
"testRunner": "/Users/pavloko/Projects/experiments/helloReact/node_modules/jest-cli/node_modules/jest-jasmine2/build/index.js",
"/Users/pavloko/Projects/experiments/helloReact"
Update. I downgraded Jest to 15.1.1 and everything works, so the problem happens on 16.1.1 only. I hope this helps. Thanks again.
``` diff
- Misses          145        158    +13
Partials          0          0
@thymikee, what really confuses me is that his repo requires babel-polyfill as a dev dependency, but he doesn't actually load it anywhere in the project. How/why would this make it worse? @cpojer, but he's not using babel-jest, just jest. FWIW I repeated the run of Quentin `jest-test` repo with Node 7.2.1 and Jest 17.0.3.
With babel: 44MB + 1.00MB * specs run
1. I would change the title of this ticket back to babel-polyfill, since it seems to be far bigger memory issue than JSDOM.
1. A huge leakage happens when using babel-polyfill.
Babel-polyfill makes the whole thing even worse, since (1) its memory leak makes the memory usage grow even faster from test-to-test and (2) the windows are not destroyed, even after the tests complete.
In the jest project, following could be done to make the life easier:
Removing `babel-polyfill` addressed the issue for us. FWIW, it seems the issue only presents itself when running async, as the `--runInBand` flag completely avoids it. Is that helpful at all? @mute I did an `npm uninstall babel-polyfill` right before our `npm test` command and it did get us a little bit farther (22 tests instead of 8) before crashing, but it still crashes very early on in the batch of tests we have to run (about 300). All good @cpojer. I'm just glad it's fixed! @cpojer when do you expect the release with #2755 to be on NPM? If it's more than a week, would you be open to cutting a prerelease? This memory leak is costing us hours of CI time with all the garbage collection it triggers. @turadg if it takes a while, you can always do what we're doing (for now) so you don't waste any more time. Look at our `npm run test:ci` command below:
"test:ci": "suites=\"fooFolder barFolder bazFolder\"; STATUS=0; for i in $suites; do npm test -- \"${i}/*\" --runInBand; STATUS=$(( $? > $STATUS ? $? : $STATUS )); done; exit $STATUS"
The first 2 lines below are breaking the alphabetical order, causing confusion when browsing the page.
Bug
foo.test.js
And jest's output:
$ jest
$ jest
Error
Test Suites: 1 failed, 1 total
jest version = 16.0.1
test framework = jasmine2
"name": "-private-tmp-foo",
"usesBabelJest": true,
"jsx",
"/private/tmp/foo"
Error
Test Suites: 1 failed, 1 total
All files |  Unknown |  Unknown |  Unknown |  Unknown |                |
(note, this still occurs when using jest installed globally and ran globally)
I tracked down the source of the issue to babel-plugin-istanbul but I do not believe the bug is on their side (maybe it is) as it was working previously.
Issue is here:
babel-plugin-istanbul/index.js
C:\Users\[NAME]\Documents\nodejs\projects\wichita\frameworks\base\sdk\tv\events\events.js
C:\Users\[NAME]\Documents\nodejs\projects\wichita\node_modules\.bin
C:\Users\[NAME]\Documents\nodejs\projects\wichita\frameworks\base\sdk\core\logger.js
C:\Users\[NAME]\Documents\nodejs\projects\wichita\node_modules\.bin
C:\Users\[NAME]\Documents\nodejs\projects\wichita\frameworks\base\sdk\core\env.js
C:\Users\[NAME]\Documents\nodejs\projects\wichita\node_modules\.bin
"jest": {
@montogeek
"jest": {
"jest": {
Bug
"jest": {
> jest
SyntaxError: Unexpected token .
Test Suites: 1 failed, 1 total
jest version = 16.0.1
test framework = jasmine2
"\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$",
"usesBabelJest": true,
"jsx",
butler% uname -a
basedir: dirname,
extensions,
http://theoatmeal.com/comics/apostrophe
"coverage": "jest --verbose --coverage --noStackTrace --no-cache",
1 verbose cli [ '/usr/local/bin/node', '/usr/local/bin/npm', 'run', 'coverage' ]
4 verbose run-script [ 'precoverage', 'coverage', 'postcoverage' ]
14 verbose stack Exit status 1
15 verbose pkgid travel@1.0.0
16 verbose cwd /Users/SVITY/www/travel
17 error Darwin 16.0.0
21 error code ELIFECYCLE
23 error If you do, this is most likely a problem with the travel package,
> > jest
react-native: 0.34.1
# uname -a
jest version = 16.0.1
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"usesBabelJest": true,
"jsx",
Test Suites: 1 failed, 1 total
bug
react version -> 15.3.2
jest --debug
jest version = 16.0.1
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"usesBabelJest": true,
"jsx",
Test Suites: 1 failed, 1 total
Reverts facebook/jest#1882
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
If you run `jest` twice (ie. once to create the snapshot, once to match against it), the test will fail.
So my tests run great when I invoke them manually, but when I do jest --watch after five times (always 5 times), of reloading they start timing out. In mocha I wasn't having any issues reloading the tests indefinitely.
import mongoose from 'mongoose';
mockgoose(mongoose).then(() => {
mongoose.disconnect();
mockgoose.reset(done);
I'm still a Flow newbie so I appreciate any feedback here.
- Any improvements to the Flow types would be appreciated.
Bug
/* istanbul ignore next */_react2.def
I don't expect this strange type of failure. Because it's only happened once so far, I have nothing useful for reproduction unfortunately. I presume there's a strange race condition with the transform and test execution, but I'm not sure what.
SyntaxError: Unexpected token }
I have the following babel transform:
var babel = require('babel-jest').createTransformer({
babelrc: false,
'modules': 'commonjs'
'stage-1'
module.exports = babel;
And it is added to exceptions:
jest version = 16.0.1
test framework = jasmine2
"usesBabelJest": true,
"jsx",
@cpojer doing something
working example with mocha
import { expect } from 'chai';
1) foo should raise error from a rejected promise:
in jest **does not work**
foo
Test Suites: 1 failed, 1 total
foo
return somethingEpic(action$, store)
"jest": {
"testRunner": "jasmine1"
Should use the jasmine1 runner as specified.
> No coverage report found for **master** at fecbaca.
Thank you for @pastuxso
@yutin1987 thanks to you!!
@cpojer ping
They work beautifully together and for each input I do get a correponding snapshot:
When I run `jest -w 3`  I'm seeing different numbers in the report:
jest version = 16.0.1
test framework = jasmine2
"jsx",
Oh, FYI, our ‚Äúworkaround‚Äù for this until then is to pipe output into `cat` üêà
Aborted
Jest should not crash trying to infinitely word-wrap.
I think these kinds of explorations are really important as conversation-starters within the community and I'm excited to see where this goes! :smiley:
@suchipi you can use tools like [BackstopJS](https://github.com/garris/BackstopJS) for that if you can provide URL for your components.
Jest website / Github page with API docs
Just a small typo.
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
Bug.
MacOS
jest version = 15.1.1
test framework = jasmine2
"testRegex": "/__tests__/[^.]+-test.(t|j)s$",
"usesBabelJest": true,
jest version = 16.0.0
test framework = jasmine2
"name": "-Users-ianp-Projects-0e44151b16718ebc83bb25efb68a9395",
"usesBabelJest": true,
"jsx",
All files |  Unknown |  Unknown |  Unknown |  Unknown |                |
Statements   : Unknown% ( 0/0 )
Branches     : Unknown% ( 0/0 )
Lines        : Unknown% ( 0/0 )
jest version = 16.0.0
test framework = jasmine2
"rootDir": "MYPATH",
"usesBabelJest": true,
"jsx",
@cpojer I got the titles from your community update :). Let me know if the PR is fine, I was not sure where to place it. Maybe is preferable a section at the top/end for external links.
@cpojer you are welcome! However, if you check the end of the second part, you'll see that that is basically it, I wasn't thinking of Part 3. On the other hand, I hope to keep writing about this subject in the future :)
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
```diff
- Misses          161        162     +1
Partials          0          0
@cpojer I have performed the rebase:)
``` diff
Misses          153        153
Partials          0          0
Bug (I guess).
Althought they are not bound to the `it()` or `describe()` blocks, producing an exception.
https://github.com/pascalduez/jest-only
jest version = 15.1.1
test framework = jasmine2
"[...]/jest-only/src"
"rootDir": "[...]/jest-only",
"usesBabelJest": true,
here is my config of jest
"jest": {
"defaultPlatform": "ios",
"ios",
"react-native"
"jsx"
"babel-jest": "^15.0.0",
"jest": "^15.1.1",
"jest-react-native": "^15.0.0",
.babelrc
"alias": {
@cpojer 0.34.0
"test": "jest"
"jest": {
"babel-jest": "^15.0.0",
"babelify": "^7.3.0",
"chai": "^3.5.0",
"gsap": "^1.19.0",
"gulp-uglify": "^2.0.0",
"gulp-watchify": "^0.6.0",
"jasmine": "^2.4.1",
"jasmine-jquery": "^2.1.1",
"karma-jasmine": "^1.0.2",
"karma-jasmine-html-reporter": "^0.2.0",
"karma-jasmine-jquery": "^0.1.1",
"karma-nyan-reporter": "^0.2.4",
"karma-safari-launcher": "^1.0.0",
"mocha": "^3.0.2",
"react-native-accordion": "^1.0.1",
"react-native-mock": "^0.2.6",
"sinon": "^1.17.6",
"jest": "16.0.1",
"jest-react-native": "^15.0.0",
Is there anything else which might cause this?
"transform": {".*": "undefined"}
"babel-jest": "^17.0.2",
"jest": "^17.0.3",
"jest-react-native": "^17.0.3"
"babel-jest": "~17.0.2",
"jest": "~17.0.3",
"jest-react-native": "~17.0.3",
at Error (native)`
"babel-jest": "^17.0.2",
"jest": "^17.0.3",
"jest-react-native": "^17.0.3",
"jest": {
import 'react-native';
jest.unmock('Image');
However, I'm bumping into the Invariant Violation as well, mostly due to the react-native-experimental-navigation it seems (I'm using react-native-router-flux):
Invariant Violation: Native module cannot be null.
When trying to mock:
I succeed when I used 'react-native 0.37' and 'jest 17.0.3'
"babel-jest": "^17.0.2",
"jest": "17.0.3",
"jest-react-native": "17.0.3",
and jest preset is 'jest-react-native'
--> 'react-native'
> versions of jest:
> However, I'm bumping into the Invariant Violation as well, mostly due to
> the react-native-experimental-navigation it seems (I'm using
> When trying to mock:
@cpojer please have a look :)
``` diff
Misses          153        153
Partials          0          0
But if not, then I'd like to give it a go.
@kaushlakers I started working on it. I needed it for something in `jest-enzyme`
Is there a plan to fix this inconsistency issue?
Thank you @cpojer :)
jest
A few open questions:
jest version = 15.1.1
test framework = jasmine2
node and os:
jest:
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
![jest](https://cloud.githubusercontent.com/assets/298/20290803/496491f0-aab0-11e6-8c44-a29f1bd84a2d.gif)
this project. But I'll try to look into it regardless, Jest seems like a
@ambethia
pretty rare.                         [boolean]
jest
``` diff
Misses          153        153
Partials          0          0
Bug
First, I'm not sure if this is a problem with Jest or with Enzyme, but I first noticed this when migrating another project from Mocha to Jest.
<Foo>
Foo
Foo
- Jest version: `15.1.1`
I'm running into a really strange bug. When I install jest globally or as a dev-dependency I get the following repeated error message:
I've tried installing the most recent jest release (15.1.1) and the same memory leak error message shows when I tried installing previous versions 15.1.0, 15.0.0, and 14.1.0.
![jest_install_issue](https://cloud.githubusercontent.com/assets/13619585/18935945/59cbe77e-8598-11e6-88b0-c9166721baba.png)
![jest_example](https://cloud.githubusercontent.com/assets/13619585/18935999/c8f78c2a-8598-11e6-8e50-21fdde965752.png)
Interestingly, I'm seeing this error a lot when running my Jest tests and I'm seeing this with yarn and versions of npm :-(
``` diff
Misses          153        153
Partials          0          0
``` diff
Misses          153        153
Partials          0          0
This seems to me like bug. I can't recongnize such quickly whether it is in Jest or not.
babelJest.process("const a = 1;", "name.ts") == "const a = 1;"
(I need to run babel-jest on typescript's es6 output)
``` diff
Misses          153        153
Partials          0          0
"react-native"
This is my jest config from `package.json`
"jest": {
Is there something special I need to add to make Jest us my `.babelrc`?
``` @preetb123 looks like your route param isn't getting initialized correctly, you probably just need to pass it into your component in the test.  <!-- *Before creating an issue please make sure you are using the latest version of Jest, try re-installing your node_modules folder and run Jest once with `--no-cache` to see if that fixes the problem you are experiencing.* -->
https://github.com/twhid/jest-test
can vary depending on the system, and there is no way for users to know
which mock was being used or that there are duplicates cluttering up
But have no fear ~ Now Jest will warn for the duplicate files, so that
caused the warning to appear over and over, and it was too noisy.
This feels a bit hacky; suggestions are welcome for how to do this
``` diff
Misses          153        153
Partials          0          0
This happens when dirExpr isn't a valid query and it causes watchman to crash
``` diff
Misses          153        153
Partials          0          0
Would appreciate any guidance. Recently came back to Jest after almost 2 years, and it's gotten tons better since then :)
**bug**
I added a "jest" field in package.json
"jest": {
"jest": {
> Which version of Jest are you using?
> https://github.com/notifications/unsubscribe-auth/ABGFrstN173x55IAmVEiNgKT0nckVlAPks5quO8jgaJpZM4KHe-_
"jest": {
"jest": {
``` diff
Misses          152        152
Partials          0          0
Note jest uses jasmine and the jasmine docs say this: https://jasmine.github.io/2.5/introduction.html#section-58
``` diff
Misses          152        152
Partials          0          0
``` diff
Misses          152        152
Partials          0          0
This would be a breaking change though.
``` diff
Misses          152        152
Partials          0          0
``` diff
Misses          152        152
Partials          0          0
``` diff
Misses          152        152
Partials          0          0
b: 'SomeString'}
contains sub-object
In jasmine this is possible using the `jasmine.objectContaining()` function.
var joc = jasmine.objectContaining;
b: 'SomeString'
var joc = jasmine.objectContaining;
``` diff
Misses          152        152
Partials          0          0
Facing an error on PR builder to execute unit tests . Any clue would be appreciated. Same works fine for npm 3.9.6 but not for npm 3.8.6
- RHEL 6.x
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
@kyldvs what is "messed up"? escaping single quotes in backtick quoted strings? I'll ask people to check, there may be someone running `jest watch` w/ an old globally installed jest
Compare this to a mock being invoked with other values than expected:
``` diff
Partials          0          0
``` diff
Misses          152        152
Partials          0          0
Bug
[My snapshots](https://github.com/kentcdodds/react-jest-workshop/blob/help/weird-stuff/exercises-final/containers/__snapshots__/CustomerList.test.js.snap#L23-L71) have code and istanbul annotations in them... I can't explain it. I've dug for a few hours... Not sure what's going on. I'm using enzyme + [enzyme-to-json](https://github.com/trayio/enzyme-to-json) by @trayio and it's just the weirdest thing...
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
Sounds like it is a problem with `enzyme-to-json` somehow then... cc @trayio
@adriantoine can you ensure you'll try with latest version of Jest?
@kentaromiura yep, [I have updated my tests to the latest Jest this morning](https://github.com/trayio/enzyme-to-json/pull/15).
https://github.com/pedrottimark/jest-1780
When trying to install jest, npm will give following warning:
I've upgrade istanbul-api to latest release, minimatch have been upgrade to 3.0.2 and the problem is fixed.
``` diff
Misses          152        152
Partials          0          0
__mocks__
In [this PR](https://github.com/facebook/react/pull/7707#discussion_r79895628), I can't use `expect(a).toBe(b);` on two complex and cyclic objects. It works fine if the test pass but if the test fails I think it tries to print/report the object structure or something. Interestingly enough it works fine on some of the other similar objects.
``` diff
@yaycmyk, thanks for putting in the effort for HTML element printing. I'm sure your hours of work won't go to waste.
```javascript
As described in #1769, when running jest in watch mode, if the option bail is set to true and a test fails, then the process will exit while it should not.
``` diff
Misses          151        151
Partials          0          0
Bug.
import Realm from 'realm'
import 'react-native'
The error is:
I'm not entirely sure if that's `Jest` problem (or not `Babel` or `Realm-js`), so excuse me if it's not.
@cpojer that's not the solution.
"jest": {
"jest": {
Whenever I want to run Jest in `--watch` mode it crashes:
However for me, it was still an upgrade of watchman that fixed it.
+1 to documenting it in Jest as a recommended install.
@gaearon I only got it to work by _installing_ Watchman. Without Watchman, no luck.
### Error
jest v16.0.2
@stefaneg the problem is related to the maximum number of open files. yarn install probably results in more files therefore you run into the maximum number of files limit whereas npm install probably just stays under this limit.
mocOS: 10.12.1
Jest: 10.0.1
Bonus FWIW: Jest is awesome. So glad I gave it a second chance :)
To add more entertainment value to this. I was running into the error, inside of tmux. Tried the suggestion of running outside, and it worked, went back inside of tmux and it worked.
Jest: 17.0.2
jest: 17.0.3
- jest: 16.0.2
@gaearon `sane` is using [anymatch](https://github.com/es128/anymatch) to decide what to ignore, which accepts regex. Therefore CRA can update its jest ignore with something that will only match `node_modules` at the root level. I can in fact confirm as others have that `brew install watchman` works. Dang tho it'd be cool not to have to now add that step to my project's README. :-D. If there's anything I can do to help test or anything, let me know! I have submitted PR #2957 that should fix this issue without installing watchman.
`git clone https://github.com/ro-savage/jest.git`
`yarn link "jest-cli"`
Œª jakku pokedex-client ‚Üí Œª git master* ‚Üí rm -rf node_modules
Œª jakku pokedex-client ‚Üí Œª git master* ‚Üí yarn install
[2/4] üöö  Fetching packages...
Œª jakku pokedex-client ‚Üí Œª git master* ‚Üí yarn link "jest-cli"
success Registered "jest-cli".
Œª jakku pokedex-client ‚Üí Œª git master* ‚Üí yarn test
"jest": {
I am not sure exactly what the jest config options should look like. Am I on the right track? @mulchy - Thanks for taking the time to test it!
Œª jakku jest ‚Üí Œª git fix-watcher-bug-osx ‚Üí git branch
Œª jakku jest ‚Üí Œª git fix-watcher-bug-osx ‚Üí git log --oneline | head -1
Œª jakku jest ‚Üí Œª git fix-watcher-bug-osx ‚Üí yarn run build
babel-jest.....................................................................[  OK  ]
Œª jakku jest ‚Üí Œª git fix-watcher-bug-osx ‚Üí cd packages/jest-cli
Œª jakku jest-cli ‚Üí Œª git fix-watcher-bug-osx ‚Üí yarn link
Œª jakku jest-cli ‚Üí Œª git fix-watcher-bug-osx ‚Üí
jest: v20.0.3
Pinging @pugnascotia @cpojer - should the regex/glob from `testMatch` be passed to the watcher?
@ro-savage I got it to work with watchman, uninstalled it, added
if (typeof  elem === 'string') {
return elem
<function MyAnotherComponent() {/* istanbul ignore next */++cov_1uc0dbip6i.f[12];++cov_1uc0dbip6i.s[53];
Since istanbul add comments to a function -> new snapshot doesn't match the original one. And test fails.
``` diff
Misses          151        151
Partials          0          0
``` diff
Misses          151        151
Partials          0          0
``` diff
Misses          151        151
Partials          0          0
macOS Sierra
Jest 15.1.1
``` diff
Misses          151        151
Partials          0          0
Whenever a switch statement is imported through jest, I get the following error:
case /* istanbul ignore next */(++_cover__().s['5'], 'SORT_POLL_BY'): /* istanbul ignore next */++_cover__().b['1'][0]++_cover__().s['9'];
"jest": {
"es2015"
return babel.transform(
).code;
auxiliaryCommentBefore: " istanbul ignore next ",
@cpojer, here you have it https://github.com/Gpx/broken-jest
There are two branches `master` which is broken and `fix-jest` that runs.
On the Babel repo I haven't found any related issue.
Yeah, it's through the `fs` functions üòê
<ReactSelect
name="ori"
jest version = 15.1.1
`Cube` is a component like
``` diff
- Misses          148        151     +3
Partials          0          0
jest.addCustomEqualityTester(function(first, second) {
I will say that .toEqual has much prettier output in Jest than in Jasmine. Props!
I see your point, that if you allowed .toEqual to be extended by adding an equality tester, that .toEqual‚Äôs error messages would make less sense. I‚Äôm realizing that Jest has gotten away from Jasmine in a lot of ways (probably via improvements in most cases). It was perhaps naive of us to come in thinking we could make the transition with an existing codebase as smoothly as we‚Äôd hoped. The codemod you describe would be really helpful.
> @mandysimon88 https://github.com/mandysimon88 is that a third-party library that provides .equals method on its classes or a custom code?
``` diff
- Misses          145        151     +6
Partials          0          0
I also noticed that jasmine have spyOn which seems to work in jest as well (but not documented), which is pretty elegant, so same thing can be achieved by:
And jasmine claim to remove the spy after the test automatically, which is awesome.
'jsx',
There is a typo in variable name and invalid test description in one of the TypeScript examples.
``` diff
Misses          145        145
Partials          0          0
Hello! Thanks for your amazing work with the new version of Jest.
"jest": {
jest.deepUnmock('../src/sum-1');
jest.deepUnmock('../src/sum-1');
> @alansouzati that happened to me a few times and using -i helped.
"jest": {
var MyCustomClass = require('my-package');
// custom implementation
var foo = new MyCustomClass();
+1 @guigrpa
It fixes a tiny typo in Jest documentation.
``` diff
Misses          115        115
Partials          0          0
is there anyway to mock socket with jest?
I not sure how to do that with jest
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
A demo of jest working with chai is here: https://github.com/0xR/snapshot-experiments/pull/1.
Document how to use jest with chai.
``` diff
Misses          115        115
Partials          0          0
const combinedMatchers = Object.assign(chaiMatchers, originalMatchers);
const not = Object.assign(jasmineMatchers.not, jestMatchers.not);
return Object.assign(jasmineMatchers, jestMatchers, { not });
I did try overriding the buildin `not` property of chai to skip setting the not flag the first time it is access and only set it if its accessed the second time, which is in the test itself. But this is causing issues with jasmine matchers like `not.toBe`.
I do know that having support for chai would make is much easier for projects with existing codebases to move over to jest.
Interesting fact is that the `setupTestFrameWork` script will actually run before `extendJasmineExpect`. Therefore deleting `global.expect` won't work.
const not = Object.assign(jasmineMatchers.not, jestMatchers.not);
return Object.assign(jasmineMatchers, jestMatchers, {not});
return jasmineMatchers; // Edit: fix bug here
Note that when I skip `extendJasmineExpect` this won't happen anymore:
// `jest-matchers` should be required inside test environment (vm).
(I found this in `jest-jasmine2/src/index.js`)
Shouldn't that return `jasmineMatchers`?
const expectation = jasmineExpect(actual, ...args);
if (expectation instanceof global.jasmine.Expectation) {
const jasmineMatchers = expectation;
const not = Object.assign(jasmineMatchers.not, jestMatchers.not);
return Object.assign(jasmineMatchers, jestMatchers, {not});
If `extendJasmineExpect` only runs in the vm once, then it'd be more performant to do the `instanceof` check once outside of the function body (instead of every expect call):
if (expectation instanceof global.jasmine.Expectation) {
const not = Object.assign(jasmineMatchers.not, jestMatchers.not);
return Object.assign(jasmineMatchers, jestMatchers, { not });
Currently I'm trying to get my experimental project to install `jest-jasmine2` from a github tarball which is proving more difficult than it should.
What's the final code to use to have chai assertions to work in jest?
I'm getting this error when using the following code:
const chai = require('chai');
const combinedMatchers = Object.assign(chaiMatchers, originalMatchers);
https://medium.com/@RubenOostinga/combining-chai-and-jest-matchers-d12d1ffd0303
What's the final code to use to have chai assertions to work in jest?
I'm getting this error when using the following code:
const combinedMatchers = Object.assign(chaiMatchers, originalMatchers);
And actually, even when I only use the chaiMatchers, chai-enzyme doens't
Any hints on how to make it work with chai and chai-enzyme? It would make
https://github.com/notifications/unsubscribe-auth/AGH2MG4MrqeU02sHK_lasg2z28Hise-Hks5q7NwYgaJpZM4J_j0h
``` diff
Misses          115        115
Partials          0          0
@cpojer I wonder if something like this would suffice?
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
cc: @cpojer
``` diff
Misses          115        115
Partials          0          0
``` diff
- Misses          115        118     +3
Partials          0          0
const absolutePathToNonExistantFile = path.resolve("./ugly_chai_jest_snapshot_workaround_nonexistant_file_please_I_hope_so.js");
This would require some changes in jest, naturally.
color: 'black',
import 'react-native';
"test": "jest"
"jest": {
"lodash": "^4.15.0",
"babel-jest": "^15.0.0",
"jest": "^15.1.1",
"jest-cli": "^15.1.1",
"jest-react-native": "^15.0.0",
"presets": ["react-native"]
``` sh-session
$ cd thesis-phoenix
> jest
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by AttributionText)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
"cacheDirectory": "/var/folders/ph/nmszn_9n21702lcjqpp9z79w0000gn/T/jest",
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
in div (created by AttributionText)
in div (created by ThesisEditor)
in div (created by ThesisEditor)
Ah, thank you @cpojer. I think I added that line due to some earlier issues I had.
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
This is an attempt to solving #1599.
``` diff
Misses          153        153
Partials          0          0
Yeah, passing the message through `argv` was kind of a hack, because this is a new environment for me and I wasn't sure how to pass the variable other way.
@cpojer sure, give me a sec ;)
import 'react-native';
jest: 15.1.1
Hey Jest team,
`testRegex` seems to be correctly formatted, and I definitely do have a `.coffee` test file inside `__tests__`, but it doesn't read it.
``` diff
- Misses          115        117     +2
Partials          0          0
Cons:
* more expressive, atomic tests
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
NA
``` diff
Misses          115        115
Partials          0          0
will fail and don't catch error properly (I am using latest version of jest)
``` diff
Misses          115        115
Partials          0          0
"jest": {
@cpojer That would be definitely better!
@thangngoc89 how did you solve this?
~~@cpojer maybe the `bug` label should be removed?~~
@cpojer @reflog
I saw [this tweet](https://twitter.com/khoanguyenme/status/775765122056716288) and was excited to respond that the stack traces also show you the correct line number and even highlight the lines from your tests which I think is awesome.
I'm using the latest jest/babel-jest.
``` diff
Misses          115        115
Partials          0          0
There is a subtle but significant difference between these two assertions:
``` diff
Misses          115        115
Partials          0          0
I'm not married to this, if somebody has a better way of testing these that works with Jest as-is I'm happy to merge that üòä
Just ran into this converting a bunch of tests that use generators from mocha to jest. Generator tests are mainly backend, for example:
password: 'foo'
``` diff
Misses          115        115
Partials          0          0
Bug
aria-label="Title"
id={undefined}
It would be great if Jest would be more agnostic to this, right? I may be missing something here.
I agree, Jeff. I don't like the chai style either. We're moving to the
Jasmine style. So .not.toEqual instead of .not.to.equal.
> @mjackson https://github.com/mjackson FWIW after using both the chai
> way, but I prefer less dots. Here is an even worse example from chai
> https://github.com/notifications/unsubscribe-auth/AAFqp4Xzrs2nOqdO0hFBdFlj2rsMSOo-ks5q-oTOgaJpZM4J63Xy
expect(someModule.someFunction).toHaveBeenCalledWith(arg1, arg2, jasmine.any(Function));
// teardown
import expect from 'jest-matchers'
@cpojer also, any idea why is `stdout` not being displayed when used with `lint-staged`? Am I missing something here?
https://github.com/joeapearson/jest-jsonschema
``` diff
Misses          115        115
Partials          0          0
MOCK_CONSTRUCTOR_NAME,
'return ' + MOCK_CONSTRUCTOR_NAME + '.apply(this,arguments);' +
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
"check-coverage": "istanbul check-coverage --statements 100",
But it requires extra `istanbul` dependency.
/cc @okonet
@ai thanks for initiating it! I appreciate it.
@cpojer hey! We met at ReactVienna once :)
function testApi (api) {
let api
testApi(api)
This is most definitely a niche use case, but I‚Äôd like to hear if there is a solution and/or interest to support this use case.
Yeah, probably the direction I‚Äôll go. Although I have been witnessing a Twitter firestorm recently on top level `await`s lol, maybe one day that can be a solution üôÉ
(lot‚Äôs of sarcasm, please don‚Äôt take seriously)
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
I'm sure some peope love underscores, but to others a dir named `__test__` is an absolute atrocity and it would be lovely to be able to tell jest which dir is the test dir. I don't see an option for this currently, so would it be possible to make this a CLI flag? `$> jest -i test ...` would be very user friendly compared to forcing a dirname that might not fit the fs conventions used by projects =)
bug?
OSX: 10.11.6
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
- A new jest.clearAllMocks() function that's equivalent to calling `mockClear` on all mock functions
Environment
FakeTimers
Mocks
Mocks
bug
import compose from 'koa-compose';
import Router from 'koa-router';
prefix: '/api/v1',
throws this error:
at Error (native)
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
I think I found a BUG.
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
"jest": {
Yeah but why do I need to specify preprocessorIgnorePatterns to node_modules? It is not the default for me, without this config, it try to resolve a node_modules
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
This issue is the biggest reason why I can't switch to Jest. Any updates or ideas on how to make progress?
But it is not Jest issue ‚Äî it is NodeJS issue. And there is a simple workaround ‚Äî if you want to debug the only test, you don't need to bother about global state. So, I implemented special test environment for this purpose:
@orta, can you share your config, too?  my source shows up all babel mangled It's all OSS - https://github.com/artsy/emission üéâ  My solution for runing and debugging single Jest test in IntelliJ Idea.
```bash
- Jest 17+
- Jest CLI ran with "-i" option
Edit: However, I got it to work using bugger https://github.com/buggerjs/bugger @sugatmahanti Did you get a chance to try the steps I mentioned here? https://github.com/facebook/jest/issues/1652#issuecomment-281985580 @NikhilVerma Thanks I did but once I ran the command, it didn't do anything. It opens the debugger and it immediately closes it with no message whatsoever.  Using the following command:
Jest 19.0.2
Avatar.test.js.snap
Avatar.js
Avatar.test.js
App.js
The `__snapshots__` in this way _feels_ a little messy to me (but this may just be me).
Avatar.test.js.snap
Avatar.js
Avatar.test.js
App.js
The magic seems to happen here.. https://github.com/facebook/jest/blob/master/packages/jest-snapshot/src/utils.js#L96
I haven't really looked much into the whole flow stuff yet, so there are some gaps in my experience here. Really only started any serious JS work in January of this year, so yeah, n00b :). 20 years on the JVM though. It's all just zeros and ones at the end of the day ;).
I might stick around and learn from the assembled crowd of wizards.
Perhaps I should be making these comments on the PR itself, but it's just a thought :).  @wyze
Foo/
Bar/
Foo/
Bar/
Song
Song
Repro:
`jest@15.1.1`
direction="alternate"
translateX='13rem'
direction="alternate"
translateX='13rem'
@cpojer thank you!
Whether jest can be used on karma? how?
@cpojer Sure!
@cpojer No problem!
EACCES: 13,
EADDRINUSE: 48,
EADDRNOTAVAIL: 49,
EAFNOSUPPORT: 47,
EBADF: 9,
EBADMSG: 94,
EBUSY: 16,
ECONNABORTED: 53,
EDEADLK: 11,
EDESTADDRREQ: 39,
EFBIG: 27,
EHOSTUNREACH: 65,
EIDRM: 90,
EILSEQ: 92,
EISCONN: 56,
EISDIR: 21,
ELOOP: 62,
EMULTIHOP: 95,
ENAMETOOLONG: 63,
ENETRESET: 52,
ENETUNREACH: 51,
ENOBUFS: 55,
ENODATA: 96,
ENOEXEC: 8,
ENOLCK: 77,
ENOMSG: 91,
ENOPROTOOPT: 42,
ENOSPC: 28,
ENOTCONN: 57,
ENOTDIR: 20,
ENOTSOCK: 38,
ENOTSUP: 45,
ENXIO: 6,
EOPNOTSUPP: 102,
EPROTONOSUPPORT: 43,
ERANGE: 34,
EROFS: 30,
ESTALE: 70,
ETXTBSY: 26,
SIGILL: 4,
SIGABRT: 6,
SIGBUS: 10,
SIGFPE: 8,
SIGCHLD: 20,
SIGTTOU: 22,
SIGVTALRM: 26,
SIGWINCH: 28,
SIGIO: 23,
RSA_PKCS1_OAEP_PADDING: 4,
POINT_CONVERSION_HYBRID: 6,
S_IFBLK: 24576,
S_IFLNK: 40960,
S_IRWXU: 448,
S_IRWXG: 56,
S_IRWXO: 7,
S_IROTH: 4,
defaultCoreCipherList: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA',
defaultCipherList: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA',
EACCES: 13,
EADDRINUSE: 48,
EADDRNOTAVAIL: 49,
EAFNOSUPPORT: 47,
EBADF: 9,
EBADMSG: 94,
EBUSY: 16,
ECONNABORTED: 53,
EDEADLK: 11,
EDESTADDRREQ: 39,
EFBIG: 27,
EHOSTUNREACH: 65,
EIDRM: 90,
EILSEQ: 92,
EISCONN: 56,
EISDIR: 21,
ELOOP: 62,
EMULTIHOP: 95,
ENAMETOOLONG: 63,
ENETRESET: 52,
ENETUNREACH: 51,
ENOBUFS: 55,
ENODATA: 96,
ENOEXEC: 8,
ENOLCK: 77,
ENOMSG: 91,
ENOPROTOOPT: 42,
ENOSPC: 28,
ENOTCONN: 57,
ENOTDIR: 20,
ENOTSOCK: 38,
ENOTSUP: 45,
ENXIO: 6,
EOPNOTSUPP: 102,
EPROTONOSUPPORT: 43,
ERANGE: 34,
EROFS: 30,
ESTALE: 70,
ETXTBSY: 26,
SIGILL: 4,
SIGABRT: 6,
SIGBUS: 10,
SIGFPE: 8,
SIGCHLD: 20,
SIGTTOU: 22,
SIGVTALRM: 26,
SIGWINCH: 28,
SIGIO: 23,
RSA_PKCS1_OAEP_PADDING: 4,
POINT_CONVERSION_HYBRID: 6,
S_IFBLK: 24576,
S_IFLNK: 40960,
S_IRWXU: 448,
S_IRWXG: 56,
S_IRWXO: 7,
S_IROTH: 4,
defaultCoreCipherList: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA',
defaultCipherList: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA' } }
‚îú‚îÄ‚îÄ app
‚îÇ   ‚îî‚îÄ‚îÄ some other code
"jest": {
Even without customizing the jest configuration it does something different if a module is named `'constants'`
``` diff
Misses          115        115
Partials          0          0
-> running: C:\Users\Jonny\repos\jest\node_modules\.bin\lerna.cmd bootstrap cwd: C:\Users\Jonny\repos\jest
Lerna v2.0.0-beta.26
babel-plugin-jest-hoist                            ‚ï¢‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-changed-files                                 ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
eslint-config-fb-strict                            ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-file-exists                                   ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-haste-map                                     ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-matcher-utils                                 ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-mock                                          ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-react-native                                  ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
babel-preset-jest                                  ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-resolve                                       ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-diff                                          ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-util                                          ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
babel-jest                                         ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-environment-jsdom                             ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-environment-node                              ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-matchers                                      ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-resolve-dependencies                          ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-snapshot                                      ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-jasmine2                                      ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-config                                        ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-runtime                                       ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
jest-repl                                          ‚ï¢‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ïü
at Error (native)
-> failed running: C:\Users\Jonny\repos\jest\node_modules\.bin\lerna.cmd bootstrap
accessibilityLabel={undefined}
accessibilityTraits={undefined}
hitSlop={undefined}
style={undefined}>
undefined
accessibilityLabel={undefined}
accessibilityTraits={undefined}
hitSlop={undefined}
+       "translateY": [Function validate],
style={undefined}>
undefined
} from 'react-native';
"jest": {
"babel-jest": "15.0.0",
"jest": "15.1.1",
"jest-react-native": "15.0.0",
"jest-teamcity-reporter": "0.1.0",
[15:09:48][Step 1/1]         - '#f0fc' (#rgba)
[15:09:48][Step 1/1]         - '#ff00ff00' (#rrggbbaa)
[15:09:48][Step 1/1]         - 'rgba(255, 255, 255, 1.0)'
[15:09:48][Step 1/1]       Bad object: {}
[15:09:48][Step 1/1]       Bad object: {}
[15:09:48][Step 1/1]         accessibilityTraits={undefined}
[15:09:48][Step 1/1]         hitSlop={undefined}
[15:09:48][Step 1/1]           style={undefined}>
[15:09:48][Step 1/1]     +             "color": "#AAA"
[15:09:48][Step 1/1]                 undefined
"name": "ReactNativeTest",
"test": "jest"
"babel-jest": "18.0.0",
"jest": "18.1.0",
"jest": {
Previously I had in my jest options:
I found this really confusing (bad DX). I figured only the testRegex was influencing which files were considered tests. So I updated it to be: `"testRegex": "^.+\\.spec\\.jsx?$",`. However my tests were not found. I was going to submit a new issue but I found this one.
- Invariant Violation: Native module cannot be null.
Bug
https://github.com/s992/jest-bug
jest version = 15.1.1
test framework = jasmine2
"name": "-mnt-c-projects-explore-jest",
"usesBabelJest": true,
"/mnt/c/projects/explore-jest"
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          115        115
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
Bug
``` diff
Misses          109        109
Partials          0          0
Difference:
Bug
npm i -S mongodb jest
I am not sure if I am using Jest the wrong way, but I would expect third party code to not block Jest execution if it runs just fine outside a test context
is it possible to loop its in Jest
// second way
Thank @cpojer maybe I do thing wrong
Bug
> jest
- jest-cli@15.1.1
@wez There were logs at the location you mentioned. The last entries are from a month ago using watchman v4.5.0:
For future readers: I have seen this same issue on El Cap 10.11.6 with jest 13.2.3, but uninstalling watchman (4.7.0) seems to fix it.
I'm on Sierra, `jest@15.1.1`, and `watchman@4.7.0`, and tried the things listed in here:
- `watchman version`: hangs
- `jest`: hangs, never prints anything
This code:
An alternative approach to the special-case i used here would be to include _enumerable_ getters in `getSlots()`. However, when I modified the conditional in this PR to be `if (!propDesc.get || propDesc.enumerable)`, another test broke, so I think that's a riskier approach that more severly break backwards-compatiblity. You can see the full test output (https://gist.github.com/benweissmann/d2cedab28fb31fd6eb4a31c5b5e01474) or take a look at my other branch (https://github.com/benweissmann/jest/tree/enumerable-getters)
``` diff
Misses          109        109
Partials          0          0
‚îú‚îÄ‚îÄ UNMET PEER DEPENDENCY react@15.2.1
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
bug
SyntaxError: Unexpected token U
Jest is in version v15.1.1
`-- jest-cli@15.1.1
+-- ansi-escapes@1.4.0
+-- callsites@2.0.0
| +-- ansi-styles@2.2.1
| +-- has-ansi@2.0.0
| | `-- ansi-regex@2.0.0
| +-- strip-ansi@3.0.1
+-- istanbul-api@1.0.0-aplha.10
| | | +-- inflight@1.0.5
| +-- istanbul-lib-hook@1.0.0-alpha.4
| +-- istanbul-lib-report@1.0.0-alpha.3
| | +-- rimraf@2.5.4
| +-- istanbul-lib-source-maps@1.0.1
| +-- istanbul-reports@1.0.0-alpha.8
| |       +-- camelcase@1.2.1
| |       +-- cliui@2.1.0
| +-- js-yaml@3.6.1
| | `-- esprima@2.7.3
|   `-- wrappy@1.0.2
+-- istanbul-lib-coverage@1.0.0
+-- istanbul-lib-instrument@1.1.3
| +-- babel-generator@6.14.0
| | +-- babel-messages@6.8.0
| | +-- babel-runtime@6.11.6
| | `-- lodash@4.15.0
| +-- babel-template@6.15.0
| +-- babel-traverse@6.15.0
| | +-- babel-code-frame@6.11.0
| +-- babel-types@6.15.0
| `-- babylon@6.9.2
+-- jest-config@15.1.1
| +-- istanbul@0.4.5
| | +-- escodegen@1.8.1
| | | +-- estraverse@1.9.3
| `-- jest-environment-node@15.1.1
+-- jest-environment-jsdom@15.1.1
| `-- jsdom@9.5.0
|   +-- abab@1.0.3
|   +-- acorn@2.7.0
|   +-- acorn-globals@1.0.9
|   | +-- aws-sign2@0.6.0
|   | +-- aws4@1.4.1
|   | | +-- cryptiles@2.0.5
|   | | +-- hoek@2.16.3
|   | | `-- mime-db@1.23.0
|   +-- sax@1.2.1
+-- jest-haste-map@15.0.1
|   +-- arrify@1.0.1
+-- jest-jasmine2@15.1.1
| +-- jasmine-check@0.1.5
| `-- jest-matchers@15.1.1
+-- jest-mock@15.0.0
+-- jest-resolve@15.0.1
+-- jest-runtime@15.1.1
| +-- babel-core@6.14.0
| | +-- babel-helpers@6.8.0
| | +-- babel-register@6.14.0
| | +-- shebang-regex@1.0.0
| +-- babel-jest@15.0.0
| | `-- babel-preset-jest@15.0.0
| |   `-- babel-plugin-jest-hoist@15.0.0
| `-- babel-plugin-istanbul@2.0.1
|     `-- micromatch@2.3.11
|       | |   +-- randomatic@1.1.5
|       +-- extglob@0.3.2
|       +-- is-extglob@1.0.0
|         `-- is-primitive@2.0.0
+-- jest-snapshot@15.1.1
| +-- jest-diff@15.1.0
+-- jest-util@15.1.1
| |   | +-- ansicolors@0.2.1
| +-- lodash.clonedeep@3.0.2
| | +-- lodash._baseclone@3.3.0
| | | +-- lodash._arraycopy@3.0.0
| | | +-- lodash._arrayeach@3.0.0
| | | +-- lodash._baseassign@3.2.0
| | | | `-- lodash._basecopy@3.0.1
| | | +-- lodash._basefor@3.0.3
| | | +-- lodash.isarray@3.0.4
| | | `-- lodash.keys@3.1.2
| | |   +-- lodash._getnative@3.9.1
| | |   `-- lodash.isarguments@3.1.0
| | `-- lodash._bindcallback@3.0.1
`-- yargs@5.0.0
+-- cliui@3.2.0
| `-- wrap-ansi@2.0.0
+-- decamelize@1.2.0
+-- lodash.assign@4.2.0
+-- os-locale@1.4.0
|   | |   `-- is-arrayish@0.2.1
|   | +-- pify@2.3.0
|   | `-- strip-bom@2.0.0
+-- y18n@3.2.1
`-- camelcase@3.0.0
npm ERR!
npm ERR!     C:\Users\Ilja\Documents\jest-json-bug\npm-debug.log
"jest": {
"^[./a-zA-Z0-9$_-]+\\.css$": "<rootDir>/config/jest/CSSStub.js"
``` diff
Misses          109        109
Partials          0          0
I'd be happy to write a blogpost for the Jest blog sometime.
Jest is **amazing**, thanks for all the work. I've started using snapshot testing with more than just React components and in most instances everything works perfectly.
Running Jest the second time should match the snapshot.
"regex": /\s+ \w \d \[ \. blah.* [xyz]+/
@anilanar so, `pretty-format` does not escape regex, it just transforms them to string (with `RegEx.prototype.toString`). While this is great for strings, when reading from a file all regex's backslashes must be escaped. Otherwise `require` call to this file will "swallow" them or escape the character after.
Thanks for Jest!
You don't have to use Jasmine, believe it supports swapping out the env to something like TAP if you prefer.
Right, and what I'm suggesting is the idea of least surprise. Because the escape hatch exists, it's surprising to me that it doesn't behave as expected.
I'm switching some of my projets from AVA to Jest (still like AVA but Jest has a better ["out-of-the-box" support for React/UI components IMO](https://twitter.com/adriantoine/status/771800442191962112)) and I miss some of those as well!
but Jest displays those as successful tests which is not really what I want, it doesn't help much with my organisation.
``` diff
Misses          109        109
Partials          0          0
@cpojer I'd like to give it a try
Hey @gaearon, we'd appreciate your input on the related PR, as you originally requested this enhancement :)
Bug
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
FAIL  ./lodash.test.js
‚óè can import lodash
FAIL  ./globals.test.js
"undefined"
In fact, all of the following evaluate to `undefined` in Jest node environment:
Just to add to this, importing `lodash@4.15.0` also results in `TypeError: Cannot read property 'prototype' of undefined`, because its global detection looks like this:
This also breaks Immutable.fromJS
// missing globals
@cpojer
thanks @cpojer, u rock üíØ
``` diff
Misses          109        109
Partials          0          0
"test": "jest"
"jest": {
"babel-jest": "^15.0.0",
"jest": "^15.1.1",
"jest-react-native": "^15.0.0",
jest --debug output:
jest version = 15.1.1
test framework = jasmine2
"defaultPlatform": "ios",
"ios"
"react-native"
"usesBabelJest": true,
1. Set up a custom terminal theme with light colors (iTerm, HyperTerm etc.)
jest version = 15.1.1
test framework = jasmine2
"usesBabelJest": true,
p.s. Jest rocks!
- Sinon has `sinon.spy()` (174,607 GitHub code results) and `sinon.stub()` (120,488)
- Jasmine has `jasmine.createSpy()` (378,392 GitHub code results)
- Chai Spies has `chai.spy()` (2,436 GitHub code results)
It's actually closer to a stub than a spy I think.
@cpojer actually, my original message is wrong, it does include console.log but it definitely doesn't include console.error.
> jest
errno: undefined,
"test": "jest --colors",
To me if the user specifies `--json` all istanbul output should be suppressed other than that in the returned object.
Yeah I'm poking around now :/
Needs to be disabled as well
bug
I'm on Jest 15.1.1 in Windows 10
@IljaKroonen This might interest you https://github.com/kulshekhar/ts-jest
``` diff
Misses          109        109
Partials          0          0
`mockWith` and `mockWithOnce` might work as shorter alternatives instead?
jest --watch=all
"test": "jest"
It's cannot connect to Waterline in test case
`orm.initialize(dbTestConfig, function(err, models) {
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
What about other special symbols? Someone crazy may create folder `a[x-z]$c`.
P.S. Sorry for being annoying earlier @cpojer...this is my attempt at redemption.
``` diff
Misses          109        109
Partials          0          0
Bug
jest version = 15.1.0
test framework = jasmine2
"usesBabelJest": true,
cc @cpojer
"jest": {
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
jest 15.0.2
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
import Icon from './Icon'
jest: v15.0.2
thanks @cpojer that's half of it.
The other half was a misconception.
import * as moduleToMock from 'somemodule';
jest.setMock('somemodule', moduleToMock);
``` diff
Misses          109        109
Partials          0          0
And get the warning which in my view must not be:
"jest": {
> jest
"test": "jest"
"jest-cli": "^15.0.0"
"jest": {
> jest
> jest
The dash in `testPathDirs` is the issue here.
## Bug
Jest 15.1.0
1¬∞ Thor
2¬∞ God
3¬∞ @cpojer ;-)
There are `.` characters in the path, but they don't seem to be the cause as replacing them with anything else makes no difference.
There are also spaces, and it seems like that might be the cause as when I move the project directory right down to `C:\myprojectname` it then begins to find the tests correctly, but won't find any when the directory is like `C:\My Directory\myprojectname`.
``` diff
- Misses          109        110     +1
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
That way each test flushes all tick callbacks and allows Aphrodite to run.
In the meantime I'm using fake timers and
jest.runAllTicks();
} from 'react-native';
import { expect } from 'chai';
@cpojer Thank you, it helped.
So evil üòÑ
Is `OnlyFrom` removed completely?
"cobertura",
My two cents, we had to workaroud this manually in some places:
- https://github.com/algolia/places/blob/eebb83094cc1450afcfa5cff307a7fcd06022542/src/places.test.js#L3-L4
- https://github.com/algolia/places/blob/eebb83094cc1450afcfa5cff307a7fcd06022542/test/fileMock.js
@dmitriiabramov are you diff guy here? :D
``` diff
Partials          0          0
``` diff
- Misses         1358       1402    +44
Partials          0          0
``` diff
Misses         1356       1356
Partials          0          0
``` diff
- Misses         1346       1356    +10
Partials          0          0
``` diff
Misses          109        109
Partials          0          0
@cpojer Got back support of `jasmine.any` ... really ugly global stuff but anyway we use it here https://github.com/facebook/jest/blob/master/packages/jest-matchers/src/matchers.js#L29
@cpojer what diff do you mean? Is it something you did? Or my new PR? If it's about my PR this one is `toHaveBeenCalledWith / toBeCalledWith` and the new one is `toHaveBeenLastCalledWith / lastCalledWith`. Didn't get it...
``` diff
Partials          0          0
I'm seeing a very strange behavior from my current jest mocks for ListView and RefreshControl. Within the snapshot test, the ~~wrapping component (which is RandomView in the example I wrote below)~~ ListView is rendered multiple times from the RefreshControl's reference.
The resulting snapshot file is [here](http://pastebin.com/Fcjg3qyR), and you can see that the RandomView is being printed out multiple times, and not being resolved to a Circular reference.
# Mocks:
} from 'react-native'
export default RandomView
import 'react-native'
import RandomView from '../RandomView'
<RandomView list={[{a: 1}, {a: 2}]} />
theme: {
The log `react-native start`
ReactNative dependencies:
"apsl-react-native-button": "3.0.0",
"react-native-i18n": "0.0.8",
"redux": "3.5.2",
"tcomb-form-native": "0.5.3",
"undefined": "0.1.0",
"babel-jest": "14.0.0",
"istanbul": "0.4.3",
"jest": "14.0.0",
"jest-react-native": "14.0.0",
"jest": {
"/.vagrant/",
If I run it in the browser, it works, but when testing it in Jest I get an error telling me that Date is undefined:
Fran
undefined 'undefined'
undefined 'undefined'
undefined 'undefined'
and indicates that `Date` object is for some reason `undefined`.
Bonus tip: `window` also is `undefined`.
Any ideas what could be messing around with that prop? I should be able to mock it though right?
Confirmed: _Sinon_ is causing this, dont know why yet
bsr.
### Versions:
babel-jest: ^14.1.0
jest: ^14.1.0
"jest": {
"ios.js"
import 'react-native';
jest.unmock('Image');
### Runtime Error
- SyntaxError: Unexpected token ...
SyntaxError: Unexpected token )
"jest": {
"ios.js"
``` diff
- Misses          109        110     +1
Partials          0          0
``` diff
Misses         1324       1324
Partials          0          0
Or even better, maybe jest can provide a renderer with support for that, something like:
<Accordion openMulti>
var /* istanbul ignore next */_react = require('react'); /* istanbul ignore next */var _react2 = _interopRequireDefault(_react);
var /* istanbul ignore next */_ListItem = require('./ListItem'); /* istanbul ignore next */var _ListItem2 = _interopRequireDefault(_ListItem);
var /* istanbul ignore next */_TabNext = require('./icons/base/TabNext'); /* istanbul ignore next */var _TabNext2 = _interopRequireDefault(_TabNext);
var /* istanbul ignore next */_Collapsible = require('./Collapsible'); /* istanbul ignore next */var _Collapsible2 = _interopRequireDefault(_Collapsible);
var CLASS_ROOT = /* istanbul ignore next */( /* istanbul ignore next */++__cov_udPmu$ouzqJ8kgvNrunNVZZV6Os.s['15'], _CSSClassnames2.default.ACCORDION_PANEL); // (C) Copyright 2014-2016 Hewlett Packard Enterprise Development LP
/* istanbul ignore next */var
function /* istanbul ignore next */AccordionPanel(props, context) {/* istanbul ignore next */(0, _classCallCheck3.default)(this, AccordionPanel);var _this = (0, _possibleConstructorReturn3.default)(this, (AccordionPanel.__proto__ || (0, _getPrototypeOf2.default)(AccordionPanel)).call(this,
/* istanbul ignore next */_this.state = {
active: props.active || false }; /* istanbul ignore next */return _this;
{/* istanbul ignore next */var _props =
var classes = /* istanbul ignore next */(0, _classnames3.default)(
className, /* istanbul ignore next */(0, _defineProperty3.default)({},
className: /* istanbul ignore next */CLASS_ROOT + '__header',
; /* istanbul ignore next */++__cov_udPmu$ouzqJ8kgvNrunNVZZV6Os.s['16'];
active: /* istanbul ignore next */_react.PropTypes.bool,
animate: /* istanbul ignore next */_react.PropTypes.bool,
heading: /* istanbul ignore next */_react.PropTypes.node.isRequired,
unfortunately im not familiar with instanbul to inspect it myself
https://github.com/alansouzati/jest-coverage-test
``` diff
- Misses         1331       1349    +18
Partials          0          0
The negation case for `toEqual`/`toBe` feels a bit weird.
I would probably call it `unexpected` there and paint both red (since they‚Äôre the same, but shouldn‚Äôt be).
'mockConstructor',
``` diff
- Misses         1324       1325     +1
Partials          0          0
``` diff
Misses         1324       1324
Partials          0          0
``` diff
Misses         1324       1324
Partials          0          0
I recently started using Jest and so far I love it! Today I stumbled upon a weird issue though:
"jest": {
and Jest's output was:
https://github.com/Dakuan/gulp-jest
Agreed with the complexity added.
``` diff
Misses          152        152
Partials          0          0
``` diff
- Misses         1324       1351    +27
Partials          0          0
+- ProjectA
+- ProjectB                 |
+- ProjectA
+- ProjectB                 |
Is this a bug, or am I doing something wrong? :)
jest@14.1.0
jest-react-native@14.1.3
``` diff
- Misses         1324       1325     +1
Partials          0          0
jest Foo:142
Could you reopen this issue? Migrating from AVA to Jest, and the `test.only` syntax is the only thing I miss.
@cpojer
But now I'm not sure, is there a reason for `private:true` to be set?
babel: {
// pseudo-code, this doesn't actually work obviously
const babelOptions = options; // assuming some merging, conditional logic, etc.
return babelJest.createTransformer(babelOptions);
@ccorcos yes, exactly!
> // transformer
loader: 'babel',
runJest(babelConfig)
because I have a complicated (legacy) build system and have to support several different ways of doing things.
// Custom Jest transform implementation that wraps babel-jest and injects our
Now run jest with these options:
Then at least you can share babel settings in one place,
or if `.babelrc` is not an option,  here is an example based on @nfarina code,
const babelJest = require('babel-jest');
src = babelJest.process(src, path);
"jest": {
"testFileExtensions": [ "ts", "tsx", "js", "jsx" ],
const babelJest = require('babel-jest');
'moduleResolution': tsc.ModuleResolutionKind.Node,
src = babelJest.process(src, path);
"jest": {
"jsx"
We have a lot of lodash usage in our project. we import it like so.
`import has from 'lodash/has'`
babelrc:
```javascript
"lodash", // I tried removing this plugin (has no effect)
I know this might be more of an es2015 modeuls/ imports kind of question but I can't seem to find anywhere else people are discussing the usage of all these tools together.
``` diff
- Misses         1324       1329     +5
Partials          0          0
"jest": {
the problem is definately: https://github.com/facebook/jest/commit/b56e36832d211c626894bff2591e9b152d14ba5b the escape for the regex is incorrect
Escaping the the paths on windows creates a regex with to many `\`
``` diff
Misses         1324       1324
Partials          0          0
But just a simple test such as the one below fails with jest but works with mocha
jest.dontMock('../index');
import ReactNative from 'react-native';
} = ReactNative;
$ jest --no-cache cardviewjest-enzymetest.js
‚óè Runtime Error
`Runtime Error
npm ERR! Darwin 15.6.0
I migrated from `ava` and this wasn‚Äôt a problem, so maybe there is an answer? Maybe that‚Äôs `process.exit` in Node.js
- **Jest version**: 15.1.1
- **CodeShip**:
Seems to be a race condition of sorts. Sometimes it quits after running all test locally sometimes it doesn't...
Jasmine seems to have `--forceexit` option so I would not complain if similar would also land to Jest üôè
import 'react-native';
Animated,_
aplha vs alpha
Hey @cpojer do you want me to make a branch that runs the test using Mocha for comparison or is that unnecessary?
No worries @cpojer! I'm extremely grateful of all the great work that's been put into Jest. I think it's the best testing tool out there for JS.
Also, would it be too much to ask you to explain why this issue was happening? I'm curious. üòÖ
So after trying to write my tests again today I came across another bug with using Nightmare. This time I took the time to figure out exactly what it was.
Is there a way to disable the mocking of timers in Jest?
@cpojer üëç  Sorry for being so slow :(
Let's invert the colors.
I think GH logic doesn‚Äôt quite apply there. You‚Äôre not really ‚Äústarting‚Äù from the expected value and then changing your app to output the wrong thing.
I can imagine that when you start _thinking_ about it, it might feel incorrect, but if you just glance without thinking or [if you are drunk](https://www.youtube.com/watch?v=r2CbbBLVaPk), I think ‚Äúred is bad‚Äù feels much more intuitive.
@yaycmyk: in reality there are 3 colours for object diffs:
@gaearon I think we may always disagree on this point.  The way I see it, especially with snapshot testing, is that the first run of the test creates the snapshot, so every subsequent test should be showing me what's changed from that snapshot.  I suspect that if you were to run polls for what the most popular answer is, you could get people to prefer either answer with subtly different wording of the question.
Oh, I can see how this can be confusing.
"jest": {
"jest-cli": "^12.0.2",
- SyntaxError: Unexpected reserved word
import 'react-native';
Animated,
} from 'react-native';
"jest": {
Is there some other way to work around this?
<img width="599" alt="screen shot 2016-08-15 at 16 19 08" src="https://cloud.githubusercontent.com/assets/810438/17669050/03399520-6304-11e6-9b57-49898095adda.png">
I've been trying to troubleshoot this on my own off and on for the last few days, but unfortunately I haven't been able to figure out what's going on. Issue #433 seems to be the closest thing to what I have going on, but none of the suggestions there helped.
"jest": {
"sinon",
Not sure if you guys are aware, but the issue is persisting with `jest@test`. Didn't seem to make any change; even after flushing the cache.
@dmitriiabramov Ah, ok sorry about the confusion.
Also: `collectCoverageFrom` = üî• üëç üëç
"jest": {
I use a custom preprocessor (because jest fails when using CSS modules). When removing that custom preprocessor, then it seems to pick up the code without a problem. Could it be related to that? My preprocessor is pretty much this one:
@cpojer what do you mean by `his won't work because the spy/mock APIs aren't the same` ? I'm handling both cases of API with different implementations like `jasmineToHaveBeenCalled` and `jestToHaveBeenCalled` didn't really get what you mean...
'**mocks**` directory.
- Adds three new named exports to jest-snapshot: `processSnapshot`, `createSnapshotState`, and `patchJasmine`
- `patchJasmine` is the same function that was previously defined in `index.js`
- Updates jest-jasmine2 to use `createSnapshotState` and `patchJasmine` instead of `getSnapshotState`.
``` diff
- Misses         1324       1327     +3
Partials          0          0
{...other}
@aweary : Any update on this ? `tree.props.onMouseLeave();`
does not work if `onMouseLeave` uses arrow functions
imports/common-ui
@taion I was just trying out and bitten by not specifying `no-cache`. this was remarked by @cpojer in #1387 . Also, `npm run <target> --no-cache` didn't pass the flag, so I ran with `NODE_ENV=test ./node_modules/.bin/jest --no-cache`. (may be `-- -- no-cache` might pass the flag, but didn't try)
messing with my artistic casing I see @taion. I guess my poetic vision is just too far ahead of its time.
I do my best OSS work in those situations :P
https://github.com/ranjitpandit/jest-snapshot
@GrigoryPtashko in the root of the project run the command "npm test"
https://github.com/ranjitpandit/jest-snapshot
Yet I keep seeing this error:
SyntaxError: Unexpected token )
This is the offending line:
it works in react-native@0.30.1
‚óè Runtime Error
Looks like we need to change this line, but I guess it needs to be done in a way to support React Native 0.30 and 0.31
* react-native: "0.42.0"
* babel-jest: "19.0.0,
* babel-preset-react-native: "1.9.1"
Are there any configuration settings or optimizations that I could use to help speed up Jest? I would much rather use Jest over Mocha, but will obviously use the test platform that executes in a reasonable amount of time. This is my Jest configuration:
"jest": {
@mbrio  I decided to switch over to mocha, and the tests run immediately within my docker container without an issue. No changes were made to my Dockerfile or docker-compose configuration. This seems like a Jest issue and not a Docker issue. I had no issues with running my Jests tests locally, only within the container.  @amkoehler yeah, I think there's a significant difference in the libraries that Jest and Mocha use for watching filesystem changes. I assume that Mocha is less thorough, (and/or) less active, and/or less compatible with all filesystems. The speed issue is definitely an issue with _Docker for Mac_ as I have friends who have slightly different configurations for running Docker on a Mac that do not see as big of an issue. With that said, since Docker for Mac is the official way to run Docker instances, it would be great for the developers of Jest to consider looking into how to be a bit more compatible with it.  This fixes code that tests `global.global === global` to check if it is running in Node, [as RxJS 5 does](https://github.com/ReactiveX/rxjs/blob/3793e4768dd2655300b67a82be9b30c4c065bac1/src/util/root.ts#L28).
I'd imagine that this can be done in a BC manner.
expect(true).toMatchSnapshot('foobar');
@jlfwong Almost got it!
- SyntaxError: Unexpected token ...
I tried the following in a Jest test:
jest.mock('meteor/universe:i18n');
‚óè Runtime Error
Does this way make sense? Bear with me, I'm still a Jest n00b. :)
"jest": {
### __mocks__/meteor/universe:i18n.js
:facepalm:
‚óè Runtime Error
@oscar-b I just do this:
this error is thrown:
I'm using RN 0.24.1, is there any way to use Jest?
const fn = jest.fn();
const fn = jest.fn();
As louisremi said, we need `jest.syncify()`.
I test the oposite, that exceptions are actually thrown,
@alfonsodev Maybe a slightly safer temporary solution would be:
I'd like to cast my vote for this api:
expect(myOtherFunction).toThrow().toMatchObject({ code: 'ENOENT' })
That's kinda strange @excitement-engineer to have an `expect` in another `expect`.
This is an issue that I keep stumbling on when testing async code, would be great if a solution gets added to jest in the short run! Maybe I'm taking crazy pills, but this seems to work just fine, no API change needed:
await something('bad param');
jest": {
and getting this error:
I've been loving Jest so far testing React components.
I just tried using it, and unfortunately I hit an instant roadblock. `brcypt` triggers a `[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()` warning and the test fails due to a runtime error (`TypeError: Path must be a string. Received undefined`)
(Totally Tooling Tips is a Video series me and Addy Osmani do here: https://www.youtube.com/watch?v=IWgNn1kqrsA&list=PLOU2XLYxmsILKwwASNS0xgfcmakbK_8JZ)
Side note: it seems like the coverage missing lines highlighting is pretty screwed up in that alpha build. Not sure if there's a corresponding `babel-jest` alpha I should be using as well.
Not sure where this is coming from.
‚óè Runtime Error
I tried avoiding this by adding `jest.mock('react/lib/ReactBrowserEventEmitter');` but it doesn't help.
</MuiThemeProvider>
</MuiThemeProvider>
Hi @cpojer 's solution works for me
@iam-peekay we do not recommend mocking any internal module for React. It's very likely doing so will cause strange issues like what you're seeing. This should be resolved in 15.4.0 though!
<CustomComponent />
Is this something that will be supported in the future?
@gaearon Skimmed over the most important comment üòë. Sorry about that.
describe('POC', () => {
<undefined />
React Native 0.30.0
jest 14.1.0
Thank you for @cpojer @picodoth
{ className: 'undefined' }
"jest": {
verbose: true,
extensions: ['', '.json', '.js'],
import _ from 'lodash';
...other,
{...other}
import AnimatedInput from '../index';
Hey @moimael,
can be removed now, as there's no reference to `jasmine` in the file anymore.
I hadn't thought about how annoying it would be to add 100 temporary `true`s just to fix your known changes. I can definitely see how that would be a bad user experience. Chai is just an assertion library, so it can't receive flags passed to its test framework directly, but maybe I could use an environment variable? Something like `UPDATE_CHAI_JEST_SNAPSHOTS=true mocha **/*.spec.js`.
I think adding the counter number makes sense in jest because the matcher interface is implicit and jest keeps track of the snapshots. However, because I would like my chai assertion helper to be more configurable, the interface is explicit. It would be confusing for users if they told the assertion helper to create a snapshot named "My snapshot" and it was actually saved as "My snapshot 1".
\- becomes ->
className="heading_lfcwzr">
className="nav_120drhm">
className="copyright_yf215x">
<undefined />
Is there something special that's needed for ListView?
> jest
https://github.com/ranjitpandit/jest-snapshot
hi cpojer,
On the 2nd example, Jest treats `./Filename` as **`../`**, which seems like a bug.
‚óè Runtime Error
Thanks for the great feature, and for Jest, both are very useful.
So is it that `context` is the only way to organize it properly? Taking into account it's considered experimental and unstable is there any good alternative?
> This is where Jest's mocking system can really shiny.
> Snapshot mismatch:
switching to jsdom make it work again.
I'm trying to setup with jest 13.2.3 on my current project. We use the webpack alias feature to get simpler module paths (eg. `import en from 'i18n/en';` instead of `import en from '../../../../i18n/en'`), so I've followed [this tutorial](https://facebook.github.io/jest/docs/tutorial-webpack.html) to setup the `package.json` for jest, using `moduleNameMapper` to setup this kind of rule:
import en from 'i18n/en';
TypeError: lodash.assign is not a function
"jest": {
‚óè Runtime Error
renderer
"jest": {
The jest config in package.json
"jest": {
"react-native"
"defaultPlatform": "ios",
"ios",
"react-native"
"jest": {
import ReactNative from 'react-native';
‚óè Runtime Error
at Error (native)
Our jest config:
"jest": {
cc @cpojer
Here's the issue. I've got a strange behaviour of Jest when it is launched
"jest": {
return babel.transform(src, {
}).code;
Here's the `.babelrc`:
jest.disableAutomock();
jest.disableAutomock();
fragments: {
fragment on Root {
Using Jest CLI v13.2.3, jasmine2
Using Jest CLI v13.2.3, jasmine2
See? Why? What changes inside Jest that causes the exception?
I launch Jest with the `-i` (`--runInBand`) switch.
Jest version is:
Using Jest CLI v13.2.3, jasmine2
Using Jest CLI v13.2.3, jasmine2
Here's my jest config:
"jest": {
So i get this error when i launch jest.
This is my jest config.
"jest": {
"^[./a-zA-Z0-9$_-]+\\.png$": "RelativeImageStub"
The error is :
- Error: Line 8: Unexpected token ILLEGAL
"jest": {
> jest
When `jest` is assigned to `npm test` (which is a pretty common convention), you get:
Passes!
So now a different solution:
Of course, I'm not sure exactly if this really is a problem with aliases, but it does work when put this way:
1. Use regex to differentiate between mocks and actuals, something like this pseudo-code:
code:
error:
‚óè Runtime Error
‚îî‚îÄ‚î¨ jest-cli@13.2.3
‚îÇ ‚îú‚îÄ‚îÄ ansi-styles@2.2.1
‚îî‚îÄ‚îÄ lodash.keys@4.0.7
> jest
Using Jest CLI v13.2.3, jasmine2
$ npm test -- --verbose
Using Jest CLI v13.2.3, jasmine2
$ node_modules/.bin/jest --verbose
jest: CLI v13.2.3, jasmine2
Jest Configuration:
"jest": {
> jest
Looks like the path is being interpreted as a regular expression, because altering the directory name to be an invalid regexp like `/tmp/(Atests` lead to this happening:
> jest
SyntaxError: Invalid regular expression: //private/tmp/(Atests/src/coffee/: Unterminated group
at new RegExp (native)
"jest": {
"^[./a-zA-Z0-9$_-]+\\.css$": "<rootDir>/test/config/jest/CSSStub.js"
Not sure if this is expected behaviour?
See [the issue on React](https://github.com/facebook/react/issues/7240) for more information and the repo I put together to reproduce the issue: https://github.com/angusfretwell/reproduce-debugid-warning (`npm install && npm test`).
@cpojer done üòä
Got this to work by adding to jest config
"./node_modules/jasmine-reporters"
jasmine-reporter.js |      100 |      100 |      100 |      100 |                |
jest.unmock('../twitterProtocol')
@cpojer @gaearon Actually it's weird as we've already migrated this matcher. Would be grade to know inconsistencies so I could fix it
Is it supported by jest? Sometimes test setup methods do not run synchronously.
@cpojer We're gonna come out of this and _somehow_ it's still gonna be your fault üòù
it('calls the Api Wrapper', () => {
And ApiWrapper looks like this:
class ApiWrapper {
export default ApiWrapper;
class ApiWrapper {
What is it about Jest's mocking behavior that makes this happen?
"name": "jest-testttt",
"babel-jest": "^13.0.0",
"jest": "^13.0.0"
"jest": {
@cpojer what about `cachedDataRejected`?
@cpojer ok, good to know! Thank you!
https://github.com/pixeldrew/test-jest
> jest
‚óè Runtime Error
Upvote for @dalimian suggestion.  I am tryiing to user `jest --coverage` without luck, I somehow endup with weird coverage report.
> test-coverage-jest@1.0.0 test:jest /home/vvo/Dev/Algolia/test-coverage
Same with mocha:
> test-coverage-jest@1.0.0 test:mocha /home/vvo/Dev/Algolia/test-coverage
test-coverage-jest@1.0.0 /home/vvo/Dev/Algolia/test-coverage
‚îú‚îÄ‚î¨ babel-plugin-istanbul@1.0.0
‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ ‚îú‚îÄ‚î¨ istanbul-lib-instrument@1.1.0-alpha.1
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ babel-generator@6.11.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-template@6.9.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ babel-traverse@6.10.4
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ globals@8.18.0
‚îÇ ‚îÇ ‚îÇ   ‚îî‚îÄ‚î¨ loose-envify@1.2.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ babel-types@6.11.1
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babylon@6.8.2
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ istanbul-lib-coverage@1.0.0-alpha.4
‚îÇ   ‚îú‚îÄ‚îÄ arrify@1.0.1
‚îÇ   ‚îú‚îÄ‚îÄ lodash.assign@4.0.9
‚îÇ   ‚îú‚îÄ‚î¨ micromatch@2.3.10
‚îÇ   ‚îÇ ‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ randomatic@1.1.5
‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ extglob@0.3.2
‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ is-extglob@1.0.0
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ is-primitive@2.0.0
‚îÇ   ‚îÇ   ‚îÇ     ‚îî‚îÄ‚îÄ spdx-exceptions@1.0.4
‚îú‚îÄ‚î¨ babel-polyfill@6.9.1
‚îÇ ‚îú‚îÄ‚îÄ babel-runtime@6.9.2
‚îú‚îÄ‚î¨ babel-preset-es2015@6.9.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-helper-define-map@6.9.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-helper-function-name@6.8.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-helper-optimise-call-expression@6.8.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-helper-replace-supers@6.8.0
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ babel-messages@6.8.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ babel-helper-call-delegate@6.8.0
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ babel-helper-hoist-variables@6.8.0
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ babel-helper-get-function-arity@6.8.0
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ babel-helper-regex@6.9.0
‚îÇ ‚îú‚îÄ‚î¨ babel-plugin-transform-es2015-unicode-regex@6.11.0
‚îÇ ‚îÇ   ‚îî‚îÄ‚î¨ regjsparser@0.1.5
‚îú‚îÄ‚î¨ babel-preset-stage-2@6.11.0
‚îÇ ‚îî‚îÄ‚î¨ babel-preset-stage-3@6.11.0
‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ babel-helper-remap-async-to-generator@6.8.0
‚îÇ     ‚îú‚îÄ‚î¨ babel-helper-builder-binary-assignment-operator-visitor@6.8.0
‚îÇ     ‚îÇ ‚îî‚îÄ‚îÄ babel-helper-explode-assignable-expression@6.8.0
‚îú‚îÄ‚î¨ babel-register@6.9.0
‚îÇ ‚îú‚îÄ‚î¨ babel-core@6.10.4
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ babel-code-frame@6.11.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ babel-helpers@6.8.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ shebang-regex@1.0.0
‚îÇ ‚îú‚îÄ‚îÄ lodash@4.13.1
‚îú‚îÄ‚î¨ jest-cli@13.0.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ansi-styles@2.2.1
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ has-ansi@2.0.0
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ ansi-regex@2.0.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ strip-ansi@3.0.1
‚îÇ ‚îú‚îÄ‚î¨ jest-config@13.0.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ istanbul@0.4.4
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ escodegen@1.8.0
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ estraverse@1.9.3
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ esprima@2.7.2
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ inflight@1.0.5
‚îÇ ‚îÇ ‚îÇ ‚îÇ   ‚îî‚îÄ‚î¨ yargs@3.10.0
‚îÇ ‚îÇ ‚îÇ ‚îÇ     ‚îú‚îÄ‚îÄ camelcase@1.2.1
‚îÇ ‚îÇ ‚îÇ ‚îÇ     ‚îú‚îÄ‚î¨ cliui@2.1.0
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ wrappy@1.0.2
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ cardinal@0.5.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ansicolors@0.2.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ redeyed@0.5.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ lodash.assign@3.2.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ lodash._createassigner@3.1.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._isiterateecall@3.0.9
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.restparam@3.6.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.keys@3.1.2
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ growly@1.3.0
‚îÇ ‚îÇ   ‚îú‚îÄ‚î¨ lodash.clonedeep@3.0.2
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ lodash._baseclone@3.3.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._arraycopy@3.0.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._arrayeach@3.0.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ lodash._baseassign@3.2.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._basecopy@3.0.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.keys@3.1.2
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._basefor@3.0.3
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash.isarray@3.0.4
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ lodash.keys@3.1.2
‚îÇ ‚îÇ   ‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ lodash._getnative@3.9.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ lodash.isarguments@3.0.8
‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ jsdom@9.3.0
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ abab@1.0.3
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ acorn@2.7.0
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ acorn-globals@1.0.9
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ aws-sign2@0.6.0
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ aws4@1.4.1
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ har-validator@2.0.6
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ hawk@3.1.3
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ cryptiles@2.0.5
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ hoek@2.16.3
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ jsprim@1.3.0
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ verror@1.3.6
‚îÇ ‚îÇ   ‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ asn1@0.2.3
‚îÇ ‚îÇ   ‚îÇ ‚îÇ   ‚îú‚îÄ‚î¨ dashdash@1.14.0
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ mime-types@2.1.11
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ mime-db@1.23.0
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ oauth-sign@0.8.2
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ sax@1.2.1
‚îÇ ‚îú‚îÄ‚î¨ jest-haste-map@13.0.0
‚îÇ ‚îú‚îÄ‚îÄ jest-jasmine1@13.0.0
‚îÇ ‚îú‚îÄ‚î¨ jest-jasmine2@13.0.0
‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ jasmine-check@0.1.5
‚îÇ ‚îú‚îÄ‚îÄ jest-mock@13.0.0
‚îÇ ‚îú‚îÄ‚î¨ jest-snapshot@13.0.0
‚îÇ ‚îú‚îÄ‚î¨ jest-util@13.0.0
‚îÇ ‚îú‚îÄ‚î¨ lodash.template@4.2.5
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash._reinterpolate@3.0.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ lodash.assigninwith@4.0.7
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.keysin@4.1.4
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash.keys@4.0.7
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash.rest@4.0.3
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ lodash.templatesettings@4.0.1
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.escape@4.0.0
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.tostring@4.1.3
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ walker@1.0.7
‚îÇ ‚îú‚îÄ‚î¨ worker-farm@1.3.1
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ errno@0.1.4
‚îÇ ‚îî‚îÄ‚î¨ yargs@4.7.1
‚îÇ   ‚îú‚îÄ‚îÄ camelcase@3.0.0
‚îÇ   ‚îú‚îÄ‚î¨ cliui@3.2.0
‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ wrap-ansi@2.0.0
‚îÇ   ‚îú‚îÄ‚î¨ os-locale@1.4.0
‚îÇ   ‚îÇ ‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ is-arrayish@0.2.1
‚îÇ   ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ   ‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ strip-bom@2.0.0
‚îÇ   ‚îú‚îÄ‚îÄ y18n@3.2.1
‚îÇ     ‚îî‚îÄ‚îÄ camelcase@2.1.1
‚îú‚îÄ‚î¨ mocha@2.5.3
‚îÇ ‚îú‚îÄ‚î¨ glob@3.2.11
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ lru-cache@2.7.3
‚îÇ ‚îú‚îÄ‚î¨ jade@0.26.3
‚îÇ ‚îî‚îÄ‚îÄ to-iso-string@0.0.2
‚îî‚îÄ‚î¨ nyc@6.6.1
‚îú‚îÄ‚îÄ arrify@1.0.1
‚îÇ   ‚îú‚îÄ‚îÄ imurmurhash@0.1.4
‚îÇ ‚îî‚îÄ‚î¨ strip-bom@2.0.0
‚îÇ ‚îú‚îÄ‚îÄ commondir@1.0.1
‚îÇ ‚îî‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ pseudomap@1.0.2
‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ yallist@2.0.0
‚îú‚îÄ‚î¨ glob@7.0.3
‚îÇ ‚îú‚îÄ‚î¨ inflight@1.0.5
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ wrappy@1.0.2
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ wrappy@1.0.2
‚îú‚îÄ‚î¨ istanbul@0.4.3
‚îÇ ‚îú‚îÄ‚î¨ escodegen@1.8.0
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ estraverse@1.9.3
‚îÇ ‚îú‚îÄ‚îÄ esprima@2.7.2
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ glob@5.0.15
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ inflight@1.0.5
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ wrappy@1.0.2
‚îÇ ‚îÇ   ‚îî‚îÄ‚î¨ yargs@3.10.0
‚îÇ ‚îÇ     ‚îú‚îÄ‚îÄ camelcase@1.2.1
‚îÇ ‚îÇ     ‚îú‚îÄ‚î¨ cliui@2.1.0
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ wrappy@1.0.2
‚îÇ ‚îî‚îÄ‚îÄ md5-o-matic@0.1.1
‚îú‚îÄ‚î¨ micromatch@2.3.8
‚îÇ ‚îÇ ‚îÇ   ‚îú‚îÄ‚îÄ randomatic@1.1.5
‚îÇ ‚îú‚îÄ‚îÄ extglob@0.3.2
‚îÇ ‚îú‚îÄ‚îÄ is-extglob@1.0.0
‚îÇ ‚îú‚îÄ‚îÄ is-glob@2.0.1
‚îÇ   ‚îî‚îÄ‚îÄ is-primitive@2.0.0
‚îú‚îÄ‚îÄ rimraf@2.5.2
‚îÇ ‚îú‚îÄ‚îÄ os-homedir@1.0.1
‚îÇ ‚îú‚îÄ‚î¨ lodash.assign@4.0.9
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ lodash.keys@4.0.7
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ lodash.rest@4.0.3
‚îÇ ‚îÇ   ‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ is-arrayish@0.2.1
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ ‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ ‚îÇ   ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ pinkie@2.0.4
‚îÇ ‚îÇ   ‚îÇ ‚îî‚îÄ‚î¨ strip-bom@2.0.0
‚îÇ ‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ spdx-exceptions@1.0.4
‚îÇ ‚îÇ     ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ ‚îÇ     ‚îî‚îÄ‚î¨ pinkie-promise@2.0.1
‚îî‚îÄ‚î¨ yargs@4.7.1
‚îú‚îÄ‚îÄ camelcase@3.0.0
‚îú‚îÄ‚î¨ cliui@3.2.0
‚îÇ ‚îú‚îÄ‚î¨ strip-ansi@3.0.1
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ ansi-regex@2.0.0
‚îÇ ‚îî‚îÄ‚îÄ wrap-ansi@2.0.0
‚îú‚îÄ‚î¨ lodash.assign@4.0.9
‚îÇ ‚îú‚îÄ‚îÄ lodash.keys@4.0.7
‚îÇ ‚îî‚îÄ‚îÄ lodash.rest@4.0.3
‚îú‚îÄ‚î¨ os-locale@1.4.0
‚îÇ ‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ is-arrayish@0.2.1
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ ‚îÇ ‚îú‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ pinkie@2.0.4
‚îÇ ‚îÇ ‚îî‚îÄ‚î¨ strip-bom@2.0.0
‚îÇ   ‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ is-arrayish@0.2.1
‚îÇ   ‚îÇ ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ   ‚îÇ ‚îú‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ   ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ pinkie@2.0.4
‚îÇ   ‚îÇ ‚îî‚îÄ‚î¨ strip-bom@2.0.0
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ spdx-exceptions@1.0.4
‚îÇ     ‚îú‚îÄ‚îÄ pify@2.3.0
‚îÇ     ‚îî‚îÄ‚î¨ pinkie-promise@2.0.1
‚îÇ ‚îî‚îÄ‚î¨ strip-ansi@3.0.1
‚îÇ   ‚îî‚îÄ‚îÄ ansi-regex@2.0.0
‚îú‚îÄ‚îÄ y18n@3.2.1
‚îî‚îÄ‚îÄ camelcase@2.1.1
@cpojer
"jest": {
Do you think we could extract and create a babel loader that would apply jest automocking and provide some functions around it?
I have seen babel-jest, is that the solution I am looking for?
Ah ok, I am more looking for a way to add smg like "jest-babel" to my babel plugins and while using mocha, be able to mock dependencies jest style.
jest@15.1.1
"jest": {
All files     |Unknown |Unknown |Unknown |Unknown |                           |
Why monkeypatch it? There's plugins for that.
I do have babel-jest installed.
I'm running 'jest' from the terminal.
Thanks for the link, but my error is specific to a ReactJS web app.
Hey cpojer,
Maybe something like `jest --run-and-watch`? This is really confusing coming from other test runners. I thought this was a bug.
Mongoose internally use `Object.create` for creating instances.
Repo with test: https://github.com/nodkz/jest_mocha_mongoose
**Broken jest** test: `npm run test`
[jest output file](https://github.com/nodkz/jest_mocha_mongoose/blob/master/jest-output-err.txt):
jest ‚Ä∫ it should create mongoose model
@danielstern many thanks for the temporary hack!
@danielstern do u have an example of how to save a mongoose connection?
3. just not make sense at all..
"jest": {
Here is my `.bablerc`:
"react-native"
Finally here is the setup-jasmine-env.js file referenced above:
var reporters = require('jasmine-reporters');
jasmine.getEnv().addReporter(junitReporter);
jasmine.VERBOSE = true;
jest.unmock("../../../components/Table/Head")
jest.unmock("../../../components/Table/Body")
jest.unmock("../../../components/Table/Cell/Head")
bar="baz"
exports[`foo`] = `
<Foo
bar="baz"
"jest": {
@cpojer thanks. It works!
Are there some standard configuration to fix this?
https://github.com/astraldragon/riki
:tada:
When I mount a project directory as a network drive (say `W:\`), jest doesn't ignore files in `W:\path_to_libs\` and babel transformation is applied.
I will update the code with the abc rule.
For Growl, I can only give one image. Do you know of a way to figure out if the machine has a retina display - from node?
for, so I had to guess at a few types.
- Is the new Jasmine type appropriate?
TSIA. (Title says it all)
the jest.json content is :
Any idea how to test console output from Jest? RE: It seems that running with `--verbose` solved this for me Thanks @cpojer that worked like a charm!
This issue still exists in the latest release of Jest (as of typing, 14).
üëç  on the non-trivial status; guessed it would be, after our first instinct to try to fix it took us into deeper waters.
D'oh!
I am using versions:
jest 12.1.1
jest.mock('fetch', () => require('fetch-mock');
"jest": {
this is a fresh install of jest 12.1.1
"test": "jest"
"jest": {
"defaultPlatform": "ios",
"ios",
"react-native"
"jest-cli": "^12.1.1"
![rnjest](https://cloud.githubusercontent.com/assets/731608/15760734/df2502ce-2914-11e6-9e8b-7f05228bf456.PNG)
I am having trouble testing Symbols the object never seems to be updating. What am I doing wrong?
Tested with jest@12.1.1
jest.unmock('../foo');
‚óè Runtime Error
- SyntaxError: Unexpected token [
Here's the whole test case: https://github.com/ken210/jest-babel-test
I'm still experiencing this problem in 12.1.1, I'm also using `babel-jest`.
‚óè Runtime Error
What these changes do is add istanbul ignore statements to the transpiled code so that the reported coverage better reflects reality on coverage reports. (Without this, the generated `__extends`, `__assign`, etc statements mess with coverage reports)
- Used regexes
I came across an interesting issue with code coverage failing to create clover.xml and some html files. This seems to happen when an import statement is preceded by 5 or more double slash comment lines and followed by a non-empty line. I haven't been able to figure out the exact rules to reproduce this bug as it also happens with block-quotes spanning more than 12 lines.
versions:
"babel-jest": "12.1.0",
"jest-cli": "12.1.1"
> jest
Using Jest CLI v12.1.1, jasmine2
heredoc> {
heredoc>   "scripts": {
heredoc>     "test": "jest"
heredoc>   }
heredoc> }
heredoc> EOL
heredoc> function sum(a, b) {
heredoc>   return a + b;
heredoc> }
heredoc> module.exports = sum;
heredoc> EOL
heredoc>   it('adds 1 + 2 to equal 3', () => {
heredoc>     const sum = require('../sum');
heredoc>     expect(sum(1, 2)).toBe(3);
heredoc>   });
heredoc> });
heredoc> EOL
> jest
Using Jest CLI v12.1.1, jasmine2
> jest
Using Jest CLI v12.1.1, jasmine2
The default `testRegex` is just `__tests__/.*\.js$` as far as I can tell, so I'm not sure if that could be affecting it..  Maybe something about the crawler that builds the haste map? I didn't try using watchman instead to see what would happen, maybe I can give that a try tomorrow.
‚óè Runtime Error
"jest": {
Wrong config:
"jest": {
"jest": {
I'm not sure if this is best left here or as a react native issue...
- SyntaxError: /Users/bbrock/SpartanSystems/FanfaloClient/app/images/Cat.png: Unexpected character 'ÔøΩ' (1:0)
> 1 | ÔøΩPNG
4 | IHDR-x8ÔøΩsRGBÔøΩÔøΩÔøΩgAMAÔøΩÔøΩ
This is most likely to React Native's use of require for loading images as its not the typical use case in a javascript project. Does anyone have any ideas for a workaround?
PASS  src/baaaaaaaaaar/fooooooooo/__tests__/fooooooooo-smart.js (1.141s)
jestSupport/                           |      100 |      100 |      100 |      100 |                |
src/baaaaaaaaaar/fooooooooo/           |      100 |      100 |      100 |      100 |                |
fooooooooo-smart.js                   |      100 |      100 |      100 |      100 |                |
src/baaaaaaaaaar/fooooooooo/__mocks__/ |    84.62 |        0 |       75 |      100 |                |
react-native.js                       |    42.86 |        0 |        0 |      100 |                |
fooooooooo-duck.js                    |      100 |      100 |      100 |      100 |                |
fooooooooo-dumb.js                    |      100 |      100 |      100 |      100 |                |
*(jestSupport is a temporary fix)
Only way to exclude `__mocks__` is to list **all** files in the project into `collectCoverageOnlyFrom`. But ... This is pretty fatiguing :(
But including `__mocks__` directory in the coverage report - this is a bug, isn't it?
"name": "blablabla",
"babel-jest": "^12.1.0",
"babelify": "^7.3.0",
"gulp-babel": "^6.1.2",
"gulp-insert": "^0.5.0",
"gulp-uglify": "^1.5.3",
"jasmine-reporters": "^2.1.1",
"jest-cli": "^12.1.1"
"jest": {
> jest
blablabla/                 |      100 |      100 |      100 |      100 |                |
blablabla/src/             |    86.67 |    68.18 |    78.57 |    90.32 |                |
Iterator.js               |    93.75 |     87.5 |     87.5 |    95.24 |             30 |
blablabla/src/__mocks__/   |      100 |      100 |      100 |      100 |                |
Well at least you know your mocks are being used
@StephanBijzitter problem is, huge mocks are partially covered ---> this harms overall coverage
I don't mind write special tests for mocks coverage üòÜ
For an example of a package that will fail when executed in a jest context, see `krakenjs/confit`:
I know this sounds contrived but it's a real issue with testing modules that export higher order functions with Jest.
jest
"jest": {
"jsx"
const babelJest = require('babel-jest');
return babelJest.process(src, filename);
Can anybody remove this warning?
Should the files in mocksPattern be excluded from coverage?
@cpojer I'd love to, but this is my first contact with this project, and at first blush the Windows support issue seems like a pretty deep one. For instance, I see that `runTests.js` isn't even supported on Windows. That makes it kinda tough to get started. :smile:
However, in a jest test, under Node 6+, it causes a runtime error:
‚óè Runtime Error
It might be worth looking at [callsites](https://github.com/sindresorhus/callsites), which does some funky things with error stacktraces.
"jest": {
"jest": {
It is unexpected that the path to the project would affect which tests are ignored.
> jest
optimist is old, yargs is new.
This is an RFC because we run Jest in a bunch of places and not all will have access to yargs.
jest --silent --invalid foo
jest --silent filter
- The special `_` value which holds all non-option arguments.
@cpojer let me know your thoughts about that? Maybe there's a better way for it? :)
(note by @cpojer: @bypass-lint)
No worries! Thanks for giving us Jest :D
I might be talking absolute nonsense, but I think there might still be a bit of ambiguity in the docs.
> jest
@tomkur How do you actually configure `node-haste` to resolve to something different than `node_modules`?
@nthtran I don't. It just works out of the box. Under root directory of my project I have a subfolder with package.json and that's all. I am not yet sure if this is intentional behavior and whether it is a good practice to nest projects this way, but it works for me...
we moved it to `jest-jasmine1` && `jest-jasmine2`.
expect(item).toEqual(jasmine.anything())
"jest": {
"jest": {
"jest": {
I'm confused by some inconsistency in the docs here: https://facebook.github.io/jest/docs/api.html
Here's a small reproduction of a bug I'm seeing. Not sure it belongs here, but it may!
os - ubuntu 14.04 (64)
jest - v0.10.2
jest.unmock('canvas');
Aborted (core dumped)
Hi folks, I was trying to setup the jest for my project.
> jest
‚óè Runtime Error
Yeah... that's weird to set the `moduleFileExtensions` to json. Seems the runnable demo from `enzyme` set this to json by default. : (
jest.runAllTimers();
jest.runAllTimers();
Using Jest CLI v0.10.2, jasmine1, babel-jesta
@cpojer is `--root-relative` something fb internal?
`hg status --root-relative` works a little differently than just `hg status`
For example, I'm wildcard importing actions like so:
I have a similar issue but the situation is quite "strange" to me...
`Env`:
BABEL_ENV=development
"jest": {
"<rootDir>/tests/miscJest"
`.babelrc`:
"rewire"
expect(Toasts(undefined, {})).toEqual([]);
`.babelrc.jest`:
"rewire"
@tracker1, you just saved me! üòÑ
Sandeep
- jest-cli v12.0.2
ActionBar.js                                       |      100 |     87.5 |      100 |      100 |                |
Branch is here:
@cpojer Can I ask why this was closed? My team recently had to turn off coverage requirements in our CI because of process-out-of-memory exceptions. We have a lot of Jest tests :)
![screen shot 2016-05-11 at 4 08 39 pm](https://cloud.githubusercontent.com/assets/570070/15194776/af222dce-1792-11e6-8f21-9f695a675794.png)
Just realized there is a `coverageReporters` config option which is ultimately what I actually needed. Just going to use that for the time being.
Ping @cpojer
Why it works? Is it a bug in Jest?
Thank you for the interesting mark. I was just basing on the example from Enzyme:
‚óè Runtime Error
`"jest-cli": "^12.0.2"`
"jest": {
"jsx",
from `.babelrc`:
"es2015"
jest-cli ^12.0.2
.get('/api')
"jest": {
ModuleB
#foo
SomeClass
#bar
‚úì it should return "foobar"
SomeOtherClass
#bar
‚úì it should return "foobar"
ModuleA
#foo
SomeClass.js      |      100 |      100 |      100 |      100 |                |
SomeOtherClass.js |      100 |      100 |      100 |      100 |                |
Solved with a flag `--runInBand`, passed to jest.
"jest": {
jest-cli ^12.0.2
.get('/api')
"jest": {
@cpojer  Have you reopened? It still says closed.
@cpojer Any updates?
"name": "jest-restify-supertest",
"test": "jest"
"jest-cli": "^12.0.2",
"jest": {
jest.disableAutomock();
res.status(200).json({ name: 'tobi' });
> jest
‚óè Runtime Error
"jest": {
Thanks for the feedback @cpojer! I've addressed all your comments, please let me know if you'd like me to squash my commits.
This error pops up when running jest with or without coverage.
Security context: 0x2374abbe3ac1 <JS Object>
I tried jest@12, jest@11, jest@0.9
Aborted (core dumped)
React-native v0.24, jest v12
@cpojer   Take the following test:
jest.dontMock('../Tracker');
pakage.json includes:
"jest": {
"jest-cli": "^12.0.2",
"babel-jest": "^12.0.2",
@cpojer thanks for the tips.
Thanks @cpojer
"jest": {
"jsx"
"jest": {
"defaultPlatform": "ios",
"ios",
"react-native"
@cpojer thoughts?
Since modules are strict by default its a bit odd. super tiny nit.
import _ from 'lodash';
My jest config looks like this:
"jest": {
at Error (native)
**Jest versions**: 11.0.2, 12.0.2
at TypeError (native)
verbose: false,
@cpojer can you double check all the dependencies + lerna stuff?
Trying to get started with jest and getting this error. Any help?
saiko: ~/code/tsi-mattress-match $ jest __tests__/tmp-test.js
at Error (native)
sometimes it's really convenient to specify multiple patterns, e.g.
hey @skawian! thank you for the PR.
export function baz() {...}
@cpojer
``` es6
@cpojer -
I'm new to Jest and I'm struggling with a similar problem. I'm using [axios](https://github.com/mzabriskie/axios), which under the hood uses `XMLHttpRequest`, and I do not want to mock `axios`, but to mock the actual `XMLHttpRequest`. It seems that I would have to implement its methods by myself, something like [this](http://stackoverflow.com/a/33527729/916450). Is this the right approach?
How would you do that with ES2015?
```javascript
// myModyle.js
// how do I mock foo here so this test passes?
```javascript
` @ainesophaur, not sure what I am doing wrong here. But it seems it doesn't work
I am currently on jest 18.1 (and create-react-app 0.9.4)
```javascript
```javascript
```javascript
```javascript
```javascript
...original,
.get('/api/merchant/me/stores')
thanks for sharing @ainesophaur. I still can't get it to work with jest 18.1. Here are my codes:
```javascript
...original,
```javascript
```javascript
```javascript
that used jest but I remember this problem well and I remember eventually
> It could be a problem with jest transpiling these codes ....
@sorahn same issue. `es6` + `babel` , How to mock?
```ts
return 'novaline';
```ts
...original,
genName: jest.fn(() => 'emilie')
expect(moduleA.genName(1)).toBe('emilie');
expect(moduleA.getMessage(1)).toBe('Her name is emilie');
```bash
"Her name is emilie"
"Her name is novaline"
Test Suites: 1 failed, 1 total
>     genName: jest.fn(() => 'emilie')
>     expect(moduleA.getMessage(1)).toBe('Her name is emilie');
>   mock function
I tested Jest with Node v6.0.0-nightly201604207dc1a87a7b.
I'm not sure if it's Node's error, it's a nightly build after all, or Jest's error.
Hey @cpojer, yeah I was just putting the comment here for anyone Googling for jest + the error message as we stumbled upon upgrading as a fix by luck.
Instead of diff it shows error:
jest -v
I get the following error upon running jest
Seems like ReactDOM.findDOMNode is returning undefined for the checkboxNode which results in the test failing. What could be wrong?
Seems like this was an old jest.autoMockOff hoisting issue.
I have migrated Jest from 0.8.2 to 0.10.2. I have fixed the small issues I had, except for one.
Pascale
agree... Returning a promise from it was a very cool and very dangerous things in mocha that resulted in a bunch of false green.
[null, undefined, 1, .1, true, 'a', {}, [], NaN, Infinity, -Infinity].forEach(value => {
Regexes are very hard to get right when you're setting up a new project, especially when they're inside a `.json` file.
regex config can also be preserved, e.g.:
"jest": {
"jest": {
But, in `jest-config`, `npm run test` is broken ie fails with syntax error in `master`. Have I missed a step here? @pksjce `glob-to-regexp` doesn't work correctly and should be not used. No one want poor partially (e.g. compared to AVA) glob ‚Äî [minimatch](https://github.com/isaacs/minimatch) syntax should be supported, especially including ignore support `!`. @develar , @cpojer - Thanks for the quick response.
PS Sorry, I currently don't have time to prepare PR, but at least can advice :) Are there any opinions on using `micromatch`? It claims to be much faster than `minimatch`. I haven't used either. Ah, I now see that both `minimatch` and `multimatch` are already present in the repo. @pugnascotia I don't have objections, personally I use `minimatch` due to historical reasons. Probably `micromatch` since project has tests and it is passed (and npm download count indicates that package is pretty good). Maybe it worth to try to use it. @develar Do we really want to deprecate `testPathIgnorePatterns` completely? I suspect it will make the default `testGlob` value quite complex if we want to keep ignoring `node_modules` by default. > the default testGlob value quite complex if we want to keep ignoring node_modules by default
"jest": {
@cpojer added some tests
Ciaran
if @cliedeman doesn't have time for this, I could take a stab at putting together the docs. Thanks for the clarification on the setup. Testing RN apps could use a lot more documentation.
For the record: this issue still happens on Jest v13.2.3  with react-native 0.29.0
It seems like Jest tries to mock `react-native-animatable` because `Easing` appears as `undefined` when trying to get `linear` property.
(It worked in Jest 9)
error:
"jest": {
"fbjs"
"babel-core": "^6.4.5",
"babel-jest": "^11.0.2",
"jest-cli": "^11.0.2",
I've been struggling to make Jest work with my react-native project for some days.
"jest": {
"^[./a-zA-Z0-9$_-]+\\.png$": "RelativeImageStub"
"fbjs"
"babel-core": "^6.4.5",
"babel-jest": "^9.0.3",
"jest-cli": "^0.9.2",
.babelrc
"presets": ["react-native"]
error
- SyntaxError: Unexpected token ILLEGAL in file 'src/img/gender_male.png'.
ÔøΩPNG
IHDR>sÔøΩÔøΩDgAMAÔøΩÔøΩ
ÔøΩpÔøΩeÔøΩ„¢•ÔøΩ[ÔøΩ-pÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ=ÔøΩÔøΩÔøΩSÔøΩÔøΩ"J,oÔøΩybIENDÔøΩB`ÔøΩ
Im Having this issue with jest-cli 12.0.2.
The specific error is this: Error: Line 1: Unexpected token ILLEGAL
Error: Line 1: Unexpected token ILLEGAL
"name": "BASalesTracker",
"jest": {
"fbjs"
"babel-jest": "^12.1.0",
"jest-cli": "^12.1.1",
jest.dontMock('../provideImgPath');
const result = provideImgPath('hamburgermenu');
"^[@./a-zA-Z0-9$_-]+\\.(png|gif)$": "RelativeImageStub"
@cpojer Thanks!
Output with Jest
undefined
https://github.com/gedkins/jest-bugs.git
jest-bug-2
https://github.com/gedkins/jest-bugs.git
jest-bug-1
- Then we run jest
- hence we end up with the mock version of b/helper.js
@cpojer Yep. Oops!
``` es6
``` es6
I've also create a lightweight [C9 project](https://ide.c9.io/enoahnetzach/es6-test) to showcase this.
Unexpected Error: spawn ENOTDIR
Error: spawn ENOTDIR
Is this a bug, or am I doing something wrong? Thanks.
2. Run `jest -o`
$ jest -o
Error: spawn ENOTDIR
`jest --watch` didn't run any test, each time it detect change, it only print
So running `jest --watch` will throw the ever cryptic `Error: spawn hg ENOENT`.
Thanks @cpojer
just some random 3 space indentation
Jest doesn't always mock things correctly. Something around `getters` and `setters` aren't mocked appropriately, and some other goofy scenarios.
"jest-cli": "^11.0.1"
node_modules/.bin/jest
Get error:
‚óè Runtime Error
Any ideas what could be wrong? This might be related to https://github.com/facebook/jest/issues/894, but I'm not sure.
https://github.com/abalhier/SampleJestTest
"lodash": "4.6.1"
describe('lodash', () => {
> jest
FAIL  js/__tests__/lodash-test.js (0.074s)
I've switched to Jest 12, it seems to fix the problem both in the showcase and on our project!
What was our case for multiple roots? Do we really need that?
‚îú‚îÄ‚îÄ lib
"jest": {
/* eslint-env jest */
@cpojer
@cpojer I sign at https://code.facebook.com/cla
Hi @cpojer,
window.location.href = 'http://quux.default.com'
'access_token': '1234foo',
window.location.assign = jest.fn();
pathname: '/wubbalubbadubdub',
@cpojer what about implementing some proxy method to `jsdom.changeURL()` in Jest?  @thymikee I saw that issue but thought that the proposition was rejected.
@cpojer I misread your example and mixed it up with other related to this problem, where people suggested to use `Object.defineProperty(window, 'location', {value: 'url'});`. Thank you!
```javascript
alternatively we can:
1. Shallow clone, which will be less expensive
2. Generate string messages at the time of failure/use jasmine pregenerated mesasges. (requires change in our reporter)
added `jasmine.util.clone`
Using jest `0.10.2`
"jest": {
const babelJest = require('babel-jest');
src = babelJest.process(src, filename);
// other dependencies
This is likely a `jasmine` issue but just making sure `jest` isn't doing something to cause this:
Jasmine 1 Results:
Jasmine 2 Results:
I think it's a bug in `jest-jasmine1` runner
jest.mock('../abc');
describe('jasmine1', function() {
abc.fn(123);
expect(abc.fn).toBeCalledWith(function() {}); // passes on jasmine 1
specifically `b[index] !== 'function'`
i'm not sure what it does though
`npm unpublish` is dangerous...
Jest will blow up with
Object
Great bug report, @tals! I was banging my head against this, and didn't realize that it's got to do with Jest mocking: https://github.com/coopy/esmodule-dupe-definition/
// src/dog.js
...jest.genMockFromModule('../dog')
using Jest CLI v13.2.3, jasmine2, babel-jest
@Fandekasp What version of Babel do you use?
I'm using babel@5.8.38 and babel-jest@13.2.2
Yes, maybe thats the reason. I use babel@6.5.2 and babel-jest@12.1.0.
webApi,
{ domain: undefined,
Preprocessor: jest-preprocessor.js.
**jest setup:**
"jest": {
"jest": {
__SassStub.js__
```  **Reproduced in**: https://github.com/joeapearson/jest-mongoose
const mongoose = require('mongoose');
mongoose.connect('mongodb://127.0.0.1:27017/test');
let db = mongoose.connection;
> jest
I've experimented with disabling Jest's automock feature and various arrangements of the mongoose connect code.  I imagine I'm doing something stupid but I can't see what I'm doing wrongly.
- jest 0.10.0
- mongoose 4.4.11
cb(null, 'Bar');
cb(new Error('FooBar!'));
Like mocha`s:
Nyan
TAP
"jest": {
jasmine.getEnv().addReporter(reporter);  // add your reporter
jasmine.getEnv().addReporter = () => {}; // prevent Jest from adding their reporter
> jest
‚óè Runtime Error
"test": "jest"
"rnpm": {
"ios": {
"jest": {
"babel-jest": "*",
"jest-cli": "*",
and .babelrc is like
"presets": ["react-native"]
thanks @cpojer
"babel-jest": "^9.0.1",
"jest-cli": "^0.10.0"
"babel": {
"jest": {
"node_modules/baobab",
"node_modules/baobab-react/decorators",
"node_modules/paqmind.data-lens",
Why is Jest taking into account if files are committed or not? I'm just curious because that doesn't seem like sane behavior to me; if a _test_ file exists I would expect Jest to use it.
and also error:
Am I missing something obvious here? I know there are some issues with Jest and Stateless components, but I would think that there must be a solution or at least a workaround for this scenario.
Hi @cpojer . Thank you very much for the reply.
Give me more time in the day and I will do everything including figure out how to upgrade the magic jasmine1 stuff Sebastian wrote to jasmine2.
Does the jasmine2 reporter print out the skipped information?
Does it involve leaning on tools such as [Karma](https://github.com/karma-runner/karma), [browser-run](https://github.com/juliangruber/browser-run), or [zuul](https://github.com/defunctzombie/zuul)?
i need to spend more time consolidating my thoughts (just typing this up quickly on my phone) but I think the big bits that would be needed in jest is pluggable environments (jsdom, browser) and an environment agnostic runtime/runner. I suppose similar to karma s launchers but maybe less generic  @jquense I don't want to run the risk of repeating you too much but I wanted to share some thoughts too.
let foo
if (jest.mocking('./foo')) {
NVM
‚òùÔ∏è I'm not too familiar with Jasmine script contexts (if I have that right). Is there a way to get the string content for the test? While running Jest in an electron shell is an interesting project, I think it only solves part of the issue for real world developers. While a CLI runner or an electron environment is great for our developer workflow, we have also found many issues over the years by running our unit tests in real browsers (especially older browsers) that we didn't find in those CLI environments or Chrome alone.  I think we still need a way to run Jest in real browsers, even if the electron environment is successful (and I hope it is!). I completely agree. As someone less familiar with Jest internals, I found Electron to be an attractive target. Electron _just works_, and opens up a lot of possibilities, such as recording test sessions and stepping through browser behavior using a debugger. Still, I don't want to express neglect for real browsers with that enthusiasm.
"jest": {
``` md
I almost ditched my own processor in favor of babel-jest with a babelrc. But it seems there are still some bugs with babel figuring out node_module nested .babelrc files. I've found that If I pass exactly what I want into `babel.transform` it doesn't have the issues with the nested .babelrc's. And I only imagine those things could keep popping up. I see why you'd want to remove it. It has less and less purpose. But it seems like it could serve better as an undocumented feature for special cases.
Here some information about the system:
"babel": "^6.5.1",
"babel-cli": "^6.5.1",
"babel-core": "^6.5.1",
"babel-eslint": "^6.0.0",
"babel-jest": "^9.0.3",
"babel-register": "^6.7.2",
"jest-cli": "^0.9.2",
The reason for this bug is definitively the usage of ES6 module syntax (import/export). When using cjs module everything is fine. The question is, if that's related to jest or istanbul. It's not really important for my project, it's just a hint :)
# Modified component
Thank you for react and for jest!
jest --watchExtensions js,es6 --watch
"babel-core": "^6.7.2",
"babel-jest": "^9.0.3",
"jest-cli": "^0.9.2"
"jest": {
"babel": {
Stephans-MacBook-Pro:<redacted> stephanbijzitter$
@cpojer - correct
https://github.com/Hubrus/jestSandbox
@Hubrus do you have a different environment?
@swanson Windows 8.1 Enterprise. Updated to `jest-cli@0.10.0` but the problem still persists for me in both windows' command prompt and git bash.
@cpojer You guys really need to get something like AppVeyor running.
@cpojer I can surely take a look if you point me in the right direction :-)
Comes from #796
edit by @cpojer:
Thank you! I'm happy to have an opportunity to give something back to the community. Also you make the contributing experience really great!
@cpojer done
@cpojer Will be done tomorrow üëç
Edit: small delay due to alcohol
``` es6
return 'dur';
``` es6
it('should return "dur"', () => {
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Ob2RlRmlsZVBhcnNlci5lczYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7SUFBTTs7OztrQkFJUyIsImZpbGUiOiJOb2RlRmlsZVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIE5vZGVGaWxlUGFyc2VyIHtcblxufVxuXG5leHBvcnQgZGVmYXVsdCBOb2RlRmlsZVBhcnNlcjtcbiJdfQ==
"test": "jest --no-cache --bail --verbose"
"babel-jest": "^9.0.3",
"jest-cli": "^0.9.2"
"jest": {
"babel": {
return 'dur'; //1x
There are a couple of problems.
That's quite ingenious
I do agree with @cpojer that Babel should handle this better. I'll create an issue there and link to this one for reference. Perhaps babel-jest?
Is https://github.com/jmcriffey/babel-istanbul relevant to this discussion?
- First remove all jest packages from your repo / clean install npm modules:
install `jest@test` and `babel-jest@test`
"jest": {
"coverageCollector": "jest-babel-istanbul",
in .babelrc:
with Jest 0.9.2 this is the result
Jest fails with "SyntaxError: Unexpected identifier". I suspect this is because of some special case treatment for console.error (and similar methods), which doesn't expect them to be handled like functions.
~/testing master* ‡øò  jest
~/testing ‡øò  jest
~/testing ‡øò  jest --no-watchman
@cpojer yup! that makes sense!
npm install --save-dev babel-jest babel-polyfill
‚óè Runtime Error
TypeError: jasmine.JUnitXmlReporter is not a function
jasmine
require('jasmine-reporters')
Thanks for the solution, @AwesomeJerry. But it seems to be a very quirky one. I hope that underlying issue would be fixed soon and we would be able to get rid of this hack.
Phew, babel api is huge! Played a bit with astexplorer and made this draft: http://astexplorer.net/#/lzspEwJ7jn
Hey Jests (:
at stack (..\vendor\jasmine\jasmine-2.3.4.js:1484:17)
at Expectation.addExpectationResult (..\vendor\jasmine\jasmine-2.3.4.js:535:21)
at Expectation.toEqual (..\vendor\jasmine\jasmine-2.3.4.js:1408:12)
at attemptSync (..\vendor\jasmine\jasmine-2.3.4.js:1791:24)
at QueueRunner.run (..\vendor\jasmine\jasmine-2.3.4.js:1779:9)
at stack (..\vendor\jasmine\jasmine-2.3.4.js:1484:17)
at Expectation.addExpectationResult (..\vendor\jasmine\jasmine-2.3.4.js:535:21)
at Expectation.toEqual (..\vendor\jasmine\jasmine-2.3.4.js:1408:12)
at attemptSync (..\vendor\jasmine\jasmine-2.3.4.js:1791:24)
at QueueRunner.run (..\vendor\jasmine\jasmine-2.3.4.js:1779:9)
at stack (..\vendor\jasmine\jasmine-2.3.4.js:1484:17)
at Expectation.addExpectationResult (..\vendor\jasmine\jasmine-2.3.4.js:535:21)
at Expectation.toEqual (..\vendor\jasmine\jasmine-2.3.4.js:1408:12)
at attemptSync (..\vendor\jasmine\jasmine-2.3.4.js:1791:24)
at QueueRunner.run (..\vendor\jasmine\jasmine-2.3.4.js:1779:9)
‚óè utils-normalizeConfig ‚Ä∫ babel-jest ‚Ä∫ it correctly identifies react-native
at stack (..\vendor\jasmine\jasmine-2.3.4.js:1484:17)
at Expectation.addExpectationResult (..\vendor\jasmine\jasmine-2.3.4.js:535:21)
at Expectation.toEqual (..\vendor\jasmine\jasmine-2.3.4.js:1408:12)
at attemptSync (..\vendor\jasmine\jasmine-2.3.4.js:1791:24)
at QueueRunner.run (..\vendor\jasmine\jasmine-2.3.4.js:1779:9)
npm WARN optional Skipping failed optional dependency /chokidar/fsevents:
npm ERR!
npm ERR!     C:\Users\sangw\Documents\Work\jest\npm-debug.log
‚îú‚îÄ‚îÄ archy@1.0.0
‚îú‚îÄ‚îÄ tildify@1.1.2 (os-homedir@1.0.1)
‚îú‚îÄ‚îÄ semver@4.3.6
‚îú‚îÄ‚îÄ htmlescape@1.1.0
‚îú‚îÄ‚îÄ duplexer2@0.1.4
‚îú‚îÄ‚îÄ isarray@0.0.1
‚îú‚îÄ‚îÄ punycode@1.4.0
‚îú‚îÄ‚îÄ syntax-error@1.1.5 (acorn@2.7.0)
‚îú‚îÄ‚îÄ crypto-browserify@3.11.0 (create-hmac@1.1.4, randombytes@2.0.3, pbkdf2@3.0.4, create-hash@1.1.2, browserify-cipher@1.0.0, create-ecdh@4.0.0, diffie-hellman@5.0.2, public-encrypt@4.0.0, browserify-sign@4.0.0)
‚îú‚îÄ‚îÄ worker-farm@1.3.1 (xtend@4.0.1, errno@0.1.4)
‚îî‚îÄ‚îÄ istanbul@0.4.2 (abbrev@1.0.7, nopt@3.0.6, wordwrap@1.0.0, once@1.3.3, supports-color@3.1.2, async@1.5.2, esprima@2.7.2, fileset@0.2.1, js-yaml@3.5.4, escodegen@1.7.1, handlebars@4.0.5)
‚îú‚îÄ‚îÄ babel-regenerator-runtime@6.5.0
‚îú‚îÄ‚îÄ babel-plugin-transform-es2015-unicode-regex@6.5.0 (regexpu-core@1.0.0, babel-helper-regex@6.6.5, babel-runtime@5.8.35)
> jest
npm ERR! not ok code 0
toyBox.deprecate('foo', 'bar');
toyBox.fetch('foo');
> jest
This can not work for Jasmine1 because it does not output the tasks with any form of pending information.
These functions are what make it impossible to get to 100 coverage in istanbul, since istanbul is looking at the compiled JavaScript instead of the source es2015 code. It's possible to tell babel to utilize `babel-runtime` instead, replacing the above functions with calls to require:
/*istanbul ignore next*/
An alternative route to get to 100 coverage (which is the whole point of this) could be to make the code coverage tool pluggable like the test runner so that we could use isparta instead of istanbul.
Jasmine displays at the bottom 3 specs, 0 failures, 2 pending:
> jest
at Error (native)
Oddly enough, `jest -o` doesn't work either. Now I'm wondering if something is hosed on my Mac regarding file watching.
https://github.com/ffxsam/jest-issue
@cpojer I'm using 0.9.2 and watch is not working for me either.
> jest
Will do. Noticed 0.9.0 auto included babel-jest, great feature setting up pre processor felt ugly.
"babel-jest": "*",
"jest-cli": "*"
"test": "jest"
> jest
Duplicate module name: acorn
"jest": {
"acorn"
I'm not sure what the side effects of this are however.
The side effects are the following:
"babel-jest": "*",
"jest-cli": "*"
"test": "jest"
"acorn",
"isarray",
"esprima",
And yes that list just keeps growing ....
>     "babel-jest": "_",
>     "jest-cli": "_"
>         "acorn",
"babel-jest": "*",
"jest-cli": "*"
"test": "jest"
"acorn",
"isarray",
"esprima",
"lru-cache",
"punycode",
"strip-bom",
"babel-jest": "*",
"jest-cli": "*"
"test": "jest"
"acorn",
"isarray",
"esprima",
"lru-cache",
"punycode",
"strip-bom",
"babel-core",
"babel-template",
"babel-types",
"babel-helper-replace-supers",
"babel-helper-regex",
"lodash.template",
"escodegen",
"sha.js",
"browserify-rsa",
"pify",
Very good :+1:   Seems the Babel-Jest Project hasn't been touched in 4 months so Ill post this issue here.
Consider the following code:
import ToyBox from '../src/toy_box/toy_box.js';
expect(ToyBox.container.length).toEqual(1);
"babel": "^6.1.18",
"babel-core": "^6.2.1",
"babel-jest": "^6.0.1",
"isarray": "0.0.1",
"jest-cli": "^0.8.2",
"lodash": "^3.10.1",
"test": "jest"
"jest": {
And the .babel-rc
> jest
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
Not sure how import is an unexpected token, also if you notice, babel-jest isnt being used in the compile step: `Using Jest CLI v0.8.2, jasmine1`
‚óè Runtime Error
How is import not a thing, also why isnt `babel-jest` being used?
- ReferenceError: _cool is not defined
"test": "jest"
"jest": {
"lodash": "^4.6.1",
"redux-saga": "^0.9.3",
"babel-jest": "^9.0.0",
"jest-cli": "^0.9.0"
Wrap-up for other people who want to use it with react-native:
"test": "jest"
"jest": {
"babel-jest": "^9.0.0",
"jest-cli": "^0.9.0"
@cpojer I got another problem or maybe I misunderstand some concepts here (new to unit tests...)
‚óè Runtime Error
@cpojer I'm not sure what I'm doing wrong, I installed .babelrc again with the presets and --no-cache, but it didn't solve my problem :(
@cpojer here is my repo:
https://github.com/ms88privat/react-native-jest-test
@cpojer thanks for the quick turn around against @ms88privat problem, I downloaded her repo and upgraded `babel-jest` to be `9.0.2` but I get a:
‚óè Runtime Error
edit: sorry if ms88privat is not female.
@cpojer +1 for those would-be-uber-helpful docs.
Apologies if I've overlooked the answer but was there a solution to this @nitsujri?
"test": "jest --no-cache --verbose"
"redux-thunk": "^1.0.3"
"babel-jest": "^9.0.3",
"jest-cli": "^0.9.2",
"babel": {
"react-native"
"jest": {
"lodash",
@cpojer I followed what you mentioned above and notice that the jest setup is similar in the f8app repo. It fixes my `TypeError: CallbackQueue.getPooled is not a function` but now I just get `TypeError: Cannot read property 'process' of undefined
"jest": {
.babelrc
"es2015"
x is undefined where as if I do:
My .babelrc is:
I have installed babel-jest, babel-polyfill, jest etc...
Appreciate any help or suggestions, can provide more details Same problem here.., my babelrc is exactly the same
"react-hot-loader/babel"
"babel-jest": "^18.0.0",
"jest": "^18.1.0"
**.babelrc**
"presets": [ "es2015", "react" , "stage-0" ]
jest version = 19.0.2
test framework = jasmine2
"roots": [
Test Suites: 1 failed, 1 total
"jest": {
jest version = 19.0.2
test framework = jasmine2
"roots": [
Test Suites: 1 failed, 1 total
SyntaxError: Unexpected token <
along with jest in package.json
Test Suites: 1 failed, 1 total
and now getting the error
jest
Test Suites: 1 failed, 1 total
import { expect } from 'chai';
it('renders joey', () => {
jest
Test Suites: 1 failed, 1 total
jest --debug
jest version = 19.0.2
test framework = jasmine2
"roots": [
Test Suites: 1 failed, 1 total
Test Suites: 1 failed, 1 total
import { expect } from 'chai';
it('renders joey', () => {
"jest": {
import { expect } from 'chai';
it('renders joey', () => {
Thanks @cpojer !~
"jest": "^19.0.2",
`.babelrc`
And when running `jest` it returns the following error:
SyntaxError: <path_to_image>/app/assets/images/react-native-logo.png: Unexpected character 'ÔøΩ' (1:0)
> 1 | ÔøΩPNG
at Parser.<anonymous> (node_modules/babylon/index.js:4403:20)
"test": "jest"
"jest": {
@nimatra I reopened the issue: #829
jest.dontMock('../model');
jest.dontMock('../stream');
Using Jest CLI v0.8.2, jasmine1
race: [Function],
"apsl-react-native-button": "git+https://git@github.com/bartonhammond/react-native-button.git",
"react-native-gifted-spinner": "0.0.3",
"redux-saga": "^0.9.1",
"redux-thunk": "^1.0.3",
"tcomb-form-native": "^0.3.3",
"babel-core": "^6.4.5",
"babel-jest": "^6.0.1",
"istanbul": "^0.4.2",
"jest-cli": "^0.8.2",
I'm using react-native and facebook/react-native#6104 might be the issue I'm running into.
@cpojer  Its cool, im try to learn jest these days. When will the new docs release?
foobar-test.js               |      100 |      100 |      100 |      100 |                |
foo-bar.js                   |      100 |     91.3 |      100 |      100 |                |
fo-obar.js                   |      100 |      100 |      100 |      100 |                |
fo-obar-test.js              |      100 |      100 |      100 |      100 |                |
:tada: :+1:
@cpojer It works thanks a lot!
@cpojer updated
Contents of our jest config file below
@cpojer I'm also noticing some weirdness between 0.8.2 and 0.9.0 and autoMock/dontMock/unmock.
describe('foo', function () {
‚óè foo ‚Ä∫ it should
For example this test, fails in 0.8.2 jasmine1, for the reason that FILE is mocked, since we didn't call `jest.dontMock(FILE)`...but this passes in 0.9.0.  Is that expected?
'token in the source'
Yeah, that was with `"testRunner": "jasmine1"` set in `.jestrc`.  I was having the same problem even in tests where the requires look like `require('./foo')`.  Test doesn't hang or anything.
Hey @cpojer
12:38 $ BABEL_JEST_STAGE=0 ./node_modules/.bin/jest --useStderr
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
SyntaxError: Unexpected reserved word
**UPD:** Thanks for the tip with `jest-cli@next` (-500ms) :wink:
Hi @cpojer!
‚óè Runtime Error
## TypeError, jasmine 1
jest
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
## TypeError, jasmine 2
‚óè Runtime Error
## TypeError, jasmine 1, verbose
jest --verbose
Using Jest CLI v0.8.2, jasmine1
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
@cpojer added!
-rw-r--r--  1 rudoy  staff   423B Feb 19 12:23 046f5d28f6f3af6548c0f53e5c93ebc6
-rw-r--r--  1 rudoy  staff    80B Feb 19 12:23 perf-cache-undefined
-rw-r--r--    1 rudoy  staff   505B Feb 19 12:24 046f5d28f6f3af6548c0f53e5c93ebc6
-rw-r--r--    1 rudoy  staff    80B Feb 19 12:24 perf-cache-undefined
But, this issue seems to be actual:
@cpojer reopen pls
@cpojer
4. changes the tests to make use of these new locations.
Hah, I've been having to do monkey patching of my own internally... I feel your pain.
Sent via mobile. Please excuse brevity / typos.
"jest": {
"jest": {
mocking arrays is also broken, they come out empty with jest
`import _ from "lodash";
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
When trying to set custom matcher with `jasmine2` I'm getting error:
it's because in jasmine2 `addMatchers` is defined on `jasmine` object, not particular spec.
http://jasmine.github.io/2.0/upgrading.html
Jest line that should be changed:
Current workaround is to directly call `jasmine.addMatchers()` instead of `jest.addMatchers()`.
Note that matcher format is also changed from jasmine1 to 2.
"test": "jest"
"babelify": "^7.2.0",
"jest-cli": "^0.8.2"
I think a Jest user can easily be in this situation:
Need other special config ? I have set `"verbose": true` in `package.json` to jest.
- it takes more time as react-native is installed
@cpojer it would be great! thanks!
NativeModules,
} from "react-native";
This is a weird issue, and I'm not really sure where the fault is. It could be in jest, babel-jest, gulp-util. Not entirely sure, but i'd appreciate help trying to figure out where the issue is so we can properly get this fixed.
gulp-util
L has-ansi
My gut instinct tells me that the automocking is failing to mock something properly. I think it is with that the export from `has-ansi` is a function, and a package is trying to access a property of that function.
at Object.eval (/Users/blaine.kasten/Sites/jest-error/node_modules/has-ansi/index.js:3:32)
Here is the contents of `has-ansi/index.js`
var ansiRegex = require('ansi-regex');
And here is the contents of `ansi-regex`
2. `npm i`
jasmine1 runner
jasmine2 runner
@cpojer thanks for information!
But it does not work now with jasmine2!
2. `npm run jasmine2`
@cpojer thanks for explanation!
I have extracted the metadata that makes Jest fail in this case. It's form the [loglevel](https://github.com/pimterry/loglevel/blob/1.4.0/lib/loglevel.js) package. I don't understand why and how the multiple bound metadata is generated from that. So I couldn't produce a minimal object that would result in such metadata.
ActionTypes: keyMirror({
Using Jest CLI v0.8.2, jasmine1
> This is a peculiarity of console.log, but it works correctly.
When trying to run the following in jest
foo-test.js
jest config in package.json
"jest": {
‚óè Runtime Error
but it will be awesome if we could get a real fix.
@cpojer I'm sorry, I didn't intent to make a PR to the jest repository directly but to a forked one.
"test": "jest"
"lodash": "4.0.0",
"babel-eslint": "5.0.0-beta6",
"jest-cli": "0.8.2"
"jest": {
Here's a very shady problem I've been fighting with for a couple of weeks, approaching it from different angles and all efforts hadn't been leading to any results for quite a long time. Today is a happy day for me since I get to know what causes the problem and its roots, but still believe that this is kind of an odd behaviour for Jest, that's why I decided to share it here to get your suggestions.
Errors I'm getting are the following:
Invariant Violation: Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received [object Object]. Read more: http://gaearon.github.io/react-dnd/docs-drop-target.html
jest v0.8.1
cd jest-babel-react-hello-world/
> jest
‚óè Runtime Error
SyntaxError: Unexpected token ...
‚óè Runtime Error
SyntaxError: Unexpected token ...
Yeah it does not really solve the main issue with babel-jest and jest. Seems like I can only get really basic modules testable that have no dependencies.
> Yeah this sucks and was a change in babel 6 that I didn't anticipate. There are a number of ways to fix it and I haven't settled on one yet.
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
SyntaxError: Unexpected reserved word
I see Jest is using istanbul for code coverage.
https://github.com/gotwarlost/istanbul
And istanbul supports check-coverage command.
Does jest support this command? Or is there any walk around can support check code coverage?
Current walk around for me is to install istanbul and run :
istanbul check-coverage --statement 100
npm ERR! Darwin 14.5.0
@cpojer, I don't think there's any real harm here, but this guy is drive-by pull requesting zillions of projects (presumably to gain lots of internet points?). See also https://secure.phabricator.com/T2274#22866 maybe.
const Promise = require("bluebird");
jest.runAllTimers();
jest.runAllTimers();
console.log("In MM********************************");
In MM********************************
In MM********************************
const Promise = require("bluebird");
jest.runAllTicks();
jest.runAllTicks();
console.log("In MM********************************");
In MM********************************
Thanks for quick response @cpojer. I had tried `jest.runAllTicks` and that was worse. See #673 (not sure how to re-open this).
In MM********************************
In MM********************************
jest.runAllTimers();
mock();
jest.runAllTicks();
expect(mock).toBeCalled();
Thanks @cpojer!
In my case, I was using bluebird.
const Promise = require('bluebird');
mock();
jest.runAllTimers();
expect(mock).toBeCalled();
Worked for me (with Bluebird v3.1.5) @hgezim.
Hi @cpojer, thanks for your response.
Thanks @cpojer!
Anyone have an idea of what could be the issue here?
"test": "jest"
"jest": {
"jest-cli": "^0.8.2",
"redux-mock-store-jest": "0.0.2"
race: [Function],
@felix-d what's wrong?
jest 0.8.2
jasmine.VERBOSE = true
This should return the actual 'lodash' exportable.
@cpojer https://github.com/sterpe/jest--670
Using Jest CLI v0.8.2, jasmine1
‚óè Runtime Error
"babel-jest": "^6.0.1",
"jest-cli": "^0.8.2",
"jest": {
jest.dontMock('../Item');
* @returns {Boolean}
And .babelrc:
Maybe try Automatic Mocking. @threesquared
‚îî‚îÄ‚îÄ __mocks__
Has anyone successfully mocked out a React Native "../images/abc.png" require using moduleNameMapper?
It looks like the IS_PATH_BASED_MODULE_NAME regex in HasteModuleLoader._getNormalizedModuleID() causes an attempt to resolve relative requires via _resolveModuleName() and _resolveNodeModule() and the latter throws the error mentioned above.
constructor(foo){
"jest": {
‚óè Runtime Error
jest.dontMock('../src/js/alt');
sinon.spy(alt.dispatcher, 'dispatch');
// clean up our sinon spy so we do not affect other tests
Simulate
@leeching how did u solve ur issue?
fragments: {
fragment on Root {
@yuzhi ?
https://github.com/gotwarlost/istanbul/blob/master/CHANGELOG.md
Interesting, my guess is it has something to do with the word "constructor". Is the behavior the same if you change the describe block name to an arbitrary word like "foo"?
just broken of reserved words!
‚óè Runtime Error
- Pass jest json config to jasmine file (not sure how)
- Change `jasmine.DEFAULT_TIMEOUT_INTERVAL` to `jestConfig.defaultTimeoutInterval || 5000`
@cpojer Where / how?
Specifically, adding `jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000;
> to indicate that Jasmine's it has an optional timeout third argument?
``` es6
‚óè Runtime Error
@cpojer I still get this error even w/ the updates to Jest script described above.
Updated to `jest-cli 13.2.3` and get this:
"jest": {
"defaultPlatform": "ios",
"ios",
"react-native"
"fbjs"
@bartonhammond have you tried to substitute your `Jest` config with the one provided in the F8 app? Just to discard that it's not a config issue...
I changed out my entire Jest configuration and it doesn't work so well.  For thoroughness here is the log at the bottom.
Note, my Jest configuration contains all the setup from your reference plus some.  Also note, that all my tests pass w/ my configuration **except** for this issue.
‚óè Runtime Error
‚óè Runtime Error
‚óè Runtime Error
‚óè Runtime Error
‚óè Runtime Error
Manual mock in file "/home/ncuillery/dev/app/foo/__tests__/bar.test.js" ignore due to regexp "foo" in "modulePathIgnorePatterns"
Status: Mocked
‚îî‚îÄ‚îÄ is-iojs@1.1.0
‚îú‚îÄ‚îÄ lodash._basetostring@3.0.1
‚îú‚îÄ‚îÄ lodash._reinterpolate@3.0.0
‚îú‚îÄ‚îÄ lodash._basevalues@3.0.0
‚îú‚îÄ‚îÄ lodash._basecopy@3.0.1
‚îú‚îÄ‚îÄ lodash.templatesettings@3.1.0
‚îú‚îÄ‚îÄ lodash.restparam@3.6.1
‚îú‚îÄ‚îÄ lodash.escape@3.0.0
‚îú‚îÄ‚îÄ lodash._isiterateecall@3.0.9
‚îî‚îÄ‚îÄ lodash.keys@3.1.2 (lodash.isarguments@3.0.4, lodash._getnative@3.9.1, lodash.isarray@3.0.4)
‚îî‚îÄ‚îÄ coffee-script@1.6.3
‚îî‚îÄ‚îÄ esprima-fb@4001.1001.0-dev-harmony-fb
‚îú‚îÄ‚îÄ nwmatcher@1.3.7
‚îú‚îÄ‚îÄ acorn-globals@1.0.9 (acorn@2.6.4)
‚îî‚îÄ‚îÄ acorn@0.11.0
‚îú‚îÄ‚îÄ nopt@3.0.6
‚îú‚îÄ‚îÄ esprima@2.5.0
// this one cause error
jest.dontMock('../home');
it('has a Ya div', () => {
``` shell-script
‚óè HomePage ‚Ä∫ it has a Ya div
I see. Let me file this on babel-jest
"jest": {
Running jest results in the `AppTest.js` within `__tests__` to be run as expected. After adding
// random post processing
- it considers underscored properties to be private
I've provided a monkey-patch solution mostly to illustrate an unexpected behavior and not by any means expect it to be accepted.
"test": "jest"
"jest": {
|-- app
|   |   |-- private
FYT ?
I get "Unexpected reserved word"
> Unexpected reserved word
‚óè Runtime Error
which word is reserved?
jest.dontMock('../authReducer');
jest.dontMock('../authReducer');
> .babelrc
"name": "MFV-mobile",
"jest": {
"apsl-react-native-button": "git@github.com:bartonhammond/react-native-button.git",
"react-native-gifted-spinner": "0.0.3",
"tcomb-form-native": "^0.3.0",
"babel-jest": "*",
"jest-cli": "^0.8.0",
Are you also on Babel 6?
Having problems but not clear what the issue is.
"jest": {
"fbjs"
"apsl-react-native-button": "git+https://git@github.com/bartonhammond/react-native-button.git",
"react-native-gifted-spinner": "0.0.3",
"tcomb-form-native": "^0.3.0",
"babel-jest": "^6.0.1",
"istanbul": "gotwarlost/istanbul#source-map",
"jest-cli": "^0.8.2",
> jest
Using Jest CLI v0.8.2, jasmine1
Repeating from babel-jest issue...
jest.dontMock('../ErrorAlert');
"jest": {
"babel-jest": "^6.0.1",
"istanbul": "gotwarlost/istanbul#source-map",
"jest-cli": "^0.8.2",
with ~/.babelrc:
Ex: Module A instantiate B, the `import B from ...` will fail because of the babel translation mangling the import.
I'm trying to apply jest to myproject. But it doesn't work. My environment is below:
<App>
Above test code should take a error but there is nothing. Is there other options I have to change? This project contains babel@6.x.
jest.runAllTimers();
jest.runAllTimers();
// fails here
@domenic I would be happy to put together a PR for this update, just let me know.
This used to work but seems like `babel-jest@6.0.1` broke it.
@sajinshrestha Such a shame that I forgot to update documentation on my fix, many thanks for your attention on it.
Hope this helps troubleshooting babel/ES6.
> jest
"name": "brtapsauce",
"main": "brtapsauce.js",
"url": "https://github.com/rvagg/brtapsauce.git"
"url": "https://github.com/rvagg/brtapsauce/issues"
Thanks @cpojer
Actually the break is caused by babel-core 6+ in babel-jest
https://github.com/bingomanatee/ReactUserBoilerplate/blob/master/src/components/FormDefField/__tests__/FormDefField-test.js
the error returned from jest is
@cpojer https://github.com/babel/babel-jest/issues/51 - I need the istanbul comments for the tests, but I don't want them for production.
Hi @cpojer, can't confirm if it's fixed. Getting an error for my use of JSX in the test file. Probably `babel-jest` is not compatible with latest `jest`?!
Using Jest CLI v0.9.0-fb1, jasmine1
‚óè Runtime Error
SyntaxError: Unexpected token <
- Error: Line 5: Unexpected token :
at createError (node_modules/jest-cli/node_modules/istanbul/node_modules/esprima/esprima.js:2392:21)
at unexpectedTokenError (node_modules/jest-cli/node_modules/istanbul/node_modules/esprima/esprima.js:2467:13)
at throwUnexpectedToken (node_modules/jest-cli/node_modules/istanbul/node_modules/esprima/esprima.js:2472:15)
const babelJest = require('babel-jest');
module.exports = babelJest.createTransformer({
presets: [jestPreset]
IMHO we should upgrade the example to show usage of Babel 6 instead of fixing an old version.
I agree, it would be great if we can update the example to work with babel 6.
With  babel-jest@6.0.1
With babel-jest@5.2.1
"jest": {
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/index.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/index.js
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/createUncontrollable.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/createUncontrollable.js
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/utils.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/react-bootstrap/node_modules/uncontrollable/utils.js
‚óè Runtime Error
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/index.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/index.js
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/createUncontrollable.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/createUncontrollable.js
modulePath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/utils.js
realPath: /Users/myuname/projects/myproj/frontend/node_modules/uncontrollable/utils.js
Also, `uncontrollable` is still only used by `react-bootstrap`:
> No worries. This is definitely confusing and should probably be part of
jest foo --testPathPattern "/.*spec\.js/"
I will close this PR, since after evaluating Jest, I have unfortunately decided not to use it for my project. I would still recommend you consider the distinction above.
#dope
üòçüëçüèæüëèüèΩüî•
Jest was looking for `units` directory in each sub-directories of `<rootDir>` including `<rootDir>/src` and its sub-directories (and also `<rootDir>/node_modules` ? not sure about that).
Great work @cpojer go and get yourself a beer üëçüçªüòÄ
@cpojer it didn't help
"jest": {
"cjsx"
should i consider switching to karma/mocha then?
@cpojer M using jest 0.9.0 and my React component uses react-bootstrap. And this is strange that it mocks `react-bootstrap/node_modules/uncontrollable/utils.js` even if I am mentioning `react-boostrap` in `unmockedModulePathPatterns`. Do you have any idea around this ?
addons:
@cpojer It worked, I disabled the coverage and tests passed. So it seems like this an issue from istanbul right?
if I have a time today, I'll fork it and try the latest version of istanbul and let you know.
$ jest
22747 error code ENOENT
22751 verbose exit [ -2, true ]
npm ERR! Darwin 15.0.0
npm ERR! code ENOENT
npm ERR! errno -2
npm ERR! enoent
Given a code like this:
> BABEL_JEST_STAGE=0 ./node_modules/.bin/jest --captureExceptions
‚óè Runtime Error
Interesting.  I upgraded `jest-cli` to 0.6.1 and now I just get fancier warnings:
* PropTypes
jest.dontMock('./image');
this worked @cpojer thanks very much!
"jest": {
var babelJest = require('babel-jest');
return babelJest.process(src, filename)
jest-cli 0.6.1
babel-jest 5.3.0
Ship a static, precompiled version of jasmine-only by @davemo to drop the coffee-script requirement. Fixes #578.
- Remove the dependency on jshint
Update the description of the `-c` flag to reflect the changes introduced in 362ee19.
@cpojer sure, should've noticed it myself
I've configured jest like this:
"jest": {
"jest": {
‚óè Runtime Error
My jest config:
"jest": {
jest.dontMock('../Header');
@withStyles(styles)
‚óè BoolField ‚Ä∫ it does something
Is it an issue with react or jest?
This patch will make the jest binary return a exit code of 1 when the coverage is lower than 100%.
jest: master HEAD
|- jest
@cpojer
"jest": {
__mocks__/
__mocks__/
but neither of these seem to work.
I'm trying to mock `collections/sorted-map` because of this issue: babel/babel-jest#41. I thought it would be an issue with babel-jest and not jest itself, so I filed an issue there.
Is there a development doc for Jest that I can take a look at?
Jest configuration:
> BABEL_JEST_STAGE=0 jest
jest-cli@0.5.10
"jest": {
Well, at least I found out with that other thread that 'fbjs' needed to be unmocked too. Wasn't clear.
My apologies @cpojer  I was being lazy!
Is this normal behaviour for Jest/Jasmine? If not, what am I doing wrong? If it is, then what's the reason behind it? It seems quite counter-intuitive.
jest
code above throws:
‚óè Runtime Error
/Users/pawelgalazka/Projects/firestart-seed/node_modules/systemjs/index.js:
/Users/pawelgalazka/Projects/firestart-seed/node_modules/systemjs/dist/system.src.js:
"jest": {
"jsx"
This the systemjs issue
and my environment is jest:  0.5.10, sinon: 1.17.1, node: 4.1.1.
I just tried to run `jest` examples with react:
npm ERR!
So it seems that `jest` doesn't work with react `0.14.0`.
By downgrading to babel-jest below **6.0**, the react tests pass.
#259 shows up a lot in Travis so would be great to have this fix.
Even to me it wasn't immediately obvious what the outcome was, as in Github terminology a PR being 'closed' is usually considered synonymous with 'rejected'. Perhaps an explicit comment on the PR might make things clearer for others?
Did I stumble into the wrong neighborhood?
Don't know why that is added though, hahaha (Because these modules actually cause side effects?)
success: jasmine.any(Function)
extensions: ['', '.js', '.jsx', '.json'],
when I'm trying to require a relative module to the root path (with webpack it requires `src/apps/foo/bar.js`)
jest are falling with exception:
Filename : /Users/KimCoding/Workspace/PhotoMoa/src/sample/__tests__/helloworld-test.js
Filename : /Users/KimCoding/Workspace/PhotoMoa/src/sample/__tests__/helloworld-test.js
Because I'm using the babel-jest plugin, it is in the doubt.
Requiring googleapis from a test results in an error:
@cpojer
On verbose mode log error shows "Cannot read property 'length' of undefined"
at VerboseLogger.verboseLog (/Users/machadoum/workspace/globo/play/quicksilver/node_modules/jest-cli/src/lib/testLogger.js:38:28)
at /Users/machadoum/workspace/globo/play/quicksilver/node_modules/jest-cli/src/TestRunner.js:594:13
jest-cli: 0.5.8
By changing
@Pajn
https://github.com/machadoum/jest/commit/4d442eb625821d870d75e6f4f9dad836e3a47fde
@machadoum Missed that. That's probably the correct fix.
@cpojer, Any updates here?
Thanks @cpojer!
at Error (native)
@jberube ,  hi!
jest: 0.8.2
babel-jest: 6.0.1 (enabling/disabling does  nothing)
> jest
Using Jest CLI v0.8.2, jasmine1
at Error (native)
1. jest will display an error when it can't find a **tests** directory.
‚îú‚îÄ‚îÄ __mocks__
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ lodash.js
‚îî‚îÄ‚îÄ lodash
‚îú‚îÄ‚îÄ __mocks__
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ lodash
‚îî‚îÄ‚îÄ lodash
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ lodash
‚îî‚îÄ‚îÄ __mocks__
‚îî‚îÄ‚îÄ lodash.js
__mocks__/
----other/
jest --verbose --coverage
Failed with unexpected error.
import sinon from 'sinon';
const sandbox = sinon.sandbox.create();
The error:
Failed with unexpected error.
Mine was due to `sinon` being incompatible, please disregard.
@cpojer it should be good to go now.
Jest uses path.dirname with undefined variables
Failed with unexpected error.
@cpojer @jsdf Thank you!
The issue experienced by @yudoufu would be fixed by the combination of the preprocess cache dir respecting the cache dir config (https://github.com/facebook/jest/pull/470) and ensuring that the configured cache dir is somewhere that the user has the correct permissions for.
The patch for jest has been published as 1.10.0 so we don't need to download coffee-script from GitHub each time anymore.
"test": "BABEL_JEST_STAGE=0 jest"
"jest": {
> ui-records-list abraham$ npm test
> BABEL_JEST_STAGE=0 jest
> jest
SyntaxError: /home/asiniy/projects/korob/node_modules/jest-cli/node_modules/jsdom/node_modules/whatwg-url-compat/lib/url.js:1289
Unexpected token (
// Jest + React + Coffee boilerplate
const specialSchemas = {
SPECIAL_AUTHORITY_SLASHES: 6,
FRAGMENT: 9,
SPECIAL_AUTHORITY_IGNORE_SLASHES: 10,
function isASCIIDigit(c) {
function isASCIIAlpha(c) {
const regex = R === 10 ? /[^0-9]/ : (R === 16 ? /[^0-9A-Fa-f]/ : /[^0-7]/);
if (regex.test(input)) {
ipv4 += n * Math.pow(256, 3 - counter);
input = punycode.ucs2.decode(input);
case undefined:
--swaps;
function parseHost(input, isUnicode) {
if (asciiDomain === null) {
nonRelative: false
this.input = punycode.ucs2.decode(this.input);
if (isASCIIAlpha(c)) {
// TODO: XOR
} else if (specialSchemas[this.url.scheme] !== undefined && this.base !== null &&
} else if (specialSchemas[this.url.scheme] !== undefined) {
function parseSpecialRelativeOrAuthority(c, c_str) {
if (isNaN(c)) {
} else if (specialSchemas[this.url.scheme] !== undefined && c_str === "\\") {
function parseSpecialAuthoritySlashes(c, c_str) {
function parseSpecialAuthorityIgnoreSlashes(c, c_str) {
/* jshint +W004 */
if (c === 0x9 || c === 0xA || c === 0xD) {
(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
if (specialSchemas[this.url.scheme] !== undefined && this.buffer === "") {
(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
if (specialSchemas[this.url.scheme] !== undefined && this.buffer === "") {
if (isASCIIDigit(c)) {
(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
if (this.buffer === specialSchemas[this.url.scheme]) {
if (specialSchemas[this.url.scheme] !== undefined && c_str === "\\") {
if (c_str !== "/" && !(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
if (specialSchemas[this.url.scheme] !== undefined && c_str === "\\") {
if (c_str !== "/" && !(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
!(specialSchemas[this.url.scheme] !== undefined && c_str === "\\")) {
this.buffer.length === 2 && isASCIIAlpha(this.buffer.codePointAt(0)) && this.buffer[1] === "|") {
if (specialSchemas[this.url.scheme] === undefined || this.url.scheme === "ws" || this.url.scheme === "wss") {
const decoded = punycode.ucs2.decode(val);
const decoded = punycode.ucs2.decode(val);
return asciiDomain;
return unicodeDomain;
I'm getting the exact same error with babel-jest
Yep. Same error with babel-jest.. I'm still struggling on making jest working for the first time.
Jest seems too complicated for relatively simple tasks done by it... :(
jest supports [pit](https://www.npmjs.com/package/jasmine-pit) so you can just return a promise
@johannhof I know pit it is much better than jasmine 1.x but it is not the same. @cpojer thanks, look forward to this feature.
> test-app@1.0.0 test /home/martynas/js/test-app
> jest
//     --Hovis 20150826
Unexpected token ILLEGAL
steal @amasad's wisdom from https://github.com/facebook/jest/pull/96
Unexpected token ILLEGAL
> jest
Unexpected token ILLEGAL
jest.dontMock('../driverStore');
jest.dontMock('object-assign');
However the following error is thrown:
//Imports
when the module name includes a `@namespaces`, e.g. `require('@quux/foo');`
__mocks__/
@quux/
foo.js
__mocks__/
foo.js
Normally svg update so fast. It's so weird. The latest version of jest-cli which shown on [npm page](https://www.npmjs.com/package/jest-cli) is `0.4.19`, and version installed by `npm install jest-cli` also `0.4.19`. Maybe some npm bugs here?
> jest
> jest
This can't be good ?
@amasad it's published but the `latest` tag points to 0.4.19
jest.runAllTimers()
Date.now = jest.fn(() => 0);
@akaRem I didn't forget, I was responding to @cpojer's [comment above](https://github.com/facebook/jest/issues/449#issuecomment-250946573). It does not happen automatically, so like you say, you have to manually restore the stub. It would be nice if Jest had a way to stub a property and automatically restore it. @mockdeep ah, ok, sorry.  Hello.
gyp ERR! configure error
gyp ERR! node -v v0.10.40
gyp ERR! not ok
npm ERR!
npm ERR! not ok code 0
gyp ERR! build error
gyp ERR! node -v v0.10.40
gyp ERR! not ok
npm ERR!
npm ERR! not ok code 0
Hello @browniefed,
Looks like when name contains `@`, e.g. `@grabbou/plugin`, it fails with the following:
// $ jest
at Function (native)
cc @elgerlambert @coma
thanks @jbonta!
I'm about to do @browniefed 's plan but it's a bit of a sigh that it's necessary
With some arbitrary function being mocked in the test:
I'm not sure if that's intended.
"jsx"
@browniefed Didn't help :(
I'm also getting empty coverage results, but I'm not sure if it is a `jest`, `babel-jest` or even `istanbul` issue. I'm using Jest 0.5.x with ES6 imports and auto-mock off, and the following configuration:
"jest": {
"jsx"
This is the Jest output:
And `coverage/clover.xml` contents:
"jest": {
"jsx"
"jest": {
cc @rbardini
@roman01la  I think you need to put your test under `__test__` folder in order to get coverage report. And my also get rid the line `"testDirectoryName": "test/unit",`
Should I raise separate issue?
@hourliert, @yaycmyk  +1
jest-cli@0.8.2
/app
‚îî‚îÄ‚îÄ __mocks__
/app
‚îî‚îÄ‚îÄ __mocks__
There are so many different issues listed in this ticket that I'm having a hard time following what is actually still a problem.
@cpojer, i can confirm this is still an issue.
`jasmine.VERBOSE = true;`
This seems to work.  Though setting `jasmine.VERBOSE` && running `jest --verbose` seems to throw an internal error when running asynchronous tests.  So watch out for that on `jest-cli@0.4.19`
@jfahrenkrug thanks!
Anyone know what might be causing it?
> jest
jest v0.4.15
Some combination of requiring react/addons and current jest version being funny with node >0.10.
does this need to be done for the `--bail` flag as well?
"jest": {
Well alright then, so we are looking at two new features:
2. Actual implementation of the caching of babelified jest tests
@cpojer Works for me
@cpojer How's that look?
Feel free to close this issue as it's not quite valid.
ignoredFileExtensions: []
@browniefed Yes, this how I resolved it. But it looks more like a hack:
return src.replace(/(require.*\.less.*;)/gm, "");
@cpojer Awesome, thanks!
npm http GET https://registry.npmjs.org/istanbul
npm http GET https://registry.npmjs.org/jasmine-only/0.1.0
npm ERR! If you need help, you may report this log at:
npm ERR! or email it to:
npm http 304 https://registry.npmjs.org/istanbul
npm http 304 https://registry.npmjs.org/jasmine-only/0.1.0
npm ERR!
npm ERR! not ok code 0
which outputs this error:
gyp ERR! configure error
gyp ERR! cwd D:\dev\cgb14\code\trunk\jesttest\node_modules\jest-cli\node_modules\jsdom\node_modules\contextify
gyp ERR! node -v v0.10.32
gyp ERR! not ok
npm ERR!
npm ERR! not ok code 0
does anyone know how to solve this or remove the dependancy for windows?
ele Erstellung zu erm√∂glichen, m√ºssen Sie den Schalter "/m" hinzuf√ºgen.
C:\Users\Benny\.node-gyp\0.10.33\deps\v8\include\v8.h(209): warning C4506: no d
rezeta\node_modules\jest-cli\node_modules\jsdom\node_modules\c
gyp ERR! node -v v0.10.33
gyp ERR! not ok
npm ERR!
npm ERR! not ok code 0
Please let me know if you have luck with installing `jest`.
Followed several guides, each with conflicting information.
lib
‚îú‚îÄ‚îÄ ajax.js
@slatkovic yes - I don't have the configuration at hand, but if I recall correctly, setting `testDirectoryName` to `<rootDir>` did the job. It was not ideal for us though, so eventually we switched back to mocha/chai/sinon.
if (config.verbose) {
this.verboseLog(testResult.testResults);
jest.dontMock("./target");
Looking forward to your feedback! @amasad
In my case, this is a problem because I have `node_modules/react-side-effect/node_modules/fbjs/flow/include/warning.js` and `node_modules/react-router/node_modules/warning/warning.js`. When react-router calls `require('warning')` it gets the wrong `warning.js`, which happens to use ES6 syntax that's not supported by Node, and I'm getting a test failure due to `SyntaxError`.
@cpojer I use babel-jest, but the module with ES6 syntax is an external dependency. Furthermore, the file with ES6 syntax is not even used by the dependent library itself, it's just non-precompiled source that is shipped for reference.
@amasad I'm very happy to hear that I'm not the only one having this problem and that it's being fixed :+1:
Is there a way to remove these warnings ?
Versions
jest-cli 4.5
```javascript
jest.useFakeTimers();
const Promise = require('bluebird');
const fn = jest.fn();
jest.runAllTimers();
This diff is near the minimal amount of work to bring jest up to date and pass all of its tests.
and this is very slow:
So my uuid/random variable code must have been blowing out JIT caches.
polyfill without warnings.
Given a component in Jest where the following are true:
called using `jest --verbose`
@binarykitchen
"jest": {
@binarykitchen
This is my gulp script
"cjsx"
at doNTCallback0 (node.js:408:9)
at doNTCallback0 (node.js:408:9)
at doNTCallback0 (node.js:415:9)
jest.dontMock('es6-promise');
"name": "JSDependencyHell",
"jest": {
"jsx",
"jsx"
"babel-jest": "^5.2.0",
"gulp-shell": "^0.3.0",
"gulp-util": "^3.0.3",
"jest-cli": "^0.4.3",
> jest
‚ûú  Jest  node -v
‚ûú  Jest  npm -v
I don't consider this a fix as npm and iojs weren't even the same thing as of the writing of this issue. I had to upgrade npm for other reasons which then led to this problem. Going backwards doesn't solve the problem for me.
to use it, you dont even have to be using Gulp, you can simply use its _getJestConfig()_ method to generate the config for you before you run Jest. @buddyp450 Did you come up with your own solution? @ArmorDarks no, sorry. This was from a short foray into evaluating jest that I took a while back ago. My tests currently do not use jest. @buddyp450 Thanks for reply!
If youre a System JS user I created [gulp-jest-jspm](https://www.npmjs.com/package/gulp-jest-jspm) to work around the dependency issues so you can use Jest easily. @yoavniran Hi! We've seen your plugin, of course, thanks for it. We're still looking into it as possible solution, but since it doesn't fit in our current pipeline well, we really hope that https://github.com/facebook/jest/pull/2445 will be merged soon and it will provide more practical way.
@amasad for example, when using `guard` on Rails project to run jest:
I looked into _Jest_'s source and finally I'm able to contibute into it.
I did not think this deserved a specific test since I feel it is an edge case but let me know if you feel otherwise.
jasmine.VERBOSE = true;
require('jasmine-reporters');
jasmine.getEnv().addReporter(reporter);
Here is the confusing bit though, both of them render the same component exactly...
So I am a bit baffled and need a little help here.
jest.dontMock('bootstrap');
jest.dontMock('../../i18n/loginmessages.js');
<Login {...i18n.gb} />
<Login {...i18n.gb} />
# /src/jest.js around line 159
having trouble because your test is asynchronous where jests fake timers
"test": "jest"
"jest-cli": "^0.4.1"
other file
> @ test /Users/Hbomb/Desktop/testJest
> jest
cd jest
\npm\\bin\\npm-cli.js" "--userconfig=C:\\Users\\hbomb_000\\.cnpmrc" "--disturl=https://npm.taobao.or
g/dist" "--cache=C:\\Users\\hbomb_000\\.npm\\.cache_cnpm" "--registry=https://registry.npm.taobao.or
npm ERR!
jest
error:
on mac
jest
npm ERR! Darwin 14.3.0
npm ERR!
"jest": {
function toggleAlphabeticalSort(){}
// Throws an exception if not found
"test": "jest"
"jest-cli": "^0.4.0",
"flux": "^2.0.3",
"jquery": "^2.1.3",
"lodash": "^3.6.0",
"reqwest": "^1.1.5",
"jest": {
if( Whatzit.mocked1() && Whozit.mocked2() ) {
@zpao
Hi @thealjey I am using babel as well, have exactly the same issue as you got.
@zpao any idea regarding this? Thanks!
Cannot read property 'g' of undefined
I've eventually had to give up Jest altogether in favor of Jasmine+Istanbul
In Mocha it works. When running the test in Jest it fails because value has a '\n' character prepended ('\nxyzzy'). Trim fixes the test, but that seems like it could miss potential bugs in less trivial cases.
Getting this error which has probably some origins from jest-cli:
Error: Received unexpected data from child process: {
This bug is one month old and still a huge problem. So would really appreciate to get a little more attention here. Thx!
Running "jest" task
jest v0.4.0
@sogko I receive this error even when I have only one test per **tests** folder, though I have multiple **tests** folders throughout my project.
jest v0.4.3
jest 0.4.5
jest 0.4.5
jest-cli 0.4.13
thanks, @mattotodd ! I've given up on Jest for the project I'm working on, but I'll keep that in mind for next time I try Jest.
Been trying to get jest set up for 2 days now - no luck so far. Here's my current setup and the error messages I'm seeing on [this gist](https://gist.github.com/anyong/02bc3f512daef6baf808).
@anyong I think both your v1 and v2 are broken because you `return '';` for non-transformed files. You should be returning the raw source in those cases instead.
@cpojer Why not?
extensions: ['', '.js', '.jsx'],
"jest": {
"jsx"
"jsx"
> test with Jest.
>         extensions: ['', '.js', '.jsx'],
>         "jsx"
>         "jsx"
jehoshua02@gmail.com
Thanks zhengl,
styles.use();
styles.unuse();
var babel = require('babel-core');
The jest code
// Mock wepack style loader
var babelJest = require('babel-jest');
return babelJest.process(src, filename)
var babelJest = require('babel-jest');
return babelJest.process(src, filename);
@cpojer Correct me if I'm wrong, but I can't see how it will be possible to get jest to play nicely with webpack without using webpack for processing. Webpack allows you to define any arbitrary loaders and resolve extensions which means the behaviour of require calls or imports will vary greatly dependant on the specific config.
// Shims
import jssha256 from 'jssha256';
do {
This patch adds optional `jasmine 2.x` support to `jest`.
- bundled `jasmine` is not modified, it can be updated any time
- whatever you need from `jasmine-2.x`
- Tested jasmine 2 against React's test suite. Mostly had to fix spy and toThrow changes.
### Upgrading to Jasmine 2
- jasmine has been updated to the latest version (2.2.0 -> 2.3.1)
- Object (actually, Array) comparison was a known bug in jasmine 2.2.0 (https://github.com/jasmine/jasmine/issues/765), these tests now pass
**Spies**:
As for performance, 6.1 vs 7.9 seconds on the jest test suite. The test suites run faster on both after an initial warmup, so take these numbers with a grain of salt.
@cpojer what is the status on this?
@cpojer Thanks for your had work on Jest, my understanding is that this is "Optional Jasmine 2 Support" so it should not affect Facebook tests, since you would not enable Jasmine 2 for the time being.
@gagoman Based on what @cpojer has said, should we look at removing Jasmine 1 and using Jasmine 2 exclusively. Let me know if you need any help.
@cpojer I'm working on this. A lot of things changed in `jest` since this PR was created.
- `noStackTraces` in jasmine 2 Reporter
I know that I should import core-js to solve that error but he fact that I should import core-js every time using jest bothers me a lot.
@zpao thank you a lot
Howdy. I'm scratching my head about the `--onlyChanged` flag:
--onlyChanged, -o
I had a quick look at `jest.js`, and unless I'm mistaken, I do not see how this can work at the moment:
['diff', '--name-only', '--diff-filter=ACMR'];
The `git diff --name-only --diff-filter=ACMR` call always returns a path relative to the _top_ of the git tree, _even_ if you cwd to `dirPath`, _unless_ you use the `--relative` flag.
"jest": {
/Users/Shared/Src/react/react-experiment$ git diff --name-only --diff-filter=ACMR
/Users/Shared/Src/react/react-experiment/src/js$ git diff --name-only --diff-filter=ACMR
/Users/Shared/Src/react/react-experiment/src/js$ git diff --name-only --diff-filter=ACMR --relative
With that in mind, running `jest -o` executes:
var args = ['diff', '--name-only', '--diff-filter=ACMR', '--relative'];
gyp ERR! cwd C:\Users\ljgarcia\AppData\Roaming\npm\node_modules\jest-cli\node_mo
gyp ERR! node -v v0.10.32
gyp ERR! not ok
npm ERR!
npm ERR! not ok code 0
> jest

jest.addMatchers({
The problem occured because of the following code,
jest.dontMock('../CheckboxWithLabel');
Jest code:
In this case, maybe I can introduce `-lodash`, so will exclude it out of the ``modulePathIgnorePatterns`. Any idea?
@zpao if you can take a look.
It's against the norm, but React has taught me to care less about the norm.
if ( !a.b() ) {
jest.dontMock(src);
jest.dontMock(src);
--- a/bin/jest.js
+++ b/bin/jest.js
class PirateStore extends EventEmitter {
getPirate() {
return _pirate;
export default new PirateStore();
jest.dontMock('../PirateStore');
import PirateStore from '../PirateStore';
describe('PirateStore', () => {
const state = PirateStore.getPirate();
Additional: my babel-jest setup seems to work OK. The proper jest output is:
FAIL  lib/stores/__tests__/PirateStore-test.js
npm ERR! not ok code 0
I had a similar issue I had to add `jest.dontMock('events');` so that the `super()` call in my store constructor would work in my test.
Error: /Users/josefa/projects/applicationName/apps/frontend/tests/unit/jest/tve/models/gridModelUnitTest.js: public/javascripts/shared/tve/models/gridModel.js: Cannot find module 'immutable' from 'public/javascripts/shared/tve/models'
at /Users/josefa/projects/applicationName/apps/frontend/tests/unit/jest/tve/models/gridModelUnitTest.js:2:17
"test-coverage": "istanbul cover _mocha -- tests/unit/ -R spec --recursive",
"aws-sdk": "~1.18.0",
"flux": "^2.0.1",
"lodash": "~1.2.0",
"grunt-contrib-jshint": "^0.10.0",
"istanbul": "^0.2.10",
"jest-cli": "^0.4.0",
"mocha": "^1.16",
"rewire": "^2.1.4",
"sinon": "^1.12.2"
"jest": {
"testDirectoryName": "jest",
Does this need to be a dependency?
git checkout 62ba8
git checkout jest_mocks_me
return  mockActions;
~/projects/jehoshua02/react-scaffold üöÄ  babel_jest
Failed with unexpected error.
Failed with unexpected error.
offsets: [],
consumeBlanks: undefined,
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
{ text: 'function toKebab(str){',
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
{ text: '                rootStyle += toKebab(key) + \':\' + style[key] + \'; \';',
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
offsets: [],
I think it is some kind of mapping error by babel, telling istanbul there is one more line then there should be? Not really sure though. Hopefully this can help someone with a little experience with these libraries.
It seems this notion goes deep into the naming scheme, but it feels odd when seeing the report.
Tests don't have to be in **tests** folder for Jest, there is a config
"jest": {
"litcoffee",
"litcoffee",
Thank you but in the meantime I switched from CoffeeScript to ES2015 / Babel :wink:
jest.dontMock('../../../timer/trackings/date-view');
at null._onTimeout (/Users/sebastiandeutsch/development/ruby/timetracker/node_modules/jest-cli/vendor/jasmine/jasmine-1.3.0.js:2088:18)
npm ERR! not ok code 0
jest.dontMock('../../../timer/trackings/date-view');
Using karma+jasmine (not jest), babel, browserify. No ES6 modules.
Fixed by going to jasmine 1.3 from 2.2.
@nifgraup did you downgrade jasmine from 2.2 to 1.3?
Beware that I am running the tests through gulp-jest ...
My 2 cents: afaics `it.only` works, but in the related `describe` block (meaning if you have many test files they still run). What I would expect instead is that from all the test files, only the one marked as `it.only` is run.
PS: the new jasmine syntax to run specific specs is to "focus" them with `fit`, `fdescribe`
The karma runner for jasmine supports that. I don't know how it works exactly and how it differs from jest, still I think it's worth mentioning...
https://github.com/karma-runner/karma-jasmine
@cpojer, we removed the use of `arguments.callee` and added a function constructor call and changed the comment, incorrectly, saying that we couldn't use 'strict mode' because of the function constructor, but it's ok to use the function constructor on 'strict mode', so I removed the comment and added 'strict mode'.
Jest may appear to hang (for dozens of seconds, up to minutes) when
will still be pathological cases that can be very slow (really huge
Add automated tests (unfortunately, fairly tied to Jasmine specifics)
Added the cobertura coverage reporter to the default set of reporters. Can be used for Jenkins and shippable.com.
Jest is somehow preventing the babel/runtime transformer from being applied to my code.
Here's my jest setup:
https://gist.github.com/tomatau/38ef416fbca4c9f31d8f (yes the `src = ''` thing is wierd but it doesn't break anything)
Have also tried a bunch of logging in the src when running jest to see what's going on after speaking with @sebmck and @zloirock from babel
‚Äúbabel-runtime‚Äù,
I don't know why you have chosen using the `__test__` directory by default, which is outside of the community conventions
@zpoa so sorry to have put this in the wrong place. this makes much more sense. thanks for the correction :)
- Clone jest repo
at onWarmed (<MY HOME>/jest/website/node_modules/react-page-middleware/src/Packager.js:282:9)
Hmm strange, `React` (capitalize) is not registered in npm, resulting a 404 on `npm install` (not tested with flux's website but I suppose it's the same).
// a jest transform inserted this code:
// end jest transform
"jest": {
It specifically doesn't work in jest. I just ported tests from karma to jest, and after porting, scryRenderedComponentsWithType suddenly returns always empty array.
> jest
Here are my Jest options I am using in a gulp task:
jest(
testFileExtensions: ['coffee']
"cjsx"
jest.dontMock(modPath);
I'll let that pun slide unnoticed.
> jest
Without that change, Jasmine throws the error
at jasmine.PrettyPrinter.iterateObject (...)
when trying to pretty print such objects.
@iamstarkov: Afaik, jest runs fine on v0.12 ( at least it did in my cases). The issue seems to bethat jest's own test suite does not run on v0.12.
at Error (native)
Has anyone else experienced this error when running `jest` on their tests? I use Coffeescript and a preprocessor that transpiles to Javascript before testing (not sure if relevant).
Failed with unexpected error.
What's the solution here? :octocat:
Jest 0.4
I have been having some interesting issues trying to get jest set up, and just ran in to this one. I was having the issue described here: https://gist.github.com/anonymous/ac700b7968b432057088
Jest seems really buggy...
jasmine.VERBOSE = true;
logging:  >> Jasmine waiting for success callback should be called
logging:  >> Jasmine waiting for success callback should be called
jest --version
"jest": {
"setupTestFrameworkScriptFile": "test/jasmine.rc"
I had a similar problem caused by my bunyan logger writing to stdout.
I ran into this issue when using `pit` and `jasmine.VERBOSE = true`. `pit` is in the 3rd test:
logging:  >> Jasmine waiting for something to happen
logging:  >> Jasmine waiting for something to happen
"ancestorTitles": [
"ancestorTitles": [
"ancestorTitles": [
Removing `pit` or setting `jasmine.VERBOSE = false` allows the tests to run.
Feels like a timings issue or some kind of race condition.
Afaics both have their advantages and disadvantages and some stuff were a bit a pain in the ***, not to mention weird errors (see my `FIXME` comments).
- ES6 syntax
- usage of Immutable data
@chantastic done, thx for the hint! ;)
@zpao yay, congrats guys!!
Jest didn't work for my coffeescript project as written. Through some debugging I found `"moduleFileExtensions"`, which fixed my problem and allowed my coffee files to be tested.
I'm having the same errors as #249 & #181 but on windows:
Having the same issue as @Artsu
I'm having this issue when `jest` silently fails without telling what went wrong:
![jest](https://cloud.githubusercontent.com/assets/286966/6408980/60192bd6-be5d-11e4-9453-12abef94b1bc.PNG)
https://github.com/koistya/jest-sandbox
> jest
+1.. dead in the waters
Can we stop with the "+1" bullshit ? I think maintainers are aware of the problem.
If maintainers are aware I suppose that whole +1 stuff would stop if they would acknowledge the awareness by making a simple statement along the lines of "yeah we know,but it's complicated/hasn't high prio/chickens for sacrifice haven't arrived yet". Until then people will keep knocking the door to show that they are getting burned right now by this issue.
Is there some combination of Node and Jest versions that is known to still work?
@mindjuice Node v0.10.36 & Jest v0.4.0 work together for me
npm ERR! not ok code 0
@woodb, for me at this point, if you're using `node v0.12` in production then jest might not be the right solution for you. I'd recommend switching to `iojs` or `node v0.10` in production if jest is an important tool for you.
Does jest supports at all?
‚óè FakeTimers ‚Ä∫ runWithRealTimers ‚Ä∫ it resets mock timers after executing callback
This is insane! All men abandon ship! This issue has been open for three months!!!
In any case, for those of us wanting a Jest option, there is one!
@Frikki i'm afraid that you have a point :(
I want to believe :alien:...
@harryworld works with iojs `2.5.0` at least.
P.S> I'm new to Jest, not sure about its magic yet.
+1 a lot of silent failures with Jest
@sebmarkbage @zpao alright, semicolons added :)
Having said that I'm not sure why Jest would return all the properties except the boolean ones.
I just noticed this as well. Very confusing.
Mocking arrays is also broken, they come out empty with jest
Ya ya ya ya ya... news?
I have used this to allow for use of aliases with Jest (thank you for this btw), but the catch is never hit.
@codegoat It's been a while now but I think I did that because some people don't have a webpack config path and I didn't bother adding in a way to specify that you want webpack support so it had to be flexible.
Is there something to add before merging it ? @cpojer @amasad
ExternalStringResource
if (str->IsExternalAscii()) {
IsExternal
ExternalStringResource
../node_modules/nan/nan.h:2105:9: error: assigning to 'const v8::String::ExternalStringResource *' from incompatible type 'const v8::String::ExternalOneByteStringResource *'
gyp ERR! build error
gyp ERR! System Darwin 14.1.0
gyp ERR! node -v v1.0.4
gyp ERR! not ok
npm ERR! Darwin 14.1.0
@irvinebroque I was able to get jest to run in iojs and node v0.12 with a small change in harmonize to exit early. It's not elegant, but it got me going for now.
Acutally I do not know. We switched to plain Jasmine, mainly because of the performance ...
// mocking
// stuff that should not be mocked
at /Users/mikolajdadela/code/lb-node-api/resources/topics.js:4:24
//tests/app/headernav-test.js
Advice for how to unit test this welcome. I added `JSON` to the environment mock to make sure existing tests pass, but couldn't figure out how to create a new mocked environment that will let me assert that the issue described in #228 is fixed.
Error: Received unexpected data from child process: {
Total hack but it works
> Sudo really shouldn't be required for running tests
Jest v0.4.5
"babel-jest": "^5.2.0",
"jest-cli": "^0.4.5"
"test": "BABEL_JEST_STAGE=0 jest"
"jest": {
is it still an issue?
@cpojer any thoughts on that?
Has anyone had any luck getting a mock for superagent that works?
var mockDelay;
get: jest.genMockFunction(),
if (mockDelay) {
@browniefed - Thank you.
https://gist.github.com/JoelOtter/b97d207acbbca414baba
//     VV
Using `../../` throughout your project is a developer ergonomics and maintenance pain.
cd jestsymlink
jest
I get into the same trap, thanks to @wwalser it's was easy to get out.
Is this because of the automatic construction of the mock ?
"jest":{
here is the gist showing complete error https://gist.github.com/sahas-/affabaa522e78109c141
As to the aside, I don't want to argue about which edge cases are meaningful and which aren't. If you think a discussion will elicit valuable information then by all means bring it up edge case or otherwise.
jest.runAllTicks();
jest.runAllImmediates();
jest.runAllTimers();
jest.runAllImmediates();
jest.runAllTimers();
`[ 'resize', undefined ]`
Is there a reason for this behaviour?
"jest":{
"/newrelic/"
> jest
fakeFlux.genMocksForStoresAndActions();
Component.chooseSuggestion = jest.genMockFunction();
@zhon you can find my code here: https://github.com/codejet/google-books-search/tree/reactive-element
jest.dontMock(componentPath('YearField'));
``` coffeescript
component.onChange({target: {value: 'Yoyoyo'}})
@yannickcr I am trying to do it your way, tests failing :(
I've been testing with `jest` for a while now, but only today figured out how to use manual mocks in the `__mocks__` directory. I had a couple hang-ups:
jest.dontMock('../../node_modules/mailcomposer/node_modules/he');
jest.dontMock('path');
### Generation of mocks
I forgot to say‚Ä¶I've really enjoyed using `jest` to test my code, even with the work to get mocks to work correctly. Thanks for the great work!!!
(I am brand new to Jest, so if that's way off the mark don't hesitate to say so).
@rattrayalex If it's something like `lodash` where you've got a library of sugar methods that could very well be built-ins - mocking is often unnecessary.
We observed that in a test that uses `disableAutomock`, a dependency's dependency (specifically `enzyme`'s depdency, `cheerio`) got mocked and appeared to remain mocked for other tests.
@goivemaster could you update this issue with our specifics? Otherwise I will edit this when I can pull the latest version later today. Thanks @cpojer
Jest configuration :
"jest": {
"jsx",
"lodash",
"jsx"
CONTRIBUTING.md  INTHEWILD.md               ReactWrapper.js  ShallowWrapper.js
just a hunch, but this feels like it's related to Enzyme not having its own node_modules directory - this kind of transitive mocking seems to behave with other dependencies.
Jest Test
- Complicated
- Unreliable
- Unconfigurable
@ondrejhanslik
expect(result).toBe('foo');
"greensock-tm": "TweenMax",
"scrollmagic": "ScrollMagic",
Hi, were you able to run `jest` with that setup ?
It seems like for large projects with lots of tests the preprocessing overhead is very substantial. This sucks because the simple integration for a preprocess script into Jest is a killer feature, and a lot of people are using Jest with JSX. I think the most appropriate solution would be to implement a very simple caching layer around https://github.com/facebook/jest/blob/master/src/lib/utils.js#L328.
Leaf nodes are very fast, .3 to 1 second. but the further up the tree the worse the performance.
Which is not good at all when combined with the way jest is loading modules.
Even if it's not a Jest issue it looks messy and leads to bugs. Why doesn't e.g Mocha have this issue?
zlib: '1.2.3',
museo: '1.0.0' }
> jest
/* jshint noarg:false */
returnValue = specificReturnValues.shift();
It seems the only way to prevent this is to:
'jest-cli': '0.4.14' }
"jsx"
There is however a problem I encountered with other file extensions than `.js` for code coverage (see #155) but in these cases the tests are still executed (but some are failing).
"jest": {
"jest": {
Thank you for pointing it out. Actually we don't need to assign `collectCoverageOnlyFrom`, Jest will collect them automatically. But JSX is not counted as resource (but it should), so it won't be listed automatically. There may be a quick fix for this issue, I am not totally sure if it is a good way, which should be reviewed by Facebook. And I am still testing, maybe you can help me a bit.
> jest
> jest
gyp ERR! stack     at Request.onRequestResponse (c:\nodist\bin\node_modules\npm\node_modules\request\request.js:1254:10)
gyp ERR! stack     at Socket.socketOnData (_http_client.js:309:20)
gyp ERR! node -v v0.11.14-nightly-20140819-pre
gyp ERR! not ok
I get the same error as @xeodou using `v0.11.14`
npm ERR! not ok code 0
The `Error: Worker process exited before responding! exit code: null, exit signal: SIGSEGV` issue is also present with `iojs@1.3.0` and `jest@0.4.0`.
@jeffmo @spicyj can you guys take a look?
Bump. Really looking forward to getting istanbul working with Jest
@lo1tuma thank you, I merged.
@jeffmo it's good to hear from you.
![screen shot 2014-12-05 at 10 44 29 pm](https://cloud.githubusercontent.com/assets/2044960/5326466/dd746366-7cd1-11e4-8d4a-1ea471dddebe.png)
The above image shows that I mark every lines as green and then parse `uncoveredSpans` to mark them as red. But there are some weird ponits:
Now, let's see `coveredSpans`
Here is the report from `istanbul` (my PR)
@jeffmo @zpao @leebyron could you have some updates?
https://github.com/gotwarlost/istanbul#generate-reports-given-a-bunch-of-coverage-json-objects
Some progress updates here. @tchcxp that will be my direction now. I've already talked to @jeffmo, and we had some discussion about custom reporter and collector. I am still busy this week, but will work on that in the weekend and the coming week.
@jeffmo please review, thanks.
- How does one use `collectCoverageOnlyFrom`?
@kellyrmilligan if you have the `jest-cli` > `0.3.0`, it will come with `istanbul` already.
@hankhsiao
`jest.dontMock('../Abc.jsx');`
I can see the abc-test.js test was executed and passed on the console. The jest-cli is latest version on npm (0.4.0) and codeCoverage is enable on the package.json.
@hankhsiao
I might be doing something that is obviously incorrect, but, it's not making sense to me.
Some unexpected behavior occurs with a combination of config.testPathDirs and using jest.dontMock() on a node_module.
2. `cd jest-issue-176`
enabled even though it shouldn‚Äôt be)
A recent change to jasmine-pit disallows this.
AFAICT there are a few subcomponents that can be extracted:
(3) mock timers
It wouldn't be an issue about updating Jasmine version.
Highly recommend sinon for most mocking needs. It's an _excellent_ library.
I don't understand why rebasing dalongi/jest onto facebook/jest just added like 20 commits to this pull request. I'm just going to start from scratch.
@jeffmo Indentation fixed.
Same problem here and I just want to add that using a `.jsx` file extension (and JSX syntax) for test files that are testing JSX components is absolutely convenient. Using pure JavaScript is not as good for these tests.
jest-cli: 0.7.1
@phkavitha Try [buggerjs/bugger](http://github.com/buggerjs/bugger), it's a hell of a lot faster than node-inspector.
@cpojer
I wanted a way to simply inspect and debug Jest tests using the command line. Per [this post](https://liusy182.wordpress.com/2015/03/12/jest-how-do-you-debug-it/) by @liusy182 I use a slightly different command:
Unable to reproduce outside of Jest so I post here.
var rimraf = require("rimraf");
var TEST_DIR = './foobar';
// fake describe/it/expects that always succeeds
fakeFunction();
No idea what is actually different, but it seems like a good thing to do :D
jest.dontMock('../three');
Changing `console.error` to `jasmine.log` also has no effect. The only workaround I've found is to create an explicit log file:
...or, Won't you take me to...Funciton?
is there a way that jest could make use of the jasmine spec runner?
I know PR are welcome!
One reason I'd like in browser testing is browsers handle JS Proxy while babel doesn't. does anyone have an advice for the meanwhile? My use case for browsers support is to be able that a library I created interacts correctly with different browsers and versions. Right now I have to use Karma + Jasmine, but Jest would be much easier to manage. How to run a case multiple times multiple source files jest?@cpojer  Literate coffee files were being detected, but if you actually tried to compile one you would get an error because the literate option wasn't set on the compiler.
@stefanfisk So you're using mocha or jasmine then wih karma?
@kellyrmilligan Yep, Mocka/Chai/Sinon. Probably something like karma-webpack could just be ported over to jest, but I currently don't have the time to look into it.
Jest was too slow, so I switched to mocha.
+1 gasparch. I suspect a lot of people will
@amasad yea i was a little unsure how to write a good test for this, given its based on process.env
@amasad given this test for instance:
@hojberg
In general I agree, but the promise loader seems like a special case to me as it no longer returns the module but a promise to the module and putting this in the require makes this explicit.
version of jest : 0.1.18
Error reported:
This results in an error:
Running this under Jest gives this error:
@adaschevici
"jest-cli": "^0.1.17",
@jeffkole hey....this was forever ago. I need to figure out what I was doing then and how i would fix it now.
"jest": {
// our own custom matchers
jasmine.getEnv().beforeEach(function () {
React Test
I definitely also experience slow tests with jest :(
.pipe(mocha({ reporter: 'list' }));
Oh you're right.  I tested the jest react example not using JSX and it went from close to 4 seconds down to 0.75 seconds.  Makes me really think if it's worth it to use JSX.  On a big project, it's going to get slow pretty quickly unless I have a lot of different packages.  I wonder if the preprocessor is run on all 490 requires and not just that single file.  There is no way it should take 3 seconds for that simple component.
Either way, I really really need my tests to be fast for my workflow.  I still need to figure out how to at least run a single suite.  In jasmine I could use "ddescribe" or "iit" instead of "describe" and "it" to run a single test or suite.  Jest is SO nice, I just need a fast workflow now.
@iamrandys I 100% agree with you. Jest and React are awesome, but compilation of JSX into JS is a big hinderance. Just curious how Gulp will solve the problem of having your required files (Non JSX) being run through the JSX preprocessor? Are you suggesting something like the following -http://blog.avisi.nl/2014/04/25/how-to-keep-a-fast-build-with-browserify-and-reactjs/ ?
amazing development environment.  You make any change, save and you almost
Thanks @iamrandys. Developed a quick [react-component-boilerplate](https://github.com/TYRONEMICHAEL/react-component-boilerplate) which uses Mocha and Chai (Jasmine can be easily substituted). Tests are extremely quick and you get the added benefit of Livereload. Use as you wish.
changes.
> Mocha and Chai (Jasmine can be easily substituted). Tests are extremely
var MAGIC = "/** @jsx";
I'm looking forward to the `--watch` work, but I'm also wondering what is going on that requires 1.2 seconds of load time to run a test? I don't know anything about what haste is doing and why jest is using it, so I'm pretty clueless.
@amasad that sounds great. I've tried out intern.js and it runs a regular unit test from cmd line to finish in a few ms. Do you think jest could get to that fast? And have you considered extracting the automocking portion so that it is usable in other frameworks like jasmine or mocha?
I've found great success with karma, mocha, chai, sinon, rewireify and aliasify. Over 300 tests run in 1/2 a second. Best of all React is AMAZING!!!!!  The team LOVES it and have been developing some really good stuff with it. It's so clean and maintainable. Huge difference from anything we've ever used.
@culshaw @haihappen thanks for the nice workarounds, shorten the 10s+ tests to 2+. this workarounds made me think that maybe we should use the extension _.jsx/_.react.js for our react files, i think it might help too when using reactify.
To be honest going through Grunt I was still getting times of +20s, got
React working with Karma and total time is about +4/5 secs.
"jest": {
@adjavaherian be careful with that if you're using automatic mocking: https://github.com/facebook/jest/issues/176
I fixed this problem that only appeared in my VM environment (cf : http://stackoverflow.com/a/13703132). Now tests are still slower than what I would expect but way faster than before the vagrant fix ( 60 seconds -> 6 seconds for my test suit)
I agree Mocha is the way to go. Up to almost 900 tests and it takes about 4 seconds.
@amasad Is there an option with Jest to build up a cache for compiled files similar to what the babel-loader allows in the cacheDirectory option? - https://github.com/babel/babel-loader#options
@amasad What I did was to measured the time each step in running `jest` took for completion.
Switched to Mocha + Sinon. Never been happier.
any performance updates? just picked up jest with es6 and babel-jest, but running 2 simple tests in > 10 seconds :-(
Jest with es6 for me is completely unusable. it takes 10+ seconds just to start up, and then it takes 2s to run the single test I have at the moment. I was expecting a lot more, switching back to karma :(
Hi, is Jest suitable for non React testing? Would like to have a common standard for both react and non-react apps in our team.
Thanks @cpojer üòÄ
@cpojer after upgrading using `npm install jest-cli@next` I'm having problems specifying `dontMock`. By which I mean, before the update (using jest@0.8.2) this line works properly:
It's a bit of a hack job but:
// Provides various polyfills during testing.
} : undefined ;
Using @jacobstr's approach, I needed to add `<rootDir>/node_modules/source-map-support` to `unmockedModulePathPatterns` in my jest configuration. Otherwise I was getting the error:
I don't have much experience with Node yet so I might be missing something here, but it at least fixed my problem and am now seeing all test results logged to console.
Sorry, have not had a chance to use Jest again since submitting this. I should hopefully get some time to look into this in the next week or so
npm ERR! not ok code 0
beforeEach statements outside of describe statements do not execute before each suite like they do in jasmine.
See second paragraph in the jasmine documentation.
https://github.com/pivotal/jasmine/wiki/Before-and-After
Arthur
@cpojer do we need to update jest in order to have this fix ?
"jest": {
"setupTestFrameworkScriptFile": "<rootDir>/tests/unit/setup-jasmine-env.js",
And in `setup-jasmine-env.js` I have:
require('jasmine-reporters');
jasmine.VERBOSE = true;
The error I get is `NodeJS attempt: Arguments to path.join must be strings` or `NodeJS attempt: Object [object Object] has no method 'join'`. I've tried to debug it, but unfortunately you cannot set a debugger in a Jest test.
Is there a way I can make Jest work on Jenkins?
https://github.com/palcu/jest-example
Got this to work by adding to jest config
"./node_modules/jasmine-reporters"
jasmine-reporter.js |      100 |      100 |      100 |      100 |                |
got the same problem as @megawac , DId you manage to work around that ?
I did, I'll comment tmw (not with same library)
jest/jasmine setup file for Junit results
var jasmineReporters = require('jasmine-reporters');
var reporter = new jasmineReporters.JUnitXmlReporter({
filePrefix: 'junit-'
jasmine.getEnv().addReporter(reporter);
Create a file, something like `setup-jasmine-env.js`, that performs the following:
const reporters = require('jasmine-reporters');
filePrefix: 'jest-junit-result-',
jasmine.getEnv().addReporter(reporter);
"setupTestFrameworkScriptFile": "<rootDir>/jest/setup-jasmine-env.js",
Still, this way of integrating junit output feel a bit hackish. Will try to hack a bit the jest codebase and see if i can come up with a PR.
@th3fallen The way I did that was to create a separate jest config file:
In `./jest/jest-junit.json`:
"setupTestFrameworkScriptFile": "./jest/setup-jasmine-env.js"
const reporters = require('jasmine-reporters');
filePrefix: 'jest-junit-result-',
jasmine.getEnv().addReporter(reporter);
jest.runCLI({
@volkanunsal it is true I dropped the ball on this - A few days ago @carrbs opened a new pull though https://github.com/facebook/jest/pull/246
Can I push the line and ask whether aliases will work? (#246)
Jest seems to be calling node-resolve like this:
I've tried to use istanbul:
> istanbul cover node_modules/jest-cli/bin/jest.js
But got error:
https://github.com/gotwarlost/istanbul/issues/220#issuecomment-49512538
@jeffmo @simenbrekken do you feel that @simenbrekken 's approach in https://github.com/facebook/jest/issues/101#issuecomment-50983550 is a reasonable starting point for a more complete implementation, or would deeper work (in jest? istanbul?) be needed to properly support coverage?
Yeah love it! its a game changer for me and something Jest desperately needed. Hopefully they merge soon.
npm ERR! not ok code 0
"test": "jest"
"jest": {
"jest": {
"jest": {
https://travis-ci.org/hammerlab/cycledash/builds/38199591 (passed: added a "cat" statement)
@dheniges thanks. After removing relative path it started working on my Windows 7.
"jest": {
"jest":  {
"jest": {
// jest.conf.js
src = traceur.compile(
{ experimental: true }
@randylien You can get much more ES6 support in addition to full React/JSX support in 6to5. http://6to5.org/docs/usage/jsx/
package.son
"jest": {
cc @benjamn @jeffmo @tomocchino
See also #28, probably a dupe.
![jest-issue](https://cloud.githubusercontent.com/assets/1245446/3600866/0fefb3c2-0cfc-11e4-84c2-98464ba48331.png)
I wonder if it's something to do with how Bluebird is written? I'm really not sure. We resorted to overhauling our test setup because of this.
https://www.npmjs.org/package/mongoose
I have simular problems loading joi:
Looking at the code for `joi` and for `wreck`, I see that the "Property 'inherits'‚Ä¶is not a function" bit is triggered in both cases by a call to `Hoek.inherits`, such as [from `joi` source](https://github.com/hapijs/joi/blob/master/lib/date.js#L19):
Hoek.inherits(internals.Date, Any);
I also tried `dontMock` on `hoek`, but that didn't change things, either.
I'm guessing the only workaround is a manual mock in here somewhere?
jest.dontMock( "hoek" );
Presumably you wouldn't need the `http*` lines for `joi`, but I'm pretty sure you'll need at least the first two lines.
jest.dontMock('net');
jest.dontMock('topo');
jest.dontMock('moment');
jest.dontMock('../../node_modules/joi/index.js');
jest.dontMock('../../node_modules/joi/lib/index.js');
when I have `Joi.string().required()` in the schema.
Has anyone been successful testing code that uses `joi` with Jest?
FWIW, I did get `joi` to mock correctly. I had to add a few more `dontMock`'s for `hoek`:
jest.dontMock('net');
jest.dontMock('topo');
jest.dontMock('moment');
jest.dontMock('../../node_modules/joi/index.js');
jest.dontMock('../../node_modules/joi/lib/index.js');
jest.dontMock('../../node_modules/joi/node_modules/hoek/index.js');
$ jest
jest
.dontMock('bluebird')
FYI here is what I did to work around the problem. In my project root I have a file in `__mocks__/bluebird.js`
@amasad Thanks, this workaround is working for me.
@amasad workaround also worked for me :+1:
@amasad thank you for the workaround.
``` log
I'm sorry because i don't understand the rootDir here.
"jest-cli": "^0.1.17",
"mocha": "^1.20.1",
"sinon": "^1.10.3"
"jest": {
cd testjest
./node_modules/.bin/jest
touch sum.js
"test": "jest"
> jest
> vagrant@precise32:/vagrant/test$
Now it worked using a new vagrant box
_hashicorp/precise64_
## koTest.js
ko.applyBindings(new PersonNameViewModel("Chandra", "Reddy"));
//end of koTest
jest.dontMock('../koTest');
require('../koTest');
var target = new PersonNameViewModel("Chandra","Reddy");
expect(target.fullName()).toBe("Chandra Reddy");
Chandra.
jest.dontMock('../d3include');
Oh, I spend a couple of minutes to find this issue. It's hard to understand why I not use Mocha instead of Jest.
Now the problem is when testing with Jest, the non-existed key's value in an object doesn't equal to undefined.
my_obj['b']===undefined; // should return true, but when test with jest, it returns false.
my_obj['b']===jasmine.undefined; //this returns true
one[key] === jasmine.undefined
This seems to be tricky, when I use react, jest, fluxoor and firebase together,somehow the result is that after loading these code, myobj[**not_existed_key**] === undefined is false. Only typeof myobj[**not_existed_key**] == 'undefined' is true
> jest
> jest
im over
This was a blocker for us. :-( We moved on to karma+mocha, etc.
@aaronshaf that's sad
jest.dontMock('../plop');
jest.dontMock('../plop');
As odd as it is, I've encountered this bug too, the workaround I'm using is to manually blur the element in the teardown step of the test.
:+1: I actively use CSP (via [js-csp](https://github.com/ubolonton/js-csp)), so it would be pretty nice if I could do something like this:
Here is WIP update to jasmine 2.x: https://github.com/facebook/jest/pull/330
Optional Jasmine 2.x support was added to #330
Well, sir Bot, it's quite a relevant issue still :cake: but human beings seem to be aware of that wrt #330
Oh I'm very patient @cpojer, I just wanted to interact with that inquiring bot of yours :)
Thank you so much for Jasmine 2 support !
@cpojer how do I specify this in the command line? I tried this but I still get jasmine1 being used
Using Jest CLI v0.8.2, jasmine1
@QuantumInformation
I was able to enable Jasmine2 with the following config:
"jest": {
"test": "jest"
root
+ + app
+ + + foo.js
+ + lodash
"jest":  {
jest.setMock('lodash', 'lodash');
jest.setMock('kew', 'kew');
// ../foo and ../bar are my own modules
kew
kew
foo
bar
lodash
kew
foo
bar
\\ foo.js
\\ __tests__\foo-test.js
jest.dontMock('../foo.js');
‚óè Jasmine ‚Ä∫ it should not fatal on undefined exceptions
- Throws: undefined
‚óè Jasmine ‚Ä∫ it should not fatal on undefined exceptions
- Error: Peek-a-boo!
cody@possum jest-test $ npm test
> jest
npm ERR! not ok code 0
"jest": {
``` coffeescript
resourceType,
@messfromspace are you using coffeescript by chance for your other files? It seems like haste is not loading coffeescript files properly and therefore returning `user::` as the module id for anything coffee... so when you dontmock one, it is the same as not mocking the others.
`testPathDirs`
- Jest uses the wrong entry point (the one for node instead of browserify)
"test": "jest"
"jest": {
https://github.com/feifanzhou/Tunetap-demo/
"jest": {
jest -v
BTW, a more bullet proof/paranoid version of my code woud be:
touch moof.js
mkdir __tests__ && touch __tests/moof-test.js
And moof-test.js:
jest.dontMock('../moof');
Run `jest -o`:
$ jest -o
another crash but that has to do with Haste).
@spicyj Thanks for the help on IRC :+1:
$ jest -o
ulimit -n 10000 # or some other big value
Since this driver is always asynchronous, is there a way to do this with Jest ?
mocked
@gbbr That's correct.
riot.route 'todos/edit/1'
expect(paras).toBe '1'
>     riot.route 'todos/edit/1'
>       expect(paras).toBe '1'
waitsFor is not a thing in jasmine 2 so how do you it there?
Just so you know, jasmine-pid doesn't seem to work with Jasmine 2 at all.
Jasmine
Who is this jasmine? And why so special?
@Stuckwithaloser75 [Jasmine](http://jasmine.github.io/edge/introduction.html) is a JavaScript testing library.
Jasmine is a behavior-driven development framework for testing JavaScript code. It does not depend on any other JavaScript frameworks.
"jest": {
but that doesn't work because `jest` isn't defined! I suppose I could/should use unmockedModulePathPatterns for this, but all of this behavior was surprising to me.
`jest` too?
Hey Jeff, I'm actually on a mac. I git cloned the repo and I also wrote each file by hand and got the same result. When I run `npm test` in `/tutorial` and `/get_started` folders each individual test passes. Is there additional setup im missing for the React example? Was I supposed to create an index.html and add the JSX script perhaps?
node ../../bin/jest.js
dyld: lazy symbol binding failed: Symbol not     found:__ZN2v816FunctionTemplate3NewEPNS_7IsolateEPFvRKNS_20FunctionCallbackInfoINS_5V  alueEEEENS_6HandleIS4_EENSA_INS_9SignatureEEEi
I assume 'invoke' was missing (or fire, or something else?) and s/it's/its/.
npm ERR!
npm ERR! not ok code 0
It fails because `jQuery.mock` is `undefined`.
Why? Because on windows directory separator is `\` and on some other systems it is `/`, so some regexps (https://github.com/facebook/jest/blob/master/src/TestRunner.js#L78, https://github.com/facebook/jest/blob/master/bin/jest.js#L198) always gives false.
But still an error:
at findNative (C:\dev\jesttest\node_modules\jest-cli\node_modules\node-haste\lib\FileFinder.js:91:17)
Someone suggested using this as a shim, has anyone tried it?
https://github.com/Jakobo/redefine
So, in my Jest preprocessor I've implemented only (2) point.
The tool I have used was https://github.com/Skookum/recast-to-cjs for converting code from AMD to CommonJS style.
> jest
@spicyj You got it!
Isn't this possible?
Jest configuration:
"jest": {
"jest": {
"jest": {
"test": "jest"
"babel-core": "^6.2.1",
"chai": "^3.5.0",
"chai-jquery": "^2.0.0",
"jest": "^17.0.3",
"mocha": "^2.4.5",
"node-sass": "^3.8.0",
"sass-loader": "^4.0.1",
"striptags": "^2.1.1",
"axios": "0.13.1",
"babel-jest": "^17.0.2",
"lodash": "^4.16.3",
"material-ui": "^0.13.0",
"redux-form": "^5.3.2",
![AW YIS](https://cloud.githubusercontent.com/assets/91933/2975394/50cd2080-db94-11e3-9f71-af6c207ed811.png)
13:23 <chenglou> jeffmo: what's the reason behind using toBeCalled rather than jasmine's toHaveBeenCalled?
13:24 <‚Ä¢jeffmo> chenglou: good question on toBeCalled/toHaveBeenCalled ‚Äî I‚Äôve wondered that myself (it‚Äôs just layover from jst really). I suspect it was to leave support for using regular jasmine spies if you wanted to
Coming from the Angular world this was a bit confusing to begin with. I also would like test to mean how many it() calls even if this isn't on by default.
Not sure how that could work.
