  Can you try again with `DEBUG=nightmare* node yourscript.js` when you run the script? Much more helpful debugging messages will be sent to your console Ahh, just realized you're running the script under `electron`, not `node`. I have no experience doing that, sorry :/  [`nightmare-download-manager`](https://github.com/rosshinkley/nightmare-download-manager) or [`nightmare-inline-download`](https://github.com/rosshinkley/nightmare-inline-download) might help you solve this.  Two questions: one, why are you using `.use()`, and two, what is `x`?  See #434 and #452.  It has to do with preventing virtual desktop switching.

You can deactivate `alwaysOnTop: false` by passing it in as an option.  I'd leave the default as `true` there as it does fix a known problem.  I'm betting you have a race condition with your `.evaluate()` - since the page is refreshing every 1s (per the `meta` block), your `.evaluate()` call may be executing against elements that don't exist (anymore or yet).

Do you have a `.catch()` block?  If so, what does it say?  The short answer is yes - you could certainly use `.evaluate()` and use `document.querySelector()` to get the DOM element, then you have the entirety of CSS to play with.  Off the cuff:

```js
.evaluate(() => {
  var element = document.querySelector('.some-class-name');
  element['new-property'] = 'new-property-value';
  delete element['custom-property'];
})
```
(What I can't recall off the top of my head is if `delete` will actually delete the inline style.  You might want to have a look at MDN.)

Alternatively, you could also use `.inject()` to pull in, say, jQuery to do the same.  This smells like a captcha.  Have you used `show: true` or `.url()` to verify you're getting redirected to the same place every time?  Can you provide a sample page where you see this issue?  Closing this as it seems resolved.  "Before the page is fully loaded" may be a bit misleading.  Before `dom-ready`? No.  Before client-side scripts have finished rendering the page? Possibly.  What are you trying to do?  Could you supply a repro or a minimum case for what you're trying to do?  You could use multiple Nightmare instances instead.  Using one instance for multiple concurrent operations  is not supported.  Two things: One, you might want to execute with `DEBUG=*`.  That will give you more helpful errors.  Two, the problem here is there _won't_ be a "full stack trace".  The function that does the evaluation is created, serialized, and reconstituted in the Electron instance, and as such, is sort-of-kind-of out of band.

That said, there was a conversation sort of on this topic a while back in #646.  Might be worth a read and +1. :)

Closing this issue for now as the issue seems resolved.  When I type "npm install nightmare", installation is stuck like this and never proceed:

```bash
rico345100ui-MacBook-Pro:jasmine rico345100$ npm install --save-dev nightmare
(node:21564) fs: re-evaluating native module sources is not supported. If you are using the graceful-fs module, please update it to a more recent version.

> electron@1.6.1 postinstall /Users/rico345100/Desktop/learn/jasmine/node_modules/electron
> node install.js
```

I almost wait 20 minutes, but nothing changed. I removed whole node_module and retried, but still same.

I'm using
- node v6.9.2
- npm v3.10.9 Nah, it just working now. Looks like some kind of network issue. Sorry, I just re-run the install, same issues happens again. When I forcely stop install and re-install, it saids:

> Electron failed to install correctly, please delete node_modules/electron and try installing again

So remove node_modules and npm install, same problem continues.

Oh, I forgot to mention it, I'm using MacOS 10.11.3 El Capitan.  thanks!  That's how it should work, and I cannot recreate the behavior you're seeing.  Can you provide a minimum repro?  #1024 is different, for what it's worth: that's talking about a child window.  Popups are, for now, not going to work (unless you create the windows yourself, like with `nightmare-window-manager`).  See #593.

Memory serving, partitioning has never worked particularly reliably, but I _thought_ that in your case @entrptaher that the `browser1` instance had to end to write the session to disk to then consequently get picked up by `browser2`?  Also, what, exactly, would be getting persisted?  The login cookie?  This would introduce an awful lot of lifting that the internal queue currently takes care of - two things that come to mind off the top of my head.  One, starting Electron is a queued action, meaning the instance does not start Electron until the first action is called as a part of the queue, and we get that for (more or less) free.  Wouldn't your approach mean all functions would have to check that?  Two, custom action creation is injected as a part of the queue after the Electron instance is started and the browser window sugar is propped up but before any of the user-queued actions are executed.  How would that work?  I've had similar issues with Chromium (and Chrome for that matter) bleeding memory.  Slack and Gmail have traditionally been my go-to examples of this - leave them open for any extended period of time, and eventually the browser process will gobble up all of the available memory.  I haven't had a real chance to dig into if it's a Chromium bug or a product bug, but I suspect Zapier may have a similar problem. >The same issue doesn't seem to happen in Chrome. 

Mmm, that's troubling.

>I should also note that the bleed is quite fast: the usage seems to grow ~100M every few seconds.

That's even more troubling.  When I've seen memory leaks, I'm talking on the order of megabytes an hour (if that), not an instant gobble.  My knee-jerk would be to say "try Electron's latest," but you've already tried that.

A quick gander through Electron's issues yielded electron/electron#8051 and electron/electron#7350 which seem close-ish?  Are either of those close to your case?

Also, is a minimum repro case possible?  I'm a glutton for punishment and would like to see this myself.

>Thanks for the quick response, by the way.

No problem.  Trying to get better about it, so far so good.

>I really appreciate all the work you've done on this project!

D'aw.  I can't take hardly any credit, but thank you anyway.

  Popups are not directly supported by Nightmare, and while I am certain the `preload` script doesn't get inherited with popup windows, I would not be surprised if other settings such as proxy are also not inherited.  This seems like an issue you should open with the `DefinitelyTyped` project, as we don't have any control over their typedefs. Closing as this is a `DefinitelyTyped` issue.  I haven't had a chance to dig into load testing Nightmare recently, and now you have me curious.  I'll see if I can carve out some time to tinker with this at some point soon.  I suspect you're _probably_ right, that this is a memory issue, but I haven't seen Nightmare start popping up windows unless they're generated from the site, and even then, I can't remember exactly the last time I saw that behavior.

I'd be curious if you set up something like [`nightmare-crash-reporter`](https://github.com/rosshinkley/nightmare-crash-reporter) if that might yield any useful information.  (I kind of doubt it, but hey, can't hurt to look.)

>  Some of the links that are traversed are apparently links for zip downloads. Is there any way to configure Nightmare to ignore these sorts of URLs?

If it would help, [`nightmare-download-manager`](https://github.com/rosshinkley/nightmare-download-manager) has an `ignoreDownloads` option that might help you skirt downloads specifically.  Is that what you're after?

  JPGs are not supported yet, pending #950.

If you want a PNG buffer, don't pass the path parameter.  Something like:

```js
nightmare
  .screenshot()
  .then((buffer) => {
    //buffer is a buffer of the PNG
  })
```

_edit:_ spelling error  I think the documentation is a little misleading here: the Nightmare `.pdf()` function does not take a callback as the second parameter.  In your initial example, Nightmare is treating the options object you're passing in as the path, and the function you're passing in as the internal `done` callback.  In the second, it's treating the options object correctly, but treating the function as the internal `done` callback.  This will almost certainly hang and not continue.

If you want the PDF as a buffer, try something like the following:

```js
.pdf({
  pageSize: 'A4',
  printBackground: true
})
.then((pdfBuffer) => {
  //use the pdf buffer
})
```  i had this same issue on an airplane, worked fine once i was on low-latency ground internet. definitely an electron issue though, not a nightmare issue.  Hm, can you provide more information?  Is the Nightmare script running on a box behind a firewall or anything else that would prevent network requests?  If not, could you provide a minimum repro script? Closing for the moment.  Feel free to reopen/open a new issue if this crops up again.  This is _very_ similar to #625.  Modified from that issue slightly, and probably _way_ oversimplified:

```js
var Nightmare = require('nightmare');
var vo = require('vo');
var nightmare = Nightmare({
  show: true
});

var run = function * () {
  yield nightmare.goto('http://example.tld');

  while(yield nightmare.exists("some-button-selector")) {
    yield nightmare.click("some-button-selector");
  }
  //... logic to do something with the posts ...
  yield nightmare.end();
};

vo(run)(function(err) {
  console.dir(err);
  console.log('done');
});
```

Note this carries the same stipulations:  This is _very_ naive, and if you're not careful, could end up causing a hang.  It looks like you're missing `libxss`?  It looks like Atom also [had this problem](https://github.com/atom/atom/issues/13176), do any of the solutions there work?  Based on the example you posted, you're trying to re-use the same Nightmare instance across multiple requests.  This won't work as if you have multiple requests come in, the actions for the later requests will be added to the currently executing context.  This is further complicated because you're also `.end()`ing the instance, rendering the Nightmare instance unusable after the initial request.

If you move the Nightmare instantiation into the Express `post` method, you will likely have better luck, but be careful: this method will not scale particularly well.

(I'll cross-post this answer on SO.)  Hm, I _think_ the `page` event - specifically with errors - is for on-page javascript errors (I can't remember offhand if it's parsing and uncaught exceptions or just uncaught exceptions).  I don't think it will capture sourcemap parsing issues or websocket connection issues.

For the `WebSocket`, I'm not sure you'll be able to capture the error short of writing a wrapper you can load up with preload, kind of akin to how `console` et al is handled.  Nothing jumps out at me in the Electron docs.  (Someone else out there happen to know?)  The sourcemap errors seem like they _should_ cause something to get called, but again, nothing jumps out at me.

Pondering out loud, have you given the Electron [`debugger`](http://electron.atom.io/docs/api/debugger/) a look?  You might be able to use `debugger.on('message')` to capture those problem events using a custom action.
 @keithkml If you come up with a custom action using the debugger, I'd be _very_ interested in seeing it.

Also, I neglected to mention - if you go this route, you will likely not be able to use the debugger tray (or you'll have to be _very_ judicious about opening and closing it) as Chromium only allows one attachment to the debugger at any given time.  I don't know that you'd hit that, but I thought I'd say it out loud to prevent you from head+desk.

Closing for the moment.  Nice catch, thanks!  Nice, thanks!  You could define a custom action for this.  Try something like...

```js
var Nightmare = require('nightmare');

Nightmare.action('show',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('show', function(done) {
      win.show();
      done();
    });
    done();
  },
  function(done) {
    this.child.call('show', done);
  });

Nightmare.action('hide',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('hide', function(done) {
      win.hide();
      done();
    });
    done();
  },
  function(done) {
    this.child.call('hide', done);
  });


var nightmare = Nightmare({
  show: false
});

nightmare.goto('http://example.org')
  .show()
  .wait(3000) //<-- here is where you'd want whatever your actions are, here i'm just using a wait
  .hide()
  .end()
  .then()  This sounds like an error from the javascript on the page - the page errors get bubbled up from Electron through the preload script. 

There is an edge case, though, where I suppose the error could get emitted without an error with a stacktrace.  I _thought_ there was a PR to account for this issue,but it's entirely possible my memory is faulty.  It looks like that may be what you're hitting.  To check that's what the problem is, you could override the preload with a custom event listener on `'error'`.  First things first: go read [Asynchronous Operations and Loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md).  Your original post is a similar use case.

As for why it freezes: I guess my first question would be, how many containers are there, and second, how are you ending the Nightmare instance?

Finally, your recursion approach _could_ work, and you're already pretty close.  From the hip, I think if you rearrange it a little, like this:

```js
let m = new Nightmare({
    width: 1600,
    height: 900,
    show: true,
    waitTimeout: 12000
});

function Iterate_Containers(count){
    return m
    .goto(`https://www.ttilgb.com/uiArp02Action/searchContainerInformationListByCntrNo.do?srchTpCd=C&cntrNo=${containers[count]}`)
    .wait(500)
    .screenshot(`./Desktop/${containers[count]}${count}.png`)
    .then(() => {
        if (count < containers.length) {
            return Iterate_Containers(count+1);
        }
        if (count === containers.length) {
            return;
        }
    });
}

m
.goto('http://www.ttilgb.com/main/index.do')
.wait(1000)
.wait(`#pUsrPwd`)
.insert("#pUsrId", hanjin_credentials.id)
.insert("#pUsrPwd", hanjin_credentials.pw)
.click(`img[onclick="clickLogIn()"]`)
.then(() => {
  return Iterate_Containers(0);  
})
.then(() => {
    return m.end(() => { console.log(green(`\nSuccessfully grabbed ${chalk.bgRed.white.bold(count)} containers release information from [${chalk.bgCyan.white.bold(`HANJIN`)}] terminal.`)) })
})
```
...you may have better luck.  What you have is fine. You could probably accomplish a close approximation using the [asynchronous form of `.wait()`](https://github.com/segmentio/nightmare#evaluatefn-arg1-arg2).  Waiting for a resource like you have it would be kind of tough without the action as you have it written, though.

Answering your second question: that usually happens when you attach an action to Nightmare multiple times.  That error was put there as a warning in case there were naming collisions for actions, which adding the same action multiple times would certainly cause.  Looks good to me.  Considering this issue closed.  If you have any more qusetions, feel free to reopen/open a new issue.  Wouldn't hurt to keep up on the Electron version, especially if the tests pass. I'd be open to this.  It looks like that site's SSL certificate is not valid.  You can direct Nightmare to ignore bad certs, although it's not recommended.  Try:

```js
var nightmare = Nightmare({
  switches: {
    'ignore-certificate-errors': true
  }
});
```

_edit:_ ctrl-enter is the worst.  Awesome work dude! Thanks!  More bizarre still, I don't think `.userAgent()` has been touched in some time (almost a year!).  I'd say it might be an Electron issue, but there's not a version difference between 2.9.0 and 2.9.1.

Anyone else with a Mac out there that can validate this issue?  Ahh thanks! Sorry to bother, but I'm getting this from the console:

"Not allowed to load local resource: chrome://version/?get-har"

The script runs successfully, but should I worry about this error? I only noticed now, but HAR is not correct.

I have the following entry: 

```
"response": {
				"_transferSize": 947,
				"bodySize": 290,
				"content": {
					"compression": 20,
					"mimeType": "text/html",
					"size": 310
				},
```

Where is the body? It says it's 310 bytes, but no body is present? So for anyone stumbling into this, I have decided to use browsermob to capture my har content:
https://github.com/lightbody/browsermob-proxy

It acts as a proxy, produce reliable HAR and I can still use Nightmare if you loke.  How are your Nightmare instances getting created?  It looks like the instance isn't ever created based on your source.  Also, what version are you using?  Are you getting errors for the instances that are hanging?

  @jekku Babel inserts a function to handle this for us:

```js
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
``` I do not see the benefit in this change. It seems like unnecessary cosmetic stuff, as functionally every example code block will work exactly the same.  TL;DR: don't use `.run()`.  It's a holdover from Nightmare 1.x.  Use `.then()` instead.

For a more protracted conversation with more information/links, see #575.  Also, this [example](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/callbacks.md) in `nightmare-examples` may be of some use.

Merging with #575.  @ericadamski how are you running async/await?  Node 7 or Babel or...?  Related, yes, but not the same. I think it's closer to #859 - the TL;DR is you shouldn't use `.action()` for defining custom chains.  Use `.use()`.  Presumably, yes?  It depends on what your needs are, but you can certainly set up the viewport and useragent to mimic a mobile device.  Beyond that, Electron is more or less a full Chromium instance, so there may be some storage differences with what you see no the mobile (I can't think of one offhand, but it wouldn't surprise me).  I don't feel like that necessarily answers your question - what are you trying to test/do?  @navossoc the _unload_ bindings are preventing the page from fully loading?  o_O

That particular chunk was added so if you attempt to navigate away from a page, it prevents an unclickable modal dialog from cropping up, which would cause Nightmare to freeze.  (Same goes for `alert`, `confirm`, etc.)

Under Nightmare 2.9.1, I could not recreate the behavior you're seeing.  Out of curiosity, what are you returning from `.evaluate()`?  There are multiple questions here, I think.

> Can Nightmare do multiple requests in parallel?

No.  Think of a Nightmare instance as a single tab on a web browser - it wouldn't make much sense to ask a tab to go to multiple locations at once, for example.

>  Is it ok to make new nightmare instanse with nightmare = Nightmare(); on rest call?

Sure.

>  Do I need to end it somehow, or nightmare.end() will be ok?

Yes, you'll need to end the Nightmare instance.  I doubt you'll want to reuse Nightmare instances across requests.

The one thing you'll need to keep in mind for the last two of the above answers: load.  Nightmare is a _bit_ of a resource hog.  If you expect your load to be fairly low and the Nightmare script is fairly quick, a new instance per request is probably reasonable.  Otherwise, you'll need to put together some sort of resource management.

> Is there any way to have for example pull of 10 redy to render pages and use them while requests are coming?

Not exactly sure what you're asking here - are you asking if Nightmare could prerender pages for a request?  Can you expand on this a bit? > Is it a good practice to reuse nightmare ?

You can, but be mindful of ending the instance and sharing session/partition data.  The way you have it set up, though, you're not reusing the same instance but creating a new instance every time, which is also fine.

> Any problems like memory leaks?

Great question, and the answer is probably.  It largely depends on how careful the site you're hitting is about cleaning up resources in client-side javascript.

I'm going to go ahead and close this issue for now.  Feel free to open a new issue if you have more questions.  This is (kind of) by design - using `highlightRect` as opposed to touching the DOM directly solves a _lot_ more problems than it creates (see #927 and the issues referenced there).

I wonder if the `HIGHLIGHT_STYLE` could be determined at runtime to mimic the top left pixel, or if this is a case where the highlighted pixel isn't fully rendered at screenshot time?  Might be worth some experimentation.

/cc @Mr0grog, as he is way closer to this than I am, and might have more ideas.  @coyotte508 do you have a small example of your problem?  Depends on where you need to make the call from.  Are you trying to make the call from the Electron client (from the loaded page) or from your script?

From your script, you could use `.then()`:
```js
var someApi = require('SomeApiLibrary');
nightmare
  .goto(someUrl)
  .then(()=>{
    return new Promise((resolve, reject) => {
      api.someRestCall('parameter', (err, result) => {
        if(err) return reject(err);
        resolve(result);
      })
    })
  })
  .then((apiResult) => {
    ....
  });
```

Doing so from the client is marginally more complicated, but you could easily inject something that handles HTTP requests for you (like jQuery, for example).  I _think_ that Electron will display XML data rendered with the pretty XML rendering guts built into Chromium, which would explain the "rendered" view you're getting with `document`.

Try selecting out `webkit-xml-viewer-source-xml` - something like:

```js
nightmare
  .goto('https://somesite.com')
  .evaluate(() => document.querySelector('#webkit-xml-viewer-source-xml').innerHTML)
  .then((xml) => {
    fs.writeFileSync('my-data.xml', JSON.stringify(result));
  })
```  Your `clearCache` method takes a `message` parameter, but you're not passing anything to the call in your Nightmare chain.  What happens if you try changing `function(message, done)` to just `function(done)`? @contobob What you have there will almost certainly not work: `win.webContents.session` does not exist until you navigate away from `default:blank`.  (Why would you try to clear a session cache before it exists?)

If you're having problems with those plugins, i would encourage you to open issues there. @ysimonson It _does_ print B and C, just not to `stdout` of the node process.  Instead, those get printed (rightfully) to Electron's `stdout`.  Consider your above script, but instead of running with `node example.js` you run with `DEBUG=electron* node example.js`.  You'll see the following output:

```
  electron:stdout B +0ms
A
  electron:stdout C +358ms
```

... which is precisely what you would expect to see.  `B` when the action is created on the instance, followed by `A` when the action is called, followed by `C` when the action responds to the call. Bah, I realized I didn't answer the question of why it's not calling back: It looks like the clearCache callback isn't getting called.  I'll dig into that. In this particular case, it looks like `webContents.session.clearCache` never calls back, and it's not immediately clear why.  I'm inclined to say this is a bug with Electron: the source for [`clearCache`](https://github.com/electron/electron/blob/7f7df5a6dd083117bfa8175bf3ce1d52771eea6a/atom/renderer/api/atom_api_web_frame.cc#L236-L241) does not have a callback call, at least in my cursory look.  For contrast, compare that to [`clearStorage`](https://github.com/electron/electron/blob/bad130f623d1ed0de1a61bc3e82ae553fbf46364/atom/browser/api/atom_api_session.cc#L505) that does.

If you move the `done` call to the line after `clearCache`, does the cache actually clear?  This may be worth opening with Electron.  Thoughts?

 >Custom actions worked if I used it after a goto, but sometimes you need actions to do before going to any url.

I think I understand what the problem is now after seeing your example.  When `Nightmare.action()` (on the prototype) is called, there's an action put on the prototypal queue to execute action methods on all created instances.  Looking at your gist, it occurs to me there might be a bug when immediately calling a plugin method.  Poking around in the unit tests for Nightmare, I don't think this particular case is tested for and is probably worth adding to at least prove out that's not the problem.

> Exceptions on electron side should be catched and redirected to the client and throwed there again with a note that it happened on electron side. Currently it crashes without infos.

This is a somewhat complicated topic.  See #646.

> ...and the optional value should be at the end - I can imagine the reason was the order, whyever...

This is because `.action()` already existed, and I wanted to have as much backwards compatibility with previous versions as possible.

> The API documentation has following flaws:

You missed a few. ;)  Kidding aside, this has been on my backburner for a long time - it's why [`nightmare-examples`](https://github.com/rosshinkley/nightmare-examples) exists.  I'd _like_ for this to all be wrapped up on github pages, but I haven't made it that far yet.

>I saw that @types/nightmare is currently on version 1.6, older than 2 years.

PR DefinitelyTyped?

> If you create custom actions, almost same kind of error happens no matter the callback.

I don't think that's true as there are a _lot_ of plugin libraries that use this.  That said, I'm _almost positive_ you've hit a bug with either how caching works in Electron and/or with how actions are created on the instance after Electron is started.



  Depending on what your needs are, you _might_ want to have a look at [`onBeforeRequest`](https://github.com/electron/electron/blob/master/docs/api/web-request.md#webrequestonbeforerequestfilter-listener) instead.  You may also want to have a look at [`nightmare-load-filter`](https://github.com/rosshinkley/nightmare-load-filter) as it might get you closer to what you're after.

Are you planning on doing an action with the images downloaded, or are you just trying to log them? Considering this resolved for the moment.  If you have any more problems, feel free to reopen/open a new issue.  That is one way, another is using a CDN instead.  Going to go ahead and close for now.  There isn't a _real_ clean way to pass arguments to the preload, I made a passing attempt at doing something like this in #374 (if I'm reading what you want correctly).

I'm also not real clear on what you're trying to do: why are you using events for sending data from preload to your action?  Did something change on the source site?  Sounds fixed. :)  Closing.  Isn't this because the Nightmare instance is a `.then()`able itself?  If you're resolving nightmare after it's run a chain, it's trying to resolve the now-currently-empty action chain, which will resolve to `undefined`.

Try wrapping the instance in an object literal, like `res({nightmare:nightmare})`.  Would something like that work?
 @entrptaher Isn't that effectively the same thing as using (the admittedly not-well-documented) `.use()`?

Anyway, seems like this issue is resolved for the moment.  Closing.  given that the pdf printing happens under the covers in electron, it's likely an electron issue:
https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L444  @jekku - @urlysses' answer would only work if the HREF attribute contained the text in question, not the text element under the anchor.  In other words, the answer - while useful - didn't address the question.

From here, @pfftdammitchris, I think you have two options off the top of my head.  One: you could use `.evaluate()` and try to issue clicks directly.  Something like:

```js
nightmare.goto('http://www.example.org')
  .evaluate(()=>{
    var elements = Array.from(document.querySelectorAll('a')).filter(a=>/information/.test(a.innerText))
    //you'll probably want to do some validation here
    elements[0].click();
  })
  .end()
  .then()
```

This clicks directly on the first element that matches text in the anchor's text, in this case, `information`.  This approach doesn't _always_ work, it depends on the JS framework you're using - in your case it looks like Angular, so your mileage may vary.

Option two: add a class to the anchor you want to click, then use the existing `.click()` machinery to issue your click.  This may work better in your situation, especially if you decide you'd rather use something like [`nightmare-real-mouse`](https://www.npmjs.com/package/nightmare-real-mouse) instead of the internal click events to Nightmare:

```js
nightmare.goto('http://www.example.org')
  .evaluate(()=>{
    var elements = Array.from(document.querySelectorAll('a')).filter(a=>/information/.test(a.innerText))
    //you'll probably want to do some validation here
    elements[0].className += " my-click-class";
  })
  .click('.my-click-class')
  .end()
  .then()
```  Thanks for the update.  @Dnyg `httpResponse` is not defined because the parameters passed to `.then()` will be from the last action executed in the chain (with the exception of `.end()`) - in your case, `.screenshot()` (which doesn't return anything).  If you need the HTTP response, you can break up your chain with another `.then()` to perform logic.  Something like:

```js
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.goto("https://google.com")
.then(function(httpResponse) {
  if(httpResponse.code == 200) {
    return nightmare.screenshot('abc.png');
  } 
  else {
    //error condition?
    throw new Error('http response was not ok');
  }
})
.then(function(){ return nightmare.end(); })
.catch(function(){ return nightmare.end(); })
.then(function(){ 
  console.log('done');
})
```

@TheTechy your code suffers from the same issue - the additional problem here is you're trying to access `code` off of `httpResponse` which will cause an exception.  From your trace: ` ERROR: TypeError: Cannot read property 'code' of undefined` @TheTechy Ah, cool. :)  No problem, happy to help.  Do you mean setting the OS in `User-Agent`?  The can be set using [`.userAgent()`](https://github.com/segmentio/nightmare#useragentuseragent).  Note you'll need to set the entire user agent string.  @R0byn as @jekku mentioned, give #224 a read.

So starting from the top, explaining what you're seeing:

> Result: No errors, but also no console output. 

In the future, try running with `DEBUG=nightmare*,electron*` or `DEBUG=*`.  That will yield more verbose, useful output.

> Then tried the example in a shell on the Ubuntu Desktop - voila! Worked! :-)

This is because when you're under an Ubuntu desktop, you're running an X session of some flavor, meaning there's a framebuffer running.  Electron requires a framebuffer to be running to work properly.

> ... and is being pushed to a CI (Which is similarly, a shell ONLY env).

_Most_ (all?) of the CI solutions I've seen have a framebuffer of some flavor running (usually xvfb).

> Is there a way to get nightmare scripts running with this combination

Yes.  Install `Xvfb`, read through #224 and the suggestions there.  You can either have `Xvfb` always running or use `xvfb-run` to manage starting/stopping the service for you.  Your setup under that scenario should work fine.

I'm going to merge this into #224 and close this issue.

  @dfenstermaker in your original post, though, you said it was not clicking on `form button#go-button`.  Is that button the problem, or is `tos-accept-button` the issue?  If it's `form button#go-button`, what happens if you have `.wait('form button#go-button')` prior to the click?

_edit:_ missed a closing apostrophe  thanks!  `.screenshot()` does not take a function callback (at least, not anymore).  What version of Nightmare are you using, @tlshaheen? @jekku I don't think that does what you think it does, and now that you've pointed it out, I think I see the problem.  You _can_ pass a function like that, but it will do exactly what @tlshaheen said - it will prevent downstream execution of the Nightmare chain.  What that is looking for is the internal `done` callback as `.screenshot()` has optional parameters.

To make things clearer, an example might be helpful:

```js
nightmare.goto('http://www.example.org')
  .screenshot((err, buf) => {
    console.log('hello from screenshot callback');
    // do something with the buffer
    return "some value";
  })
  .end()
  .then((something) => console.log(something));
```

This will print `hello from screenshot callback`, but will never advance to the `.end()` because the `done` callback that tells Nightmare to move onto the next step - the one specified in the line you highlighted - is never called.

So while what i said is technically incorrect - `.screenshot()` _does_ take a callback, but it's supposed to be internal to make chaining work - I stand by my original statement.  I don't think `.screenshot()` takes a user-passable function callback as originally posted.

For completeness, if you wanted the buffer, the above example is easily fixed:

```js
nightmare.goto('http://www.example.org')
  .screenshot()
  .end()
  .then((buffer) => {
    // do something with the buffer...
  });
```

I'm still curious what version the original example was written against and/or where the example came from.  Hm, the only way I can think of off the top of my head to do this is with an [accelerator](https://github.com/electron/electron/blob/master/docs/api/accelerator.md).  Accelerators let you send keys like the arrow keys.  Out of the box, I don't think Nightmare supports accelerators, but I think you could write something with `.action()` and [`webview.sendInputEvent()`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#contentssendinputeventevent) to accomplish what you're after.  @yodfz not sure what you're expecting to happen here: if the `.js-alert` element does not exist, that function will never return, and eventually the wait timeout will be hit.  You probably want an `else` statement to call `done()`, if I had to guess.  thanks!  happy to consider if there's a test case and comments on an updated PR, thanks! yeah a unit test that shows it breaking in the old code, and fixed in the new code :) ðŸ‘   Again: this is a bug with `nightmare-download-manager`.  Moving the conversation [back](https://github.com/rosshinkley/nightmare-download-manager/issues/9).  One question: if you're using the remote debugging protocol, doesn't that mean you can't use the debugger (or have the development tray) open at the same time?  If I'm not mistaken, this is the same issue that [`nightmare-upload`](https://github.com/rosshinkley/nightmare-upload) has.

It's also entirely possible this got fixed in a more recent version of Electron.  I guess what I'm beating around the bush and saying that either this needs to be tested for and/or should be included in the readme.  Otherwise, I'm +1 on this as it solves more problems than it creates, imho.

Thoughts? > :astonished: I was entirely unaware of that as an issue and hadnâ€™t tested it.

No worries.  I just knew this was a stumbling block in the past, thought I'd bring it up.

> Iâ€™ve added another commit that detaches the debugger as soon as weâ€™re done, which seems to resolve that.

I re-read what you had done and tinkered for a bit, I'm going to go ahead and say LGTM and that this should get included.  Thanks!  You can certainly do a conditional injection.  From the hip, something like:

```js
var nightmare = Nightmare();
nightmare
  .evaluate(()=> typeof jQuery == 'undefined')
  .then(jqueryDoesNotExist => {
    if(jqueryDoesNotExist){
      return nightmare.inject('js', 'jquery.min.js');
    }
  })
  .then(() =>{
    nightmare.click(mySelector) ...
  })
```
... should be close.  Is that what you had in mind?  Is your scheduled task running as the same user?  Could he default window size be different for the user that runs the scheduled task, and that the page renders differently result in a different client size?

What are you trying to do that this is an issue? Sounds like this issue is at least tentatively resolved, going to close it for now.  If this crops up again, feel free to reopen.  This is a bug with `nightmare-download-manager` most likely.  I see you've already opened an [issue there](https://github.com/rosshinkley/nightmare-download-manager/issues/9), so let's move this conversation there.  Hm, do you get any output from Electron if you run with `DEBUG=nightmare*,electron*`?

You _should_ be able to run multiple instances, but be wary of load - Nightmare is not cheap with respect to memory.  Memory serving, an instance costs ~30mb without doing anything particularly useful.

That said, I wonder if your script has a possible bug with how it handles session.  Are there any logins or cached credentials in your script?  You _might_ want to try setting up a different partition per request:

```js
nightmare = Nightmare({
  webPreferences: {
    partition: "my-partition-"+Math.random()
  }
});
```  @ewrogers is correct: `session` is not created until after you navigate somewhere.

It might be worth having the discussion: should Nightmare navigate to `about:blank` first?  I can't think of any side effects off the top of my head, but it might be worth sandboxing to see.

Thoughts?  I think this is very, very close to #521.  Is that what you're after? Formatting appears to be a bit weird, but it looks like you're using the error-first callback for `onBeforeSendHeaders` with an error every time.   Try passing `null` as the first parameter.

It also looks like, at least at first blush, the action callback is never called, and the Nightmare-callable function is not defined.  Is there a more complete example you can supply?  More as a reminder to self when I pull this in: A note will need to be added to the release notes as a _possibly_ breaking change.  It's possible some folks out there are depending on this side effect, and it's probably worth mentioning.

Otherwise, looks great.  Thanks!
  Are you running the ecommerce site under Electron?  If not, then no, this is probably not the solution you're really after.

There are tools out there for giving site demonstrations and guidance.  I have used [Hopscotch](http://linkedin.github.io/hopscotch/) with moderate success.  (Others may have suggestions too, and if you do, please feel free to leave them!)  Is that closer to what you have in mind?  DOM elements and DOM element lists are not serializable.  See [#567 (comment)](https://github.com/segmentio/nightmare/issues/567#issuecomment-209533871).  +1 on a PR for this.  You can override the [base timeout](https://github.com/segmentio/nightmare#waittimeout-default-30s) for wait right now.  Are you trying to add a timeout per call?

`done` is always the last argument to an action - the top of the funciton has `var done = args[args.length-1];` - is that what you're asking about?

_edit:_ had a bracket the wrong way.  Price I pay for not previewing before commenting :|  This has to do with the max texture tile size that Chromium can render - the texture tile size is limited (in general) by the hardware you're running.  It's _almost_ always 8k or 16k, and defaults to 16k.  [You can see it here for yourself.](https://cs.chromium.org/chromium/src/cc/resources/resource_provider.cc?rcl=1464366759&l=448-454)

You can also verify that if you're interested with [this gist](https://gist.github.com/rosshinkley/b5fb5061073756e926b791a66d62b24b) I threw together when I hit this same problem a while back.  I considered putting together a plugin for large format screenshots that are bigger than the texture size - something that would take small tiles and stitch them together manually, but I never got around to it.  Sounds like it might be worth doing. @jimmaay To be honest, it never got past a doodle in my notebook.  (Ab)Using the viewport size and moving it around was going to be a first pass, but you're right - a fixed (or anchored) element would definitely throw a wrench in that.  There are other rendering problems that could crop up with any sort of responsive layout, too, which is ultimately why I tabled the idea.  Still, as a science experiment to float out, it might be worth doing to see if anyone has ideas or another approach.  Also - spitballing - I know you can hook into the frame rendering buffer directly (that's how the current incarnation of screenshots work) - I wonder if there's some raw frame buffer magic that could be pulled off? > ...definitely many scenarios that this still doesn't cover.

Hey, if it works for your needs... :)  Beyond a doubt there are probably many we're not thinking of off the cuff.

> Is there a way to get a recompiled chromium with max_texture_size_ set to something larger to work on a virtual frame buffer like xvfb?

Oooh, good question - you'd have to patch the tilesize and get a working build of Chromium _and_ a working build of Electron off of your custom Chromium build, then patch a fork of Nightmare to use that custom Electron build.  Most likely, doing that would introduce other side effects (or break rendering altogether), but if you've got the time to burn and want to give it a shot, I'd love to see it.

> I wonder how phantomJS is able to take screenshots larger then 16384,

Another _great_ question, and full disclosure, I'm not sure.  This might be worth digging into. I'm going to close this issue for now as "not fixable" (at least without substantial effort).  A plugin is _probably_ the way to go here.  If memory serves, I think there are circumstances where `dom-ready` never fires, but `did-finish-load` does.  I remember having a conversation about this at one point but cannot find the issue offhand, so take that with a grain of salt. :)

For what it's worth, if you're not interested in loading assets, you could also use a load filter like [`nightmare-load-filter`](https://github.com/rosshinkley/nightmare-load-filter).  Looks like public access isn't granted for that asset... can you fix it?

How are you trying to open the file?  Can you provide an example?  hey sorry! will do a fresh release tomorrow. thanks for the PR!  Fixes #899. @jekku  This probably should have gotten pulled in with the last release.  I'll see to it that it gets pulled in with the next one.

@justinmchase _mostly_ for previous version support/preventing breaking changes.  In the future, support could be dropped.  (This is _tangentially_ related to a conversation about `.run()` in #575.)

  The `.end(fn)` method calls run, which kicks off the queue.  The subsequent `.then()` is also trying to kick off the queue, but because it was cleared by the prior call to `.end(fn)`, Nightmare will immediately halt execution, causing the instance to effectively be hung.

Curiously, there's no unit tests around handling `.end()` with a callback.

I'll be fixing both problems (at least as a first pass) shortly.
  Good eye.  Thanks!  It depends on how the "reload" is happening.  For all actions, the instance should wait for [`did-stop-loading`](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L153).  I suspect your redirected-to page is finished loading, but perhaps is doing some continuing work asynchronously?  Or, it could be that the redirect is not instant - you _might_ want to add a short wait between form submission and the next task.  Alternatively, you could wait for an element to appear on the page you're redirected to.
  Depends on what you mean - do you want to load the HTML as a page?  If so, you can save the HTML as a file and have Nightmare `.goto()` that file, eg:

``` js
nightmare
  .goto('file:///some/location/locally/mypage.html')
  .then( ... )
```
  It looks like you've done all of the heavy lifting already to get the data you want out - you don't need Nightmare to save the file for you, you could do it with the Node native [`fs`](https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback) module.  Something like this for a synchronous call:

``` js
.then(function(data){
  fs.writeFileSync('my-data.json', JSON.stringify(data));
})
```

Or the equivalent asynchronous call:

``` js
.then(function(data){
  return new Promise(function(resolve, reject) {
    fs.writeFile('my-data.json', JSON.stringify(data), function(err){
      if(err) return reject(err);
      resolve();
    });
  });
})
```
  That looks like the Electron process is never starting.  Could you paste the version of the Yahoo example you are using?
  I'd be curious to see how you were trying to accomplish this with a preload.  Also, silly question - did you try setting `webSecurity` to false?
  Is [`.action()`](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) what you're after?  That gives you the ability to define custom actions on the Electron instance.
 @zatziky upload dialogs are _very_ tricky, requiring tapping into the debugger API.  There is a plugin for that: [`nightmare-upload`](https://github.com/rosshinkley/nightmare-upload).  Sending keyboard events to Electron for upload dialogs won't work.

@josephrocca Glad you got it figured out, and thank you for documenting your process! Highly appreciated. :)

Considering both of the above issues are covered, I'm going to go ahead and close this issue.  File uploads are not natively supported under Nightmare (or Electron for that matter).  You _can_ do uploads by using the debugger API, which is what [`nightmare-upload`](https://github.com/rosshinkley/nightmare-upload) does.  Does that plugin work for you?
  Nightmare depends on native Promises as well as fat-arrow functions.  Running under 0.12 isn't possible out of the box.  You _might_ be able to use Babel (possibly in tandem with something else) to roll up Nightmare as a dependency, but I personally have not tried it.
 Closing for now.  Let me know if you get that put together, I'd be highly interested to see it!  If what you mean is

> "Can I exclude Electron and have Nightmare still work?"

The answer is no.  Nightmare is a wrapper for Electron, and will not work without it.
  Yes, with `.evaluate()` you can return data up to the calling client.  For example:

``` js
nightmare
  .goto(someUrl)
  .evaluate(() => { return "hello world"; })
  //prints "hello world"
  .then((str) => console.log(str));
```

Is that what you are after?

For completeness, the title of your question talks about events, and if you're wanting to capture events you can use `.on()`.  Any event emitted from Electron can be captured with that.  If you want to define your own events, you might want to check out [`nightmare-custom-event`](https://github.com/rosshinkley/nightmare-custom-event).
 Yeah, that's the intent of `nightmare-custom-event` - did you take a look at that?  I think that might be close to what you're after.  I don't think the Nightmare runner re-emits all events from the Electron context, so I don't think your preload example would work out of the box.  You'd have to patch together an `.action()` to do that, I think.  Can you supply an example of what you're trying to do?
  I suspect this is the same issue as #224.  Merging.  It would seem that downloads are now causing a dialog box to appear (that I don't think was happening before?).  This is preventing Nightmare from moving forward until the dialog box is dealt with.

As a stopgap, you could use [`nightmare-download-manager`](https://github.com/rosshinkley/nightmare-download-manager) or [`nightmare-inline-download`](https://github.com/rosshinkley/nightmare-inline-download) for the moment.  That will handle setting the save path, which prevents the dialog.

As for the timer not firing, that's strange.  It should, but it's possible there's a bug there.  It's also possible (albeit unlikely) that the modal dialog is preventing the timer function from firing.
 @anperez78 Did you take a look at `nightmare-download-manager` or `nightmare-inline-download`?  The short answer is no, not out of the box.  New `BrowserWindow` instances are created under Electron and are not created with all of the Nightmare sugar for interaction.  (It's planned for a future release, see #593.)

In the meantime, you can use [`nightmare-window-manager`](https://github.com/rosshinkley/nightmare-window-manager) to get some _very_ basic functionality.
  I gave this a try with the following script:

``` js
var nightmare = require('nightmare')();

var evaluateFn = () => {
  var localCollection = localCollection = [1,true,"hello",4.5,{some:"thing"}];
  return localCollection;
};
var resultFn = (someCollection) => {
  console.dir(someCollection);
};

nightmare
  .goto('http://example.org')
  .evaluate(evaluateFn)
  .then(resultFn)
  .then(() => nightmare.end().then());
```

... and ran it with `for i in`seq 1 100`; do node script.js; done` to simulate running it 100 times.  I couldn't reproduce this behavior.

Does your function _always_ return `localCollection`?  Is that array actually an array, or can it possibly be something like a DOM list?
  This would _probably_ be best served as a plugin as you've already mentioned.  I'm adding this to the list of v3 nice-to-haves and merging this issue with that.  You cannot return DOM elements or lists of DOM elements.  Any information returned from `.evaluate()` has to be serialized and passed over IPC.

Try extracting information out of the DOM element(s) before passing the information back.
  good idea, thanks :) Yeah I fixed whole merging ;)

On Mon, Jan 2, 2017 at 2:25 AM Rico Sta. Cruz <notifications@github.com>
wrote:

> *@rstacruz* commented on this pull request.
>
>
>
>
> ------------------------------
>
>
>
>
> In Readme.md
> <https://github.com/segmentio/nightmare/pull/865#pullrequestreview-14833628>
> :
>
>
> > @@ -30,16 +30,13 @@ Many thanks to [@matthewmueller](https://github.com/matthewmueller) and [@rosshi
>
>  Let's search on Yahoo:
>
>
>
> oops, haha, this needs to change too
>
>
>
>
> ------------------------------
>
>
>
>
> In Readme.md
> <https://github.com/segmentio/nightmare/pull/865#pullrequestreview-14833628>
> :
>
>
> > @@ -30,16 +30,13 @@ Many thanks to [@matthewmueller](https://github.com/matthewmueller) and [@rosshi
>
>  Let's search on Yahoo:
>
>
>
> but i think someone already edited that
>
>
>
>
> â€”
> You are receiving this because you modified the open/close state.
> Reply to this email directly, view it on GitHub
> <https://github.com/segmentio/nightmare/pull/865#pullrequestreview-14833628>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AAoMcSpFOqLKtAFCKH5favWMdstoVwpqks5rONC1gaJpZM4Kmveu>
> .
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
  I don't know that this is possible (someone correct me if I'm wrong).  This is tantamount to asking for a promise to come through a promise resolution unresolved itself, which (memory serving) breaks Promise standards.

That said, I'd be open a PR either here or on [`nightmare-examples`](https://github.com/rosshinkley/nightmare-examples) noting it.  Thoughts?  @Mr0grog Would it be worth it to use something like [`json-stringify-safe`](https://www.npmjs.com/package/json-stringify-safe) to handle circular references when serializing data to pass over the IPC boundary?
  Closing for a viable solution, but thank you for bringing it up!  > In sketch, I do the following:

Your `.use()` function calls `.then()`.  That's almost certainly going to lead to unintended side effects with queue management, so I'm not terribly surprised you're seeing strange behavior.

> For example: where is documentation for "use"?

The awful truth about `.use()` is that it's _never_ been particularly well documented.  The idea was to wrap up commonly used Nightmare chains for easy use, but it never really got the attention it deserved.

> Where is documentation for "run"?

`.run()` is in the throws of being deprecated.  See #575.

> What criteria nightmare uses for choosing when it is going to queue or when it is going to run the queued operations?

All operations (except for `.run()` and I think one overload of `.end()`) are queued. Operations are only executed when `.then()` is called, `.end()` is called with a callback, or `.run()` is called.  The TL;DR advice there is to _always_ use `.then()`.  (If you're using generators, this is done automatically for you with `vo` or `co`.)

> ... and the only documentation comes in the form of very restrict examples, where there is no precise definition of function actions and the meaning of the parameters.

This is a very valid criticism.  One of the things on my back burner has been to make a gh-pages branch and take a serious pass at updating/upgrading the documentation.  Nightmare's API surface is getting to be too big for a simple readme.

>  create a custom action that is minimaly general enough to get an dom property on the client, return it, and then storing it in an array server-side. Is that possible?

Yes, although I don't know that you need a "custom action" (or even a `.use()` function) to do so.  Using `.use()`, you could do the following to get all client widths for a given query, for example:

```js
var Nightmare = require('nightmare');

var nightmare = Nightmare();

var functionToUse = function(search){
  return function(nightmare){
    nightmare.evaluate((search) => {
      return Array.from(document.querySelectorAll(search)).map(element => element.clientWidth);
    }, search);
  };
};

var clientWidths = [];

nightmare
  .goto('http://example.org')
  .use(functionToUse('body'))
  .then(function(ws){
    ws.forEach(w => clientWidths.push(w));
  })
  .then(function(){
    return nightmare.use(functionToUse('p'));
  })
  .then(function(ws){
    ws.forEach(w => clientWidths.push(w));
  })
  .then(function(){
    console.log(clientWidths);
  });
```  Documentation has been merged, I'm going to consider this issue closed.  The first `.then()` turns your Nightmare chain into a `Promise`.  With that, you can return another Nightmare chain (which resolves to a Promise) and continue evaluation.  Using your example, something like:

``` js
var nightmare = new Nightmare();
nightmare
  .goto(site)
  .evaluate(function(){
    //run evaluation
  })
  .then(function(result){
    return nightmare.click()
      .evalute(function(){
        //run evaluation
      })
  })
  .then(function(result){
    //confirm result
  })
```
  Looping over Nightmare chains as you have it won't behave as you'd expect, and can cause unexpected problems.  I suggest you read [Asynchronous Operations and Loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md).  That might not solve all of the problem, but it will eliminate any strange behavior from looping on the same Nightmare instance.
  This is because Nightmare uses the same callback style that Node uses where the first parameter is an (optional) error.  Consider:

``` js
var Nightmare = require('nightmare');
Nightmare()
    .goto('http://google.com')
    .evaluate(function (message, done) {
        done(message);
    }, 'working')
    .end()
    .then(value => {
        console.log(value);
    })
    .catch(err => {
        console.log('ERROR: ' + err);
    });
```

This will produce the output of "ERROR: working".
 I should have been clearer with my example.  You certainly can also pass back an optional value.  Consider:

```js
var Nightmare = require('nightmare');
Nightmare()
    .goto('http://google.com')
    .evaluate(function (message, done) {
        done(null, message);
    }, 'working')
    .end()
    .then(value => {
        console.log(value);
    })
    .catch(err => {
        console.log('ERROR: ' + err);
    });
```
...will log "working".  I think what you'd _probably_ want go the route of gathering the `href`s - the page you're gathering from will probably change, so you're not guaranteed that using `.click()` and `.back()` will be reliable.  Your loop is almost there: you should be able to get the `href`s directly from the anchor DOM elements.  You could also do something like:

``` js
var storyHrefs = Array.from(document.querySelectorAll("a.storylink")).map(a=>a.href);
```

The next issue you'll likely hit is looping over an array and the problems that causes with asynchronous operations.  I'd suggest reading [Asynchronous Loops and Operations](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md).  That should at least help you get started.
  There could be, I suppose, but why would you want to `.inject()` something into a page you were going to navigate _away_ from?
  @privilio  is right: start with #224.  Closing this for now, feel free to reopen if you are still having an issue.  A change was made to allow for asynchronous execution when using `.evaluate()`, which `.click()` uses under the covers.  This change parses the arguments to `.evaluate()`, which parses them, and I think that's causing the issue.
 I'm in the throws of fixing this issue now.  Yes, it has to do with how arguments to `evaluate_now` are parsed.  I'll hopefully have something shortly, possibly including a fix for the arbitrary code injection.  (Which, by the by, shouldn't really matter: that's what almost all of the Nightmare commands do.)
  Answering your question, anything >=4.x will work.

I suspect, though, you're hitting the same thing as #839, fixed in #841.
  First and foremost: you don't have to call `.end()` before `.then()`.  Use `.end()` when you want to shut the Electron instance down.  Use `.then()` when you want to perform the actions that have been queued.

Setting that aside, getting results from an asynchronously loaded page seems to come up fairly frequently.  I'd suggest first giving ["Asynchronous Operations and Loops" in `nightmare-examples`](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) a read if you haven't already.  That should get you started on looping.  I'd also recommend reading #625.  It's a different issue (scraping an infinite scroll), but the bones of the issue are similar:  conduct an action, perform some sort of check, iterate if necessary.

Finally, if you have specific source you'd like a hand with, feel free to include a simplified version.  I'd be happy to help you get started.
  Heroku + Nightmare can get a little sketchy having to do with `/dev/shm` being too small, and as far as I know (I remember talking about this on Gitter, but can't dig out the conversation) it can't be adjusted.  This was first mentioned [here in #497](https://github.com/segmentio/nightmare/issues/497#issuecomment-187517613).  I wonder if you're hitting that limit?
 I [found the original conversation](https://gitter.im/rosshinkley/nightmare?at=574b580aa78d5a256e38f3cd), and I _thought_ there was an outline on logs/testing for verifying that was the problem, but it's not jumping out at me.

The dyno sizes don't affect the size of shared memory - that setting is locked by Heroku.  Furthermore, memory serving, you don't have root access to change the shared memory partition.  

Re confirming the issue, you might be able to get away with using something like [`df`](http://man7.org/linux/man-pages/man1/df.1.html) to look at `/dev/shm` usage while your script is running.  (Something like `watch "df | grep /dev/shm"` or `watch "df -h | grep /dev/shm"`, maybe?)  I _think_ that's doable with `heroku run bash` on a one-off dyno, but my experience with Heroku is limited.

/cc @rickmed - any light to shed on this topic?
  I'm not entirely sure I understand the question.  Nightmare can be ended with [`.end()`](https://github.com/segmentio/nightmare#end), and in the future interrupted with `.halt()` (see #788).

The "button" part of your question confuses me: what are you trying to do?
 Yes.  I think in that case you'd want the `.halt()` API, which is as-yet not included.
  I can't think of a reason to not include it off the top of my head, and the change is pretty innocuous.  If you're willing to pull together the PR + tests, I'd say go for it. :)
 Ah, I think I misunderstood the problem you're trying to solve.  You're after something blocking, I take it?  That's trickier, but there are a couple of options.  You could manually block using `.wait()`, which would solve your asynchronicity problem.  Or if you really want to get crazy, you could take a look at implementing a soft-blocking action to wait for your page errors, akin to how [`nightmare-inline-download`](https://github.com/rosshinkley/nightmare-inline-download/) works.
  To be clear: are you trying to pass an actual function to evaluate?  Something like:

``` js
var myfn = function() { ... };
nightmare
  .goto(myUrl)
  .evaluate(fn=>{ fn(); }, myfn)
  .then( ... )
```

_edit:_ I didn't keep my naming conventions straight.  Oops.
 @cagataycali In addition, you're not passing values to `.evaluate()` to print.  From the hip, this should work:
```js
var name = "demo.png";
var url = "https://demoUrl.com"

nightmare
  .downloadManager()
  .goto('https://google.com')
  .evaluate((name, url) => {
    console.log(name, url);
    return 'Done'
  }, "name", "url")
```

You may want to give [variable lifting](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/variable-lifting.md) a read.

Going to close this due to age and I think possibly being solved.  I don't _think_ you would need #819 to handle this, but I'm not sure I'm clear on what you're asking.  Do you want the URL of the page that excepted, or are you looking to pull information from the page that excepted?

Taking a stab in the dark, would something like this help?

``` js
nightmare
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .click('#buttonThatLoadsSomething') /* page loads something */
    .wait('#not_here') /* this will timeout because it's not on the page*/
    .evaluate(function () {
        /* more code here */
    })
    .end()
    .then(function(html) {
        /* more code here */
    })
    .catch(function (error) {
        /* here I would like to know what the last html page was before the error occurred */
        return nightmare
          .url()
          .then(function(url) {
            console.log(`error happened at ${url}`);
          })
    });
```
 You can still use the same approach, and you've got options, depending on what you want to do: use `.evaluate()` to return the HTML back, or use `.html()` to save the error state off.

Using `.evaluate()`:

``` js
nightmare
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .click('#buttonThatLoadsSomething') /* page loads something */
    .wait('#not_here') /* this will timeout because it's not on the page*/
    .evaluate(function () {
        /* more code here */
    })
    .end()
    .then(function(html) {
        /* more code here */
    })
    .catch(function (error) {
        /* here I would like to know what the last html page was before the error occurred */
        return nightmare
          .evaluate(() => document.querySelector('body').innerHTML)
          .then(function(html) {
            // do something with the html retrieved
          })
    });
```

Using `.html()`:

``` js
nightmare
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .click('#buttonThatLoadsSomething') /* page loads something */
    .wait('#not_here') /* this will timeout because it's not on the page*/
    .evaluate(function () {
        /* more code here */
    })
    .end()
    .then(function(html) {
        /* more code here */
    })
    .catch(function (error) {
        /* here I would like to know what the last html page was before the error occurred */
        return nightmare
          .html('/path/to/file.html', 'HTMLOnly')
          .then(function() {
            // html is saved off to the path
          })
    });
```
 Poking a head in: Thank you @Mr0grog:

> except you need to make sure not to call end() before your catch runs...

Editing mistake on my part.  Thanks for the second set of eyes.
  I'm not sure what you're asking here - are you asking how to set up a proxy?  Or what proxy to use?  

For the latter, [`node-http-proxy`](https://github.com/nodejitsu/node-http-proxy) is a good place to start.
 Hm, You could probably use a similar approach to #521 to patch request data coming back - does that help, or are you trying to modify data from `.goto()`?  Short answer is yes, it's definitely on the list of things to try, and I'd point you at #593 for more information.

Longer answer: it's very possible to manage multiple `BrowserWindow`s from a single Electron instance, and should be reasonably straightforward to do with Nightmare.  It would solve situations where you're time-bound (like yours, as you noted, launching new Chromium instances takes quite a bit of time) or memory-bound (each Chromium instance is _very_ expensive).  It would also solve problems with managing popup windows and testing with multiple windows.

The downside is that (I think) it would be a breaking change to Nightmare 2.x, which I'm not against, but it would have to be handled ... carefully.
 Merging this conversation into #593.  No, I don't think so.  Memory serving, `webContents` hasn't been created yet, so there's nothing to call `executeJavascript()` on.

What are you trying to do?  There might be another angle.
  This looks like the same issue that alert, confirm, etc poses.  I'll fix the test conflict and pull it in.  For what it's worth, you could instead prop up a custom preload to handle the `confirm` case manually.  By default, the confirm handler returns the default response, which in this case is _probably_ to stay on the page.
 Fixed with #825.  Closing.  This PR is intended to let you run `.evaluate()`d functions that are asynchronous, either with callbacks or with promises.  For callbacks, if the `.evaluate()`d function's arity is one less than the passed in parameters, it'll assume the last argument to the function is the callback.  If the return value is a `then`able, it'll call `then()` to wait for promise fulfillment.  Otherwise, the call will behave synchronously as it does now.

This change is _potentially_ breaking as it does change behavior based on the arguments to `.evaluate()`.  Is this change worth the risk of possibly breaking implementations that already exist?

Related to #573 and closes #552.
 Including.  Thanks for the feedback. :)
  Thanks for the correction!
  I'm guessing based on the output that you're on MacOS, and to that end, there's a known issue with some versions of OSX that limit the maximum file handles to something like 256.  I think that might be what you're hitting?  Try running `ulimit -n` and report back what your limit is.
  Last I saw, the tests for `.visible()` were broken.  I haven't had a chance to really dig into it since.

At first blush, this looks like a reasonable change, and also looks like it adds a check for elements that are floated off into oblivion, which is a welcome addition.  I'll take a closer look when I have a chance, but on the face of it, this looks good.
 On slightly closer inspection: what about elements that are bigger than the viewport?  Doesn't this assume that to be visible, the bottom (and rightmost edge) of the element has to be in view?  I don't think a call to `.visible()` implies the _entire_ element is visible.  In fact, all `.visible()` really implies is that the element is on the page and rendered.  Changing that would be a _substantial_ change and probably a breaking one at that.
 > The definition of visible (at least mine) is that the user can interact with the element in the current viewport. This implies that if the element is bigger than the viewport but some parts of it are present in the viewport it should be visible.

I don't think what you have will work like that.  Specifically:

``` js
 rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
 rect.right <= (window.innerWidth || document.documentElement.clientWidth)
```

... will dictate that the bottom and rightmost edge _must_ be in the viewport to be considered visible, and (correct me if I'm wrong) I don't think that's your intent.

>  Thinking twice about it maybe we should check the left top edge instead. Should I update the PR accordingly?

I don't think relying on an edge (or more than one edge) being in the viewport is a good indicator of visibility, as the element you are checking may extend beyond the viewport in any, a combination, or every direction.  For this to work right, I think you'll want to make sure that a part of the viewport overlaps the client rectangle, edge-inclusive.

>  Isn't this the purpose of .exists()?

In short, no.  `.exists()` ensures the element is a part of the DOM, visible or not.  `.visible()` makes sure the element is actually rendered.  I don't think whether or not the element is in the viewport matters, and I would not be surprised if this quirk (for want of a better word) of implementation is relied upon by users of Nightmare.

Pondering out loud: this _might_ be better served as a plugin.
  It looks like you're trying to call `.action()` on a Nightmare instance instead of the Nightmare prototype.  Is that the case?

Setting that aside, I suspect your custom action does not work the first time, either: the callback `cb` gets called with an error.  (It doesn't serialize nicely from the client code because `Error` isn't easily serializable, but that's left to  #646.)  Poking around in your client function, it turns out that the event being emitted is invalid - while the event name seems to be case-insensitive (documentation has them as `mouseDown` and `mouseUp`), the coordinates _must_ be integers.  If the bouds add to an even number, you'll end up with a float, which Electron will reject.  Try using `Math.floor` to ensure your coordinates are round integers.

_edit:_ poor wording.
  In addition to sending backspace characters as @marcelfalliere said, you can send empty or falsey values to `.type()` and `.insert()` to clear the selector.

I do have a question:

> ...on script re-run are previously inserted input fields prefilled with old values.

Meaning that the values are there between runs to the same site?
  @daniel3d is right: `.end()` queues the ending action, it still needs to be executed with a `.then()`.

Setting that aside, and this is kind of offtopic: I'm not certain Nightmare is the best tool for converting SVGs to PNGs.  Have you considered using something like [ImageMagick](http://imagemagick.org/script/index.php)?  `convert` will give you _much_ more flexibility for image manipulation.
 Considering this fixed with #927.  Closing.  Ah, this must have gotten overlooked.  Thanks!
  Hm, are any of the variables you're testing for defined on the global/window scope _before_ your injection?  I can recreate this behavior if the variables are defined prior to `.inject()`, as then they would already exist on the global scope.

It's worth pointing out that your consideration is not exactly the same thing as the test you've written.  In your test, the `init()` function is injected after the page is loaded, whereas in your consideration example, they are loaded together.  It's a small difference, and I don't _think_ it would be causing this, but it's worth thinking about.
  That depends on what you mean.  If you've got assets - large images, for example - you could tap into `session.webRequest.onBeforeRequest()` to filter content that could slow your load process down.  There's a [plugin that you might find useful](https://github.com/rosshinkley/nightmare-load-filter) that does this.

As for speeding up the actual rendering process, that's internal to Chromium - I don't know of options offhand, but the [`BrowserWindow`](https://github.com/electron/electron/blob/master/docs/api/browser-window.md) documentation and perhaps the [Chromium switch list](http://peter.sh/experiments/chromium-command-line-switches/) (for use with [`switches`](https://github.com/segmentio/nightmare#switches)) might offer some options for you to tinker with.
  Out of the box? no.  Dealing with multiple instances of `BrowserWindow` isn't currently supported in Nightmare.  (Memory serving, it's one of the features talked about for a future version in #593.)

You can _kind_ of skirt this issue now, but it depends largely on what you need.  I'd suggest checking out [`nightmare-window-manager`](https://github.com/rosshinkley/nightmare-window-manager).  It's limited, but might be enough to help you skate by.
 Moving this to nightmare-window-manager.  At some moment, we should _probably_ prop up linting as a part of the build process (see long-standing #364), but I won't hold up this PR for that.  Including.  Thanks!
  Fixed with merged PR, closing.
  I'm not entirely sure what you're asking: do you want to show the alert window?  If so, that would require [overriding the preload script](https://github.com/segmentio/nightmare#custom-preload-script).  Note, though, that `alert`, `confirm`, and `prompt` will cause Nightmare to hang if you actually show the dialog boxes.
 Closing for lack of activity.  If this is still an issue, feel free to reopen/open a new issue.
  All for removing unnecessary dependencies.  Thanks!
  Are you (or anyone else) still having this issue?  Sometimes `.click()` does not do what you might expect.  It may be worth giving #619 a read.

Setting that aside, when and where dose `window.showModalDialog` get added?
 > It's added in that evaluate function I pasted above.

Possible I'm just blind, but `window.showModalDialog` is not added in the code you've posted.  It gets called but not added, which is why I was wondering where it got added.
 Closing for inactivity.  If you're still having this problem, feel free to reopen.  OS: Windows 10
node: 5.10.1
nightmare: 2.7.0
electron: electron-v1.3.6-win32-x64

Navigate to wells fargo and try to do anything.

``` javascript
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

nightmare
   .goto('https://wellsfargo.com')
   .evaluate(function () {
      return "Made it";
   })
   .end()
   .then(function (result) {
      console.log(result)
   })
   .catch(function (error) {
      console.error('Login failed:', error);
   });
```

The electron window will come up with wellsfargo.com loaded and do nothing.
Open the console and you will see two errors, both saying `__nightmare is not defined`

I tested the yahoo search example and it worked fine. My guess is that it's forgetting the injection that happened.

Further investigation:
If you inspect the `window` object you will notice `__nighmare` no longer exists under `window.__nightmare`, it is now under `window[""].nightmare`
 I changed both of the ipc declarations in javascript.js to:

``` javascript
var ipc = (window.__nightmare ? __nightmare.ipc : window[''].nightmare.ipc);
```

And it works now.
 Making a PR...
 merged PR  Non-200 codes are not treated as errors - pages that respond with non-200 codes might be expected behavior.

[`.goto()`'s return](https://github.com/segmentio/nightmare#gotourl-headers) will include metadata about the page load, including the response code.  A quick off-the-cuff example:

``` js
var nightmare = require('nightmare')();
nightmare.goto('http://example.com/404')
  .then(function(gotoResult) {
    console.dir(gotoResult.code);
    return nightmare.end();
  })
  .then(()=>console.log('done'));
```
 Hm, I think I see what you're saying, @Oted.  The problem here is defining what a "load success" is.  Any page that completes the HTTP request - be it an HTTP success (eg, a 200) or an HTTP failure (eg, a 404) - is considered a successful request.  The documentation should be worded more carefully to make that clearer.

_Edit:_ I take back what I said, and shouldn't have fired totally from the hip: this has come up before, and I had forgotten the documentation had already been updated.  The docs are pretty clear, I think:

> Note that any valid response from a server is considered â€œsuccessful.â€ That means things like 404 â€œnot foundâ€ errors are successful results for goto. Only things that would cause no page to appear in the browser window, such as no server responding at the given address, the server hanging up in the middle of a response, or invalid URLs, are errors.
  This looks great.  Thanks!
  Thanks for the eyes!
  For what it's worth, you could also capture it from preload using something like (from @nickstanish):

```js
  var open = window.XMLHttpRequest.prototype.open;
  window.__responses = [];
  window.XMLHttpRequest.prototype.open = function (method, url, async, user, pass) {
      this.addEventListener("readystatechange", function() {
        console.log('ready state %s is %s', url, this.readyState);
        if (this.readyState === 4) {
          window.__responses.push({
            responseText: this.responseText,
            readyState: this.readyState,
            url: url,
            method: method
          });
        }
      }, false);
    open.apply(this, arguments);
  };
```  `Nightmare.action()` does not work as I would've expected it to, where `done` is always the last argument.

``` js
Nightmare.action('iframeHeight', function(selector, done) {
  this.evaluate_now(function(selector) {
    //const element = document.querySelector(selector);
    //return window.getComputedStyle(element,null).getPropertyValue('height');
    return 100;
  }, selector, done);
});
```

``` js
it('works', function() {
  return browser.iframeHeight('#bigFrame').then(result => console.log(result))
  //return expect(browser.iframeHeight('#bigFrame')).to.eventually.equal(1000);
});
```

results in:

```
Nightmare runner error:

    TypeError: done is not a function
        at EventEmitter.response (/project/node_modules/nightmare/lib/runner.js:323:7)
```

After looking at [actions.js](https://github.com/segmentio/nightmare/blob/2.7.0/lib/actions.js#L55-L62), we can see that the args are backwards in `evaluate_now()`. The correct version would be:

``` js
Nightmare.action('iframeHeight', function(selector, done) {
  this.evaluate_now(function(selector) {
    const element = document.querySelector(selector);
    return window.getComputedStyle(element,null).getPropertyValue('height');
  }, done, selector);
});
```
 Defining multiple arguments is a bit weirder:

``` js
Nightmare.action("broquire", function(id, browserValue, done) {
    this.evaluate_now( function(id, browserValue) {
        return window.broquire(id, browserValue);
    }, done, id, browserValue);
});
```
 Optional arguments are even weirder:

``` js
Nightmare.action("broquire", function(id, browserValue, done) {
    // Avoid weird magic with `nightmare.broquire(id)`
    if (done === undefined) {
        done = browserValue;
        browserValue = undefined;
    }
    if (browserValue !== undefined) {
        this.evaluate_now( function(id, browserValue) {
            return window.broquire(id, browserValue);
        }, done, id, browserValue);
    } else {
        // This avoids `browserValue` being passed as `[null]` (due to serialization?)
        this.evaluate_now( function(id) {
            return window.broquire(id);
        }, done, id);
    }
});
```
  A quick look at this - you're trying to call `cssLookup` from within an `evaluate_now`ed function when the function is defined outside of the evaluated context.  That closed-over scope is not carried to the evaluation as it crosses the IPC boundary.  (See [here](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/variable-lifting.md) for a slightly longer explanation.)  You'll probably want to tuck that function into the preload.

That said... I'm not _entirely_ sure this is necessary.  Is there a problem that XPath solves that CSS selectors cannot?  More generally, are there users out there that this feature would be of use to?
 @gjmveloso as @rosshinkley mentioned we've decided to keep css lookup for minimal simplicity. if there's a super clean, tested and ready-to-go PR may reconsider!  Depends on what you mean.  If you're trying to issue a `POST` from the client, you could use `.evaluate()` and `XMLHttpRequest` (or use/`.inject()` your tool of choice) to issue the request.

Could you provide more information about your use case?
  Promises are asynchronous.  `breadcrumb` is equal to the Nightmare instance with the queued actions when you run `expect`.  Also, the way you have your Mocha method set up, it will expect your tests to be synchronous.

With that in mind, let's modify your test case.  Something like:

``` js
var Nightmare = require('nightmare');
var expect = require('expect');

describe('test yahoo search results', function(done) {
  it('should find the nightmare github link first', function() {
    var nightmare = Nightmare()
    var breadcrumb = nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.url.breadcrumb')
      .evaluate(function () {
        return document.querySelector('.url.breadcrumb').innerText;
      })
      .then(function(result) {
        expect(result).toEqual('github.com');
        done();
      });
  });
});
```

It's also worth pointing out that the test was originally using `mocha-generators`, and in cleaning up the readme to remove the dependencies, the example didn't get modified properly.  There is an open PR (#758) to clean it up.
 Without digging into it too deeply, you may want to consider adding a `.catch()` block.  Something like:

``` js
describe('Login Page', function() {
  it('username and password should log you into the dashboard', function(done) {
    var nightmare = Nightmare()
      .goto(CONST.url)
      .type(CONST.usernameID, CONST.username) // enter user name
      .type(CONST.passID, CONST.password) // enter password
      .click(CONST.loginButtonID) // click log in
      .wait(TESTCONST.IDToCheckAfterLogin) // wait for dashboard to come up
      .evaluate(function () {     // Select dashboard title and return text 
          return document.querySelector(TESTCONST.mainPageDashBoardElementSelector).innerText;
      })
      .then(function(result) {
        // assert
        expect(result).toEqual(TESTCONST.dashboard);
        done();
      })
      .catch((err) => done(err));
  });
});
```

Otherwise, use `DEBUG` and see if that doesn't give you some useful output.
  This is (I'd think) expected behavior.  The documentation could probably be a little clearer, stating that `.type()` and `.insert()` _should_ take strings, but don't necessarily have to (eg, `.type('#someInput', true)` types the string "true" the selected element).  Both functions do their best with what they are given.  To that end, I don't think it's a particularly great idea to enforce only strings.  (I'm open to counterargument, though.)

That said, the documentation _is_ pretty clear about what happens with falsey values, which as you note, `0` is an example.
  Are you trying to bundle Nightmare into an Angular2 application?  I'm not exactly clear on what the problem is.  Could you provide more information?
 Closing for inactivity.  If this is still an issue, feel free to reopen/open a new issue.
  According to the [Command Line API Reference](https://developers.google.com/web/tools/chrome-devtools/debug/command-line/command-line-reference):

> This API is only available from within the console itself. You cannot access the Command Line API from scripts on the page.

In other words, `$x()` isn't available from an evaluation context.

You could use `document.evaluate()`, it takes an XPath expression as an argument.  [MDN](https://developer.mozilla.org/en-US/docs/Introduction_to_using_XPath_in_JavaScript) has a good introduction on this topic.
  `.evaluate()` is intended to be synchronous, at least for now.  I suspect that may be at least part of your problem.

There is a [plugin](https://www.npmjs.com/package/nightmare-evaluate-with-callback) that takes care of this, as well as an in-progess PR (#573) to try to address it.
 #819 should solve this problem.  Closing.
  I was _really_ hoping to get something similar into core with #573.  If you want to pick that up and run with it, great - otherwise, I'm going to try to pick it up and submit a solution as time permits.

In the meantime, though, thank you.  This will help many outstanding problems.
  Yes, this is expected behavior.  Nightmare actions, as you noted, are queued but not run until `.then()` is executed.
  Hm, I can't reproduce the issue with 2.6.1 on my headless setup.

I don't _think_ it's a security problem, and what's truly unfortunate is that the code is the generic networking timeout.  What version are you using on your headless setup, and how are you executing headlessly?
  Nightmare, by default, will wait for the [`did-stop-loading`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-did-stop-loading) event.  This event is typically emitted once the page is "finished" loading (be it from the original 20x completing or `stop` being called).  At that point, the page should already be in a ready state.  (Should.  If it isn't, or you have a a countercase, I'd love to hear about it.)

However, `complete` may not be helpful: you could still have client-side scripts issuing requests for assets to load asynchronously, or already-loaded assets modifying the DOM in flight.  I'm not _entirely_ sure what your use case is, though, and I suspect there may be more to it than I think.
 Thanks!
  This seems like a Windows-specific problem with Electron, but nothing is jumping out at me in the Electron repository (or `electron-prebuilt`, for that matter).  To be clear, the above works for the Google goto, but not the login?  What if you point it to a different version of `electron-prebuilt` with [`electronPath`](https://github.com/segmentio/nightmare#electronpath)?
 Sorry for the delay, @scytalezero - yes, I'd go ahead and report it at Electron, which it looks like you've already done. :)

Would you mind linking to it here?
  Cross-site `.evaluate()` calls aren't going to work: the evaluated function is executed in the current page's context.  In other words, as soon as you `.click()` on one of those links, you'll lose your evaluation context.  Also, `.evaluate()` calls are currently designed to be synchronous, although there has been some work to make `.evaluate()` calls asynchronous (see #573).

Based on your snippet, I'm not clear on what you're trying to do: are you trying to click on each github link?

Also, as a matter of housekeeping, you _might_ want to take a look at [asynchronous operations and loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md).
  In your `.catch()` block, you're trying to use jQuery from within your script, which isn't going to work.  You have access to the failed URL - you're creating it in `.goto(endpointPsicos + i)`.  Couldn't you push that + the error?
 Closing for inactivity.  If this is still an issue, feel free to reopen/open a new issue.
  `.click()` will blur the currently active element, which I'd _think_ should be the body if nothing has been selected.  From MDN:

> When there is no selection, the active element is the page's &lt;body&gt; or null. 

I know there are some OS differences with how this works, but I'd hope that Electron behaves the same across platforms.  I suppose it's possible AUI modifies this value, although it seems unlikely.  In any case, that's the only [`.blur()` call within `.click()`](https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L88).

If you modify that line to check for the active element's existence first, do you still have this problem?
 I did some digging with Chrome/Electron specifically: if you remove the active element from the DOM, the active element will point to the `body`.  The only way to get the active element to refer to null (at least in my experimentation) is to delete the `body` from the `html` tag.  (I sincerely doubt you're doing that.)

@willclarktech pointed out in [this issue](https://github.com/willclarktech/elm-boilerplate/issues/3) that the element could be removed between `.type()`/`.insert()` and `.blur()`, which would cause a similar problem, but those are getting the specific selectors, not the (somewhat nonspecific) active element.
  FWIW, asynchronous evaluate is now possible with #819.

Between that and #688, I _think_ this is resolved.  Feel free to reopen/open a new issue if not.
  I agree with @Mr0grog.  The examples should probably use plain promises to minimize external dependencies.
  This change seems reasonable to me, and I wonder if it might effect the outstanding issues with orphaned processes?

Anyway, including.  Thanks!
  A couple of explicit tests for this would be nice.  One handling the timeout, one handling the element existing before the timeout should be sufficient.  Thoughts?
 @noahtkeller I think this is probably sufficient for now.  Thanks!
  This should have been fixed with #757, I think.  Closing.
  Reproduction would be nice.  I can't reproduce locally.
  Hm, try upgrading to 2.6.0, I think this may have been fixed by coincidence by fixing how Nightmare reacts to closing the Electron window.

If that doesn't solve it, it's possible a solution to #688 may fix your issue.
  @ivan-kleshnin What version of Nightmare are you using?  When I run your second example with 2.6.0, I get the expected behavior of typing in `#email`.
  I'd be curious to know what operating system and version of Nightmare you're running.  Electron (and Chromium) misbehave beyond the texture size limit (see #616 and possibly #695) - is it possible you're hitting that?
 Perhaps the `.wait(1000)` isn't long enough? Try using a `.then()` instead, or perhaps you need an otherwise unnecessarily long content height algorithm: https://github.com/segmentio/nightmare/issues/726#issuecomment-244961028
  @Mr0grog hm, that's odd.  I'm curious what changed, but in this case, I _imagine_ fixing it first might be simpler.

And yeah, I think a modification to the circle yaml to run `nvm install` for possibly all three versions in the `pre` would work.  Thoughts? 
 > With the events? TBH, I donâ€™t really want to do the dig-through-the-event-and-find-all-the-problems-and-patch-them-then-lobby-electron-for-a-fix-then-see-this-break-later dance again.

Ha, I was referring to the Circle setup, but I'm +1 on this too.  I don't _really_ care all that much about including the event data, because as you said, we're not really using the data to begin with.  (I also have an odd sense of deja vu.  Haven't we had this conversation before?)

 Put me down for "strongly agree." :)

> Yeah, makes sense to me.

Cool.  I see you already made the changes.  Thanks!
 > Dâ€™oh, sorry to unload when you werenâ€™t even asking about that.

Don't worry about it, I wasn't being terrifically clear.

> Yep, way back in #576 :P

Good gravy.  Well, it's good to know my memory isn't totally failing.
  It looks like the `resetChanges` method from    8015fe0 splices the `cookies` namespace out of existence, causing those tests to fail.

Otherwise, +1.  Thanks, @Mr0grog :)
  Short version:  Out of the box, for now, you can't.

Longer version: It's on the docket for v3 (see #593), but for now, depending on your needs, I wrote a [plugin](https://github.com/rosshinkley/nightmare-window-manager) to try to address the most _basic_ of requirements (read: what I needed at the time).
 Closing for lack of activity.  If this is still a problem, feel free to reopen/open a new issue.
  @RichardJECooke Whether or not you have `show: true` when running under Docker does not make it headless or headed.  It makes the rendering on the framebuffer (most likely `Xvfb`) render as though it were visible.

Nightmare isn't _truly_ headless: it requires an Electron instance to work, which in turn requires a framebuffer to render properly (at least, for now).

Setting that aside: if you set `show: true` or `show: false` (the default), it will likely not run out-of-the-box on a Docker instance as Docker instances _are_ intended to be headless, and as such, don't typically have a framebuffer included on the image.  To do that, @voidmonk's suggestion stands: have a look at #224 regarding running with `Xvfb` or `xvfb-run`.  You may also want to have  a look at the test suite for Nightmare as that runs on a headless CircleCI server.
 I think this is resolved.  If not, feel free to reopen/open a new issue.
  Give [asynchronous operations and loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) a read - that should help you get started.
  @voidmonk Out of curiosity, what version of nightmare are you using?

@Mr0grog is right, the provisional load failure is causing an exception.  In your last comment, that exception is handled, and should work fine (although your `.then()` that handles the status code will not be called).
 @voidmonk The fix wasn't included as it has a test issue that needs to be addressed. As soon as it's fixed, I'll pull it in and cut another release.
 @geostant I'd suggest opening a new issue with a minimum repro case.
  Nice!  Thanks for the update!
  Silly question: have you tried running with `DEBUG=*` to see if that has any helpful information?
 (Also: Possibly related to #405.)
 Considering this fixed with #927.  If you're still having this problem with that change, feel free to reopen.  @Snake4life The proxy server is set up for every request from Electron.  Are you not seeing that behavior?
  Could you do something like `DEBUG_FD=3 DEBUG=nightmare*,electron* node my-script.js 3>log.txt`?
 (Alternatively, I think you should be able to use `nightmare.on('log', fn)` to capture log messages.)
  Correct me if I'm wrong: isn't the default `<select>` control an OS-level control (or at best, an application control)?  It's not necessarily rendered by the web frame - meaning that I don't think it will show up with `.screenshot()`.
  @Stankye: @vshvydky's answer is on the right track, but unfortunately won't work: `document.querySelectorAll` returns a DOM element collection, which like `arguments` isn't actually an array.  

From the hip, something like:

``` js
nightmare.goto(someUrl)
  .evaluate((selector) => {
    let elements = document.querySelectorAll(selector);
    Array.from(elements).forEach((element) => element.click());
  }, 'input[type=checkbox]')
  .then(()=>console.log('done'));
```

...might work.

If I'm reading the [spec](https://www.w3.org/TR/DOM-Level-2-HTML/html.html#ID-2651361) right, though (and it is _entirely_ possible I'm not), that will only work for `input`s.  If you want to use it on a generic element, you'll want to emit the click event yourself:

``` js
nightmare.goto(someUrl)
  .evaluate((selector) => {
    let elements = document.querySelectorAll(selector);
    Array.from(elements).forEach((element) => {
        var event = document.createEvent('MouseEvent');
        event.initEvent('click', true, true);
        element.dispatchEvent(event);
      });
  }, 'div.click')
  .then(()=>console.log('done'));
```

Do either of those work for you?
 Closing for inactivity.  If this is still an issue, feel free to reopen/submit a new issue.
  happy to consider, but the tests are failing: https://circleci.com/gh/segmentio/nightmare/918  I don't think you can hide the scrollbars with Electron [before DOM ready](https://github.com/electron/electron/issues/3534).

Out of curiosity, could you use `-webkit-scrollbar` set to `display:none` to hide the scrollbar?  It will still be there before `dom-ready`, but I _think_ you can hide it:

``` js
nightmare
  .goto('http://example.com')
  .evaluate(function() {
    var s = document.styleSheets[0];
    s.insertRule('::-webkit-scrollbar { display:none; }');
  })
  .viewport(100, 100)
  .then(function() {
    console.log('done');
  });
```

Would something like that work for you?
 Closing as this seems to be resolved.
 They are not documented in the readme because they are not internal to Nightmare, they're internal to Electron's `BrowserWindow`.

What do you mean "don't appear to do anything"?
 @rosshinkley They did not auto-size the viewport to the content. Instead I had to do all of this:

``` js
function calculateContentHeight() {
  function getNumericalStyle(element, property) {
    return parseFloat( window.getComputedStyle(element,null).getPropertyValue(property) );
  }

  var html = document.documentElement;
  var body = document.body;

  var bodyMarginBottom  = getNumericalStyle(body, "margin-bottom");
  var bodyMarginTop     = getNumericalStyle(body, "margin-top");
  var htmlMarginBottom  = getNumericalStyle(html, "margin-bottom");
  var htmlMarginTop     = getNumericalStyle(html, "margin-top");

  var bodyPaddingBottom = getNumericalStyle(body, "padding-bottom");
  var bodyPaddingTop    = getNumericalStyle(body, "padding-top");
  var htmlPaddingBottom = getNumericalStyle(html, "padding-bottom");
  var htmlPaddingTop    = getNumericalStyle(html, "padding-top");

  var margins  = bodyMarginBottom  + bodyMarginTop  + htmlMarginBottom  + htmlMarginTop;
  var paddings = bodyPaddingBottom + bodyPaddingTop + htmlPaddingBottom + htmlPaddingTop;

  return html.offsetHeight + Math.round(margins + paddings);
}


var browser = new Nightmare();

browser
.goto("etc")
.viewport(1000, 0)  // for getting the actual height of short content
.then(() => browser.evaluate(calculateContentHeight))
.then(contentHeight => browser.viewport(1000, contentHeight))
.then(() => browser.wait(50))  // wait for correct calculations (?) -- Semaphore CI was failing without this, but local Ubuntu and OSX were fine
.then(() => browser.screenshot())
```
  Hi everyone, when i run example.js 

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({
    show: true
});
nightmare
    .goto('http://yahoo.com')
    .type('form[action*="/search"] [name=p]', 'github nightmare')
    .click('form[action*="/search"] [type=submit]')
    .wait('#main')
    .evaluate(function() {
        return document.querySelector('#main .searchCenterMiddle li a').href;
    })
    .end()
    .then(function(result) {
        console.log(result);
    })
    .catch(function(error) {
        console.error('Search failed:', error);
    });
```

I have some error : 

```
/Desktop/nodejs/node_modules/nightmare/lib/nightmare.js:77
    debug(`WARNING:  load timeout of ${options.loadTimeout} is shorter than go
          ^
SyntaxError: Unexpected token ILLEGAL
    at Module._compile (module.js:439:25)
    at Object.Module._extensions..js (module.js:474:10)
    at Module.load (module.js:356:32)
    at Function.Module._load (module.js:312:12)
    at Module.require (module.js:364:17)
    at require (module.js:380:17)
    at Object.<anonymous> (/Desktop/nodejs/night-mare/exmple.js:1:79)
    at Module._compile (module.js:456:26)
    at Object.Module._extensions..js (module.js:474:10)
    at Module.load (module.js:356:32)

```

I appreciate any help you can give!
 Silly question:  what version of Node are you running?
 i upgrade the last version , i fixed  it, Thanks a lot!
 @varsano Upgrade NodeJS.  Nightmare will not work with anything <4.x.
  >  is there any option to get all messages, events, errors with listening only one event so i can see what is happening on the page.

Try running your script with `DEBUG=nightmare*,electron*` if you're not already.  That might have some useful information.

> After some more investigation i detected that it's stopping on .wait(selector) function.

Is it the same one every time?

> I checked and the callback is not working always once it's not working and the wait function is stopping working.

Which callback?  The one for `co`?
  I'm guessing you're trying to return `DOMElement.getBoundingClientRect()` from `.evaluate()`?  I suspect that the properties of DOM object you get back are not enumerable, and as such, aren't getting serialized.  Try explicitly returning an object with the properties you want.
 @xmen4u Could you post an example?  I want to be sure we're on the same page.
 Again, the `DOMRect` that `getBoundingClientRect()` returns won't serialize nicely, and won't cross the IPC boundary between Electron and Nightmare.  You'll lose the properties and be left with an empty object.

The easiest way to fix this is to return an object with the properties off of the `DOMRect` that you want.  Something like:

``` js
var nightmare = require('nightmare')();
nightmare
  .goto('http://example.com')
  .evaluate(() => {
    //get the bounding rect for the `body`
    var rect = document.querySelector('body').getBoundingClientRect();
    //pull out `top` and `width`
    return {
      top: rect.top,
      width: rect.width
    };
  })
  .then(bounds => console.log(bounds))
```

I apologize this wasn't clear before.
 @sebastienbarre Memory serving, they're in pixels... you _might_ want to open a new issue (if you haven't already) with an example.  This is a known quirk, for lack of a better word.  The underlying implementation calls [`BrowserWindow.setSize()`](http://electron.atom.io/docs/api/browser-window/#winsetsizewidth-height-animate).  It's been touched on in [#593](https://github.com/segmentio/nightmare/issues/593#issuecomment-216927915) as a breaking change, and also talked about in [#596](https://github.com/segmentio/nightmare/issues/596#issuecomment-214392429).
 Also worth pointing out: setting `webPreferences.useContentSize` to `true` will force the render area to be the size that `.viewport()` sets.

With that, I think this issue is resolved.  If you're still having problems, feel free to reopen/open a new issue.
  I think you'd be better off defining your custom action (if you need one) and then using [`.use()`](https://github.com/segmentio/nightmare#useplugin).  That will let you queue multiple actions together, which I think is ultimately what you're after.

The problem with defining actions within actions is that the action you define (`something` in your example) will add actions to the queue - but instead of adding them between `something` and the next action in the chain, it will add them at the end as the action function for `something` isn't run immediately.

For a little background, you may want to take a look at rosshinkley/nightmare-examples#3, the [`.action()` example](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/action.md) and the [`.use()` example](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/use.md).
 Closing for inactivity.  If this is still a problem, feel free to reopen/open a new issue.
  > But I only triggered nightmare successfully in first time with my api,
> when I call again my api I can't trigger nightmare any more

It looks like you're defining your instances outside of `getScrap()`, then calling `.end()` inside of `getScrap()`, which will end and destroy the Nightmare/Electron instances.  Once they are ended, they can no longer be used.  Try moving the creation of your Nightmare instances inside of the `getScrap()` method.

> another question, in below case, I need to instantiate new Nightmare object individually , so that I can scrap three different site, have any smarter way to achieve that?

Depends on what your use case is.  You could use a single Nightmare instance and iterate over the URLs, but that will take more time as Nightmare execution _must_ be sequential.  If you're curious on how to do such a thing, [this article from `nightmare-examples`](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) might be worth reading.

Finally, it's probably worth pointing out that based on your above code, you don't have to use `cheerio`.  You could use `.evaluate()` and CSS queries to accomplish what you want, I think.
 Performance-wise, you might see a slight improvement.  You would be cutting out the time it takes for the IPC to respond with the HTML and the time it takes `cheerio` to parse the HTML document.

If jQuery is your tool of choice, you could also use [`.inject()`](https://github.com/segmentio/nightmare/#injecttype-file) to add jQuery to the page so it's available when you use `.evaluate()` (if jQuery is not available on the page already).
 Closing for inactivity.  If you're still having issues, feel free to reopen/open a new issue.
  I think the [`did-get-response-details` event](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-did-get-response-details) should have what you're after.  Something like:

``` js
nightmare.on('did-get-response-details', 
  (
    sender, 
    status, 
    newURL, 
    originalURL, 
    httpResponseCode, 
    requestMethod, 
    referrer, 
    headers,
    resourceType
  ) => {
  //add your checks for url, request method, etc...
  console.dir(headers);
});
```
 Closing for inactivity.  If this is still a problem, feel free to reopen/open a new issue.
  @AVVS are those files available publicly?  The links you provided all 404.

Maybe you could post the relevant parts here or in a gist?
 At first blush, I suspect the selector you're typing into does not exist.  It may be worth checking with `.exists()` first, and if it does not exist, throwing an exception.  Error handling/reporting could stand some improvement (see #646).
 @AVVS Is this resolved?
 @AVVS No problem, glad you got it sorted.  Instead of using `.inject()` (which is what I'm assuming you're using?), you _might_ want to define a [custom preload](https://github.com/segmentio/nightmare#custom-preload-script) for your test suite.
  @diverse-soles Out of curiosity, what library were you using?
  @goddyZhao This is one of the things that #573 was attempting to address.  Currently, there is no way to allow for asynchronous actions in `.evaluate()` out of the box.
 Merging into #552.
  Thanks for another pair of eyes!
  Two problems afoot here.  

Let's address the immediate problem first: why it's crashing.  You have specified a `pageSize` of `letter`, which [according to the Electron docs](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentsprinttopdfoptions-callback) should be capital-L `Letter`.  The page size is (evidently) case-sensitive as `letter` crashes on my Ubuntu 16.04 image and `Letter` works fine.

Onto the other problem: why the output was empty.  `.pdf()` tries to happily pass the error argument up the IPC chain, and since `Error` does not have helpful enumerable properties, the information is omitted. This falls under the banner of what #646 was trying to accomplish.
  > also removes "it.only" from unit tests (assuming that was unintentional).

Yes, it was unintentional.  Streams got crossed.  (This was also fixed in #697, fwiw.)

> I admit that I'm not sure what to write for a unit test here. If you can give me some guidance, that would great.

I think the easiest thing to do would be to use a custom `.action()` action to pull the environment variable from Electron's `process`.  You should then be able to create an instance with an environment variable, use the custom action to get that variable, and test accordingly.
 You should be able to pull `env` off of `process` like you might for any ordinary process, I think.  Off the cuff:

``` js
var Nightmare = require('nightmare');

Nightmare.action('envtest',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('envtest', function(done){
      done(null, process.env);
    });
    done();
  },
  function(done) {
    this.child.call('envtest', done);
  });

var nightmare = Nightmare();

nightmare.goto('http://example.com')
  .envtest()
  .then((r)=> {
    console.log(r);
  });
```

... should be enough to at least make sure you can get the environment variables back.
 No problem! :)

One minor nit: could you remove the `console.log`?
  This should have been fixed with #705.  Closing.
  `.scroll()` [scrolls on the window](https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L494), not on the components contained in them.

That being said, you should be able to use `.evaluate()` and [`Element.scrollTop`](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop) to accomplish what you're trying to do.  If I'm reading your source, you're trying to scroll to the end of all of the code divs, yes?  Something like:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');
var nightmare = Nightmare({
  show: true
});
var run = function*() {
  yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');

  var currentHeight;
  var currentHeight = yield nightmare.evaluate(function() {
    var scrolls = document.querySelectorAll('.CodeMirror-scroll');
    return {
      html: scrolls[0].scrollHeight,
      css: scrolls[1].scrollHeight,
      js: scrolls[2].scrollHeight,
    }
  });
  console.dir(currentHeight);

  yield nightmare.evaluate(function(heights){
    var scrolls = document.querySelectorAll('.CodeMirror-scroll');
    scrolls[0].scrollTop = heights.html;
    scrolls[1].scrollTop = heights.css;
    scrolls[2].scrollTop = heights.js
  }, currentHeight);

};
vo(run)(function(err) {
  console.dir(err);
  console.log('done');
});
```

I left both evaluate calls in for illustrative purposes.  You could cut one of the `.evaluate()` calls and determine height and scoll in a single step:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');
var nightmare = Nightmare({
  show: true
});
var run = function*() {
  yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');
  yield nightmare.evaluate(function() {
    Array.from(document.querySelectorAll('.CodeMirror-scroll')).forEach(function(el){
      el.scrollTop = el.scrollHeight;
    });
  });
};
vo(run)(function(err) {
  console.dir(err);
  console.log('done');
});
```

These might not be 100% what you need, but it should get you on track.
  At first blush, what you have looks like it should work.  Out of curiosity, if you print the index and directory in the then starting with `.then(info => { ...`, what does that result in?  What download library are you using?
 I did a little digging, and assuming you're using `nightmare-inline-download`, this is a bug in that library.  The download handler never gets removed, meaning the first download handler will always handle the download, assigning it the same path.  Fix for that shortly.
 Merging into rosshinkley/nightmare-inline-download#6.

If that's not the library you're using, feel free to reopen this issue.
  I'm not certain, but I don't think so, at least not directly.  Electron's screen resolution depends on the framebuffer it's rendering to.  You could use something like `xvfb-run` to alter the framebuffer (#224 touches on this, although for an entirely different reason).

What are you trying to accomplish?
 Closing for lack of response from OP.  Feel free to reopen/open a new isuse if this is still a problem and you have more information.
  I'm not exactly sure I understand the problem you're trying to solve.  Are you asking if `.wait()` could accept a timeout per-call?
 I _think_ the intent of this is the same as #742.  Merging.
  Fixes #694, also removes an errant `.only()` in the test suite.
  Looking at the current implementation of `.authentication()` and the documentation for the [`login` event](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-login), the actual authentication happens out-of-band with respect to the Nightmare action chain.  There also isn't a login failure event exposed by Electron.  This makes handling error cases tough.

The best solution I can think of is to have Nightmare support an internal event to kill the event chain from an out-of-band event, then creating an out-of-band event after a certain number of retries.

Trying to fix this also uncovered another problem: being able to change authentication after it is set.

All of the above _should_ be addressed in #714.
  Is this possibly the same problem as #596?
 @OleVik Specifically, I was referring to the scrollbar/title et al eating into the pixel count.  I think that might be _part_ of the problem.  The buffer height being incorrect is distressing.

I know there is a problem where you cannot create a window larger than the display size on Windows (see electron/electron#4932 and possibly electron/electron#5053), but resetting the viewport (which calls `BrowserWindow.setSize()` under the covers) _should_ work.

Out of curiosity: can you set the height using `.viewport()` to something big but smaller than the size returned?  Something on the order of `.viewport(dimensions.width, 4000)`?  (I wonder if you're possibly hitting a texture limit and Chromium is misbehaving because of it.)
 @OleVik Out of curiosity, what happens if you try to snap a screenshot of say, `.viewport(4000,4000)`?

A while back, I wrote a quick and dirty [gist](https://gist.github.com/rosshinkley/b5fb5061073756e926b791a66d62b24b) that spit out the max texture size - I wonder if that could be ported to use opengl and freeglut for Windows?
 Hm, that's ... odd.  I would not expect a texture tile to be rectangular.  This makes me wonder if it's something perhaps Windows-specific.

What version of Windows are you running?
  Reopening until Electron dependency is bumped.
 @trompx `XRANDR` being missing is not that big of a deal; unless you're explicitly loading it with `Xvfb` (or whatever X buffer you're using), that line is going to show up, serving as a warning that you will not be able to resize and rotate your buffer.  The original problem with this thread had to do with how Electron was being started, and on certain flavors of Linux, was crashing, which would cause Nightmare to misbehave.
  Hm, out of curiosity, what version of Nightmare are you using?

I thought that if the page was loading, Nightmare would wait for the artificial `did-change-is-ready` event before continuing from a `did-stop-loading` event.  In other words, a race condition while loading shouldn't be possible because the action chain _should_ be blocked.

I'd love to see a minimum case if you could throw one together.  As time permits, I'll see if I can reproduce the problem.
 @LinusU Bumping this thread - did you either get this resolved or put together a test case?
  That's a great idea.  I'll look into it.
  Could you post a small example that reproduces the problem?
 @TimNZ If I'm understanding the problem properly (and it is _thoroughly_ possible I am not), this would mean either that `ChildProcess.kill()` isn't actually killing the child process, meaning Electron isn't honoring `SIGTERM`, or there is some edge case for ending the process that isn't handled properly.  (The latter seems _far_ more likely.)

I am curious to see a reproduction - that would be most informative.
  Keeping the documentation consistent: could you move the `.evaluate()` and `.then()` methods to be inline?
 By the by, the first two commits: +1.  Those are logical changes.
 Awesome.  Thanks! :)
  I'm not sure I follow: when you click `#submit1`, the browser you click in closes?  Have you tried this with `.catch()`?  Also, are you sure the popup does not appear?  (The base Nightmare window is set to be always on top.  Try moving it around to see if the popup is hidden.)

It's worth noting that Nightmare does not work with multiple windows by default.  I wrote a [plugin](https://github.com/rosshinkley/nightmare-window-manager) to address very basic window management needs, but it lacks most of the basic commands that Nightmare has and exists more as a prototype than anything.  See the discussion for making window management native in the next major revision in #593.
 Closing for lack of activity.  If this is still an issue, feel free to reopen/open a new issue.
  Interacting with a Flash application is going to be difficult with Nightmare.  What are you trying to do?
 For what it's worth, you _can_ load [Flash in Electron](https://github.com/electron/electron/blob/master/docs/tutorial/using-pepper-flash-plugin.md).

Something like the following should work:

``` js
var Nightmare = require('nightmare');

var nightmare = Nightmare({
  show: true,
  webPreferences: {
    plugins: true,
  },
  switches: {
    //note: the path on your machine is likely different
    //I'm lifting the player from my local chrome-unstable install
    'ppapi-flash-path': '/opt/google/chrome-unstable/PepperFlash/libpepflashplayer.so'
  }
});

nightmare.goto('http://www.adobe.com/software/flash/about/')
  .then();
```

You should see the Flash intro animation letting you know it is working properly.
 Closing for lack of response from the OP.  If this is still an issue, feel free to reopen/submit a new issue.
  Fixed in #684.  Closing.
  My first gutcheck would be to run the example script with `DEBUG=*` to see if Electron has any useful output.  (My guess is probably not, but it's worth a try.)

Do you have different results running with showing the Electron instance using [`{show: true}`](https://github.com/electron/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions)?

If you write an example against a simpler site (like http://example.com, say) does it have the same behavior?
  This is related to #682, but I also don't think your source will do what you intend.  Nightmare is asynchronous, queuing actions in a chain until `.then()`, `.run()` or `.end()` is called.  Your `if` statement will always run the `else` condition, and produce undesirable outputs.  From the hip, written to use `.then()`:

``` js
var config = require("./settings.json");
var Nightmare = require("nightmare");
var browser = Nightmare({
    "waitTimeout": config.timeout * 1000
});
var title, exists;
browser.goto(config.url)
    .title()
    .then((t) => title = t)
    .then(() => browser.exists("input.login"))
    .then((e) => exists = e)
    .then(() => {
        if(title === config.loginTitle && exists) {
            doLogin(config.expectedTitle);
        } else if(title === config.loginTitle) {
            console.log("Application Check Passed \u2713");
        } else {
            console.error(`Unknown page was open: ${title}`);
        }
    })
    .then(() => browser.end())
    .then(() => console.log('done'));
```

... of course, this depends on what `doLogin()` does.  It might make sense to return a promise from `doLogin()` and return the result.

You could also use [`vo`](https://github.com/matthewmueller/vo) or [`co`](https://github.com/tj/co) to help with generators and then use `yield` to make your script look a little more synchronous.  Also totally from the hip, written to use `vo`:

``` js
var config = require("./settings.json");
var Nightmare = require("nightmare");
var vo = require('vo');

var browser = Nightmare({
    "waitTimeout": config.timeout * 1000
});

vo(function*() {
    yield browser.goto(config.url);
    if(yield browser.title() === config.loginTitle && yield browser.exists("input.login")) {
        doLogin(config.expectedTitle);
    } else if yield browser.title() === config.loginTitle){
        console.log(`Application Check Passed \u2713`);
    } else {
        console.error(`Unknown page was open: ${yield browser.title()}`);
    }
})(() => {
    console.log('done');
});
```

Same caution as above, this also depends on what `doLogin` does.
  There are two different questions here: one, can the download plugin be applied to other windows; and two, if the target of the click event can be changed.

Answering the first: Nightmare will not handle popup windows by default.  I wrote a prototype [plugin](https://github.com/rosshinkley/nightmare-window-manager) to show how it could be handled, but your example has the added complexity of trying to mix another plugin in with window management.  Under the current incarnation of Nightmare, that would be difficult to accomplish.  Native window management is on the list for the next major revision (see #593).

As for the second: I'm not sure, but I doubt it.  If the input has an `onclick` defined specifically, could you use `.evaluate()` to point the target of the action to `_self`?  Something like: 

``` js
nightmare
  // .... actions setting up your conditions ... 
  .evaluate(() => {
    document.querySelector('input[value=Download CSV]').onclick = 
      () => window.open('/customers/apply/inbox.csv?', '_self');
  })
  .click('input[value=Download CSV]')
  // ... other actions... 
```

... I _suspect_ this won't work, but it might be worth a shot.
 @rluisr Did you get this resolved?
 Thanks, @Siilwyn.  Going to consider this resolved, closing.  Also worth pointing out: there is an API for [clearing data](https://github.com/electron/electron/blob/master/docs/api/session.md#sesclearstoragedataoptions-callback) exposed by Electron, but the method isn't directly exposed in Nightmare.  

You could use `.action()`, but I think `webSession.clearStorageData()` should probably be core.  Thoughts?
  > Observed behavior: the page doesn't refresh (but the logged messages still show).

When the URLs match, you're right - [nothing happens](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L171-L172).

> I'm aware that refresh() would work in this instance but sometimes it's not known whether the page we want to get the latest data from is already the current page.

I'm not sure I follow - can you elaborate?

> And such information is hard to get as there's no easy way to directly get the current url.

True, there's no `.url()` method or something similar.  Extracting the information should be reasonably straightforward, though:

``` js
nightmare
  .goto('http://example.com')
  .action()
  .anotherAction()
  .evaluate(() => window.location.toString())
  .then((location) => console.log(location))
```

> Doc of goto specifies that nothing happens if the url given is already the current page

That's a good idea.  As mentioned, that's how it's set up.  (I'm sure there was/is a reason, although I can't recall off the top of my head.)
  Yes, provided Electron supports it.  This has been an ongoing discussion at electron/electron#228 as well as the tail end of #224.
  I'm a little confused by your question, and would like to clarify - are you trying to save an image from a page?
 Currently, you cannot open a new browser window from Nightmare.  #593 has it as a possible future improvement.

For now, you could write a plugin to do such a thing - [`nightmare-window-manager`](https://github.com/rosshinkley/nightmare-window-manager) might be a place to start.  It supports window control, but does not support opening a new window (yet).
 Closing for inactivity.  If you still need help with this, feel free to reopen and provide more information about what you've tried.
  Could you include tests, please?  I think that a test verifying the header is set in Express and perhaps another verifying that Electron is returning the correct referrer from `.goto()` would be sufficient.

Somewhat offtopic, I'm not sure how I feel diverging (or diverging more?) from [`webContents.loadURL()`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentsloadurlurl-options), but I think I can live with adding `Referer` to the headers in this way.

Also somewhat offtopic, it _might_ be wise to accept both the 3 R (`Referer`) and 4 R (`Referrer`) header names.  Thoughts?
  Could you provide a sample of what you're trying to do?
 Hm, you can end the process with `.end()`, but not until after other actions in the chain have finished.  Are you asking if you can interrupt the chain to kill the process?  That would not be advisable.  You _could_ kill the Electron process manually using `nightmare.proc.kill()`, but that will put the Nightmare instance into a state where the behavior is not well defined.
 Closing for lack of activity/information.  If this is still a problem, feel free to reopen/submit a new issue.
  In versions prior to 2.5.0, this (cryptic) error generally meant that one of your selectors was not finding the specified element.  I think Yahoo runs some form of A/B or has different page characteristics based on the requester.  This problem has cropped up before (#116, #490, and I think there were some others).  The Readme version of the example was patched in 2.4.0, the [runnable example](https://github.com/segmentio/nightmare/blob/2.5.0/example.js) in 2.5.0.

My first suggestion would be to update your example to the 2.5.0 version and try running it again.
 @BerlinaLI I have a suspicion you might be hitting #224.  Thoughts?  You can use an [exclusive test](https://mochajs.org/#exclusive-tests) - eg, `describe.only` or `it.only`.

If you're using `mocha-generators`, there is a [known bug](https://github.com/vdemedes/mocha-generators/issues/2) with `it.only`.  There's a [PR](https://github.com/vdemedes/mocha-generators/pull/4) to fix it that you could pull down and link to, if you were so inclined.  (`describe.only` works fine with `mocha-generators`, for what it's worth.)
 Considering this issue resolved.  If you're still having problems with `.only()`, feel free to reopen/open a new issue.
  Looks like this issue is resolved, closing.
  > I had tried that as well. I tried again and neither of the examples you change anything i.e. I could change the switch (proxy-server) to lkjlkj-weioruweoriu and the code still runs the rest of the program.

Hm, setting `proxy-sever` to a bogus URL (or even a malformed URL) causes provisional load and load failures, at least with 2.5.0.  Out of curiosity, what version of Nightmare are you running?

> I donâ€™t know if you can set the auth info in the URL (e.g. http://user:pass@1.proxy.com:80) or if you would need to use the authentication() action

I would be _very_ curious to know the answer to this.
 With #687 being merged in, I'm going to consider this issue resolved.
  Fixes #663.
  Sure!  The `.then()` function will have as its arguments the results of the previous method:

``` js
nightmare
  .goto('http://example.com')
  .evaluate(() => {
    return document.querySelector('#my_awesome_thing').innerHTML;
  })
  .then((awesomeThingHtml) => {
    //do something with the HTML value
  })
  .then(() => nightmare.end());
```

As another example, you may want to have a look at `nightmare-example`'s ["Running Multiple Steps" example](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/promises.md#running-multiple-steps).
  > What is the intended use case for .use(fn)?

`.use()` is intended to wrap a group of actions to make adding compound actions to Nightmare a little easier and readable.  Note that it doesn't add callable actions directly to the instance itself.  (In other words, you can't call `nightmare.myAction(...)`, but you can call `nightmare.use(myAction(...))`.)

> I had hoped that it could be used to add actions to nightmare instances, but I haven't gotten that to work since it seems that I can only add actions on the global Nightmare class.

I am guessing you're referring to `.action()`?  This is a very different mechanism - `.action()` adds an action directly to the Nightmare prototype, also adding all of the sugar required to execute a method inside of Electron.

What are you trying to do?
 [In the development of `.action()`](https://github.com/segmentio/nightmare/pull/425#issuecomment-171139723), I had originally thought about adding functionality per instance, but this was abandoned for simplicity's sake.  Is allowing a type to modify it's own prototype bad practice?  (Debatable.)

I think `.action()` is _probably_ better suited to your use-case.  It shouldn't step on other libraries so long as there aren't naming collisions.  Doing what you're asking with `.use()` would probably require calling `.then()`, which might have undesirable effects.

Thinking out loud: would `.exists()` and `.select()` accomplish what you're after?
 For what it's worth: I've thrown together a [`.action()`](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/action.md) and [`.use()`](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/use.md) examples over at [`nightmare-examples`](https://github.com/rosshinkley/nightmare-examples).
 That's _really_ what `.action()` was intended for.  You could rewrite your `selectHasOption` and `selectOptionWithText` as `.action()`s.  From the hip:

``` js
Nightmare.action('selectHasOption', (selector, option, done) => {
  return this.evaluate_now((selector, option) => {
    // ...
  }, done, selector, option);
});

Nightmare.action('selectOptionWithText', (selector, option, done) => {
  return this.evaluate_now((selector, option) => {
    // ...
  }, done, selector, option);
});
```

Under the covers, Nightmare amends the prototype with the action you specify.
 First and foremost: I agree.  Modifying the prototype directly for actions has problems.

The idea behind modifying the prototype was, again, done for brevity/cleanliness and so you're not slogging through a ton of boilerplate just to get a Nightmare instance.  Furthermore, patching the prototype is how [internal methods are attached](https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L479-L482).  Allowing users to leverage that was a reasonable outgrowth.  Also, patching of Electron behavior was built atop the already-existing patching of Nightmare behavior.

I'm not saying it's correct.  Scope and use of Nightmare has changed.  A lot.

This was sort-of-kind-of touched upon in [this comment](https://github.com/segmentio/nightmare/pull/609#issuecomment-222428497).  I think better plugin/action management should be put on the v3 list in #593.  Thoughts?
 Merging this with #593.  This is what `.then()` is intended to do: execute and then clear the queue.  The `EventEmitter` leak is a long-standing issue (#282, #350, #589, #658 - and I'm sure I've missed many).  While ending the Nightmare instance would "prevent" the leak, I don't think doing what you're asking would solve the underlying issue.
  This looks a _lot_ like electron-userland/electron-prebuilt#108.  The TL:DR version is that you've likely got an ownership discrepancy with your local NPM cache.  Can you give that a look and see if that fixes your problem?
 Closing for lack of activity and information.  If this is still an issue, feel free to reopen/submit a new issue.
  The resolution of [`.goto()`](https://github.com/segmentio/nightmare#gotourl-headers) has that information.  For example:

``` js
var nightmare = require('nightmare')();
nightmare.goto('http://example.com')
  .then((gotoResult) => {
    console.log(gotoResult.code); //prints out the HTTP status for the request
  })
```
 What does not work?  How is it failing?
 @kuyoonjo Be sure you're calling `.then()` after `.end()`.  That will run the queued actions (if any) and end Nightmare gracefully.
 @kuyoonjo also, if you have a more complete example, I'd like to see it.  I might be able to help more that way.
 Awesome.  Closing this as I think it's resolved.  If you have any more problems, reopen/open a new issue.
  With some experimentation, I think Electron dumps the temporary file into `[home]/Downloads` instead of honoring the `paths` download path.  You _can_ override the `home` directory, but I suspect that would have other unintended consequences and isn't really what you're after.  

I'm also kind of surprised that `webContents.savePage()` allows for an undefined path.  I suspect the temporary file is just that - temporary, designed to be removed after the file is moved to the ultimate destination.  Looking at the test spec, there's no explicit cases for an undefined filepath.  Might be worth filing an issue with Electron to see if that's intentional or not.

In the meantime, there are a couple of options:
1. specify the save path every time
2. use `.use()` to wrap the `.html()` action
3. write a plugin to get the behavior you want
 Closing for lack of activity.
  It looks like [you might already have an answer](https://github.com/electron/electron/issues/5635).  I think (someone please correct me if I'm wrong) Chromium uses the HTML from `DOMReady` for fulfilling that action.

As an example, you could write something to fulfill this yourself using `.evaluate()` on the document's HTML.  Something like:

``` js
var nightmare = require('nightmare')(),
  fs = require('fs'),
  path = require('path');

nightmare.goto('http://example.com')
  .evaluate(() => document.documentElement.innerHTML)
  .then((html) => {
    fs.writeFileSync(path.join(__dirname, 'output.html'), html);
    return nightmare.end();
  })
  .then(() => console.log('done'));
```
  fixes #621.
 > Can we also drop the --harmony flags as noted all over the README, then? (I think we can, but honestly not totally sure.)

I'm almost positive we can.

> May also want to add multiple node versions for testing in circle.yml as described here: https://discuss.circleci.com/t/testing-multiple-versions-of-node/542

Ah, that's a good call.  I'll have to look into that a little deeper, what do you think is reasonable?  Latest 4, latest 5, latest 6?  Something like that?
  Looks good.  Thanks!
  @oliviervaillancourt Part one looks great, thanks for fixing that.  Part two I'd _probably_ leave as simply `example.js`.  The example is in the root of the project directory and is (I think) fairly obvious which example we're referring to.  The only remaining thing I can think of is possibly changing the README to say `example.js` instead of `yahoo.js` under the Examples heading on line 55 (which isn't your fault, I think it's been that way for quite a while).

@Mr0grog Thoughts?
 Looks great.  Marking for inclusion.  Thanks for the effort, @oliviervaillancourt!
  This is touched on in #552, and a fix is proposed in #573.  At the time of this comment, it's incomplete.
 Merging into #552.
   > That said, returning something in all the explicit error cases is waaaaaaaay more important. The serialization thing is more of a nicety (but not a free one).

I should have chosen words more carefully.  Freeish?  Cheap?  Close to free?  Free enough?  Free as in mattress?  Take your pick.  My point was you could manage the explicit error data cases internally to the IPC to mimic real capital-E Errors easily enough, so long as the data is consistent.

Anyway, explicit errors are much more important, you're right about that.
  Thank you for this, looks good.

As for the errors, it might be better to move this conversation to #646.  I haven't thought terribly deeply about serializing errors over IPC - my first thought is that all actions would have to consistently handle error cases, which is something we've also touched on in #593.  Once we've got consistent error reporting between the parent and child process, the errors over IPC almost falls out of that for free.  Entirely possible I'm missing something, though.
  I had spotted this when working on stuff for #502, but hadn't gotten around to PRing it.  Thanks!
  @oliviervaillancourt just to +1 what @Mr0grog was saying: _please_, by all means, keep going.  The more contributors, the more people we have involved, the better. :)
  +1 on this.  Including.
  > Iâ€™m not 100% providing both those methods for overriding is bestâ€”maybe it should just follow the example of wait and only support the constructor option?

Hm, I'm inclined to say that it should be a constructor-only option.  I can't think of a case offhand where having differing timeouts by URL would be helpful.  Is there a use case buried here that I'm not thinking of?

> I also wonder if, based on this, certain actions should be exempted from the continue check (e.g. goto, viewport, wait(number)), since itâ€™s not really relevant for everything. I think thatâ€™s definitely out of scope for this PR, though.

Fair point.  I suspect the idea was to have all of the actions use the same events for simplicity, but I can certainly see where a go-ahead timeout would be useful for those handful of actions.  (Adding it to `.wait(number)` might be breaking for users in the wild, though.)
 > I think this came from my personal angst that itâ€™s not an option with wait(selector|function)â€”where I do think there are clear use cases for different timeouts on different calls (bits of this PR have been hanging around in my git stash for a while).

Ah, I understand.  Wholly agree it makes sense for `.wait()`, but for `.goto()` ... I'm leaning toward "no".

> Maybe when loading a local page you might expect it to be fast and want to time out more quickly than when loading something from the web?

Mmm, _maybe_ - this feels a bit out in the weeds, though.  I say let's not complicate the method signature until it's demonstrably useful.  Thoughts?
 @Mr0grog I saw. :)  Doing my best to be thorough.

This looks good.  +1 to you sir.
  related: #593, #645, #646 
 Merging this conversation into #646.
  Looks like this issue is resolved, so I'm going to go ahead and close it.  If this is still a problem, feel free to reopen/submit a new issue.
  @RoryJShevin Can you post a minimum reproduction of this problem?  Also, what version of Nightmare are you using?

I've tried to reproduce this problem with a ~15mb and ~500mb page and cannot.
 Closing due to lack of information.  If this is still a problem, feel free to reopen/submit a new issue with a repro case.
  Related: #646, #593, #645
 Merging into #646, moving discussion for serializing errors/error handling there.
  > Right know it logs something like "Cannot read property 'blur' of null" when there is a not existing selector, would be great for next version to have additional info of the action and what triggered the error, etc :)

This part, however, dovetails with some of the other issues we've been talking about in #645, #646, and #593.  I'm on board for making events have more helpful errors.
 I'm going to merge this with #646.
  #644 needs to be pulled in first at a minimum.
 @LinusU It works fine with 1.0.x and (memory serving) 1.1.x, but some of the tests involving `webSecurity` break with 1.2.x.  I believe it's symptoms of electron/electron#5712, which have been fixed but as yet unreleased (at least with `electron-prebuilt`).  

I'm comfortable upgrading to a non-breaking version in the meantime, barring protest.  Thoughts?
 @albinekb This will get pulled into the next version. :)
  @Muyv Is this resolved?
  Hey Nightmare Team,

I still love the work you've been producing, but I've run into a few snags. With the old generator form, I used to be able to having intermediate steps in my promise or function that would check for specific conditions before failing or continuing. 

With the new promise format, I don't see a way I can do this, or perhaps I'm missing something.

An example might be:
- Go to a login page
- Check for a selector
- Type username and password
- Login fails
- Check for failed message, throw error.
- Take a screenshot to send with the error for debugging purposes

In the case of the new promise-based nightmare, the failure is just a timeout since I have yet to figure out a way to have an intermediary step.

Any advice on how I might be able to achieve this?
 Thanks @Mr0grog. I'll go and give it a try again. Thanks for your help.
 Hey @Mr0grog,

Sorry for opening this up again, but looking at the promise example, I'm not positive generators would work inside of it.

Here's an example based on your suggestion:

``` javascript
const Nightmare = require('nightmare');
const nightmare = Nightmare({
  show: true
});

function getCnn(resolve, reject) {
  return nightmare
      .goto('http://www.cnn.com')
      .wait(400)
      // selector that fails on purpose.
      .exists('.some-random-selector')
      // simple equivalent of what I'm attempting.
      // let c  = () => function* testTwo() { yield *function* test() { yield 1; }(); }().next();
      // this might only be possible with VO.
      .then((failed) => {
        console.log(failed);

        // definitely won't work in promise form
        // const image = yield nightmare.screenshot();

        // only way to get yield to work, sort of in a promise
        // still fails
        // const image = yield *nightmare.screenshot();

        // fun way of trying generators, but doesn't work either.
        // const image = function* getImage() {
        //  yield *nightmare.screenshot();
        // }().next();

        //console.log(image); // never printed.
      });
}

getCnn();
nightmare.end();
```

It's possible for my use-case that using the generator form may be better altogether because I have other actions that need to occur after `.then`, an example building off the original, 
- Login fails, fail and take screenshot
- Login success, go to the next page
  - do a few actions
  - take a screenshot.
  @atomless Is this issue resolved?
 Closing for inactivity, if this issue is still a problem feel free to reopen/open a new issue.
  First, the immediate problem: the way you're using `.evaluate()`, the function that accepts the body and sets `ctx.body` will be passed as an argument to the first function in `.evaluate()`.  Off the cuff, I think you want something like:

``` js
      nightmare
        .evaluate(function() {
          return document.documentElement.outerHTML
        })
        .run(function(err, body) {
          ctx.body = body;
          if (err) return done(err)
          debug('nightmare .run url: %s ; status: %s', ctx.url, ctx.status)
          done(null, ctx)
        })
```

Second, a question for you: have you seen the [Nightmare driver for x-ray](https://github.com/phulas/x-ray-nightmare)?  Would that work for your application?
  Duplicate of #625, closing.
  Another nit: your initial example also will only scroll until the page is 100000 px long, which is _big_, but "infinite" scroll pages could be longer.

> I want it to scroll down until the size of the returned document does not increase anymore. 
> How can I achieve this?

This is a **very** naive method to answer your question:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');
var nightmare = Nightmare({
  show: true
});

var run = function * () {
  yield nightmare.goto('http://someInfiniteScrollPage.tld');

  var previousHeight, currentHeight=0;
  while(previousHeight !== currentHeight) {
    previousHeight = currentHeight;
    var currentHeight = yield nightmare.evaluate(function() {
      return document.body.scrollHeight;
    });
    yield nightmare.scrollTo(currentHeight, 0)
      .wait(3000);
  }
  yield nightmare.end();
};

vo(run)(function(err) {
  console.dir(err);
  console.log('done');
});
```

This approach has problems: when you're going against a page that [actually is an _infinite_ scroll](http://scrollmagic.io/examples/advanced/infinite_scrolling.html), the above will never end.  Also, the `.wait()` call could be replaced with waiting for the scroll element count to change to possibly reduce latency and increase robustness.

> Javascript kills me, in Perl this would have been so easy, but Mechanize::Firefox is outdated and very slow.

If Perl is your language of choice, you _might_ want to check out [Selenium](http://www.seleniumhq.org/).  I haven't personally tried it, but there is a [Perl port of the remote driver](https://github.com/gempesaw/Selenium-Remote-Driver).
  This looks great, adding to next release. :+1: 
  Outgrowth of #620.
 > Should probably document it clearly in the README, too. 

ðŸ‘ 

> To be honest, Iâ€™m not really sure what the compatibility requirement is.

We talked about it (I can't find the reference offhand either), and I believe we came to the consensus that Node 4+ was "official", but I _think_ everything will still work using 0.12.x with `--harmony`.
 > Node 4+ was "official", but I think everything will still work using 0.12.x with --harmony.

Scratch that.  Template strings don't work with <4.
 ... won't calls to [`.call()`](https://github.com/segmentio/nightmare/blob/master/lib/ipc.js#L72) fail, specifically when the emitter [gets a result](https://github.com/segmentio/nightmare/blob/master/lib/ipc.js#L87)?
 Totally fine!  :)  Just making sure my read of things was okay.
 > (Do we need to change ipc.js?)

I don't think so.  My stance is that it's _fairly_ reasonable to say that 4.x is a good minimum requirement.  What do you think?
 I'm almost 100% sure we had this conversation (or a very close approximation), but it's beyond my searching ability.  Now it's official in #653! ;)
  Are you running with `--harmony`?  I _thought_ fat-arrow notation was supported (with some caveats with respect to binding `this`) in Node 0.12.x.  Open to being wrong, though.

Node 4.x+ is recommended for Nightmare, but I see now that it's not listed as the engine in `package.json`.  (I also know that assertion had been made before, but it's not jumping out at me where.)
 I believe this issue has been resolved, closing.  If you continue to have problems, feel free to reopen/open a new issue.
 @dcshapiro What version of node and nightmare?
 @dcshapiro [Nightmare requires 4.x or higher.](https://github.com/segmentio/nightmare#node-versions)  See also #621.

I _think_ you might still be able to get away with using 0.12.x and `--harmony`, but your mileage may vary.
  I suppose you could use `.evaluate()` and use [`document.elementFromPoint()`](https://developer.mozilla.org/en-US/docs/Web/API/Document/elementFromPoint).  An untested from-the-hip example:

``` js
nightmare
  .goto(someUrl)
  .evaluate(function(x, y){
    document.elementFromPoint(x, y).click();
  }, x, y)
 //... other actions
```

... but that might not be granular enough for your application.  You could also initialize your own mouse event with a custom X,Y and issue it against the control at X,Y.  The [`MouseEvent`](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent) docs may interest you.

If you wanted to get fancy, you could also write a plugin using Electron's [`webContents.sendInputEvent`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentssendinputeventevent) to send `mouseDown` and `mouseUp` events.
 According to the [`MouseEvent` constructor docs](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/MouseEvent), at least in my naive read, `clientX`/`clientY` is relative to the client window, not to the DOM element (like it is for the readonly `clientX`/`clientY` on a caught `MouseEvent`).  What happens if you specify an absolute point?
 Scratch that, I'm wrong, [jsbin](http://jsbin.com/coxekatofe/1/edit?html,js,console,output) to prove it.

Based on that little experiment, what you have ought to work.  Out of curiosity, what happens if you instead issue a `mousedown`?
 > @rosshinkley do you have any idea why the click() (and mouseover/mousedown) action doesnâ€™t use sendInputEvent? Assuming no, since according to git, they pretty much appeared out of whole cloth, but asking just in case.

I _suspect_ it's because `sendInputEvent` wasn't a part of the Electron API when 2.x was initially released.  (The release dates differ by something like 10 days, memory serving.)  I also suspect that it worked Good Enough&trade;, so before now there hasn't been a real reason to change it.

> Seems like upgrading them to use sendInputEvent would be more â€œcorrect,â€ though it would change behavior slightly. (Maybe a good v3 change?)

I'd like to (like you) see more usage before making the change, but I also agree this feels much more in the spirit of "doing things as an actual user would", which is in keeping with the spirit of Nightmare.  Given that it seems to be causing enough problems, I'd be open to moving it into core.  Thoughts?
 Closing for lack of activity (and looks like this is possibly resolved).  If this is still an issue, feel free to reopen/submit a new issue.
  I suspect that DOMElement's parts are non-enumerable, and as such not crossing the IPC boundary.  In other words, it's not going to serialize well.

Fixing it is fairly straightforward: pluck the values you want inside of `.evaluate()`.  Say you wanted the question title and link:

``` js
var Nightmare = require('nightmare');
var startingLink = "http://stackoverflow.com"

var nightmare = Nightmare({
  show: true
});

nightmare
  .goto(startingLink)
  .evaluate(function() {
    var elements = Array.prototype.slice.call(document.getElementsByClassName('question-hyperlink'));
    return elements.map(function(element) {
      return {
        href: element.href,
        title: element.innerText
      }
    });
  })
  .end()
  .then(function(content) {
    console.log(content);
  })
```

Note that the use of `Array.prototype.slice.call` is deliberate: `document.getElementsByClassName()` returns a array-like object known as an [`HTMLCollection`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCollection).
 @albinekb Ah, true.  Thanks for pointing that out.
  After playing around with this and recreating the behavior, it looks like the [resource provider](https://code.google.com/p/chromium/codesearch#chromium/src/cc/resources/resource_provider.cc&sq=package:chromium&type=cs&l=458&rcl=1464366759) deep in the guts of Chromium uses the device limit (I think it's 8 or 16k in general).  This is important because that defines the maximum size of the rendering canvas, which defines the maximum size of the screenshot.  Anything larger and the texture management/WebGL parts start throwing exceptions.

Anything larger, unfortunately I think you'd have to start stitching parts together yourself.
  With Nightmare? No.  Nightmare is built to be run atop Electron.

If you're looking for a browser automation suite, [Selenium](http://www.seleniumhq.org/) is a fairly popular choice.  It's got webdrivers for most (all?) popular browsers.
  Possibly related: #238 and #405.
 @Mr0grog true.  The reason i roped #405 in as a "maybe" was because it didn't _always_ crash the process, sometimes it would hang with no useful info.  It's possible that was hitting two different problems.
 @JWMarchant For what its worth, you can specify a file descriptor with `DEBUG_FD`.  Something like: `DEBUG_FD=3 DEBUG=nightmare:* node myNightmareScript.js 3>output.txt`.  For completeness, could you also run with `ELECTRON_ENABLE_LOGGING=true` and `ELECTRON_ENABLE_STACK_DUMPING=true`?

Also, if I'm not mistaken, your source will run up to ten URLs together at the same time - the second parameter to `async.queue` is a concurrency parameter.  For log clarity, it might also help to set it to 1 (or remove it as the default is also 1). 
 > Ok, Iâ€™ve only gotten this to reproduce a few times, but it seems like the issue is well below Nightmare or Electronâ€”the HTTP request for the initial HTML content of the page never actually closes...

That... is not great and kind of scary.  That makes me wonder how Treehouse is being served, leading me to ...

> On the Electron side, we get response details for the beginning of the HTML and we get the dom-ready event, but we get no finish or failure events. Inside the browser window, document.readyState never moves from interactive to complete and the windowâ€™s load event never fires. Oddly, though, the DOMContentLoaded event does fire.

... which, also based on your previous comments, I agree that it might be the response not getting ended properly in all circumstances.  I don't know if that would cause the `readyState` to hang (or any of the other... side effects? you describe).  That should be easily testable, and seems worthy of at least a rough pass.  I also have a sneaking suspicion you may have given this a try already.  Thoughts?

If it is a problem with the OS/networking stack (seems unlikely, but certainly possible), I'd be curious to get a quick straw poll on who is using what and try to cover what is missing.

Moving on!

> Soâ€¦ Iâ€™m thinking the best way to address this is [consider `dom-ready` as acceptably complete].

In the spirit of Nightmare behaving as close to a Real Browser&trade; as possible, considering `dom-ready` + an arbitrary timeout (30s default + an options override seems like a good first pass, by the way) as success seems reasonable.  The page is still usable, and (ostensibly) can issue execution requests/interact with it.  However, I would feel much more comfortable if the hang could be reliably reproduced so tests could be propped up against it.
 > However, I would feel much more comfortable if the hang could be reliably reproduced so tests could be propped up against it.

That being said, _not_ a dealbreaker.  Would be nice to have if the hang could be produced reliably (and in a reasonable amount of time).
 This should have been fixed with #640.  Closing.
  As far as I know, you can't, at least not yet.  #235 covers it, and I don't think the `debugger` method has been tried/made into a plugin.
 Thank you @rosshinkley.
 Interesting. Thanks @lukehorvat.
 I wrote a [plugin](https://www.npmjs.com/package/nightmare-upload) that should give you the same ability as 1.x to add files to a file input.  As that should solve this issue, I'm going to go ahead and close this issue.  If this is still a problem, feel free to reopen/open a new issue.
  some quick thoughts:
- the chaining is primarily there to help it so you don't need to compile JS with babel or use co. this is sort of become less and less relevant, i think it's probably fine to just await or yield at each step. you'll probably get better performance when you do want to parallelize this stuff since right now you're stuck with the internal queue regardless of if you call these methods in parallel.
- can't you async/await now? nightmare implements thenables, which are basically lazy promises and should give you all the advantages of promises, without cluttering up your API with promise-specific syntax
- the prototype extension is really clean, but do you get a lot of advantages just using object with functions. if i have some time, i'd like to see nightmare move more towards this: https://github.com/matthewmueller/plumbing/blob/master/test.js, where you get a shared context (this) and can easily add tracers, logging, queueing (any other decorator) in user-land without cluttering up the fundamental actions of nightmare.  

i'm going to leave it up to the others to decide to merge or not, since i haven't been actively working on nightmare lately.
   Fixed in 2.4.0, closing.
  I suspect one of the selectors is causing an error.  What happens if you add a `catch`, like:

``` js
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

nightmare
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('#uh-search-button')
  .wait('#main')
  .evaluate(function () {
    return document.querySelector('#main .searchCenterMiddle li a').href
  })
  .end()
  .then(function (result) {
    console.log(result)
  })
  .catch(function(err){
    console.dir(err);
  });
```
  You're using `yield` outside of a generator, and I don't think that's legal.

Also, in your case, you don't need `yield` if you are using `.then()`.  At first glance, your source would probably work as expected if `yield` is removed.
  Redo of #600 to fix #599.  This method allows for synchronous version retrieval.

The only thing I'm not _real_ crazy about is the debugging of the version information.  That seems to defeat the purpose of using a lazy getter that props up the cached version values.  Thoughts?
 > Maybe not really necessary at all. 

I was heading in this direction, at least for this incarnation.

> Other note: if engineVersions is only available on a Nightmare instance, maybe no great need for execSync.

I'm kind of 50/50 on this.  I kind of like having the version property be a regular ol' synchronous property.  However, the fact that versions can change by instance makes me think maybe it should be a chainable like it was in #600 (although it would still need some naming and placement touchups).
 ... also to add another possible wrench to the mix, and maybe another point for the original incarnation, this will cause a process to never quit:

``` js
var Nightmare = require('nightmare');
var nightmare = Nightmare();
console.dir(nightmare.engineVersions);
```

... as the child process is started at construction time.
 For completeness, I've gone ahead and finished this PR with suggested changes.  However, in light of Electron versions being instance-dependent and the mere instantiation of Nightmare creating a possible "hang", I think it's best to re-open #600.
  Poking a head in:

> There was some brief discussion not too long ago (#502 (comment)) about whether it would be useful to do this automatically, but I donâ€™t know that itâ€™s gone anywhere.

I've been working on this off and on, but hit a snag with `Xvfb` not reliably stopping when Electron stops.  Still in the works if I can get it working properly.
 The following adapted from the example works on my headless box:

``` js
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');

var xvfb = new Xvfb({
  silent: true
});
xvfb.startSync();

var nightmare = Nightmare({
  show: false,
  webPreferences: {
    partition: 'custom'
  }
});

nightmare
  .goto('https://google.com')
  .evaluate(function() {
    return document.title;
  })
  .end()
  .then(function(title) {
    console.log(title);
    xvfb.stopSync();
  });
```

Is that what your modification looks like/what you're running?

A couple of notes:
- Nightmare construction must come _after_ the Xvfb start.  (It did here, but it's worth pointing out it's a requirement.)  The Nightmare constructor automatically starts Electron and Xvfb should be running prior to that.
- This log line: `electron:stderr Xlib:  extension "RANDR" missing on display ":107"` makes it look like you might have other instances of Xvfb running.  I've had Electron get a little flaky with multiple instances running (_usually_ with regards to problems described in #561).  Might be worth a `killall` or a reboot to have a fresh start.
 That's .... baffling.  @yoz might have been on the right track, but the suggestion there looks like it would work for npm2, not npm3.  If you look at `node_modules/electron-prebuilt/dist`, does `electron` exist there?

I'd also be curious if you explicitly installed `electron-prebuilt` and/or explicitly set [`electronPath`](https://github.com/segmentio/nightmare#electronpath) if that might have any effect.
 @paulintrognon You might want to take a look at #224.  The short version is that Electron requires a framebuffer to render, and when you're running headlessly on Linux, running `Xvfb` satisfies that requirement.
 If you run with `DEBUG=*`, Electron _should_ fail with helpful messages telling you what binary is missing, which should let you figure out what package needs to be installed.  I suspect you're missing libxss or libnotify.

I'm going to go ahead and close this issue.  If it crops up again, feel free to reopen/open a new issue.
  It should.  Are you having a specific problem returning an object or array back from `.evaluate()`?
  Quick attempt to address #599.
 Reopened with suggestions from #604.
  Could the information be captured during the `app.on('ready')` handler and piped up as part of the response there, then attached to the Nightmare instance inside of the instance construction sugar?  That would negate the need for extra calls, and that uses a trip that's already being made, so we get version info for (almost) free.  Thoughts?
 Although... that would mean the version info is not immediately available like you might expect.  It'd only be available after Nightmare has entered a ready state, like it would prior to executing a chain.  I was trying to get away with _not_ having a `.version()` (or similar) method, but now I'm not sure that's particularly feasible.
 I think I still prefer exposing _some_ way of getting the versions programmatically, and I can't think of a good method for doing that without an explicit method that doesn't require side-effect-y stuff.

That said, adding a debug call for the versions on `ready` is probably worth doing and will cover most (probably an overwhelming majority) of cases.
 "Fixed" in 2.4.0, closing.
  For the double size: this has to do with high-resolution display.  Viewport dimensions are in browser pixels, not device pixels (thanks to @Mr0grog for pointing out the difference).  For more information, read  [the bottom of #498](https://github.com/segmentio/nightmare/issues/498#issuecomment-189156529).

For the proportional scaling, I'm not sure.  It might be symptoms of the same quirk.
  https://github.com/electron/electron/blob/master/docs/api/app.md#appcommandlineappendargumentvalue

List of arguments:
http://peter.sh/experiments/chromium-command-line-switches/
 I'm okay with this change.  Would you mind adding to the readme to cover the option and where to find Chromium switches?
 done
 @yotamlaufer Awesome, thank you.
 With please. I love nightmare!
  It will be really useful to set chromium arguments, allowing tweaking of the runtime.

https://github.com/electron/electron/blob/master/docs/api/app.md#appcommandlineappendargumentvalue
 https://github.com/segmentio/nightmare/pull/595
  I'm not sure where to put this, and I'm open to this being moved to a Wiki if that makes more sense.  In the interest of having all of the big (and possibly breaking) features/nice-to-haves for the next big release in one spot:
- Native `iframe` support and management - #203, #496
- Multiple window management support (including popups) - #352, #510 
- ~~IPC safety - #493, #579~~ 
- Queue safety - #493, #239, #522 (and many, _many_ more)
- Actions with selectors waiting on selector prior to executing action - #388
- `.goto()` optionally returning after `DOMContentLoaded`
- Reduce plugin function complexity

There may be a need for:
- An upgrade guide for users
- Splitting up the documentation (akin to how Electron has it)
- A semi-formal statement of ongoing support for 2.x for some period once 3.x is finished

Nice to-haves:
- Manipulating elements with custom predicates - #867 

What have I missed in features, needs, or linked issues?

_edit:_ added element  IPC safety will likely make it into the next release of Nightmare.
 > #596 makes me wonder if changing viewport() to actually set the viewport (as opposed to window) size would be a good breaking change for v3.

Hm, how are you planning on doing that?  Using `window.outerWidth` and `outerHeight` and then adding the difference?  (I don't remember being able to set the viewport directly, but I'm probably wrong.)

> Maybe have goto return as soon as a page is loading so you can execute scripts ASAP during load?

To what end?  Should `preload` be extended (or pluggable) instead?

> Have actions with selectors wait for the selector before doing the action (#388). Capybara (Ruby), for example, does this. It could possibly be configurable (though I think youâ€™d want opt-out rather than opt-in).

Fully on-board for an implementation of #388.
 > I think just calling window.setContentSize() instead of window.setSize()

Of course.  Y'know, I've read the `browser-window` docs a zillion times and forgot about `setContentSize`.  Maybe I need to read it a few more times.

> I think I was thinking so you could get in as early as DOMContentLoaded or maybe before other scripts, but maybe specifying preload stuff somehow would be better. 

I was pondering out loud, and now I'm wondering if plugging preload is a good idea.  I think preload is executed prior to every page load, in so doing losing a bit of control - there are probably situations where you want to run a given script on a given page's load.

I doubt I'm thinking about it the way you are: what would you suggest as API changes?  It seems like you're advocating having a navigation setup method and a navigation method - am I anywhere close to being on the same page?
 I've been tinkering with the idea of changing the Electron part of `.action()` to wrap the ambient `require`.  The function signature is ugly: `function(name, options, parent, win, renderer, done)`.  Changing the `.call` in the `action` handler from:

``` js
.call({require: require, parent: parent})
```

...to something more like....

``` js
.call({
  require: (lib) => {
    if(lib==='nightmare-plugin') {
      return {
        name: name,
        options: options,
        parent: parent,
        win: win
      };
    }
    return require(lib);
  },
  parent: parent
})
```

... which would make the handler signature be `function(done)`.  Also, dropping the `renderer` as I think it could be `require`d.

I realize wrapping `require` is also kind of ugly and probably unadvised, but I thought I'd float it out.  Thoughts?
 > I have had to look it up in the README literally every single time Iâ€™ve needed to use it

Me too.  And I _wrote_ the [expletive redacted] thing.  I'm going to go on a limb and say it's the most unwieldy part of Nightmare, and humbly apologize.

> But why not just make those variables ambiently available in the pluginâ€™s closure instead of wrapping require?

It's certainly easy to do, but makes where those variables came from kind of opaque.  The less it seems like magic, the better.  (Using `require` only makes this marginally better, I realize.)

> Or, barring that, have plugins take two args: an object with all the things ...

The options hash was [frowned upon](https://github.com/segmentio/nightmare/pull/425#issuecomment-169736725) in the orginal incarnation.  I wouldn't be totally against it (provided it has a descriptive name), but `require` seemed to satisfy both the "no options hash" and the "this function signature is _impossible_ to remember" demi-requirements.
 > My use case is basically: â€œI want to click this button and I donâ€™t care whether images have loaded yet.â€

That's what I was guessing, and that would be awkward to cram into preload.  That's why I walked it back.  I'm not sold that plugging preload is a _bad_ thing necessarily (having to redefine all of the machinery for `console` et al is not a great solution, either), but not going to solve what you had in mind.

> BUT the more I think about it, that makes a lot of things more complicated...

This is what I was thinking, but I thought maybe there was an obvious part that I had missed.  (I have a penchant for overcomplication.)

> A possible alternative might just be to add an option to goto asking it to return as soon as the HTML is loaded, but keep the default behavior the same. (e.g. goto('url', {waitForResources: false}))

I'm trying to think of countercases, and while I can think of instances where not waiting is silly, they are still valid use cases and I _think_ would behave properly.  (Eg, `.goto(myUrl, {waitForResources: false}).wait('.mySelector')` where `.mySelector` is added by the client.)  At first blush, this is a reasonable approach.
 > Generally: have every action return something? In a similar vein, be better about errors. 

Can't +1 this enough.

> maybe a subtype, like NightmareError or something

That's something I had not considered, but the idea is certainly appealing.

>  so probably requires an audit of all existing actions first (if it seems like a good idea)

This is probably worth doing.  Added #646.
 @overflowz The main holdup right now is that `preload` is not honored by windows not created by instantiating a new `BrowserWindow` internal to Electron, specifically with `window.open()`.  See electron/electron#2605.

I haven't dug into it, but it _might_ be skirted with some `preload` magic on the main Electron window.  At the time, it felt like an _awful_ lot of work for something that might end up getting fixed.  @trusktr did @Mr0grog's suggestions work for you?
  This is a case I would not have thought of.

> Also worth noting: we donâ€™t handle errors especially well this way. Itâ€™s not any worse than before, but I wonder if calling `goto('javascript:notAnActualFunction()')`  should return error instead of success...

Oh man.  _My eyes._  I hadn't considered this case, either.  I'd be curious to see a proposed implementation for supporting rejection of bad `javascript:` links.
 (At any rate, +1.  This will be included in the next release.)
  Hm.  I've seen similar screwball failures on Circle, even with the `xvfb` patch.  I don't know if that's still the cause, but it may be worth another look.
  This came up in #558, and I'll quote @Mr0grog:

> Soâ€¦ it would be a very bad idea not to exit the process at this point. Electronâ€™s underlying IPC machinery is now in a bad state, so further communication between the your node.js process and the â€œbrowserâ€ is not reliable.

I'm wondering now is if instead of exiting, the Nightmare instance should be put into an error state where any further calls would cause exceptions as the IPC parts are no longer reliable.

All of that being said: uncaught exceptions are bad.  Why not add handling for the exception?
 Fixed with #589.  Closing.
  Fixes #421, at least in part.

Open questions: 
1. Should Nightmare override the environment variable for `ELECTRON_ENABLE_LOGGING`?
2. Should the `nightmare:` namespace be on the debug calls for Electron?
 > It gets pretty verbose if you turn it on. Better to leave that up to a user, I think.

My thoughts too.  Thought I'd float it just to make sure there wasn't something I missed.

> Iâ€™d say nah to this, too, but I donâ€™t really have any good reasoning or a strong case for it.

The best (and possibly only) reason I'd be in favor of leaving it prefixed with `nightmare:` is to maybe simplify `DEBUG`.  However, with your test to catch deprecation warnings, I'm not sure there's a case to be made.
  This looks great.

This went in a different direction than I had thought, though.  Not sure if this is the best place for this conversation, but here goes: something I had been thinking about was wrapping the Electron instance stdout and possibly stderr up with calls to `debug` (rather than piping them straight through to the parent process stdio).  Then I started thinking about possibly having log levels and _maybe_ introducing something slightly more complex than debug like [winston](https://github.com/winstonjs/winston).  Thoughts?
 > I generally like that idea, but the place for it is probably #421.

Good point, I'll move it there.

> As for this PR, I thought it was valuable to programmatically examine stderr for these warnings so we could explicitly cause tests to fail...

I'm realizing now I might have been unclear.  I completely agree, evaluating stderr output for deprecation is a good idea.  I like having them collected and deduped for the end.  And ...

> Since Electronâ€™s stdio are just streams, thereâ€™s no reason we canâ€™t pipe them to multiple places if we want to. Doing this shouldnâ€™t get in the way of piping to debug or some other logging tool.

... was kind of what I was driving at: we can get both, and it might be worthwhile to do so.  I just blanked on #421.
 Totally fine. :)
  Looks good.  Thanks!
  Judging from your example, it looks like you're queuing the `.goto()` action but not executing it.  What happens if you modify your example to something like:

``` js
var nightmare = Nightmare({});
nightmare.goto('http://website.com')
    .evaluate(function () {
        return document.querySelector('#url').href;
    })
    .then(function (url) {
        return nightmare.goto(url);
    })
    .then(function(){
        //nightmare should be at the url from evaluate
    })
```
  > The progress capability is neat, but it incurs a lot of additional complexity and Iâ€™m not sure how much real value it adds. No existing actions use anything like it.  If we keep it, should be a stream instead of a simple emitter?

I'm mixed on this, but I can think of applications where this might be useful.  For example, a similar concept is used in the [download manager](https://github.com/rosshinkley/nightmare-download-manager) to look at download state out-of-band.

> This implementation differs slightly from the initial proposal in #493â€”it is intended to be backwards-compatible (so it doesnâ€™t break plugins). Iâ€™m not sure if that a virtue or unnecessary, since plugins that can run in the Electron process are pretty new.

My first off-the-cuff idea would be to wrap `.on()` and/or `.emit()` to warn of safety concerns when it is used in plugins (although I can think of situations where one might want to manage events themselves).  What change were you planning to propose that would break plugins?

Also, while I have in interest in how plugins are implemented as I have authored a few, [I don't think I'm the _only_ author](https://github.com/segmentio/nightmare/issues/319#issuecomment-208243666).

> You only get to have one responder for a given name. I think thatâ€™s reasonable (what would you do with more??), but not sure if itâ€™s worth adding some logging or throw errors if respondTo is called with the same name more than once.

I'm struggling to come up with a usecase for more than one responder.  I would think responding to a given event twice would constitute a runtime error.

> Thereâ€™s no way to unregister a responder. Iâ€™m not sure we need it, but maybe?

Maybe.  You could be explicit about unregistering a responder before registering a different responder for the same action, eg if you wanted your plugin implementation of `.type()` to override the default.  (Overrides at present have no consequence, at least in my naive reading.)

More as I let this marinate and as others chime in. :)
 > ... but it does make me wonder if thereâ€™s room for some sort of more abstract create-a-ipc-sub-channel mechanism. That would probably have some utility in the single-electron-process model described in #561. Probably out-of-scope here, though?

I figured the single process model would have to have another identifier in `.call()`/`.respondTo()` (or `.on()`/`.emit()`) for which `BrowserWindow` the action was intended for. That could be pretty readily abstracted away for ease of use.  Am I anywhere close to the same page?

That said, it's probably out of scope, but it does feel like process management/window management is going to depend on this change.  (Or at least borrow from it heavily.)

> I feel like on/emit still have a lot of value for sending events or event-like messages. As far as built-in stuff, I think thatâ€™s just event forwarding from the browser window and logging from the Electron process.

Fair, maybe a warning is too heavy-handed.  I don't necessarily disagree, but it does seem like a raw `.on()`/`.emit()` pair is dangerous enough to warrant... something.  Would this be better served as a (eventual) writeup on how to manage events yourself in nightmare-examples?

> I think I mistyped it on the issue thread, but I was originally thinking of replacing emit/on with call/respondTo instead of having differently-named methods.

Ahhh, okay.  I understand.

> So do you think it should throw an exception? Or maybe just log a warning?

I want to say exception, but I'm not sure I can make a case.  In my read of your implementation, I don't _think_ you can cause execution problems as the results are executed with `.once()`, which makes me think warning.  On the other side,  I think that >1 response is errant behavior, shouldn't happen, and as such should be dealt with as an exception (if nothing else to catch silly stuff during testing, which is what's tipping me - but only just - toward exception).  Is there a valid case where a `.call()` will have more than one response?
 @Mr0grog Good.

I'm considering opening a branch off of master for v3 parts.  Would you be willing to complete this PR and put it against that branch?  Thoughts on doing such a thing?
 > Sure? Whatâ€™s â€œcompletingâ€ meanâ€”just wrapping up the rest of the built-in actions?

Yeah, that's what I had in mind - rounding out the rest of the existing methods with the IPC safety is sufficient for now.  (The beauty of source control: we can always change it later.)

> Generally Iâ€™d flip it around and have master be current development (e.g. v3) and have a v2 branch for any additional 2.x releases.

I've seen this done a _lot_ of different ways, and all seem to be about equally as effective.  I had no _real_ reason beyond releases being cut from the master branch and that PRs are probably going to continue to come to the master branch.  There also seems to be artifacts of a historical precedence from the v2 stuff for Electron being done in a separate branch, but my research there is cursory at best.

I don't have a problem with changing that, even if it adds near-term work for existing PRs/merges.  

> But Â¯_(ãƒ„)_/Â¯ all good either way.

100% with you.  I'm not compelled one way or another.  If you've got a good reason, we can do it how you suggested.  Or not.  You know, whichever. :)
 I _think_ we agreed that since this is non-breaking, this should go into 2.4.x.  To that end, I think it should go into this PR => master.
  This is a problem with Electron: electron/electron#5180

Related: #563, #572, and an attempt at fixing in #576.
 Should be fixed with #588.  Closing.
  > Electron has a potential crasher (on OS X, at least) when the devtools are open:

It's happening on my Debian-based Linux boxes too.  I should also mention #578 - I think it's symptoms of the same problem.

> Theyâ€™re still valid, but no longer a good canary for the crash this PR is mainly about preventing. Should I roll them back?

Uh, I guess so.  Is there a reason to keep the changes?
 The crash test isn't causal, making the argument for leaving it as-is kind of weak.  Plus, the speed benefit is nice.  But not having _any_ way of catching the crash also seems silly.  I wish there were a better way of explicitly causing the crash.

I am still on the fence, but tipped toward inclusion.  This problem seems important enough to merit _reasonably_ quick attention from the folks at Electron, so I imagine it will be addressed fairly quickly.  Thoughts?
 That's good.  Great, even.  Faster tests make for happy tests.

As for stripping out the sender, I'd be pretty okay with that.  I've never found it _particularly_ useful outside of having the `browserWindowOptions` barfed out with every event, and those could be sent in a one-time debug message.  And I'm not sure _that_ is even necessary.
  > run is not documented, itâ€™s not the â€œofficialâ€ API, and nothing internal ever calls it except end.

At the possible expense of being "that guy," `.then()` uses [`.run()` internally too](https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L357).

> I can see a lot of value in simply canonizing a thing lots of people seem to be using.

Adding some historical context:  I believe the PhantomJS implementation [used `.run()` to execute the Nightmare chain](https://github.com/segmentio/nightmare/tree/1.8.2#runcb).  I would hazard a guess that a fair number of things out there were either developed against 1.x or were developed looking at examples from 1.x.

> ...  so I think I lean towards deprecating run.

Making `.run()` a method that wraps an internal `run()` method with some deprecation warnings would be something I could get behind.  Thoughts?
  Closing as this as like @Mr0grog said, that isn't _really_ what Nightmare is intended for.  There may be a future where this is doable, but not for now.  This change affects `.wait()` as well as they share the same template.  Would it be worth adding a `.wait()` test for promises as well?

As for the failing tests, I issued a rebuild and it appears to have succeeded.  I think your PR was after 2.3.2 was released, so the `xvfb` fix _should_ have been included.  Beyond that, I'm not sure why the tests are failing, might be worth another look if it happens again.
 @lzrski Off the cuff, I'd say have the Nightmare process to wait for the promise to be settled, yes.

If it's rejected, I'd think it should handle it like `.evaluate()`: bubble the rejection all the way up.  A failure is a failure.  Thoughts?

As for the fulfillment value, I think it should work like how `.wait(fn)` works - the waited-for value should resolve to `true` to stop waiting.  Fortunately, you've already written the plumbing to do this.  All you _should_ need to do is write the test.
 > I looked at existing test cases for wait and I think we have a problem here. They are not really testing anything. There are no assertions there. 

What would be asserted?  `.wait()` doesn't have a return/resolution value (what would it return?), so there's nothing really check against.  The existing tests verify that wait eventually returns and doesn't except.  In that regard, they're safeguarding from errant behavior.  The tests _are_ missing expected failure tests, though.  I can add that to my todo if you'd like. 

> Further more following test case executed in current master passes immediately instead of timing out:

Hm, this appears to have something to do with `it.only`, and I suspect it's a problem in `mocha-generators`.  On my local instance leaving it with `it`, the 10s `waitTimeout` default is hit.
 `it.only` problem with mocha genators is confirmed.  See vdemedes/mocha-generators/pull/4.
 I'm not against that sort of test.  I was thinking more on the lines of rejection testing, which would also catch the problem you've outlined.  Off-the-cuff, something like:

``` js
if('should error on timeout', function(){
  var nightmare = Nightmare({waitTimeout:500});
  return nightmare.goto(fixture('navigation'))
    .wait(function(){return false;})
    .should.be.rejected;
})
```
 :) I'd say both are reasonable additions.
 Rereading your submission, I spotted something I'm shocked I haven't (and no one else has) spotted.  Having `.wait()` support asynchronous methods _might_ not work as expected.  Consider something like:

``` js
nightmare
  .goto(someUrl)
  .wait(function(){
    return new Promise(function(resolve){
      //what if promise internals take a while to process?
      setTimeout(resolve, 60000);
    });
  });
```

... would not cause a timeout as the current version of Nightmare to timeout as written.  Wouldn't that cause `waitTimeout`/250 (the tick length) iterations of that promise to run instead of timing out after `.waitTimeout` waiting for the promise?  In fact, now `.wait()` won't time out until (`waitTimeout`/250)*execution time + `waitTimeout`.  This is not good.

Some off-the-top-of-my-head solutions:
- Some sort of watcher method that tracks time elapsed instead of tracking it internal to `.wait()`
- Split the templates for `.wait()` and `.evaluate()`, pass the timeout down to `.wait()`, and have the template source send back an error message if the timeout is hit.
- Leave it as-is.  I'm worrying too much.

Thoughts?
 It occurs to me that this problem exists now.  Consider:

``` js
nightmare
  .goto(url)
  .wait(function(){
    while(true){ }
  })
  ...
```

... or any long-running synchronous loop.  Same problem, slightly different cause.

> Splitting the templates doesn't seem compelling. 

I've thought about this a bit more, and realized that pushing the timeout responsibility to the evaluated client script is not a good idea as then the timeout is at the mercy of the client page.  This could lead unintended behavior if the client page clears timeouts.  (I was shooting from the hip.)

> Shouldn't we have a timeout for .evaluate just as well as for .wait?

An evaluation timeout seems like a reasonable addition, so long as the default behavior is the current behavior.

> Just not sure where this logic would fit.

I'll have to think about it, but I _think_ the most logical spot would be actually the `javascript` listener in `runner.js`.  That buys both `.wait()` and `.evaluate()` timeouts.  I'd have to play with the source to determine feasibility, though.

> Couldn't simple setTimeout be used?

Depends on what you mean.  The `.wait(fn)` and I believe `.wait(selector)` methods poll the client page every 250ms to determine if something has changed (eg, something is added, or a DOM element changes color).  I don't think you're proposing simply waiting `waitTimeout` and checking at the end, but if so, that would not be a good idea.

If you are proposing having a `setTimeout` handle the error case where `waitTimeout` has elapsed (and I believe you are, correct me if I'm wrong), that's a good idea.  That may be the best approach, it's then a matter of where to implement it.
 Reimplented and fixed in #819.
  @lzrski I have also been having problems with Nightmare + devtools options spontaneously flaking.  It looks like a segfault internal to Electron, just like #563.  I'll have to carve out some time to see what the details are.
 @Mr0grog Thank you for putting in the legwork.  Hopefully that electron issue will be resolved soon.
 Should be fixed with #588.  Closing.
  @mxmz- Are you still having this issue?
 Hm, that might be related to #602.
 @mxmz- Did you get this resolved?
  Using a room pointed at my fork as an interim solution until Segment can fix separation of internal/external concerns.  Fixes #272.
 @fritx As I understand it, the internal projects at Segment are all kind of lumped together under the `segmentio` account.  To prevent possible security problems, and to avoid [permission issues](https://gitter.zendesk.com/hc/en-us/articles/200178971-You-want-write-access-on-my-private-repos-Are-you-insane-), we'll be using the room for my fork for the time being.  There is work being done at Segment to get the public and private repositories separated.  When that is complete, I'll have the account owner create the gitter room for this repository and transfer the history.  That way we won't lose anything.

Make sense?
  > From this it looks like I can't just return a DOM element from the page context? If that's the case, can you explain to my why? Does it have to do with the magic of distinguishing the script's runtime from that of the page?

`.evaluate()` executes in the page context, and I believe the return value is stripped down to primitives for transport over an inter-process channel.  If you need properties from the element, you'd be better off returning the property or returning a projection.  For example (snipped for brevity):

``` js
    .evaluate(function () {
      var element =  document.getElementById('hplogo');
      return {
        src: element.src,
        height: element.height
      }
    });
```

It really depends on what you're trying to accomplish, though.  Why do you need the DOM element in the calling process?

> What is that weird object with the __jsaction property?

That's a good question.  Judging from the minified JS on google, it looks like it might be a container for attaching custom actions to the image (like a Doodle, for example) directly added to the DOM element.  That's a wild guess, though.

> Somewhat unrelated question; if I don't call process.exit() in the final callback, the script just hangs. Can you explain why?

The `.end()` call is queued but not run.  Try changing:

``` js
.then(function (_height) {
  height = _height

  n.end();
})
```

to:

``` js
.then(function (_height) {
  height = _height

  return n.end();
})
```

... and I think you'll have better luck.  Returning the Nightmare `then`able ensures the chain is executed.  It also might interest you to go read #546's thread on `.end()`.
  Changes the makefile to run tests under an `xfvb` wrapper called `bb-xvfb` under one or more the following conditions:
- `make test` is executed on CircleCI.
- `make test` is executed on a box where `xvfb` is running.
- `make test` is executed in an environment where the `HEADLESS` variable is set and not equal to `1`.

(Disclaimer: my ability with GNU Make is pitiful, any pointers on how to make the Makefile better would be appreciated.)

The wrapper enforces starting `xvfb`, waiting for an X server to be ready, followed by starting `dbus` for IPC messaging, followed by your command.  In the case of `make test`, the unit tests are executed.

The original problem is explained in [Chromium bug 309093](https://bugs.chromium.org/p/chromium/issues/detail?id=309093), and I found that the [Protractor](http://angular.github.io/protractor/#/) project (an Angular test automation suite that uses a Chrome WebDriver to run tests) already had hit this problem.  The scripts used are ~~plagiarised~~ borrowed from [angular/protractor#2419](https://github.com/angular/protractor/issues/2419#issuecomment-156527809).  (Thanks to @tullmann for providing the fix.)

This PR should fix #561.

Thoughts?
 @Mr0grog Ah, that's no problem.  I pulled it in because I was getting frustrated with documentation-only PRs failing in CircleCI.  Irritation-driven acceptance is a thing, right?

Kidding aside, that's not a bad call.  I'll put it on the list. :)
  At first blush, I'd say it looks like the window and/or web contents have been closed or destroyed before the actions were complete.

Could you provide a minimum test case that reproduces this behavior?
 Hm, I'm not getting the same behavior.  Your script seems to work.

I had missed the interrupt key in your original output: did Nightmare hang?  If so, are you running Nightmare headlessly under `xvfb`?
 @silenceisgolden Can you upgrade to 2.3.4 and see if you're still getting this issue?  I wonder if it has to do with #375 or possibly #553.
 @JWMarchant @misbach @Mr0grog for what it's worth, #640 has been released with 2.5.0.
 #640 is merged, #612 is closed, and it seems like @catblade's issue is resolved, so I'm going to go ahead and close this issue.
  Hm, that's one of mine, and I should have added unit tests for it.  I'll add that to my list.

What bothers me about your particular case is the "exited with code null" bit: The only time that happens (at least that I'm aware of) is when a segmentation fault occurs in Electron.  Could you provide a minimum case that reproduces the issue?
 Suspicion confirmed, this is a segfault internal to Electron that appears to happen with the version of Electron Nightmare is currently on.  It does not happen with the current version of `electron-prebuilt` (0.37.5 at the time of this comment).  Curiously, electron/electron#4103 is the closest problem I can find in the repository.  It's not exactly the same thing, but the symptoms are very similar.

At any rate, I'll put together a PR with the requested tests and a version bump.
 @lunow if that's true, it's likely got a different cause.  Could you open a new issue with a minimal reproduction case?
  Closing for age and it looks like the outstanding questions have been answered.  If you are still having problems or have additional questions, feel free to open a new issue.
  I wasn't sure where to put this - a new issue felt the most logical.

Digging into the test failures that happen intermittently, it looks like the behavior that causes the tests to fail also will present in regular applications (albeit seemingly not as often).  Consider the following (extremely contrived) case:

``` js
var Nightmare = require('nightmare');
//create a fake url payload for serial execution
var urls = [];
for (var i = 0; i < 500; i++) {
    urls.push('http://localhost:7600/navigation');
}
//go to each url, and then end
urls.reduce(function(accumulator, url, ix) {
    return accumulator.then(function(results) {
      console.log(ix);
      return (Nightmare())
        .goto(url)
        .end()
        .then(function() {
          console.log('results');
          results.push(ix);
          return results;
        });
    });
  }, Promise.resolve([]))]
  .then(function(results) {
    console.log('done');
    //console.dir(results);
  }).catch(function(){
    console.dir(arguments);
  });          
```

This example creates a _lot_ of instance churn, causing Electron instances to be spun up and killed, much like how the unit test suite works.  After running many times (I've had it happen in as few as 8 and as many as ~450 iterations, seems to be luck of the draw), Nightmare will hang.  In a test context, this will cause Mocha to timeout, which at least partially explains the behavior with the intermittent test failures.

The hang appears to happen when a new `BrowserWindow` instance is created.  Enabling `ELECTRON_ENABLE_LOGGING` and `ELECTRON_ENABLE_STACK_DUMPING` doesn't yield useful information.  Piping Electron output directly to the parent process `std*` buffers also doesn't yield anything terribly interesting.

What I'd like to try next:
1. Try to get `node-inspector` working with Electron.  So far, my attempts to get a debugger attached have been met with limited success.
2. Create `BrowserWindow` churn natively under Electron to see if the behavior can be recreated internally to Electron.
3. If that doesn't hang, I'll take a look at creating browser churn with a simplified node process -> electron process.  That should help narrow things down.
4.  If all else fails, I'll try to make a custom Electron build to try and figure out what's going on.

I'm open to suggestions and ideas on all points.

---

Some other peculiar (possibly unrelated?) things that cropped up as a result:
1. The event forwarding method _always_ throws an error after the `.kill()` call is made because the window is destroyed.  I'll be pulling together a small bugfix for that as time permits.  (I don't think it has any bearing on how the rest of the project behaves, but it certainly can't hurt to fix.)
2. The `close` event case for a clean exit never happens unless `win.close` or `win.destroy` are manually called.  In other words, you'll never see [`electron child process exited with code 0: success!`](https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L70-L76).
 Quick update: I was going through the CircleCI documents to make sure the above wasn't caused by something silly.  Per the [documentation](https://circleci.com/docs/environment/), CircleCI uses `xvfb`, same as the chroot I was using to recreate the issues on.  For grins, I fired up `xfce` on that chroot to run it under a "real" X client, and could not recreate the issue.  It works the same as on my main Ubuntu development box, and it seems to work on pretty much everyone's machine.

To that end, I think this might be `xvfb`-specific.  Anyone else having hanging problems with `xvfb`?
 Now that I know what to look for, if I'm reading this correctly, the Chromium team [has already hit this](https://bugs.chromium.org/p/chromium/issues/detail?id=309093).  It appears to be an issue with forking and a memory allocation deadlock in one of the underlying libraries.

I'm going to take a swing at a workaround.
 Consider the time spent. :)

I've got a fix working locally: I can churn through hundreds of instances and finish without a problem - a huge improvement over the average failure point of a dozen or two.  I also still need to verify CircleCI will use my patch to execute tests.  Once I'm reasonably confident that's working, I'll open a PR for review.

By the by, the fix opens up an avenue of problems having to do with #502.  That's _probably_ a topic best left for that issue or for the eventual PR, and I'll be doing a writeup in one of those spots at some point.

This isn't _necessarily_ a resource problem.  Having more memory or a faster CPU would likely mask the problem, but wouldn't eliminate it entirely.  It has more to do with the underpinnings of `xvfb`, how resources are requested, and how IPC messaging is done internally to `xvfb` and `glib` (at least, that's my tentative understanding).

_(Warning: this thread is about to go offtopic.)_ 

That said, I _completely_ agree with you: spinning up multiple Electron instances gets resource-intensive in a hurry.  I also agree that Nightmare should probably be what amounts to a `BrowserWindow` manager - at least, I think that's the kind of direction you're heading in.  (I also seem to remember you making a similar comment elsewhere, and can't find it offhand now.  It's been something I've wanted to talk to you about since I saw that.)

That approach has a couple of small hurdles:  
- The first `BrowserWindow` Electron opens has a special property where if you close it, the whole process dies.  I don't know if this "master window" property is transferable (nor do I know what it's appropriately called).  The Electron process + first browser window would likely need to be protected until `.end()` is called, so that's easy enough to sidestep.  
- Whatever the approach, I would argue it would need to be compatible with the current test suite.  
- Constructing Nightmare-compatible `BrowserWindow`s would probably need to be broken out into its own class, somewhat similar to how you implemented `FrameManager`, and a similar class in the calling process will probably need to be constructed.  
- I'm betting you had parallel execution in mind as well, which makes the problems in #493 all the worse.

I'd also have a couple of questions:
- Do you think Nightmare should return back Nightmare-side instances of `BrowserWindow` (or `NightmareBrowserWindow`?) to perform tasks?  I'm asking to try to get my head around parallel execution.
- What's an acceptable maximum of `BrowserWindow`s that can be open?  How does that memory footprint differ?

That's all I can think of off the top of my head.  I'm willing to dig into the above and start working through some of the implementation bits as time permits.

Thoughts?
 PS: the comment I couldn't find?  I just found. _Of course_ the second I say I can't find it, I happen to spot it.  It's buried in the [middle of #553](https://github.com/segmentio/nightmare/pull/553#issuecomment-207080667).
 > Iiiinteresting. All :ear::ear::ear:

TL;DR: Make isn't the friendliest thing to Windows.  There's a night sunk into VMs and tinkering that I haven't had time to do yet.

> Oh, totally; didnâ€™t mean to imply it was! Just that our heavy resource use probably exacerbates :grimacing:

It aaaaabsolutely does.  The results I get under chroot on my Chromebook (4gb of ram with a Tegra K1 processor) vs my main development box (16gb/i5) are pretty different. :)

> Interestingly, the default_app installs a handler for the window-all-closed event that shuts down the application!
> Who knew? (Not I.)

Hhhhhuh.  The more you know. :stars: 

I had seen the event before, but I hadn't realized that Electron internally deals with it in that way, and the documentation is ... misleading?  Thanks for the education, and good eye!

> Insofar as the test suite confines itself to public methods/properties on Nightmare and instances (pretty sure it does), I agree.

I think the only time internal methods - and specifically, `evaluate_now` - are used is during the custom action battery.

> Iâ€™m not totally sure we need to make sure things like nightmareInstance.child continues to exist and work the same, though.

Oooh, I'm not sure I agree.  `child` may take on a different meaning (eg, a Nightmare `BrowserWindow` could be attached to an Electron `BrowserWindow`, and I'll get to more on that in a minute).

> However! I think [#493] is largely independent of this one (save that care should be taken not to make it worse).

True.  I have a foul habit of "since we're going to have this down to the studs anyway, why not also do [insert stupidly complex thing]?"  Reorganizing how Nightmare and Electron interact seems like a good time to think about simultaneous calls/multiple runs/handling messaging spaghetti.

> No. I donâ€™t think switching from â€œN electrons, 1 windowâ€ to â€œ1 electron, N windowsâ€ should have any externally visible impact on the API (save for private, non-documented bits). The rule that an instance of Nightmare == a window in Electron, however itâ€™s accomplished, is pretty simple and straightforward. (If Iâ€™m missing what youâ€™re getting at here, let me know.)

Mmmm, don't know that I agree.  The "window manager" would need to expose methods for listing, retrieving, creating, and closing windows.  One of the biggest side perks to doing this is being able to handle pages that open new tabs/windows: when a new window is created from the browser, it could then be created with the Nightmare sugar and registered with the window manager.

I guess my point is that windows are not just created by users, they can also be created by the site, and both cases should probably be handled.

> 10 seems like a maybe reasonable place to start Â¯_(ãƒ„)_/Â¯

Deathly curious what the memory footprint difference is.  I'd like to put together something about that, if nothing else for justifying the change.

> This should probably be a constant/global so itâ€™s easy to adjust in future releases or as the work on this goes on

Strongly agree.

> This should probably be configurable by users at runtime for beefy or light-weight machines (e.g. Nightmare.setPoolSize(1000) if you like to live dangerously)

I _also_ like to live dangerously.

> A fancypants implementation might look at os.totalmem() + os.freemem() + electron.screen and decide for itself, but even then you are likely dealing with some wobbly heuristics.

Not that I'm against a high-fallutin' implementation like this, but I worry that then you're at the whim and mercy of the OS and may introduce cross-platform problems that are hard to debug/track down.  At least for now, I'm in favor of keeping it simple.

> Back in #479 I wrote:
> 
> > For reference, a really simple nightmare session takes 20-30 MB of RAM on my machine, but once a screenshot is taken, that can boost to as high as 360 MB.
> 
> The current screenshot API should be much lighter, but Iâ€™d guesstimate **~50 MB per window** on my machine (13" retina MacBook Pro, 64 bit). That figure will definitely vary across hardware and OS.

(Emphasis mine.)  Per `BrowserWindow` or per Electron instance?
  @djdavidi I'd be open to including a bit about unicode characters.
 @Mr0grog I meant to do that yesterday after 2.3.1 and got sidetracked.  Closing.
  How are you getting these errors?  Are you using custom plugins?

By the time the exception makes it to the `uncaughtException` handler, it's too late.  I don't think you're inside of the Nightmare chain scope anymore, and as such couldn't handle it in such a way to continue execution.
 @yoz electron/electron#4733 was fixed/reclosed in electron/electron#5233, which should be in the release of `electron-prebuilt` Nightmare is on as of 2.3.4.  Can you upgrade and see if this issue still exists?
 Closing due to inactivity.  If this is still an issue, feel free to reopen/open a new issue.
 @GautierT I think this is in reference to rosshinkley/nightmare-download-manager#14, picking up this conversation there.  I suspect you're hitting a device limitation.  Electron is kind of resource-intensive, and even on the best of machines, I suspect that the number of concurrent instances you can run is pretty low.

Judging from your source, it looks like you're using [caolan/async](https://github.com/caolan/async), yes?  Why not use `eachSeries` instead of `each`?  Do your operations need to run in parallel?

If you're looking at trying to throttle to a specified number of instances, would [`async.cargo`](https://github.com/caolan/async#cargo) get you close to what you're after?  An off-the-cuff example:

``` js
var Nightmare = require('nightmare'),
  async = require('async');

var results = [];
var cargo = async.cargo(function(tasks, cb) {
  async.each(tasks, function(url, cb) {
    var nightmare = Nightmare(), result;
    nightmare.goto(url.link)
      .wait('body')
      .title()
      .then(function(title) {
        results.push(title);
        return nightmare.end();
      })
      .then(function() {
        cb();
      })
  }, function(err) {
    cb(err);
  })
}, 3);

cargo.drain = function() {
  console.dir(results);
};

//build a fake cargo load
for (var i = 0; i < 100; i++) {
  cargo.push({
    link: 'http://localhost:7500/' + i
  }, function(err) {
    //done with the specified link
  });
}
```
 @AaronTrazona Are you still having this problem?
  I'd leave it as-is, I like having the history, and this isn't all that noisy.  I don't see a real need for a rebase.  (I also don't _really_ know what would be considered "most correct," but that's the stand I'm taking, at least for now.)

I do have commit rights on github and publish rights on npm.  (Hooray!)  I'll be putting together a milestone + release ... soonish.  At a minimum, I'd like to get this + #553 in.  The underlying Electron PRs (thank you, @Mr0grog) have all been accepted, but I don't think they've all been released (at least at the time of this comment).
 @Mr0grog fair enough.  Can always cut another patch when #553 is done.  Will do as time permits.
  > This is just a work-in-progress at the moment, but filing the PR as there are open questionsâ€¦

I'd like to take a crack at responding considering I +1'd the original issue.  I can't guarantee it'll be _good_ responses; most of this is pondering out loud, coffee in hand.  :)

> For the former, the simplest solution is probably tracking the URL of the failed page and comparing it to the URL of the main frame.

This (at least superficially) seems reasonable, at least until electron/electron#5013 is fixed.

> Need to make sure that works right for redirects, though.

I'd imagine you'd have to look for redirects and set the URL you'd be checking against appropriately.  Child resource redirects should be handled as `did-get-redirect-request` already has `isMainFrame` in the event data.  I don't _think_ you'd end up with a race condition as main frame page loads should not fail _after_ a redirect.  

I have a couple of questions, though.  What if the end user wants to do something custom with redirects - would this effect the ability to handle redirects with a custom action?  Would a (optional) destination assertion or command need to be included?  I'm thinking of cases where you want to explicitly want to check the URL after `.goto()` is executed - you could certainly do it with `.evaluate()`, but it might be nice to include a shorthand.

> A more exacting solution might be to track resource requests on the session object, though doing so requires a bit more rigamarole.

The best thing this would buy you is the filtering mechanism.  However, memory serving, filters aren't terrifically strict.  I don't think you can specify exact URL matches for filters.  Before I take a firm stand on this, though, I think it would be prudent to verify that assertion.  

The bigger problem with using `session.webRequest.onErrorOccurred()` - which admittedly, I'm making the huge assumption that's what you'd use - is I think it gets emitted when there is _any_ problem, not just page load failures.  I'm guessing this is the "rigamarole" you're referring to.  With a cursory look at the documentation, I'm not sure the event data would contain everything you'd need to make the distinction.  It's probably worth carving out time for the experiment, though.  I don't know enough about it to be certain.

> There is also an open question of how this should behave w/r/t error responses (e.g. 404, 500, etc).

I would posit that successfully loaded pages with HTTP error statuses are still successful loads for precisely the reason you cite: it's a legitimate test case.  If you needed to treat non-1xx/2xx/3xx as failures, you could hook into [`did-get-response-details`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-did-get-response-details).  Granted, this doesn't give you the ability to handle those responses directly in the Nightmare chain...

> Maybe thatâ€™s something to wait for as a feature request, though?

... and continuing my line of thought, I'm curious what you would expect usage to look like.  Are you envisioning an optional parameter for `.goto()`?  Something like `.goto(url[, status])`?  Or does this get back to the shorthand I mentioned above with some sort of destination filter/rule?  I don't know this needs to be solved right now, but it might be worth thinking about.

> Also: As you can see in the tests, Iâ€™ve made the assumption here that child frames and sub-resources (images, scripts, stylesheets) failing do not cause goto to fail (i.e. it only fails if the HTML itself fails to load). Iâ€™m pretty sure thatâ€™s the right thing, but happy to take feedback on that.

I'd say this is a valid assumption and agree.  I don't think internal page errors should explicitly cause Nightmare failures.  I would want Nightmare to behave as close to Real Browser&trade; would behave - as fault tolerant as possible, loading and running as much of a page as it can.  You could always add fail-fast behavior yourself, hooking into the failure events and throwing exceptions.

Thoughts?
 @Mr0grog re your previous comment: like I said, my knowledge there was limited.  Thanks for setting me straight.  :)

I _really_ like `.goto()` returning information about the request.  One question about that, and this may be silly: I see in your tests that [valid redirects are okay](https://github.com/segmentio/nightmare/pull/553/files#diff-910eb6f57886ca16c136101fb1699231R233), but it doesn't check the internal information bubbled up from `.goto()`.  Based on the changes you've put in, would that show the 3xx?  At first blush, I don't think it would - wouldn't it show the 2xx (assuming success) for the final destination (after `did-finish-load`)?

To be clear: I'm not sure `.goto()` should track all of the redirect information from a given request, but I do want to clarify what to expect.  Thoughts?

It looks like atom/electron#5029 has been accepted and as such atom/electron#5013 has been fixed.  I don't know what kind of release schedule Electron is on, but they cut releases often enough that I think I'm willing to wait as it reduces the complexity of your solution (seemingly by quite a bit).  What do you think?

Onto the test issues: I can't get the test suite from your fork to run consistently.  The "should fail properly if request handler is present" test fails intermittently.  It looks like once in a while, `did-fail-load` gets emitted after `did-finish-load`.  (That's the difference in debug output anyway.  I'm not clear on the underlying cause yet.)  Coincidentally, that appears to be one of the problems in build 662.  I don't have time to dig into this right this moment, but as time permits today, I'm going to dig into this and the other CircleCI issues.
 > 9cfef7c should mitigate one of the issues I saw repeated on Circle last night: trying to load an unknown protocol seems to hang. It doesnâ€™t do so locally, nor does it if I SSH into the Circle box and manually run the tests from the command line. Not sure whatâ€™s different when Circle does its test run, but Â¯_(ãƒ„)_/Â¯

Hooray for fixing... but [terrified gasp] at Circle internals.  When I'm done spelunking through Electron's guts, I might have a look at `circle.yaml` and related docs to see if it's a setup problem.  My familiarity with CircleCI is _pretty_ pitiful, so it's worth the exercise.

> I noticed that sometimes on Circle, too, but wasnâ€™t able to repro locally and havenâ€™t dug into it yet, so if youâ€™ve got ideas, awesome.

Working on it.  Again, I want to take a look at the CCI docs, make sure it's not something silly.  For the Nightmare side, more on this in a moment, I want to dump out what I've found so far.

> Sigh. Hope this is not whatâ€™s really happening, but that would definitely cause this sort of problem :(

Maybe?  It looks like you were [on to something](https://github.com/electron/electron/issues/5031) with the provisional load failure.  That happens _super_ early in the request cycle,  emitting [`did-fail-load` equally as early](https://github.com/electron/electron/blob/702352804239f58e5abcd0b96dbd748b68ab0278/lib/browser/api/web-contents.js#L150-L156) and omitting that it came from the provisional load.  The handler for the provisional load failure also makes a call to `setImmediate`, which in my understanding (which I will readily admit is probably flawed) could prop up a race condition between `did-fail-load` and the other events.

At any rate, in my sandbox, `did-fail-provisional-load` doesn't get emitted for child parts that fail if I watch it directly. Did you experiment with that event?  If so, why opt against it?

> Oh, thatâ€™s a good question. Iâ€™m pretty sure it would show the 2xx for the final destination...

Curiosity got the best of me, I gave this a scream.  It does.

> ... but havenâ€™t tested that case.

Explicitly tested that case?  No.  Is it worth adding the checks?  Probably.

>  Iâ€™m also not sure Iâ€™ve tested the case of invalid redirects.

[This doesn't cover it?](https://github.com/segmentio/nightmare/pull/553/files#diff-910eb6f57886ca16c136101fb1699231R237)

> I actually hadnâ€™t thought about this case at all! It would be interesting to report on all the redirects involved, but I hadnâ€™t really planned to. So yes, no reason to expect that.

It would be neat and make Nightmare more useful as a testing tool, but I'm okay for the moment putting it down as a future enhancement.  Bigger fish to fry, all that. :)
 > AH! I had seen that earlier, but didnâ€™t remember it when you mentioned the race condition. This could definitely cause it. Hmmmm.

It was a bit of a (pleasant) surprise coming across your name.  I figured you had either forgotten or had a good reason for not pursuing it further.  (Lack of sleep is a legitimate reason.)

> The potential for a race did not occur to me, though. Just hooking did-fail-provisional-load to handleFailure would fix things if the setImmediate call is in fact the real culprit here.

For the sake of completeness, it's probably worth trying, if nothing else than to rule it out.  I'll give it a whirl and report back.

> Side note: I realized while looking at https://circleci.com/gh/Mr0grog/nightmare/13 that I didnâ€™t really do a very good job with the â€œfail if the response dies in flightâ€ test. Going to rewrite it by adding a server endpoint that just kills the socket, which should make the test reliable.

Right on.  Thanks!

> Also, on the onBeforeRequest stuff still being needed for the did-get-response-details eventâ€”Iâ€™m happy letting this PR sit while we wait to see what happens with electron/electron#5074 if you want.

Yeah, let's let it ride for a bit.  The maintainers there are _generally_ pretty quick with responses.
 > > The potential for a race did not occur to me, though. Just hooking did-fail-provisional-load to handleFailure would fix things if the setImmediate call is in fact the real culprit here.
> 
> For the sake of completeness, it's probably worth trying, if nothing else than to rule it out. I'll give it a whirl and report back.

I'm still having failures, but I think it's for an entirely different reason.  I'm not sure if it's a resource issue or what, but somewhere in the neighborhood of 50-60 runs, my sandbox (on my low-powered laptop) will hang when starting an Electron process.  (I feel like there's an open issue for this already - #238, maybe?)

Regardless, that's _way_ better than the ~1 in 5 failure rate I was seeing before, and the symptoms are totally different judging from the debug info.  From that, I think it's increasingly likely this is a race condition, and as such, swapping out for `did-fail-provisional-load` is a decent call.  Thoughts?
 Offtopic, but do you (or anyone else) know why `dom-ready` events are emitted even for provisional load failures?
 Mmmm, I might have jumped the gun in my myopic look at that one test.  Some of the other tests are now failing.  I don't have time right this second to dive into it, but will carve out time tonight.
 > Chromium then loads, as part of the same navigation (so no new request cycle), the error page ...

Ahhh, that makes sense.

> > Some of the other tests are now failing.
> 
> By any chance, is that â€œshould fire an event on page load failure?â€ If so, 52958f2 should fix it.

No, it was one of the `.type()` tests, but that family of tests has been flaky for a _long_ time.  It's spookily similar behavior to this: doesn't fail on decent machines, intermittently fails on modest machines, and seems to almost always fail in CI (at least, the first time).  It's next on my bug hunt docket.

> OH MY GOD THE TESTS PASSED ON CIRCLE

/chuckling
 @Mr0grog Thank you for all of the work you've done for this. :)
 @Mr0grog _Awesome._  I'll put this out as soon as I can carve the time out.
  I'm not clear on what you're asking.  Are you asking if `.evaluate()` could wait on a promise internally?  Or are you asking if Nightmare can somehow pick up document changes via events to make `.wait()` passive?
  I suspect you're having two problems.  One, it looks like your actions are not getting run - `.then()` should be called at the end of your chain.  For example:

``` js
var Nightmare = require('nightmare')
  , nightmare = Nightmare({
    //  show: true
   });

nightmare
.goto('http://host_url/login.aspx')
.screenshot('shot.png')
.end()
.then(function() {
  console.log('done');
});
```

Second, you might be hitting the framebuffer issues first reported in #468 and fixed in #479.  The fix was merged after you asked this question, so it might be worthwhile to upgrade to 2.3.0.
 @khafan246 Are you still having this issue?
 Closing due to lack of activity.  If you're still having this problem, feel free to reopen/open a new issue.
  You might want to consider using [.insert()](https://github.com/segmentio/nightmare#insertselector-text) instead.  That sets the value you send directly.

There's a reason why this doesn't work: `.type()` uses [`webContents.sendInputEvent()`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentssendinputeventevent), which restricts input to [accelerator](https://github.com/electron/electron/blob/master/docs/api/accelerator.md) keys.  I'm almost positive you can send unicode characters with `\u` and `webContents.sendInputEvent()`, but at present, Nightmare doesn't support it.  The string you send is simply split, so sending `\u54C8` would result in typing `\u54C8` instead of `å“ˆ`.

I've considered adding accelerator support, but there are cases where accelerators don't work like you might expect, like [sending `Return` or `Enter`](https://github.com/electron/electron/issues/5005).  Would sending unicode-encoded characters be useful to you?
 @suhaotian Turns out I was wrong.

Sending `\u54c8` _will_ send the correct character.  So either using `.insert()` or `.type()` with unicode encodings should work.
  I'm behind this change.  I can't see any downside to adding blur events to both.

I do have a question, and I realize this is how it currently works - when empty string or a falsey value is passed, the selector's value is set to empty string, but no focus or blur actions are taken.  Won't that cause problems if the intent is to clear the selector and the change event is triggered on blur?  Shouldn't clear events also cause blur?

Re the tests, I kicked off another build, and it passed.  The flaky tests might be a result of event conditions like those found in #553.  I'm attempting to get to the bottom of it.
 @yoz Any updates?

By the by, the tests were fixed with a makefile/shell script stopgap in #565.
 @yoz I understand.  Thanks for putting it together!
  Merging with #203, closing.
  Oh boy, I didn't read carefully either.  I apologize.  Good catch, @kuraga.

> P.S. @rosshinkley , Add queue argument to callbacks, maybe? And why result of nightmare.then(cb) isn't chainable?

It is... insofar as `.then()` returns a native promise, and can chain promise methods off of it (eg, another `.then()`).

> Is it good that TypeError: nightmare.goto(...).wait(...).exists(...).then(...).end is not a function?

Promises don't expose `.end()`, Nightmare does.  Once you call `.then()`, you're not dealing with a Nightmare instance anymore, you're dealing with a native promise.  If you wanted `.then()` to execute (and clear the queue) _before_ calling `.end()`, something like:

``` js
nightmare
  .goto(url)
  .click('some-selector')
  .then(function(){
    //current chain has run
    //do some other logic
    return nightmare.end();
  })
  .then(function(){
    //nightmare is now ended
  })
```

... should work.
 @wyqydsyq I'm considering this issue resolved.  If you have any more questions, feel free to reopen/open a new issue.
  Not sure that it matters, but you might want to also override [the Electron path](https://github.com/segmentio/nightmare#electronpath).  I don't _think_ the paths changed from 0.36.x to 0.37.x, so @Mr0grog's directions should work, but it can't hurt to be sure.  You may also want to run your application with `ELECTRON_ENABLE_LOGGING` in tandem with `DEBUG=nightmare:*,electron:*`.  That might give you a little more information.

What bothers me about the original log text is that the error is a page error from `.onClick()`, so I'm not certain it's because of the screenshot.  If I had to guess, I'd guess that there's a problem in PayPal's client code when you click on `#loadLogin`.  If you run the steps by hand in Chrome with the devtools open, do you get the same error?
 @Mr0grog This is about a thousand miles offtopic, but would it be worth implementing a crash report server internal to Nightmare so the child Electron instance submits crash reports directly to the parent process? 
 > Yeah, that would probably be pretty neat to have.

I'll open up a new issue for that so we don't pollute this thread. :)

Throwing it on the todo pile...
 With #598 being done and the recent changes to the screenshot API, I'm going to close this issue.  Feel free to open a new issue if this is still a problem.  Thanks, @justinmchase.  Merging.
  Hm... that sounds like something strange in the input bindings on the site.  It's almost like the changes to the input aren't being picked up by whatever the site mechanism to issue a search is.

Have you tried using the method in 2.0.2?  Something like...

``` js
nightmare
  .goto('http://example.com')
  .evaluate(function(text){
    var elem = document.querySelector('#serach form.form-inline input');
    elem.focus();
    elem.value = text;
    elem.blur();
  }, 'something')
  .click(button)
  // ... the rest of your script
```

Possibly related to #548?
 @xpiqu With #548 included, can you give this another try?
 Closing due to inactivity.  If this is still a problem, feel free to reopen/open a new issue.
  @sanathko I think so.

A little more research (and some later issues, notably #549 and #559) shows that you could also include a unicode character.  Something like `.type('#demobox', 'typing text line 1\u000d')`.
 @sanathko I'm considering this issue closed.  If you have more problems with this, feel free to reopen/open a new issue.
  The application I've built in electron is based on nightmare to fetch and create content.
I have nightmare on dependecies. When I build the application with electron-builder it does not give me errors.
When I start the packaged electron application the console tells me that "there's no electron-prebuilt node modules"
 Anyone?
Maybe I've explained it badly, are any clarification needed?
 I need nightmare to make the app I'm working on to run, as I've not found a better alternative for electron.
Thanks, I really aprreciate!
 This should be merged with #393, closing.
  I believe this is a duplicate of #224, closing.
  I believe this issue is resolved.  If you have more questions about this topic, feel free to reopen/open a new issue.
 @rmoriz There is _some_ of that in [`nightmare-examples`](https://github.com/rosshinkley/nightmare-examples).  The Nightmare documentation is lean, to be sure, but much of that is intentional.
  It seems like setting a cookie always fails. Below is my config object:

`
{
    show: false,
    images: false,
    waitTimeout: 5000,
    paths: {
        userData: path.join('./appData/userData'),
        temp: path.join('./appData/temp'),
        home: path.join(./appData/home')
    }
}
`

What I have done is: 
start a nightmare instance A to url , login to somewhere, extract all cookies as array, close instance A
then start a another instance B, set cookies to extracted ones from instance A

Problem is B.cookies.set(array) always fails...
`
B.cookies.set(array).then(null, function(err) {
  // err is an empty object...
});
`
One of cookie entry has attribute like:
"domain: something.abc.com","hostOnly":true,"path":"/","secure":false,"httpOnly":true,"session":true,"expirationDate":0
It is the one that fails all the time...
Looks like it is because setting cookie to domain 'something.abc.com' when you are not on that page is causing this problem...
Can anyone help please...
 @rosshinkley, problem is even with .something.abc.com, it does not work. What I wanted to do is as simple as set cookies before I start anything, but still can not find out a way
 @rosshinkley, the procedure is like this, I firstly go to google, then try to set cookies of a session I extracted from something.abc.com so that multiple newly opened instances will have the same session when I change those instances to something.abc.com, but it fails all the time no matter if domain is .something.abc.com or something.abc.com.

I tried it with phantomJS, it works with dot prefixed. Maybe it is the implementation of electron preventing it?

As far as I know, cookies without dot as prefix is usually set through set-cookie header section of a server's response, but most modern browsers consider cookies with or without dot at beginning the same now, so I was expecting electron to act the same...

BTW, using persist:somthing does not work for the website I am working on
 > Could you expand on this? What exactly isn't working?

If I get purpose of persist partition correct, the scenario I am having is like this:
1. start an instance with partition set as 'persist:SAHRED_SESSION'
2. open www.example.com
3. type credentials to login
4. page is redirected to something.example.com and cookies for session is set at this point
5. start another instance with partition set as 'persist:SHARED_SESSION'
6. open something.example.com
I was expecting new instance will stay at something.example.com, but the fact is it gets redirected back to www.example.com because session in first instance is not shared with new instance

> @Velissel I understand you want to preload the cookies before navigation, but I don't think Nightmare allows for adding cookies prior to navigation. I still don't think adding cookies across domains like you're doing is permitted.
> With #425, you could probably extend Electron to add a hook to the 'did-start-loading' event to add cookies prior to the page loading. If it interests you, I could pull together an experimental plugin to prove feasibility.

If persist partition works then there is no issue on this at all. I know setting cross-domain cookie using javascript is definitely not permitted for safety reason, but when it comes to testing, having a way to preload cookie to keep session status is resonable I feel
 > start another instance with partition set as 'persist:SHARED_SESSION'

Ah!  I think I see the issue.  I first hit this problem in trying to address #398, and then again in #532 (specifically, [this comment](https://github.com/segmentio/nightmare/issues/532#issuecomment-198070852)).  If you open an instance, log in, and open a second instance with the same persistence data before closing the first, the session information doesn't appear to be shared (or the data from the first session isn't persisted or shareable yet).  I'm _still_ not sure why this is the case.

> ... but when it comes to testing, having a way to preload cookie to keep session status is resonable I feel

I agree, but from the sound of it, you shouldn't have to preload your session cookie to begin with.  That session should persist.
  > If thatâ€™s cool with you, @rosshinkley. The implications are minor and, I think, an improvement.

ðŸ‘ Absolutely.  Please, go ahead.
  This issue seems to be resolved, closing.  If you are still having this issue, feel free to reopen or open a new issue.
  @antpaw Yeah, there are intermittent failures I haven't gotten to the bottom of.  Have you had any luck?
 @antpaw Have you given this a try with later versions?  I wonder if you're hitting the `Xvfb` hang from #561.
 @antpaw Do you have `DEBUG` output?  What version of Node are you running?
 Can you run it again with `DEBUG=*,-mocha*` under 2.5.0?  Also, what operating system/version are you running?
 I just hit this when working on the Circle tests to include multiple NodeJS versions.  I had a sneaking suspicion you were missing libnotify.  If you're on Ubuntu, installing `libnotify-bin` with `apt-get` _should_ solve it for you.
  Looking at this again, it looks like you can use [`webRequest.onBeforeSendHeaders()`](https://github.com/electron/electron/blob/2cf0843f82af4eae283ad759d806360973bbd869/docs/api/session.md#webrequestonbeforesendheadersfilter-listener) to amend the request headers.  You could pretty readily write a plugin with `.action()` to take care of that for you.

With that, I'm going to consider this issue resolved, seeing as how I think we've covered how to do it with a preload and from within Electron.
  ðŸ‘ thanks!  thanks!
  Closing with the closure of #514.  I like this change.  Marking for inclusion in the next release.
  Merging into #593.
  @kokujin #476 has been merged.  Could you upgrade to 2.3.0?
 Closing due to inactivity.  If you're still having this problem, feel free to reopen/submit a new issue.
  The makefile buys automatic installation of dependencies if the package has been touched since the last make.  With the inclusion of #561, the makefile will also allow headless systems to run the unit test suite (specifically, CircleCI) without internal problems to Electron/Chromium.  Mimicking these two behaviors with simple NPM scripts would be difficult to do in a cross-platform friendly way (although not impossible).

I'm in favor of modifying the build process to make it friendlier, and would like to get some feedback on what we should do.  Off the cuff, I'd suggest something like Gulp, but that may be a bit heavy-handed for what we ultimately want to accomplish.

Has anyone had trouble building this on Windows or any other OS where the makefile won't work?  If so, have you been able to work around it?  What does your make process look like?  Do you have suggestions for build tools?
 > If Nightmare just did all of that on its own before launching Electron, that would not only solve the deadlock for Nightmareâ€™s own tests but also for other tests that leverage Nightmare.

I'm going to purposefully totally ignore the NPM automagic make gives and focus on the framebuffer issues for the moment.  I'm tentative on if we should automagically include the "run with `xvfb-runner`" magic.  My main dev box is running both X and Xvfb - what if I want to see the Electron instance?  What should Electron run under?

Implementing your proposed changes has other setup complications, I'd think: I would want to preemptively check for an available framebuffer, but I don't know off the top of my head how to do that, especially in a cross-platform-friendly way.  I'd love to hear your thoughts on that.  Maybe I'm making it _way_ more complicated than it needs to be.

> Doing so would also simplify the test script to the point where we might not need to worry about adding Gulp or some other solution to get things working on Windows.

Gulp is nice insofar as it skirts cross-platform issues.  The runner task could also be exposed/registered.  Introducing the complexity of managing the framebuffer ourselves is unpleasant at first blush, but does also mean avoiding another (large) dependency, and _possibly_ fixing #224 .  Which devil is worse? :P
 @Mr0grog Yeah, this may be a case of me trying to do an awful lot of work to save someone (me, if I can be totally selfish) ten seconds of setup grief.

As time permits, I'll throw together a proposal on running Xvfb internally to Nightmare.  Sound good?
 I have this (at least partially) working:  instead of spinning up an Electron process directly, if the `NIGHTMARE_USE_XVFB` environment variable is set, Nightmare will spawn `xvfb-run`, `dbus`, and finally Electron, akin to how the Makefile runs the test suite now.

The main problem was that sending `child.kill()` would kill the `xvfb` instance and leave the Electron process intact.  Having an action to make the Electron process exit internally causes the process chain to end.  Unfortunately, this breaks the "should kill Electron" test as the `child.kill()` kills the wrong process.  I'm not exactly sure how to make that a valid test.  I'm certainly open to suggestions.
 @Mr0grog Yes, at least for the moment.  I should probably go ahead and create a PR for it, but I know there are still some problematic tests.  Anyway!

> Maybe start xvfb separately

Well, it is.  Kind of.  Right now, each new Nightmare instance creates an Xvfb instance as well as an Electron instance (so Xvfb, Electron and Nightmare instances area all 1:1:1).  They are created together, and in my opinion, should end together.

> Electron starting/ending/overlapping at different times. Iâ€™m not sure if xvfb-run takes care of all that for you or not.

I don't know that handling a single Xvfb instance is going to work very well, at least not without the single-instance stuff getting done.  I also don't think starting an instance and leaving it running is particularly clean.  I'd prefer Nightmare to clean up after itself when it's finished.

I'm going to lump these together:

> Can you get the PID for Electron somehow? 
> Directly killing Electron is sort of a simple expedient; you could re-write it as an IPC call that asks the Electron process to quit.

Yes - from within Nightmare - but not without a bit of patching to how `.action()` works.  (It doesn't have an ambient reference to `process`.)  With that, you can bubble the Electron PID up to the parent process.  It's ugly.

I don't know you can get the PID from the process tree, either.  Maybe?  I had problems with killing the process tree (that was my first attempt), but this might be worth a second look.

The current incarnation adds another action to have Electron exit internally rather than killing the process from the parent.  This works, but again, breaks the kill test.
 > I donâ€™t know what happens if you try to run two xvfb server instances at once, but was assuming (maybe wrongly) that you couldnâ€™t.

This is ripe for science.  I, too am not certain how `xvfb` (or more to the point, `xvfb-run`) works under the covers when there are multiple instances.  From my very rudimentary testing, it looks like you _can_, but it also looks like Electron (or any process that requests a framebuffer) picks up the first available display instead of the `xvfb` instance it is a child process of.  This can cause problems like the Electron instance being mid-execution when the buffer suddenly quits.  This is where I stopped as I knew that how it worked in my mind was not how it was working in reality, and am going to try to circle back.

> Obviously this whole method requires more bookkeeping: whenever an Electron process ends, youâ€™d have to check and see whether any others are running in order to know whether to stop xvfb.

It's not _just_ `xvfb` but also `dbus` that would need to be tracked.  I also wonder if running them independently but started in series if that's going to have any ill effect?  At any rate, I understand what you're getting at.  It's worth a look.

> ... since xvfb-runâ€™s manpage makes it sound like the exit code is not preserved.

I figured as much.  It's being wrapped twice.  The exit code is an almost guaranteed lie. :P

> If Iâ€™m reading right, think thatâ€™s just because youâ€™re changing the API. Youâ€™d have to update test/files/nightmare-unended.js to pass back the right PID. (nightmare.proc is no longer the Electron process with your changes.)

Yes, and I did that locally, but at that moment, I thought it was not in the same spirit without modifying how Nightmare handles interrupts to call the newly-minted Electron self-desctruction mechanism.  With a little distance, having the Electron PID bubbled up and having the signal handler call `ending`, and then using the `exit` message to catch the `xvfb-run` instance being destroyed might work and still be in the spirit of the original test.

That said, it won't catch the other processes being orphaned (if they even can be), which gets at your point of running them independently.

---

With all of that in mind, I think my next steps are to:
1. experiment with one running instance of `xvfb` and `dbus` managed by the Nightmare constructor.
2. write a test to have two overlapping Nightmare instances where the first ends before the second completes, making sure either shared instances are okay or instances are completely independent
3. re-run original Xvfb-churn test for independently managed processes approach
4. make sure that whatever approach is settled on doesn't break the popular suggestions/fixes in #224 
 Update (aka "So what'd we learn?"):

> experiment with one running instance of xvfb and dbus managed by the Nightmare constructor.

You _can_ run the processes independently, but it would appear that Electron picks whatever display is first available when not running as a child process.  Unfortunately, this leads back to the same locking issue.  I can kill off all of the X servers for a build up front, but that feels incorrect.  Also, once in a while - with X started internally to Nightmare - Electron won't "pick up" the framebuffer.  I need to spend some time to see if it can be remedied with using `xdpyinfo` or something to wait for the display to become available.  So far, using plain ol' dumb `setTimeout`s have not been effective, leading me to believe that approach is probably flawed and I've run aground of a different problem.

Again, I need to spend more time with this - it's possible I'm not using Xvfb properly.  Open to suggestions.

Also worth noting: this necessitated moving the Electron process start to the Nightmare queue instead of doing it directly in the constructor.  The constructor starting Electron has been a long-standing bugbear for me, and I may split that part out into it's own PR.  Thoughts?

> write a test to have two overlapping Nightmare instances where the first ends before the second completes, making sure either shared instances are okay or instances are completely independent

Works great, provided the right X instance is picked up.  The Electron instances share the running X instance just fine.

> re-run original Xvfb-churn test for independently managed processes approach

Also works with the same provisions as above.

> make sure that whatever approach is settled on doesn't break the popular suggestions/fixes in #224

This would not break anything as it requires an environment variable to be set to be used.  Currrently, I have it set up to pick up if Nightmare is running under Circle, but I think I may remove that.  I don't want to add new behavior to existing builds that may already account for Nightmare/Electron's special needs.

---

Another thought crossed my mind as I was playing with moving the Electron start to the Nightmare queue: what about a retry?  In the case of a lock, I believe the `browser-initialize` event does not respond.  What if a timeout was propped up around that (say, 5s?) that if hit, would kill the Electron process and restart it?  I think that would sidestep the issue as the hang only seldom happens (1 in ~300 starts on my box) and (almost) never happens back to back (again, on my box).  This would allow for the `npm test` to use `xvfb-maybe` ([as suggested here](https://github.com/segmentio/nightmare/issues/224#issuecomment-219913947)) to run mocha.

I thought I'd at least float the idea for feedback.
 > Did you try setting the display via app.commandLine.appendSwitch('display', 'displaynum')? 

I (embarrassingly) had forgotten about the Chromium command line switches.  No, I have not, and will carve out some time to give that a whirl.

> Alternatively, do the various XVFB displays show up in electron.screen? 

I wasn't trusting anything to come out of Electron.  I didn't know how reliable the information that fell out would be.  I can give this another peek and report back.

> But if this is all proving too crazy and problematic, than letting it lie and taking the timeout/retry approach might be the right thing to do.

I'll do one more round of experiments to see if I can nudge this into a working state.  The Chromium arguments seem promising, though.  Thanks for that!
  I don't know that having a `.run()` call with an internally defined callback makes sense.  Consider:

``` js
nightmare
  .goto(url)
  .evaluate(someFunction)
  .run();
```

... which doesn't actually _do_ anything with the results of `someFunction`.  The only cases I can maybe see this being useful is with `.screenshot()`, `.pdf()` or `.html()`.  Even at that, it's only the most trivial of cases of each.  Is there a usecase I'm not thinking of?

I would advocate for something closer to how #512 works - validating the input and throwing an exception if it's not acceptable.

Thoughts?
 The (apparently deleted?) #516 dealt with this... sort of.  `.run()` is _really_ intended for internal use and usage isn't directly supported.  Should it be?  I feel like that discussion might be a bit off-topic, but I'd like to hear thoughts from you or anyone else.

Back to something more germane:  

> On the one hand, even the most trivial cases should arguably be accompanied by a callbackâ€”you want to handle, or at least be notified of, failures.

Could not agree more, and I guess I was erring on the side of protecting users from themselves, which now I'm realizing _might_ be overstepping a bit.  Consider:

``` js
nightmare
  .goto(url)
  .screenshot('screenshot.png')
  .end()
  .then();
```

This is legitimate, and could certainly cause a "silent" (if run without `DEBUG`) error.  Also, consider something like:

``` js
nightmare
  .goto(url)
  .wait('body')
  .click('a')
  .end()
  .then();
```

... which is also completely legitimate.  Without context, it doesn't make a whole lot of sense, but now that I think about it, it's possible that you just want to click "OK" on a page in a test suite or something.  There are legitimate use cases, I suppose.

> I like allowing no callback to be passed to runâ€”with one tweak: the default callback should probably console.error() when errors occur.

... I have to begrudgingly agree.  I am not sure I can articulate why I'd prefer input validation over this, but because that's almost precisely how `.then()` behaves, it's kind of hard to argue.

> Bottom-line, either solution would be much better than the current situation.

Yes sir.  Something would be better than nothing.
 > ...the intention is still clear and the behavior still has meaning and value.

Your skilled reasoning has convinced me (twice over, in fact).  Coupled with the fact that `.then()` works that way _anyway_, I feel like my original exception position is pretty indefensible.
 @LinusU Are you referring to `*sync` methods and when they except, maybe?
 An important distinction to make: I was originally advocating for input validation, which is too heavy-handed.  (Meaning, option 4 isn't going to work.)  Throwing on errors when no callback is present _after_ execution is probably worth talking about.
  yah, i'm +1 to that idea. and then have `.insert` just clear things out. 
 @the-t-in-rtf Any progress on the PR suggestion?
 I agree with @yoz.  I think #548 fixes this, and as such, I'm closing this issue.
  @mousemke Are you still having this issue?
 @Mr0grog @pci Of course! High device resolution!  That makes sense.

With that last mystery solved, I'm closing this issue as I think it has been fully resolved.
  @tiangolo I think this would be better served as a plugin for Nightmare.  Thoughts?
 @tiangolo I saw the comment, thanks for the pointer.

I'm not entirely convinced it's not possible to turn this into a plugin.  Unlike, say, popups that make a new `BrowserWindow` which won't have _any_ of the Nightmare sugar baked in, the IFrames you're dealing with should still be in the same context.  I can see with modifying preload this might not be possible.  I'd have to play around with this PR to be sure.

Even if it weren't possible, I would be more inclined to modify the current plugin functionality to allow for functions like this.

Thoughts?
 I finally had some time to circle back to this.  The short version is you _can_ do this with a plugin, but  not without overriding the `evaluate_now` method on the prototype.

The `document` (really, `window.top.document`) variable isn't settable (which is I'm guessing why @tiangolo had trouble with the plugin route).  Because of that, you can't set the `document` variable from within a regular plugin method.  This has the consequence of the only place remaining to alias `document` - at least in the current implementation of Nightmare - is in `evaluate_now`.  You _can_ override the Nightmare prototype's `evaluate_now`, and I've thrown together [a (horrifying) sample](https://github.com/rosshinkley/nightmare-iframe-manager).  (Use at your own peril.)

Patching `evaluate_now` to wrap `document` _technically_ works, but suffers from the same issues that implementing frame support directly suffers from.  Off the top of my head:
- `.scrollTo()` only scrolls the window, not the interior selected frame.  Scrolling interior to an `iframe` would have to be written.
- `.screenshot()` will still take a shot of the bounding rectangle if provided, including the parent frame(s).  Not that this is unexpected, but it may catch new users off guard.
- `.html()` and `.pdf()` will still return output for the entire page rather than the selected child frame.  Again, expected behavior, but not what I'd expect as a new user.

There might be other issues with some of the more advanced functions (authentication, for example), but I haven't had a chance to set up testing yet.
 I should have reread the _entire_ thread before posting: [@Mr0grog covers issues](https://github.com/segmentio/nightmare/pull/496#issuecomment-208445167) more comprehensively than I did.  (Price of being in a hurry, apologies.)  I still think there are almost certainly other corner cases, though.  As time permits, I'll set up some test cases to verify what @Mr0grog outlined.

Setting that aside, it frames need to be a first-order citizen in Nightmare (along with `BrowserWindow`s).  I think this should make it onto the list for vNext.
 @tiangolo I'd suggest opening issues at nightmare-iframe-manager.  (Looking at it offhand, I'd bet there's a problem with the Nightmare version.  I put the plugin together more as a proof of concept than anything.)  Time permitting, I'll see if I can fix the glaring problems.  If you could report the issue(s) you had there, that would help tremendously.
 > Do you want to keep it just as a proof of concept or do you want to keep developing it?

I can keep developing it, but remember: it's going to be _very_ fragile.  Using it is probably not a good idea.

> Are you planning on uploading it later to NPM?

I was/am reluctant to do so because it modifies a core part (virtually _everything_ touches `evaluate_now()`) of how Nightmare works.  I don't know that I can make the disclaimer large enough.  I can publish it to NPM if it solves anything, but keeping it confined to Github keeps it in the realm of "you can, but probably shouldn't."
  With the inclusion of #425, I think it's safe to close this PR in favor of it becoming a plugin if needed.

Closing.
  > I think (1) or some flavor of it is essential. 

I agree. Having instances (whatever the final instance implementation is) be independent _including_ the messaging bus is important.

> Given how often people run into problems with loops and how complex explaining the problem and various solutions is, I think (3) above or a variation on it is also a good idea.

I tentatively agree.  The question that immediately jumps to my mind is handling something like:

``` js
nightmare
  .goto(url)
  .someOtherAction()
  .evenMoreAction()
  .then(function(results){
     return nightmare.goto(anotherUrl)
       .yetAnotherAction()
       // etc
   })
```

I'm guessing you'd expect the first three actions to execute prior to the actions in `.then()`, right?  Are you envisioning `.then()` being an action that acts like Underscore's/Lodash's `.tap()`, or would there be a differentiation between the queue being executed and the queue that is accruing tasks?

This could also lead to unintended consequences with memory for sufficiently large sets, but I'm okay (at least for the moment) with assuming that if you're using Nightmare to do an arbitrarily large number of tasks, you already Know What You're Doing&trade;.

> As much as I like the idea of the power-user capability of being able to do multiple operations at once in the same window, Iâ€™m not sure there are a lot of concrete, real-world use cases for it. 

I would be inclined to support something closer to [async's `.parallel()`](https://github.com/caolan/async#parallel).  Something like:

``` js
nightmare
  .goto(someUrl)
  .parallel([
     nightmare.action().anotherAction(),
     nightmare.action().yetAnotherAction(),
     nightmare.anotherActionStill().somethingElse()
   ])
   .then(function(results){
     //results is an array of results.
     //could also support named hashes.
   });
```

Thoughts?
 ### process/execution safety

I agree with just about everything you said, including that this is a safety problem first and foremost.  There are a few (many?) devils in the details, but I don't think they're worth touching until development is underway.

I _really_ like the idea of progress events, especially for debugging.  Implementing something like that would have made sussing out several bugs much easier.  It also adds a new layer of power for actions/plugins.

I do have a question: how do you propose to have callbacks callable child->parent?  I don't think you can call back like that, at least not without writing something reasonably fancy to manage the events for you.  I feel like this is what you were getting at but never explicitly said it.  I'm _also_ feeling like maybe I've missed something important.

### queues

And this is where the brain-bending _really_ gets into full swing.  It might be useful to explain what I was driving at: `.then()` would be an action, (almost) the same as anything else.  It would let you put in custom code between other actions.  

Skipping ahead a bit, that buys having the whole of the Nightmare API hung off of the `.then()` so you can get to your "magical land of fairies and unicorns".  I'd add puppies and sunshine, but that's my two pence.

There are a couple of things with this approach that bother me.  For one, I _think_ the Nightmare instance doing the queueing would arguably need to be a full-on capital-P Promise implementation (whether that's done explicitly or with inheritiance).  That would let it remain compatible with existing tools like the `vo`/`co`/`mocha-generators` family of libraries.

Second, and maybe more importantly, when does execution start if not with `.then()`?  Is it the last `.then()` on a chain?

Moving on (well, backwards really), and borrowing your example here, and trying to clear up how this works in my brain:

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2();
  });

nightmare
  .action3()
  .then(function then2 (results) {...});
```

The resulting queue would look like:

```
action1
action3
then1
action2
then2
...
```

Which if I'm reading your diagrams properly, should match up with:

```
 â†“    action1
 â†“       â”œâ”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
 â†“    action3                then1
 â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
 â†“    action2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    then2
```

With respect to actions that return actions, I'd think that it _wouldn't_ add an implicit then and instead alter the queue.  Based on my above fun magical land commentary, and again borrowing your example:

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2(); // implicit then caused by return
  })
  .action3()
  .then(function then2 (results) {...});

nightmare
  .action4()
  .then(function then3 () {...});
```

(Aside: you're right, this gets nightmarish [har] in a hurry.)

I would expect this to look like:

```
action1
then1
action4
then3
action2
action3
then2
then3
```

... I think.  I'm getting turned around trying to puzzle through this.  Dearth of coffee.

And ultimately, I'm still head-tilting at arranging Nightmare calls in this way.  It would run deterministically (unlike the wild of now), but I still don't think it would Do What You Mean&trade;.  A naive reading of the above makes it look like you're doing two completely independent chains of actions on a single nightmare instance, and based on what we're describing here, that's just not the case.  (Nor should it be.)

With that said, now I'm starting to question what the ultimate goal is with the changes to queueing.  I would advocate for 1) deterministic results and 2) easily usable/intuitive calls from `.then()`.  Is that fair?

Re parallelism, yeah, that gets into a _bit_ of a different bailiwick, but my two previous rules should still apply.  I can think of ways to accomplish this, but I would like to see the queueing problem solved first.  If I'm thinking about _that_ properly, parallelism might fall very well fall out for cheap.  Like you said, the implementation doesn't need to have it day zero, but I wouldn't want to completely close the door on it.

Oooookay.  I've re-read your comments several times now, and my thinking parts are turning into mush.  I know I've only scratched the surface here.  I'll continue to let this marinate and comment again if I have more thoughts.
  thanks @rosshinkley for the fixes â€“ though i'm a bit surprised about the id change since I tested this two days ago. I wonder if yahoo is doing something weird with rendering.

---

@Mr0grog you mentioned a lot here so let me address a few things:

**1. I apologize about the API change**

I changed my mind about returning a promise, mostly because you can now use Promises natively in latest node, so you don't need to include Bluebird or anything big.

I should have mentioned something, but to be honest I'm not sure it broke anyone's code. Let's be clear, the only API change is: _.then() returns a promise and not a nightmare instance_

The goal of this change was to make it more familiar to newcomers and remove the additional dependency that was confusing in the first place.

**2. I strongly disagree that big contributions aren't welcome**

If you go back in the merged PRs, there are some really big PRs that have been merged. It does take time to go through some of the bigger ones though since a lot of people depend on this library and I have other commitments outside of working on Nightmare.

**3. Direction**

The next two things on my TODO list for nightmare is to get @rosshinkley's #425 merged and create better documentation (a quick how-to video) on how to run Docker on linux.
  With #475 merged, this should be fixed.  Closing.
  thanks @Mr0grog !
  thanks!  This causes the .type() to get cut off. My guess is that the page isn't ready before we try focusing, but it needs more investigation.
 Closing this issue for now as I have not seen this issue in quite a while.  If anyone sees this, I'd be happy to reopen.  Certainly. Here's some results from awhile back. This is from an old email.

---

Phantom has been very slow for us, and so I was experimenting around with using Electron as a web driver in instead. It turns out Electron is quite a bit faster. Here's some of the benchmarks for selecting `document.title`:

Nightmare (via Phantom):

```
Google: 2064ms
Yahoo: 4059ms
CNN: 8658ms
```

Nightmare (via Electron):

```
Google: 866ms
Yahoo: 1862ms
CNN: 2729ms
```
  Closing this issue due to inactivity.  If this is still a problem, feel free to reopen/open a new issue.
  Ahh sorry about this, I forgot that we were installing vo from latest. I went ahead and removed vo altogether from the example. We'll be recommending you use `.then()` from here on out. 
  Upon deeper inspection, injected scripts [do not inject to global scope](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/known-issues/globally-defined-variables.md).  That's why your call to `_.map()` is not working.
  thanks!
  #465 has been merged, closing.
  not right now :-) do you want to speed it up or slow it down?

we have a delay in place as a hack to ensure the characters are entered in the correct order.
  awesome! we'd love to see a patch for a more deterministic result!
 #479 has been merged, closing.
  thanks!
  Merging with #235.  Closing.
  cool i like it :-)

what kind of events are available by making this more generic? I can think of click and dblclick. would this also include mousedown, mousemove, etc?

additionally, maybe we can rename it to `.mouse(selector, event)`?
 def open to this abstraction, would be great to see something like `doubleclick` or similar implemented to make the abstraction worthwhile though. maybe re-open with a PR that adds something like that?  it would be a great help if you can close your own issues once the problem is resolved. this repo has a lot of traffic, so it helps us know what issues need our attention and which are resolved.
  it's here: https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L303-L306

`win.session` is a recent change, right now we're using the old reference (that still works).

I'd be interested to see a PR that supports this or when we land #425, it could be a plugin too :-)
 depends on the use case :-) i'd probably prefer a plugin, but i think there could be an argument for providing a high-level way to intercept requests in nightmare.
 #425 has been merged, and [nightmare-load-filter](https://github.com/rosshinkley/nightmare-load-filter) has been released.  Closing.
  Yes, I love this idea! But I think it should be baked into the code itself instead of in the readme. Basically just: 

``` js
var errors = {
  127: "you may not have electron installed correctly"
}
...
debug(errors[code])
```

mind updating this PR to get this started?
  good catch, thanks! :-)
  not at the moment, but adding adapters would be a cool addition :-)
  thanks @the-t-in-rtf !
  this should be fixed in the new release :-)
  thanks for the note, this should be fixed in 2.1.4 :sparkles:
  thanks!

@MiguelOller can you test this in your environment?
 thanks :-)

i'll fix the classname
  Using, say, `will-navigate` and `did-stop-loading` and taking the time difference between the two might be a better approach barring redirects (or other edge cases I'm sure I'm not thinking of).

I could agree that `_timeoutMs` should be an option you can set, but I'm also not sure I understand the utility of doing so.  Is there a use case beyond measuring page load time?
  @adrianparr Are you still having this issue?
 @adrianparr Ah, okay.  Closing and merging with #224.
  @inversion I'm definitely in favor of the change, but it needs to be updated to be current.  Would you mind updating this?
 Thanks, @inversion!
  looks good, thanks!
  hmm, can you give me an example of when you'd want to throw? these are all asynchronous events, so i don't think throwing would actually work as expected.
  thanks!
  okay great, thanks :-)
  Hmm, I'd probably prefer `dock: false` and `dock: true`. Otherwise it looks good!
 thanks :-)
  awesome, thanks!
  I believe this is related to this: https://github.com/segmentio/nightmare/issues/414
 this should be fixed in 2.1.5 :-)
  looks great. thanks @emars !
  Killer. Great fixes. Thanks!
  awesome, thanks @emars !
  hahaha we'll do our best.
  i'm not really sure. don't have access to an IIS box at this time. does anyone have any ideas?
 @rehael I'd be curious if NTLM causes the [`login` event](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-login) to be fired.  I suspect the answer is no - which would explain why `.authenticate()` doesn't work - but I'd appreciate it if you (or someone else) would double-check.
 Closing due to age and viable workaround.  awesome, thanks!
  has this been a problem for you? or more just for better UX? i'm just a little apprehensive with hiding it right now just because it's nice to know if you accidentally opened up a ton of processes.

definitely want to merge this, but just not sure if it should be now.
 Okay, yah that makes sense. I'll merge this and I'lll add an option to show the icon in the dock for testing purposes.
  @rosshinkley thanks for putting this together! I really have to think about this one a bit. After I get back from holiday vacation, I will take a closer look. My initial thoughts: 

> This amends the instance, not the prototype. I did this largely because Nightmare does not share Electron instances between Nightmare instances. It didn't seem sensible to force the prototype to have Nightmare actions for which there were no Electron actions. This also allows separate instances of Nightmare to use different plugins.

This could be confusing with how `.action` works, but is sort of inline with `.use`. I'm not crazy about having all these sorta different, but obscure ways to extend nightmare. I think it was discussed a bit in https://github.com/segmentio/nightmare/issues/379. 

I'm not sure the best way to fix this atm but I think where we're headed is going to lead to more confusion. It could just be a documentation thing though.

> Adding Nightmare and Electron actions together makes more sense to me than adding Electron actions alone. Thoughts?

Yah, I think you're right, but maybe actions/use could be nightmare-side only and there's an optional electron side.

> I readily acknowledge this sort-of-kind-of steps on .action() (and to a lesser extent, .use()). I considered updating .use() for plugins, but decided not to introduce breaking changes for this proposal. Suggestions for naming conventions or restructuring welcome.

Need to think on this more. But in general, I agree. It needs to be consolidated a bit more.

> Constructed function scoping works a little differently. This is why the constructed function binds to an object that passes in require (it's slightly cleaner than using eval). This allows require calls to be made in the Electron action. I considered stuffing that object with parent, win, etc - this would make the Electron actions look closer to what is in runner.js, but decided to leave them as explicit parameters for the time being. Thoughts?

Explicit params is probably fine if there's not going to need to be any additional params (or different ordering). If not, we should probably just pass a params object in.
 Some general aestetic thoughts: I'm not crazy about passing an object in with `nightmareAction`, `electronAction`. I think two functions would make more sense since folks are used to `.evaluate(browser_fn, server_fn)` but I'd be open to other solutions too :-)

Thanks again for getting this started though. I think this is going to be a great addition.
 aestetically and complexity-wise, I like this **a lot** more :-). can you explain what you see as a pitfall of adding the electron plugin to all instances?
  closing since this is a dup of #224 
  With the release of #425 in 2.3.0, I've gone ahead and released plugins that will take care of downloads:
- [nightmare-download-manager](https://github.com/rosshinkley/nightmare-download-manager)
- [nightmare-inline-download](https://github.com/rosshinkley/nightmare-inline-download)

I'm considering this issue resolved.  If you have further questions or problems, please open a new issue.
  _Bringing this over from #582._

I had been thinking about was wrapping the Electron instance stdout and possibly stderr up with calls to `debug` (rather than piping them straight through to the parent process stdio).  Then I started thinking about possibly having log levels and _maybe_ introducing something slightly more complex than debug like [winston](https://github.com/winstonjs/winston) or [loglevel](https://www.npmjs.com/package/loglevel).  Thoughts?
 > sending Electronâ€™s stdout/stderr to debug channels like electron:log/election:error

Yep.  I'd agree. :)  Frankly, for now, I think we _should_ keep it simple, routing electron's stdout/stderr through DEBUG.

> Iâ€™m somewhat skeptical that a new, heavier logging tool needs to come along for the ride, but can definitely see ways that doing so might be helpful.

I am too, and I apologize if I didn't make that clear.  I wanted to float the idea to see what everyone thought.  I was tinkering with the idea more seriously after you (@Mr0grog) submitted #579: With the progress events, it might be helpful to add logging there, but would make running Nightmare with DEBUG _wildly_ verbose.  There are probably other events - like any of the events that are simply forwarded - that could be dropped to a lower log level.  My main goal was to help manage verbosity, but that may very well be a misguided early optimization.

winston was at the tip of my brain, and I had to go look up loglevel from a previous project to remember that.  I was throwing out possibilities, they certainly aren't the only two solutions out there.  I'm willing to entertain alternatives.
 @Mr0grog Yeah, it's getting a _bit_ into the weeds. :)

> One simpler thing to do might be just having more granular logging channels, e.g. browser events, script execution, runner actions, queueing, process management, etc. One could potentially manage just as well by message type as by severity.

For sure.  It's a little bit more of a hassle to set up DEBUG rules to get exactly what you want, but I'm on board.

To that end... with an eventual PR, would it be helpful to include common(ish) DEBUG setups over at nightmare-examples, especially as the more complicated parts start coming in?
  what does this fix?
 > I think the page handler should handle variable arguments

+1

then i think we're good to go :-)
 thanks!
  @kanethal Do you have `ELECTRON_ENABLE_LOGGING` set?  It might be worth to check your environment variables against [the Electron environment variable flags](https://github.com/electron/electron/blob/master/docs/api/environment-variables.md).
 @kanethal No problem!

As for them being enabled for 2.0.2, I don't think so.  I don't see the same behavior.  I'd be curious if you'd get the same behavior with a different version.  Could you upgrade to 2.3.0 and run it again?
 @kanethal Did you have any luck with an upgrade?
 Closing due to lack of information/age.  If you're still experiencing this problem, feel free to reopen/open a new issue.
  thanks!
  yikes, thanks for the fix!
  `browser-window` needs to be run by the electron process. it seems it's trying to do: `node runner.js`, which won't work.
 @erch Thanks for the response, sounds like it's resolved.  If this crops up again, feel free to reopen/open a new issue.
  yikes, i had a feeling that API is asynchronous. i don't like adding two methods to do nearly the same thing, but we're definitely going to need to solve this. i'll open an issue on electron to see if they have any advice.
 thanks for this PR, i've added an `.insert()` command based on the feedback here.

`.type()` should be more robust now, but i recommend you use `.insert()` if you don't care about the keyboard events.
  Let's track this issue: https://github.com/atom/electron/issues/3930
 Okay this is turning into a pretty tricky issue. According to atom/electron#3930, there's not a good way to track asynchronous events. Right now I'm considering two options but could use some feedback.

1) Send less events. Programmatically set the value, then trigger the last character's events (like you're just finishing typing something)

2) Keep current functionality. I've tested it manually, and I haven't been able to reproduce this issue on smaller bodies of text (yet), so it at least it seems somewhat rare. Add an point in an FAQ on how to either override or add a custom action like populate to nightmare (via `.action()`)

I'm leaning towards 1), but I could use some feedback :-)
 I'll be adding this once there's a version bump in electron: https://github.com/atom/electron/pull/4080

:-)
 hey guys, sorry for the delay on this, i know this is not in a great state right now.

I tested out `sendInput` and it looks like `sendInput` will not work as I was hoping. it will send `input` events, but not `keydown`, `keyup` and `keypress` events. You can read more about it here: https://github.com/atom/electron/issues/3930#issuecomment-172671004

The goal is to make it as much like pressing keys as we can. Unfortunately, there's no way to send keyboard events serially, so I think the approach I will try next is:

**typing "hi":**

```
focus element
keydown event "h"
keypress event "h"
input event "h"
keyup event "h"
delay 30ms
keydown event "i"
keypress event "i"
input event "i"
keyup event "i"
```

the delay will be used to mimic human typing behavior, but more importantly it should ensure that the events are done in order.

Let me know if you have anything thoughts on this otherwise I plan to fix this over the weekend.

/cc @zcbenz in case he has any other ideas :-D
 this is now in 2.1.5 :-)

i've also added an `.insert()` command to handle entering text when you don't need the keyboard events.
  i believe you can pass something like this to the type function:

https://github.com/atom/electron/issues/2269#issuecomment-147362688

I'm not sure what page down is, but it should be in hex.
  incorporated your changes and tests. thanks!
  yep, dup of #224
  wow awesome, thanks!
  haha woah. really surprised that this hasn't come up before. needs more investigation
  awesome, thanks. we still need to cleanup after our emitters better #282, but at least we won't get that annoying warning all the time.
  generators on their own do not do control flow, you have to pair them with libraries like `vo` or `co`, so your example will never actually run the generators.

To use this library without generators though, you can do:

``` js
Nightmare()
    .goto(url)
    .wait(100)
    .screenshot(savePath)
    .end(fn);
```

or `.run(fn)` if you don't want to stop the electron process after running
  @contra can you try again, this time with `DEBUG=nightmare*`? That may help with debugging this issue. May also be a memory leak.
 Unfortunately, creating a new Nightmare instance for every request seems to also have issues. See #561.
 @contra Are you still experiencing this problem?
 Closing for lack of info/age.  If you come across this problem again, feel free to reopen/submit a new issue.
 @contra I haven't been able to reliably reproduce without a networking issue.  I'll see if I can dig out the test script and try it again against the current version.
 @contra To cut out networking issues, I propped up a server locally to issue requests to (responding with plaintext), then issued 100k sequential requests to that service with a single Nightmare instance.  Nightmare did not hang.  I'm thinking about propping up a minimal HTML payload, then adding javascript and/or HTML and running requests against that to see if it's a caching issue or a memory issue or... something.  If you've got ideas, I'd love to hear them.

@LikeJasper I don't think I've ever seen `debug` behave like that... I wonder if it's interpreting a backspace or non-character escape?  If you could put together a minimum case that reproduces that behavior, I'd love to see that too.
 @contra I'm trying to keep the tests local because I _have_ gotten some aberrant behavior with flaky networks.  (The kind of stuff that is bordering on impossible to reproduce without infrastructure that I just haven't had time to play with yet.)  That's why I was tinkering with the idea of making generated payloads that would simulate multiple assets of varying sizes.  I'd also prefer to keep whatever I'm testing against local as then I'm guaranteed to know what assets are being loaded.  Being able to make assertions about what is being loaded will help narrow what's actually wrong.

It may also be worth introducing an artificial networking bottleneck to simulate poor bandwidth.

At any rate, the biggest problem with these sorts of tests is time: it's going to take some tinkering to figure out a semi-reliable crash condition (if there is one).
 @contra I haven't had time to address this as yet, but I'll post here when I build a working test case. :)
  For those that are running into this, the solution is changing `web-preferences` => `webPreferences`.
  thanks @naturalethic !
  awesome, thanks @rosshinkley!
  @rosshinkley I am new to nightmare, could you please explain how to use partition to share session between multiple instance of nightmare?
 @rosshinkley, In my case, persist does not keep session no matter if I start second instance after or before close of first one
  I believe this issue was fixed in #458, so I'm closing it.  If this is still a problem, feel free to reopen/open a new issue.
  thanks! can you provide a usage example for me? also we'll need tests and an update to the readme.
 closing since #410 landed, thanks guys!
  weirddd. can you give me the code snippet you're using?
 @dingziran Oh, I think it might be electron renaming it's options, try `webPreferences`.
  ahh shoot, hadn't considered that. definitely a bug, if the value is falsey it should probably clear it out.
  interesting, can you explain to me a little more about what the advantage would be? it seems like the module you linked is also a node process that manages electron processes, it can just manage more than one. 

i guess what i'm trying to understand is what the advantage of this approach is over throwing nightmare behind a node cluster (https://nodejs.org/api/cluster.html)
 yah okay thanks, I understand what you mean. I guess the two issues in my mind that i see are:
1. major refactor of the existing codebase (not a huge deal)
2. more importantly, anytime you want to use nightmare, you'd need to run it using the electron executable. this is fine if you're running it standalone, but if you need to integrate it with a node server or something, you're basically rewriting the existing node layer yourself.

i'd be interested in figuring out the proper separation for the electron process to run and be useful standalone if you want to run it on it's own, but for the sake of ease of use, I don't see the node layer going away.
 okay sweet :+1: 
  initial thoughts:
- support adding requires that pass in the window

``` js
electron.plugins.forEach(function (plugin) {
  require(plugin)(win)
})
```

This would happen after the browser window has been initialized
 @rosshinkley i don't see a way you'd be able to pass `parent`, it's transferring over IPC and parent isn't serializable. 

The reason for doing the require is that we could basically tell the electron process to require a file on it's own. I don't like the solution all that much, but I haven't come up with a better one.
 >  I thought the intent was passing paths to require over IPC (or possibly, as command-line arguments akin to paths) and requiring them in the electron process, not vice-versa. No IPC serialization required. Parent should then be passable.

Ahh, sorry I thought you meant `parent` as in the parent process instance. Yep the original intent is passing paths to files and requiring them in the electron process, though I don't necessarily like this approach, so if you think of something better, I'm all ears. Can you clarify what you mean by `parent` because I'm still not fully sure?

> I'll need to take another pass at this when I'm fresh and have coffee. I'll try to carve out some time.

Haha yah me too, answering issues at this hour is ill-advised :-P
 @rosshinkley yah, terrible names haha, should probably change them to `node_process`, `electron_process`, and ... `render_process` (?). yah, I'd like to see what you have in mind. PR or commenting in this issue seem reasonable. Would be nice to see some example code, like how a dev would extend it.
 Implemented in #425, merged in 2.3.0.  Closing.
  yah, i agree that it should wait

is that leading to another page? it should wait for the click to happen if there's a page transition: https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L251-L254 before continuing.

unfortunately, i'm not exactly sure how we'd pull this off if it's just waiting for a click somewhere on the page. we could listen for clicks on the top of the window, but if there's a stopPropagation, somewhere, we won't catch it and we'll wait forever. 

open to ideas.
  awesome, thanks!
  I believe before 2.1.5, the keydown/keypress/keyup events were not getting sent through Nightmare, and I wonder if that's causing you problems.  Could you upgrade and try again?
 Due to lack of attention and issue age, I'm going to close this issue.  If you're still having this problem, feel free to reopen/open a new issue.
  thanks! will change that comment on my end :-)
  thanks!
  thanks!
  thanks for putting this together and i appreciate all the work that was put into this. currently this approach adds too much complexity to the API for solving this issue. 

i've thought about this a little bit and i think a better approach might be:
1. By default ignore all downloads
2. If someone wants to download something, provide `nightmare.download(selector|url)` which returns a buffer. if a buffer is not possible, support `path` in the signature to write to a file.
3. When we are downloading something, wait until that download is complete in order to resume.
4. Potentially support progress events via `nightmare.on('progress', fn)` if that's supported

This reduces the API to just:

``` js
yield nightmare
  .on('progress', fn)
  .download('a[href="/segmentio/nightmare/archive/master.zip"]')
```

One thing we should also consider is... does nightmare even need to support downloads? Or can we get away with:

``` js
var request = require('request')
var fs = require('fs')

var url = yield nightmare
  .evaluate(function() {
    return document.querySelector('a[href="/segmentio/nightmare/archive/master.zip"]').getAttribute('href')
  })

request.get(url).pipe(fs.createWriteStream(__dirname + 'somepath.txt'))
```

Are there any advantages to having this in core?
 @subcontact hmmm.. that's a tough one, have you tried getting it to work with the current PR?
 @rosshinkley thanks for the detailed response!

> I don't understand what you're asking, what should the selector provided do? Click? As for providing a URL, would that be a simple get? And with the buffer, no, I don't think that is possible. Electron supplies the filepath and a method to override the filepath.

Yah, you're right, when I proposed that I was thinking about it in terms of what the click/mouseover/etc methods do, but that's not the same as download. 

> Blocking on each download isn't how browsers work. From a test automation standpoint, I can certainly understand the need, but from a purely automation standpoint, I'm not sure I agree.

I was proposing this to handle `wait('downloads-complete')` piece that you added in this PR. Haven't investigated how that would work internally though.

> Re: getting away with a simple request: no, I don't think you want to do that. If you're making an authenticated request for a resource (thinking of something like a request to a private link in say, Dropbox), you want to do that from within the context of Electron. Copying the resource URI and issuing a plain GET will almost certainly result in failure. This (I think, and I'm sorry if I'm misreading here) gets to what @subcontact's problem - authenticated downloads won't work with simple requests.

From my understanding, a POST request triggers the download, so whether this is a plugin or not, we'd need to at least know how to do that with core.

> Re: keeping at least some form of downloads in core, that's a great question. My answer to that would be a qualified no. How downloads are handled is probably going to be dependent on use case. To that end, I think the blocking .download() and the non-blocking methods in this PR should be broken out into at least one (probably two?) plugins.

Yah, I agree.

> The problem with that is binding to will-download. A new method to hook into will-download with a custom handler could be exposed, or (with modification to pass a child handler) the custom event bindings in #367 could be used. Thoughts?

Yah, I think we should add this regardless, we're already hooking into the other events. Seems like it would be as simple as:

`win.webContents.session.on('will-download', forward('will-download'))`

Then you can hook into it with an action:

``` js
Nightmare.action('download', function () {
  this.child.on('will-download', handler)
})
```

Haven't thought through exactly how this would work, but that would be the approach I would investigate.
  okay this should be fixed now in `2.1.0`, let me know if it's still broken!
  woops, thanks!
  hm, did you try:

``` js
Nightmare.action('evaluValue', function*(value, cb, done) {
  var test = yield this.evaluate(cb);
  assert.strictEqual(test, value, 'evaluValue() ' + errorMessageHelper(value, cb));
  done();
});

yield Nightmare().evaluValue('some value', function cb() { ... } ) 
```

?
 hmm, that looks okay to me. that's just not working at all? 
 yah, i agree with @rosshinkley. `use` let you bundle a set of actions together, while `action` defines a new method. let me know if this is unclear and maybe i can clear it up in the docs
  May add support for this, but it's really easy to support with `.evaluate`:

``` js
yield Nightmare()
  .goto('http://google.com')
  .evaluate(function (selector) {
    return document.querySelector(selector).textContent;
  }, '.selector')
```
  Yah it should probably be hidden by default, right now I just want Nightmare to be more stable before hiding it, because if there's errors you can end up with a ton of open electron processes. There's logic in the code right now to hide it, but it's commented out: https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L34-L38
 The default is now to hide it. This issue will serve as a reminder to add an option to show it.
  can you try again? i just released a new version
 @contra ahh, are you seeing it hang forever if the initial page load fails? right now it's only initialized when you call `.wait()` before a click or something. that should be fixed.
 @contra Depending on the kind of page load failure, #553 _might_ address your issue.

@joychester I wrote two quick test cases:

**nonexistent element**

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();

  nightmare.goto('http://www.example.com')
    .wait('does-not-exist')
    .end()
    .then(function(){
      console.log('done');
    })
    .catch(function(err){
      console.dir(err);
    });
```

**function that never returns true**

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();

  nightmare.goto('http://www.example.com')
    .wait(function(){return false;})
    .end()
    .then(function(){
      console.log('done');
    })
    .catch(function(err){
      console.dir(err);
    });
```

Both error out with the appropriate error message after 30s.  Can you provide a minimal example that causes nightmare to hang?
 @joychester Ah!  Thank you for providing an example.  I can reproduce the behavior you're seeing.  I'll dig into it and see what is going on.
 @joychester A quick look yields that `webBrowser.evaluateJavaScript` is hanging once in a while and not calling back.  Electron doesn't have any errors when it happens.  This problem is not unique to StubHub - it happens with Yahoo and Youtube as well.  I'm not 100% sold that waiting for an element created after DOM content loaded is the cause, or that the site is an SPA.  

(As an aside, I can hack around it by forcing the `javascript` handler to poll if the callback has been called, but that is terrifyingly hacky.) 

Some tinkering shows me that it's not necessarily iframes, slow loads, load failures, or particularly large assets (or any combination).  I'm still hunting for a root cause/minimum reproduction case.
 @Mr0grog set me straight: it does have to do with iframes and timing.  Quote:

> If you call WebContentsâ€™s executeJavaScript() method after the main frame finishes loading, but while a subframe is loading, the JS will never get executed and the call will never complete (unless you navigate the main frame to some new page).

See electron/electron#5183 for details.
 Should be fixed with #588.  Closing.
  Hey thanks for the PR! I think we should actually group these events: https://github.com/segmentio/nightmare/pull/337

I should have considered this before accepting the alert one, but I'm thinking something along the times of: 

`nightmare.on('page', function (type, message[, response])`

---

As far as the preloading stuff, I don't think it's a great idea to completely allow you to overwrite it because as we make changes to the API, those people that overwrite it will be completely out of sync. Are there specific use-cases that we should allow custom hooks into the preload script?
 Beautiful. I like this a lot. I like how you were able to consolidate all these into `page`. I think what you did with the custom preload script is good too. Two things I'd like to explore:
1. Is it possible to maintain the syntax highlighting on the preload script? I've noticed it's pretty error-prone working with functions as strings. Not a huge deal though since we're doing it in other places.
2. Is it possible to have the custom preload script to be a function that passes in the IPC

``` js
function (ipc) {
  window.confirm = function(message) {
      var response = false;
      if(message == 'foo'){
          response = true;
      }
      ipc.send('page', 'confirm', message, response);
      return response;
  };
}
```

That might look be a little nicer way to extend the preload script and also authors don't need to know anything about the internal __nightmare.ipc
 Thanks for this PR! I've incorporated these changes into master!
 One thing I left out was the preload templating stuff (probably due to my suggestion :-/), but I think it's less complicated to just include a path to your own script.
 yah me too :/, but the added complexity wasn't worth it imo
  if you're not able to catch the event as the window via inject, it  can be fixed with a custom preload script outlined here: https://github.com/segmentio/nightmare#custom-preload-script
 let's see if more people need this. there's a million things nightmare _could_ do, it's up to us to make sure the API remains simple, while not being limiting.
 @nquoctuan I'm _almost_ positive that the path for `preload` has to be fully qualified.  What happens if you change that to `preload: require('path').resolve('alertMessage.js')`?  There's some info in this PR: https://github.com/segmentio/nightmare/pull/241/files. Unfornately, it's really out of date at this point. Would love for you to open up a new PR :-)
  With the release of #425 in 2.3.0, I've gone ahead and released plugins that will take care of downloads:
- [nightmare-download-manager](https://github.com/rosshinkley/nightmare-download-manager)
- [nightmare-inline-download](https://github.com/rosshinkley/nightmare-inline-download)

I'm considering this issue resolved.  If you have further questions or problems, please open a new issue.
  thanks!
  thanks!
  thanks @danielstjules! i think the API should be `nightmare.header()` and then support the following:

`header(header, value)`
`header(obj)`

what do you think?

the rest looks good!
 > And any reason for preferring a singular nightmare.header as opposed to the original nightmare.headers

yep and most the APIs that I've seen that have this kind of signature are singular. ex. http://api.jquery.com/attr/
 thanks @danielstjules !
  Sweet! I think the API should be `.bind(...)` though. It's more familiar to folks: 
- http://api.jquery.com/bind/
- https://github.com/component/event
 glad you asked, yep i don't care about the data attribute at all. hmm, what about keeping these separate from `nightmare.on(...)`, where it's like:

``` js
nightmare.bind('some-custom-event', function () {
  // custom event triggered
})
```

that would make unbind more clear-cut:

``` js
nightmare.unbind('some-custom-event', fn) // remove that function
nightmare.unbind('some-custom-event')     // remove all functions
```

what do you think?

---

Otherwise `nightmare.bind('some-custom-event')` could work too, just not sure how to deal with the unbind case.
  sweet! looks great :-D
  Thanks for the PR! Mentioned this in another PR, but I think the API should be:

`nightmare.scrollTo(top, left)`
`nightmare.scrollTo(selector)`

Where scrollTo supports both. What do you think?
 @Kreozot haha, yah i was thinking about that... not sure how it'd look unless we break the API. I guess we could maybe do:

```
.screenshot(path, [selector], [, clip])
```

Almost wondering if it just makes more sense to just use an object, which wouldn't break the API:

``` js
.screenshot({
  path: ...,
  selector: ...,
  x: ...,
  y: ...,
  width: ...,
  height: ...
})
```

---

Also, how does this handle multiple elements on different parts of the page by the way?
 @highvoltag3  I'm still open to this PR, but the source is well out of date and would need to be updated.  Additionally, I don't think @matthewmueller's comments were ever addressed.
  It'd be nice to overload the `.scrollTo` method to support `.scrollTo(selector)`, rather than implement a new method.
  Awesome! So we're planning on making this a little more high-level, so `.click(...)`, `.rightclick(...)`, etc. will use this function internally to execute their events.

Let me know if you want to hack on this, otherwise I'm planning on working on it sometime this week or the next.

Going to close this one, but it's super helpful as a reference. Thanks!
 Wow that's really cool. I'm wondering if that would make more sense as a plugin once we land actions/use.  What do you think?

Thanks for the heads up on the electron warnings!
  the more i think about this, the more i think this makes sense as a plugin. i'll be adding plugin support via `.use(...)` today
 Okay, I've added `Nightmare.action` to support this PR. Here's how you'd do it:

``` js
Nightmare.action('screenshotSelector', function (path, selector, done) {
  debug('.screenshotSelector()');
  if (typeof selector === 'function') {
    done = selector;
    selector = path;
    path = undefined;
  };
  var self = this;

  this.evaluate_now(function (selector) {
    var element = document.querySelector(selector);
    if (element) {
      var rect = element.getBoundingClientRect();
      return {
        x: Math.round(rect.left),
        y: Math.round(rect.top),
        width: Math.round(rect.width),
        height: Math.round(rect.height)
      };
    }
  }, function (a, clip) {
    if (!clip) {
      throw new Error('invalid selector "' + selector + '"');
    }
    self.child.once('screenshot', function (img) {
      var buf = new Buffer(img.data);
      debug('.screenshotSelector() captured with length %s', buf.length);
      path ? fs.writeFile(path, buf, done) : done(null, buf);
    });
    self.child.emit('screenshot', path, clip);
  }, selector);
})

// run
yield Nightmare()
  .goto('http://google.com')
  .screenshotSelector('google.png', 'title')
```

Looking at this closer, you could probably simplify and use `nightmare.screenshot()`, once you have the clipping coords

Does this work for you?
 @felixcrive, sorry i'm not sure what you mean, do you mind showing me what you mean?
 best supported as a plugin  looks good! just a minor documentation tweak and we should be good to go!
 ah thanks good catch!
  thanks! this has been added via `nightmare.cookies.get(name)` in #360 
  I think the way to this would be to use the `ipc.send('customevent', args)` functionality to send your events, which is in scope: https://github.com/segmentio/nightmare/blob/master/lib/javascript.js#L21-L24

There would need to be some addition logic on nightmare to set up the event forwarding in the electron process. Something like: `nightmare.bind('customevent', fn)` in: https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L225-L228

Which would tell the child (runner.js) to listen for that custom event and forward onto the node process (nightmare.js): https://github.com/segmentio/nightmare/blob/master/lib/runner.js

Probably won't get around to implementing this myself, but I'd accept a PR that implements this :-)
 @fentas Custom eventing is now a plugin: [nightmare-custom-event](https://github.com/rosshinkley/nightmare-custom-event).  I'm going to go ahead and close this item.  If you have any more questions, feel free to reopen/open another issue.
  Awesome! Just want to figure out how we should document this change.
 sorry for the late response on this, looks good. just need to fix up the typo and we're good to go
 thanks @atonparker !
  It may be worth looking at [this comment](https://github.com/segmentio/nightmare/issues/510#issuecomment-189782115).  I wrote a plugin to at least partially handle this case.

Merging this into #593.
  awesome, thanks!
  @yonatanmn Everything passed from Nightmare to Electron is serialized, and functions do not serialize nicely.  If you find that you need methods in `.evaluate()` commonly, you may want to look into defining a custom preload.
  Closed with `sendInputEvent` and `.action()` being exposed.
  #345 has been fixed, and this issue has not had activity in quite a while, so I'm going to close it.  If you have any more questions, feel free to reopen or file a new issue.
  nothing planned, but we'd like to support proxies at some point, here's a good place to start #241. We'd gladly accept a PR :-) 

Closing since this is a dup of #372 
  @ilabvb did you get this resolved?
 Closing for lack of activity.  If this is still a problem, feel free to reopen or file a new issue.
  @nathan-martinez Are you still experiencing this problem?

If so, you might want to take a look at [`.header()`](https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L195-L200).  That allows you to set headers directly.  (There isn't documentation for it, I opened #551 for that.)
 Closing for inactivity.  If this is still a problem feel free to reopen/open a new issue.
  may i ask what the usecase is here? the window should be hidden in nightmare, so i'm not sure why you'd want to move it.
 ahh i see. this definitely seems like something that should be a plugin. let me think about how we can expose this type of functionality

we'll basically need to be able to add functionality to the electron process.
 @lexifdev With the additions to `.action()` with #425, this could be implemented as a plugin.  Feel free to open up an issue or join the gitter room if you have questions.

Closing.
  please fix up the spacing and this should be good to go!
 @inversion yep, good call. planning on adding standard.
 now on master, thanks @inversion !
  Hm, can you explain the use case a little better? I was sort of thinking about it in terms of stdout and stderr. I believe console.warn goes to stdout. 

The downside I can see with this is that you might end up missing events if you don't hook into all the correct events. Also what about for events coming from `console.info` and `console.debug`?
 got it. yep I love it: `nightmare.on('console', function (level, msg, ...) { ... })`

or `page-console` whatever you think makes more sense.
  Haha when I opened that issue, I forgot about `.use(...)`. What do you guys like better `Nightmare.action(action, fn)` or `Nightmare.use(fn)`? Maybe there's a reason to have both, but I can't really think of anything off the top of my head.

Going to rope in the .use people too.
 Just added both `use` and `action`. Here's some more information: #376 
 Thanks for the PR @inversion ! I incorporated these changes in #376 
  you can use `1.x` but otherwise i don't believe so
  With the release of #425 in 2.3.0, I've gone ahead and released plugins that will take care of downloads:
- [nightmare-download-manager](https://github.com/rosshinkley/nightmare-download-manager)
- [nightmare-inline-download](https://github.com/rosshinkley/nightmare-inline-download)

I'm considering this issue resolved.  If you have further questions or problems, please open a new issue.
  yah, i think you'd want to do this outside of nightmare, unless electron provides support for it as an option, i don't think we'll support this in core.
  thanks @rosshinkley for the example :-)
  yep, that's what we're using internally to communicate. do you mind explaining your use case a little better?
 Closing for lack of activity.  If this is still an issue, please feel free to reopen or file a new issue.
  i think this might be an underlying electron issue?
 yah, you should open this up with electron
  definitely interested... language settings and basic auth could maybe be supported now too?
 seems like allowing a sticky `.header()` and then the additional parameter for loading a single url?
  thanks @Zn4rK, that's 100% correct!
  can you narrow down where the error might be occurring?
 @chentsulin @TonyWang031 Depending on the version of jQuery being injected, they could end with sourcemap comments, which would cause the end of the calling function that encapsulates the injected script to be commented out, causing a runtime error.  I would be willing to bet this is what you were hitting, given the unminified version worked but the minified version wouldn't.

The template was fixed in #524, so I am going to go ahead and close this issue.  If you still have problems, feel free to reopen/submit a new one.
  could this be related to #320?
 Upon further investigation, I can't recreate this behavior.  Doing something like:

``` js
var nightmare = require('nightmare')(),
  vo = require('vo');

var run = function * () {
  return yield nightmare.goto('http://example.com')
    .evaluate(() => document.title)
};

vo(run)(function(err, val) {
  console.dir(val);
});
```

@edasque @smallcar88 @davis Are you still experiencing problems with `.evaluate()` and fat-arrow functions?
 @davis Hm, I'd be curious what transpiler you were using - it _should_ have worked.  At any rate, the ES6 features you needed are now supported out of the box with Node 4+, so I'm going to consider this issue closed.  If you continue to have this problem, feel free to reopen/open a new issue.
  Wow. This would explain a lot of the inconsistencies.

I _think_ we should be good on the onload stuff since we're injecting JS at the bottom of the page, but can you think of any case where not waiting for the `onload` event could break things?

/cc @reinpk 
 i'm good with this!
 yeah sorry haven't had time to read over the code yet, soon sorry!
 Okay going to merge this as it seems like it's helping out a lot of folks. Haven't dug into the internals yet, but I'm sure we can make changes if issues crop up.

Great work @fr- !
  hm, i thought we already did this:
- https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L210-L215
- https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L333-L347

basically after every action we check to see if the page is navigating, then wait until it stops loading.
 @Zn4rK #425 is in as of 2.3.0.  Are you planning on publishing a `.waitForUrl()` plugin?
 @Zn4rK Awesome!! Thanks!
  good catch!
  sorry i'm not sure, been a long time since i had a pc around :/ stackoverflow is the better source for these path questions!
  the question doesn't make much sense for a web-driver automation library :) closing
  the question doesn't make much sense for a web-driver automation library
  @emgould Everything there looks fine to me.  Are you still having this problem with later versions of Nightmare?
 Due to lack of attention and issue age, I'm going to close this issue.  If you're still having this problem, feel free to reopen/ file a new issue.
  @juliangruber nice!
  check out `did-get-response-details`:
https://github.com/segmentio/nightmare#onevent-callback
 @scarletsky as far as i know you'd need to filter for the resource you are looking for yourself
  not sure tbh, that would depend on the underlying electron implementation, which nightmare just passes through to:
- https://github.com/segmentio/nightmare#pdfpath-options
- http://electron.atom.io/docs/v0.30.0/api/browser-window/#webcontents-printtopdf-options-callback
  nightmare is specifically designed to be used with generators in es6+, so i think that'd kinda defeat the purpose. you can use nightmare `1.x` if you want to avoid generators/es6 though
  @kevinprotoss @fr- Could you use `.header()` to accomplish this?
 Closing as I think this is solvable with the existing implementation.  If this is still an issue, feel free to reopen or open a new issue.
  sorry for the late response. this is on master now. thanks!
  errors bubble up from `.evaluate()` in my testing... try running this modified example from the top of the readme:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function* () {
  var nightmare = Nightmare({ show: true });
  var link = yield nightmare
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit')
    .wait(200)
    .evaluate(function () {
      return document.getElementsByClassName('GARBAGE-CLASS')[0].href;
    });
  yield nightmare.end();
  return link;
})(function (err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```

The output I get is `Cannot read property 'href' of undefined`.
  ah sorry, I just saw this one. the other one has been merged. this looks good too. thanks!

mind resolving the conflicts? then i'll merge this one
 thanks @antpaw !
  @nicolekanderson Did you get this sorted out?  If not, have a look at [Nightmare's test suite](https://github.com/segmentio/nightmare/blob/master/test/index.js).

@miaomi Hm, the errors look like `electron-prebuilt` is either not installed or didn't install properly.  Try wiping `node_modules` and running `npm install` again.

@WMeldon It's best practice to end the Nightmare instance when you're done.  Otherwise, the child process will remain running forever and you will (rightfully) get Mocha timeouts.
 I'm going to go ahead and close this issue due to age, lack of activity, and that I _think_ it's resolved.  If this is still an issue, feel free to reopen/open a new issue.
  leaning -1 on this change, though fairly indifferent. the reason for this is because it's added syntax and i think most people in the node community (also webpack and browserify world) understand commonjs at this point. 

i do agree that `exports` shouldn't have made it into the spec though.
 closing this. i think we're going to stick with `exports` for the time being. thanks!
  whenever i see this change, i always wonder about the benchmarks, since we're wrapping every function in another function, as opposed to just pointing to `this` ref. do you have any benchmarks of this being a negligible perf change? doesn't have to be nightmare specific but just in general?
 @rosshinkley yep this is exactly what i was looking for:

![img](https://cldup.com/LwkeRajv9Q.png)

even though it's a micro optimization, i don't think using `self` is much worse syntactically. 

closing for now, thanks guys!
  Sweet! So I thought about this a bit more. One issue I have with the event name:

1) it's inconsistent with the existing event names: https://github.com/atom/electron/blob/master/docs/api/browser-window.md#events

I think for this reason, it should be something like: `page-error` and `page-log`.

The only other thing that would be good is squashing the commit, so it's more concise in the commit log. 

Otherwise looks good, thanks!
 Thanks @antpaw !
  sorry, what does this do? we've ended up fixing the test bug, so i'm trying to understand what these updates do
 what's the electron bump fix?
 awesome, thanks! i went ahead and bumped these deps
  personally like having the makefile for `make test`, but it's kind of frivolous for this case anyway. thoughts @reinpk ?
 @tejasmanohar yep, i like that more. I think we should keep the makefile, but the other stuff looks good!
 thanks @LarryBattle this is on master now!
  sweet, we should probably namespace this like we did with `options.paths`. `{ chromium: { http-cache: false } }` maybe? 

anyone have any other ideas?
 yep, this can be solved using switches. thanks for the PR!
  You have to wrap it in `co` or `vo`

``` js
vo(function * () {
  var Nightmare = require('nightmare');
  yield Nightmare()
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit');
})(function (err) {

})
```

@reinpk maybe we should change this to avoid confusion
 thanks! updated here: https://github.com/segmentio/nightmare/blob/master/Readme.md#examples
  yeah, it appears to be an underlying bug in chromium: https://github.com/atom/electron/issues/2797

unfortunately going to close here since it's several layers down :/
  So this would be for page errors, right? Because we already have: https://github.com/segmentio/nightmare/blob/master/lib/javascript.js#L25

Also, I'm not a huge fan of abbreviations and would prefer `javascript error` or `page error` to avoid confusion with your own code causing errors, but if there's previous precedent for this, then we can keep it.
  yikes, just noticed this. thanks!
  thanks! gonna close as a duplicate of #224 as @LarryBattle mentioned
  thanks!
  you're mixing generators in incorrectly... if express supports generators instead of functions with callbacks it'd be something like this:
- function passed to `router.get` is now a generator
- `yield` the `getPrice` function to get the result before sending it along
- no need for `.run()`

``` js
router.get('/', function* (req, res, next) {
    var getPrice = function* () {
       console.log('hello');  // <-- never even logged
        return yield Nightmare()
            .goto(MY_URL)
            .evaluate(function () {
                return document.querySelectorAll('.price-total .animated')[0].innerText;
            });
    };
    var price = yield getPrice();
    res.status(200).json(price);
});
```
  no additional requirements, but added another complete example here: https://github.com/segmentio/nightmare#examples

you can also try the `DEBUG=*` flag to see what's happening:
https://github.com/segmentio/nightmare/blob/master/Readme.md#debugging
  The nice thing about generators is that you can use them inside control flow loops, so you could  do something like:

``` js
while (pages.length) {
  var page = pages.pop()
  var response = yield nightmare
    .goto(page)
    .evaluate(fn)
}
```
  if you're running these things concurrency, it's pretty easy to run into:

```
(node) warning: possible EventEmitter memory leak detected. 11 uncaughtException listeners added. Use emitter.setMaxListeners() to increase limit.
```
  looks good, hopefully this will solve some errors. thanks!
  https://github.com/segmentio/nightmare#end
  sure, if it'll fix some issues, it doesn't really matter to me
  what's the url? 
 @jney Is this still an issue?
  based on my searching, i don't believe this is possible with electron, but happy to reopen if someone finds otherwise! sorry :/ definitely see the utility there...
  awesome, looks good. thanks!
  https://github.com/segmentio/nightmare/blob/master/Readme.md#examples

sorry fellas, just updated the examples to fit with yahoo.com's classname changes
 @nhducit Memory serving, the default Mocha timeout is something like 2s.  The test suite sets this to [10s](https://github.com/segmentio/nightmare/blob/master/test/mocha.opts#L2).

It might be more helpful to put an example mocha command to run with the test options.  Thoughts?
  @fritx Are you thinking of something like [`webContents.paste()`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentspaste)?
 Adding edit actions could be accomplished with `.action()`.  

With the ability to do so, I'm considering this issue resolved.  Closing.
  nope! sorry about that
  cool, thanks!
  duplicate of: #224 
  good catch!
  hey all, i'm not able to reproduce this or really understand exactly what the issue is â€” if this is still an issue can you summarize the current state/knowledge of the issue?

from my reading of this, you can get rid of `.run()` as that's a `1.x` syntax that isn't needed in `2.x`... see the readme: https://github.com/segmentio/nightmare/blob/master/Readme.md
  cool thanks!
  looks good, thanks!
  @toppetoppe i modified your example slightly and ran it locally:

``` js
var vo = require('vo');
var Nightmare = require('nightmare');


var url = 'http://www.jm.se/bostader/sok-bostad/#c=stockholm&ts=allapartmenttypes&vacant=true&tab=objects&listmode=box';
var selector = '#hitcountobjects';

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare({ show: true });
  var count = yield nightmare
    .goto(url)
    .wait(5000)
    .evaluate(function (selector) {
      // now we're executing inside the browser scope.
      return document.querySelector(selector).innerText;
    }, selector);

  console.log(count);
  yield nightmare.end();
}
```

with the following output:

```
(114)
```
  thanks!
  I think you'd have to yield on it:

``` js
yield nightmare.end()
```
  check out `did-get-response-details`:
https://github.com/segmentio/nightmare#onevent-callback
  FWIW `.then()` is undocumented and part of the private API. May change this going forward, but right now the only reason we have it in there is so we can yield on any piece of the chain:

``` js
yield Nightmare()
  .title()
```

`.screenshot()` should definitely be yieldable, that's a bug. can you provide a failing case?
 yep it can, among other things. vo is using co internally, and co has: https://github.com/tj/co/blob/master/index.js#L100

I'm down to explore integrating actual promises, I just don't want it to complicate the implementation or add a big dependency for something that could probably be implemented cleaner with generators.
 Guys, I can see why this is confusing but you are thinking about it in terms of how it should work with promises, which is part of the private API and undocumented.

``` js
nightmare
.screenshot('./example.png')
.then(function() {
  debug('Screenshot taken');
})
.end();
```

This looks like it should work but you're not handling the error case so it's tough to say whether it's a bug in nightmare or a bug in your code. The following adjustment will determine this:

``` js
nightmare
.screenshot('./example.png')
.then(function() {
  debug('Screenshot taken');
}, onerror)
.end();
```

Please open up a new issue if you still can't get to the debug statement.

---

Like I mentioned, I'm open to accepting a PR to implement promises, but it should be small and concise.
 Guys, this is where we left off:

> Like I mentioned, I'm open to accepting a PR to implement promises, but it should be small and concise.

No more comments please, just open a PR.
  yeah, you can do that in javascript with the `.evaluate()` method, check out the implementation of `.click()`:
https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L77
  No longer used in 2.x, as your pipeline will return a generator you can `yield` instead. For `.end` documentation see the [readme @1.x](https://github.com/segmentio/nightmare/blob/1.8.2/Readme.md)
 whoa i totally jumped to an early conclusion on this one, confusing `run` with `end` â€” my apologies!
 added brief docs: https://github.com/segmentio/nightmare#end

is there a specific behavior you're looking to see documented? thanks for the find!
 Same API as run, only difference is that it'll shut processes down.

``` js
yield Nightmare()
  .goto('https://github.com')
  .evaluate(fn)
  .end()
```

Or

``` js
Nightmare()
  .goto('https://github.com')
  .evaluate(fn)
  .end(onEnd)
```

or 

``` js
var nightmare Nightmare()
  .goto('https://github.com')
  .evaluate(fn)
  .run(onRun)

nightmare.end(onEnd)
```

you get the point
  generators on their own don't do the control flow, something like `co` or `vo` do this. you can use traditional callbacks for thennables if generators aren't your thing.

created a gist a while back to help me understand raw generators: https://gist.github.com/matthewmueller/9b8b59d552f90425ee41. not sure if this is helpful to anyone
  thanks!
  @FdezRomero @CatTail @kazinov @tjokimie I cannot reproduce this problem.  Has this issue been resolved?
 I'm going to consider this issue resolved.  If this is still a problem, feel free to reopen/submit a new issue.
 @deffwe If you have a minimum repro, post it and I'll reopen this issue to take a look.  Thanks for the PR! Can you explain in a little more detail what this does to fix the problem? Some questions I have:
- Was the missing semicolon causing us to not get the errors?
- What's the purpose of preloading and disabling node-integration?
 thanks buddy, appreciate the research!

i'm fine with changing the tests to point to github to avoid the great firewall. open a pr and i'll accept :+1: 
  hahaha, we've all been there ;-)
  Looks like Electron added support for `sendEvent`. We should replace probably replace our synthetic events with the real ones: https://github.com/atom/electron/issues/2269#issuecomment-142504305
 `.type()` uses `sendInputEvent`.  I believe this can be closed.
  i removed plugins and `.use()` from the initial release of `2.x` but totally open to bringing them back
 This is because we can now do `yield`s right?
 +1. `.use(fn)` is still useful in the context of `yields`. generators just allow you to use regular programming control flow (if, for, while) in addition to chaining.
 hey guys, please weigh in here: https://github.com/segmentio/nightmare/pull/336#issuecomment-161708889
  It really should propagate through. Are listening to the `nightmare.on('error')` event?

Here's the client-side implementation: https://github.com/segmentio/nightmare/blob/master/lib/javascript.js#L21-L26
  Wow awesome! Definitely think both of these features should be in Nightmare.

Two things:
- Would be good if you could open 2 separate PRs since these features are unrelated and it allows us to discuss each feature separately
-  Not too keen on the API for cookies. I think it should look more like the express/koa cookie getters and setters: https://github.com/pillarjs/cookies

The `tl;dr`:

``` js
cookie(name, value) // set a cookie 
cookie({ a: value, b: value }) // set multiple cookies
cookie(name) // get a cookie
cookie(name, null) // delete a cookie
cookie(null) // delete all cookies
```

Looking forward to seeing these features in nightmare!
 Yah if its not too much work, I'd branch off master and cherry pick from
this branch then push new PRs.

I really like this PR except for the API. Not sure that you need to do
anything more (promises/yields) than just do some argument checking with
.cookie(...)

Re: proxy Api. I think you should support whatever mongodb
client/socketio/redis client support. I believe thats a string you parse or
multiple arguments, but it'd be good to have a consistent signature

Thanks again for the hard work!
On Wed, Sep 23, 2015 at 02:18 Georgy Chirkov notifications@github.com
wrote:

> Also i thought that you should set proxy as
> .proxy(host, port, protocol)
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/pull/241#issuecomment-142538877.
 Would love to see this fixed up and merged!
 I've added cookie support to master. I'd love to see a new PR for just the proxy support :+1: 
 Closing for now, since this is woefully out of date. Would love to see someone open up a new PR with proxy support though!
  no worries man, we were all new to this stuff at one time

1) vo uses a technique called [currying](https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe). Comes from functional programming, and allows you to progressively build up functions before executing. The reason this is useful is that it allows for you to easily compose pipelines together: `vo(vo(...), [vo(...), vo(...)])(done)` for example.

Truth be told, I wasn't planning on keeping `vo(...)` in here, it's just a library that I like. You can easily use nightmare in other ways, using `co`, `promises` or callback functions. What I'd like to avoid is like what's going on in the react community, where it's just expected you know ES6, JSX, React and Flux to get started on just about any documentation, so let me know if this is preventing you from understanding nightmare better.

2) Nightmare stores cookies across requests, but not across processes. This means that when your node program ends, the cookies are gone. We may add a way to load cookies, but I think it's actually more resilient to go though the login logic each time as opposed to loading temporary cookies each time. Downside of course is that it's slower and might be suspicious that you're logging into the same account many times.
  yep three ways:
1. the debug flag: https://github.com/segmentio/nightmare#debug
2. listen for specific events https://github.com/segmentio/nightmare#onevent-callback
3. pass `{ show: true }` to the nightmare constructor to have it actually create a visible, rendered window that you can watch what's happening: https://github.com/segmentio/nightmare#nightmareoptions
 added docs here: https://github.com/segmentio/nightmare#debugging
  yeah i also had problems running parallel instances of nightmare `2.x` on the same machine (macbook)
 my suspicion is that it's somewhere in the ipc mechanism, but i'm not sure exactly how to pinpoint it off the top of my head. would be surprising if the electron processes/windows had any shared state like that.
 Possibly related to #493?
 @ndamjan Are you still experiencing this problem with more recent versions of Nightmare?
  :dancer: code deletion i love it
  yikes, it shouldn't have. x-ray will be a user of new nightmare very soon though ;-) just trying to work out the details
  not sure off the top of my head. two things to check:
- https://github.com/atom/electron/blob/master/docs/api/browser-window.md
- browser events we can trigger programmatically. i would start here: https://github.com/component/file-picker
 Added as a [plugin](https://www.npmjs.com/package/nightmare-upload).
 As the plugin should solve this issue, I'm closing it.  If you have questions/problems, feel free to reopen/open a new issue.
  <3
 i'll fix this up on master
 released as `2.0.5`, thanks!
  had just noticed this myself haha, awesome thanks! 
  cool, so what would cause this situation to come up?
  hey dan, yep the new usage would look something like this:

``` js
var Nightmare = require('nightmare')
var vo = require('vo');

vo(function* () {
  var url = yield Nightmare()
    .goto('http://google.com')
    .screenshot('goog.png')
    .url();
  console.log(url);
})(console.log);
```
  Looks like a dup of: https://github.com/segmentio/nightmare/issues/224
 closing as dupe of #224
  Hm... that error is usually the result of another error crashing the process. Was there any more errors associated with it? We could use some more error output to diagnose
 added docs here: https://github.com/segmentio/nightmare#debugging
  Hey there! I'm not sure exactly what's going on here just yet â€” what version of nightmare do you have installed? (looks like 1.x, have you checked out 2.x?)

One thing that jumps out at me is I'm not sure if node will be able to interpret the element object passed to the second function in evaluate. Could you try this instead?

```
...
.evaluate(function (){
    return document.querySelector('body').innerHTML;
  }, function(res){
    console.log(res) 
  })
.run(function(err, nightmare){
    if (err) return console.log(err);
    console.log('I'm awesome!');
    })
```
 gotcha, makes sense then! the method signature for evaluate changed in `2.0.0`, it only takes a single callback function now that the IPC works a bit differently: https://github.com/segmentio/nightmare/#evaluatefn-arg1-arg2

looks like you're after something along the lines of:

``` js
var body = yield nightmare()
  .viewport(1000,1000)
  .type(login.idfield , login.id)
  .type(login.pwfield , login.pw)
  .click("input.cartaccountlogin")
  .wait()
  .goto('ANOTHER URL')
  .wait()
  .evaluate(function (){
    return document.querySelector('body').innerHTML;
  })
```
 boom! psyched to hear it. 
  Probably need `node --harmony index.js`
 closing as a dupe of #228 
  Yikes, major issue. 

![img](https://cldup.com/dAy_dE48-X.png)

Seems like the electron linux binding is broken or something. Anyone have any ideas?
 Okay. I'm not exactly sure how to codify this right now (or what layer to support this in), but to get it working on the official node (docker) image, you need to do the following:

``` bash
# Install dependencies
apt-get update &&\
    apt-get install -y libgtk2.0-0 libgconf-2-4 \
    libasound2 libxtst6 libxss1 libnss3 xvfb
npm install segmentio/nightmare

# Start Xvfb
Xvfb -ac -screen scrn 1280x2000x24 :9.0 &
export DISPLAY=:9.0

# Test it
apt-get install vim
vim index.js
# <paste in example>
node index.js
```

More info: https://github.com/atom/electron/issues/228
Dockerfile: https://github.com/aheuermann/docker-electron

---

Could use some help on getting this bug resolved.
 Oh I don't think this is it, but can you try running master? `npm install segmentio/nightmare` ?

I upgraded it to fix: https://github.com/mafintosh/electron-prebuilt/issues/54#issuecomment-140625958
 @richard5mith i'm not very familiar with `xvfb`, by `xvfb-run` do you mean the instructions i provided? or is there a simpler way?

I think it's starting a server (`Xvfb -ac -screen scrn 1280x2000x24 :9.0 &`), which is something I'd like to avoid. or at least have a good way to clean up after we quit.
 Nice! Now just need to figure out the best way to get these dependencies on linux boxes (without using custom buildpacks or anything)
 Thanks man, unless I'm missing something I think this should do it though: https://github.com/segmentio/nightmare/issues/224#issuecomment-141575361. Or are you talking about without node dependencies? 

I think the remaining items to sort out are:
- [ ] When do these installation procedures happen? Is this a `postinstall` script, a node-gyp thing, or is it something that shouldn't even be handled in this library?
- [ ] Verify that we can run `xvfb-run --server-args="-screen 0 1024x768x24"` across multiple processes (in other words, running two of these spawn commands at once on the same machine)
- [ ] Ensure that we're cleaning up the xvfb server after we execute (when the node process exits)

I plan on looking at this sometime this week or weekend, but any time offered sorting this stuff out would help accelerate this fix.
 Would be good if we could get some sort of post install script going so it just worked on heroku. Sorry guys, I haven't had much time to look into this lately, but hopefully we can get this sorted out soon
 One thing I just realized is that nightmare is running fine on Circle CI. Probably missing something, but anyone know how that's working? I doubt they have all this additional setup, but maybe...
 Anyone get this working in a Dockerfile? Build the image just fine and seems to be working inside the container (`docker run -it nightmare /bin/bash`) but once I try passing in the command or entrypoint it just hangs (not at `nightmare queueing action "evaluate" +2ms`, but like it's starting the xvfb server without running the script)

Here's the `Dockerfile`:

``` docker
FROM node:5

# Updating ubuntu packages
RUN apt-get update

# Installing the packages needed to run Nightmare
RUN apt-get install -y \
  xvfb \
  x11-xkb-utils \
  xfonts-100dpi \
  xfonts-75dpi \
  xfonts-scalable \
  xfonts-cyrillic \
  x11-apps \
  clang \
  libdbus-1-dev \
  libgtk2.0-dev \
  libnotify-dev \
  libgnome-keyring-dev \
  libgconf2-dev \
  libasound2-dev \
  libcap-dev \
  libcups2-dev \
  libxtst-dev \
  libxss1 \
  libnss3-dev \
  gcc-multilib \
  g++-multilib

ENV DEBUG="nightmare"

# Add current directory to /app
ADD . /app

# Set current working directory as /app
WORKDIR /app

# Install npm packages
RUN npm install

# Default command. Assumes our file is index.js and our screen size is 1024x768
CMD DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" node index.js
```

Trying to legitimize this a bit for us all, but major strugglez :-P
 @edasque thanks for the detailed instructions! the command i'm just trying to get working is this:

``` bash
docker run nightmare xvfb-run --server-args="-screen 0 1024x768x24" node index.js
```

or 

```
docker run nightmare node index.js
```

with `xvfb-run --server-args="-screen 0 1024x768x24"` being an `ENTRYPOINT`

---

_edit:_ though come to think of it, the dockerfile you provided is deployable to heroku/dokku on it's own. just looking for a couple ways to make this as easy to use as possible.
 > index.js being the CNN example, right?

Yep!

> Let me know what I can help with.

If you have a chance, do you mind testing this command? `docker run nightmare xvfb-run --server-args="-screen 0 1024x768x24" node cnn.js`

I was able to get it working by keeping everything in the Dockerfile, but it'd be nice to have flexibility in what script you run. For me when I run that command, it doesn't even run the node script, it just hangs, like it started the xvfb server but didn't do anything after. Tested a ton of iterations, but haven't been able to get a version working where you can pass the file in.

> Note however that the ENTRYPOINT will require you to install the application dependencies through nightmare's package.json in this case. Use the exec form of ENTRYPOINT so it could be overriden, maybe?

Yah maybe best to stick with `CMD`, though you can overwrite `ENTRYPOINT` via `docker run --entrypoint`, though i'm not sure that's a great idea. I guess it depends how often you need to change the `--server-args`
 it works using docker. we're working on a better solution for linux. keep in mind this is free software, so please be civil. if you're unhappy with nightmare, you're free to try something else.
 @rickmed I was planning on closing it with the resolution of #502 (where Nightmare would take care of the framebuffer for you, at least until Chromium's headless features trickle into Electron), but the details of that have proven much more difficult than I had anticipated.  It's not even as simple as "just use Xvfb" as [_sometimes_ this causes Chromium to hang](https://github.com/segmentio/nightmare/issues/561).
 ~~I'm not much of a terminal user, and while I tried [Electron's travis-ci recommendations](https://github.com/electron/electron/blob/master/docs/tutorial/testing-on-headless-ci.md), my tests are still timing out; even with 10+ second limits.~~

The only thing that worked for me was to use [xvfb-maybe](https://github.com/paulcbetts/xvfb-maybe) and to use a forced viewport size (via `browser.viewport()`).
 @pelhage well, Electron sure doesn't take _a few seconds_ to open like PhantomJS does.
  looks like the same issue as #224
 Given the age of this issue, I'm going to close it.  If you're still experiencing this issue, feel free to open a new issue.  yah, i was worried about this, it's a much more complicated prospect to get the events working.

I think we'd want to use something like this: https://github.com/DamonOehlman/simkey if we decide to support this.
 I believe this was (eventually) fixed in #548.
  You'll need to wrap it in a generator function using a library like [co](http://github.com/tj/co) or [vo](http://github.com/lapwinglabs/vo):

``` js
var vo = require('vo')
vo(function * () {

  var Nightmare = require('nightmare');
  yield Nightmare()
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit');

})(fn)
```

This is the recommended approach because it's extremely easy to follow. Alternatively you can use callbacks:

``` js
var Nightmare = require('nightmare');
Nightmare()
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('.searchsubmit')
  .run(function (err) {

  })
```

Or even promises (well, thenables):

``` js
var Nightmare = require('nightmare');
Nightmare()
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('.searchsubmit')
  .then(fulfill, reject)
```

Hope this helps!
  Can you provide a failing example please?
 potentially open to a simple pull request, but closing for now as it looks like your immediate question is resolved! thanks!
  Hm, if I'm understanding this issue correctly, you'd like to be able to programmatically handle open windows, without actually opening the window. Is that correct? If so:
- programmatically manipulate open windows

We probably won't add support for this case directly, but keep in mind most the library just builds on that `.evaluate(...)` function. Taking a look at how the actions are implemented is a good place to start.

There are definitely ways to access popup windows on the page from the host. Here's one way if you have control over the popup: https://github.com/lapwinglabs/oauth-open/blob/master/index.js#L28-L29
- don't actually opening the window when `{ show: false }`

I'm not sure electron is respecting this default for newly spawned windows, we may need to investigate this more or open up an issue on electron to fix. I don't think there's a way for us to intercept that command, but who knows. 

**Edit** I guess we could monkey patch `window.open`, but i'm not sure what that would solve.
 I can confirm the bug and I've opened the issue on electron's side: https://github.com/atom/electron/issues/2771

I don't really see a good way of handling this on our side, so let's track that issue instead.
  got it, yeah that's a dependency of nightmare unfortunately. in v2 (see #200) we've moved away from phantom and i've just verified that the latest build of v2 runs fine on v4:

<img width="661" alt="screen shot 2015-09-12 at 9 01 39 pm" src="https://cloud.githubusercontent.com/assets/658545/9835171/9cf74a5e-5991-11e5-86c0-4f5a1f816db2.png">

looking to release v2 tomorrow, so closing this
  hmmm, no idea! hopefully someone in the community knows gulp :)
 don't think there's any need for a gulp package based on offline chats
  Ahh my bad. Basically I think the two ways you should be able to close the connection are:

Run nightmare one time

``` js
var nightmare = Nightmare()

yield nightmare
  .goto('http://google.com')
  .title()
  .end()
```

 Run it a bunch of times and eventually end:

``` js
var nightmare = Nightmare()

yield nightmare
  .goto('http://google.com')
  .title()

yield nightmare
  .goto('http://yahoo.com')
  .title()

yield nightmare.end()
```

I think maybe it should be a no-op in run instead of conditionally running `this.run()` based on the callback.
 Just tested this out, good call. This is the right solution. Thanks!
  can you share your script? or are you running the tests? the error itself is pretty generic.
 Should be fixed now in latest `v2` sorry for the confusion!
  yes, totally annoying. this is coming in v2 :) see #200 
  With the inclusion of `.action()` being able to patch Electron, I've gone ahead and published a [navigation lock plugin](https://www.npmjs.com/package/nightmare-navigation-lock).  If you have questions, feel free to open an issue in that project's repository or reopen this issue.
  cool, v2 is coming tomorrow hopefully :)
  awesome thanks @danielstjules! we're working on v2 #200 and will try to pull this in there as well to accelerate tests :)
  thanks! sorry i couldn't merge this with all the changes, but i've merged it in manually: https://github.com/segmentio/nightmare#debug
  does this test pass for you? https://github.com/segmentio/nightmare/blob/master/test/index.js#L251 ...trying to isolate the issue
  hey i'm not sure for v1, but this is now fixed in `2.0.0` (just tested it there)
  why would you want to do this from nightmare itself? you'd probably use [superagent]()https://github.com/visionmedia/superagent) outside of nightmare
  in v2 we're moving to electron rather than phantomjs, which should hopefully be more stable and less of these kinds of difficult build errors :/
  Is this possible?

__EDIT__: You should probably just use [Puppeteer](https://github.com/GoogleChrome/puppeteer).
 **EDIT**: This doesn't work anymore on 2.0 and above, scroll all the way down for the new solutions.

I had to create a `withFrame` action function that goes inside the iframe context and a `backToParentFrame` function to go back to the parent frame:

``` js
exports.withFrame = function(frameSelector, fn, done){
  // `frameSelector` is either an index number or the iframe's name
  // no class names or ids unfortunately
  // As you can see, the code is identical to that of the `use` function
  debug('.withFrame():' + frameSelector);
  this.page.switchToFrame(frameSelector);
  var cache = this.queue;
  this.queue = [];
  fn(this);
  var self = this;
  this.queue = this.queue.concat(cache);
  done();
};

exports.backToParentFrame = function(done){
  debug('.backToParentFrame()');
  this.page.switchToParentFrame();
  done();
};
```

I originally tried to make it so that once the actions inside `withFrame` are done, it would automatically go `backtoParentFrame` but I couldn't figure out how to do that, so I made it separate. So essentially you would do:

``` html
<!-- For this given iframe -->
<iframe name="formIframe" src="somelogin.php" />
```

``` js
nightmare
  .withFrame('formIframe', function (nightmare) {
    nightmare
      .wait('form#login')
      .type('#username', 'rclai')
      .type('#password', 'password')
      .click('#submit')
  })
  .backToParentFrame()
  .wait('.for-my-logged-in-indicator')
  .run(...);
```

Don't know if you guys want to include this functionality or not. I've taken the concept from CasperJS [here](https://github.com/n1k0/casperjs/blob/376d85fceb5eca63596e12e2ef6072a72422ed9b/modules/casper.js#L2356-L2381). If you guys like it, I would suggest figuring out how we can automatically go back to the parent frame without explicitly having to do so.
 You should be able to copy and paste the code I typed above and put it into `nightmare/lib/actions.js` before the actions are attached to the Nightmare prototype.
 Cool.
  For what it's worth, here's a sample of clearing the cookies manually:

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();

nightmare.goto('http://yahoo.com')
  //get the cookies
  .cookies.get()
  .then((cookies) => {
    //extract the names
    return cookies.map((cookie) => cookie.name)
      //for each name, clear the cookie and return the promise to be resolved
      .reduce((accumulator, name) => accumulator.then(() =>
        nightmare.cookies.clear(name)), Promise.resolve())
  })
  //get the cookies again
  .then(() => nightmare.cookies.get())
  //display the cookies
  //note they should be an empty array
  .then((cookies) => {
    console.dir(cookies);
    //end the nightmare instance
    return nightmare.end()
  })
  .then(function() {
    console.log('done');
  });
```
 Fixed with #652.  Closing.
  we're starting to consider major improvements that could be made in v2 of nightmare. the proposal is to move from phantomjs to electron, and move the api to use generators.
## speed

some of the most vexing issues with nightmare (e.g. #199 and #192) _seem_ to boil down to underlying issues in phantomjs. @matthewmueller has done some experimentation with [atom/electron](https://github.com/atom/electron) and sees 2-3x speed improvements loading and getting the title of the page:

| Site | Phantom | Electron | Speedup |
| --- | --- | --- | --- |
| Google | 2064ms | 866ms | 2.4x |
| Yahoo | 4059ms | 1862ms | 2.2x |
| CNN | 8658ms | 2729ms | 3.2x |
## generators

one of nightmare's original goals was to eliminate the callback hell of raw phantomjs. with [generators](https://strongloop.com/strongblog/how-to-generators-node-js-yield-use-cases/) now on node stable, it makes sense to take the api one step closer to eliminating callbacks using generators. this should also make the execution more linear, understandable and controllable. ideally this is a solution to requests like #177, #176, #160 and #59.

``` js
var nightmare = new Nightmare();

// generators allow us to get the value back synchronously
var title = yield nightmare
    .goto('http://facebook.com')
    .evaluate(function() {
      return document.title;
    });

// continue with the same instance of nightmare + page state
var titleSearch = yield nightmare
    .click('#search')
    .evaluate(function(){
      return document.title;
    });

// tear down the page state
yield nightmare.close();
```

---

if you have other feedback or frustrations at this deeper level, please let us know!
 Just pushed up a branch for `v2`. I could use some help finishing up some of the remaining tasks:
- [x] port over the remaining actions
- [ ] add some examples
- [x] write some tests

Unfortunately, I cannot create a PR because the commit history is completely different. I could just write on top of all the old files though.

cc/ @reinpk @amillet89 
 awesome @matthewmueller just pushed some updates with a structure for testing based on the old tests, as well as circleci setup, and adding the `.back()` action... will push it a bit further this afternoon
 ported over a bunch more actions (with tests)... remaining ones are things like `pdf`, `screenshot`, some variants of `wait`, the event handlers, and initial options. the readme is mostly updated as well.
 Nice work @reinpk! Can't wait to see this release in the wild.
 todos:
- [x] add support for `.wait(selector)`
- [x] add support for `.wait(fn, val, [delay])`
- [x] add support for `.screenshot(path)`
- [x] add support for `.pdf(path)`
- [x] add support for page events
- [x] add support for initial browser window options
- [x] update readme for page events and initial options
- [x] update landing page description and example at https://nightmarejs.org
- [ ] read through open issues, create test cases and see what we can fix now
 Getting close... will pick this up next week when I'm back from vacation.
 @reinpk Interested to hear your thoughts on this. One thing I'd like to change is the ability to wait for click events to be fulfilled. Unless I'm missing something, right now you need to basically know what's coming (on the next page) and wait for it.

``` js
yield Nightmare()
  .click('a')
  .wait('.some-selector-on-the-next-page')
```

It'd be nice to be able to say something like:

``` js
yield Nightmare()
  .click('a')
```

And detect that the page is transitioning (maybe using `window.beforeunload`) and wait.
 ah, that's a very interesting idea yeah. in v1 you could just call `.wait()` without any arguments... do you think omitting the `.wait()` altogether is the right solution, or just making it so that the complexity of finding a relevant selector is unnecessary?
 Yah, I think it's definitely dependent on the use case. Personally, I think `click()` should handle it because for the case when you actually navigate to another page, it's sort of like the action is "half-complete" (page still in transition) before the next action is triggered. 

Plus the next action is almost never going to be what you expect (unless it's a `wait()`).

We could probably tap into this event: http://electron.atom.io/docs/v0.31.0/api/browser-window/#event-39-will-navigate-39 if we go this route.

**Update:**

Ended up pushing something up for this: https://github.com/segmentio/nightmare/commit/06eb6633478cb1d5e3878401c351fe1db10011a2

Came up with a solution that I think is pretty solid without using timeouts or anything. Personally, I think this makes a lot more sense:

``` js
     var title = yield nightmare
        .goto(fixture('navigation'))
        .click('a')
        .title() // A
        .click('.b')
        .title() // B
        .back()
        .title() // A
```

Than:

``` js
     var title = yield nightmare
        .goto(fixture('navigation'))
        .click('a')
        .wait()
        .title() // A
        .click('.b')
        .wait()
        .title() // B
        .back()
        .wait()
        .title() // A
```

The nice thing is that it won't wait if the click doesn't actually cause navigation.
 :+1: i'm cool with that, thanks @matthewmueller!
 a bit stuck on getting `screenshot` to work, but `pdf` is working and the landing page is ready to go segmentio/nightmarejs.org#1
 alrighty.... this is pretty much ready to go! thanks @matthewmueller!

will take another look in the morning, review issues, fix the commit history and release v2.0.0
 released :)
 @myrubapa gotcha, you can always continue pulling `1.x` or fork from that commit. phantomjs had SO many weird issues upstream that we had constant reliability problems with it. we opted for a smaller feature set that worked reliably in our testing.
 @myrubapa can you give an example of how phantom was better for you?
  thanks @li-xinyang in v2 we're moving to electron and testing so far shows that it's significantly faster, see #200.
  Look into using the .use() function. That will allow you to do what you're doing. 
 @abe-winter @fpinzn in v2 we're moving to using generators and an explicit `.end()` method, which should bring the benefit of stronger flow control.
  errors should now be bubbled up in the new `2.x` implementation with generators
  Can't you just evaluate and return the HTML from it?
  cool, moving to electron in v2 which should fix this keypress issue _and_ the flaky test issue ;)
  Seems to be working okay for me, can you try upping the timeout?
 ack sorry for the trouble here... this kind of unreliable stuff seems to plague phantom and in v2 we're moving to electron which (so far) feels much more stable and speedy.
  sorry can you explain the use case a bit more? what does `yslow.js` do? can reopen if you provide a bit more detail :)
  Like CDNs.
 Huh? Can you elaborate on that?
 Oh! I get it now, I didn't think of that. Thanks!
 Looks like you can't pass complex objects into the browser scope.
 I figured it out by doing this:

``` js
nightmare
  .evaluate(function () {
    $.getScript('https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js');
  }, function () {
    console.log('Injected moment.js into the page.');
  })
  .wait(function () {
    return typeof moment;
  }, 'function')
  .evaluate(function () {
    return moment(new Date()).format('MM/DD/YYYY');
  }, function (date) {
    console.log('Today is', date);
  })
  .run(function () {});
```
  Sweet! Would you mind adding a test or two?
 awesome, thanks!
  in v2 #200 we're moving to electron, hopefully this resolves some of this complexity!
  Following up on this, electron/electron#1360 links to to electron/electron#3432, which adds the part to use the pragma directive when using [`webContents.loadURL()`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#webcontentsloadurlurl-options).

I think this issue is resolved.  If you have any more questions, feel free to reopen or open another issue.
  good call thanks guys!
 released with 1.8.2
  Ah there it is. Thanks.
  hmmmm... not sure based on the sample but it shouldn't be called immediately. in v2 we're moving to use generators and this should be substantially easier...

``` js
function*(var1, var2, var3) {
   yield nightmare.someQueuedCalls();
}
```
  in `2.x` you should be good to go! https://github.com/segmentio/nightmare#onevent-callback
  released with 1.8.2
  @lvyachao You could use [`.inject()`](https://github.com/segmentio/nightmare#injecttype-file) to add jQuery to a page and then use `.evaluate()` to execute DOM actions.  There's a [unit test](https://github.com/segmentio/nightmare/blob/master/test/index.js#L231-L247) that injects jQuery to get specific tags, as a reference.

You could even go a step further and use [`.action()`](https://github.com/segmentio/nightmare#extending-nightmare) to add custom commands to wrap the jQuery functionality you want.

I don't think including jQuery out of the box is in scope for Nightmare.  If you have any more questions, feel free to reopen or file a new issue.
  thanks @Zirak! sorry for the delay... this pull request and others like it were influential in the work that @matthewmueller put into v2... which uses generators and an explicit `.end()` method. should solve the same problem in a slightly different way. thanks!
  we decided in v2 #200 to solve this with generators and explicit `.end()` method
  the extra flow control here is a great idea, though we wanted to hold off and implement it using generators. v2 (#200) should get us there with the explicit `.end()` as well
  lgtm thanks!
 released with 1.8.1
  indeed, sorry for the radio silence. this has been fixed in `2.x` as part of the move to electron. here's the test case illustrating how to listen for page load fails:
https://github.com/segmentio/nightmare/commit/2241314e7f5aead3aa03699a314e9427e3245388
  not easily in the current nightmare v1.x, but in v2  see #200 you'll be able to have proper flow control using generators and an explicit `.end()`
  Taking a closer look at this: `.wait(selector)` now will time out after some period of time.

@shri3k's example is problematic, at least with the Electron implementation: a single Nightmare instance wraps one Electron instance, meaning in general you should not try to do parallel operations on the same instance.  Those actions will enter into a race condition and (probably) behave poorly.

Due to the age of this issue and lack of response, and that there is a viable solution baked in, I'm going to close this issue.  If you have any more problems, feel free to reopen or file a new issue.
  thanks!
  just retested this in `2.x` and cookies are saved across `.goto()` calls now

```
var Nightmare = require("nightmare");
var vo = require('vo');

vo(function *() {
  var nightmare = yield Nightmare({ show: true })
    .goto("https://segment.com/login")
    .type("input[name=\"login\"]", "<login>")
    .type("input[type=\"password\"]", "<password>")
    .click("button[type=\"submit\"]")
    .wait(2000)
    .goto("http://www.google.com")
    .goto("https://segment.com/workspaces");
})(function (err) {
  console.log(err);
});
```
  i think daydream is probably where i'd start... becomes pretty obvious what the code is doing :)

i'd probably do:
1. daydream
2. html/css selectors
3. nightmare
4. dive deeper into how javascript is working
  that is very strange, when you debug do you see it hitting this line at all?

https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L313

`setTimeout` would be a bit out of our control haha, but maybe it's missing that clause.
 closing since not enough information to dig into this :/ happy to reopen with more info thanks!
  How can I make the phantom instance to load the website without loading their js files just like NoScript? Thanks for the help :)
  we're addressing these ideas in v2 with generators and an explicit `.end()` method, thanks!
  good news, just tested this on v2 and the rendering looks fixed :) v2 will be out tomorrow see #200
![test](https://cloud.githubusercontent.com/assets/658545/9835218/c529f326-5993-11e5-9123-f4012ba04be4.png)
  in `nightmare@2.x` you can listen for the `did-get-response-details` event, and inspect the arguments for the status code â€” there's enough information in there to pinpoint the html/url requested
  you can now get the http status code with `.on('did-get-response-details`, ...)`...

https://github.com/segmentio/nightmare#onevent-callback

here's an example from loading `yahoo.com`:

```
[
   "https://www.yahoo.com/",
   "http://yahoo.com/",
   200,
   "GET",
   {
      "age":[
         "0"
      ],
      "cache-control":[
         "no-store, no-cache, private, max-age=0"
      ],
      "connection":[
         "keep-alive"
      ],
      "content-encoding":[
         "gzip"
      ],
      "content-type":[
         "text/html; charset=utf-8"
      ],
      "date":[
         "Sun, 25 Oct 2015 20:13:35 GMT"
      ],
      "expires":[
         "-1"
      ],
      "p3p":[
         "policyref=\"http://info.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""
      ],
      "server":[
         "ATS"
      ],
      "set-cookie":[
         "DNR=deleted; expires=Sat, 25-Oct-2014 20:13:34 GMT; path=/; domain=.www.yahoo.com",
         "DNR=deleted; expires=Sat, 25-Oct-2014 20:13:34 GMT; path=/; domain=.www.yahoo.com",
         "PH=deleted; expires=Sat, 25-Oct-2014 20:13:34 GMT; path=/; domain=.yahoo.com"
      ],
      "strict-transport-security":[
         "max-age=2592000"
      ],
      "transfer-encoding":[
         "chunked"
      ],
      "vary":[
         "Accept-Encoding"
      ],
      "via":[
         "http/1.1 ir32.fp.gq1.yahoo.com (ApacheTrafficServer)"
      ],
      "x-frame-options":[
         "DENY"
      ]
   }
]
```
  yuck, sorry! on v2 we're running all the tests and development on 0.12, and ditching phantomjs for electron, so this should be resolved shortly, see #200
  great idea, can we make the parameter optional with a good default though?
 should be possible now in `2.x`: https://github.com/segmentio/nightmare#pdfpath-options
  thanks @rrrene but the page seems a bit simplistic without restructuring our inline docs to match the way it picks up headers as methods. happy to reconsider down the road, but not a priority right now, sorry!
  yeah, definitely yucky â€” in v2 #200 we're moving to electron replacing phantomjs which should help
  @jfrumar How did you extract the cookie header information?
 @azurelogic how would you do the same thing you did but on a asp.net web form page where there are different submit buttons (and the entire page is a form, that's how asp.net pages are)? One of those submit buttons submits the form and serves you the file. What I'm trying to figure out is how to do the `XMLHttpRequest` but when that specific submit button was clicked.

**Edit**: Figured it out, when you click on a specific submit button, the `POST` body will have that button's `name`s in this format:

```
ctl00$ContentPlaceHolder1$imgBtnReport.x:13
ctl00$ContentPlaceHolder1$imgBtnReport.y:22
```

And the other buttons' names will be excluded from the `POST` body
 With the release of #425 in 2.3.0, I've gone ahead and released plugins that will take care of downloads:
- [nightmare-download-manager](https://github.com/rosshinkley/nightmare-download-manager)
- [nightmare-inline-download](https://github.com/rosshinkley/nightmare-inline-download)

I'm considering this issue resolved.  If you have further questions or problems, please open a new issue.
  hey @serv unfortunately no idea here :/ if you have an example where we could repro that would be awesome though... ideally we can verify that the switch to electron in v2 eliminates the problem.
  sorry fellas, been slammed but will get to this on the coming weekend i hope
 not sure yet, great question though. we'll need to dig into the electron documentation to figure it out
 i don't believe this is possible in electron, so i'm going to close this as not possible unfortunately. if you have an example of a popup script would be great to test it out though
  looks like electron supports something like this now, closing in favor of #244 where we can track progress
  interesting, from my experiments it seems to respect the width parameter https://cloudup.com/cZTInhjYPB0 but not the height. presumably it also needs a scroll offset for the height... using cliprect: https://github.com/ariya/phantomjs/issues/10619

it looks like this can be solved alongside #107 so i'm going to merge this into that issue, thanks kyle!
  i believe xpath is for xml node selection, but the selector here is designed for html pages and gets passed through to `document.querySelector()`, which i don't believe supports xpath, no.
  cool, going to merge this with #107 as i agree it seems helpful!
  thanks for the reports! can you include an example script that's occasionally failing for the hashtag?

for monitoring the ajax events, i'd give `.on('resourceRequested', ...)` or `.on('resourceReceived', ...)` a try: https://github.com/segmentio/nightmare#onevent-callback

i'll close for now, but can reopen with a test case, thanks!
 ah bummer, yeah my workflow is to close and then reopen quite often. it's not a finality :)
  lgtm
  Same kind of error here, just one though:

```
  1) Nightmare multiple should run fine with two instances in parallel:
     Error: timeout of 40000ms exceeded
      at null.<anonymous> (/home/ubuntu/nightmare/node_modules/mocha/lib/runnable.js:175:14)
      at Timer.listOnTimeout [as ontimeout] (timers.js:112:15)
```
 Right, the reason why this test is failing since we are currently relying on real-world sites for testing, which can be inconsistent with timing out as a common error. we're planning to move to local testing with https://github.com/segmentio/nightmare/issues/118.

Other than that, this looks good to me
  This is the error that we're seeing in the build:

```
  1) Nightmare manipulation should emit the timeout event if the check does not pass while waiting for fn==val:
     Error: timeout of 40000ms exceeded
      at null.<anonymous> (/home/ubuntu/nightmare/node_modules/mocha/lib/runnable.js:175:14)
      at Timer.listOnTimeout [as ontimeout] (timers.js:112:15)

  2) Nightmare multiple should run fine with one instance in sequence:
     Uncaught AssertionError: signal killed phantomjs: SIGSEGV
      at Console.assert (console.js:102:23)
      at ChildProcess.<anonymous> (/home/ubuntu/nightmare/node_modules/phantom/phantom.js:142:21)
      at ChildProcess.emit (events.js:98:17)
      at Process.ChildProcess._handle.onexit (child_process.js:810:12)



make: *** [test] Error 2 make test returned exit code 2
```
 Yes, again, the first error above is attributed to testing with real world sites. Not quite sure what the second one is from, will look into it.
 ah good call, thanks! made the changes in parallel on master
  Hey, thanks for using Nightmare and surfacing this issue! Seems reasonable, I'll add it now.
 https://github.com/segmentio/nightmare/pull/135
 was fixed by #135, thanks to you both!
  lgtm! @reinpk @lambtron @stevenmiller888 
  not sure what you mean... can you send over an example?
  I'm looking to make multiple instances of nightmare and running some tests on different websites in same time. I tried using jxcore for multithreading and nightmarejs but i was unsuccessful. Then I tried using synchronize.js (http://alexeypetrushin.github.io/synchronize/docs/index.html) and I was successful but it used the same instance of nightmarejs, I don't know why. Does someone know a good approach on this ? Thank you for your time guys :)
  In the screenshot of the login page, are the un/pw fields filled out? Is the selector in the `click()` method valid? 

Can you run the program with `DEBUG=*` and paste in the output so we can see what's going on under the hood? 

Thanks!
 i tried adding some actions that cause new pages to load, but the screenshots seem to work for me....

``` js
var Nightmare = require('nightmare');

new Nightmare()
  .goto('https://segment.com')
  .click('[href="/docs"]')
  .wait()
  .screenshot('test.png')
  .run();
```

29 seconds for the next page load seems really long?
  Got it, you can combine the node modules `fs` and `nightmare` something like this (untested):

``` js
var fs = require('fs');
var Nightmare = require('nightmare');

new Nightmare()
  .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit')
    .evaluate(function () {
          return document.documentElement.innerHTML;
    }, function (html) {
        fs.writeFileSync('./page.html', html);
    })
    .run();
```

http://nodejs.org/api/fs.html#fs_fs_writefilesync_filename_data_options
  hmmmm, yes it looks like onResourceRequested actually has two functions as parameters that execute in different contexts.... https://github.com/sgentle/phantomjs-node#functionality-details and currently the function getting passed is executing in the external context not the phantomjs context.
 i've split it into two events, one that's triggered when on `resourceRequestStarted` that executes in the phantomjs context, and allows you to abort, change url, or adjust headers. `resourceRequested` will remain the same thing, executed in the external context.
  that is super slow. do you have a nightmare script test case for a publicly available site?
 this is somewhat fixed in v2 #200 by switching from phantomjs to electron
  i don't believe electron has this (for `2.x`) but it would be interesting to make a version of `.screenshot()` that just returned the buffer!
  Hey there,

Thanks for checking out Nightmare! Unfortunately the string passed at runtime is going to be evaluated as such, i.e. the `goto(iframeURL)` will tell Nightmare to go to a blank URL.

Is the URL you are getting from the outerHTML of that iframe unique every time? If not, you could hard copy that URL and initiate Nightmare with a `.goto()` to that URL.

Otherwise, you could create two Nightmare instancesâ€”one to retrieve the unique URL and another one that will wait until the first finishes and then go to said retrieved URL. Not the best solution, but one nonetheless (may require `setTimeout` or used in conjunction with the async library, etc.).

Hope that helps. Let me know if you have any additional questions or comments!
  Hi,

Thanks for using Nightmare! We actually built Nightmare with the intention of automating browser tasks, so we want to keep the exposed methods simple and few. However, we noticed that a ton of people are using Nightmare for automating browser tests, so we're considering building out a `nightmare-testing` module that builds on top of Nightmare and provides more testing specific methods. The more data around how we see people use Nightmare will greatly shape its road map.

Feel free to add your comments to this thread:
https://github.com/segmentio/nightmare/issues/117

Or here:
https://github.com/segmentio/nightmare/issues/113

Thanks!
 Another thing to keep in mind is that the `.wait()` function can take a selector, of which the Nightmare instance will wait until it appears.

You can try this:

```
describe('Nightmare', function () {
    this.timeout(60000);

    it('shoud not spend a lot of time', function (done) {
        var nightmare = new Nightmare();
        nightmare.goto('https://github.com')
            .click('a[href="/login"]')
            .wait('div#login')
            .visible('div#login', function (visible) {
                visible.should.be.true;
                console.log('before login');
            })
            .type('input[name=login]', 'myUsername')
            .type('input[name=password]', 'myPassword')
            .click('input.button')
            .wait('span.octicon-inbox')
            .visible('span.octicon-inbox', function (visible) {
                visible.should.be.true;
                console.log('after login');
            })
            .run(done);
    });
});
```

More info:
https://github.com/segmentio/nightmare#waitselector

Can you try that and see what the performance is like? Thanks!
 hey @ybak i just tested your script locally and it executes for me in about 4 seconds... since i have two-factor auth enabled i end up on the two-factor auth code page, but it successfully passes the first step of the login process with my own credentials in about 4 seconds.

could you try running it as `DEBUG=* node test.js` so that we see more internal output? and then also add the timeout handler:

```
new Nightmare()
    .on('timeout', console.log)
...
```

to get more visibility. 
 i've also experienced this, and would love to get a fix in place. will try to look into it this coming weekend.
 in v2 #200 we're moving off phantomjs for electron, which has been significantly faster in testing.
  Seems reasonable and aligned with general automation of browser tasks.. :)

Just curious, how are you using Nightmare?
  interesting, looks like a weird problem related to:
https://github.com/segmentio/nightmare/blob/master/History.md#162--2014-11-09
 thanks for providing such a complete example btw!

from the way the screenshots look, it seems like there's something strange happening with element focus:
![](https://cldup.com/TOxKeRWXJ--3000x3000.jpeg)

unfortunately it's happening a level deeper in phantom
 when i run with nightmare@1.6.1 i see the expected behavior:

![](https://cldup.com/LlW5n0C0F7-3000x3000.jpeg)
 hmmmm, so it seems like there's something funky with optimizely's javascript on that form. i added another step to fill out the name field appropriately:

```
.type('#signup-dialog input[name="name"]', 'Ron Jeremy')
```

and then the most recent nightmare version works fine:

![](https://cldup.com/4NiUPUvSl3-3000x3000.jpeg)

hopefully that solves the immediate issue for you. the underlying problem is that phantomjs isn't maintaining focus on that form, maybe because they're doing some real-time validation...
 yeah, that change seems to have made a lot more issues than it solved... the reason we switched it is because some fancier forms didn't respond well to the value setting method... but it was much simpler and more robust :P see #81, maybe there's a hack that sets value and then does a single `sendEvent` or something.

yeah, i'm definitely open to reverting that change and looking for a better solution.
 yeah makes sense, could you send over a pull request from your fork? happy to merge
 in v2 we're using electron instead of phantomjs, and electron doesn't have a native keypress function, so we're going back to the way it worked here originally, which should fix this issue in v2.0 #200 
  Thanks for the feedback and suggestions!

> Furthermore, it would be nice if you could specify an indefinite wait that polls the page every X milliseconds, but doesn't refresh it. For example, there may be a lengthy operation that is running on the page that a refresh would cancel/reset. Perhaps add a refresh option?

I might not quite be following, but I think that's exactly what the `wait(fn, value)` method does. If you don't pass `delay`, the fn will evaluate over at over at the default interval of 50ms (or whatever you set in your override) until timeout. 

> Also, I cannot see any reason for delay to be an optional parameter. If you don't specify a delay, the wait will be over after the first timeout, making the return value of fn inconsequential...

Adding the refresh delay doesn't actually extend the timeout, it just optionally refreshes the page at [delay] interval in case you're hoping to grab a specific static element value that can change on refresh, [like in the test](https://github.com/segmentio/nightmare/blob/master/test/index.js#L269-L273).

Make sense?
 yeah that's a fair point... here was the original thought process:
1. If something is going to change on the current page via ajax (no delay parameter), wait times will be relatively short. the user is probably expected to sit and wait.
2. if something is going to change on refresh (with delay parameter), wait times will be relatively long. the user isn't expected to sit there and refresh the page.... we're taking on a long-running task for the user so that they can do other stuff rather than refreshing this page.

with that in mind, the first scenario has a fast delay of 50ms, whereas the second scenario is typically for delay times >1 minute.

i agree the page refreshing is unexpected, so maybe that should be split into a separate function somehow.
 in v2 (see #200) we've gone with your original suggestion :) thanks so much! the new function signature is `.wait(fn)` and waits until the function returns true after being evaluated on the page. v2 should be out tomorrow :)
  Total agreement from the folks here at [Segment](http://segment.com). @stevenmiller888 and I are going to dive into this starting this week. 
 yeah totally agree, this is the next major improvement for nightmare i think
 fixed a while ago by the indomitable @dominicbarnes 
  Hey @mickaelandrieu, I'm Andy and I'm helping maintain this library.

We built Nightmare with the intention of automating browser tasks, so we aim to keep the exposed methods simple and few. However, it appears that many people are using Nightmare for browser testing. We're considering building a nightmare-testing library that will do just that, while keeping this library simple and for building APIs and plugins.

Let us know what you think of a nightmare-testing library and if you'd like to contribute to it!
 Hey @mickaelandrieu,

Good points. There are many people using Nightmare for user testing and I think there can be more work done in making it easier for them to do so. Targeting the big testing libraries is a great start. Maybe we can spec out the interface of how users would use Nightmare with Mocha or Jasmine and work from there?

Agree to keep Nightmare simple with many useful middlewares that people can pick and choose. Eventually, I'd also like to see an ecosystem of plugins of automated browser tasks, such as https://github.com/segmentio/nightmare-swiftly
 Found this with a quick Google search, using Nightmare with Mocha, Chai for e2e testing:
http://weblogs.asp.net/mikaelsoderstrom/writing-end-to-end-tests-with-nightmare-js

How did you imagine you want to improve the testing interface?

[edit] i see you commented on its performance :)
 sounds good, we do intend to keep improving nightmare, though we'll keep the API small and push people to develop frameworks around it.
  haven't been able to reproduce, but that makes me suspect it's a localization issue with yahoo's site being different in france than in the us, closing for now but i'm about to generate a bunch more examples of different ways to use nightmare.
  good idea, will merge and see what the issue is
  just retested this in `2.x` based on electron, and the font now renders correctly :)

![font-rendering](https://cloud.githubusercontent.com/assets/658545/9837539/3120051c-59f7-11e5-9eb4-ad615a32769f.png)
  We're seeing a wide variety of use-cases, would love to hear what you've been using it for, thanks!
 @dzignus what are the specific parts of the API you're missing?
 I've been using it to automate to logging in to vendor sites to grab open order reports and it's been quite nice.
 FYI we just released `2.x` which seems to fix a lot of problems by migrating from phantomjs to electron under the hood
  @reinpk :)
 shoot. passing locally. i'll see whats up with the "should type and click" test this evening and see if we can get all those tests passing
 hey i think that was a circleci issue, can you rebase to master to pick up a few circleci updates and then those tests should pass
 rebased but still an issue there :)
 weird! i'll bug you about it tomorrow.

![](https://cldup.com/vMowro9lHB.png)
 sorry for the delay! this looks good and just rebased it, merging now
  ah, the function was failing for non-existent elements, fixed in nightmare@1.6.4 thanks!
 not sure about the code there specifically for the click not scripting correctly... the fix on 1.6.4 should prevent that TypeError uncaught exception. i don't have a yahoo account to test with, sorry!
 added a test just to be sure: https://github.com/segmentio/nightmare/pull/112/files hope that example helps but it seems to work for me
 yeah, that's a different test failing for some weird timeout issue on CI, unrelated
  I tried to add the method myself but i was unsuccessful
.This is the code that I tried to implement in the actions.js file:
exports.viewRect = function(clipRect, done){
  this.page.set('clipRect', clipRect , done);
  console.log(this.page)
};
http://phantomjs.org/api/webpage/property/clip-rect.html as reference .
The object that was passed to the method should look like this:
{
    top: clipRect.top,
    left: clipRect.left,
    width: clipRect.width,
    height: clipRect.height
    };

I'm trying to take a screenshot of a dom element in the page.
I don't know how to access the phantomjs instance so I can add other methods that are available in phantomjs.
 two questions to answer here:
- can we set clipRect just before a `.screenshot()` or does it have to be set at the beginning of a sequence?
- this would be equivalent to cropping the screenshow in post-processing, yeah?
 ok, added in `2.0.2` support for the `clip` parameter: https://github.com/segmentio/nightmare#screenshotpath-clip

open to a pull request for supporting taking a screenshot of a specific dom element
  can you include a few example headers here? thanks
 unfortunately this doesn't appear to be possible upstream in electron https://github.com/atom/electron/blob/master/docs/api/browser-window.md

but if there is a way i'm missing, happy to re-open and implement
  haha, what?
  thanks guys i think it's a weird globals problem, investigating now.
 FWIW you can do `DEBUG=* node test.js` to get full debug output of all the internal logging. that shows a port conflict between the two phantomjs instances, which reveals the two are overwriting each others instances... solution on the way
 fix released with nightmare@1.6.3
 yeah looks like there still needs to be a global port, getting a fix ready now
 fixed that test is passing now :) thanks @pdelanauze shipped with nightmare@1.6.5
  woops, thanks! fixed: https://circleci.com/gh/segmentio/nightmare
  could you include a small example showing how to reproduce this? thanks!
 appears to be fixed when i run the tests as well, let me know if i should reopen.
  prefer bumping the phantom version if that fixes the issue :) thanks so much for investigating. the bumped phantom dep shipped with 1.6.1

let me know if you're still seeing issues here
  nice this is great! thanks john
 released with nightmare@1.6.2
  happy to merge this in if you can include a test as well :) thanks!
 sorry had to make some other improvements to `.visible()` as well to catch non-existent `elem` --- could you rebase?
 potentially interested in pulling this into `2.x` (we have a local testing now), closing but happy to re-open if you want to mirate these changes to local testing + electron!
  filed an issue with sgentle/phantomjs-node since it seems like the callback return value isn't getting passed through to phantomjs
 closing now that we've moved to electron over phantomjs
  no worries glad it's working
  cool idea, makes sense to me, but the PR is incomplete no?
 ah, derp, misread the variable name `args`. yep will test this out soon, thanks!
 released with 1.5.3, thanks!
  can you use the existing `.on()` method? https://github.com/segmentio/nightmare#onevent-callback
 closing for now until we have more info on the use case! seems like `.on()` should work
  This is the code that I used:

code:
var options =  { proxy:'proxyip:proxyport', proxyType:'socks5' };
var Nightmare = require('nightmare');
var nightmare = new Nightmare(options);

nightmare
  .goto('http://www.whatismyip.com/')
  .viewport(500 , 500)
 .screenshot('hasdasda.png')
  .evaluate(function () {
  //  return document;
    return document.getElementsByClassName('the-ip')[0].innerText;
  }, function (res) {
    console.log(res);
  })
  .run(function( err, nightmare){
    console.log("done");
  });

output:
phantom stdout: TypeError: 'undefined' is not an object (evaluating 'document.getElementsByClassName('the-ip')[0].innerText')
null
done
phantom stdout:   phantomjs://webpage.evaluate():3
  phantomjs://webpage.evaluate():6
  phantomjs://webpage.evaluate():6

If I don't use the options object it returns my ip perfectly:
output:
phantom stdout: Error: Cannot find a responsive size for a container of width=0p
x and data-ad-format=auto
phantom stdout:   http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js:
29
  http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js:25
  http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js:34
  http://www.whatismyip.com/:376

my.my.ip.0
done

Another Question that i have is : how can I specify the screenshot path into a folder is it .screenshot('/img/hasdasda.png') ? because it doesn't work :(.

Thank you for your time guys and for this awesome wrapper. 
  thanks all, agree those docs were confusing, updated based on this thread:
https://github.com/segmentio/nightmare/blob/master/Readme.md#evaluatefn-cb-arg1-arg2
  hmmm, i'm not entirely sure without seeing the code and running it myself, but one of the issues i've run into is the difference between (1) a human saying "the page has loaded" and (2) a computer saying "the page has loaded"... i'd make sure you're clicking the submit button after the full page is truly loaded, either with an additional `.wait(ms)` or `.wait(selector)` after `.goto(url)`... it's likely that the page is "done loading" by html onload standards, but that additional javascript needs to load and then override the native onsubmit handler for the form. hope that helps!
 hmmm, one strategy would be to look at the outbound requests:

``` js
var Nightmare = require('nightmare');
goCards = new Nightmare()
    .on('resourceRequested', function (requestData, networkRequest) {
        var url = requestData.url;
        if (
            url.indexOf('cdn-apple') > 0 ||
            url.indexOf('fonts') > 0 ||
            url.indexOf('data:image') === 0 ||
            url.indexOf('securemetrics') > 0) return;
        console.log(requestData.method + ':' + url);
        if (requestData.method === 'POST') console.log(requestData);
    })
    .viewport(800, 1600)
    .goto('https://secure.store.apple.com/us/giftcard/balance')
    ......
```

this produces a nice stream of what requests are being made. based on that it looks like there may be a javascript validation step on the page, and when the pin is invalid it seems to just clear it... could you post your gift card pin obfuscated but still regex-happy so that i can test a request to the server? don't have any apple gift cards lying around...
 could be something funky with ssl as well:

![](https://cldup.com/3J3y64hk-0-3000x3000.png)
 nvm found the client-side regex validator
 ahhhhh, running the nightmare code in the browser directly:
https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L189-L192

you get the same behavior. turns out that the third parameter to `.initEvent(type, bubbles, cancelable)` is preventing Apple from handling the AJAX form as they want to. so it's submitting the url.

i'll ship this fix with 1.5.1 momentarily
 released as 1.5.1, thanks so much for bringing this up!
 https://www.npmjs.org/package/nightmare 5 minutes ago :)
 sorry i didn't read the docs carefully the first time! cheers.
  hmmm, seems like this may be an underlying issue with phantom:
http://stackoverflow.com/questions/13490324/running-phantomjs-node-js-together-on-ubuntu

but i'm seeing the same error with phantomjs 1.9.7.... so maybe this is an issue that just isn't being addressed until 2.0
 leaving similar code on a branch here until we have more info:
https://github.com/segmentio/nightmare/tree/add/debugger
 in `2.x` we've moved from phantomjs to electron, which has fixed a bunch of weird issues. among other things, you can now pass in `{ show: true }` as a constructor argument to just show the window as things are happening.

```
yield Nightmare({ show: true })
        .goto('http://walmart.com/')
        .click(...);
```

hopefully this helps with debugging!
  thanks @Max93! sorry i never got to this with v1... it looks like an interesting abstraction for other events... what events were you interested in? closing for now but may bring the idea into v2 with more info here. thanks!
  @leesei added :)
  released with nightmare@1.6.2
  can we split the uploads file stuff into a separate pull request by itself? it's a good simple fix that we should merge by itself. after that this timeout stuff is also a good direction, but needs some cleanup and merge in a separate pull request.
 cleaned up separately and released as 1.6.0, thanks!
  nice this is really awesome, just a pile of tiny style nits to keep everything consistent and easy to read
  @execmd @fbm-static does this take on the same idea solve the use case as #62? i think it will be easier to abstract engines down the road #60, and hides the specifics of phantomjs for people who find nightmare before they ever try to use phantom :)
 @fbm-static that wouldn't be a good abstraction though, that just reveals all the underlying complexity

@johntitus that sounds reasonable, updated with both of those added
 could you please add `remote-debugger-port` and `remote-debugger-autorun`

http://phantomjs.org/troubleshooting.html
  can read cookies and modify, but can't add new cookies cause I got problem with `this.page.addCookies`

Signed-off-by: TZ atian25@qq.com
 would love to see this in `2.x`: https://github.com/atom/electron/blob/master/docs/api/session.md#methods
 coming through #241 or related
  sweet, excited for when phantomjs 2 merges upstream :)
  thanks!
 released with 1.4.0
  released with 1.4.0
  can we write this in a way to match the way other options are passed?
 yeah phantomjs accepts them differently command line vs. options, but would rather have them as fully-fledged options with defaults so that https://github.com/segmentio/nightmare/issues/60 could work better cross-browser down the road, and so that phantomjs's unique option-passing structure is better abstracted.
 check out #76 to see what i mean as an alternative implementation
 thanks for the concepts here, but going with the implementation in #76, hope it's helpful!
  should be merged soon after the options passing is made to match the existing style!
 released with 1.5.0
  that's an intriguing idea, definitely would be cool for some cross-browser stuff. i assume the use case you've got is around cross-browser testing?
 wrt to #62, all the options appear to have the same names at first glance:
- http://docs.slimerjs.org/current/configuration.html
- https://cloudup.com/c0iFE62qnhx (http://triflejs.org/)
 thanks all, in v2 we decided to go a different direction towards depending on electron. may reconsider down the road.
  Seems like a valid use case. @reinpk Thoughts?
 the underlying problem will be solved in v2.0 shortly by moving to generators + an explicit `.end()` method
  looks good can you squash and rebase?

https://github.com/edx/edx-platform/wiki/How-to-Rebase-a-Pull-Request
  looks good, can you rebase?
  released with 1.4.0
  the variable `page` is not defined in the closure of the second function. if you change it back to `console.log(res);` it should work
 oh woops, sorry about that! fixed in the readme
  as far as i can tell the object is really just `dnode: { weak : true }` right? could we make it a simpler boolean option instead?
 thanks @securingsincity and @fearphage 
  definitely open to a pull request showing how to install phantomjs on another machine. it's just a convenience to help people get started ;)
  rockin test! naming nit and then if you could rebase to master so that i can merge? thanks man, great additions!
 can you rebase to master and squash to a single commit?

https://github.com/edx/edx-platform/wiki/How-to-Rebase-a-Pull-Request
 related to #45
  thanks! i'll touch up the wording locally
  mmm that's cool yeah, can investigate, would be open to a pull request for a `.cookie()` function or something as well
 I will pull this later.
- cookie file should be import by phantom art
- add `cookie(callback)`, then merge callback result to cookie.
 had pull #71 ,  can read cookies and modify, but can't add new cookies cause I got problem with `this.page.addCookies`
 `load  an external file` can use this : #62
 `phantom-node` seems only offer `phantom.addCookie: (name, value, domain, cb=->)` , not `page.addCookie`
1. maybe had to modify `index.js` to set `this.ph=instance`
2. `self.ph.addCookie('test', 'testValue', cookies[0].domain, callback)` seems need `async` to iterator

so wait for @reinpk  ~
  hmmm, boy i dunno. this doesn't seem super promising:
http://stackoverflow.com/questions/22981929/how-to-set-the-browser-language-of-phantomjs

what exactly do you mean by setting the language though?
 mmm, yeah got it. sounds awesome! if there's a good lead on how this could be implemented, can definitely reopen!
  hmmmm, i'm on phantomjs `1.9.7` and don't see this error, could you try updating?
  yep rolling this into #40 for more examples
  ah, yeah i think this is solved by allowing branching through #36, closing here but will consider this use case as well when solving that issue
  should get merged soon after a rebase/squash
 released with 1.4.0!
  ah, phantomjs can be used from the command line, yes. nightmare is used from a javascript program. using nightmare from the command won't work/doesn't make sense.
 it's a javascript library like jquery or angular yep!
  missed this part of the api myself, cool! the resource requested events are super interesting, just a few nits before merging :)
 sweet!
 published with 1.3.0
  ah, that is a good heads up, thanks!
 ah, bummer, not sure i haven't had a chance to investigate 2.0.0 at all yet
  easy peasy haha thanks!
 published with 1.2.0
  --testing (from #47)
 the readme is updated to include a basic testing example with mocha (a test that passes even ;) and i've also added a link to the tests, since the tests contain a complete working example of every method.
  thanks for the simple example! investigating now
 released the fix with 1.1.1, thanks!
  i think this is fundamentally the same problem as #36, but definitely agree this is annoying with the current API. i think if there's an option to avoid teardown of the phantom instance in `.run()` then you can just put it in the callback to `.run()` and then could reinitiate nightmare commands again when necessary.

closing here and keeping #36 as the marker for the issue
  mmm dang yeah need to get the media queries right here, will look into it soon thanks
 fixed in segmentio/nightmarejs.org#a23340b
  yeah this is a great question. maybe `.run()` should have a `keepalive` parameter so that you can do the branching outside the fluent api. definitely agree that branching/looping can be necessary.
 long awaited... but v2 #200 uses generators and an explicit `.end()` method to improve the flow control.
  potentially, there are probably more efficient ways of doing it than phantomjs though. phantom will execute all the js and load all the images, etc. most likely you just need to look at the raw html of the website, which you could do with just an http request.
  this is cool! i think `.inject()` is a cleaner method name, and it would be cool to be able to inject css as well. css wouldn't be a direct translation to a phantomjs method but [it looks doable](http://stackoverflow.com/questions/20950013/phantomjs-inline-html-with-external-css-file)
 this is looking sweet other than a few nits. could you rebase and squash the commits as well? thanks @johntitus!
 thanks @johntitus!
 published with 1.2.0
  ah, yeah it's pulled from a bigger example, sorry will update that now. the `fn` function in the code snippet there is not defined. here's the updated snippet with fix that i'll put in the readme shortly:

``` js
var Nightmare = require('nightmare');
new Nightmare()
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('.searchsubmit')
  .run(function (err, nightmare) {
    if (err) return console.log(err);
    console.log('Done!');
  });
```

Yahoo seems to have nicer named elements for an example, this works for me locally with 1.1.0
 fixed in 3e9573358, thanks!
  derp, thanks!
  super welcome addition once the testing is worked out! if you could rebase and squash actually that would be super nice :)
 if #74 would be the key piece for getting testing in place, let me know, would love to see this added but it'll need a rebase, squash, etc.
 nope, for now these methods this could definitely be tested against something existing and reliable like everything else. i'll get something together today then fix up the commit history.

in the future, if you think it's necessary, i'd definitely be happy to help with something like #74 though!
 this is a mess -- closing and opening a new pr
  dang yeah that's mad annoying. thanks for the heads up, fixed in https://github.com/segmentio/nightmarejs.org/commit/3c7b6193467d9b1cc20c0485dac662c6ba5ab998
  i think i did this because of irregular event triggering by phantomjs, where oftentimes a timeout was a false negative (i.e. everything had worked correctly, but phantom was being uncommunicative).

what's the use case or error you're seeing specifically? i'd like to investigate it more deeply and see if there are some improvements to be made there.
 closing until there's more details, keep me posted!
  interesting! definitely open to a pull request here
 fixed in 1.3.3
  the issue is just that if it's not passed then the callback is undefined but invoked here?
https://github.com/segmentio/nightmare/blob/master/lib/index.js#L56
  what's an example use case for nightmare?
   fixed in e649e5717e8
  thanks! LGTM
  looks good, thanks!
  thanks @queckezz! good idea here, going to eliminate the `done` parameter and just internalize that into the `.use()` method.
 thanks for your help!
  nice thanks!
 published as 0.1.7
  interesting, yeah i'm trying to think through how to embed a bit more logic/branching + the same kind of delayed execution for nightmare-swiftly plugin as well. thanks for the suggestion here, hopefully can work it into some more changes today.
 ok, since normal queued methods just get pushed onto the end, you could have something like this:

``` js
nightmare
  .goto(url)
  .use(tw.login('user', 'pw')
  .screen(path)
  .use(tw.search('503'));
```

If .use() just pushes like a normal queued function, then the actual execution order would get messed up where `screen` came before the both `tw` plugins.

So we'd need to insert the plugins "in place" where the `use` was queued, rather than pushing them on.
  interesting, looks like the wrapper could maintain the order there:
https://github.com/segmentio/nightmare/blob/master/lib/index.js#L167-L168

will investigate tonight!
 thanks! sharp eyes my friend!
  mmm great point, didn't do much diligence on it, but phantomjs-node does look healthier. would definitely accept a pr, otherwise i'll probably hack on it next weekend :D
 good idea, thanks! just merged the change
  thanks @queckezz! just noticed that while i made the changes yesterday i forgot to push (also added `.agent()`) i'll close now that i've pushed/published.
 good idea :)
 dang, yeah i definitely need to fix up the tests. hopefully next weekend as part of the switch to the other phantomjs-node lib
  the problem is throwing the error in the callback or an error happening in evaluating `fn` on the page?
  setting the `viewport` seems similar. at the moment that's an option to the constructor, but i see julian's point and could imagine wanting to change the viewport to check for responsive changes as well.

thinking of adding both as methods:

``` js
Nightmare()
    .agent('chrome')
    .viewport(200, 600)
```
 reopening until the tests are fixed
 works in the proper tests now :)
  i am planning to add a `.run(fn, cb, [args])` method that lets you execute javascript on the page and get back results in a callback, is that the gist of what you're thinking?
 fixed in 0.0.10, cheers!
/n  Can I use Nightmare inside my Electron application? When I simply run
  ```const Nightmare = require('nightmare');

nightmare = Nightmare({show: true});

nightmare
  .goto('https://web.skype.com')
  .type('#username', 'blablabla')
  .wait(30000)
  .end()
  .catch(console.error);
```
I'v got an an error
  ```TypeError: Bad argument
    at ChildProcess.spawn (internal/child_process.js:289:26)
    at Object.exports.spawn (child_process.js:399:9)
    at Nightmare.queue (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:123:22)
    at next (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:341:12)
    at Nightmare.run (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:331:3)
    at /Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:492:10
    at Nightmare.then (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:490:10)
    at Nightmare.catch (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:506:15)
    at Object.<anonymous> (/Users/kissarat/project/app/main.js:21:9)
    at Object.<anonymous> (/Users/kissarat/project/app/main.js:69:3)
```
Is it tricky to rewrite some code to run inside Electron? 
 @stephenmathieson 
I run `DEBUG=nightmare* electron main.js` and I'v got
  ```
  nightmare queuing process start +0ms
  nightmare queueing action "goto" for https://web.skype.com +3ms
  nightmare queueing action "type" +1ms
  nightmare queueing action "wait" +0ms
  nightmare running +4ms
TypeError: Bad argument
    at ChildProcess.spawn (internal/child_process.js:289:26)
    at Object.exports.spawn (child_process.js:399:9)
    at Nightmare.queue (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:123:22)
    at next (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:341:12)
    at Nightmare.run (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:331:3)
    at /Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:492:10
    at Nightmare.then (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:490:10)
    at Nightmare.catch (/Users/kissarat/project/app/node_modules/nightmare/lib/nightmare.js:506:15)
    at Object.<anonymous> (/Users/kissarat/project/app/main.js:30:9)
    at Object.<anonymous> (/Users/kissarat/project/app/main.js:71:3)

```

 Hi, I ran into this problem before and solved it by starting a child process for the nightmare code when it was needed. something like:

//inside electron
document.getElementById("startScraping").addEventListener("click", function () {
    var exec = require('child_process').exec;
    extractorProcess = exec('node your-nightmare-code.js ')
});

check this article for child process usage: http://krasimirtsonev.com/blog/article/Nodejs-managing-child-processes-starting-stopping-exec-spawn  Hi! 
I'd like to be able to control the "download as" popup to select the filename for a downloaded file. I read that it's possible by listening to 'will-download' event. Is it supported by Nightmare? exactly the same problem. it is possible with libraries provided by @rosshinkley 
also things to consider: those libraries (or nightmare or even electron itself), can't handle new window's created dynamically (like `<a target="_blank">`).

for now, I'm trying to get the link of the download (if it's possible) and then create iframe on the document with that download link and append to body, which will trigger will-download on the same window.
 @overflowz, While evaluating, You can just replace the every "_blank"  to have the links open in same page. @entrptaher sometimes it fails to load urls (for example PDF's directly). I don't remember the actual problem, but when I was opening PDF's I was getting errors which I really don't remember.  ```
nightmare
   .goto(anypage)
   .evaluate(function () {
      console.log(1);
   })
   .use(function(callback){
      return function(nightmare) {
         var x = somelib();
         nightmare
            .evaluate(function (x) {
               console.log(x);
            },x)
            .end()
      };})
```



i can get console.log(1) without console.log(x)
if i something wrong?
how can i made this code to running out console.log(x)?
THX! my answer:
1. sometimes i need using 3rd lib to processing what i got. (like graphics captcha etc.)
2. x means the process result (it can be understood here as a verification code), then i'll using the 'x' to fill the form.

in this case (captcha and decode), is there any other way?

```

nightmare
   .goto(anypage)
   .evaluate(function () {
      console.log(1);
   })
   .use(function(callback){
      return function(nightmare) {
         nightmare
            .evaluate(function () {
               console.log(2);
            })
            .end()
      };})
```
i had tried like this, `console.log(2);` still doesn't work
 If you open developer tools in electron, i think, you can see "2" in their js console @nolka it's nothing @rosshinkley  am i wrong?  In case of show: true, the electron window is always on top.
I checked for related issues and couldn't find anything. Is there a reason to keep it this way?
If no, shouldn't it be 'alwaysOnTop: false' by default, or shouldn't there be a way to deactivate it?
  Hi,

I try to render the page http://mar.mil.br/ which contains this html:

```html
<html><head><title>Marinha do Brasil</title>
 
 <meta http-equiv="refresh" content="1;url=&quot;https://www.marinha.mil.br/&quot;">
 </head>
 <body>
 
 </body></html>
```

However I have a `wait(5000)` in my code and it never ends. Which doesn't happen if I use `wait(800)`.

Logs with wait 800:

```
  nightmare queuing process start +0ms
  nightmare queueing child action addition for "getResources" +1ms
  nightmare queueing child action addition for "getHAR" +0ms
  nightmare queueing child action addition for "waitForDevtools" +0ms
  nightmare queueing action "waitForDevtools" +0ms
  nightmare queueing action "useragent" +1ms
  nightmare queueing action "viewport" +0ms
  nightmare queueing action "authentication" +0ms
  nightmare queueing action "goto" for http://mar.mil.br/ +0ms
  nightmare running +0ms
  electron:stderr Gtk-Message: Failed to load module "canberra-gtk-module" +110ms
  nightmare:log adding action for getResources +397ms
  nightmare:log adding action for getHAR +1ms
  nightmare:log adding action for waitForDevtools +1ms
  nightmare:actions .useragent() to Mozilla/5.0 +573ms
  nightmare:actions .viewport() +2ms
  nightmare:actions .authentication() +1ms
  nightmare:log Navigating: "http://mar.mil.br/",
  nightmare:log             headers: [none],
  nightmare:log             timeout: 60000 +3ms
  nightmare:log did-start-loading [{}] +22ms
  nightmare:log did-get-response-details [{},false,"http://mar.mil.br/","http://mar.mil.br/",200,"GET","",{"accept-ranges":["bytes"],"connection":["Keep-Alive"],"content-length":["156"],"content-type":["text/html"],"date":["Mon, 20 Mar 2017 08:53:07 GMT"],"etag":["\"c2a001-9c-5388f20a953c0\""],"keep-alive":["timeout=15, max=100"],"last-modified":["Tue, 26 Jul 2016 19:44:23 GMT"],"server":["Apache"]},"mainFrame"] +1s
  nightmare:log dom-ready [{}] +99ms
  nightmare:log did-frame-finish-load [{},true] +0ms
  nightmare:log did-finish-load [{}] +0ms
  nightmare:log page-favicon-updated [{},["http://mar.mil.br/favicon.ico"]] +1ms
  nightmare:log did-stop-loading [{}] +1ms
2017-03-20T08:53:14.942Z - debug: http://mar.mil.br/ : goto result: 
{ url: 'http://mar.mil.br/',
  code: 200,
  method: 'GET',
  referrer: '',
  headers: 
   { 'accept-ranges': [ 'bytes' ],
     connection: [ 'Keep-Alive' ],
     'content-length': [ '156' ],
     'content-type': [ 'text/html' ],
     date: [ 'Mon, 20 Mar 2017 08:53:07 GMT' ],
     etag: [ '"c2a001-9c-5388f20a953c0"' ],
     'keep-alive': [ 'timeout=15, max=100' ],
     'last-modified': [ 'Tue, 26 Jul 2016 19:44:23 GMT' ],
     server: [ 'Apache' ] } }
  nightmare queueing action "wait" +4ms
  nightmare running +0ms
  nightmare:actions .wait() for body element or 5000msec +1ms
  nightmare queueing action "wait" +1ms
  nightmare running +0ms
  nightmare:actions .wait() for 800ms +0ms
  nightmare queueing action "evaluate" +802ms
  nightmare running +1ms
  nightmare:actions .evaluate() fn on the page +0ms
  nightmare running +3ms
  nightmare electron child process exited with code 0: success! +96ms
```

And with wait 1000:

```
  nightmare queuing process start +0ms
  nightmare queueing child action addition for "getResources" +0ms
  nightmare queueing child action addition for "getHAR" +1ms
  nightmare queueing child action addition for "waitForDevtools" +0ms
  nightmare queueing action "waitForDevtools" +0ms
  nightmare queueing action "useragent" +1ms
  nightmare queueing action "viewport" +0ms
  nightmare queueing action "authentication" +0ms
  nightmare queueing action "goto" for http://mar.mil.br/ +0ms
  nightmare running +0ms
  electron:stderr Gtk-Message: Failed to load module "canberra-gtk-module" +72ms
  nightmare:log adding action for getResources +400ms
  nightmare:log adding action for getHAR +0ms
  nightmare:log adding action for waitForDevtools +1ms
  nightmare:actions .useragent() to Mozilla/5.0 +490ms
  nightmare:actions .viewport() +5ms
  nightmare:actions .authentication() +1ms
  nightmare:log Navigating: "http://mar.mil.br/",
  nightmare:log             headers: [none],
  nightmare:log             timeout: 60000 +4ms
  nightmare:log did-start-loading [{}] +12ms
  nightmare:log did-get-response-details [{},false,"http://mar.mil.br/","http://mar.mil.br/",200,"GET","",{"accept-ranges":["bytes"],"connection":["Keep-Alive"],"content-length":["156"],"content-type":["text/html"],"date":["Mon, 20 Mar 2017 08:58:30 GMT"],"etag":["\"c2a001-9c-5388f20a953c0\""],"keep-alive":["timeout=15, max=100"],"last-modified":["Tue, 26 Jul 2016 19:44:23 GMT"],"server":["Apache"]},"mainFrame"] +909ms
  nightmare:log dom-ready [{}] +96ms
  nightmare:log did-frame-finish-load [{},true] +0ms
  nightmare:log did-finish-load [{}] +0ms
  nightmare:log page-favicon-updated [{},["http://mar.mil.br/favicon.ico"]] +1ms
  nightmare:log did-stop-loading [{}] +1ms
2017-03-20T08:58:37.859Z - debug: http://mar.mil.br/ : goto result: 
{ url: 'http://mar.mil.br/',
  code: 200,
  method: 'GET',
  referrer: '',
  headers: 
   { 'accept-ranges': [ 'bytes' ],
     connection: [ 'Keep-Alive' ],
     'content-length': [ '156' ],
     'content-type': [ 'text/html' ],
     date: [ 'Mon, 20 Mar 2017 08:58:30 GMT' ],
     etag: [ '"c2a001-9c-5388f20a953c0"' ],
     'keep-alive': [ 'timeout=15, max=100' ],
     'last-modified': [ 'Tue, 26 Jul 2016 19:44:23 GMT' ],
     server: [ 'Apache' ] } }
  nightmare queueing action "wait" +6ms
  nightmare running +0ms
  nightmare:actions .wait() for body element or 5000msec +0ms
  nightmare queueing action "wait" +1ms
  nightmare running +0ms
  nightmare:actions .wait() for 1000ms +1ms
  nightmare:log will-navigate [{},"https://www.marinha.mil.br/"] +984ms
  nightmare:log did-start-loading [{}] +3ms
  nightmare:log waiting for window to load... +13ms
  nightmare:log did-get-response-details [{},false,"https://www.marinha.mil.br/","https://www.marinha.mil.br/",200,"GET","http://mar.mil.br/",{"cache-control":["public, max-age=180"],"connection":["close"],"content-encoding":["gzip"],"content-language":["pt-br"],"content-type":["text/html; charset=utf-8"],"date":["Mon, 20 Mar 2017 08:58:40 GMT"],"etag":["\"1489999225-1\""],"expires":["Sun, 19 Nov 1978 05:00:00 GMT"],"last-modified":["Mon, 20 Mar 2017 08:40:25 GMT"],"link":["<https://www.marinha.mil.br/>; rel=\"canonical\",<https://www.marinha.mil.br/>; rel=\"shortlink\",<https://www.marinha.mil.br/sites/default/files/favicon_0.ico>; rel=\"shortcut icon\""],"server":["Apache"],"transfer-encoding":["chunked"],"vary":["Cookie,Accept-Encoding"],"x-content-type-options":["nosniff"],"x-drupal-cache":["HIT"],"x-frame-options":["SAMEORIGIN"],"x-generator":["Drupal 7 (http://drupal.org)"]},"mainFrame"] +2s
  nightmare:log did-get-response-details [{},false,"https://www.marinha.mil.br/modules/system/system.base.css?omgpku","https://www.marinha.mil.br/modules/system/system.base.css?omgpku",200,"GET","https://www.marinha.mil.br/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["5428"],"content-type":["text/css"],"date":["Mon, 20 Mar 2017 08:58:41 GMT"],"etag":["\"1534-5478153edcd00\""],"expires":["Mon, 03 Apr 2017 08:58:41 GMT"],"last-modified":["Thu, 02 Feb 2017 00:34:28 GMT"],"server":["Apache"],"x-content-type-options":["nosniff"]},"stylesheet"] +1s
...
```

I don't put the whole log because it never ends. I also tried to set `waitTimeout` to 1200, but my wait doesn't timeout.

The code I'm using is able to render plenty of other pages without any problem. This is the first time I have this issue with a wait being ignored. My evaluate is

```
  .evaluate(() => {
    return document.documentElement.outerHTML
  })
```

I have a catch block, but it doesn't reach this block. It loops forever.  Is it possible for Nightmare (or by any other means E.g. JavaScript) to manipulate (inline or external) CSS styles, either before or after loading a web page?

Below is an example of what I'm looking to achieve. If a CSS rule contains the `custom-property` I'd like to duplicate or alter the property name to become `new-property`.

```
.some-class-name
{
    custom-property: rgba(0, 0, 255, 0.3);
}
```

```
.some-class-name
{
    new-property: rgba(0, 0, 255, 0.3);
}
``` @rosshinkley thanks for the reply. I ended up making a simple example outside of Nightmare using JavaScript to manipulate the styles loaded in the DOM. The problem I encountered was that custom property names and values (which are not part of the CSS spec) are never loaded in the first place.

I did come up with a hack for property names, that was to prefix them with double hyphens.

  Version:
`"nightmare": "^2.10.0",`

**Problem**:
I'm clicking button continue, after which I should be redirected, this works sometimes, but sometimes I see next error:
```
Search failed: Error: .wait() timed out after 30000msec
    at Timeout._onTimeout (/Users/apple/Developer/onetwothree/node_modules/nightmare/lib/actions.js:453:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)
```
my code part:
```
    return nightmare
      .type('#ap_customer_name', account_name)
      .type('#ap_email', email)
      .type('#ap_password', password)
      .type('#ap_password_check', password)
      .click('#continue')
      .wait('.nav-line-1');
  })
  .then(() => {
    return nightmare
      .evaluate(() => {
        return Array
          .from(document.querySelectorAll('.nav-line-1'))
          .map(element => element.innerText);
      });
  })

``` Open the electron browser and run it a couple of times like so: 
```js
nightmare({
            show: true,
            width: 1280,
            height: 800
})
```

You probably have to wait for form element to be loaded before you can actually type into the fields. 
More like than not there some lag and your nightmare execution is faster and it skips all the way to the wait action. 

or better yet just wait for each field before your type()
```
.wait('#ap_customer_name')
.type('#ap_customer_name', account_name)
```
 @chtrinh I **waited already after click on submit for new element on page**

> or better yet just wait for each field before your type()

Not relevant to the issue
 What @rosshinkley said might be the issue.

> I waited already after click on submit for new element on page

@mymtwcom: Is the form async loaded? That is what i was referring to. DOM elements might not be settled and you need to wait for it. 

 @rosshinkley yes, I used `show: true`. I used asserts that to know, that I'm currently on page that I need.
`CAPTCHA`: No there no was captcha, cuz I used `show: true` that to make sure.
read again plz my **problem** from issue:

I'm clicking button continue, after which I should be
 redirected, **this works sometimes, but sometimes I see** next **error**

Maybe my code will help to anybody reproduce the issue, there are used temporary proxy server also(I will disable him if issue will be reproduced).
```
  "dependencies": {
    "chai": "^3.5.0",
    "nightmare": "^2.10.0",
    "randomstring": "^1.1.5"
  }
```
code: 
```
const assert = require('chai').assert,
      randomstring = require('randomstring'),
      Nightmare    = require('nightmare');

var nightmare = Nightmare({
  show: false,
  switches: {
    'proxy-server': 'socks5://52.87.57.201:9050',
    'ignore-certificate-errors': true
  }
});

const USER_AGENTS = [
  'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:51.0) Gecko/20100101 Firefox/51.0',
  'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.110 Safari/537.36',
  'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36',
];

const ua = USER_AGENTS[Math.floor(Math.random() * USER_AGENTS.length)];

console.log(ua);
const account_name = randomstring.generate({
  capitalization: 'lowercase',
  length: 10,
});

const email = `${randomstring.generate({
  capitalization: 'lowercase',
  length: 8
})}@gmail.com`;

const password = 'zdes23dsksfzz';

nightmare
  .useragent(ua)
  .authentication('lyft', 'Bbm7XSdP0KJi')
  .goto('https://www.amazon.com/')
  .title()
  .then((title) => {
    console.log(title);
    return nightmare
      .click('#nav-link-accountList')
      .title()
  })
  .then((title) => {
    console.log(title);
    assert.equal(title, 'Amazon Sign In')

    return nightmare
      .click('#createAccountSubmit')
      .title();
  })
  .then((title) => {
    console.log(title);
    assert.equal(title, 'Amazon Registration');

    return nightmare
      .type('#ap_customer_name', account_name)
      .type('#ap_email', email)
      .type('#ap_password', password)
      .type('#ap_password_check', password)
      .click('#continue')
      .wait('.nav-line-1');
  })
  .then(() => {
    return nightmare
      .evaluate(() => {
        return Array
          .from(document.querySelectorAll('.nav-line-1'))
          .map(element => element.innerText);
      });
  })
  .then((userGreetings) => {
    const greeting = `Hello, ${account_name}`;

    console.log(greeting);
    assert.include(userGreetings, greeting, 'array contains value');
  })
  .then(() => {
    // queue ending the Nightmare instance along with the Electron instance it wraps
    // again, return the instance to leverage the internal `.then()`
    console.log('Done');
    return nightmare.end();
  })
  .catch((error) => {
    console.error('Search failed:', error);
  });
``` @chtrinh trouble not in registration form. Trouble with waiting for new page DOM loading @mymtwcom: again... `.wait('#ap_customer_name')` sometimes your form will load before you execute `type()`and since `type()` doesn't raise an exception you'll just hit `.wait('.nav-line-1')` and timeout. Nowhere in the code snippet are you waiting for the `<form>` to be load on the DOM. 

So sometimes you get lucky and sometimes you don't and your test fails.. which is the behavior you are seeing. 
  Hi,

I'm trying to save a page as PDF, everything works fine except for the size: even choosing A4 size, my output pdf looks like zoomed-in.

```
nightmare
    .goto(url)
    .wait()
    .pdf(output, {
        pageSize: 'A4',
    })
    .end()
    .then(function (result) {
        console.log('PDF File Generated successfully.');
    })
    .catch(function (error) {
        console.error('Search failed:', error);
    });
```

When I print the same example on Chrome, it scale is fine.
I'm pretty sure that I've seen a issue of this, but cannot found anymore!  hi guys, the issue is about creating a custom preload script to hook alert message or confirm dialog from browser.
main.js :
```
var Nightmare = require('nightmare'),
  nightmare = Nightmare({
    openDevTools: {
      mode:'detach'
    },
  show: true,
  webPreferences: {
        devTools: true,
        preload: 'alertMessage.js',
        nodeIntegration: false,
        webSecurity: false,
        allowRunningInsecureContent: true
      }
});
  
nightmare.useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3015.0 Safari/537.36');

nightmare.goto('http://www.google.com')
  .then(function() {
	return nightmare.url();  
  })
  .then(u => {
	  console.log('The url is: ' + u);
  });

```

alertMessage.js (not do anything yet):
```
window.__nightmare = {};
__nightmare.ipc = require('electron').ipcRenderer;
```

However, i got an error like:
```
Uncaught TypeError: Cannot read property 'nightmare' of undefined
  javascript @ VM106:3
  (anonymous function) @ VM106:38
  electron.ipcRenderer.on @ init.js:51
  emitMany @ events.js:127
  emit @ events.js:201
```

Any ideas, I am appreciated.
Thanks, Use `path` module to solve your issue. The reason is your preload script is not getting proper paths while running in the browser unless specified.

```js
var Nightmare = require('nightmare'),
    path = require('path'), // ADD THIS
    nightmare = Nightmare({
        show: true,
        webPreferences: {
            preload: path.resolve('preload.js') // USE PATH.RESOLVE FUNCTION
        }
    });
``` hi  @entrptaher,

Thanks for your reply. Actually, the source code is to simplify the path. The thing is the script is able to load but get some issue with 'nightmare' which is inside the ```alertMessage.js```

Any other idea, thanks. Well, I just gave you the idea. Simplify the path and it'll load without errors. I'm going to second @entrptaher's solution.  The preload option gets passed as an option to the initialization of electron's browser window.  As documented [here](https://github.com/electron/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions): "The value should be the absolute file path to the script."  While it may appear that the script is loading properly because the error is showing up in the electron console, no script is getting loaded which breaks nightmare since it is requiring those two lines of preload script.    nightmare fails when image files are there for a web page on headless linux. When <img> tags removed it works normally.

So for continuous integration  i am using ```{webPreferences: {images: false}}``` . 

Any better way or configuration to solve this problem.  When I makes many nightmares, they are on one process, so I end one, they all end.  I am getting this error, is it possible to get more information where it happens? I just discovered I can debug with `set DEBUG=nightmare & node spider.js`, but already don't have enough information to fix the issue. Any ideas?

       nightmare queuing process start +0ms                                                                                        
       nightmare queueing action "goto" for http://www.google.com +10ms                                                            
       nightmare queueing action "type" +23ms                                                                                      
       nightmare queueing action "click" +0ms                                                                                      
       nightmare queueing action "wait" +1ms                                                                                       
       nightmare queueing action "evaluate" +0ms                                                                                   
       nightmare running +1ms                                                                                                      
       nightmare electron child process exited with code 0: success! +5s                                                           
     (node:7912) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): Cannot read property 'focus' of null                                                                                                                            usually happens when you select something that doesn't exist / can't be "focused" on. You also didn't have a catch clause after your then.

Would be much better if you post code instead of just the error. It's trivial. We can help you more if we see some snippets. In your JS console, on this very page, try:

```js
document.querySelector('figure').focus() //throws Uncaught TypeError: Cannot read property 'focus' of null
``` `type` was calling `focus`, I realized that because I run an example and make it fail on wait, evaluate, click, type and goto. I got the focus error when `type` error was introduced. So, my problem is solved, but I don't know how I can see the full stack trace, it would have helped a lot.   Can you try the following code and see when it's getting stuck?
 - `npm install --verbose --save nightmare`

Also, you can try other package managers/wrappers like `yarn` 
and run either of the following commands, 
 - `yarn add nightmare`
 - `yarn add --verbose nightmare`

You don't have to share the whole log directly, you can see where it gets stuck and tell us.  subj  I have a code:
```
await n.wait((s) => { return (document.querySelector(s) ? true : false) },s1);
```
The element with selector `s1` is not present on the page when the `wait` is called, the `fn` each time it polls returns `false`. Then, when the element with `s1` selector added, `fn` returns `true` and poll for `fn` stops, but after that the `wait` fails with timeout. I expected that after `fn` return `true` the `wait` will continue successfully. Same with `wait(s1)`.  I am opening 2 instances under the same "partition" string, note I am not using persist: but reading nightmare and electron docs, equal partition should be enough to share session

What's happening is - If I print cookies I see both share the same cookies, but If I do something like adding to cart in an ecommerce website:

**What I expect**: both windows to show item in cart, like if I had 2 chrome tabs on the same ecommerce website

**What I get**: even though on the same partition, one window shows the item in cart, the other shows an empty cart


```
var browser1 = Nightmare({
        show: false,
        alwaysOnTop: false,
        webPreferences: {
            partition: "test"
        }
});
var browser2 = Nightmare({
        show: false,
        alwaysOnTop: false,
        webPreferences: {
            partition: "test"
        }
});

```

If it helps the 2 browsers aren't being created at the same time, but with a few minutes difference. 

I'd appreciate any feedback if anyone has some, thanks Too many bugs stating the same problem, yet not fixed properly,
https://github.com/segmentio/nightmare/issues?utf8=%E2%9C%93&q=persist, https://github.com/segmentio/nightmare/issues/1024 and more.

I'm replying with additional test information on par with the OP provided details.

```js
var Nightmare = require('nightmare');

var browser1 = Nightmare({
    show: true,
    alwaysOnTop: false,
    webPreferences: {
        partition: "persist: test"
    }
});
var browser2 = Nightmare({
    show: true,
    alwaysOnTop: false,
    webPreferences: {
        partition: "persist: test"
    }
});

setTimeout(() => {
    browser1
        .authentication("user", "passwd")
        .goto("https://httpbin.org/basic-auth/user/passwd")
        .screenshot('test-1.png')
        .then(() => {
            console.log('done 1')
        })
}, 0)

setTimeout(() => {
    browser2
        //.authentication("user", "passwd")
        .goto("https://httpbin.org/basic-auth/user/passwd")
        .screenshot('test-2.png')
        .then(() => {
            console.log('done 2')
        })

}, 3000)

```

This code is supposed to persist, but the first window returns the desired output, second one remains empty.
 also getting the same issues with similar code Okay, so I tried this and it did not work. Yes, the whole session and cookies was supposed to work.

Tried putting them into separate files. Did not work, tried in same file, did not work.
```js
var Nightmare = require('nightmare');

setTimeout(() => {
    var browser1 = Nightmare({
        show: false,
        alwaysOnTop: false,
        webPreferences: {
            partition: "persist: test"
        }
    });
    
    browser1
        .authentication("user", "passwd")
        .goto("https://httpbin.org/basic-auth/user/passwd")
        .screenshot('test-1.png')
        .evaluate(()=>{
          return document.body.innerText
        })
        .end()
        .then((result) => {
            if(result == "") {
              console.log('result 1 is empty')
            } else{
              console.log(`result 1 ${JSON.parse(result)}`)
            }
        })
}, 0)

setTimeout(() => {
    var browser2 = Nightmare({
        show: false,
        alwaysOnTop: false,
        webPreferences: {
            partition: "persist: test"
        }
    });

    browser2
        //.authentication("user", "passwd")
        .goto("https://httpbin.org/basic-auth/user/passwd")
        .screenshot('test-2.png')
        .evaluate(()=>{
          return document.body.innerText
        })
        .end()
        .then((result) => {
            if(result == "") {
              console.log('result 2 is empty')
              } else{
              console.log(`result 2 ${JSON.parse(result)}`)
            }
            
        })

}, 5000)
```

result

```
> node test.js
result 1 [object Object]
result 2 is empty
```

It might be a bug?  Now that node natively supports async/await (!) we can probably remove the internal queueing system and just have the actions return promises.

This would definitely be a breaking change but *should* allow for more concurrency, so you could do things like this:

```js
async function main () {
  const page = await nightmare.goto("https://google.com")
  const screens = [ ... ] 
  const screenshots = await Promise.all(screens.map(function (s) {
     return page.viewport(s.width, s.height).screenshot(s.output)
  })
}

main()
  .then(console.log)
  .catch(console.error)
```  I'm working on an app that automates logins. I've noticed that when nightmare/electron navigates to Zapier, https://zapier.com/app/login, the renderer process continues to increase its memory use, even when there is no navigation, and the process should be idling.

Nightmare v2.9.1. I've run it both with the prebuilt electron binary and manually setting the electronPath to a new version, but the issue persists.

I don't know whether this is a Nightmare issue or an Electron issue, so I'd be interested to hear whether anyone can provide some insight into it, and whether it can be replicated. The same issue doesn't seem to happen in Chrome. I should also note that the bleed is quite fast: the usage seems to grow ~100M every few seconds. Is there any good workaround for this issue, or is it just the case that some sites are going to suck?

I mean, worst case scenario, I can arrange to kill any electron processes that get to memory hungry, but I would prefer something more elegant.

Thanks for the quick response, by the way. I really appreciate all the work you've done on this project! I tried to reproduce the effect yesterday after AWS went down, but was not able. Then I tried again this morning, and I could reproduce it. I've tried changing some of the options, namely, turning `show` and  `offscreen` to false, but the leak persists. Nevertheless, I'm going to include my default options, just for completeness.

```
'use strict';

const Nightmare = require('nightmare');
const nightmare = Nightmare({
    alwaysOnTop: false,
    dock: true,
    show: true,
    width: 1440,
    height: 1080,
    openDevTools: true,
    switches: {
        'enable-logging': true
    },
    webPreferences: {
        partition: 'nopersist',
        webSecurity: false,
    }
});

return nightmare
    .goto('https://zapier.com/app/login')
    .then(() => {
        console.log('Now we wait...');
    })
    .catch((err) => {
        console.log(err);
    });
``` I take it that you haven't been able to replicate, and after having tried to replicate it for several days in a row without success, I'm about to give up.

My inclination at this point is to let Nightmare/Electron run every once in a while, and periodically check to see if the leak reoccurs. I would welcome any thoughts on best methods to log and debug any leaks in the future. Haven't been able to reproduce. I'm going to go ahead and close this.  The window opened by parent webpage are not inherited the proxy and authentication settings the parent has, so 401 is shown.

        nightmare
	      .authentication(username, password)
	      .goto(url + '/Login.aspx')
		  .click('#MenuReport')
		  .click('#MenuMain_lbRpt')
		  .wait(2000)
		  .type('#ucDateFrom_txtDate','01-08-2016')
		  .type('#ucDateTo_txtDate','31-08-2016')
		  .click('#btnGenerate')
          .catch(done)

The popup has return 401.  https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/nightmare/index.d.ts

Who, Update, Help!  First off, I have to thank everyone who has worked on nightmare! Coming from phantom, it's been such a relief and pleasure to use so far.

I'm currently working a project that performs a kind of breadth-first graph traversal to find broken links. I am creating (for now) eight Nightmare instances that make parallel/concurrent requests to perform the traversal. It works very well at the beginning, visiting about 210-220 links per minute. It pretty evenly slows down from there until about 800 links have been traversed. Around 800 links, even though the instances are explicitly created with `show: false`, the processes begin to show (windows pop up), and once the windows pop up, those Nightmare instances seem to be hung.

First, I create workers:

```javascript
const generateWorkers = (number) => {
  const workers = {};
  for (let i = 0; i < number; i += 1) {
    const nightmare = Nightmare({
      show: false,
      pollInterval: 50,
      webPreferences: {
        partition: `persist: logged in`
      }
    });
    workers[i] = nightmare;
  }
  return workers;
}
//...
const workers = generateWorkers(8);
```

Then I define a `login` function:

```javascript
const nightmare = Nightmare({
  show: true,
  pollInterval: 50,
  webPreferences: {
    partition: 'persist: logged in'
  }
});

const login = async () => {
  try {
    return await nightmare
      .goto('https://github.com/login')
      .wait(function () {
        const url = document.URL;
        return url === 'https://github.com/';
      })
      .end()
  } catch(e) {
    console.log(e);
  }
};
```

Then I put it all together:

```javascript
login()
  .then(() => {
    const startTime = new Date();
    const handleWorkers = setInterval(() => {
      if (availableWorkers.length > 0 && linkQueue.length > 0) {
        const freeWorker = availableWorkers.dequeue();
        displayLinkData(startTime, freeWorker);
        const currentLink = linkQueue.dequeue();
        visitAndScrapeLinks(currentLink, freeWorker)
          .then((links) => {
            if (!links) {
              availableWorkers.enqueue(freeWorker);
              return;
            }
            links.forEach((link) => {
              linkQueue.enqueue(link);
            });
            availableWorkers.enqueue(freeWorker);
          })
          .catch(() => {
            availableWorkers.enqueue(freeWorker);
            return;
          });
      }
      if (linkQueue.length > 0 && availableWorkers.length === 8) {
        clearInterval(handleWorkers);
      }
    }, 50);
  });
```

I'm assuming that this is a memory issue. However, I thought that creating the Nightmare instances a single time at the beginning would prevent this kind of issue. Is this issue related to the fact that all of the instances share a single partition? Perhaps the accumulated cookies/local storage becomes too much to handle? If that's the case, is there a better way to handle the initial login and/or partitioning? Would it be helpful to, every so often, call `end()` on the Nightmare instances and create new ones? I'm new to `electron` and`nightmare`, so any help moving forward would be much appreciated! I just ran another test. When I use 20 workers, I get significantly further, but the processes all eventually hang. This time I got to this point (in my custom logs):

```
Visited 1409 links.
407 links remaining.
(averaging 128.2 per minute)
(averaging 6.17 seconds per request)
there are currently 0 broken links
there are currently 20 workers
```

Looking at activity monitor, I'm going from about 7gb of used memory to 14gb of used memory by the end (out of my total of 16gb). This seems to confirm that it is indeed a memory issue. @louisscruz I'm just curious - what happens if you use different partitions? In your code, e.g.:

```js
const generateWorkers = (number) => {
  const workers = {};
  for (let i = 0; i < number; i += 1) {
    const nightmare = Nightmare({
      show: false,
      pollInterval: 50,
      webPreferences: {
        partition: `persist: ${uuid.v4()}`
      }
    });
    workers[i] = nightmare;
  }
  return workers;
}
//...
const workers = generateWorkers(8);
```

Would this consume more memory, or will it actually cause some speed up due to a separation of shared storages? @jekku When the partition name doesn't match the partition name of the initial login instance it can't proceed. This might be a different kind of issue. Here's an update:

I've completely refactored my code and simultaneously set it so that the workers `end()` after a certain number of requests and are replaced by new instances. I figured that this would help out if there were some kind of a memory issue. However, it definitely didn't. Even when it is the case that there are fewer links and/or the ordering of the traversal changes, I can't make it through the traversal. It tends to hang around this point:

```
60 links remaining.
(averaging 138.39 links per minute)
(averaging 4.96 seconds per request)
there are currently 4 broken links
there are currently 24 workers
Visited 499 links.
```

The last time I ran it, it appeared that when the windows pop up, there are some dialogues for selecting a download location for zip files. Some of the links that are traversed are apparently links for zip downloads. Is there any way to configure Nightmare to ignore these sorts of URLs? Or is that something that has to be done manually in my algorithm? I'd really like to test this out...

By the way, I haven't even had a chance to really optimize my crawler yet, but I'm getting about 280 - 300 link traversals per minute without distribution. Nightmare is fast! I am very interested in your crawler with Electron/Nightmare . Do you share your code? @LeMoussel Here's my project: https://github.com/louisscruz/hub-crawl @rosshinkley Thanks for that! I'll give that a shot later today. @rosshinkley Wow, your `nightmare-download-manager` did it! It no longer hangs with the `ignoreDownloads: true`.

There is still a drastic slowdown in performance throughout my crawler's run. With 24 workers, my last run, which was about 10 minutes long, started around 240 links per minute and ended at 110 links per minute. I'm curious how the shared session/partition affects this.

Anyways, my original issue is cleared up. I hope this helps someone else!  Is there any way to take s screenshot in jpg format returning to buffer? It is possible to specify format in path, but I don't want to save screenshot on disk.  It say how right in the doc.
https://github.com/segmentio/nightmare#user-content-screenshotpath-clip > If path is provided, it saves the image to the disk

>> I don't want to save screenshot on disk > If path is provided, it saves the image to the disk. **Otherwise it returns a Buffer of the image data.**  I'm trying to send a pdf back as a buffer throught an express route, but I get an error and I'm pretty sure I'm doing this correctly.

here my code:

```Javascript
  nightmare
    .goto('http://www.pdfreactor.com/product/samples/invoice/invoice.html')
    .wait()
    .pdf({
      pageSize: 'A4',
      printBackground: true
    }, function(err, data){
      console.log(err);
      console.log('welp');
      res.contentType("application/pdf");
      res.send(data);
    })
    .end()
    .then(function (result) {
      console.log(result);
    })
    .catch(function (error) {
      console.error('failed:', error);
    });
```

```
I get this error:
TypeError: path must be a string or Buffer
    at TypeError (native)
    at Object.fs.open (fs.js:631:11)
    at Object.fs.writeFile (fs.js:1303:6)
    at /Users/myUsername/myProject/node_modules/nightmare/lib/actions.js:657:15
    at EventEmitter.<anonymous> (/Users/myUsername/myProject/node_modules/nightmare/lib/ipc.js:93:18)
    at EventEmitter.g (events.js:291:16)
    at emitTwo (events.js:106:13)
    at EventEmitter.emit (events.js:191:7)
    at ChildProcess.<anonymous> (/Users/myUsername/myProject/node_modules/nightmare/lib/ipc.js:49:10)
    at emitTwo (events.js:106:13)
    at ChildProcess.emit (events.js:191:7)
    at process.nextTick (internal/child_process.js:744:12)
    at _combinedTickCallback (internal/process/next_tick.js:67:7)
    at process._tickCallback (internal/process/next_tick.js:98:9)
[nodemon] app crashed - waiting for file changes before starting...
```

If I look inside actions.js it seem like it should go throught the second condition and set path as undefined and then this should call done() with a buffer instead of calling fs.writeFile and return and error because path is undefined.

Is it an error or am I missing something?


 don't know if it's a premise thing, but there a function in the third parameter. If I log arguments I get three thing even tho I'm only passing 2.

```
{ '0': { pageSize: 'A4', printBackground: true },
  '1': [Function],
  '2': { [Function: f] called: false } }
```

I fixed it for now by passing false as a third parameter so it push that weird function.

```Javascript
    .pdf({
      pageSize: 'A4',
      printBackground: true
    }, function(err, data){
      console.log(err);
      console.log('welp');
      res.contentType("application/pdf");
      res.send(data);
    },
    false)
```
```
{ '0': { pageSize: 'A4', printBackground: true },
  '1': [Function],
  '2': false,
  '3': { [Function: f] called: false } }
``` Make sense, thanks for the help.

I'll close this later after testing it.  for the last 15 + minutes, nothing is updating or changing . 

![image](https://cloud.githubusercontent.com/assets/1026325/23325720/849d795c-fac5-11e6-91e1-d91d7fc1ab91.png)


![image](https://cloud.githubusercontent.com/assets/1026325/23325729/8eb6f102-fac5-11e6-81f2-d85096407d52.png)
 yes it strated working  thx   I am getting this error the when visiting certain sites like:

http://www.footlocker.com/product/model:236830/sku:S80686/adidas-ultra-boost-womens/
http://www.basspro.com/Lowrance-Hook4-Fishfinder/Chartplotter-with-Nautic-Insight-Pro-and-Cover/product/175348/
 It's strange.  I can visit the sites using Chrome, or Firefox.

The error is this:

earch failed: { message: 'navigation error',
  code: -138,
  details: 'ERR_NETWORK_ACCESS_DENIED',
  url: 'http://www.footlocker.com/product/model:236830/sku:S80686/adidas-ultra-boost-womens/' } Other sites work.

https://www.bedbathandbeyond.com/store/product/samsonite-reg-aspire-xlite-21-5-inch-spinner-in-black/1060001276?categoryId=12325 I think this is our network @ work.  I tried at home and had no problem.  Thanks for responding so quickly.  Hi, I'm new with Nightmare and I need a help.

I have a feature in my website that load more posts, 5 in 5. I need a way to click the button that load more posts, until it hide from my screen. Everytime that I click, it load more 5 posts. After all posts are loaded, it hide from my screen.

Is it possible to simulate this feature?

Thanks  OS Centos
node version 4.0.0-pre
nightmarejs latest version

`# DEBUG=nightmare:*,electron:* node --harmony example.js`
`**electron:stderr /tmp/phantomjs/phantomjs-2.1.1-linux-x86_64/node_modules/nightmare/node_modules/electron/dist/electron: error while loading shared libraries: libXss.so.1: cannot open shared object file: No such file or directory +0ms**
`

How do I fix this error? @StanleyMilligan you need to use `Xvfb`, as explained on:
* https://github.com/segmentio/nightmare/issues/224
* https://github.com/segmentio/nightmare/issues/892  [Please see this stackoverflow question](http://stackoverflow.com/questions/42398621/handle-multiple-users-requests-to-multiple-remote-web-forms-using-phantomjs?noredirect=1#comment71969732_42398621) It works. Thank you.  I'm trying to diagnose an error on our continuous build server, and seeing the Electron console would really help. It appears that Nightmare allows listening for these events, but unfortunately they don't seem to be firing for any of the errors I'm seeing.

I'd expect to see the 'BROWSER EVENT' line in my terminal a few times, one line each for those HTTP, websocket, and source map errors in the screen shot below. However in fact I'm not seeing the `page` event ever being fired.

```js
function startBrowser() {
  return Nightmare({show: true, dock: true, openDevTools: {mode: 'detach'}})
    .onBeforeSendHeaders((details, callback) => {
      callback({
        cancel: false, requestHeaders: {
          'xxx': 'yyy'
        }
      });
    });
}

test('search should work', assert => {
  const browser = startBrowser();
    function saveScreenshotAndEnd(savePath) {
      return browser.screenshot().end().then(imageBuffer => {
        const result = fs.writeFileSync(savePath, imageBuffer);
        shutdown();
        return result;
      });
    }
    browser
      /* eslint-disable no-console */
      .on('console', (logType, ...args) => console[logType]('BROWSER CONSOLE:', ...args))
      .on('page', (type, message, stack) => console.log('BROWSER EVENT:', type, message, stack))
      /* eslint-enable no-console */

      .goto('http://localhost:15872/search')

      // Search for the special e2e test account
      // .wait('.searchInput')
      .type('.searchInput', 'KeithTestNEVERDELETE')

      // Click the first result
      .wait('.searchResults a[href]')
      .click('.searchResults a[href]')
      .wait('h1')

      // Check the text
      .evaluate(() => document.querySelector('h1').innerText) // eslint-disable-line no-undef
      .then(headline => assert.equal(headline, 'KeithTestNEVERDELETE'))

      // This .then() is called after the whole Nightmare session is over
      .then(() => {
        saveScreenshotAndEnd('artifacts/success.png');
      })

      // And this is called if any of those steps fail
      .catch(error => {
        // eslint-disable-next-line no-console
        console.error(error);
        assert.error(error);
        saveScreenshotAndEnd('artifacts/failure.png');
      });
  });
});
```

<img width="468" alt="screen shot 2017-02-22 at 12 48 31 pm" src="https://cloud.githubusercontent.com/assets/7430512/23224784/aa6e6a20-f8fd-11e6-9cf4-8072277cefdc.png">
 Wow thank you for doing so much research. I'll look into debugger. Feel free to close this since it sounds like it's not an issue with nightmare itself.  I noticed this issue while reading the docs  previous link is 404, replace it with correct link address  I am making a bot that uses a proxy for each electron instance. I want to run them all in a background and when an instance reaches a certain page, it opens an electron window, so a user can make selections before the program continues. So how would I switch between show: false and true without losing cookies and other data?
I was thinking of running multiple sessions in the background, then closing and reopening them with show: true.  I am using nightmarejs to visit this url: 

http://www.pinbet88.com/en/

and then got this error: 

"Uncaught TypeError: Cannot read property 'stack' of null" from preload.js line 7. Thanks for the replying. I tried to override the event listener and found it is a 'Script error'. However, I do not have this exception when using Chrome or Electron. Thanks.  I remember I did this on accident before but I can't seem to figure that out again.

It was something like: 

```
nightmare
.goto(url)
.wait(5000)
.click(selector)
.then(function() {
    arrLinks.forEach(function(link) {
        return m.goto(link).screenshot('./Desktop/bob')
    });
})
.end()
.then(() => {
console.log('Cool');
})
.catch(err => { console.error(err); })
```

Or something like that. Does anyone know how to do this? How did you get arrLinks????  I forgot since I did like a million changes. But I found out how to recursively iterate through links now. This is the code for anyone who is interested:

```
let containers = ['PONU8023728', 'PONU8023728', 'PONU8023728', 'PONU8023728', 'PONU8023728'];

    const HANJIN_RELEASES = function (){
        let m = new Nightmare({
            width: 1600,
            height: 900,
            show: true,
            waitTimeout: 12000
        });
        
        let count = 0;
        m
        .goto('http://www.ttilgb.com/main/index.do')
        .wait(1000)
        .wait(`#pUsrPwd`)
        .insert("#pUsrId", hanjin_credentials.id)
        .insert("#pUsrPwd", hanjin_credentials.pw)
        .click(`img[onclick="clickLogIn()"]`)
        .then(() => {
            function Iterate_Containers(){
                setTimeout(function() {
                    return m
                    .goto(`https://www.ttilgb.com/uiArp02Action/searchContainerInformationListByCntrNo.do?srchTpCd=C&cntrNo=${containers[count]}`)
                    .wait(500)
                    .screenshot(`./Desktop/${containers[count]}${count}.png`)
                    .then(() => {
                        count++;
                        if (count < containers.length) {
                            Iterate_Containers();
                        }
                        if (count === containers.length) {
                            return m.end(() => { console.log(green(`\nSuccessfully grabbed ${chalk.bgRed.white.bold(count)} containers release information from [${chalk.bgCyan.white.bold(`HANJIN`)}] terminal.`)) })
                        }
                    },800)
                    .catch(e => { console.error(e) });
                });
            }
            return Iterate_Containers();
        })
    }
    
    
    
    
    
    
    
    return {
        hanjin_releases: HANJIN_RELEASES
    }
}());
``` But now it freezes sometimes after the first iteration of the function Iterate_Containers() 

Why does it execute the first one fine but freezes on the rest of the iterations?  Is there any way to wait for event happen dynamically?
Here's the scenario.

1) page loads
2) after page loads, you do authentication.
3) when you submit, page finishes loading (dom-ready), but the website itself is really complicated and it also loads other things dynamically (ajax calls inside iframes, other script loads another script and so on), which I have no clue how to wait for.

wait(ms) is not acceptable, cause it might give non accurate results often.

The way I'm doing is that is following:

```
nightmare.on('did-get-response-details', async (event, status, newURL, originalURL, httpResponseCode, requestMethod, referrer, headers, resourceType) => {
    if (newURL.indexOf('file_to_wait_load.php') !== -1) {
      // NOTES: without file_to_wait_load.php, clicking on this does nothing at all, but it's still visible, same properties, etc.
      await nightmare.click('#element');
    }
  });

  await nightmare.goto('...');
  await nightmare.click('#loginHeader > li:nth-child(2) > a');
  await nightmare.type('#username', 'mydesiredusername');
  await nightmare.type('#password', 'randompassword')
  await nightmare.click('#submitButton');
  // here happens that click method.
  // but I want to able to use nightmare.on() HERE, not globally though.
```

is there any way to do that or some other workarounds? since I hurry and having not much knowledge about internal stuff, does this action seems good (well, it would be much better with timeouts as well, but dunno how to do it).

```
Nightmare.action('waitForResource',
  function (name, options, parent, win, renderer, done) {

    function _onResponseDetail(event, status, newURL, originalURL, httpResponseCode, requestMethod, referrer, headers, resourceType) {
      parent.respondTo('waitForResource', function (resourceName, done) {
        if (newURL.indexOf(resourceName) !== -1) {
          win.webContents.removeListener('did-get-response-details', _onResponseDetail);
          done();
        }
      });
    }

    win.webContents.on('did-get-response-details', _onResponseDetail);
    done();
  },
  function (resourceName, done) {
    this.child.call('waitForResource', resourceName, done);
  });
```

I ask because I get logs such as:
`nightmare:ipc Replacing responder named "waitForResource" +13ms` well, I dag in documentation / examples and this action now works fine! (it is just missing timeouts though).

```
Nightmare.action('waitForResource',
  function (name, options, parent, win, renderer, done) {

    parent.on('waitForResource', function (resourceName) {
      win.webContents.on('did-get-response-details', function (event, status, url) {
        if (url.indexOf(resourceName) !== -1) {
          parent.emit('waitForResource');
        }
      });
    });

    done();
  },
  function (resourceName, done) {
    this.child.once('waitForResource', done);
    this.child.emit('waitForResource', resourceName);
  });
```  You know when you visit a page in a website and view the source code, sometimes you see an element execute a javascript function? For example:

`<button type="button" id="chocolate" onclick="EditShipment()">Click me</button>`

Can I use nightmare to visit this page and execute EditShipment() ? And if so, is it possible to pass in our own arguments to that function's argument?  Sure. If the code on the site is defined and written exactly as in your description, then we can assume that `EditShipment` exists within the global namespace. If that's really the case, you should be able to call `EditShipment` from within a normal nightmare `evaluate` function.

Here's an example:

```node.js
nightmare.goto('http://www.example.org')
    .evaluate(function () {
        EditShipment(/* custom arguments ...*/);
    })
    .end()
    .then();
```   Why though?  **_The code (taken from example):_**
```
var Nightmare = require('nightmare');       
var nightmare = Nightmare({ show: true });

nightmare
  .goto('https://www.receita.fazenda.gov.br/Aplicacoes/SSL/ATCTA/CPF/ConsultaSituacao/ConsultaPublica.asp')
  .end(() => "some value")
  //prints "some value"
  .then((value) => console.log(value))
  .catch(function (error) {
    console.error('Search failed:', error);
  });
```


_**Output:**_
```
Search failed: { message: 'navigation error',
  code: -501,
  details: 'ERR_INSECURE_RESPONSE',
  url: 'https://www.receita.fazenda.gov.br/Aplicacoes/SSL/ATCTA/CPF/ConsultaSituacao/ConsultaPublica.asp' }
```

**_How to deal with that?_** Thank you @rosshinkley . 
I'm gonna try it first thing in the morning, have to go right now (2am)

Yes, apparently my government doesn't like spending money on certificates. (go brazil!) 

**It worked!**  Native ES6 Promises are nice, but libraries like [Bluebird](npmjs.com/package/bluebird) offer a lot of nice additional features. I'd like to be able to specify which Promise library/factory nightmare uses internally to wrap return values from `.then()` and `.catch()` *(inspired by [mongoose.Promise](http://mongoosejs.com/docs/promises.html#plugging-in-your-own-promises-library))*

## Use Case
```js
import Nightmare from 'nightmare';
import Promise from 'bluebird';

class MyCrawler {

  nightmare = null;

  // PRIVATE
  _authPromise = null;

  constructor() {
    this.nightmare = Nightmare();
  }

  async authenticate() {
    if (this._authPromise && !this._authPromise.isFulfilled()) {
      return await this._authPromise();
    } else {
      return await (this._authPromise = Promise.resolve(this.nightmare.goto('...').then()));
    }
  }

}
```

The problem here is the `Promise#isFulfilled()` method that is a Bluebird-only method, forcing me to wrap `Nightmare#then()` in an awkward `Promise.resolve(...)`.

## Solution
With the ability to specify the internal `Promise` library/factory, I could have nightmare return a Bluebird Promise:
```js
import Nightmare from 'nightmare';
import Promise from 'bluebird';

Nightmare.Promise = Promise; // Option #1

class MyCrawler {

  nightmare = null;

  // PRIVATE
  _authPromise = null;

  constructor() {
    this.nightmare = Nightmare({ Promise: Promise }); // Option #2
    this.nightmare = Nightmare({ Promise }); // Option #3 (b/c ES6 is AWESOME!)
  }

  async authenticate() {
    if (this._authPromise && !this._authPromise.isFulfilled()) {
      return await this._authPromise();
    } else {
      return await (this._authPromise = this.nightmare.goto('...').then());
    }
  }

}
```

Please review my code & consider it for inclusion in the next release. `nightmare` is one of my favorite & most-used NPM packages, and I think this feature would be a really, really useful addition! LGTM :)  The newest version of Nightmare (2.9.1) stops `nightmare.useragent('my-agent')` from working (i.e. you cannot override the default useragent).

Downgraded to 2.9.0 and it works again. hmmm, in my nm 2.9.1 on windows action useragent works 2.9.1 on archlinux latest works for me. It helps maybe if you can add details like your Operating system and its version :) Weird. I've tested it twice and removed `node_modules` each time. I'm on MacOS Sierra.  Hey guys.

Does nightmare have any monitoring capabilities? I need to export the requests/responses as HAR, but can't seem to find any docs in how to.

Regards! You'll need the `nightmare-har-plugin`. Then you can something like the following ([source](https://gist.github.com/justinph/0ffd7b7a443b82e4941636b65067ad1a)).

```
nightmare
    .viewport(1024, 768)
    .waitForDevtools()
    .goto(url)
    .wait('body')
    .getHAR()
    .end()
    .then((result) => {
        let onLoad = result.pages[0].pageTimings.onLoad;
        console.log(onLoad);
     });
```
  Hello. Please help. I do not understand what the problem is a nightmare. The essence of the application logic is as follows: in the database has a list of tasks for a nightmare, when measuring state is generated by the initialization process of a nightmare.
The problem sludyuschem, at some point in time copies of a nightmare to stop responding and hang. On the counters in the database it can be seen that they can work for longer than specified in the timeout settings nightmare.
Please tell me what could be the problem and how it can be combated.
Check the status and run:
```
const processParse = require('./processParse');
//...
r.table('arc_tasks').getAll('toParse', {index: 'status'}).changes().run(conn, (err, cursor) => {
            if (err) throw err;
            cursor.each((err, data) => {
                if (err) throw err;
                let val = data.new_val;
                if (val !== null) {
                    val.start = Date.now();
                    processParse(val).catch(console.error); // <- this is run process nightmare
                }
            });
        });
// ...
```
An exemplary process for the code of a nightmare:
processParse:
```
// requires and etc
module.exports = exports = async function processParse(params){
    let nightmare;
    try{
        await nighmare.authentication(params.user, params.pass);
        await nightmare.goto(params.href) // .click....click....;
        let resp = await nightmare.evaluate((selector)=>{
            return new Promise((resolve,reject)=>{
                setTimeout(reject, 30000, new Error('EVAL_TIMEOUT'))
                //....
                resolve(result);
                // ... 
                reject(result);
                });
            }, params.selector);
        await nightmare.end();
    } catch(error){
        await nightmare.end();
        throw new Error('PARSER_ERROR');
    } finally {
        // save results and change state of task
    }
};
```
Example statistics (RUNTIME IN SECS):
```{
        "href": "https://***",
        "templName": "GetModifications",
        "runtime": 505.369
    },
    {
        "href": "https://***",
        "templName": "GetModifications",
        "runtime": 1126.206
    },
    {
        "href": "https://***",
        "templName": "GetModifications",
        "runtime": 860.733
    },
    {
        "href": "https://***",
        "templName": "GetModifications",
        "runtime": 379.539
    }``` use a temporary solution, it is not like this.
```
nightmareHaltKey = setTimeout((nightmare) => {
                nightmare.halt(new Error('NIGHTMARE_FORCE_KILL'));
            }, 120000, nightmare);
``` Hi, Rosshinkley.
For each job created another instance through let nightmare = Nightmare(config). Every nightmare is an instance of a large list of tasks, including the creation of screenshots, download files. I guess there are jobs that can potentially lock code on the browser side, after which the connection between the processes is terminated. I used .halt method, but it does not always help. I came to the idea to explicitly use fkill electron off (nightmare.proc.pid). Separately, I note that the assignments that I give not block browser evalyuate.
In addition, I note that there is no electron closing event, if the electron close the arms, the nightmare did not know about it. But this is the problem of the above does not apply, a further observation. parsing error in the example given probation, I react to all exceptions nightmare if they occur. In my situation, the process is sometimes just stops without reference to a fault block.   I'm still a little on edge about this one. There will be a difference between

```js
import {default as Nightmare} from 'nightmare';
```

and

```js
import Nightmare from 'nightmare';
```

due to changes introduced by the latest versions of babel about the default export.

Kindly double check which one of these would work with the example, the one we are presenting here could or could not be the faulty one. @stephenmathieson thanks for teaching me that. :)

For me though, there could be some benefit on the es6 examples change - but it has subtle drawbacks as well. 

For people who need to be convinced to use this open source repository, it should be 'plug and play' as much as possible. Since not all ES6 features are available yet on the native engine without transpiling it from ES6 to ES5, they'd still add a layer of configuration above it to allow this example. I think they could figure out the cosmetic code changes on their own AFTER they are convinced to use nightmare.js.  The main page does not mention the run() method.
However several examples around the web, including #226 use run() as **the** way to run Nightmare tests.

Can you add some doc to the readme about when to use it / not use it, and what are its limitations (e.g. I believe you can't call `run()` twice?)  I have the very simple code here

```javascript
import Nightmare from 'nightmare';
import path from 'path';

describe('avatar', () => {
    fit('should screenshot', async () => {
        const nightmare = new Nightmare({ show: true, frame: true });

        await nightmare
            .goto('https://github.com')
            .screenshot()
            .end();
    });
});
```

When run with [Jest](https://facebook.github.io/jest) this is the terminal output I receive:

```
 FAIL  components/__tests__/avatar/avatar.spec.jsx
  â— avatar â€º should screenshot

    TypeError: nightmare.goto(...).screenshot is not a function
```

It doesn't matter which function I use after the `goto` they give the same `TypeError: nightmare.someApiFunction is not a function`.

This is exactly the package I need but it doesn't seem to work in my environment.

Help ðŸ˜« Perhaps it's because you are not calling `.then()` after `.end()`
```js
nightmare
 .goto('https://github.com')
 .screenshot()
 .end()
 .then(function(){console.log("Screenshot Saved")})
```

 Thank you @entrptaher I will try this out This still says that screenshot isn't a function. ðŸ˜ž  Here is how I did this.

package.json
```js
{
  "name": "jestify",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "jest"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "jest": "^18.1.0",
    "nightmare": "^2.9.1"
  }
}
```

nightmare.test.js
```js
const takescreenshot = require('./nightmare');

test('Should Take Screenshot', () => {
  return takescreenshot().then((data) => {
    expect(data).toBe('Screenshot Done');
  });
})
```

nightmare.js
```js
var Nightmare = require('nightmare');

function takescreenshot(){    
  var nightmare = Nightmare({ show: true });
  return nightmare
  .goto('https://duckduckgo.com')
  .screenshot("test.png")
  .end()
  .then(function (result) {
    return ("Screenshot Done");
  })
  .catch(function (error) {
    console.error(error);
  });
  }

module.exports = takescreenshot
```

The result:
![](https://i.imgur.com/X2ACH7M.png) @rosshinkley I am using both Node 7, but also babel mostly for jsx and generators  Can we use all actions within a Nightmare custom action?

I'm attempting to define a generic login action as the code is reused many times. Here is my custom action:

```js
Nightmare.action('login', function (done) {
  
  this
    .goto(BASE_URL)
    .type("input[name='user[email]']", "test@email.com")
    .type("input[name='user[password]']", "password")
    .click("*[type=submit]")
    .then(() => {
      console.log('login action done')
      done()
    })

})
```

And an example of it being used in a test:

```js

it("allows to log in", function(done) {
    
    Nightmare({show: true})
      .login()
      .end()
      .then(function() {
        console.log('parent test done')
        done()
      })
  })
})
```

The action goes ahead as expected, and it even calls the callback in `then()` (i.e `login action done` is printed to terminal), but the chain of events stops there. The second `then()` callback, in the test suite, never gets called.

I'm sure I'm missing something simple here - or perhaps custom actions were not designed for this purpose?
 Sounds like it might be the same as #959 -- see the discussion after the initial ticket  Sorry about a high level question, but can I use this on web apps for mobile ?

I currently use agousti ( golang) with different web drivers.

So I am trying to work out how that and this fit together architecturally. So I am hoping you don't mind giving a quick explanation.  Facing a strange issue with this particular url. Almost every other Url I have tested is working.
**.goto(url) is stuck , specified gotoTimeout does not work, default gotoTimeout of 30 sec also does not work, high memory used by Electron processes**: 

Here's the code outline:

let pageurl = "http://www.gamestop.com/pc/consoles/alienware-steam-machine-i7-1tb/121863"

// wrapped in promise -- 
return nightmare
      .goto(pageurl)
      .wait(waitInMs) 
      .evaluate(function () {
        return {
            // will return what is needed  here including html
        }
      })
      .end()
      .then(function (value) {
          // console.log( " -- made it past goto() ---   // * does not make it to this point 
         // return value  and kill nightmare.
          resolve(value)
       })
        . catch ( (err) => { 
         //  kill nightmare  and resolve( ) or reject( ) 
     })

Note: I have tried passing gotoTimeout : 5000   //ms in the nightmare constructor - but it does not seem to work either.
Default timeout of 30 sec also does not seem to be working. 
The process simply stops at .goto() and memory usage by electron goes to 12gb on my mac.

Here's the error message when process is manually terminated:
Failed: Error: Evaluation timed out after 30000msec.  Are you calling done() or resolving your promises?
    at Timeout._onTimeout (........./node_modules/nightmare/lib/actions.js:509:10)
    at ontimeout (timers.js:365:14)
    at tryOnTimeout (timers.js:237:5)
    at Timer.listOnTimeout (timers.js:207:5)

Thanks.
  .. and nothing useful when run with DEBUG:


  nightmare queuing process start +4ms
  nightmare queueing action "goto" for http://www.gamestop.com/pc/consoles/alienware-steam-machine-i7-1tb/121863 +0ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +0ms

( and it stays at this point - while memory usage continues to rise ) 

All I am looking for is an automated way for nightmare to exit out / kill itself after waiting for 15 seconds or so if there is no success in fetching the url.

thanks a lot for any pointers.
 Same here...
Windows 10 x64 + Nightmare 2.9.1 + Electron 1.4.15

For now, I think you can try to create some workaround with:
`.on("did-start-loading". ...);`

And
`nightmare.halt()`;

It seems the electron renderer process hangs.
 Just a tip for anyone who wants to fix this bug later.

If you open electron.exe and type on the console:
`window.location = "http://www.gamestop.com/pc/consoles/alienware-steam-machine-i7-1tb/121863"`

The browser didn't hang and load the page correctly.
So, maybe it's a startup switch flag or something with nightmare + IPC itself waiting for the "did-finish-load" event.

--- EDIT ---

Well, I backtracked the problem to here:
https://github.com/segmentio/nightmare/commit/58983ee73393010425f1159aa6e3df34447fbc7d

That binding is preventing the page from being "fully load".
Not sure why that was added, but probably solves another kind of problem.

I can not help much more, I started using the nightmare only just a few days ago.
So I have to stop here. Someone with more experience on the project should take over.
 Thanks **navossoc** - I'll try the workaround per your suggestion.
Meanwhile - if anyone has dealt with this issue in the past / better approach / fix - that would certainly help.

 I also have lost an electron and sometimes hangs in the memory. complete nightmare at the same time does not work. I tried to change all the timeouts, without results. @rosshinkley As far I have tested it, yes...

My script was pretty simple, just a goto(), nothing more than that.

I think @kdgit1 can give you more details about the issue.

[]'s I have the same problem. I have to add code: setTimout(()= { nightmare.halt() , 600000} , but this can not solve the problem from base. I can also reproduce the issue if needed.  I want to make a rest service what will do nightmare actions on rest call. Is it ok to make new nightmare instanse with `nightmare = Nightmare();` on rest call? Do I need to end it somehow, or `nightmare.end()` will be ok?

Is there any way to have for example pull of 10 redy to render pages and use them while requests are coming? > Not exactly sure what you're asking here - are you asking if Nightmare could prerender pages for a request? Can you expand on this a bit?

Is it a good practice to reuse nightmare ? First time I create Instance `nightmare = Nightmare();` and then I just use it for some work, after done I don't end it with `nightmare.end()` , I wait for new task, and then again. Will this be ok? Any problems like memory leaks? @novoxudonoser See issue "Multiple processes: windows open and hang" #1021 & @louisscruz Project [hub-crawl](https://github.com/louisscruz/hub-crawl)

  Sometimes when using screenshot method in top left corner a small dot is visible on captured image.
After a short research I found out that a call to `DOM.highlightRect` command [here](https://github.com/segmentio/nightmare/blob/master/lib/frame-manager.js#L99) causes the problem. > I wonder if the HIGHLIGHT_STYLE could be determined at runtime to mimic the top left pixel

I unfortunately canâ€™t think of a reliable way to do this, BUTâ€¦ we I think we could hold the callback until after the `DOM.hideHighlight` call is complete. Actually, Iâ€™m not sure why I didnâ€™t do that to begin with. Iâ€™m pretty sure the fix for this is the same fix as for #955 and will depend on the work being done in #945. I'm kind new to this topic but what about using `invalidate()` method? As the documentation says it generates new frame and it seems to be the easiest solution. Is there anything wrong with it?
I don't know how about other cases  but I did tested it with my own and it seems to work. > I'm kind new to this topic but what about using `invalidate()` method?

`invalidate()` only works when offline rendering is used (literally, it does nothing if not using offline rendering). It was explored in this changeset: https://github.com/segmentio/nightmare/commit/53dee8a2ad88ea656d2b48504dbe66ff5287d0ab

That approach was thrown out because it comes with a whole host of other issues and downsides (if your goal is solely to make screenshots of webpages, itâ€™s great; otherwise it may not work well at all). There wasnâ€™t much discussion of it, so no worries for not knowing about it.  This is a suggestion for the ability to directly paste content in a field, instead of typing it out letter by letter. You mean to trigger a ctrl + v keypress? You can do that using existing functions in the API.

If typing out letter by letter annoys you, you can use nightmare.insert(<String>). I think tho this would be useful in making tests for a webpage that disallows pasting to fields. A PR would be nice! :) Didn't know about `insert`...

I tried it (replaced `type` with it) and it doesn't work, maybe I'm not selecting the precise selector and `.insert` would need that level of detail, or maybe it needs a `paste` or `keyboard event` (quite the custom design on the `input` in question...). @rosshinkley Sorry, not a small one...

https://gist.github.com/coyotte508/7bffdd66e251917c003bebe94ce343e3

It's inside a payment page. `.type` works but not `.insert`. I use the `nightmare-iframe-manager` plugin. The field itself is inside an iframe, maybe it's due to that too.

The selector used for `.type` is the precise selector for the input (`#number`), not a parent.  How can I run custom code while nightmare goes? For example I wan to make the extrnal rest call or call a script. I also found god examle [here](http://stackoverflow.com/questions/37857545/nightmare-js-conditional-browsing):
```js
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function * () {
  var nightmare = Nightmare({
    show: true,
    paths: {
      userData: '/dev/null'
    }
  });

  var title = yield nightmare
    .goto('http://www.example.com/')
    .wait('h1')
    .evaluate(function() {
      return document.querySelector('title')
        .innerText;
    });

  if (title == 'someTitle') {
    yield nightmare.goto('http://www.yahoo.com');
  } else {
    yield nightmare.goto('http://w3c.org');
  }

  //... other actions...

  yield nightmare.end();
})(function(err) {
  if (err) {
    console.log('caught', err);
  } else {
    console.log('done');
  }
});
```

Mabe add this too examples? It will be useful for beginners.  ```
var Nightmare = require('nightmare');		
var nightmare = Nightmare({ show: true });
require('nightmare-wait-for-url')
var https = require('https');
var fs = require('fs');

nightmare
  .goto('https://somewebsite.com')
  .type('#city', 'BE')
  .type('#outtype', 'XML')
  .click('#submitpanel1')
  .evaluate(function() {
    console.log(document)
    return document
 
  })
  
  .end()
  .then(function (result) {
  return new Promise(function(resolve, reject) {
    fs.writeFile('my-data.xml', JSON.stringify(result), function(err){
      if(err) return reject(err);
      resolve();
    });
  });
  })
  .catch(function (error) {
    console.error('Search failed:', error);
  });
```

the page that I'm on is currently the file I need to save.... 
my-data.xml just returns html  ```
nightmare
  .goto('https://somesite.com')
  .wait('#webkit-xml-viewer-source-xml')
  .evaluate(() => document.querySelector('#webkit-xml-viewer-source-xml').innerHTML)
  .then((result) => {
    fs.writeFileSync('my-data.xml', result);
  })
```

Worked for me. Thank you.  Code from here: https://github.com/segmentio/nightmare/issues/887#issuecomment-269412280

```js
Nightmare.action('sendKeyPress',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('sendKeyPress', function(unicodeValue, done) {
      win.focus();
      win.webContents.sendInputEvent({
        type: "keyDown",
        keyCode: unicodeValue,
      });
      setTimeout(() => {
        win.webContents.sendInputEvent({
          type: "keyUp",
          keyCode: unicodeValue,
        });
        done();
      },50);
    });
    done();
  },
  function(unicodeValue, done) {
    this.child.call('sendKeyPress', unicodeValue, done);
  });

	nightmare
		//.cookies.clearAll()
		.viewport(1280, 1024)
		.goto('https://url/')
		.sendKeyPress('\u202D')
		.run();
```

And i have error: 
```
return fn.apply(self, doneargs);
             ^
TypeError: Cannot read property 'apply' of undefined
```
Why dont works? This is like example from main wiki "Defining a custom action with an Electron method" Solved. done must be first: 
```js
  function(done, unicodeValue) {
    this.child.call('sendKeyPress', unicodeValue, done);
  });
```

But this code anyway dont send press right key event. ```js
var Nightmare = require('nightmare');


Nightmare.action('clearCache',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('clearCache', function(done) {
      //win.webContents.session.clearCache(done);
    });
    done();
  },
  function(message,done) {
    this.child.call('clearCache', done);
  });

  var  nightmare = Nightmare(
      {
        show: true
      });

  nightmare
    //go to a url
    .goto('ulr')
    //clear the cache
    .clearCache()
    .wait(3000)
    //go to another url
    .goto('http://ya.ru')
    //perform other actions
    .then(() => {
      //...
    })
    //... other actions...
    //.then(nightmare.end())
    .catch((e) => console.dir(e));
```

This code from examples dont work too! App sleeps at clearCache point. HOW can i get access to **win.webContents** for using sendInputEvent. Help me pls. i have the same problem with the custom actions. 
I'm using the 2.9.1 and still have the problem for me.
I try to use the example in the home page, but appears a error to me: "Unhandled promise rejection (rejection id: 1): Nothing responds to "clearCache". +1. No custom action works for me either if it involves interacting with electron.

I can't even get the `clearCache` custom action from [the documentation](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) to work.

Here's a test script (copy-pasted clearCache from doc):
```node.js
var Nightmare = require('nightmare');
Nightmare.action('clearCache',
    function(name, options, parent, win, renderer, done) {
        parent.respondTo('clearCache', function(done) {
            win.webContents.session.clearCache(done);
        });
        done();
    },
    function(done) {
        this.child.call('clearCache', done);
    });

var nightmare = Nightmare({
    show: true,
    electronPath: require('electron'),
});

nightmare
    .clearCache()
    .goto('http://google.com')
    .evaluate(function () {
        return document.title;
    })
    .end()
    .then(function (result) {
        console.log(result);
    })
    .catch(function (error) {
        console.error('Retrieve title failed:', error);
    });
```

What happens when I run `node actionstest.js`: a blank electron window opens up. Nightmare then stalls on the white page until I quit the script via `ctrl-c`.

Full output for `DEBUG=nightmare:*,electron:* node actionstest.js` (it stalls immediately after):

```
  nightmare:log adding action for clearCache +0ms
```

Nightmare verision `2.9.1`.
Electron version `1.5.0`.
Unlikely related but: macOS Sierra 10.12.2.

Any help here would be greatly appreciated.

The bug, whatever it is, renders all custom actions useless, including [kyungw00k/nightmare-webrequest-addon](https://github.com/kyungw00k/nightmare-webrequest-addon) and [rosshinkley/nightmare-load-filter](https://github.com/rosshinkley/nightmare-load-filter). Thanks for the reply @rosshinkley. Does that mean the docs in README.md should be updated? My test code was mainly a copy-paste of what can be found [here](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) in the `clearCache` example. The doc puts `clearCache` before `goto`. Having the same issue. This is almost a copy-paste from the readme:

```javascript
Nightmare.action('clearCache',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('clearCache', function(done) {
      win.webContents.session.clearCache(done);
    });
    done();
  },
  function(done) {
    this.child.call('clearCache', done);
  });

var nightmare = Nightmare({
    show: true,
    webPreferences: {
        partition: 'testaction'
    }
});

nightmare
  .clearCache()
  .goto('http://example.org')
  .then(function() {
    console.log("done");
    process.exit(0);
  });
```

However, it works fine if you remove the bits that call/declare the action:

```javascript
var nightmare = Nightmare({
    show: true,
    webPreferences: {
        partition: 'testaction'
    }
});

nightmare
  .goto('http://example.org')
  .then(function() {
    console.log("done");
    process.exit(0);
  });
``` It's not an issue strictly with the placement of `clearCache` - granted that's probably wrong, even though it's in the readme. If you call `goto` before `clearCache`, it'll never get past `clearCache` - i.e. in this example, it'll print A, but not B or C.

```javascript
Nightmare.action('clearCache',
  function(name, options, parent, win, renderer, done) {
    console.log("B");
    parent.respondTo('clearCache', function(done) {
      console.log("C");
      win.webContents.session.clearCache(done);
    });
    done();
  },
  function(done) {
    console.log("A");
    this.child.call('clearCache', done);
  });

var nightmare = Nightmare({
    show: true,
    webPreferences: {
        partition: 'testaction'
    }
});

nightmare
  .goto('http://example.org')
  .clearCache()
  .then(function() {
    console.log("done");
    process.exit(0);
  });
```

IIRC, I saw the same issue w/ @rosshinkley's nightmare-upload. FWIW, on nightmare 2.9.1 as well. @rosshinkley Have a look into this, its been several months since we've found such issue. Nothing responds to such actions. :/ 

![screenshot from 2017-03-12 22-59-35](https://cloud.githubusercontent.com/assets/8284972/23833958/328e77b4-0778-11e7-8106-fe6d1e8287a6.png)

 Please fix. Is this package deprecated? @rosshinkley If you create custom actions, almost same kind of error happens no matter the callback. **IMPORTANT** I hope I can help - spend some hours on it now.
- the action registration must be **BEFORE** you create your nightmare instance.
- if you access for example the ```win.webContents.session``` property you must call the plugin after a page is loaded (means for example **AFTER** the ```goto```) - @entrptaher in your code this could be the problem how I see on the screen shot. The problem is that it fails silently because exceptions are not reported which are throwed electron side. (see below to improve this)

To this package to improve:

- ```console.*``` calls in "children function" (which run on electron children process) should be redirected also to the main process output - it's hard to debug otherwise if you don't know that ```parent.emit('log', 'my_value')``` exists, also it depends on the DEBUG var - don't forget it (```DEBUG=* node srv.js```)
- Exceptions on electron side should be catched and redirected to the client and throwed there again with a note that it happened on electron side. Currently it crashes without infos.
- The ```Nighmare.action``` interface to register action is weird because of it's (name[, childFn], parentFn) signature. It must be clarified what the "child" and "parent" process are - and the optional value should be at the end - I can imagine the reason was the order, whyever - it's really more confusing. I just say:

```
  var name = arguments[0], childfn, parentfn;
  if(arguments.length === 2) {
    parentfn = arguments[1];
  } else {
    parentfn = arguments[2];
    childfn = arguments[1];
  }
```

- The API documentation has following flaws:
   - definitely missing of an overview - a simply TOC could help so much for orientation
   - document the rest of the members of the nightmare object
- I saw that ```@types/nightmare``` is currently on version 1.6, older than 2 years. This package has over 11k stars. No TS users here? I wrote the whole definition, very neat and complete. I will spend some time to prepare and publish it on @types if there are people who are interested for it, but if there are 12k js only users its okey.
 Custom actions worked if I used it after a goto, but sometimes you need actions to do before going to any url. But what more important is that **all examples** from the docs are not working properly. Any action after goto works and any action before goto simply fails. Yes I know they should be removed all, temporarily. Currently not examples but broken code. This is what I had to do with all `done()` functions to make it working.
Example code: https://gist.github.com/entrptaher/870246d824c10317edf72a0d4b86760e 


done inside parent, done inside the action and also done in the callbacks. It's a done-strophic problem :D  I ran into issues when my custom Electron actions were defined _after_ the instance was created. Moving those up fixed the issues I was having. Just FYI to anyone who makes the same mistake.  I want to get a list of all network requests the page makes, specifically a list of all the images that are downloaded. Here is my attempt at getting network request data, but I'm very lost.

```
const Nightmare = require('nightmare')
const nightmare = Nightmare({ show: false })

Nightmare.action('testAction', function(name, options, parent, win, renderer, done) {
    parent.respondTo('testAction', function(done) {
      win.WebRequest.onCompleted(filter, (details) => {
        done(details)
      })
    })
    done()
  }, function(done) { this.child.call('testAction', done) })

nightmare
  .goto('https://www.everlane.com/collections/womens-newest-arrivals/products/womens-penny-loafer-black')
  .testAction()
  .end()
  .then(result => {
    console.log(result)
  })
  .catch(error => {
    console.error('Search failed:', error)
  })
``` Something similar to the PhantomJS event "onResourceRequested". See http://phantomjs.org/network-monitoring.html Isn't that what `win.WebRequest.onCompleted` does? I'm more just confused about how to make it work in nightmare.js Interesting, I'll take a look, thanks! I don't know anything about the requests. But you can log all of the responses. I have just commented that in https://github.com/segmentio/nightmare/issues/784#issuecomment-277490918.  I am using nightmarejs in my meteor project. I am using it inside my meteor methods in server. So, Its running fine. 

But i need jquery injected into the website. I placed the `jquery.js` in `/public/js/jquery.js` I can access this file using http://localhost:3000/js/jquery

So, I used below:

```
nightmare
           .goto(data.url)
           .inject('js','/js/jquery.js')
```
But it seems that jquery is not working properly.

Anyway, you guys have done a great job in developing this package ðŸ‘  Ok, I managed to locate the builded `jquery.js` file in `./../web.browser/app/js/jquery.js`.

But don't know if there are any disadvantages in doing this way? Its working now. Can close if there is no other solution.  How could I achieve passing arguments to a custom preload script?

[This issue](https://github.com/electron/electron/issues/6504) on the electron repo suggests to send in query parameters to the visited url and then retrieve them from the preloaded script. I would like to avoid this approach as it would allow the scripts in the page to read those query parameters, not just me.

Can I maybe use IPC to do it? How could I go about that? Uuuhf, I had almost given up. I found a way to pass arguments to the preload.js, it is far from elegant.

You can define an electron action which defines an ipc listener for 'set-screen-params' on the renderer object, that returns whatever data you want to whoever send the 'set-screen-params' event.
```
Nightmare.action('changeScreen',
    function(name, options, parent, win, renderer, done) {
        parent.respondTo('changeScreen', function(data, done) {
            // create a renderer listener that respond with some data
            renderer.on('set-screen-params', (event) => {
                event.returnValue = data
            })
        })
        done();
    },
    function(data, done) {
        // call the function above
        this.child.call('changeScreen', data, done);
        done();
    }
)
```

Then in your preload file:
```
window.__nightmare = {};
__nightmare.ipc = require('electron').ipcRenderer;

window.screen = __nightmare.ipc.sendSync('set-screen-params', 'aah');
```
 I would like to have this option too, url params don't work for me, provided here action too. I ended up writing new script every time I open new session. In my case I have to initialize several options for the window object + local storage.  So I managed to get nightmarejs up and running and it was working perfectly for a while and now it just works sometimes and with some websites not at all..
I didn't change anything in the code, they just started appearing the next day, I already rebooted, they still persist.

Here is some output of the example:

      root@docker-512mb-fra1-01:~/node# xvfb-run --server-args="-screen 0 1024x768x24" node index.js
      https://github.com/segmentio/nightmare
      root@docker-512mb-fra1-01:~/node# xvfb-run --server-args="-screen 0 1024x768x24" node index.js
      https://github.com/segmentio/nightmare
      root@docker-512mb-fra1-01:~/node# xvfb-run --server-args="-screen 0 1024x768x24" node index.js
      Search failed: Error: .wait() timed out after 30000msec
          at Timeout._onTimeout (/root/node/node_modules/nightmare/lib/actions.js:453:10)
          at ontimeout (timers.js:365:14)
          at tryOnTimeout (timers.js:237:5)
          at Timer.listOnTimeout (timers.js:207:5)
      root@docker-512mb-fra1-01:~/node# xvfb-run --server-args="-screen 0 1024x768x24" node index.js
      https://github.com/segmentio/nightmare
      root@docker-512mb-fra1-01:~/node# xvfb-run --server-args="-screen 0 1024x768x24" node index.js
      Search failed: Error: .wait() timed out after 30000msec
          at Timeout._onTimeout (/root/node/node_modules/nightmare/lib/actions.js:453:10)
          at ontimeout (timers.js:365:14)
          at tryOnTimeout (timers.js:237:5)
          at Timer.listOnTimeout (timers.js:207:5)

And yes the server has a perfect internet connection stability, so it's not that. I had this issue  with lubuntu. I installed a new version of chrome and it fixed. I don't even have chrome installed though, as I'm just using the console Is this on sudo? Why? Someone said that it worked for him putting it on sudo, so I was trying it here, but the output is the same whether sudo or not.. Same here. Doesn't happen all the time but in 1/3 cases. Any idea? This problem didn't occur in the past.

Here is a docker image with our setup: https://github.com/graphcool/prep/blob/master/docker/Dockerfile all have the same problem, and developers are silent. same problem :( anybody know how to fix ? @rosshinkley no, it did not. My problem was, when proxy die or site blocked this proxy in process..  I'm having the same issue.

I extracted the HTML when the test fails, and the item I'm looking for is indeed present on the page. Anybody had any luck figuring this problem out?  Theres an ID to other elements like #btnMyWL that is easy to target and click on, but there is a button "Save" that has no id or class name to it. I can't target it to get it clicked.... I even did Array.from(document.querySelectorAll) and selected the specific save button (indexed 14), returned it from my evaluate function to my then function and tried to do the .click on it inside the then function but it doesnt click. Is there any way I can click an "anonymous" button like that?  

    var w = Nightmare({
        width: 1600,
        height: 900,
        waitTimeout: 8000 // 8 secs no answer, stop the script
    });
    w
    .goto(anondefault)
    .insert("#UserName", "*censored*")
    .insert("Password", '*censored*')
    .click("#btnLogin")
    .wait("#btnMyWL") // wait 1.5 secs
    .click("#btnMyWL") // clicks WL
    .wait("#txtBookNbrs")  
    .click("#txtBookNbrs") // add container # field
    .insert("#txtBookNbrs", 'TCLU7777777')
    .evaluate(function () {
        let r = Array.from(document.querySelectorAll("button"));
        let s = r; //  
        return $("button")[14];
    })
    .end()
    .then(z => {  // z  = save watchlist button
        console.log(z);  // returns "jQuery43249238324" or something--it is the save button
        w.click(z)
    })
    .catch(error => {
        console.log(error);
    }); LADIES AND GENTLEMEN I FINALLY DID IT there was a attribute ng-click on it with SaveWatchList()  so I did:

 .click("button[type=\"submit\"][ng-click=\"SaveWatchList()\"]")

Impossible modals no more!  Hello,

I'm trying to create a function that creates the nightmare instance and does some work (I need it to always go to a site and run some script before running). So I've create a method the generates and returns a promise where it should return the working nightmare instance.

However for some reason when passing the nightmare instance through the resolve it gets `undefined` on the other end.

See repro:
```
function getNightmare() {

    var nightmare = Nightmare({});
    return new Promise((res, rej) => {
        nightmare
            .goto("http://cnn.com")
            .evaluate(function() { return document.title })
            .then((title) => {
                console.log(title);
                res(nightmare);
            })
            .catch((error) => {
                rej(error)
            })
    })
}
getNightmare().then((inst) => {
    console.log(inst);
})
```
Prints in the log:
```
node --debug-brk=19560 --nolazy src/scraper.js 
Debugger listening on 127.0.0.1:19560
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
undefined
```

Changing the line res(nightmare) to res(5) prints (obviously)
```
node --debug-brk=7732 --nolazy src/scraper.js 
Debugger listening on 127.0.0.1:7732
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
5
``` I've also see same phenomenon. can you actually check what 'this' and 'nightmare' are inside that 'then' clause? my short speculation is that within that function, 'this' is actually 'nightmare', instead of 'nightmare'. Wrapping the nightmare like that is how I've been using it for awhile, it
does indeed work around the problem.
On Fri, 10 Feb 2017 at 4:19 Ross Hinkley <notifications@github.com> wrote:

> Isn't this because the Nightmare instance is a .then()able itself? If
> you're resolving nightmare after it's run a chain, it's trying to resolve
> the now-currently-empty action chain, which will resolve to undefined.
>
> Try wrapping the instance in an object literal, like
> res({nightmare:nightmare}). Would something like that work?
>
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> <https://github.com/segmentio/nightmare/issues/947#issuecomment-278839273>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AM_RxyOjanMpmFSAw1C3bYhhZ0K-1MFBks5ra8kzgaJpZM4LePHs>
> .
>
 wow! OK I'll try to wrap an object literal. thanks. Can't you just do this?
```js
var Nightmare = require('nightmare')

function getNightmare() {
    var nightmare = Nightmare({});
    return nightmare
            .goto("http://example.com")
            .evaluate(function() {
                return document.title
            })
}

getNightmare().then((inst) => {
    console.log(inst);
})
```

Or this,

```js
function getNightmare() {
    var nightmare = Nightmare({});
    return nightmare
            .goto("http://example.com")
            .evaluate(function() {
                return document.title
            })
}

function printLog(data){
  console.log(data);
}

getNightmare().then(printLog)
```

Or even this,
```js
var Nightmare = require('nightmare');

function getNightmare(url) {
    var nightmare = Nightmare({show: true});
    return nightmare
            .goto(url)
            .wait()
            .evaluate(function() {
                return document.title
            })

}

function printLog(data){
  console.log(data);
}

// Opens two nightmare instances async
getNightmare("http://example.com").then(printLog)
getNightmare("http://github.com").then(printLog)
``` I'm trying to have a single nightmare instance and use it in all kinds of scenarios during my program's lifecycle.
So I have a single "getInstance" which acts as a lazy getter to a static nightmare instance which needs to initialize only once, since nightmare takes time to initialize I return a promise. Oh, that?
You can do it this way, 
Declare nightmare variable first, then update the variable.

```js
var Nightmare = require('nightmare'), nightmare; // <-- Declare the nightmare variable here.

function getNightmare() {
    nightmare = Nightmare(); // every time you call getNightmare, a new instance is created here.
    return nightmare
            .goto("http://example.com")
            .evaluate(function() {
                return document.title
            })
}

function printLog(data){
  console.log(data);
}

getNightmare().then(printLog)
```

Or, like this,

```js
var Nightmare = require('nightmare'),
    nightmare;

function init() {
    return nightmare = Nightmare(); // Run this to get a instance.
}

function goThere() {
    return nightmare
        .goto("http://example.com")
        .evaluate(function() {
            return document.title
        })
}

function printLog(data) {
    console.log(data);
}

init()
    .then(goThere)
    .then(printLog)
```

There are always several ways to do the same thing.

# A final example of everything combined

```js
var Nightmare = require('nightmare'),
    nightmare;

var counter = 0; // Check how many logs we print now

function init() {
    return nightmare = Nightmare();
}

function goThere(url) {
    return nightmare
        .goto(url)
        .evaluate(function() {
            return document.title
        })
}

function printLog(data) {
    console.log(`${++ counter} > ${data}`);
    return new Promise(function(resolve) {
        resolve(nightmare)
    })
}

// EXAMPLE USES

init()
    .then(goThere('http://example.com'))
    .then(printLog) // Can chain as long as I want
    .then(goThere('http://example.org'))
    .then(printLog)

// Call it 10 Seconds later
setTimeout(() => {
    goThere('http://github.com').then(printLog)
}, 10000)

// use the instance later
function visitRandomSite() {
    nightmare
        .goto('https://duckduckgo.com/')
        .title()
        .then(printLog)
}

// Set another timeout to do it much much later
setTimeout(() => {
    visitRandomSite()
}, 60000)
```

Result:
![image](https://cloud.githubusercontent.com/assets/8284972/23666670/e07d57ba-0385-11e7-9387-3469fde367ba.png)


  Most probably due to Electron but when rendering fullpage PDF using the pageSize option, 2 pages are rendered in the PDF instead of just 1.

The code below does the following
  - Load a page
  - Get the page width and height
  - Convert sizes to micron meters
  - Resize the viewport
  - Render full page PDF

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: false, width: 1980, maxWidth:100000, maxHeight:100000 });

var calcSize = function(width, height) {
  // Size in micronmeters
  return { pageSize: { height: Math.ceil(height * 254/96*100), width: Math.ceil(width * 254/96*100) }, marginsType: 1 };
};

nightmare
  .goto('https://facebook.com')
  .wait(3000)
  .evaluate(function () {
    var body = document.body, html = document.documentElement;
    var height = Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight );
    var width = Math.max( body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth );
    return { width: width, height: height };
  })
  .then( function (result) {
    var size = calcSize(result.width, result.height)
    nightmare.viewport(result.width, result.height).wait(1000).pdf("./screenshot.pdf", size).end().then();
  })
```

While it happens with facebook.com, no issues are seen when rendering github.com. Looking at the problematic PDFs, I noticed that the last few pixels of the full page is rendered on the second page.  I am trying to click an individual href element that are exactly the same as others (there are 4 total of these. Here is the element:

    <a href="#" ng-if="d.AvailableStatus != 'UNKNOWN'" ng-click="openDialog2('popuptempl1','/ImportAvailability/GetContainerInfoByContainerNumber',{Container_Nbr:d.WLContainerNumber, Terminal_Cd:d.TerminalCode},'Container Details')" class="ng-binding ng-scope">TCLUZZZZ004</a>

The problem is I do not know how to select one. None of them have a unique ID. They all share the same class names. Only the href text is unique which is 'TCLUZZZZ004' 

Thank you.
 Use .evaluate(). I don't know why @urlysses deleted his answer, but using the css selector is a way better option than my initial answer I tried using evaluate() but I dont know how to get it to return the value to my click() line. Or do I use click() inside the evaluate function before it gets returned? like @urlysses said, you can use css3 styled selectors.
```js
nightmare.click([href=TCLUZZZZ004]);
```

not sure why he deleted his answer. ^ Those demonstrations were really helpful. If the website i'm scraping from is using the jquery library, am I able to select elements using jquery syntax? $("#fdfsdf").html()   etc

 @pfftdammitchris yes. As long as you are sure that JQuery is always loaded. You can even use all the other functions of JQuery to perform interactions / manipulations within an evaluate call. Sorry! Deleted my answer because I re-read the question and saw that I misunderstood the initial question. I should instead have edited with a more appropriate answer or update. Thanks @jekku and @rosshinkley.  Seems like #865 took out these lines (sorry, my fault)  The following code works flawlessly without `screenshot()`, but for some reason the httpResponse is undefined when the `screenshot()` function is present.

```
var Nightmare = require('nightmare');

Nightmare().goto("https://google.com")
.screenshot("abc.png")
.end().then(function(httpResponse){ 
  console.log(httpResponse.code); 
})
```

Nightmare version is 2.9.0

Node version 6.9.1 Thanks to Daniel for raising the bug.
I originally raised a question on StackOverflow which he answered by emitting the screenshot method.

I have updated node to 7.3.0 just in case and the issue remains. I have also removed and re0installed nightmare a couple of times.

The screenshot is rendered and then nightmare seem to stall

I have run a debug and the output is below:

Here's the code:

`var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

Nightmare().goto("https://google.com")
.screenshot("abc.png")
.end().then(function(httpResponse){
    console.log(httpResponse.code);
})
.catch(function(error){
    console.log('ERROR: ' + error)
})
`

`DEBUG=* node nightmaretest.js
  nightmare queuing process start +0ms
  nightmare queuing process start +3ms
  nightmare queueing action "goto" for https://google.com +2ms
  nightmare queueing action "screenshot" +0ms
  nightmare running +0ms
  nightmare:log Navigating: "https://google.com",
            headers: [none],
            timeout: 30000 +439ms
  nightmare:log did-start-loading +59ms [{}]
  nightmare:log did-get-redirect-request +301ms [{},"https://google.com/","https://www.google.co.uk/?gfe_rd=cr&ei=ZglpWPnWN6P38AehmLPoCQ",true,302,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["private"],"content-length":["262"],"content-type":["text/html; charset=UTF-8"],"date":["Sun, 01 Jan 2017 13:51:34 GMT"],"location":["https://www.google.co.uk/?gfe_rd=cr&ei=ZglpWPnWN6P38AehmLPoCQ"],"status":["302"]}]
  nightmare:log did-get-response-details +161ms [{},false,"https://www.google.co.uk/?gfe_rd=cr&ei=ZglpWPnWN6P38AehmLPoCQ","https://google.com/",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["private, max-age=0"],"content-encoding":["gzip"],"content-type":["text/html; charset=UTF-8"],"date":["Sun, 01 Jan 2017 13:51:35 GMT"],"expires":["-1"],"p3p":["CP=\"This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.\""],"server":["gws"],"set-cookie":["NID=93=jh20qDlSaE_B2kQ68P5xXm4MGswjyFWb7_HRJivnfvIcWA4MLk1cdEF2zpALsTrHmQLimdih2TFhtqIDA4NGMzn9kBZTSR33sJYMjsKs_GRLy0t8SPOeJfzZ9DwM_p24; expires=Mon, 03-Jul-2017 13:51:35 GMT; path=/; domain=.google.co.uk; HttpOnly","CONSENT=WP.25b8c3; expires=Fri, 01-Jan-2038 00:00:00 GMT; path=/; domain=.google.co.uk"],"status":["200"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"mainFrame"]
  nightmare:log did-get-response-details +128ms [{},false,"https://www.google.co.uk/logos/doodles/2017/new-years-day-2017-5644902961512448-res.png","https://www.google.co.uk/logos/doodles/2017/new-years-day-2017-5644902961512448-res.png",200,"GET","https://www.google.co.uk/",{"age":["49895"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-length":["2982"],"content-type":["image/png"],"date":["Sun, 01 Jan 2017 00:00:00 GMT"],"expires":["Mon, 01 Jan 2018 00:00:00 GMT"],"last-modified":["Thu, 22 Dec 2016 16:09:59 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.google.co.uk/logos/doodles/2017/new-years-day-2017-5644902961512448-hp.gif","https://www.google.co.uk/logos/doodles/2017/new-years-day-2017-5644902961512448-hp.gif",200,"GET","https://www.google.co.uk/",{"age":["49895"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-length":["292678"],"content-type":["image/gif"],"date":["Sun, 01 Jan 2017 00:00:00 GMT"],"expires":["Mon, 01 Jan 2018 00:00:00 GMT"],"last-modified":["Thu, 22 Dec 2016 16:08:55 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +19ms [{},false,"https://consent.google.com/status?continue=https://www.google.co.uk&pc=s&timestamp=1483278695","https://consent.google.com/status?continue=https://www.google.co.uk&pc=s&timestamp=1483278695",204,"GET","https://www.google.co.uk/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["no-cache, no-store, max-age=0, must-revalidate"],"content-length":["0"],"content-security-policy":["script-src 'nonce-OP99O3k3cs17E3WnibN/cBUKQKE' 'self' 'unsafe-eval' https://apis.google.com https://ssl.gstatic.com https://www.google.com https://www.gstatic.com;report-uri /_/ConsentHttp/cspreport"],"content-type":["text/html; charset=utf-8"],"date":["Sun, 01 Jan 2017 13:51:35 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"p3p":["CP=\"This is not a P3P policy! See https://support.google.com/accounts/answer/151657?hl=en for more info.\""],"pragma":["no-cache"],"server":["ESF"],"set-cookie":["NID=93=twdvPiiYKzn4X3eXW3OAsSJLMyFYRCwGGc-_j7Qcxg0uY4msqPGNSspiMY8MC7fgzwpCo8swub1F0tICMzJe1gaqkrjNxGTfaAY44p9P0P9-uUNGLAQeCx88yrZYPc50;Domain=.google.com;Path=/;Expires=Mon, 03-Jul-2017 13:51:35 GMT;HttpOnly"],"status":["204"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +58ms [{},false,"https://consent.google.com/status?continue=https://www.google.co.uk&pc=s&timestamp=1483278695","https://consent.google.com/status?continue=https://www.google.co.uk&pc=s&timestamp=1483278695",204,"GET","https://www.google.co.uk/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["no-cache, no-store, max-age=0, must-revalidate"],"content-length":["0"],"content-security-policy":["script-src 'nonce-tKCihCyNfIOByWphPLBRJTh3d4o' 'self' 'unsafe-eval' https://apis.google.com https://ssl.gstatic.com https://www.google.com https://www.gstatic.com;report-uri /_/ConsentHttp/cspreport"],"content-type":["text/html; charset=utf-8"],"date":["Sun, 01 Jan 2017 13:51:35 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["ESF"],"status":["204"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log dom-ready +0ms [{}]
  nightmare:log did-get-response-details +19ms [{},false,"https://ssl.gstatic.com/gb/images/i2_2ec824b0.png","https://ssl.gstatic.com/gb/images/i2_2ec824b0.png",200,"GET","https://www.google.co.uk/",{"age":["52211"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-length":["24211"],"content-type":["image/png"],"date":["Sat, 31 Dec 2016 23:21:24 GMT"],"expires":["Sun, 31 Dec 2017 23:21:24 GMT"],"last-modified":["Mon, 12 Dec 2016 14:45:00 GMT"],"server":["sffe"],"status":["200"],"vary":["Origin"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"https://www.google.co.uk/xjs/_/js/k=xjs.s.en.E-k8HBn4MQ0.O/m=sx,c,sb,cdos,cr,elog,hsm,jsa,r,qsm,j,p,d,csi/am=AARKHi9YAPH3EBC3iY4gNWBgUA/rt=j/d=1/t=zcms/rs=ACT90oG2tg8KG9nbmKr7z7wuMQcXuZD4Nw","https://www.google.co.uk/xjs/_/js/k=xjs.s.en.E-k8HBn4MQ0.O/m=sx,c,sb,cdos,cr,elog,hsm,jsa,r,qsm,j,p,d,csi/am=AARKHi9YAPH3EBC3iY4gNWBgUA/rt=j/d=1/t=zcms/rs=ACT90oG2tg8KG9nbmKr7z7wuMQcXuZD4Nw",200,"GET","https://www.google.co.uk/",{"age":["247456"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["143255"],"content-type":["text/javascript; charset=UTF-8"],"date":["Thu, 29 Dec 2016 17:07:19 GMT"],"expires":["Fri, 29 Dec 2017 17:07:19 GMT"],"last-modified":["Wed, 28 Dec 2016 13:03:14 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +203ms [{},false,"https://www.google.co.uk/xjs/_/js/k=xjs.s.en.E-k8HBn4MQ0.O/m=sy42,sy53,em3,em1,em2,sy55,em0,sy328,aa,abd,sy82,sy81,sy80,sy83,em16,async,erh,sy85,foot,fpe,ipv6,sy152,sy185,lu,m,sf,sy49,sy131,sy178,sy271,sy226,sy286,sy225,sy283,sy44,sy179,sy270,sy287,sy290,sy284,sy281,spch,vm,sy341,sy343,sy60,sy342,sy344,sy345,sy544,udlg,sy43,sy105,sy46,sy51,sy104,sy162,sy45,sy47,sy164,em8,em9,sy41,sy52,sy106,sy161,sy163,sy165,cbin,sy400,dgm,cbhb/am=AARKHi9YAPH3EBC3iY4gNWBgUA/rt=j/d=0/t=zcms/rs=ACT90oG2tg8KG9nbmKr7z7wuMQcXuZD4Nw","https://www.google.co.uk/xjs/_/js/k=xjs.s.en.E-k8HBn4MQ0.O/m=sy42,sy53,em3,em1,em2,sy55,em0,sy328,aa,abd,sy82,sy81,sy80,sy83,em16,async,erh,sy85,foot,fpe,ipv6,sy152,sy185,lu,m,sf,sy49,sy131,sy178,sy271,sy226,sy286,sy225,sy283,sy44,sy179,sy270,sy287,sy290,sy284,sy281,spch,vm,sy341,sy343,sy60,sy342,sy344,sy345,sy544,udlg,sy43,sy105,sy46,sy51,sy104,sy162,sy45,sy47,sy164,em8,em9,sy41,sy52,sy106,sy161,sy163,sy165,cbin,sy400,dgm,cbhb/am=AARKHi9YAPH3EBC3iY4gNWBgUA/rt=j/d=0/t=zcms/rs=ACT90oG2tg8KG9nbmKr7z7wuMQcXuZD4Nw",200,"GET","https://www.google.co.uk/",{"age":["69113"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["39347"],"content-type":["text/javascript; charset=UTF-8"],"date":["Sat, 31 Dec 2016 18:39:42 GMT"],"expires":["Sun, 31 Dec 2017 18:39:42 GMT"],"last-modified":["Sat, 24 Dec 2016 22:01:56 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +46ms [{},false,"https://www.gstatic.com/og/_/js/k=og.og2.en_US.oDYjzNdSXG0.O/rt=j/m=def/exm=in,fot/d=1/ed=1/rs=AA2YrTt3OYTznFuWnDoc_JnRaLQNCghyMg","https://www.gstatic.com/og/_/js/k=og.og2.en_US.oDYjzNdSXG0.O/rt=j/m=def/exm=in,fot/d=1/ed=1/rs=AA2YrTt3OYTznFuWnDoc_JnRaLQNCghyMg",200,"GET","https://www.google.co.uk/",{"age":["395248"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["47789"],"content-type":["text/javascript; charset=UTF-8"],"date":["Wed, 28 Dec 2016 00:04:07 GMT"],"expires":["Thu, 28 Dec 2017 00:04:07 GMT"],"last-modified":["Mon, 12 Dec 2016 03:57:39 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding, Origin"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +10ms [{},false,"https://www.google.com/textinputassistant/tia.png","https://www.google.com/textinputassistant/tia.png",200,"GET","https://www.google.co.uk/",{"age":["250477"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-length":["258"],"content-type":["image/png"],"date":["Thu, 29 Dec 2016 16:16:58 GMT"],"expires":["Fri, 29 Dec 2017 16:16:58 GMT"],"last-modified":["Thu, 08 Dec 2016 15:30:00 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +4s [{},false,"https://www.google.co.uk/gen_204?atyp=i&ct=&cad=&vet=10ahUKEwjPw-Ddi6HRAhXCMhoKHcQyDoYQsmQIEA..s&ei=ZwlpWI90wuVoxOW4sAg&zx=1483278695561","https://www.google.co.uk/gen_204?atyp=i&ct=&cad=&vet=10ahUKEwjPw-Ddi6HRAhXCMhoKHcQyDoYQsmQIEA..s&ei=ZwlpWI90wuVoxOW4sAg&zx=1483278695561",204,"GET","https://www.google.co.uk/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Sun, 01 Jan 2017 13:51:35 GMT"],"server":["gws"],"status":["204"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +93ms [{},false,"https://apis.google.com/_/scs/abc-static/_/js/k=gapi.gapi.en.FgPLF5SwqIU.O/m=gapi_iframes,googleapis_client,plusone/rt=j/sv=1/d=1/ed=1/rs=AHpOoo-9R8fkhlRsCMrG4wpDzgf1RI7BzQ/cb=gapi.loaded_0","https://apis.google.com/_/scs/abc-static/_/js/k=gapi.gapi.en.FgPLF5SwqIU.O/m=gapi_iframes,googleapis_client,plusone/rt=j/sv=1/d=1/ed=1/rs=AHpOoo-9R8fkhlRsCMrG4wpDzgf1RI7BzQ/cb=gapi.loaded_0",200,"GET","https://www.google.co.uk/",{"age":["504093"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["43225"],"content-type":["text/javascript; charset=UTF-8"],"date":["Mon, 26 Dec 2016 17:50:07 GMT"],"expires":["Tue, 26 Dec 2017 17:50:07 GMT"],"last-modified":["Fri, 02 Dec 2016 02:44:02 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-frame-finish-load +72ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +1ms [{},["https://www.google.co.uk/images/branding/product/ico/googleg_lodp.ico"]]
  nightmare:log did-stop-loading +1ms [{}]
  nightmare:actions .screenshot() +1ms
  nightmare:log subscribing to browser window frames +1ms
  nightmare:log altering page to force rendering +0ms
  nightmare:log did-get-response-details +58ms [{},false,"https://www.google.co.uk/images/nav_logo242.png","https://www.google.co.uk/images/nav_logo242.png",200,"GET","https://www.google.co.uk/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"cache-control":["private, max-age=31536000"],"content-length":["16786"],"content-type":["image/png"],"date":["Sun, 01 Jan 2017 13:51:40 GMT"],"expires":["Sun, 01 Jan 2017 13:51:40 GMT"],"last-modified":["Wed, 14 Dec 2016 20:30:00 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.google.co.uk/gen_204?v=3&s=webhp&atyp=csi&ei=ZwlpWI90wuVoxOW4sAg&imc=4&imn=4&imp=2&adh=&xjs=init.47.21.sb.30.spch.6.p.4.foot.3.jsa.1&ima=2&rt=xjsls.51,prt.90,iml.105,dcl.93,xjses.219,jraids.249,jraide.254,xjsee.301,xjs.301,ol.4937,aft.104,wsrt.622,cst.57,dnst.23,rqst.126,rspt.49,sslt.34,rqstt.442,unt.362,cstt.385,dit.712","https://www.google.co.uk/gen_204?v=3&s=webhp&atyp=csi&ei=ZwlpWI90wuVoxOW4sAg&imc=4&imn=4&imp=2&adh=&xjs=init.47.21.sb.30.spch.6.p.4.foot.3.jsa.1&ima=2&rt=xjsls.51,prt.90,iml.105,dcl.93,xjses.219,jraids.249,jraide.254,xjsee.301,xjs.301,ol.4937,aft.104,wsrt.622,cst.57,dnst.23,rqst.126,rspt.49,sslt.34,rqstt.442,unt.362,cstt.385,dit.712",204,"GET","https://www.google.co.uk/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34\""],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Sun, 01 Jan 2017 13:51:40 GMT"],"server":["gws"],"status":["204"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log unsubscribing from browser window frames +34ms
  nightmare:actions .screenshot() captured with length 361068 +467ms
  nightmare electron child process exited with code 0: success! +51ms
ERROR: TypeError: Cannot read property 'code' of undefined
  nightmare electron child process not started yet, skipping kill. +1ms` Hey Ross,

Thanks for your answer. The code posted by Daniel originally was mine :)
The update here works a treat and I get the then-able nature of Nightmare now.

Thanks again for your help & please close the issue.    Hi,
that's not really an issue I think but don't know where else to ask:
Coming from phantomjs (but with poor general knowledge) I tried to run the Yahoo search example in a shell, on Windows, connected to an Ubuntu Server on which nightmare resides, the Ubuntu server runs in a VM. Result: No errors, but also no console output. Only the simplest hello-world-output worked.
After hours of research I found issues regarding nightmare & vfb on Ubuntu Server. So I thought it might be a good idea to try the thing with Ubuntu Desktop VM.
Again on Windows I fired up the shell, connected to the Ubuntu VM, tried the Yahoo Search example - nothing.
Then tried the example in **a shell on the Ubuntu Desktop** - voila! Worked! :-)
Now please let me understand why it seems to work only in a shell on the Ubuntu Desktop but not in a remote shell? What can I do to get it to work in a remote shell? Thanx!
EDIT: Actually in the long term I would like to get my project to work on the Ubuntu server, without any onscreen user interactions. Quick question, what does the config say? Are you setting 'show' to true? Because I'm using nightmare for tests, and is being pushed to a CI (Which is similarly, a shell ONLY env). And it works. With ```show: false``` it's the same: works on the Desktop but not in the remote shell. Understood. In the CI containers, I think they install Xfce / X server - something that has display capabilities. Try installing them to the shell OS and then run the nightmare script. This is called 'headless running'

You can also check:

https://github.com/segmentio/nightmare/issues/224

I suggest this issue to be closed @rosshinkley  Hmm... so in my case it would require to install Xfce or something similar on the Ubuntu server, right?
Is there a way to get nightmare scripts running with this combination, while developing:
- nightmare and nodejs reside on Ubuntu server with Xfce
- Putty shell (connected to that Ubuntu server) is executed on Windos
- want to manually test nightmare scripts in that Putty shell  So I am new to Nightmare, I am trying to simply run a few checks on my staging environment and for whatever reason I am getting very inconsistent results. For the following code:

```javascript
const Nightmare = require('nightmare')


function createNighmare (options) {
  
  return Nightmare({
          typeInterval: 20,
          width: 1600,
          height: 800,
          x: (options.top || 0),
          y: (options.left || 0),
          // webPreferences: {
          //   partition: 'persist: testing'
          // },
          // fullscreen: true,
          // openDevTools: {
          //   mode: 'detach'
          // },
          show: true
        })

}

function loginToJiveweb (nightmare, {username, password}) {

  return nightmare
    .goto('https://my.staging.jive.com')
    .wait('form[id="jlf"]')
    .type('input[id="username"]', username)
    .type('input[id="password"]', password)
    .click('form button#go-button')
    .wait('#tos-accept-button')
    // wait for page to render entirely
    .click('#tos-accept-button')
    .wait('.dashboard')
    .evaluate(function () {
      return true
    })
    .run(function () {
      console.log('done')
    })
    .then(function () {
      console.log('something was promised')
    })
}
```
It runs everytime however, the .click('form button#go-button') is inconsistent. Soemtimes it clicks when the button is there and soemtimes it does not. Being as this is the very start of my app I cannot test anything else without this working consistently. Any help or thoughts? 

Here is the debug logs which appears to be trying to run the click
```
$ DEBUG=nightmare:actions* node tests/callTesting/calls.test.js
something was promised
  nightmare:actions .wait() for form[id="jlf"] element +0ms
  nightmare:actions .type() notactualemail@gmail.com into input[id="username"] +743ms
  nightmare:actions .type() password into input[id="password"] +506ms
  nightmare:actions .click() on form button#go-button +1s
  nightmare:actions .wait() for #tos-accept-button element +2ms
done
```
Appreciate any help Maybe try waiting for it before clicking on it?  @jekku I am confused, I am waiting for it before clicking:

```
.wait('#tos-accept-button')
    // wait for page to render entirely
 .click('#tos-accept-button')
```    I have an issue similar to #555, but I'm not sure it's the same cause so I'm opening a new issue. I'm using `nightmare v2.9.0`. When the following code runs, it takes the screenshot, and "screenshot taken" is loaded to the console - but the window is never closed, `run()` is never called. If I enter a path like `nightmare.png` instead of the callback, it works. But the callback seems to freeze Nightmare.

Should I be returning something other than `true` from my callback, or calling another method inside my `screenshot()` callback to tell Nightmare to keep moving down the chain?

I tried [one suggestion](https://github.com/bahlo/nightmare/commit/31b17abdf53931cec87cca27b5e2d1f226b611df#diff-bc4eacf94ad1a8e7c9bea8b6b6451251R53) from #555 but no dice.

My end goal from the screenshot callback is to save the screenshot to AWS S3, directly inside the callback. But the problem exists without even having any of the S3 `putObject()` code in the callback.

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });
nightmare
    .goto('http://www.goldencityfooddelivery.com/index.php?main_page=index&cPath=14')
    .select('select[name="products_id[573]"]', '1')
    .click('#submit2')
    .wait('#cartDefaultHeading')
    .screenshot(function(something, theBuffer) {
        console.log('screenshot taken');
        return true;
    })
    .end()
    .run(function (err, nightmare) {
        if (err) return console.log(err);
        console.log('Done!');
    });
``` Instead of specifying the 'done' callback exclusively, specify the path and a simple callback

```js
const path = '/some/path/someFileName.jpg';
nightmare.screenshot(path, () => console.log('screenshot taken'));
```

Correct me if I'm wrong, but .end(), is also a thenable which you can use to do something like:

```
nightmare.screenshot(path, () => console.log('screenshot taken'))
  .end()
  .then(() => {
    s3Library.uploadToBucket(path); // LOL just guessing some API function names
  });
``` Please update me. I usually use async-await / generators for nightmareJS but I hope this works for you. @rosshinkley https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L600

I think the current branch still does. It just isn't documented. The top level callback is bubbled down as a callback to fs.writeFile.  I've seen several threads and issues about mimicking a user hitting the enter or delete keys, but can't find anything about arrow keys. I've already tried converting the keycode values to hex ie. `40`, which is the down arrow on a Mac, would be `\u0028` I suppose, but that is `(`. I tried every variation I could find, including a hex value I found in some Apple native API, can't find anything that works for arrow keys in Nightmare.js.

So, is this even possible? 

Also, is this still the way to go about it? This actually returns an error: `Cannot read property 'focus' of null`
````js
`.type('document', '\u000d')`  ```javascript
.wait(function (done) {
        setTimeout(() => {
            var jsAlert = document.querySelector('.js-alert')
            var btn = document.querySelector('#sso_submit')
            if (jsAlert != null) {
                done(true);
            }
        }, 500);
    })
```
wait is tiemout!!!
I think wait `.js-alert` in `body`,continue next!!!please,tks! I think this is a good site!!!

https://stackoverflow.com

because this is not the right place for your banters!!  I have updated the link to the electron documentation to match the version that is specified in [package.json](https://github.com/segmentio/nightmare/blob/master/package.json) file.

This is relevant since the electron 1.4.4 documentation describes the option of specifying a custom page size when generating PDF-files.  In certain cases in angular, if there is a select box with an event listener that has no options populated and an event if dispatched, it will trigger change detection within angular, which will throw errors and cause electron to crash/freeze. @reinpk What do you mean by test case? Like a unit-test? Or a codepen that shows the issue? @reinpk This issue might be difficult to reproduce in a unit-test since it's an interaction between angular2 and nightmare, afaik. I'll do my best to isolate the underlying cause over the next couple weeks.  duplicate of #923 
Nobody replies at nightmare-download-manager repo so I'll still repost it here. also here's the snippet that triggers it.

If I go directly on that url (same window) it does fine (but not in every case).
but there's situations, where javascript generates URL and I have to click on the item itself and I just can't get out of this.

```
var Nightmare = require('nightmare');

require('nightmare-download-manager')(Nightmare);

var nightmare = new Nightmare({
  show: true,
  webPreferences: {
    images: false,
    webgl: false,
    plugins: false,
    webSecurity: true,
    allowRunningInsecureContent: false
  }
});

nightmare.downloadManager();

nightmare.on('download', function (state, downloadItem) {
  console.log(state);

  if (state === 'started') {
    nightmare.emit('download', path.join(__dirname, downloadItem.filename), downloadItem);
  }
});

nightmare
  .goto('about:blank')
  .evaluate(function() {
    var el = document.createElement('a');
    el.href = 'http://download.thinkbroadband.com/5MB.zip';
    el.target = '_blank';
    el.click();
  })
  .waitDownloadsComplete()
  .then(function () {
    console.log('all done');
  })
  .catch(function (err) {
    console.log(err);
  });
``` Can you set the partition to be persistent then?

```js
webPreferences: {
  partition: 'persistent: downloader'
}
``` It's the same.

```
webPreferences: {
  partition: 'persistent: downloader'
}
```

or

```
webPreferences: {
  partition: 'persist: downloader'
}
```

Still bubbles up download dialog. I think problem is in session itself. It works only when I set "partition: null".

Tested also this example and does not work as well (from documentation).
```
Nightmare.action('clearCache',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('clearCache', function(done) {
      win.webContents.session.clearCache(done);
    });
    done();
  },
  function(done) {
    this.child.call('clearCache', done);
  });

Nightmare()
  .clearCache()
  .goto('http://example.org')
  //... more actions ...
  .then(function() {
    // ...
  });
```

EDIT: it just hangs. Output is:
```
Mon, 19 Dec 2016 18:47:49 GMT nightmare queuing process start
Mon, 19 Dec 2016 18:47:49 GMT nightmare queueing child action addition for "clearCache"
Mon, 19 Dec 2016 18:47:49 GMT nightmare queueing action "clearCache"
Mon, 19 Dec 2016 18:47:49 GMT nightmare queueing action "goto" for about:blank
Mon, 19 Dec 2016 18:47:49 GMT nightmare queueing action "evaluate"
Mon, 19 Dec 2016 18:47:49 GMT nightmare running
Mon, 19 Dec 2016 18:47:49 GMT nightmare:log adding action for clearCache
```  Since the initial implementation of `FrameManager`, Electron has added an API for Chromium's remote debugging protocol, which can visually highlight a portion of the page. This change uses that functionality to force a new frame to be rendered, which is much more reliable than the way Nightmare currently tries to force new frames to render by fiddling around with the DOM (see people experiencing problems with this in #555, #736, #809). It also has the benefit of not doing anything page content can observe, ensuring that any JS or CSS won't modify the page in response to Nightmare's attempt to take a screenshot.

This also adds a timeout. We should never hit it when using the debugger, but I figure itâ€™s better to be safe than sorry here, especially after the hangs people have been experiencing.

In future versions of the remote debugging protocol, it will be possible to directly capture an image of the page, but that feature is still experimental (so it could be removed) and Electron does not yet support it anyhow. Something to keep in mind for future changes, though.

This is an alternative solution to the one in 53dee8a2ad88ea656d2b48504dbe66ff5287d0ab (currently on the `screenshot-with-offscreen-rendering` branch). That method (using Electron's new "offscreen" rendering mode) is *much* faster than this and vastly simplifies the code, but has more ways it can fail and has other side effects. If that approach looks better, I can submit it as a PR. We can also look into combining the two if the side effects are acceptable. Note the offscreen rendering branch has window sizing issues as a result of an Electron bug (https://github.com/electron/electron/issues/8224), so itâ€™s probably just untenable for now. > if you're using the remote debugging protocol, doesn't that mean you can't use the debugger (or have the development tray) open at the same time? If I'm not mistaken, this is the same issue that nightmare-upload has.

ðŸ˜² I was entirely unaware of that as an issue and hadnâ€™t tested it. The good news is that if a user has opened the local debugger before screenshotting, screenshots still work (see the `catch` clause here: https://github.com/segmentio/nightmare/pull/927/files#diff-bc4eacf94ad1a8e7c9bea8b6b6451251R83). The bad news is that users canâ€™t open the local debugger *after* screenshotting. Iâ€™ve added another commit that detaches the debugger as soon as weâ€™re done, which seems to resolve that.

Since youâ€™ve seen this issue before, itâ€™d be great if you give it a go as well, @rosshinkley. Sweet! Glad this can improve things a little.  I want to run evaluations with jQuery calls (way easier to grab things from DOM) but the issue is I did a 

```
.evaluate(function () {
    if (typeof jQuery != 'undefined') {  
        // jQuery is loaded => print the version
        return jQuery.fn.jquery;
    } else {   
        //need to inject jQuery
        return  "false"; 
    }
})
```

This tells me if jQuery is added or not but I don't want to run the 

```.inject('js', 'jquery.min.js')```

if there is already a version on because I don't need the chance that the rest of the page doesn't work.
I know I "should" be safe if I just use the latest version of jQuery each time, but all I need is a page to have a deprecated functions or some other support issues
 Thanks, I didn't realize that the evaluate was passed as a parameter to the next piped instruction like that.  I wrote a simple script that will set viewport and return width/height. See below:

```javascript
var Nightmare = require('nightmare');
var fs = require('fs');

function write(path, data) {
  return fs.writeFileSync(path, JSON.stringify(data));
}

var nightmare = Nightmare();

nightmare
  .goto("https://www.google.com")
  .wait(3000)
  .evaluate(function() {
    var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    return {w:w, h:h};
  })
  .then(function(d) {
    write('C:/1.txt', d);
    return nightmare
      .viewport(d.w + 1200, d.h + 1200)
      .evaluate(function() {
        var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        return {w:w,h:h};
      })
      .then(function(d){
        write('C:/2.txt', d);
      })
      .then(function(){
        nightmare.end(function(){
          console.log('Done!');
        });
      });
  });

```

It works well in Windows 7, when I test it, here's the result:
 * 1.txt
 ```
{"h":542,"w":784}
```

 * 2.txt
 ```
{"h":1684,"w":1968}
```
<hr>
But when I add a task in Windows 7 `task scheduler`, which call the same script. The result is:

  * 1.txt
 ```
{"h":542,"w":784}
```

 * 2.txt
 ```
{"h":730,"w":1028}
```


It's weird and I have no idea what's the issue, can you help check on this issue? I was using the same user. 
Actually I had a work around to achieve my requirement, but for this specific issue, I have no idea why it happens. 


> On Dec 16, 2016, at 7:57 PM, Ross Hinkley <notifications@github.com> wrote:
> 
> Is your scheduled task running as the same user? Could he default window size be different for the user that runs the scheduled task, and that the page renders differently result in a different client size?
> 
> What are you trying to do that this is an issue?
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub, or mute the thread.
> 
 I also encountered a similar problem. I'm here to solve this.
```
.viewport(parseInt(width), parseInt(height))
```
  Whenever I'm using webPreferences.partition option with random string (without 'persist:' prefix), nightmare-download-manager always asks for download path to be saved instead of handling it automatically. Even by debugging, breakpoints are never hit as well. May I ask what's the problem? Any thoughts?  Anyone?  Hi, 
I have a docker image with xvfb installed (https://github.com/segmentio/nightmare/issues/224#issuecomment-225887320)
And it's working.

Now when my user hit a route on my nodejs/expressjs app a function running a nightmare script is called.
```
export const startScript = (params, callback) => {
   const nightmare = new Nightmare()
   
   try{
      main(nightmare).then(result => {
         nightmare.end().then(() => {
           callback(result)
         })
     })
   } 
   catch(ex){
      console.log('ex : ', ex);
   }
   async function main(nightmare, data, started_at) {
       // do a lot of stuff like
          const pageInfo = await nightmare.goto('http://www.google.com');
       // ......
      return 'ok'
   }

}

```
When i call the route once it's okay. But if multiple user call the route (2-3 users) i see a lot of timeout in `nightmare.wait()` function even if i set `waitTimeout` to 3 minutes.
And a lot of script never end.
This script, when launched alone, take 30 sec to execute.

Is it possible to run multiple nightmare script on the same machine ?
I was thinking that maybe i haven't allocate enough CPU or RAM but the server (a 1 cpu, 1go RAM on DigitalOcean) never hit the 60-70%.

Any idea what i should do ?  Thanks ! Before the `Error: .wait() timed out after 180000msec`
nightmare report 
```
nightmare:log did-stop-loading [{}] +3ms
nightmare:log crashed [{},false] +4ms
```
And it seems to stop/hang all other electron process running on the machine. I will try with `DEBUG=nightmare*,electron*`.
I already tried setting a random partition name for each instance (following @Mr0grog advice here : https://github.com/segmentio/nightmare/issues/493#issuecomment-265684086)
But it doesn't change anything. 
I come back to you by the end of the week ! Thanks @rosshinkley 
 @GautierT, did you ever figure this out?  I'm having the same problem.  One instance/process of node/NightmareJS runs great.  However, running more than one gives me plenty of issues.  Usually only one of the parallel executions will successfully run.  The others give me timeout errors.  I'm experiencing the same behavior when using `Xvfb` and `xvfb-run`. Adding a bit more info:

The random partition name didn't seem to help me either.

I don't seem to experience this problem when running my NightmareJS script on my local machine (OS X) natively.  (I just ran 6 parallel processes of the script via Terminal, and they worked as expected)

I only experience this problem when executing multiple processes via Xvfb on CentOS 6.  I haven't tested other platforms. And just to make it crystal clear, we're not using Docker, so this problem doesn't appear to be limited to that environment.  How to set cookies before loading the page? I need it for authtentication to load the page. If I set cookies before `.goto()` nightmare just exit process:

```  
nightmare:actions cookies.set() +276ms
  nightmare:log setting cookie: {"url":"","name":"test1","value":"test_value","path":"/","secure":true} +1ms
  nightmare electron child process exited with code 0: success! +42ms
``` It does not seem possible to `cookies.set(...)` before a page has been loaded.

My workaround is to use a dummy `.goto('about:blank')` first, then setting the cookies in the following `.then()` block.

Note that you **MUST** use the `url` parameter of the cookie if you are setting a cookie that is different than the current browser URL. @rosshinkley  Navigating to `about:blank` initially would work.

Alternatively, you could have `cookies.set` check if a current `session` exists, and if not just treat it as a `.goto('about:blank').then(() => cookies.set(...))` instead. I ran into this issue as well. Although the reason I encountered it is that I could never get the partition persist under web preferences to work. Each subsequent (new) instance of Nightmare after the initial one, which was a login failed to pick up the cookies from the previous session... I'm not sure why at the moment. Has anyone gotten this to work yet? @tmcleroy 
As a temporary measure, I figured out a way around the issue by subscribing to the 'did-start-loading' event and throwing my cookies. I'm sure there are cleaner solutions. In particular I couldn't figure out how to pass in the url and cookies as params into my custom action so I used the node-persist package to write and the values out:

```
Nightmare.action('preloadCookies',
  function(name, options, parent, win, renderer, done) {
    parent.on('did-start-loading', function(url, sessionCookies) {
      if (sessionCookies) {
        parent.emit('log', 'Preloading cookies');

        for (var i = 0; i < sessionCookies.length; i++) {
          var details = Object.assign({ url: url }, sessionCookies[i]);
          win.webContents.session.cookies.set(details, function (error) {
            if (error) done(error);
          });
        }
      }
      parent.emit('did-start-loading');
    });
    done();
    return this;
  },
  function(done) {
    this.child.once('did-start-loading', done);
    let cookies = storage.getItemSync(process.env.COOKIES_STORAGE);
    let url = storage.getItemSync(process.env.URL_STORAGE);
    this.child.emit('did-start-loading', url, cookies);
  });
```
To use it: 

```
Nightmare().preloadCookies().goto(url);
```
If someone can help me figure out how to pass the values into the action invocation instead of relying on node-persist to write and pull them out, that would be optimal..  @thebentern
Have you tried this?

```js
Nightmare.action('preloadCookies',
  function(name, options, parent, win, renderer, done) {
    parent.on('did-start-loading', function(url, sessionCookies) {
      if (sessionCookies) {
        parent.emit('log', 'Preloading cookies');

        for (var i = 0; i < sessionCookies.length; i++) {
          var details = Object.assign({ url: url }, sessionCookies[i]);
          win.webContents.session.cookies.set(details, function (error) {
            if (error) done(error);
          });
        }
      }
      parent.emit('did-start-loading');
    });
    done();
    return this;
  },
  function(cookies, url, done) {
    this.child.once('did-start-loading', done);

    this.child.emit('did-start-loading', url, cookies);
  });

let cookies = storage.getItemSync(process.env.COOKIES_STORAGE);
let url = storage.getItemSync(process.env.URL_STORAGE);

Nightmare().preloadCookies(cookies, url).goto(url);
```

I was playing with cookies today and I managed to set they as this:
```ts
(async function main() {
    let cookies = await nightmare
        .cookies.set({
            url: "https://www.navossoc.com",
            name: "myKey",
            value: "myValue"
        })
        .goto("https://www.navossoc.com/tests/cookie.php")
        .cookies.get();

    console.log(cookies);
})();
```

**Environment:**

> { electron: '1.4.15',
>   chrome: '53.0.2785.143',
>   nightmare: '2.9.1',
>   os: 'win32' } @navossoc This seems to work, just add `url` property.  if I set custom headers here:
`.goto(url, { 'mail': 'blabla@mail.com' })`
it only used for url request, but not for other page's resources like async backend api calls.
Is there any way to set headers for external resources calls ? I'm trying to figure out the code snippet here, my attempts fail/ breaks from jump street. 
```window.__nightmare = {};
__nightmare.ipc = require('electron').ipcRenderer;

Nightmare.action('customHeaders', 
   //define the action to run inside Electron
   function(name, options, parent, win, details, callback) {
    //call the IPC parent's `respondTo` using the sample Action clearCache...
   // parent, win are all null options is a function, 
	parent?  webRequest.onBeforeSendHeaders(filter, (details, callback) => {
	  details.requestHeaders['auth_token'] = token
	  callback({cancel: false, requestHeaders: details.requestHeaders})
	})
   });
```
Trickery, it be either beneficial to get a sample or something a little more auto-magical , cause I'm unable to get the header to work otherwise.   Let me see what I can do without revealing my client's details. I got the function callback to work properly in basic electron main.js sample.  But still no luck on populating the request parameters so the page has them on the request. I don't think it's like this item, cause electron does the same thing. 
So I think it has to do with the http GET request on the server, even though I'm putting the (session auth creds by the way) in the header, it might be rejecting them for security reasons. IDK. 
I'm able to do that with JMETER http GET or POSTMAN, just add the auth creds to the header. 
What is different with how electron handles the session's custom request headers? 
let me see if I can create a sample and upload. thanks.  Awesome work btw.   The current behavior uses electron default, which creates a partition
for storage which persists between instances. This makes sense for
electron but not necessarily for primary use cases of Nightmare.

This change sets the default partition to be a non-persistent partition
but allows a user to opt back into persistence with simple configuration options.

Fixes segmentio/nightmare#916

## 4 new passing tests, all others green
<img width="675" alt="screenshot 2016-12-05 16 59 20" src="https://cloud.githubusercontent.com/assets/10974/20906254/ba9ad368-bb0c-11e6-889e-4b83fe75aba2.png">

## Preview of wiki changes
![screenshot 2016-12-05 16 53 50](https://cloud.githubusercontent.com/assets/10974/20906235/a8c32604-bb0c-11e6-816f-ca387fbf1b04.png)

  I would like to build a plug-in for web page automation. The result I need to deliver is when user type a keyword on the plug-in, there will be a window popping up and showing the process of manipulating an [e-commerce website](www.taobao.com).  The target user would be ordinary people who don't use terminal.  Is it possible to run nightmare.js not through node on terminal but through other system with GUI? I am a junior programmer. Hope someone can shed me some light. Thanks for your response. In the end, I used jQuery for the plug-in. It works quite well as well.   The goal of my sketch is to get product information from an e-commerce website. The code is very similar to the yahoon example code but the result is always null. I tried to put console.log to debug and realized the mistake might lay in the querySelector. 
Below is the code if someone has the time to take a look. Really appreciate it. 


```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });

nightmare
  .goto('https://www.taobao.com')
  .type('form[action*="/search"] [name=q]', 'hellow kitty')
  .click('form[action*="/search"] [type=submit]')
  .wait(2000)
  .evaluate(function () {
    return document.querySelector('.row.row-2.title a')
  })
  .end()
  .then(function (result) {
    console.log(result)
  })
  .catch(function (error) {
    console.error('Search failed:', error);
  });
```
 [Please use this wonderful website](https://www.stackoverflow.com) Next time for these kinds of questions.

You are returning the anchor tag from your queryselector. Maybe you should return its href instead, or more meaningful string data.

```js
return document.querySelector('.row.row-2.title a').href;
``` @rosshinkley when I use element.src it return null, it's seems not work @canhongpoxiao this is not the venue for these kinds of questions. Go to Stackoverflow.

You cannot directly call the property of the DOMElement. You need to something like .getAttribute('src')  Any idea why #135 (the improved screenshot function) with multiple file formats was removed?  That feature was based on functionality in PhantomJS. In 2015, Nightmare was rewritten to use Electron, which, at the time, didnâ€™t have built-in support for outputting formats other than PNG. It does support some others now, though (see http://electron.atom.io/docs/api/native-image/) so you could write a PR to add support back in! HI, ive open PR #950 to support jpeg,  looking forward for some feedback :)  We need to override timeout length in custom `wait` methods. Is there a way how to do it now?

I don't mind providing a PR but when I opened `actions.js` and checked the `wait` method I didn't realize how does the `done` get in the arguments. Can you explain it to me?



 Yes, that was my question. Thx you, it's solved it. :D  When trying to change the viewport to a large value in order to do a full screenshot of a page on a somewhat heavy website the screen goes white and nightmare stops executing. Here's the code to cause it to crash on Windows 10 x64.

```
var Nightmare=require('nightmare');
var nightmare=Nightmare({show:true,maxHeight:100000,maxWidth:10000});

nightmare.goto('http://bleacherreport.com/articles/2677551-the-oral-history-of-the-2006-ohio-state-michigan-game-of-century?utm_source=cnn.com&utm_medium=referral&utm_campaign=editorial').viewport(734,18000).then(function(result){console.log(result)}).catch(function(error){console.error('Search failed:',error);});
```
 When viewport is set to 16384 it works but 16385 it stops working. So there's a limit somewhere Also it happens on any website even a blank one. 16384 = 2^14 so doesn't seem too random. some buffer deep in electron or chromium somewhere probably has a max length I tried looking through the electron source (which includes the source for chromium) for "16384" or "16" but couldn't find anything unfortunately. Do you know where in the source the limit would be? That's great, you pinned it down fully. Regarding the plugin how would this work exactly? Is it a scroll based solution? Scroll based solutions will have issues with fixed elements usually The scroll based solution is currently what I have to rely on at the moment, I do a loop of all elements with a computed position of fixed and change it to static before scrolling but as you said there are definitely many scenarios that this still doesn't cover. 

Is there a way to get a recompiled chromium with max_texture_size_ set to something larger to work on a virtual frame buffer like xvfb? I wonder how phantomJS is able to take screenshots larger then 16384, If I increase max_texture_size_ it looks like I'll probably hit some hardware limit. Right off the bat PhantomJS has a completely different way of rendering which is not easily translatable to chromium. Maybe I'll look into this more when I have time later on, it's too time consuming at the moment for someone with no knowledge on chromium or webkit development.  I don't need to wait for images and assets, I need to call code at the dom-ready, but I can only listen for the event, not continue with the queue.

There is any way to change the "done" policy for the goto function?

It's possible to change this behaviour with a plugin? Or add a gotoDomReady function? I added a new function called **gotoReady** that continues with the execution at dom-ready, without waiting for **did-stop-loading**.

I don't know exactly why, but to continue with the execution at **dom-ready** you have to emit a **did-stop-loading** event. Anyone knows why? I haven't found nothing related with **did-stop-loading**.

What I have modified from "goto" to "gotoReady":
http://i.imgur.com/zez2ldx.png

Add "gotoReady" action script:
https://gist.github.com/anonymous/37366335a29c85b2cde4fd810f5e4767 The "gotoReady" only affects the page you are opening. But if you click in a submit button and the page changes alone, the next one will load only in "LOAD" event.

Another option, is to call "did-stop-loading" at every "dom-ready". Is not the clean way to do it, but for me it's ok until I found a cleaner way to do it.

The script, you must call **loadOnDOMReady** before the **goto**:
https://gist.github.com/anonymous/6c507a0aea7e85730bacd319c08a3328

Will be nice some property in the "goto" function to change the load policy. Something like:

```
nightmare
  .goto('http://google.com/', [], Nightmare.CONTINUE_LOAD)
  .goto('http://google.com/', [], Nightmare.CONTINUE_DOMREADY);
```

or...

```
new Nightmare({
   'load_policy': Nightmare.CONTINUE_DOMREADY
});
``` Without this, some sites don't load, such as http://eluniversal.com.mx/
.. actually I quickly tried your loadOnDOMReady script from https://github.com/segmentio/nightmare/issues/904#issuecomment-262769328 and it doesn't seem to help in this case either. Actually it looks like I was starved for resources as several instances of electron were hung @jamie-pate what do you mean?

Sometimes you don't need to wait for "Load" event if you want to use something that is ready at DomReady event.

For all my cases DomReady is the fastest method. My use case is a crawler, which loops through many nightmare instances (one for each site)

Unfortunately some sites seem to hang the browser. I thought it was an issue where the site was just perpetually loading and never *did-stop-loading* but now I think it's something else. The specific case I was looking at seems to work after restarting linux (I had to hard reset because electron just wouldn't die!) @jamie-pate google cloud instances works fine with electron. If your machine has 4 cores, sumon only 4 electron and reuse them, don't close them when finish requests so you will be consuming resources to spawn them again.

Working with async.queue (or priority queue) helps.

After crawling a webpage clear cookies, application data and goto "about:blank" so the next page don't get the previous referer.

Don't clear cache so next crawling in that domain will be faster.

I'm getting good results with this practices. I was under the impression that the workflow had to be similar to 
```
nightmare
    .goto(url)
    .evaluate(function() {
        //Extract some data
    })
    .end()
    .then(function(result) {
        //store extracted data
    })
```

So something like this would be better?
```
var queue = ['some seed queue'];
function dequeue(chain) {
    var url = queue.pop();
    if (url) {
        chain = chain.goto(url)
            .evaluate(function() {
                //Extract some data
            })
            .then(function(result) {
                //store extracted data (including adding to the queue)
                setImmediate(dequeue.bind(null, chain));
            });
    } else {
        chain.end();
    }
}
// something more complicated than this, but you get the idea:
for (var i = 0; i < PARALLEL; ++i) { dequeue(new Nightmare()) }
```
where PARALLEL is the number of concurrent instances.
(I actually found 4 instances for 4 cores to be insufficient. N = cores * 3 is better for utilization since a lot of time is spent waiting for results from the wire) @jamie-pate right, a lot of time is spent in waiting. N maybe must be based on CPU usage.

Look, my crawler is something like this (i haven't tried the code):

```javascript
const cheerio = require('cheerio');

let concurrency = 4;
let clients = [];

/**
 * Get or instanciate a client
 */
let client = () => {
    // Search a free instance
    for(let i=0; i<clients.length; i++) {
        let client = clients[i];
        
        if(!client.running) {
            client.running = true;
            return client;
        }        
    }
    
    // Add a instance
    let newInstance = {
        running: true,
        nightmare: new Nightmare(),
    };
    
    clients.push(newInstance);
    return newInstance;
};

/**
 * Scan a url
 */
let scan = (url) => {
    let client = client();

    return client
        .nightmare
        .cookies.clear()
        .goto('about:blank')
        .then(() => {
            return client.goto(url);
        })
        .then(() => {
            return client.evaluate(function() {
                return document.documentElement.innerHTML;
            });
        })
        .then((html) => {
            let $ = cheerio.load(html);

            // extract data using cheerio
            let data = {};

            // free client
            client.running = false;

            return Promise.resolve(data);
        });
};

// Queue
var queue = async.queue((url, end) => {
    scan(url)
        .then(() => end())   // handle response
        .catch(() => end()); // handle error
}, concurrency);

// Add urls to queue
for(let i=0; i<100; i++) {
    queue.push('http://example.com/1');
}
```

So you don't have to call end() and close the instance. Actually I handle the operations with block instructions:

![blocks](http://i.imgur.com/uUS1EIP.png)

And there is a class called BrowserManager that instanciates Browser, a wrapper of Nightmare. Mk, well I'm going to run with this for now and stop hijacking the issue thread ;)

Thanks  Hi-

I'm having an issue when opening an MHTML file with Electron, that was originally saved via Electron. It seems to just show me a blank white page. As an example: [Here is the MHTML for geico.com](https://s3.us-east-2.amazonaws.com/cdn.formulaic.io/uploads/html/-KX9_-osY2mLtxdct5vA-0.mhtml)

Does Electron simply not support opening it's exported MHTML files, or am I missing something? It opens fine in Chrome...

Thanks!  Fixes #901 

In my understanding, all exported actions are bound to the nightmare object on instantiate. So this will work fine.

```js
yield nightmare.goto('https://some.tld/path/is/here').path(); // outputs /path/is/here
``` needs a test :) Oooh. Couldn't find one for the .url() so I thought this wouldn't need one. :D Okay I'll study your tests and make one. Test added. Waiting for CI results and second review. Thanks. <3 Done. :) Is there anything else that I need to add? :heart:  Hello. Am I still missing anything? :) @jekku Maybe you could add a little section in the README for this new function also? @justinmchase added. Thanks for the headsup.

:up:  @reinpk @rosshinkley the failing test comes from a different feature. :up:  :up:  :up: Thank you so much :heart:   Does this have breaking changes for anyone, boss? Why not just consider it an error case to pass a function into end? How is that better / different from just chaining thens after end?  Here's an example:

Working ( notice the .end() call )
```
nightmare
      .goto('http://yahoo.com')
      .wait(1000)
      .evaluate(() => 42)
      .end()
      .then((result) => {
        console.log(result); // Prints 42
      })
      .catch((error) => {
        console.error('Search failed:', error);
      });
```

NOT WORKING and freezing without doing anything
```
nightmare
      .goto('http://yahoo.com')
      .wait(1000)
      .evaluate(() => 42)
      .end(() => { console.log('code finished running'); })
      .then((result) => {
        console.log(result); // Statement never reached :(
      })
      .catch((error) => {
        console.error('Search failed:', error);
      });
```

I assume because some Promise is not chained properly, I have no idea why this is happening. This issue is distantly related to this issue here https://github.com/segmentio/nightmare/issues/660
Seems like more control over the *end()* is what we need.  action parent function only takes one argument

Fixes https://github.com/segmentio/nightmare/issues/897  Well, hello. I'm trying to submit form, wait for page load (redirect) and continue work there, but whenever I try to click on element, nightmare does not wait for page reload, but instantly continues queued tasks.

Could someone please add something like `waitForEvent('did-finish-loading')` feature? Or how can I do that?

Thanks! #481 is having exactly the same problem. While I tried the code snippet provided there, it does not help much. In examples, there's like goto(..).click(..).wait(..); <-- without this wait, it does not wait until form was submitted and does work instantly. What if I can't find pattern or I have two patterns, like authentication successful or not. What should I wait for? Anyways, I've managed it with nightmare-window-manager. calling waitWindowLoad(..) after click(..) worked fine. It would be nice to have such feature to wait for some specific events happen before executing another task (like the #481 provided). e.g: waitForEvent('dom-ready').then(...).
  Is it possible to load a page from a HTML string instead of going to an url? HTML string means:
var str="<html><head><title>sample page</title></head><body> Sample content</body></html>";
now is there anyway to avoid disk io overhead and render this without writing it to a file?
 you could spin up a tiny node server at `localhost:8080` (or any other port) in the same test file that just returns the string:
http://blog.modulus.io/build-your-first-http-server-in-nodejs

and then `.goto('localhost:8080')`  
The following code works with NightmareJS and NodeJS. However I don't want to just console.log my JSON result, but want to save my JSON result to a local file.

I am aware of the .html option within Nightmare but I don't want the entire page and I want it in JSON format. Any help on saving ticketData to a local file?

```
nightmare
  .goto('https://www.stubhub.com/')
  .wait(3000)
  .type('.inputbox', 'chicago bulls')
  .mouseover('.search-action-button')
  .click('.search-action-button')
  .wait(3000)
  .evaluate(function () {
    var ticketData = {}

ticketData.team = ([].slice.call(document.querySelectorAll('.event-title'))).map( function(x) {
  return x.innerText
});

ticketData.date = ([].slice.call(document.querySelectorAll('.date-stamp-month-dd'))).map( function(x) {
  return x.innerText
});

ticketData.price = ([].slice.call(document.querySelectorAll('.price'))).map( function(x) {
  return x.innerText
});

ticketData.url = ([].slice.call(document.querySelectorAll('.event-link'))).map( function(x) {
  return x.href
});

return ticketData;
  })
  .then(function (data) {
    console.log('Data = ' + JSON.stringify(data));
    return nightmare
  })
  .catch(function (error) {
    console.error('', error);
  });
```  Does nightmare can work on centos which has no desktop?
My system's version is Centos6.2 and node's version is  6.9.1. GCC is 4.8.5, nightmare's version is 2.8.0, electron's version is 1.2.5. When I run the yahoo's example on my centos server, it not works. I run with this cmd: 
    DEBUG=nightmare*,electron* xvfb-run --server-args="-screen 0 1024x768x24" node yahoo_demo.js
And the output is:
```
 nightmare queuing process start +0ms
  nightmare queueing action "goto" for http://yahoo.com/ +3ms
  nightmare queueing action "wait" +2ms
  nightmare running +1ms
  ....
  nightmare electron child process exited with code null: undefined +19ms
  nightmare electron child process not started yet, skipping kill. +1ms
```
  I'm very sad on this, and have been struggling for many days because it has no helpful error info. I do not know how to do next.  Very much hope to get your help. @rosshinkley 
```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: false });

nightmare
  .goto('http://yahoo.com')
  .type('form[action*="/search"] [name=p]', 'github nightmare')
  .click('form[action*="/search"] [type=submit]')
  .wait('#main')
  .evaluate( function() {
      return document.querySelector('#main .searchCenterMiddle li a').href
  })
  .end()
  .then(function (result) {
    console.log(result)
  })
  .catch(function (error) {
    console.error('Search failed:', error);
  });
```
And now when I try again, it just stucks here:
"
DEBUG=nightmare*,electron* xvfb-run --server-args="-screen 0 1024x768x24 -extension RANDR" node yahoo_demo.js
nightmare queuing process start +0ms
  nightmare queueing action "goto" for http://yahoo.com +4ms
  nightmare queueing action "type" +2ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +0ms

  (stuck here)
"
And when I press ctrl-c comand, it outputs:
"
...(shown above)
nightmare electron child process exited with code null: undefined +6m
/usr/bin/xvfb-run: line 171: kill: (24823) - No such process
" same issue, was working yesterday, no significant changes to my build since then (at least not to the nightmare part). 

Unsure if this is relevant, but at some point I accidentally left `show:true` when building/running, and got the same errors. 


```
  nightmare running +4ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +4ms
  nightmare electron child process exited with code null: undefined +2s
 // CTRL+C
 nightmare electron child process not started yet, skipping kill. +2s
```

nightmare start:
```
 const Nightmare = require('nightmare')
 const nightmare = Nightmare({
           show: false
    })
```


my dockerfile:
```
FROM node:latest

RUN apt-get update &&\
    apt-get install -y libgtk2.0-0 libgconf-2-4 \
    libasound2 libxtst6 libxss1 libnss3 xvfb

WORKDIR /app
COPY ./dist .
ARG NPM_TOKEN  
COPY .npmrc .npmrc  
COPY package.json .
RUN npm i
RUN rm -f .npmrc
COPY entrypoint /
RUN chmod +x /entrypoint
ENTRYPOINT ["/entrypoint"]

CMD DEBUG=nightmare node ./ygl-widget-scraper/index.js
```


entrypoint:

```
#!/usr/bin/env bash
set -e

# Start Xvfb
Xvfb -ac -screen scrn 1280x2000x24 :9.0 &
export DISPLAY=:9.0

exec "$@"
``` somebody found a workaround? A hint for debugging: 

You can try to call electron directly, which will usually yield a more detailed error message. 

In my case, the error was a missing library (libX11-xcb).  I am trying to bypass CSP in order to run some eval() code or spawn web workers.

I found this issue on electron: https://github.com/electron/electron/issues/3430
which suggests using `webFrame.registerURLSchemeAsBypassingCSP(scheme)`
http://electron.atom.io/docs/api/web-frame/#webframeregisterurlschemeasbypassingcspscheme

I have tried to do that in a preloader script but it doesn't seem to affect the page's policy.

Have you ever faced this or have any clue what might be wrong or a possible solution?

Thanks! Yes, i have `webSecurity` set to false.
About the preloader, i followed the default preloader in the repo and i have this:

``` javascript
__nightmare.electron = require("electron");
__nightmare.ipc = __nightmare.electron.ipcRenderer;
__nightmare.webFrame = __nightmare.electron.webFrame;
__nightmare.webFrame.registerUrlSchemeAsBypassingCsp("http");
...
```

Not sure if what i am doing makes any sense, still pretty new to electron.
I also tried to do the same on the server-side(main process?) but couldn't find a reference to the underlying electron instance in the nightmare object.
  Is there a way to access electron instance so that we could fire keaboard events:
```

browserWindow.webContents.sendInputEvent({
  type: "keyDown",
  keyCode: '\u0008'
});
```

The example is from https://github.com/electron/electron/issues/2269 I wanted to handle an upload dialog and hoped there would be a way using electron directly. Is there another way? I'd also like to be able to access the webContents of the BrowserWindow instance if this is possible? I need it for the same purpose as @zatziky (simulating real keyboard inputs).

And also simulating real pasting (but this also requires access to electron clipboard object):
```javascript
const {clipboard} = require('electron')
clipboard.writeText('Example String')
// ...
browserWindow.webContents.paste()
```

**Edit:** Ahh, thank you @rosshinkley - I thought `.action()` only allowed javascript evaluation, but taking a proper look at the documentation I see that @zatziky and I should be able to do something like this:
```javascript
Nightmare.action('sendKeyDown',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('sendKeyDown', function(unicodeValue, done) {
      win.focus();
      win.webContents.sendInputEvent({
        type: "keyDown",
        keyCode: unicodeValue,
      });
      win.webContents.sendInputEvent({
        type: "keyUp",
        keyCode: unicodeValue,
      });
      done();
    });
    done();
  },
  function(unicodeValue, done) {
    this.child.call('sendKeyDown', unicodeValue, done);
  });

nighmare
  .goto('http://example.org')
  // ...
  .sendKeyDown('\u0008')
  //...
```
(Haven't tested yet, based it on an example in #379 - thanks @shadowmint!)

**Edit 2:** Hmm, not working. Can anyone spot where I've went wrong? Will update this comment if I find the correct way to do this. I've also tried adding a `setTimeout` with a `keyUp` in it after the `keyDown`, but that doesn't seem to work either.

**Edit 3:** Fixed! Turns out you need to focus a window before you can `sendInputEvent` - so I've added it to the code above (my window wasn't focused because dev tools opens up after it). Reported  this need for `focus` to the [electron repo](https://github.com/electron/electron/issues/8299). Also added `keyUp` after the `keyDown` (in my actual code I put the `keyUp` in an 50ms `setTimeout` to hopefully make the simulation more accurate). @josephrocca I'm not able to get your action to work. Do you have a complete example? Help would be much appreciated  @ecrmnn Here's the code with a 50ms timeout (not sure if this actually makes a difference, pretty sure it worked for me without the delay):

```javascript
Nightmare.action('sendKeyPress',
  function(name, options, parent, win, renderer, done) {
    parent.respondTo('sendKeyPress', function(unicodeValue, done) {
      win.focus();
      win.webContents.sendInputEvent({
        type: "keyDown",
        keyCode: unicodeValue,
      });
      setTimeout(() => {
        win.webContents.sendInputEvent({
          type: "keyUp",
          keyCode: unicodeValue,
        });
        done();
      },50);
    });
    done();
  },
  function(unicodeValue, done) {
    this.child.call('sendKeyPress', unicodeValue, done);
  });
```

It works for me with tab and backspace, but not for enter/return (`\u000d`) for some reason. It sort of stumped me so I've moved onto another project for now. If you make any progress, please let me know! Would be really nice if nightmare had a `sendKeys` sort of thing like selenium that abstracted all this stuff away. @josephrocca Thanks. I'll try it out. I'm trying to trigger left and right arrow keys. Hopefully I'll get it working @josephrocca hey just wondering have you managed to get arrow keys working?
 No, sorry - bit of a mystery :/ Did some of you manage to use the `clipboard` API or `<webview>.paste()` for `paste` events? 
Made [a question about it on SO](http://stackoverflow.com/q/43584851/2256325), leaving a note here in case someone knows *how-to*.

**Edit:** Got it working! (and [posted a answer](http://stackoverflow.com/a/43602414/2256325) with what worked for me)  With `nightmarejs` how to enter a file in a file input and confirm it?

It's for automation of an attachment (e.g. in email). The file input I mean is this:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/7Usqa.png Up for this. This is important in testing websites. Unless there could be alternatives using native electron, or if nightmare exposes electron.dialog().
  Howdy!

I'm just starting on Nightmare, looks promising, but our project is stuck at node 0.12 for some dependency issues.

I'm wondering if it's possible to run it under 0.12 if you guys have some knowledge on a project that does that? I'm thinking that porting it with babel perhaps could work? Thank you for the response.

In this case it seems there is space for a `nightmare-babel` sort of package, but then it would be a different project. I might take some time off this December and be able to tackle it, but no guarantees atm.

Feel free to close the issue by me  it too much size If what you mean is

> "Can I use an external module of electron?"

The answer is Yes, you can.
Please consider to look at **Nightmare(options)** [options.electronpath](https://github.com/segmentio/nightmare#electronpath)
  I want to be able to send data from the client side to the main process. Is that possible? I want the reverse: emitting from the client side to the main script.

For example, I'd like in the `preload.js` to have something like:

``` js
emitEvent("foo", 42, 7);
setTimeout(function () {
   emitEvent("foo", 42, 8);
}, 1000):
```

And in the main process:

``` js
nightmare.on("foo", function (a, b) {
 // 42, 7
 // after one second
 // 42, 8
});
```

I guess that should be possible using the `ipc` module, right?
 Ah, right! Thanks!  when i use **plugin** in my code,i want a callback function or then function to run my code on Node. if i use callbackï¼Œit doesn't work. i use then , and return nightmare.wait(),it will throw error   Is any way to run Nightmare on nodejs on openshift hosting? On localhost everything work good.  yeah I am also having issues trying to run Nightmare on free openshift  Executing `.goto([some_address].pdf)` makes Nightmare process hang:
  
```
electron:stderr Xlib:  extension "RANDR" missing on display ":99". +0ms
  electron:stderr Xlib:  extension "RANDR" missing on display ":99". +225ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36 +91ms
  nightmare:log Navigating: "https://www.akamai.com/us/en/multimedia/documents/content/white-paper/akamai-oreilly-high-performance-images-white-paper.pdf",
            headers: [none],
            timeout: 60000 +7ms
  nightmare:log did-start-loading +10ms [{}]
  nightmare:log did-get-response-details +332ms [{},false,"https://www.akamai.com/us/en/multimedia/documents/content/white-paper/akamai-oreilly-high-performance-images-white-paper.pdf","https://www.akamai.com/us/en/multimedia/documents/content/white-paper/akamai-oreilly-high-performance-images-white-paper.pdf",200,"GET","",{"accept-ranges":["bytes"],"cache-control":["max-age=2591543"],"content-length":["5769224"],"content-type":["application/pdf"],"date":["Thu, 03 Nov 2016 14:39:26 GMT"],"etag":["\"580808-53c9edf281a80\""],"expires":["Sat, 03 Dec 2016 14:31:49 GMT"],"last-modified":["Fri, 16 Sep 2016 12:12:10 GMT"],"link":["<https://scripts.demandbase.com>;rel=\"preconnect\",<https://www.googletagmanager.com>;rel=\"preconnect\",<https://www.google-analytics.com>;rel=\"preconnect\""],"status":["200"]},"mainFrame"]
``` And timer function in `runner.js`(197-208) is never called.
 All the same for pages with automatic download process, e.g. https://netbeans.org/downloads/start.html?filename=zip/netbeans-8.2-201609300101-src.zip 
 Ignoring downloads fixes the issue. Thank you!
 Why this issue has been closed? What if I don't want to "ignore downloads"? is there a way to make it work with nightmare? E.g. I need to click on a link (which triggers a PDF download) and check the response HTTP code is 200.  In Selenium, we can do it by using window_handles and switch_to_window method.

Before clicking the link first store the window handle as

`window_before = driver.window_handles[0]`
after clicking the link store the window handle of a newly opened window as

`window_after = driver.window_handles[1]
`then execute the switch to window method to move to newly opened window

`driver.switch_to_window(window_after)`

Is there any way to do it with nightmare?  I can't provide the exact code to reproduce this but I wondered if someone might know why evaluate would return a boolean rather than the expected value (I am assuming this is on the `evaluate` sender and not the `then` receiver).

I have a chain identical to the following sans actual implementation:

````javascript

var evaluateFn = () => {
  var localCollection = [];
  // do some element scraping and push to localCollection
  return localCollection;
}

var resultFn = (someCollection) => {
  // enumerate over the collection
  // ~20% of the time someCollection is a boolean!
}

// browser is set elsewhere
browser.wait("someelem").evaluate(evaluateFn).then(resultFn);
````
localCollection in the `evaluateFn` is *always* as I expect it (console.log shows as much). I realise reproducibility may be an issue but if anyone can offer some guesses, I'd take that :) Thanks for getting back to me. I am 100% sure the results are always an array. I am sorry that I can't provide some more concrete code but I do have some more news.

I can't hammer the site in question that I am polling but I have just run 80 requests over a period of time, in batches of 20, with and without the electron browser - so run 20 with then 20 without, repeat. The failure rate due to `evaluate` returning a boolean (or `then` thinking it has one) are as follows:

try 1 - show true: 30%
try 2 - show false: 0%
try 3 - show true: 15%
try 4 - show false: 0%

Now, I can't replicate this against a strait forward content site. The site I am scraping has all kinds of quirks and is fairly complex - one end to end request is in the region of 10 seconds (to return a very small array of results - each result is a simple object of about 7 properties with string values and to date only one result in the array).

Does that provide any more clues? could it be that the evaluate block times out somehow - returning the status of the evaluation but not the results? (I am reaching here, apologies). 

Cheers
 After running into several more of these it turns out the behavior is more prevalent when running concurrent sessions. This is related to https://github.com/segmentio/nightmare/issues/727  I think it would be useful to be able to wait, click, mouseover, etc... elements by their text content. I've only managed to implement clicking in an action so far:

```js
Nightmare.action('clickText', function (text, done) {
  return this.evaluate_now(function (text) {
    var elems = document.querySelectorAll('*')
    var element = Array.prototype.find.call(elems, function (e) {
      return e.textContent === text
    })

    document.activeElement.blur()
    if (!element) {
      throw new Error('Unable to find element by text: ' + text)
    }
    var event = document.createEvent('MouseEvent')
    event.initEvent('click', true, true)
    element.dispatchEvent(event)
  }, done, text)
})
```

If a function could be passed in place of a selector that would be eval'ed to grab the element to click/wait for, that would be pretty cool, too.

```js
function byText (text) {
  // expose an "evaluator" function to create an evaluator
  return Nightmare.evaluator(function(text) {
    var elems = document.querySelectorAll('*')
    var element = Array.prototype.find.call(elems, function (e) {
      return e.textContent === text
    })
    return element
  }, text)
}

nightmare.click(byText('Create Project'))
```

This would make it possible to write a custom succinct DSL.  I have a selector `.input-search` that is working for nightmare methods like `click()`, `insert()`, `type()` but whenever I try to run it in `evaluate()` the whole app freezes. 

Here is a sample code:

```
 nightmare
                .wait('.input-search') // it works
               .evaluate(function(){
                    return document.querySelector('.input-search'); // gets stuck here
                })
                    .then(element => {
                        console.log('element found: ', element);
                    })
                    .catch(err => {
                        console.log('not found', err)
                    });
```

`then` and `catch` are never hit. 

The debug output says just this...

> nightmare:actions .wait() for .input-search element +1ms
> nightmare:actions .evaluate() fn on the page +24ms

I have tried with nightmare versions `2.8.1` and `2.7.0`.
 Ok, I realized that this happens only on url `https://web.whatsapp.com`.

Is it because it a Single Page Architecture (SPA)? I also had to use another `.click()` method to make a click (`nightmare-real-mouse`).
 The problem lies in:
- `return document.querySelector('selector');` or
- `console.log(document.querySelector('selector')`

There should be a better log but debugging it for a while I didn't get the mechanism very well. I'll let someone more experienced to handle it... :)
 I'm getting the same thing on a React application.

`console.log` doesn't print anything on the Dev Tools window either.

My code is something like:

```
return nightmare
      .goto(BASE_URL)
      .wait("#app")
      .type(".input-email", USERNAME + USERNAME)
      .type(".input-password", PASSWORD + PASSWORD)
      .click(".btn-app")
      .wait(500)
      .evaluate(() => {
        console.log(document.querySelector(".alert-danger"));
        return document.querySelector(".alert-danger");
      })
      .end()
      .then((errorElement) => {
        expect(errorElement).not.toBe(null);
      });
```
 Thx @rosshinkley   Yahoo.com's home page took a very long time to workâ€”for a moment I thought nightmare.js wasn't working!

![nightmare](https://cloud.githubusercontent.com/assets/74385/19912725/9777cb92-a0d7-11e6-8644-1a7ca6987a33.gif)
  Because the Nightmare instance is a thenable, the following will return a Promise that resolves to undefined:

```js
async function createNightmare () {
  const nightmare = Nightmare({ some: options })
  await doAsyncStuff()
  return nightmare
}
```

This took me 20 minutes to figure out, so it might be worth ensuring that the Nightmare instance is resolved when awaited. :shipit:  Same here!! Same here :-(

I think thenable object should return asynchronously something.  Node Version: 4.2.3
Nightmare Version: 2.8.1
Mocha Version: 3.1.2

I was initially trying to return the result of a `document.querySelectorAll` query in the `evaluate`
I now know that I shouldnt be doing this but I would expect something more descriptive than a timeout

using the following command `mocha index.js`

The following code will just hang and timeout, I would expect the `then` function to be called with an empty object or null

```js
var Nightmare = require('nightmare')

describe('Nightmare', function() {
  it('should not hang', function(done) {
      this.timeout(20000)
      Nightmare()
        .goto('http://www.muzeroom.com/')
        .wait('.story-list-item')
        .evaluate(function () {
          return document.querySelectorAll('.story-list-item')
        })
        .end()
        .then(function(result) {
          console.log('in the then ', result)
          done();
        })
        .catch(function(err) {
          console.log('in the catch', err.message)
          done()
        })
    });
});
```

but this code will successfully return the textContent (which leads me to believe that the `wait` and `querySelectorAll` are working correctly

```js
var Nightmare = require('nightmare')

describe('Nightmare', function() {
  it('should not hang', function(done) {
      this.timeout(20000)
      Nightmare()
        .goto('http://www.muzeroom.com/')
        .wait('.story-list-item')
        .evaluate(function () {
          return document.querySelectorAll('.story-list-item')[0].textContent
        })
        .end()
        .then(function(result) {
          console.log('in the then ', result)
          done();
        })
        .catch(function(err) {
          console.log('in the catch', err.message)
          done()
        })
    });
});

``` Quick notes before I have to stop looking at this for now:
1. The problem is in the IPC between the Electron process itself and the browser window process when JS is evaluated (i.e. in `win.webContents.executeJavaScript()`).
2. In @nguyenchrâ€™s example above, the specific issue isnâ€™t in the DOM node but in the jQuery metadata attached to it. Most specifically, itâ€™s an AngularJS `$scope` object attached to the node, which is both very deep and highly recursive.
3. Looks like this was _most likely_ caused by changes to the recursion/uniqueness checking algorithm in Electronâ€™s JS <-> C++ conversion code (which is how values get packaged up for IPC) here: https://github.com/electron/electron/pull/6977
4. Thereâ€™s an Electron issue tracking it: https://github.com/electron/electron/issues/7286

Not sure if there are also things worth doing in Nightmare ahead of Electron improving on their side:
- Detect recursion and just disallow it? e.g. something like `JSON.parse(JSON.stringify(returnValue))` will throw [quickly] when recursion is encountered, though this could cause other issues :\
- Special case DOM nodes and just send back some particular meaningful properties and NOT metadata attached to them? Or send back an error instead for DOM nodes? (This wonâ€™t fix the real issue of sending deep/recursive data structures, but would make it less likely to happen.)
 > Would it be worth it to use something like json-stringify-safe to handle circular references

Iâ€™d like to think noâ€”the code that seems to be the culprit for the hang (introduced in Electron 1.3.5) is the code that is meant to null out circular refs and basically do exactly what json-stringify-safe does but without stringifying. Seems like it would be better to get that fixed at the source.
  I'm using Nightmare in a VirtualBox vm running Linux Mint as a guest. I have to disable hardware acceleration in Google Chrome so my VM doesn't lockup.

I have found that I also need to disable hardware acceleration in nightmare. 

I added ```app.disableHardwareAcceleration()``` just before app.on('ready' ... in [runner.js](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L66) and that solved my issue.   Hello,

Today I have stumbled to create any custom action which does actions both on server and page context. I have spent the last three days trying every possible combination of Nightmare.action with evaluate and with evaluate_now, and .use(), with no success. 

My task is very simple: I need to create a custom action where I return a property from a dom element, and then use push to store this property on an array on server-side. 

But even such a task is herculean when dealing with Nightmare.

For example: I try the "use" function, the same way as in the example in this page:

https://github.com/rosshinkley/nightmare-examples/blob/master/examples/beginner/use/yahooTopResult.js

In sketch, I do the following:

"var functionToUse = function(search) {
  return function(nightmare) {
    nightmare
    .evaluate(function(){
    })
    .then(function(){
        console.log("output1");
    }
  };
};

nightmare
  .use(functionToUse())
  .then(function(result) {
    console.log("output2")
  })
  .catch(function(error) {
    console.error(error);
  });"

The result: I get output 2 printed BEFORE output 1.

I have to say, in general terms, that Nightmare has a terrible API and documentation, and an almost unpredictable behaviour. For example: where is documentation for "use"? Where is documentation for "run"? What criteria nightmare uses for choosing when it is going to queue or when it is going to run the queued operations? I have to do everything with trial and error, because the api beyond the "readme" is almost absolutelly undocumented, and the only documentation comes in the form of very restrict examples, where there is no precise definition of function actions and the meaning of the parameters.

This is indeed a very general criticism, but, in restrict terms, what I want now is what I said in the beginning: to create a custom action that is minimaly general enough to get an dom property on the client, return it, and then storing it in an array server-side. Is that possible?
  Is that possible to generate pdf with custom page size other than A4, A3, Legal,Letter &Tabloid
Thanks in advance
 You can specify a custom page size by passing `pageSize:{height: <HEIGHT IN MICRONS>, width:<WIDTH IN MICRONS>}` an an option in the `.pdf(path, options)` function.

This would generate a pdf file with 100 x 100 mm page size for example.
`.pdf('test.pdf', {pageSize:{height: 100000, width:100000}})`

I have proposed an update to the documentation in pull request #930 .   Is there a proper way to chain evaluations?  I tried to find some samples in the docs at no vail, most samples have only one evaluation but in my case I need to navigate through the application and evaluate the state of the UI. Restarting the application may not be a problem but would slow down the testing process since we would have to run through all the steps that have already "passed".

```
new Nightmare()
.goto(site)
.evaluate(function(){
// run evaluation
})
then(function(result) {
//confirm result
})
.click()
.evaluate(function(){
// run evaluation
})
then(function(result) {
//confirm result
})

```
 @rosshinkley You said that the first `.then()` returns a `Promise`. Can this promise be converted to `bluebird` Promise so to be able to use `.each()` and others from specified library, at a later point in Nightmare chain? Something like this:

```
var Promise = require('bluebird');
var nightmare = new Nightmare();
nightmare
  .goto(site)
  .evaluate(() => {
    // ...
    return collection; 
  })
  .then(collection => {
    // log
    return Promise.resolve(collection);
  })
  .each(colElem => {
    doSomething(colElem);
  });
```
 Just need chainable .then action, that returns nightmare instance, not promise.

Some workaround, place asserts into custom actions:

``` js
Nightmare.action('assert', {
        visible(sel: string, done: () => void) {
            this.evaluate_now(function (sel) {
                var elem = document.querySelector(sel)
                if (elem) return (elem.offsetWidth > 0 && elem.offsetHeight > 0)
                throw new Error(`${sel} not visible`)
            }, done, sel)
        }
    })

nightmare
  .assert.visible('#myTitle')
```
  I am running into an error, when including vanilla JS in nightmare.js. I want to make sure that every email in my array is inputted into the system.

Is there an error glossary within nightmare.js? I keep running into this error: Nothing responds to "goto" whenever I run my code. I can't seem to find the root of the error even when running DEBUG. Here is my code: 

```
var jquery = require('jquery');
var Nightmare = require('nightmare');
var nightmare = Nightmare({
    show: true,
    dock: true
});

var siteName = "*********";
var username = "*********";
var password = "*********";

var outboundEmailArray = [
  {
    "from_name": "TestOutbound",
    "email_username": "array1",
    "email_domain": "salesforce.com",
    "email_domain": "salesforce.com",
    "reply_to": "testOutbound@salesforce.com"
  },
  {
    "from_name": "Tester",
    "email_username": "array2.0",
    "email_domain": "salesforce.com",
    "email_domain": "salesforce.com",
    "reply_to": "testOutbound@salesforce.com"
  }
];

var outboundEmailSetup = function(i){
  if(i < outboundEmailArray.length) {
    nightmare
    .goto("https://" + siteName + ".desk.com/login/new")
    .type("input[id='user_session_email']", username)
    .type("input[id='user_session_password']", password)
    .click("#user_session_submit").wait(2000)
    .goto("https://" + siteName + ".desk.com/admin/settings/mail-servers")
    .click("#a-add-modal").wait(2000)
    .type("input[id='postmark_outbound_mailbox_fromname']", outboundEmailArray[i].from_name).wait(2000)
    .type("input[id='email_username']", outboundEmailArray[i].email_username).wait(2000)
    .click("#from_select_4999").wait(2000)
    .type("input[id='postmark_outbound_mailbox_reply_to']", outboundEmailArray[i].reply_to).wait(2000)
    .click("#postmark_commit").wait(2000)
    .click(".a-modal-bottom .a-button").wait(2000)
    .evaluate(function() {})
    .end()
    .then(function(result) {
        console.log(result)
    })
    .catch(function(error) {
        console.error('Search failed:', error);
    });
    outboundEmailSetup(i+1);
  }
}

outboundEmailSetup(0);
```

I also have my log here when running DEBUG=nightmare node outboundMailbox.js

```
nightmare queuing process start +0ms
  nightmare queueing action "goto" for https://zzz-leaflet.desk.com/login/new +6ms
  nightmare queueing action "type" +2ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "goto" for https://zzz-leaflet.desk.com/admin/settings/mail-servers +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +1ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +3ms
  nightmare queueing action "goto" for https://zzz-leaflet.desk.com/login/new +15ms
  nightmare queueing action "type" +1ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "goto" for https://zzz-leaflet.desk.com/admin/settings/mail-servers +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +1ms
  nightmare electron child process exited with code 0: success! +716ms
```

Ideally, it would loop through the outboundEmailArray, run the function to input the emails into the system, repeat until it has reached the end of the array.
  When I return a promise from evaluate, everything works fine. However, when i specify one extra parameter in the function used as the first argument in evaluate, with the intent of calling it to signal completion of evaluate, the value is not passed to the next then in the chain.

This works fine:

``` javascript
var Nightmare = require('nightmare');
Nightmare()
    .goto('http://google.com')
    .evaluate(function () {
        return new Promise(done => {
            done('working');
        });
    })
    .end()
    .then(value => {
        console.log(value);
    });
```

And this doesn't:

``` javascript
var Nightmare = require('nightmare');
Nightmare()
    .goto('http://google.com')
    .evaluate(function (message, done) {
        done(message);
    }, 'working')
    .end()
    .then(value => {
        console.log(value);
    });
```
 So is there currently no way to run evaluate and receive back a value without it being taken as a error (without using a promise)?
  I'm trying to write a proof of concept that:
1. Opens hacker news.
2. Searches for a link with a keyword in it.
3. Clicks link.

Here's what I have so far:

``` javascript
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });

nightmare
  .goto("https://news.ycombinator.com")
  // Wait for the body to load.
  .wait("#hnmain")
  .evaluate(function() {
    // Keyword to search Hacker News titles for.
    var keyword = "Foo";

    // Fetch all the story titles.
    var stories = document.querySelectorAll("a.storylink");

    // Look for one with a keyword in the title.
    for (var i = 0; i < stories.length; i++) {
      var story = stories[i];
      var storyName = story.innerHTML;
      if (storyName.includes(keyword)) {
        return story;
      }
    }

    return null;
  })
  .end()
  .then(function(matchingStory) {
    if (matchingStory != null) {
      // Click it somehow???
    }
  })
  .catch(function(error) {
    console.error("error: " + error);
  });
```

I'm able to successfully find links that match a keyword, but I'm stuck on how to actually get nightmare to click on those links. Any tips? Should I be trying to extract the `href` and use `goto()` instead of `click()` here? 
 In your situation I would save the links to a database, then I'll make a cron job to get links from the database then I'll just use `nightmare.goto(urlFromDB)`
 Thanks @rosshinkley. I can nest another `nightmare.goto(url)` call in the outer `then` block it seems and that seems to solve that.
  I could never get the inject to work until I realized today that maybe you have to do it after the .goto(). I've been relying on raw javascript until today I really needed some more complex jquery. Could there be something in the documentation to say as much? 
  @rosshinkley please how to run nightmare by pm2 or something like that on the server because nightmare use the electron and electron need graphic now i'm using `xvfb-run npm start` but this solÂ° needs that i stay connected by ssh to the server have you any suggest?
 There is the solution:

https://github.com/segmentio/nightmare/issues/224#issuecomment-239335488
  The CSS `[]` attribute selector, which worked nice with nightmare@2.7, now throws an â€œUnexpected number in JSONâ€ error with the latest version 2.8.0.
# Reproduction

nightmare-test.js:

``` js
const Nightmare = require('nightmare');

const nightmare = Nightmare({webPreferences: {partition: 'nopersist'}});

nightmare
.goto('http://localhost:8080/nightmare-test.html')
.click('div[data-x="0"]')
.then(() => console.log('no error'))
.catch((e) => console.error(e))
.then(() => nightmare.end());
```

nightmare-test.html (and serve it with localhost:8080):

``` html
<!DOCTYPE html>
<div data-x="0"></div>
```

Terminal:

```
$ node nightmare-test.js
Unexpected number in JSON at position 14
```

Related: https://github.com/tsg-ut/mnemo/pull/105

Thanks.
 I've figured the problem out, will send a patch in an hour...
 fmm... the problem was unexpectedly sophisticated and

> send a patch in an hour...

was not possible. I found the selector string injected into "execute" template is wrongly escaped and causing syntax error.

https://github.com/segmentio/nightmare/blob/master/lib/javascript.js#L19

So providing `'div[data-x="0"]'` the above line will be...

```
args = JSON.parse('["div[data-x=\"0\""]');
```

and making `0` into the unexpected number.

I couldn`t find right way to escape these characters.

And note, I found this error makes users be able to inject **arbitrary code** into the nightmare environment.

nightmare-test.js:

``` js
const Nightmare = require('nightmare');

const nightmare = Nightmare({webPreferences: {partition: 'nopersist'}});

const selector = '"]\'); document.title = \'blah\'; (\'"';

nightmare
.goto('http://localhost:8080/nightmare-test.html')
.then(() => nightmare.evaluate(() => document.title))
.then((title) => {
    console.log(`Title: ${title}`);
    return nightmare.click(selector);
})
.catch((e) => console.error(e))
.then(() => nightmare.evaluate(() => document.title))
.then((title) => console.log(`Title: ${title}`))
.then(() => nightmare.end());
```

nightmare-test.html:

``` html
<!DOCTYPE html>
<title>Page Title</title>
<div data-x="0"></div>
```

Terminal:

```
$ node nightmare-test.js
Title: Page Title
Failed to execute 'querySelector' on 'Document': '"]'); document.title = 'blah'; ('"' is not a valid selector.
Title: blah
```
 Thanks. I agree this shouldn't really matter, but did hope this be fixed sooner to avoid potential risk for nightmare users. :)
  I'm trying to run , but I keep getting this error:
`(node:75110) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): Unexpected number in JSON at position 26`

My Package.json:
`{
  "name": "loadspeed-tester",
  "version": "1.0.0",
  "private": true,
  "description": "tests the load speed using pingdom",
  "main": "main.js",
  "dependencies": {
    "bookshelf": "^0.10.1",
    "coffee-script": "^1.9.3",
    "enforce": "^0.1.6",
    "hat": "^0.0.3",
    "jquery": "^3.1.0",
    "knex": "^0.12.1",
    "lodash": "^4.15.0",
    "mandrill-api": "^1.0.45",
    "mysql": "^2.8.0",
    "node-slack": "^0.0.7",
    "orm": "^3.1.0",
    "nightmare": "^2.7.0",
    "sequelize": "^3.5.1",
    "sql-query": "^0.1.26",
    "trim": "^0.0.1",
    "worker-farm": "^1.3.1"
  },
  "devDependencies": {},
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git@gitlab.websitesonwheels.net:root/loadspeed-tester.git"
  },
  "author": "",
  "license": "ISC"
}
`
  Hello! I'm trying to goto page, wait for selector, then evaluate to get number of steps I will have to do (walk through pagination which is dynamically loaded with xhr by target website) and then run evaluate->click->wait->repeat as many times as required. Is it at all possible?

It certainly doesn't seem possible since there's no way to get access to the result of evaluate function other than by calling 'end' followed by 'then'.

It seems to be a common use case (parsing paginated websites) - easily achievable with other tools (sadly all of them based on Phantom), so I suspect I may be missing something.

Any advise?
 Thank you very much @rosshinkley. I didn't stumble upon nightmare-examples before. It's true that it's linked within a ToC, but by scrolling and reading through segmentio/nightmare README there was no such section, not even a link to it and I didn't pay attention to the ToC since I assumed I read it all. Also, there is not a single example of a code in a main README that would use `then` at least twice. If either of these were the case - I would have probably solved it by myself before. I'm just describing what was the issue in my case, feel free to disregard my remarks :)

_Even then I am not sure what was I doing wrong before since I used map.reduce (or recursion) to chain promises before and it eludes me what was I previously doing wrong in my code that I did draw all those wrong conclusions about the function of `then`._

In any case - it works like a charm and now that I finally get nightmare mechanics I enjoy the simplicity of the API very much. Fantastic tool.
  I've jumped through most of the hoops to get NightmareJS setup on Heroku. It renders most images fine like it does in my local Windows environment. The problem only arises when I load MathJax into an instance of Nightmare on Heroku. Nightmare appears to load the files just fine, but then just crashes.

With `debug=*` on, my output looks like this:

```
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "goto" for file:///app/server/app/nightmareRender/templates/blank.html
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "viewport"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "evaluate"
 Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "inject"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "inject"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "inject"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "inject"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "evaluate"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "wait"
Tue, 18 Oct 2016 20:24:07 GMT nightmare queueing action "screenshot"
Tue, 18 Oct 2016 20:24:07 GMT nightmare running
Tue, 18 Oct 2016 20:24:07 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Tue, 18 Oct 2016 20:24:08 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log Navigating: "file:///app/server/app/nightmareRender/templates/blank.html",
            headers: [none],
            timeout: 30000
ue, 18 Oct 2016 20:24:08 GMT nightmare:log did-start-loading [{}]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log did-get-response-details [{},true,"file:///app/server/app/nightmareRender/templates/blank.html","file:///app/server/app/nightmareRender/templates/blank.html",200,"GET","",{"access-control-allow-origin":["*"]},"mainFrame"]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log dom-ready [{}]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log did-frame-finish-load [{},true]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log did-finish-load [{}]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:log did-stop-loading [{}]
Tue, 18 Oct 2016 20:24:08 GMT nightmare:actions .viewport()
Tue, 18 Oct 2016 20:24:08 GMT nightmare:actions .evaluate() fn on the page
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .inject()-ing a file
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .inject()-ing a file
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .inject()-ing a file
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .inject()-ing a file
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .evaluate() fn on the page
Tue, 18 Oct 2016 20:24:09 GMT nightmare:actions .wait() for fn
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/input/TeX/config.js?V=2.7.0","file:///app/node_modules/mathjax/jax/input/TeX/config.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/output/HTML-CSS/config.js?V=2.7.0","file:///app/node_modules/mathjax/jax/output/HTML-CSS/config.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/extensions/tex2jax.js?V=2.7.0","file:///app/node_modules/mathjax/extensions/tex2jax.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/element/mml/jax.js?V=2.7.0","file:///app/node_modules/mathjax/jax/element/mml/jax.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/input/TeX/jax.js?V=2.7.0","file:///app/node_modules/mathjax/jax/input/TeX/jax.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/output/HTML-CSS/jax.js?V=2.7.0","file:///app/node_modules/mathjax/jax/output/HTML-CSS/jax.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js?V=2.7.0","file:///app/node_modules/mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log did-get-response-details [{},true,"file:///app/node_modules/mathjax/extensions/MathEvents.js?V=2.7.0","file:///app/node_modules/mathjax/extensions/MathEvents.js?V=2.7.0",200,"GET","",{"access-control-allow-origin":["*"]},"script"]
Tue, 18 Oct 2016 20:24:09 GMT nightmare:log crashed [{},false]
```

`nightmare:log crashed [{},false]` out of the blue has been really confusing me. I've hooked up my nightmare instance with

``` javascript
nightmare
      .on('console', (type, ...args) => console.log(`In Page console.${type}: "`, ...args, '"'))
      .on('page', (type, message, extra) => console.log(`In Page event [${type}]:`, message, extra))
```

and its not printing anything that seems relevant.

Is there someway to get more helpful errors here? Or does the crash mean something that I'm not aware of? 

My code that is using Nightmare is a little convoluted, so let me know if it'd be useful, thanks!
 >  You also may run into an issue with /dev/shm being too small, which manifests itself as Electron crashing after a few operations in Nightmare.

This definitely sounds like the problem I'm having. I've tried adjusting the dyno size to no avail. Is there anyway I can confirm this is the issue?
 @jussch @rosshinkley I tried all sorts of acrobatics to make it work on heroku until I emailed their tech support and confirmed that dev/shm is fixed to 5mb on all dynos. 

Even though I couldn't prove that dev/shm was the problem (if you read the chromium issue part of the problem is that you don't get logs about the crash), I tested the same script that was crashing on heroku on the smallest VMs of AWS and DO and worked perfectly. I _think_ (can't remember for sure) monitoring dev/shm at max usage on heroku.

If you _must_ use heroku I guess you could finally ask them to change the allocation ad-hoc (if possible).

Hope it helped.
 Well that is unfortunate. NightmareJS has been doing wonders for me, especially over PhantomJS.

Regardless, thanks for the help and for the info. I'll keep looking into it, but it doesn't appear to be a Nightmare issue, so I'll close this.
 @jussch I'm running into the same issue. Wondering if you found a solution? @jussch Heroku just bumped the size of `/dev/shm/` on their dyno to allow headless browser test.

https://devcenter.heroku.com/changelog-items/1085 @Chris911 No I never found a solution, but thanks a bunch for the info! I'll give it another try. @jussch I managed to get it to run with a few buildpacks but it was crashing after loading 1 webpage. I contacted Heroku and they said they were working on increasing `/dev/shm/` and that it should fix it. Personally decided to deploy on Google Cloud for now but might switch back to Heroku. 

Let me know if it works for you!  Please how to end nightmare  by separeted button i want to do a start and stop button 
PS: 

```
Nightmare({
        show: false,
        openDevTools: false
    });
```
 @rosshinkley i want to stop the nightmare by a button 
i want to do a button that start my script contains nightmare then when i want to stop the nightmare with an other button because in the server i can't see the electron to stop it 
did u undertand me now?
 i got u ok thanks a lot for ur answer
 @rosshinkley do you know maybe when `.halt()` API will be included ?

We need it for project of ours.

If that will not be soon, do you suggest any solutions ?

Peace!
 I don't know about the halt() function but basically I did another workaround.

Creating a nightmare window without calling end()
Then add a button to call only the end()

Maybe you wanted a pause button too. But I suppose this one was the best thing I could come of with.
Here is something else to help you understand my perspective.

First I do this to run nightmare inside electron, 
https://github.com/segmentio/nightmare/issues/856#issuecomment-257028322

Then I use this index.html file.

``` html
<button id="start">Start</button>
<button id="stop">Stop</button>
<b id="status">idle</b>
<b id="results"></b>

<script>
// We allow nightmare to wander in the global scope by defining it here, 
// otherwise we would not be able to call it multiple times
var Nightmare = require('nightmare');
var nightmare;
var args = { show: true, alwaysOnTop: false };


document.getElementById("start").addEventListener("click", function(){
  document.getElementById("status").innerHTML = "Searching for the gem";

  // Here we start the Nightmare Instance
  nightmare = Nightmare(args);
  nightmare
    .goto('http://yahoo.com')
    .type('form[action*="/search"] [name=p]', 'github nightmare')
    .click('form[action*="/search"] [type=submit]')
    .wait('#main')
    .evaluate(function () {
      return document.querySelector('#main .searchCenterMiddle li a').href
    })
    .then(function (result) {
      document.getElementById("results").innerHTML = result;
    })
    .catch(function (error) {
      document.getElementById("results"). innerHtml = "Search failed: " + error;
    });

})
document.getElementById("stop").addEventListener("click", function(){
  nightmare
  .end()
  .then(function (result) {
      document.getElementById("status").innerHTML = "Leaving Nightmare Speechless";
    })
})
</script>
```

And the result is this,
![](http://i.imgur.com/S6EPLnV.png)

It might look really stupid, but this works for me I guess.
 @entrptaher Wow, tnx a lot for trying to help mate, really appreciate!

I will need to wait someone to do this for me, cause current guy who was doing this left the work.

@entrptaher how can I get in contact with you ?  My email is stefan@vanila.io, so you can reach me there or join our internal chat on https://chat.vanila.io
 Thank you @entrptaher 
 Glad to be of help.
  I'm using nightmare to navigate between various pages and log page errors. Due to the asynchronous nature of `url().then()` I need a way to get the URL at the time of the page error. Would something like this be acceptable?

https://github.com/segmentio/nightmare/compare/master...justinjmoses:master

If so, I'd be happy to write up a PR with test coverage. 
 It's looking like it doesn't fix the problem. I played with some edge cases and it seems possible that the electron browser has moved on to a new URL by the time the event is handled. I need to dig deeper to find a thorough solution.  
 Actually I don't want to block per se. I'm happy for nightmare to continue its merry way, I'd just like to make sure I know where the error came from, even if electron has moved on to another page already. 
  how can i pass a function in parameter of .evaluate  allways i have null

puu.sh/rHtgK/89af757a71.png

i want to scrape a website and every data collected saved in mongo no return in the .evaluate
any one can help me
 I'm trying the same, 

``` javascript
var name = "demo.png";
var url = "https://demoUrl.com"

nightmare
  .downloadManager()
  .goto('https://google.com')
  .evaluate((name, url) => {
    console.log(name, url);
    return 'Done'
  })
```

That result will undefined
 @cagataycali, maybe thats not the problem you are trying to solve. If you are trying to use download manager, then probably you should try their example first.

``` js
var Nightmare = require('nightmare');
require('nightmare-download-manager')(Nightmare);
var nightmare = Nightmare();
nightmare.on('download', function(state, downloadItem){
  if(state == 'started'){
    nightmare.emit('download', '/some/path/file.zip', downloadItem);
  }
});

nightmare
  .downloadManager()
  .goto('https://github.com/segmentio/nightmare')
  .click('a[href="/segmentio/nightmare/archive/master.zip"]')
  .waitDownloadsComplete()
  .then(() => {
    console.log('done');
  })
```

If you want to pass something to evaluate, you have to pass it as @rosshinkley showed above.
But, from your example, it's not exactly clear what are you trying to do.
The actual code might be more helpful.
  I have a use case where I need to know what was on the page when a page's waitTimeout is exceeded, but I can't seem to figure how to get the last html of the page from within a .catch(). Anyone have any ideas? Maybe nightmare can be updated so catch() includes an additional parameter with the html? thoughts anyone?

For example:

``` javascript
nightmare
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .click('#buttonThatLoadsSomething') /* page loads something */
    .wait('#not_here') /* this will timeout because it's not on the page*/
    .evaluate(function () {
        /* more code here */
    })
    .end()
    .then(function(html) {
        /* more code here */
    })
    .catch(function (error) {
        /* here I would like to know what the last html page was before the error occurred */
    });
```
 seems like https://github.com/segmentio/nightmare/pull/819 would help me get around this issue (once merged). 
 @rosshinkley Thank you for helping. I am looking to pull the information (html) from the page that excepted, not the URL.
 I basically want a snap shot, so to speak, as html of what was on the browser window at the point when the wait timeout expired.
 I will try this. Thank you!
 @rosshinkley I tried to use your .evaluate() method as you had suggested, but none of the code within the final .then() (where the html should be) executes. 
 I think it's because the electron windows is already closed once the code within the catch runs.
 Okay I created another approach that works using evaluate's new Promise support - @rosshinkley thanks for adding that by the way.

So here is what I did. I created a wait function that takes three parameters.
1. The element id to check for
2. waitTimeout (this is optional)
3. pollInterval (this is optional)

Once you declare a wait variable with the new wait function code provided below, when using nightmare instead of using `.wait('#uh-search-box')` you would do this:
`.evaluate(wait, 'uh-search-box')` And since the new wait function returns a promise, it is added to normal queue and we could continue chaining as normal.

Of coarse the solution can be adjusted to ones individual needs. But for me this was perfect. Here is the code:

``` javascript
var Nightmare = require('nightmare');

var nightmare = Nightmare({
    show: true
});

var waitTimeout = 10000; // ms
var pollInterval = 250; // ms

var wait = function(elementId, waitTimeout, pollInterval) {
        waitTimeout = waitTimeout || 30000;
        pollInterval = pollInterval || 250;
        window.nightmareWaitStart = new Date();

        return new Promise(function(resolve, reject) {
            window.nightmareWait = setInterval(function() {
                var elapsed = new Date() - window.nightmareWaitStart;
                if(document.getElementById(elementId)) {
                    clearInterval(window.nightmareWait);
                    resolve();
                }
                else if(elapsed >= waitTimeout) {
                    clearInterval(window.nightmareWait);
                    reject({
                        msg: "wait timed out",
                        html: document.querySelector("body").innerHTML
                    });
                }

            }, pollInterval);
        });
    };

nightmare
    .goto('http://www.yahoo.com')
    .evaluate(wait, 'uh-search-box', waitTimeout, pollInterval)
    .end()
    .then(function() {
        console.log('all done');
    })
    .catch(function(error) {
        if(typeof error === "object" && error.html) {
            // Now we have access to the last html the was visible on the page before the timeout.
            // For this example we will just log it to the console.
            console.log(JSON.stringify(error.html, null, 2));
        }
        else {
            console.error(error);
        }
    });
```
 The approach I mentioned above works great, however one issue I have seen with some websites is if the page transitions away even after the did-stop-loading event. When that happens the custom wait function that is supposed to be running within the client get's lost. Adding a `.wait(1000)` before the other wait gets around this however at the cost of speed. I wish there was a better way that nightmare could detect when the page has finished loading. 

This issue was also reported in https://github.com/segmentio/nightmare/issues/769 but for whatever reason the issue is closed.

**Update:** I opened a new issue for this here: https://github.com/segmentio/nightmare/issues/854
 FWIW, @rosshinkley's suggestion should work, _except_ you need to make sure not to call `end()` before your `catch` runs:

``` js
nightmare
    // start with 'about:blank' so that you don't time out trying to get the
    // content of a page if none ever loaded in the `catch` clause
    .goto('about:blank')
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .click('#buttonThatLoadsSomething') /* page loads something */
    .wait('#not_here') /* this will timeout because it's not on the page*/
    .evaluate(function () {
        /* more code here */
    })
    // note NOT calling `end()` here
    .then(function(html) {
        /* more code here */
    })
    .catch(function (error) {
        // Now get the HTML of the loaded page.
        // If you *never* successfully loaded a page, this will hang (because
        // there's no page to execute the JS in). That's why we started by
        // loading 'about:blank' above.
        return nightmare
          .evaluate(() => document.documentElement.outerHTML)
          .end()
          .then(function(html) {
            console.log(html);
          });
    })
    .catch(function (error) {
        console.error('Something went really wrong; we should not have gotten here.', error);
    })
    // clean up by making sure we *always* end, whether there was an error or no
    .then(() => nightmare.end());
```

So it doesnâ€™t have to be nearly so complicated as your asynchronous `wait` above.
 @Mr0grog Thanks for the thorough explanation and for the corrected code. This is great!
 @Mr0grog Thanks again for helping me. I wanted you to know that I ended up making some refinement to your code above because I didn't understand:
- why there is a `catch()` immediately followed by another `catch()`
- why the last `catch()` is followed by a `then()`
- what the purpose of `.goto('about:blank')` when this could be captured in a `catch()`

So here is the code structure that I ended up using and achieves the goal of performing a task on a page that timed out (like getting the html off of it):

``` javascript
nightmare
    .goto('http://yahoo.com')
    .wait("#uh-search-box")
    .evaluate(function() {
        return document.title;
    })
    .then(function(title) {
        // do something useful
        console.log(title);
        nightmare.end().then();
    })
    .catch(function(error) {
        console.error(error);
        nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .end()
            .then(function(html) {
                // do something useful with the html
                console.log(html);
            })
            .catch(function (error) {
                // This happens if an error is triggered within the Promise chain of the other error handler!
                console.error(error);
            })
    });
```
 Ah, there are important answers for all of these questions :)

> ## why there is a `catch()` immediately followed by another `catch()`?

An important part of this is that the first catch _returns another promise,_ so the second catch can handle any errors from it. For example, you have:

``` js
    .catch(function(error) {
        console.error(error);
        nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .then(function(html) {
                // do something useful with the html
                console.log(html);
            })
            .catch(function (error) {
                // This happens if an error is triggered within the Promise chain of the other error handler!
                console.error(error);
            })
    });
```

But you could also do this for a little less nesting:

``` js
    .catch(function(error) {
        console.error(error);
        // note the return statement
        return nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .then(function(html) {
                // do something useful with the html
                console.log(html);
            });
    })
    .catch(function (error) {
        // This happens if an error is triggered within the Promise chain of the other error handler!
        console.error(error);
    });
```

This also has the benefit of letting your HTML printing handler _only_ handle relevant errors if you want:

``` js
    .catch(function(error) {
        // only handle errors from the `evaluate` action
        // some promise libraries like Bluebird have special tools for this!
        if (error.message && error.message.includes('Evaluation')) {
            return nightmare
                .evaluate(() => document.documentElement.outerHTML)
                .then(function(html) {
                    // do something useful with the html
                    console.log(html);
                });
        }
        throw error;
    })
    .catch(function (error) {
        // generically handle other types of errors we didnâ€™t predict,
        // including errors in the previous error handler
        console.error(error);
    });
```

> ## why the last `catch()` is followed by a `then()`?

This is so that you only have to call `end()` once in your whole script. This also makes it easy to ensure that you _always_ remember to clean up and call `end`, no matter whether things went right or wrong. For example, you have:

``` js
    .then(function(title) {
        // do something useful
        console.log(title);
        nightmare.end().then();
    })
    .catch(function(error) {
        console.error(error);
        nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .end()
            .then(function(html) {
                // do something useful with the html
                console.log(html);
            })
```

But you could have:

``` js
    .then(function(title) {
        // do something useful
        console.log(title);
        // note no call to `end` here
    })
    .catch(function(error) {
        // and no call to `end` here either
        return nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .then(function(html) { /* do something with result */ });
    })
    .catch(function(error) { /* handle remaining errors */ })
    // you donâ€™t need a catch because the result of the previous catch
    // is always a successful promise. This way, you know end *always*
    // gets called.
    .then(() => nightmare.end());
```

Alternatively, if youâ€™re debugging and only want to call `end` when everything is successful and _not_ when things break (bad idea when you arenâ€™t manually testing, but helpful when you are), just move that `then` up before your `catch` calls:

``` js
    .then(function(title) {
        // do something useful
        console.log(title);
        // note no call to `end` here
    })
    // if there was an error, this `then` will get skipped over because itâ€™s *before*
    // the `catch` so now we only end nightmare when everything went OK
    .then(() => nightmare.end())
    .catch(function(error) {
        // and no call to `end` here either
        return nightmare
            .evaluate(() => document.documentElement.outerHTML)
            .then(function(html) { /* do something with result */ });
    })
    .catch(function(error) { /* handle remaining errors */ });
```

> ## what the purpose of `.goto('about:blank')` when this could be captured in a `catch()`?

The idea here is to avoid an unnecessary delay. Letâ€™s say you had some code like this:

``` js
nightmare
    // it *really* goes to this URL, which will fail
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .catch(function(error) {
        return nightmare
            // ...then this `evaluate` call will time out because no page
            // was ever loaded. Having an error here is OK, but itâ€™ll take
            // 30 seconds to happen. You'd rather avoid that, so starting
            // on a reliable page (about:blank) means this evaluate call
            // will always work.
            .evaluate(() => document.documentElement.outerHTML)
            .then(function(html) { /* something */ });
    })
    .catch(function(error) { console.error(error); });
```

Now, if you go back a step and use the trick where we only get the HTML for the specific error we care about, thatâ€™s not so important:

``` js
nightmare
    // it *really* goes to this URL, which will fail
    .goto('www.dfsdfsdfsdfsdfsgdg.com')
    .catch(function(error) {
        // only handle errors from the `evaluate` action
        if (error.message && error.message.includes('Evaluation')) {
            return nightmare
                // now we'll never get here if the page failed to load, so no
                // need to worry about this `evaluate` call timing out.
                .evaluate(() => document.documentElement.outerHTML)
                .then(function(html) { /* something */ });
        }
        throw error;
    })
    .catch(function(error) { console.error(error); });
```
 Heh, no worries @rosshinkley. I made a similar copy/paste error in my first reply too, only saved by the fact that it didn't break the code :P
 @Mr0grog thanks for explaining
  How can I proxy the HTTPs requests?

https://github.com/electron/electron/issues/7564
 I did check that out but it doesn't allow me to modify the content from response. 

I'm wondering if it's possible to proxy the https requests and change the content of the responses for specific urls. 
 @rosshinkley I was trying to modify the content of a script served over HTTPs. Still, I don't really have a solution for this, but I found a workaround for my case.

Would be curious how do modify that, tho. Hi There,

I am having the same issue.  It appears that that proxy feature works for 'http' requests but not for 'https' requests through the same proxy. I am using a proxy service where I know I am able to, when using curl, visit both 'https' and 'http' pages through the same proxy.

However with this simple code which is similar to the examples given in the API readme:

```ts
import Nightmare = require('nightmare');

let nightmare = new Nightmare(<any>{
    switches: {
        'ignore-certificate-errors': true,errors
        'proxy-server': '<proxy host>:<proxy port>;'
    },
    show: true,
});

let url = 'https://www.google.ca/';

nightmare = nightmare
    .authentication('<proxy user>', '<proxy pass>')
    .goto(url)
    .end()
    .then(function(ip:string) {
        console.log('proxy IP', ip);
    },
    function (err:Error)
    {
        console.log('error %s, details: %s', err.message, err.details);
    });
```

I get the following results when `DEBUG=*`:

```ts

  nightmare queuing process start +0ms
  nightmare queueing action "authentication" +4ms
  nightmare queueing action "goto" for https://www.google.ca/ +2ms
  nightmare running +1ms
  nightmare:actions .authentication() +427ms
  nightmare:log Navigating: "https://www.google.ca/",
            headers: [none],
            timeout: 30000 +10ms
  nightmare:log did-start-loading +65ms [{}]
did-start-loading: {}, undefined, undefined, undefined, undefined, undefined, undefined
  nightmare:log did-fail-provisional-load +507ms [{},-323,"ERR_UNEXPECTED_PROXY_AUTH","https://www.google.ca/",true]
  nightmare:log did-fail-load +2ms [{},-323,"ERR_UNEXPECTED_PROXY_AUTH","https://www.google.ca/",true]
  nightmare electron child process exited with code 0: success! +91ms
error navigation error, details: ERR_UNEXPECTED_PROXY_AUTH

Process finished with exit code 0

```

Any idea what might be happening here? Clearly the authentication is given and works with 'http' urls but not with 'https' urls. 

I suspect, maybe, the authentication is not getting through as the connection is encrypted but I'm not sure how to resolve this issue? Or I am missing something very obvious. It is interesting to compare the output from the failed attempt to access an 'https' page vs a successful attempt to access an 'http' page:

```ts
  nightmare queuing process start +0ms
  nightmare queueing action "authentication" +8ms
  nightmare queueing action "goto" for http://www.google.ca/ +5ms
  nightmare running +2ms
  nightmare:actions .authentication() +588ms
  electron:stdout login listener added +36ms
  nightmare:log Navigating: "http://www.google.ca/",
            headers: [none],
            timeout: 30000 +14ms
  nightmare:log did-start-loading +69ms [{}]
  nightmare:log authenticating against http://www.google.ca/, try #1 +323ms
  nightmare:log did-get-redirect-request +328ms 
  ...

Process finished with exit code 0
```

You'll notice from debugging output that authentication (or the 'loginListener' set in the nightmare.js runner) is executed after 'did-start-loading' whereas in the failed example the login listener is not called.

I've ruled out a certificate problem.

Now I'm trying to track down where the 'ERR_UNEXPECTED_PROXY_AUTH' error might originate from. Any feedback or knowledge that might point me in the right direction would be extremely helpful.  I was wondering if it's possible to use Electron's <webView>s to load the webpages and adding/removing those tags dynamically inside a single BrowserWindow to handle async requests, (like if each webview was a single instance). I just came across Nightmare while I was researching a way to scrap from Electron, the thing is that I want to scrap lots of links (+100 links, yeah, like data-mining), my first approach was to use `<webView>`'s (with injected "preload" scripts and returning HTML code through IPC messages ) and it was good, but since in the future I might use authentication, handle sessions clicking on stuff and waiting for dynamic loads, and more complicated flows I looked for more "sophisticated" ways to do it, and I found out about PhantomJS (I used it with Horseman) It was a total disappointment, my raw webview "scrapper" took about ~2 seconds to return the whole HTML from a webpage, while PhantomJS took more than ~10 seconds, then I found Nightmare and use it and it takes about ~5 seconds to accomplish the same... all good if you're using it with a single page, but if I try to load those 100+ links (by creating a new instance in a loop, I know that Nightmare do not support more than 1 request at the same time on a single instance) it would take too much time (compared to the `<webview>` approach), and I believe that most of the time spent is consumed on launching a new instance, and not loading the actual webpage... So I thought that it could be possible to have only 1 instance of Nightmare (Electron) but somehow have several `<webview>`'s on it and manage them independently? Have you guys thought about it? Is there technical limitations on this approach? Is this something you plan to support in the future? 
 oh, great!... in the meantime I created a project precisely for these kind "scrapping" needs:

[Scrapman](https://github.com/danielnieto/scrapman)

it is based on Electron as well, but it uses the technique described above, btw, I couldn't ever imagine all the painful process needed to communicate Node -> electron(main) -> electron(render) -> shadow DOM with only async messages! I had to create another [NPM module](https://github.com/danielnieto/ipc-messages-manager) just to handle the IPC messaging.

I really really hope that these features get implemented on Nightmare in the future! Looking forward to it!
  Is it possible to evaluate a script before loading any resources?
 I ended  by manually editing the `lib/preload.js` script and setting up an npm script which overrides is after install.

By having a Google Maps map on the page, with markers, I want to click the first marker on the page. The easiest solution I found was to intercept the `addListener` method from Google Maps and collect the markers, and then to click the first marker.

Any ideas how we could do it?
 > I ended by manually editing the lib/preload.js script and setting up an npm script which overrides is after install.

So you know, on the README there is a [section](https://github.com/segmentio/nightmare#custom-preload-script) for overriding the preload. Like this: 

``` javasctipt
var nightmare = Nightmare({
    show: true,
    webPreferences: {
        preload: path.join(__dirname, "custom_preload.js")
    }
});
```

Just be sure to copy the content of the current preload.js into your custom one.
 Yes I saw that these days, and I set up a script to generate js files and bundle the things in them. Works pretty smoothly. :grin: 

Thanks!
 so have a script that takes whatever the now current lib/preload.js and combines in your custom code? Can you show me the code? I was thinking about doing this. 
 @bchr02 Sure! Pretty much a proof of concept, not tested (pasting things from my code):

``` js
const readFile = require("read-utf8")
    , writeFile = fs.writeFileSync
    , idy = require("idy")
    ;

const PRELOAD_CODE = readFile(require.resolve("nightmare/lib/preload.js"));

// ...

var customCode = "";
if (currentUrl.js) {
   customCode = readFile(currentUrl.js) + "\n\n";
}
customCode += PRELOAD_CODE;

let preloadPath = `tmp/${idy()}.js`;
writeFile(preloadPath, preloadCode);

// Create the nightmare options
let n = new Nightmare({
  webPreferences: {
    preload: preloadPath
  }
});
...
```
 @IonicaBizau Thank you!
  Earlier today I ran into this issue: https://github.com/segmentio/nightmare/issues/824

I resolved it by creating a modified `preload.js` that prevents the browser from setting any `unload` or `beforeunload` handlers. This pull request includes my modified `preload.js` along with two tests that ensure that it works.
  When trying to `.end()` a nightmare instance the process will hang forever if there is a `confirm` dialog on page exit. The confirm dialog is also not visible.

Code:

``` js
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true });

nightmare
  .goto('https://docs.google.com/forms/d/e/1FAIpQLSe2SK5Vzy82yB9SjLI5B3zfrR1QEaxyjyRGvVxWp_K66p31ZA/viewform')
  .type('input[name="entry.1921379240"]', 'NodeSchool Oakland')
  .end()
  .then(function () {});
```

My view of the electron window:

![screen shot 2016-10-10 at 6 29 43 pm](https://cloud.githubusercontent.com/assets/507047/19255990/d89529d4-8f17-11e6-8a70-d1f84d72fd8f.png)

Is there some way to forcefully close the nightmare instance?
 I have isolated the issue. It seems that Google Forms is setting the `unload` event and preventing navigation with the special `unload` confirm dialog.

I have a temporary fix right now:
- Hijack `window.addEventListener` and silently kill attempts to bind `unload` events
- Make `window.onunload` and `window.onbeforeunload` unwritable properties

I'll probably submit a pull req after I've cleaned up my solution.
 @rosshinkley in this case, `window.confirm` isn't the issue, it's the `unload` and `onbeforeunload` handlers. I managed to fix it with a custom `preload.js` script, which I've submitted in a pull request here: https://github.com/segmentio/nightmare/pull/825
  This feature would be really awesome!
 @rosshinkley this pull request is great! Thank you. It will help me with https://github.com/segmentio/nightmare/issues/830
  Found a small typo :).
  this example

```
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {
  it('should find the nightmare github link first', function(done) {
    var nightmare = Nightmare()
    nightmare
      .goto('http://yahoo.com')
      .type('form[action*="/search"] [name=p]', 'github nightmare')
      .click('form[action*="/search"] [type=submit]')
      .wait('#main')
      .evaluate(function () {
        return document.querySelector('#main .searchCenterMiddle li a').href
      })
      .end()
      .then(function(link) {
        expect(link).to.equal('https://github.com/segmentio/nightmare');
        done();
      })
  });
});

```

is giving this error 

```
  1 failing

  1) test yahoo search results should find the nightmare github link first:
     Uncaught Error: spawn /Users/user/Documents/projects/retail-scraper-fs/node_modules/electron-prebuilt/dist/Electron.app/Contents/MacOS/Electron ENFILE
      at exports._errnoException (util.js:856:11)
      at Process.ChildProcess._handle.onexit (internal/child_process.js:179:32)
      at onErrorNT (internal/child_process.js:345:16)
```
 yup 256, 
  Fix `visible` action to check against the current viewport using `getBoundingClientRect`.
You can check [here](http://stackoverflow.com/a/7557433/6409) for more information.
 @rosshinkley what's the state of this PR? 

Do you plan to merge it or you are afraid it will be breaking change?
 The definition of `visible` (at least mine) is that the user can interact with the element in the current viewport. This implies that if the element is bigger than the viewport but some parts of it are present in the viewport it should be `visible`.

_Doesn't this assume that to be visible, the bottom (and rightmost edge) of the element has to be in view?_ - Yes. Thinking twice about it maybe we should check the left top edge instead. Should I update the PR accordingly?

_In fact, all .visible() really implies is that the element is on the page and rendered._ - Isn't this the purpose of `.exists()`?
 Thanks, I'm closing this PR for now.
  I implemented a custom action 'realClick' from [another issue](https://github.com/segmentio/nightmare/issues/639#issuecomment-219873334), and it works great the first time. Upon the second usage (using the same selectors, later in the test), nothing happens.

I've tried this out in a few different test suites, and just curious how this could be occurring.

``` javascript
  nightmare.action('realClick',
    function(name, options, parent, win, renderer, complete) {
      parent.respondTo('realClick', function(x, y, done) {
        win.webContents.sendInputEvent({
          type: 'mousedown',
          x,
          y,
          clickCount: 1,
        });
        win.webContents.sendInputEvent({
          type: 'mouseup',
          x,
          y,
        });
        setTimeout(done, 500);
      });
    complete();
  }, function(selector, done) {
    const child = this.child;
    this.evaluate_now(function(selector) {
      const bounds = document.querySelector(selector).getBoundingClientRect();
      return {
        left: bounds.left,
        top: bounds.top,
        width: bounds.width,
        height: bounds.height,
      };
    }, function(error, bounds) {
      if (error) return done(error);
      const x = bounds.left + bounds.width / 2;
      const y = bounds.top + bounds.height / 2;
      const cb = function() { done(); };
      child.call('realClick', x, y, cb);
    }, selector);
  });
```
  I'm in a situation, that on script re-run are previously inserted input fields prefilled with old values.
So calling:

```
.insert('input#foo', 'zzz')
```

or

```
.type('input#foo', 'zzz')
```

makes the value to be appended only.
Any chance to overwrite?
Currently I'm workarounding it with:

```
.evaluate(function() {
    document.querySelector('input#foo').value = 'zzz'
    })
```
 I think this is the desired behaviour. Following the philosophy of that, maybe you should try to insert backspace characters.
 @marcelfalliere OK you're right, what works for me is to do:

```
.evaluate(function() {
    document.querySelector('input#foo').value = ''
})
.insert('input#foo', 'zzz')
```

however it could be handy to have some API way to do that, either some boolean flag for replace, or some clear method.
 @rosshinkley 

> I do have a question:
> 
> >    ...on script re-run are previously inserted input fields prefilled with old values.
> 
> Meaning that the values are there between runs to the same site?

correct
  Hi guys,

Trying to leverage `nightmare` in order to be able to convert an svg to a png.
For some reason the following gets stuck on the `screenshot` action:

``` node
var Nightmare = require('nightmare')
var nightmare = Nightmare({show: true})
var url = "file:///Users/username/Pictures/whatever.svg"
var userAgent = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36"

nightmare
  .useragent(userAgent)
    .goto(url)
  .wait('svg')
  .evaluate(() => {
    const svgElem = document.querySelector('svg')

    return {
      width: svgElem.scrollWidth,
      height: svgElem.scrollHeight
    }
  })
  .then(function(dimensions) {
    return nightmare
      .viewport(dimensions.width, dimensions.height)
      .screenshot('./screenshot.png')
  })
  .then(function() {
    console.log('done')
    nightmare.end()
  })
  .catch(function(err) {
    console.log('error', err)
  })
```

Logs:

```
  nightmare queuing process start +0ms
  nightmare queueing action "useragent" +2ms
  nightmare queueing action "goto" for file:///Users/username/Pictures/whatever.svg +1ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +1ms
  nightmare:actions .useragent() to Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36 +360ms
  nightmare:log Navigating: "file:///Users/username/Pictures/whatever.svg",
            headers: [none],
            timeout: 30000 +8ms
  nightmare:log did-start-loading +63ms [{}]
  nightmare:log did-get-response-details +77ms [{},true,"file:///Users/username/Pictures/whatever.svg","file:///Users/username/Pictures/whatever.svg",200,"GET","",{"access-control-allow-origin":["*"]},"mainFrame"]
  nightmare:log dom-ready +91ms [{}]
  nightmare:log did-frame-finish-load +0ms [{},true]
  nightmare:log did-finish-load +1ms [{}]
  nightmare:log did-stop-loading +1ms [{}]
  nightmare:actions .wait() for svg element +1ms
  nightmare:actions .evaluate() fn on the page +6ms
  nightmare queueing action "viewport" +3ms
  nightmare queueing action "screenshot" +0ms
  nightmare running +0ms
  nightmare:actions .viewport() +0ms
  nightmare:actions .screenshot() +29ms
  nightmare:log subscribing to browser window frames +1ms
  nightmare:log altering page to force rendering +0ms
```

using `pdf` instead of `screenshot` does not get stuck. Any idea what may be causing this?
 Check this out https://github.com/segmentio/nightmare/issues/761
 @rosshinkley unfortunately not for SVGs :)
 Anyone here experiencing timeouts may want to give the #927 a try. Thereâ€™s also second approach to solving this over on https://github.com/mr0grog/nightmare/tree/screenshot-with-offscreen-rendering that you might give a try.  This adds a document for [mouseover(selector)](https://github.com/segmentio/nightmare/blob/2c3284723bc5c7d82a64ac8130af3b84774e4d54/lib/actions.js#L126-L137).
  I am using nightmare.js (awesome work by the way) to detect variables attached to the window object by some script.

So the setup is pretty basic. I have a web server serving a simple html file. Notice the `var beforeKeys = Object.keys(window)`

**thepage.html**

```
<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
  </body>
  <script>
    var beforeKeys = Object.keys(window);
  </script>
</html>

```

The way this page is used, with nightmare, is like so :

```
  var n = Nightmare();
  n.on('console', function(type, arg0, arg1){
    if (arg0 == 'windowVariablesDifferences') {
      // this is where the wtf happens
    }
  })
  .goto('http://localhost:1986/thepage.html')
  .inject('js', scriptPath)
```

The injected scripts, at `scriptPath`, looks like this :

```
var foo, foo2, foo3,
    bar = 0;

function init() {

  foo = new SOMECLASS();
  // ...

  foo2 = new SOOOOMECLASS();
  // ...

  foo3 = new SOMECLASSYCLASS();
  // ...

  qux = new SOMEOTHERCLASS();
  //

}

init();

console.log("windowVariablesDifferences", Object.keys(window).filter(function(i){ return beforeKeys.indexOf(i) < 0 }))

```

So to translate this code into what it does :
- nightmare loads thepage.html
- the `beforeKeys` variable holds the keys of the window object
- nightmare injects the scripts
- the scripts does its stuff
- at the end, it logs the difference between the keys before the script and after the script

So the difference **should be** an array containing `["foo", "foo2", "foo3", "bar", "qux"]`. 

**But it is not**. It is an array containing `["bar", "qux"]`

Something to consider : when I test this in a classic web browser (let's say Google Chrome) I get the expected result. I use the same content but with a one line addition for `<script src="scriptPath.js"></script>`, just before the `</html>`.

Weird ? Or am I missing something ? The test case is of course pruned from the actual work done here... but the idea is here. 
  Hi guys,
why the way to loading/render pages more fast ? Have parameters for this ?

thx a lot.
 Thx a lot @rosshinkley 
  I need to access new window from nightmare and manipulate it as I do in main window. Is that even possible?

```
nightmare
  .goto('http://website.com/')
  .click('button[id="mybutton"]') // this actually opens new window/tab whatever.
  .type('input[type="text"]', 'hello world') // I want this to happen on new window, how?
  .then(function () { console.log('all done'); })
  .catch(function (err) { console.log(err); });
```

basic html:

```
<button id="mybutton" onclick="javascript:window.open('http://website.com/', '_blank');">click me</button>
<input type="text"></input>
```

EDIT: Don't get me wrong, I've searched same questions here, but isn't there any workaround? If not, can I just block opening new window and load the new page into the current one?

EDIT2: I've noticed, that if you specify `show: false` opening new tab/window is shown by default. Any thoughts about this? It's getting annoying though.
 Thanks for the reply! I've tried nightmare-window-manager too, but still I'm facing second issue. no matter if I specify `show: false` new window always opens up visible.
  Fixes ReferenceError when called in Strict Mode.

see issue #799
  Calling `nightmare.wait('#someID')` while executing in Strict Mode (ie `node --use_strict`) causes the following error:

``` js
/Users/samramirez/Projects/loj/node_modules/nightmare/lib/actions.js:384
  waitfn.apply(this, [self, elementPresent, done]);
                            ^

ReferenceError: elementPresent is not defined
    at Object.waitelem (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/actions.js:384:29)
    at Nightmare.exports.wait (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/actions.js:347:14)
    at Nightmare.next (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/nightmare.js:315:12)
    at /Users/samramirez/Projects/loj/node_modules/nightmare/lib/nightmare.js:323:46
    at EventEmitter.<anonymous> (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/ipc.js:93:18)
    at EventEmitter.g (events.js:273:16)
    at emitNone (events.js:80:13)
    at EventEmitter.emit (events.js:179:7)
    at ChildProcess.<anonymous> (/Users/samramirez/Projects/loj/node_modules/nightmare/lib/ipc.js:49:10)
    at emitTwo (events.js:100:13)
```

I will include code that can reproduce the error below.

The issue is that `wait` calls an `eval` which tries to create a variable in the local scope, and then use that variable.

actions.js:375

```
function waitelem (self, selector, done) {
  eval("var elementPresent = function() {"+
      "  var element = document.querySelector('"+jsesc(selector)+"');"+
      "  return (element ? true : false);" +
      "};");
  waitfn.apply(this, [self, elementPresent, done]);
}
```

When executing in Strict Mode, `eval` can't create local variables [(see section 1.1 here)](http://www.2ality.com/2014/01/eval.html).  So after the `eval`, `elementPresent` doesn't exist.

I submit a [PR](https://github.com/segmentio/nightmare/pull/800) for a fix.  I think its as easy as declaring `elementPresent` before calling `eval`.

Thanks,
Sam

Edit:

breaksOnStrict.js

```
var Nightmare = require('nightmare');
var nightmare = new Nightmare();
nightmare
    .goto('https://github.com/segmentio/nightmare')
    .wait('body')
    .end()
    .then(() => {
        // do stuff
    });
```

Run the above with:
`node --use_strict breaksOnStrict.js`

it should produce the above error.

Edit2:
Link to PR
https://github.com/segmentio/nightmare/pull/800
  well. I have read the doc. As it said, we can use `.on('page', function(type, message))` to listen the page event.

well. I can print the alert message in the iTerm now. But how could I print the message through the browser alert widow?
    Seeing nightmare hang on certain webpages where as those same pages load fine running in plain electron (same version)

```
Electron Version - 1.3.5 (same result for anything above this as well)
Nightmare Version - 2.7.0
Node - 4.4.5
```

```
process.env.DEBUG = 'nightmare';
var electronPath = require('electron');
var Nightmare = require('nightmare');
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

nightmare
  .goto('http://time.com/')
  .viewport(1280, 600)
  .wait(10000)
  .end()
  .then(function (result) {
    console.log(result)
  })
  .catch(function (error) {
    console.error('Search failed:', error);
  });
```
 @rosshinkley yes still seeing this issue. Using electron 1.3.4 and nightmare 2.7.0 work fine.   I've been trying to get my nightmare script to click on an element, which opens up a modal dialog. Can never get the dialog to actually open, so the click essentially does nothing.

I have tried
- `.click('img#elementid')`
   ..but nothing happens in either the console or the rendered browser
- `.evaluate(function() { 
    $('img#elementid').click();
  })` (That jQuery statement works in the browser.)
    ..but only got an error logged in the console running my nightmare script saying       'window.showModalDialog is not a function'. (Again, does not by doing this in the browser)
- Based on the previous error, I  viewed the source of the page, copied the 'onclick' function that the 'img#elementid' calls to, and pasted that into a nightmare 'evaluate' function, followed by the actual call it makes.

```
 .evaluate(function() {
  function openWindow(dialogWindow, type) {
    var retval;
    var domain = '';
    var cacheId = '';
    var txtGroupType = '';

    if (document.getElementById("ctl00_ContentPlaceHolder1_txtGroupType") != null)
      groupType = document.getElementById("ctl00_ContentPlaceHolder1_txtGroupType").value;

    if (document.getElementById("ctl00_ContentPlaceHolder1_ddDomain") != null)
      domain = document.getElementById("ctl00_ContentPlaceHolder1_ddDomain").value;

    if (document.getElementById("ctl00_ContentPlaceHolder1_txtCacheId") != null)
      cacheId = document.getElementById("ctl00_ContentPlaceHolder1_txtCacheId").value;

    if (domain == '')
      if (document.getElementById("ctl00_ContentPlaceHolder1_lblDomain") != null)
        domain = document.getElementById("ctl00_ContentPlaceHolder1_lblDomain").innerHTML;

    if (domain == '')
      if (dialogWindow == 'ADSearch')
        alert('You must first select a domain for the group prior to adding managers and members.');
      else
        alert('You must first select a domain for the group prior to importing managers or members.');
    else {
      //open the appropriate window
      if (dialogWindow == 'ADSearch')
        retval = window.showModalDialog('../ADSearch.aspx?Type=' + type + '&domain=' + domain + '&grpType=' + groupType + '&cacheId=' + cacheId, 'ADUserLookup', 'dialogHeight: 880px; dialogWidth: 842px; edge: Raised; center: Yes; help: No; resizable: Yes; status: No; status:no; dialogHide:true; help:no; scroll:yes');
      else
        retval = window.showModalDialog('GroupMemberImport.aspx?Type=' + type + '&domain=' + domain + '&grpType=' + groupType + '&cacheId=' + cacheId, 'GroupMemberImport', 'dialogHeight: 400px; dialogWidth: 842px; edge: Raised; center: Yes; help: No; resizable: Yes; status: No; status:no; dialogHide:true; help:no; scroll:yes');

      if (retval != null) {
        //rebuild member lists
        __doPostBack('changeMembers', '');
      }
    }
  }
  openWindow('ADSearch', 6);  //calls the function, same thing clicking 'img#elementid' should do
})
```

  ..but still got the 'window.showModalDialog is not a function' error.

What am I missing?
 @rosshinkley Sorry about the delay, and thanks for the response! It's added in that evaluate function I pasted above. That's the 'onClick' method that gets called the button is clicked. Still stumped on this.. I will give 619 a read
  huh, _5300_WellsFargoEmployees also returns undefined
  I am loading a page and I have a bad path to a local script (which I can fix). But while I was debugging this problem my test was failing due to a wait timeout. It turned out that I was getting a 404 during the page load and I did not get any error messages despite attaching to the `'page'` and `'log'` functions.

What is the right way to detect 404's during page load?
 Perfect, thanks.

On Sun, Sep 18, 2016, 2:50 PM Ross Hinkley notifications@github.com wrote:

> Non-200 codes are not treated as errors - pages that respond with non-200
> codes might be expected behavior.
> 
> .goto()'s return https://github.com/segmentio/nightmare#gotourl-headers
> will include metadata about the page load, including the response code. A
> quick off-the-cuff example:
> 
> var nightmare = require('nightmare')();nightmare.goto('http://example.com/404')
>   .then(function(gotoResult) {
>     console.dir(gotoResult.code);
>     return nightmare.end();
>   })
>   .then(()=>console.log('done'));
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/790#issuecomment-247870576,
> or mute the thread
> https://github.com/notifications/unsubscribe-auth/AAAq3vhJ8Q7ktzfMr_fC1CfLpGGp5uiuks5qrZYDgaJpZM4J6wUO
> .
 Im not sure this is clear in the documentation because it states

```
When a page load is successful, goto returns an object with metadata about the page load, including:
```

Maybe providing an example with this basic usage provided in @rosshinkley's comment would make it easier to understand?
  Adds an api to forcibly kill the child process immediately, as discussed here: https://gitter.im/rosshinkley/nightmare?at=57d17dcb68f483b41cb0491a
    Hello,

Went through electron docs but it's still not obvious how to intercept all ajax responses? I would need something like: http://api.jquery.com/ajaxcomplete/

Thanks!
 I think you can do it by using 'did-get-response-details' event.

```
nightmare
      .goto(URL)
      .on('did-get-response-details', function(e, s, n, o, rc, rm, r, h, type) {
            console.log({url:n, type:type});}
        });
```

But I don't know if it's possible to read the actual response data.

More info:
- http://electron.atom.io/docs/api/web-contents/
- https://github.com/segmentio/nightmare/#onevent-callback  I also had to add a `return` for values to get passed back:

```
Nightmare.action('getText', function (selector, done) {
  return this.evaluate_now(function (selector) {
    return document.querySelector(selector).textContent
  }, done, selector)
})
```
  Adding `document.evaluate()` before regular `document.querySelector()` calls, transparently handling XPath expressions. 

Could be an initial implementation to target #775 

Thanks,
Gustavo
 Hi @rosshinkley,

Can you help me on this? I'm receiving the method `cssLookup` is not defined and I'm pretty sure I'm missing something obvious. An outside eye could help me a  lot.
 Hi @rosshinkley,

Thanks for your response. XPath is the only available option to select elements by the inner text, for instance.

It's widely used on Selenium space, for example.

Thanks,
Gustavo
 Please make this happen ðŸ˜„ 
  Thanks for this library, it's really awesome.
I've had to deal with a new use case recently, and I didn't see any example related.

So my question is: Can I use Nightmare, somehow, to post some data through the HTTP body?
Example of what I'd like, using the [request](https://www.npmjs.com/package/co-request) library:

``` javascript
const request = require('co-request');

const opts = {
    method: 'POST',
    url: 'http://example.com',
    headers: { 'cache-control': 'no-cache' },
    formData: { // My data object I want to send
        id_stuff: '160',
        date: '10/12/2016',
   },
};

const test = yield request(opts);
```
 @rosshinkley I've got two options:
- Going from a "Page A" and filling a form. Once submitted, it leads me to "Page B", which is a results page. 
- Or going straight to "Page B", but with a 'POST' method, and some Body `form-data` parameters. This will also lead me to the "Page B" results.
  Screenshot from Postman: 
  <img width="905" alt="postman" src="https://cloud.githubusercontent.com/assets/5517450/18258786/8382a286-741f-11e6-91c9-c4295440a3bb.png">

The second option would be quicker as I would skip the first page. I wondered is such a thing is possible with Nightmare. Something like:

``` javascript
const url = 'http://url-page-b.com';
const headers = { method: 'POST', 'cache-control': 'no-cache' };
const data = { id_stuff: '160', ... };

nightmare.goto(url, headers, data);
```

Hope that's clear enough! Thanks :)
 I have a similar problem, have to write a bunch of tests to cover some functionality of a project we're working on and being able to do this would make the login step much faster, particularly given that we want to run every test in as isolated a fashion as possible. 
 method post is not part of "header" the original question has it correctly.  I suppose if one could figure out actions maybe some serious hackery could be done there. 
really needs to be a new verb method in Nightmare class itself. 
Change or create new methods for .GET  .POST  .DELETE .PUT .SEARCH implement accordingly. 
It seems like this is a core electron problem. 
https://discuss.atom.io/t/add-http-post-method-to-electron-webview/29702
It comes back to the metaphor of the software.  It's a browser and it is impossible from a URL input to perform anything but a http GET from the URL address line.   `.goto` is the same as typing into the browser a location, which is only ever going to be a .GET method. 
So running arbitrary js fun is the only way. 

> You might be able to send a POST manually through AJAX/fetch etc then replace the HTML of the page in the webview with the HTML returned by your manual POST. You can achieve this using .executeJavaScript() and/or Electron's IPC.

Is there an decent example for doing this?    Hi there,

I'm trying to run nightmare example but no luck at all. This is what I have so far:

```
var Nightmare = require('nightmare');
var expect = require('expect');

describe('test yahoo search results', function() {
  it('should find the nightmare github link first', function() {
    var nightmare = Nightmare()
    var breadcrumb = nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.url.breadcrumb')
      .evaluate(function () {
        return document.querySelector('.url.breadcrumb').innerText;
      })
      .then(function(result) {
          return result;
      });
    expect(breadcrumb).toEqual('github.com');
  });
});
```

This fails and says Error: Expected {} to equal 'github.com'

Trying out the example posted in the readme timeouts.
 Thank you so much :). 
 The example you gave worked fine but when I try it on a different test I still get the timeout. Here is my code: 

```
describe('Login Page', function() {
  it('username and password should log you into the dashboard', function(done) {
    var nightmare = Nightmare()
      .goto(CONST.url)
      .type(CONST.usernameID, CONST.username) // enter user name
      .type(CONST.passID, CONST.password) // enter password
      .click(CONST.loginButtonID) // click log in
      .wait(TESTCONST.IDToCheckAfterLogin) // wait for dashboard to come up
      .evaluate(function () {     // Select dashboard title and return text 
          return document.querySelector(TESTCONST.mainPageDashBoardElementSelector).innerText;
      })
      .then(function(result) {
        // assert
        expect(result).toEqual(TESTCONST.dashboard);
        done();
      });    
  });
});
```

I'm trying to login to Wordpress but it timeouts
 This is what the DEBUG flag is showing:

  nightmare queuing process start +0ms
  nightmare queueing action "viewport" +2ms
  nightmare queueing action "goto" for http://example.org/wp-login.php +2ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +1ms

Not sure what I can draw out of this.  This is just a placeholder http://example.org/wp-login.php
Also catch does't return any errors. 
  Because 0 is falsy, type() and insert() evaluate the `text || '' == ''` case instead of actually typing the value. Hence `type(selector, 0)` clears the selector.

The workaround is to `type(selector, '0')`.
  Hi
I am encountering the following error when I bundled the system.config in my HTML Script using a gulp-task. 

angular2.js:23925 EXCEPTION: TypeError: Cannot read property 'indexOf' of undefined

Can someone tell me where I am breaking.
  Hi,

I was thinking on how we can add XPath selectors support on nightmare.js and I'd tried the easy path - relying directly on `$x()` helper, available on Chrome. 

Not sure why it's not working within Electron/webContents.

Thoughts?

Thanks,
Gustavo
  I have a loop containing a setTimeout inside the nightmare.evaluate function. It seems that there is a race condition where the nightmare.end() function executes faster than nightmare.evaluate. How can I prevent that from happening ? Note that I am not using multiple evaluates , all methods I use only once.
  Opening this issue to let you know about a new package that I've created that allows deferred returns against evaluates. We're using this so that we can test that ajax requests return valid data packages, but it could be used for any custom "waitUntil..." type of action.

https://www.npmjs.com/package/nightmare-evaluate-with-callback
  It seems that nightmare is not running unless I chain a `.then()` (or other promise 'handler') at the end of the promises chain. I can see the actions get queued, but not ran.

Is this expected behaviour?
 code example:

```
var res = runScript();

function runScript() {
    this.nm = Nightmare();
    return nm.doSomething();
}

function doSomething() {
    return this.nm.goto('http://google.com');
}
```

This code doesn't run Nightmare, unless I change `runScript()` to `runScript().then(...)` (or put a `then()` after the last nightmare function in `doSomething()`.
 Wow, just lost 15 min trying to figure out why nightmare is not starting and exiting the script without any log. ðŸ˜„ 
  On some sites I have noticed that the .goto() call times out when visiting certain urls while running on headless linux.

I followed advice on another thread and setup xvfb on my ubuntu server, and when running scripts most succeed, however I have noticed that some sites appear to never load. I have set `DEBUG=nightmare*` and see that I receive 200 codes from the server, and I see it loads all the resources, it just doesn't ever finalize.

Please see the attached script:
### Test Script

```
var

 link = 'http://albertsons.com'
 , vo = require('vo')
 , Nightmare = require('nightmare')
 ;

console.log('Starting nightmare');
nightmare = Nightmare({
  waitTimeout: 600000
  , webPreferences: {
    webSecurity: false
  }
});

vo(function*() {

  console.log('In generator');
  yield nightmare
    .goto(link)
    .then(function (res) {
        console.log('Visited link, then');
    });

  console.log('Closing nightmare');
  yield nightmare.end();

})(function (err, results) {
  if (err) {
    console.log('Has error');
    console.log(err);
  } else {
    console.log('Has results');
    console.log(results);
  }
});
```

This will always result in a a navigation timeout error. Change the link to almost any other site, such as http://google.com and it works fine. This issue is not apparent when running locally on OSX, even with xvfb.
### Standard Output (working)

```
Starting nightmare
  nightmare queuing process start +0ms
In generator
  nightmare queueing action "goto" for http://albertsons.com +4ms
  nightmare running +1ms
  nightmare:log Navigating: "http://albertsons.com",
            headers: [none],
            timeout: 30000 +236ms
  nightmare:log did-start-loading +57ms [{}]
  nightmare:log did-get-redirect-request +21ms [{},"http://albertsons.com/","http://www.albertsons.com/",true,301,"GET","",{"accept-ranges":["bytes"],"age":["0"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:24:31 GMT"],"location":["http://www.albertsons.com/"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-pingback":["http://www.albertsons.com/xmlrpc.php"],"x-powered-by":["PHP/5.3.3"],"x-varnish":["1348395777"]}]
  nightmare:log did-get-response-details +832ms [{},false,"http://www.albertsons.com/","http://albertsons.com/",200,"GET","",{"accept-ranges":["bytes"],"age":["0"],"connection":["keep-alive"],"content-length":["74875"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:30:59 GMT"],"link":["<http://www.albertsons.com/wp-json/>; rel=\"https://api.w.org/\"","<http://www.albertsons.com/>; rel=shortlink"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-pingback":["http://www.albertsons.com/xmlrpc.php"],"x-powered-by":["PHP/5.3.3"],"x-varnish":["1348405685"]},"mainFrame"]
  nightmare:log did-get-response-details +82ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["164"],"content-length":["40430"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"36487-9dee-523958c824480\""],"last-modified":["Mon, 02 Nov 2015 21:34:58 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989369 2379985650"]},"stylesheet"]
  nightmare:log did-get-response-details +0ms [{},false,"http://fonts.googleapis.com/css?family=Droid+Sans","http://fonts.googleapis.com/css?family=Droid+Sans",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"cache-control":["private, max-age=86400, stale-while-revalidate=604800"],"content-encoding":["gzip"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:32 GMT"],"expires":["Tue, 30 Aug 2016 15:24:32 GMT"],"last-modified":["Tue, 30 Aug 2016 15:24:32 GMT"],"link":["<http://fonts.gstatic.com>; rel=preconnect; crossorigin"],"server":["ESF"],"timing-allow-origin":["*"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-pinboard-widget/style.css?v=1&ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-pinboard-widget/style.css?v=1&ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes","bytes"],"age":["0"],"content-length":["981"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"26261d-3d5-5131e4c439f40\""],"last-modified":["Tue, 07 Apr 2015 08:35:33 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-varnish":["1838771141"]},"stylesheet"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/style.css?ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/style.css?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2825"],"content-length":["1147"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"22623-47b-53679248211c0\""],"last-modified":["Thu, 30 Jun 2016 06:40:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989370 2379912368"]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"http://assets.pinterest.com/images/pidgets/pin_it_button.png","http://assets.pinterest.com/images/pidgets/pin_it_button.png",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=1209600"],"content-length":["909"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"last-modified":["Thu, 02 Jun 2016 17:17:12 GMT"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-includes/js/jquery/jquery.js?ver=1.12.4","http://www.albertsons.com/wp-includes/js/jquery/jquery.js?ver=1.12.4",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["436"],"content-length":["97184"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"28c15c-17ba0-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686475 2300675191"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1","http://www.albertsons.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1141"],"content-length":["10056"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"120083-2748-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887732301 887700274"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/jquery.nailthumb.1.0.min.js?ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/jquery.nailthumb.1.0.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2552"],"content-length":["15886"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"225db-3e0e-53679248211c0\""],"last-modified":["Thu, 30 Jun 2016 06:40:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989374 2379921010"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/superfish.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/superfish.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["849"],"content-length":["3833"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"270366-ef9-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771147 1838748408"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/hoverIntent.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/hoverIntent.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3115"],"content-length":["3257"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"3635e-cb9-4d7478ef65200\""],"last-modified":["Wed, 06 Mar 2013 20:37:28 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989378 2379902646"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.watermark.min.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.watermark.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2819"],"content-length":["4629"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"270363-1215-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771149 1838692837"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.cycle.all.min.js","http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.cycle.all.min.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2194"],"content-length":["32066"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"10e43c-7d42-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887732303 887670074"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/scripts/getCustomerData.js","http://www.albertsons.com/wp-content/themes/albertsons/scripts/getCustomerData.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3027"],"content-length":["1713"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"36368-6b1-4f6388ca3f740\""],"last-modified":["Fri, 04 Apr 2014 14:44:05 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989384 2379905604"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/scripts/json2.js","http://www.albertsons.com/wp-content/themes/albertsons/scripts/json2.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3201"],"content-length":["3377"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"27036a-d31-4ca6492d7d000\""],"last-modified":["Sun, 23 Sep 2012 20:46:56 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771154 1838680905"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4fc14192152e30a5","http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4fc14192152e30a5",200,"GET","http://www.albertsons.com/",{"cache-control":["public, no-check, max-age=600"],"cf-cache-status":["HIT"],"cf-ray":["2da9401307852006-DFW"],"content-encoding":["gzip"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"35cc961-59c64-53b3796df2600\""],"last-modified":["Mon, 29 Aug 2016 15:33:44 GMT"],"server":["cloudflare-nginx"],"surrogate-key":["client_dist"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-distribution":["99"],"x-host":["s7.addthis.com"]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/fonts/Caferus/Caferus.css","http://www.albertsons.com/wp-content/themes/albertsons/fonts/Caferus/Caferus.css",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["2047"],"content-length":["2730"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"440e0-aaa-517b342a13800\""],"last-modified":["Thu, 04 Jun 2015 15:59:28 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989389 2379935555"]},"stylesheet"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/android_robot_21x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/android_robot_21x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1984"],"content-length":["3619"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"42255-e23-5166f15887a80\""],"last-modified":["Tue, 19 May 2015 13:14:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989390 2379937361"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/app-store-icon_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/app-store-icon_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1987"],"content-length":["4330"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"280256-10ea-5166f15887a80\""],"last-modified":["Tue, 19 May 2015 13:14:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771158 1838717912"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/instagram_icon_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/instagram_icon_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1668"],"content-length":["4558"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"12c258-11ce-5166f15b64140\""],"last-modified":["Tue, 19 May 2015 13:14:05 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887732307 887686153"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/youtube_social_squircle_red_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/youtube_social_squircle_red_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3311"],"content-length":["3872"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"4225b-f20-5166f15d4c5c0\""],"last-modified":["Tue, 19 May 2015 13:14:07 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989393 2379896082"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/twitter_logo_white_bluebkgrnd_radius_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/twitter_logo_white_bluebkgrnd_radius_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2528"],"content-length":["3967"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"4225a-f7f-5166f15c58380\""],"last-modified":["Tue, 19 May 2015 13:14:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989394 2379921643"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/pinterest_badge_red_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/pinterest_badge_red_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2176"],"content-length":["3472"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"42259-d90-5166f15c58380\""],"last-modified":["Tue, 19 May 2015 13:14:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989395 2379931977"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/fb_f_logo_radius_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/fb_f_logo_radius_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2542"],"content-length":["3821"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"280257-eed-5166f1597bcc0\""],"last-modified":["Tue, 19 May 2015 13:14:03 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771162 1838701258"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/11/abslogo2000v4.jpg","http://www.albertsons.com/wp-content/uploads/2015/11/abslogo2000v4.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2849"],"content-length":["60925"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"4c17a-edfd-524c4efbec480\""],"last-modified":["Tue, 17 Nov 2015 23:32:18 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989400 2379911600"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://connect.facebook.net/en_US/all.js#xfbml=1","http://connect.facebook.net/en_US/all.js#xfbml=1",200,"GET","http://www.albertsons.com/",{"access-control-expose-headers":["X-FB-Content-MD5"],"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["57976"],"content-md5":["mn1DRvDT7V+xuUglrs8zAQ=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"39b9f10bc5006674609e90f432f626b4\""],"expires":["Tue, 30 Aug 2016 15:37:52 GMT"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-content-md5":["4afc3f1c3fb7a3bbce64c3879b342c31"],"x-fb-debug":["/kis68FXb3sqLGRlQ6RCVHSBPjvxdec/CKUHSS9UkMY/E8d9EjBi9nX6d6a3micq3sfgXLtzSCt/yabmj1znUg=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn.gif",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["111"],"content-length":["1881"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"10e409-759-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887732309 887729695"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/truck_icon.png","http://www.albertsons.com/wp-content/themes/albertsons/images/truck_icon.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3478"],"content-length":["2340"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"362f6-924-521e93b16cd80\""],"last-modified":["Mon, 12 Oct 2015 14:34:46 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989404 2379890946"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn-black.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn-black.gif",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1284"],"content-length":["1877"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"2923c0-755-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686490 2300653407"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/FluShot_2016_ALB_HomepageSlider_ABS-975x490.png","http://www.albertsons.com/wp-content/uploads/2016/08/FluShot_2016_ALB_HomepageSlider_ABS-975x490.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3378"],"content-length":["168430"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"5a47d-291ee-539d35ba55d80\""],"last-modified":["Thu, 11 Aug 2016 22:33:42 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989405 2379893978"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/07/ABS-Fuel-Program-Homepage-FeatureUnit-Desktop.jpg","http://www.albertsons.com/wp-content/uploads/2016/07/ABS-Fuel-Program-Homepage-FeatureUnit-Desktop.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2361"],"content-length":["118887"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"29633c-1d067-5381a55f55580\""],"last-modified":["Thu, 21 Jul 2016 00:24:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771166 1838706571"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/04/albciv56063_rxplus_alb_homepageslider_976x492-976x490.jpg","http://www.albertsons.com/wp-content/uploads/2016/04/albciv56063_rxplus_alb_homepageslider_976x492-976x490.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1197"],"content-length":["66098"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"561aa-10232-52f73e01880c0\""],"last-modified":["Fri, 01 Apr 2016 22:26:51 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989407 2379958603"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2012/10/Homepage-Slider-ROTW1.jpg","http://www.albertsons.com/wp-content/uploads/2012/10/Homepage-Slider-ROTW1.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2542"],"content-length":["256668"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"10ee5b-3ea9c-4cb1912826900\""],"last-modified":["Tue, 02 Oct 2012 20:07:32 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887732312 887658529"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/01/Weekly-Ad-Homepage-Slider-976x492-976x490.jpg","http://www.albertsons.com/wp-content/uploads/2016/01/Weekly-Ad-Homepage-Slider-976x492-976x490.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1098"],"content-length":["117205"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"2ae1c3-1c9d5-52a530fe6f640\""],"last-modified":["Wed, 27 Jan 2016 16:12:01 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686495 2300657624"]},"image"]
  nightmare:log did-get-response-details +17ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/AdBar_2.jpg","http://www.albertsons.com/wp-content/themes/albertsons/images/AdBar_2.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3199"],"content-length":["13394"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"3631e-3452-4f0f80bb7e780\""],"last-modified":["Mon, 27 Jan 2014 18:40:46 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989410 2379899752"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-CakesAndDeliTrays-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-CakesAndDeliTrays-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3139"],"content-length":["2366"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"2a576-93e-4df7ab75a5f80\""],"last-modified":["Wed, 19 Jun 2013 05:01:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989416 2379901791"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-Coupons-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-Coupons-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2528"],"content-length":["2325"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"2a57d-915-4df7ae59b3180\""],"last-modified":["Wed, 19 Jun 2013 05:13:58 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989417 2379921681"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-ShoppingList-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-ShoppingList-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2148"],"content-length":["2446"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"2a584-98e-4df7adf7789c0\""],"last-modified":["Wed, 19 Jun 2013 05:12:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989418 2379932649"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-WeeklyAdEmail-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-WeeklyAdEmail-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["359"],"content-length":["2311"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"4760e4-907-4df7ae000de00\""],"last-modified":["Wed, 19 Jun 2013 05:12:24 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838771176 1838761357"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/ProteinTravelBarsABS.jpg","http://www.albertsons.com/wp-content/uploads/2016/08/ProteinTravelBarsABS.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2886"],"content-length":["20266"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"5a4b7-4f2a-53aafb4d37cc0\""],"last-modified":["Mon, 22 Aug 2016 21:26:51 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989420 2379910376"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/getty_686341746996879530-768x512.jpg","http://www.albertsons.com/wp-content/uploads/2016/08/getty_686341746996879530-768x512.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["140"],"content-length":["78351"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"5a4ed-1320f-53b009527b700\""],"last-modified":["Fri, 26 Aug 2016 21:56:12 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989423 2379986170"]},"image"]
  nightmare:log did-get-response-details +57ms [{},false,"http://assets.pinterest.com/js/pinit.js","http://assets.pinterest.com/js/pinit.js",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=1209600"],"content-encoding":["gzip"],"content-length":["286"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"last-modified":["Fri, 19 Aug 2016 18:24:17 GMT"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-includes/js/wp-embed.min.js?ver=4.5.3","http://www.albertsons.com/wp-includes/js/wp-embed.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1155"],"content-length":["1403"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"etag":["\"24613-57b-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379989388 2379959307"]},"script"]
  nightmare:log did-frame-finish-load +69ms [{},false]
  nightmare:log did-frame-finish-load +2ms [{},false]
  nightmare:log did-get-response-details +4ms [{},false,"http://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f37fc2f4973faac&origin=http%3A%2F%2Fwww.albertsons.com","http://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f37fc2f4973faac&origin=http%3A%2F%2Fwww.albertsons.com",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["11565"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"expires":["Wed, 30 Aug 2017 02:35:10 GMT"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["yO17VdYuIvrDUmx8MIvKDbzh4CiuVsQSaUwxUML4Luk78hkv7lFGV5ouS1QD+U6uUO++tIDakSzYcN4T6Z8EBg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +3ms [{},false,"https://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f37fc2f4973faac&origin=http%3A%2F%2Fwww.albertsons.com","https://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f37fc2f4973faac&origin=http%3A%2F%2Fwww.albertsons.com",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["11565"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:33 GMT"],"expires":["Wed, 30 Aug 2017 02:35:10 GMT"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["yO17VdYuIvrDUmx8MIvKDbzh4CiuVsQSaUwxUML4Luk78hkv7lFGV5ouS1QD+U6uUO++tIDakSzYcN4T6Z8EBg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-frame-finish-load +13ms [{},false]
  nightmare:log did-frame-finish-load +11ms [{},false]
  nightmare:log did-get-response-details +155ms [{},false,"https://www.facebook.com/impression.php/f3593fb4fba1b28/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D","https://www.facebook.com/impression.php/f3593fb4fba1b28/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-length":["43"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:30:59 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"x-content-type-options":["nosniff"],"x-fb-debug":["LhOZBogYUOg/V3MnjsYVPlVu+fO3v4Alfdkn93DVOPZY8sEXcSKvHB4isFDLXnE+yebnt/Zy1cBO/DjjJ2OZzg=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +90ms [{},false,"https://albertsons.mywebgrocer.com//Ajax/CustomerData/Get/98829CD9-7DC8-4B9E-AE3B-36E0944F5E9B?timestamp=1472571059737","https://albertsons.mywebgrocer.com//Ajax/CustomerData/Get/98829CD9-7DC8-4B9E-AE3B-36E0944F5E9B?timestamp=1472571059737",200,"GET","http://www.albertsons.com/",{"cache-control":["private"],"content-length":["112"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:30:59 GMT"],"p3p":["CP=\"ALL CURa ADMa DEVa TAIa OUR BUS IND ONL UNI COM NAV INT\", policyref=\"/w3c/p3p.xml\""],"set-cookie":["UMA_T=t; domain=.albertsons.mywebgrocer.com; expires=Thu, 29-Sep-2016 15:31:00 GMT; path=/","UMA_S=s=361990357&g=3f040782-8472-420e-9aab-43860606344e; domain=.albertsons.mywebgrocer.com; expires=Thu, 29-Sep-2016 15:31:00 GMT; path=/","SA_STRID=BC1678316; domain=.albertsons.mywebgrocer.com; expires=Wed, 30-Aug-2017 15:31:00 GMT; path=/","UMA_STCF=False; domain=.albertsons.mywebgrocer.com; expires=Wed, 30-Aug-2017 15:31:00 GMT; path=/","TS0119c1c9=01391bcd08951a25a3c8b4644539e04d649709c7bfce101fa18668e2a1208a0d9152b73d34; Path=/","TS0129ed64=01391bcd08913ca3cf9ee5870f10def50c242a9aece42c5459879aab6c6e847052fca81038bad25ee789ca15fb3a5f40d211edaa65c0e6112522611626c251febae62af1b8684257a845cc275754df3bfad61d2a21cc187d86c0b8521dad16444af7234164; path=/; domain=.albertsons.mywebgrocer.com"],"x-aspnet-version":["4.0.30319"],"x-aspnetmvc-version":["3.0"]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.googletagmanager.com/gtm.js?id=GTM-9XZQ&l=mwgAnalyticsDataLayer","http://www.googletagmanager.com/gtm.js?id=GTM-9XZQ&l=mwgAnalyticsDataLayer",200,"GET","http://www.albertsons.com/",{"cache-control":["private, max-age=900"],"content-encoding":["gzip"],"content-length":["34297"],"content-type":["application/javascript; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"expires":["Tue, 30 Aug 2016 15:24:43 GMT"],"server":["Google Tag Manager (scaffolding)"],"vary":["Accept-Encoding"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/find-store-bg.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/find-store-bg.gif",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["520"],"content-length":["1496"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"3f2324-5d8-4d7e39ee1f880\""],"last-modified":["Thu, 14 Mar 2013 14:48:50 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["500382035 500368267"]},"image"]
  nightmare:log did-get-redirect-request +21ms [{},"http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",false,307,"GET","http://www.albertsons.com/",{"location":["https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/trans-bg.png","http://www.albertsons.com/wp-content/themes/albertsons/images/trans-bg.png",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["2773"],"content-length":["126"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"2923e6-7e-4d7478ed7cd80\""],"last-modified":["Wed, 06 Mar 2013 20:37:26 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686751 2300611098"]},"image"]
  nightmare:log did-frame-finish-load +20ms [{},false]
  nightmare:log did-get-redirect-request +69ms [{},"http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",false,307,"GET","http://www.albertsons.com/",{"location":["https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-get-redirect-request +25ms [{},"http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",false,307,"GET","http://www.albertsons.com/",{"location":["https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-get-redirect-request +13ms [{},"http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",false,307,"GET","http://www.albertsons.com/",{"location":["https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-get-redirect-request +55ms [{},"http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",false,307,"GET","http://www.albertsons.com/",{"location":["https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-get-response-details +7ms [{},false,"https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["text/html"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["rgjCRtfz71HIidgQDo3MWGebNfeUswJ14ocU6+HsryMErGsyjD9iu7N16PawEIVYKxwg3phPyqZ+BjJzDi4DVQ=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +24ms [{},false,"http://www.google-analytics.com/analytics.js","http://www.google-analytics.com/analytics.js",200,"GET","http://www.albertsons.com/",{"age":["2671"],"cache-control":["public, max-age=7200"],"content-encoding":["gzip"],"content-length":["11590"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 14:40:12 GMT"],"expires":["Tue, 30 Aug 2016 16:40:12 GMT"],"last-modified":["Mon, 15 Aug 2016 04:25:11 GMT"],"server":["Golfe2"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"]},"script"]
  nightmare:log did-frame-finish-load +3ms [{},false]
  nightmare:log did-get-response-details +4ms [{},false,"https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["text/html"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["pLVj7qzM3JhiZVK+YLOZ+gWDz0/fxcTXHDSHvb9/xLxB/PRSBdJMp4MbQAKvOwnksGSHRyaZI7Af0V0LCUWeTg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +15ms [{},false,"https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["text/html"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["bkfpkX77/kD9lzKPWgarbHR6ynm3tTIoEcXaRfi2CD3VVgBcarydCVRxsEF83ZIlI/yw6rPjn30chbokg0n4MQ=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-frame-finish-load +0ms [{},false]
  nightmare:log did-frame-finish-load +0ms [{},false]
  nightmare:log did-get-response-details +4ms [{},false,"http://tags.crwdcntrl.net/c/3841/cc_af.js","http://tags.crwdcntrl.net/c/3841/cc_af.js",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=86400"],"content-encoding":["gzip"],"content-length":["40892"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"57aa047b-ce95e+gzip\""],"expires":["Wed, 31 Aug 2016 15:24:43 GMT"],"last-modified":["Tue, 09 Aug 2016 16:27:39 GMT"],"server":["ECS (dfw/5673)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://connect.facebook.net/en_US/fbds.js","http://connect.facebook.net/en_US/fbds.js",200,"GET","http://www.albertsons.com/",{"access-control-expose-headers":["X-FB-Content-MD5"],"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["1579"],"content-md5":["3Fp6Go4++/pr5LA6U5SBFg=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"f3733f99183d792d5c6b8241e6da9cfb\""],"expires":["Tue, 30 Aug 2016 15:35:45 GMT"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-content-md5":["52acefb4e69b65cf797da76f7eb9d34a"],"x-fb-debug":["0tjnWKETmDPEnDXJ9V3MbCrQuTmDZzPIdUU4PqdM2NyLgffcO2oFlInVLI3k+vIw5pIAtrr3Guzu/kr+F33rxg=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"script"]
  nightmare:log did-get-response-details +15ms [{},false,"https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["text/html"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["LBdQeEFyosu99kvousR1YKWlteZG2gQTcLtiUXpLPcZv8wg1msytmVwgqrm1t9vh/r8OpL3ZpjY33qZo6ALqyg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +21ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/footer-wrapper-bg.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/footer-wrapper-bg.gif",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["1071"],"content-length":["171"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"3f2326-ab-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["500382043 500352704"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/fm-wrapper-bg.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/fm-wrapper-bg.gif",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["847"],"content-length":["418"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"2923be-1a2-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686758 2300665089"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/credits-seps.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/credits-seps.gif",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["746"],"content-length":["44"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"2923b7-2c-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686760 2300667829"]},"image"]
  nightmare:log did-get-response-details +42ms [{},false,"https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&","http://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["text/html"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["BXRl5A7EDI35Z9/WpmuJcJCV9XBua+VLQ7FuUs53/fH5NfUAuNbtjEF8HzQ3pOMRTRqE5Ix4OUMzxRJtwPZUOg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +9ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/m-bg-new-2.png","http://www.albertsons.com/wp-content/themes/albertsons/images/m-bg-new-2.png",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["3156"],"content-length":["3263"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"3f233a-cbf-4e08ce15f3900\""],"last-modified":["Tue, 02 Jul 2013 20:06:28 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["500382046 500289323"]},"image"]
  nightmare:log did-get-response-details +9ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/shadow.png","http://www.albertsons.com/wp-content/themes/albertsons/images/shadow.png",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["1798"],"content-length":["1698"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"45a34d-6a2-4d7478ed7cd80\""],"last-modified":["Wed, 06 Mar 2013 20:37:26 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["509332819 509285070"]},"image"]
  nightmare:log did-get-redirect-request +3ms [{},"http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469?","http://ad.doubleclick.net/activity;dc_pre=CIz429e66c4CFUoHgQodvggJrQ;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["http://ad.doubleclick.net/activity;dc_pre=CIz429e66c4CFUoHgQodvggJrQ;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-redirect-request +1ms [{},"http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833?","http://ad.doubleclick.net/activity;dc_pre=CN_629e66c4CFQIYgQod8D0PVQ;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["http://ad.doubleclick.net/activity;dc_pre=CN_629e66c4CFQIYgQod8D0PVQ;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +16ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/slide-nav-bg.png","http://www.albertsons.com/wp-content/themes/albertsons/images/slide-nav-bg.png",200,"GET","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",{"accept-ranges":["bytes"],"age":["2762"],"content-length":["522"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"2923e2-20a-4d7478ed7cd80\""],"last-modified":["Wed, 06 Mar 2013 20:37:26 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300686762 2300611470"]},"image"]
  nightmare:log did-get-redirect-request +2ms [{},"http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mwg_a0;cat=mwg_a0;u3=Page_WWW;u2=www.albertsons.com;ord=3572725699117;~oref=http%3A%2F%2Fwww.albertsons.com%2F?","http://3412342.fls.doubleclick.net/activityi;dc_pre=CNz33Ne66c4CFem5swod2UoJHg;src=3412342;type=mwg_a0;cat=mwg_a0;u3=Page_WWW;u2=www.albertsons.com;ord=3572725699117;~oref=http%3A%2F%2Fwww.albertsons.com%2F",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["http://3412342.fls.doubleclick.net/activityi;dc_pre=CNz33Ne66c4CFem5swod2UoJHg;src=3412342;type=mwg_a0;cat=mwg_a0;u3=Page_WWW;u2=www.albertsons.com;ord=3572725699117;~oref=http%3A%2F%2Fwww.albertsons.com%2F"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-redirect-request +5ms [{},"http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mwg_a0;cat=mwg_a00;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=2864684660702;~oref=http%3A%2F%2Fwww.albertsons.com%2F?","http://3412342.fls.doubleclick.net/activityi;dc_pre=CK-d3de66c4CFUO1swodB-UGQw;src=3412342;type=mwg_a0;cat=mwg_a00;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=2864684660702;~oref=http%3A%2F%2Fwww.albertsons.com%2F",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["http://3412342.fls.doubleclick.net/activityi;dc_pre=CK-d3de66c4CFUO1swodB-UGQw;src=3412342;type=mwg_a0;cat=mwg_a00;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=2864684660702;~oref=http%3A%2F%2Fwww.albertsons.com%2F"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +10ms [{},false,"http://www.googletagservices.com/tag/js/gpt.js","http://www.googletagservices.com/tag/js/gpt.js",200,"GET","http://www.albertsons.com/",{"age":["339"],"cache-control":["private, max-age=900, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["1599"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:25:21 GMT"],"expires":["Tue, 30 Aug 2016 15:25:21 GMT"],"last-modified":["Mon, 29 Aug 2016 23:13:20 GMT"],"server":["sffe"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +8ms [{},false,"http://cdn.printfriendly.com/printfriendly.js","http://cdn.printfriendly.com/printfriendly.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"cache-control":["public, max-age=300"],"content-encoding":["gzip"],"content-length":["5504"],"content-type":["text/javascript; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"etag":["\"4994c1efafef81b2402570879f392853\""],"expires":["Tue, 30 Aug 2016 15:36:00 GMT"],"last-modified":["Mon, 15 Aug 2016 13:28:04 GMT"],"server":["ECS (dfw/2792)"],"vary":["Accept-Encoding"],"x-cache":["HIT"],"x-goog-generation":["1471267684739000"],"x-goog-hash":["crc32c=msarrA==","md5=SZTB76/vgbJAJXCHnzkoUw=="],"x-goog-metageneration":["1"],"x-goog-storage-class":["STANDARD"],"x-goog-stored-content-encoding":["gzip"],"x-goog-stored-content-length":["5504"],"x-guploader-uploadid":["AEnB2UoJvJht1rmJ020Eptb0Oce8V5h6cvNVCT27UAL3y9xKxGrR8SvMcV_0dMMiVUzgEo57c0J_TYMaOQJKetqJWVl4SjMLyw"]},"script"]
  nightmare:log did-get-response-details +24ms [{},false,"http://s7.addthis.com/static/menu.fddd14fceaee9d2e53bf.js","http://s7.addthis.com/static/menu.fddd14fceaee9d2e53bf.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"cache-control":["public, no-check, max-age=86313600"],"cf-cache-status":["HIT"],"cf-ray":["2da940545f462006-DFW"],"content-encoding":["gzip"],"content-length":["14019"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"last-modified":["Mon, 29 Aug 2016 15:31:10 GMT"],"server":["cloudflare-nginx"],"surrogate-key":["client_dist"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-host":["s7.addthis.com"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://platform.twitter.com/widgets.js","http://platform.twitter.com/widgets.js",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=1800"],"content-encoding":["gzip"],"content-length":["32660"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"etag":["\"e8aa035a6c270053d1775e4d45a6eb60+gzip\""],"last-modified":["Fri, 26 Aug 2016 17:43:48 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4AA)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"script"]
  nightmare:log dom-ready +12ms [{}]
  nightmare:log did-get-response-details +12ms [{},false,"http://www.google-analytics.com/plugins/ua/linkid.js","http://www.google-analytics.com/plugins/ua/linkid.js",200,"GET","http://www.albertsons.com/",{"age":["496"],"cache-control":["public, max-age=3600"],"content-encoding":["gzip"],"content-length":["856"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:16:27 GMT"],"expires":["Tue, 30 Aug 2016 16:16:27 GMT"],"last-modified":["Thu, 21 Apr 2016 03:17:22 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.google-analytics.com/plugins/ua/ec.js","http://www.google-analytics.com/plugins/ua/ec.js",200,"GET","http://www.albertsons.com/",{"age":["300"],"cache-control":["public, max-age=3600"],"content-encoding":["gzip"],"content-length":["1296"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:19:43 GMT"],"expires":["Tue, 30 Aug 2016 16:19:43 GMT"],"last-modified":["Thu, 21 Apr 2016 03:17:22 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +17ms [{},false,"https://www.facebook.com/rsrc.php/v3/yD/r/FEppCFCt76d.png","https://www.facebook.com/rsrc.php/v3/yD/r/FEppCFCt76d.png",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-length":["299"],"content-md5":["OIlAxCmR79nrM/Ez4ygGlg=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 00:50:06 GMT"],"expires":["Wed, 30 Aug 2017 00:50:06 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-fb-debug":["Umj1TAKiWbe8G4tpwVqq/tB0VHIHRQE3fe24wbpsrz1WY6fHQMxBZl+zKvWJrtuYkAfwPDUC2LQLhnmGFVf64w=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"xhr"]
  nightmare:log did-get-response-details +14ms [{},false,"http://s7.addthis.com/static/sh.93028dbeac9022361fb0b926.html#rand=0.2502804668449501&iit=1472571060502&tmr=load%3D1472571060140%26core%3D1472571060316%26main%3D1472571060497%26ifr%3D1472571060509&cb=0&cdn=0&md=0&kw=&ab=-&dh=www.albertsons.com&dr=&du=http%3A%2F%2Fwww.albertsons.com%2F&href=http%3A%2F%2Fwww.albertsons.com%2F&dt=Front%20Page&dbg=0&cap=tc%3D0%26ab%3D0&inst=5&jsl=129&prod=undefined&lng=en&ogt=url%2Ctitle%2Cimage%2Ctype%3Dwebsite%2Csite_name&pc=men&pub=xa-4fc14192152e30a5&ssl=0&sid=57c5a6b4bb1892a3&srpl=1&srf=0.01&srx=1&ver=300&xck=0&xtr=0&og=site_name%3DAlbertsons%26type%3Dwebsite%26image%3D%26title%3DFront%2520Page%26url%3Dhttp%253A%252F%252Fwww.albertsons.com%252F&csi=undefined&rev=v7.5.0-wp&ct=1&xld=1&xd=1","http://s7.addthis.com/static/sh.93028dbeac9022361fb0b926.html#rand=0.2502804668449501&iit=1472571060502&tmr=load%3D1472571060140%26core%3D1472571060316%26main%3D1472571060497%26ifr%3D1472571060509&cb=0&cdn=0&md=0&kw=&ab=-&dh=www.albertsons.com&dr=&du=http%3A%2F%2Fwww.albertsons.com%2F&href=http%3A%2F%2Fwww.albertsons.com%2F&dt=Front%20Page&dbg=0&cap=tc%3D0%26ab%3D0&inst=5&jsl=129&prod=undefined&lng=en&ogt=url%2Ctitle%2Cimage%2Ctype%3Dwebsite%2Csite_name&pc=men&pub=xa-4fc14192152e30a5&ssl=0&sid=57c5a6b4bb1892a3&srpl=1&srf=0.01&srx=1&ver=300&xck=0&xtr=0&og=site_name%3DAlbertsons%26type%3Dwebsite%26image%3D%26title%3DFront%2520Page%26url%3Dhttp%253A%252F%252Fwww.albertsons.com%252F&csi=undefined&rev=v7.5.0-wp&ct=1&xld=1&xd=1",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"cache-control":["public, no-check, max-age=86313600"],"cf-cache-status":["HIT"],"cf-ray":["2da940549f532006-DFW"],"content-encoding":["gzip"],"content-length":["26534"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:24:43 GMT"],"last-modified":["Mon, 29 Aug 2016 15:27:35 GMT"],"p3p":["CP=\"NON ADM OUR DEV IND COM STA\""],"server":["cloudflare-nginx"],"surrogate-key":["client_dist"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-host":["s7.addthis.com"]},"subFrame"]
  nightmare:log did-get-response-details +15ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/earn-gas-rewards-its-as-easy-as-shop-earn-redeem/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"http://partner.googleadservices.com/gpt/pubads_impl_94.js","http://partner.googleadservices.com/gpt/pubads_impl_94.js",200,"GET","http://www.albertsons.com/",{"age":["485075"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["53559"],"content-type":["text/javascript"],"date":["Thu, 25 Aug 2016 00:40:08 GMT"],"expires":["Fri, 25 Aug 2017 00:40:08 GMT"],"last-modified":["Tue, 16 Aug 2016 20:11:45 GMT"],"server":["sffe"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/let-us-be-your-pharmacy/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"xhr"]
  nightmare:log did-frame-finish-load +3ms [{},false]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/tr/?id=811207002269085&ev=PixelInitialized&dl=http%3A%2F%2Fwww.albertsons.com%2F%231&rl=&if=false&ts=1472571060568","https://www.facebook.com/tr/?id=811207002269085&ev=PixelInitialized&dl=http%3A%2F%2Fwww.albertsons.com%2F%231&rl=&if=false&ts=1472571060568",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate, max-age=0"],"content-length":["44"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Tue, 30 Aug 2016 15:31:00 GMT"],"last-modified":["Fri, 21 Dec 2012 00:00:01 GMT"],"server":["proxygen"],"set-cookie":[""],"status":["200"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/great-recipes/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"xhr"]
  nightmare:log did-get-response-details +6ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/get-immunized/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"script"]
  nightmare:log did-get-response-details +12ms [{},false,"http://m.addthisedge.com/live/boost?pub=xa-4fc14192152e30a5&callback=_ate.track.config_resp","http://m.addthisedge.com/live/boost?pub=xa-4fc14192152e30a5&callback=_ate.track.config_resp",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=60, s-maxage=86400"],"cf-cache-status":["HIT"],"cf-ray":["2da94988cdc20956-DFW"],"connection":["keep-alive"],"content-disposition":["attachment; filename=1.txt"],"content-encoding":["gzip"],"content-length":["47"],"content-type":["application/javascript;charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"server":["cloudflare-nginx"],"surrogate-key":["xa-4fc14192152e30a5"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://ad.doubleclick.net/activity;dc_pre=CN_629e66c4CFQIYgQod8D0PVQ;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833","http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a002;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=6974366779833?",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +27ms [{},false,"http://ad.doubleclick.net/activity;dc_pre=CIz429e66c4CFUoHgQodvggJrQ;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469","http://ad.doubleclick.net/activity;src=3412342;type=mwg_a0;cat=mwg_a001;u3=Page_WWW;u2=www.albertsons.com;ord=4373203833469?",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://3412342.fls.doubleclick.net/activityi;dc_pre=CNz33Ne66c4CFem5swod2UoJHg;src=3412342;type=mwg_a0;cat=mwg_a0;u3=Page_WWW;u2=www.albertsons.com;ord=3572725699117;~oref=http%3A%2F%2Fwww.albertsons.com%2F","http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mwg_a0;cat=mwg_a0;u3=Page_WWW;u2=www.albertsons.com;ord=3572725699117;~oref=http%3A%2F%2Fwww.albertsons.com%2F?",200,"GET","http://www.albertsons.com/",{"cache-control":["private, max-age=0"],"content-encoding":["gzip"],"content-length":["177"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Tue, 30 Aug 2016 15:31:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"subFrame"]
  nightmare:log did-get-response-details +11ms [{},false,"http://3412342.fls.doubleclick.net/activityi;dc_pre=CK-d3de66c4CFUO1swodB-UGQw;src=3412342;type=mwg_a0;cat=mwg_a00;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=2864684660702;~oref=http%3A%2F%2Fwww.albertsons.com%2F","http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mwg_a0;cat=mwg_a00;u3=Page_WWW;u2=www.albertsons.com;ord=1;num=2864684660702;~oref=http%3A%2F%2Fwww.albertsons.com%2F?",200,"GET","http://www.albertsons.com/",{"cache-control":["private, max-age=0"],"content-encoding":["gzip"],"content-length":["177"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Tue, 30 Aug 2016 15:31:00 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"subFrame"]
  nightmare:log did-get-response-details +6ms [{},false,"https://platform.twitter.com/js/button.369579b2450be1b134e6754cd8501155.js","https://platform.twitter.com/js/button.369579b2450be1b134e6754cd8501155.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"cache-control":["public, max-age=315569260"],"content-length":["4328"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"2c66f851fa16acba712f8a6df8132ef5\""],"last-modified":["Thu, 25 Aug 2016 22:04:55 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/5672)"],"x-cache":["HIT"]},"script"]
  nightmare:log did-get-redirect-request +1ms [{},"https://bcp.crwdcntrl.net/5/c=3841/?https://dmsapi.mywebgrocer.com/lopex/1.0.0/${profile_id}/lotame.js","https://dmsapi.mywebgrocer.com/lopex/1.0.0/3a7a217ffa41309ae754bd3bc2ac64f9/lotame.js",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://dmsapi.mywebgrocer.com/lopex/1.0.0/3a7a217ffa41309ae754bd3bc2ac64f9/lotame.js"],"p3p":["CP=NOI DSP COR NID PSAa PSDa OUR UNI COM NAV"],"pragma":["no-cache"],"set-cookie":["_cc_aud=\"ABR4nC2We1CWVRCH3%2FMikDrcZcSUS4CgKDexyTEDLajBxhJQgcrAQbPRbMYpMrKkLJsSiwGjm1CIRngrJUQQLEjBksbyIy5FZCSGyXSBKMrsMvwe%2BeN72HN29z27Z8%2BeY1mWld5SWWNd%2BzM1lj0hUP%2F6LxFi4sFPwvzPhaQbhIwrsnngR0kjh4WChrFfO%2BJ95r7XYNUnQn%2B6kPKk0LtU%2BHmXUNyAl93CyYPgANgvZ1OLhK%2FGC74LhEXrhRVPCUuihJWH0TTChjAM4sAc%2BWwnopFqIeiM5sp6WHWzcLs%2FmhclVRkkImrvY9WlSOdxHYz0jVJw%2Fd1k4rKw2Fsq3f1SqcBgRQZSD%2Fhag9P3SFo4LLvSDjRTUOkA7RqsU0R290vC5n%2FQXIxdmfBn4xicXDyFyfPQ%2FF1e%2Bl9D%2Bk3SB764%2FhgoBfaJWKSP%2BB6lUdGINI3l3irN3jYG%2FfB5Ac2jqLBVdZOQ5mtu0SrsyPW4lzU46kQG39Cg8zIWITsrRjttBX2qUAKG0HyRZFFu4x6T5PmmpKQ6SSnt2Nl4SeXrDwuxQfrCoUS8vI3PR4XiaHmZdJRBDIKoZI%2B3cJagtbhvluYxNidmAbhZ8HLFPJNB1acVyIYHsuGXKPYLJZLWEkNsM9B2mO47tc71Srm1kS2e8ixryeYLERosdZa08yZ8Pi4UqVrtxgpJFTEgGp8TwHgGZ5FIT6QZIBxn6zQXuo%2BgQyU5E0rNSiG1iDnWuXA20Mqs6C6ypEQaX4po%2BTZ9PWIQaauw5gsGf8F8inwGpGJ%2Br5AUwpwXCdHZtB86SJjppJUUeBCYB3lJGEWiGDw40%2B7%2FEcpySY7TDF4Bf2E3iIS5Q7tir1MmrOwXZJ47gMqvRFsIdjB3Hi8kq1qrNukNRESbSVD12H7%2F4qWXQRquO4VyerWkovsk%2BeiMmVe1K9beZ9CUgemiY3ZVYZAm1wUc32wymKvTYcIUn52MXeVeoZ4bwaECc3LbrsFQMujgIDjouwNtSA8SLTXvYJ2ObLm%2BbhWuVYomhE0d5u7oWssg278mEjuOqIP7oWiivDzxvFQSFaZZdlZwmgvUB62AU%2BAkKjSyAO6j7SfQDAFcYMEKzL7K3u6eSyLZ4iMcriNbAdlNSEbKB1twrSSbkgEWqEZtz6jHZ5AGc%2Bm7nWq4ppVWWZuHeQl4RYP7LiIVgyJQyDppCVE0%2F8Q5gAM7%2Bo6w%2BgzZpfiGaarloyRkIzG4Cee%2B06DtYLlEm0D7Lb%2BkQd8Nkpq38FmupXOfaW7%2FHzLv7AYcbZuSso%2BBWsGbgo7SkkxcGSgFuwD9Ok5d33ruSyFrE6AdZuXyoePCAE%2BAARdAYcblAIov%2FhS5vof00DFnf8icFmj3HAI6K1ZfF3MHGKRV9ulY2Jm6G21XZcIMvsucLiI7D4M8vLjtIfYsvHA7NU%2BWdJyHRCcRkQl74lRhXgYq34JeNDlqte6E4ofkDbiut0WT3Zksgm56lSOT9zSgWsv1HDHBnYI3Gx5%2FLVnq3iaNQ5LGvVnOrV1fTSjJ4A4NXqalt%2B6UlKnsmhxaZevrSFRdDoVieyCNSKWpVRiqI60ENqR6sRK5Pjt5%2FoRTRK40zvgb0XxPg4YO7V8gqYUNb%2BHCbGnS3F2PyIsL3eY27qNIKvl%2BHicdzOXwxDFUchtn2rD94STShUVE8ii95W8kWqw%2FPcufnhVZDngl%2BFTijAdy4SYkFZ%2F5gdiDsfNR1zBLy%2FjCWXzOAjMBV3IT70H%2FMDB97NdpGrdavgvgWOSPAxztfKkYr7EL5X9Bnqcy\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:00 GMT;Max-Age=23328000","_cc_cc=\"ACZ4nJXU204TQRjA8S4RSUtD38CQeGdClIMSHsBn8LqgPIcgAqVRAQ0GlBBAMEa58JAopQd6Qgq0VOiBUhYoQpFDOUkFEaiVtM3O%2F8692Mxvv5nZ%2Bb7ZHVVxub5SX1ZaWVurrygtv1Glv1d5s6L6bnl1TZm%2B5lZFbZUqfd1xD35yOsZSOlX2%2BmKyl%2BR7JcvTVEqXkqQnt89Ozy9a5mvZVt0VVfq%2Bl5ftoxr%2B%2FyH%2BJkdB5qkqHprVSRPF8nEmloCNMZ9Gsuf1Zv16wit4Nb6nlT5ef3OU8Xc4atosUrrD0qNRuqGrSegfw%2Fid4K5a%2BlDy%2FlfG2yHRIdgFu2EbPAD3wt1wB2yEDXADfIx8knACjsNr8Aq8DC%2FCMhyBQ3AQnoF98CTsgcfhr7AbdsEO2A7b4IO2gEbpdXgNXoFj8BI8D8%2FBITgIz8BTsAu2vjDrhHrCTtgB2%2BFR2AZb4Nhbt7CeZXgJXoRleAGOwvNwBLa3hgrTZ1kymXGg%2B7FW6WDrxVmXcwe83e8U3GkU48n9LrXSc4kWYf6hHlkrrV8dztoIP4KdfaIH5fZ8KVpgSWR8aB7WSofqnA%2FgfXgX3oET8Da8BW%2FAa%2FAqPLDV%2BK8eOccRPwq3CflZka%2B7%2BeSysv9e%2FYgw3ybmG%2FMZipT2wJPwT4z3Iz4Lm1dbhfePNIrrG7KFC5VuglsshgJlfg%2FhOvg%2BnDKLPodP4T%2Fwb7jf1KmRXl7KeX1BrP8ZnIKXUZ9FWIYX4Cg8D0fgOTgMB%2BEA%2FA2ehn2wF56Cx2E37IKdsAO2w6OwFR6B%2Fa%2Bea5T7Mw1HPov7HYaD8ATsgcdgK%2FwO7sP%2F3Q13ws%2FgdrgZfgDXw%2Bf4fk%2FhE3gD%2FgHHYRkOw38B4pDgjw%3D%3D\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:00 GMT;Max-Age=23328000","_cc_id=3a7a217ffa41309ae754bd3bc2ac64f9;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:00 GMT"],"x-server":["172.20.10.51"]}]
  nightmare:log did-get-response-details +19ms [{},false,"http://m.addthis.com/live/red_lojson/300lo.json?si=57c5a6b4bb1892a3&bl=1&pdt=991&sid=57c5a6b4bb1892a3&pub=xa-4fc14192152e30a5&rev=v7.5.0-wp&ln=en&pc=men&cb=0&ab=-&dp=www.albertsons.com&fp=&fr=&of=0&pd=0&irt=1&vcl=1&md=0&ct=1&tct=0&abt=0&cdn=0&pi=5&rb=0&gen=100&chr=UTF-8&colc=1472571060515&jsl=129&uvs=57c5a53bd0b76a35008&skipb=1&callback=addthis.cbs.oln9_251096376520669960","http://m.addthis.com/live/red_lojson/300lo.json?si=57c5a6b4bb1892a3&bl=1&pdt=991&sid=57c5a6b4bb1892a3&pub=xa-4fc14192152e30a5&rev=v7.5.0-wp&ln=en&pc=men&cb=0&ab=-&dp=www.albertsons.com&fp=&fr=&of=0&pd=0&irt=1&vcl=1&md=0&ct=1&tct=0&abt=0&cdn=0&pi=5&rb=0&gen=100&chr=UTF-8&colc=1472571060515&jsl=129&uvs=57c5a53bd0b76a35008&skipb=1&callback=addthis.cbs.oln9_251096376520669960",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=0, no-cache, no-store, no-transform"],"cf-ray":["2da94988ddc30956-DFW"],"connection":["keep-alive"],"content-disposition":["attachment; filename=1.txt"],"content-encoding":["gzip"],"content-length":["116"],"content-type":["application/javascript;charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"NON ADM OUR DEV IND COM STA\""],"pragma":["no-cache"],"server":["cloudflare-nginx"],"set-cookie":["bt2=57c5a6b4001Ns00090083s000X0024s000W001rs000_001ss00f7;Path=/;Domain=.addthis.com;Expires=Sat, 13-May-2017 15:31:00 GMT","uid=57ab98a3a7981bc0;Path=/;Domain=.addthis.com;Expires=Thu, 30-Aug-2018 15:31:00 GMT","vc=524;Path=/;Domain=.addthis.com;Expires=Thu, 30-Aug-2018 15:31:00 GMT"]},"script"]
  nightmare:log did-frame-finish-load +27ms [{},false]
  nightmare:log did-frame-finish-load +3ms [{},false]
  nightmare:log did-frame-finish-load +2ms [{},false]
  nightmare:log did-get-response-details +4ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"xhr"]
  nightmare:log did-frame-finish-load +29ms [{},false]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js","https://www.facebook.com/rsrc.php/v3iSgH4/yC/l/en_US/ea7EtetQT7H.js",200,"GET","https://www.facebook.com/plugins/like.php?href=http://www.albertsons.com/home_slideshow/online-weekly-ad/&send=false&width=200&show_faces=false&font&colorscheme=light&action=like&",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["97236"],"content-md5":["8d6Uzd7mIOamoO0CU7C0dA=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 01:35:46 GMT"],"expires":["Wed, 30 Aug 2017 01:35:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["l6in9EhxK9Q2wnw2uHLD3IFXhb++yYZOT2a9ej9y0yt79mVOS+aB1L469AZ9sdZFy09NPVzgFDRtJNr6ODpVyA=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"script"]
  nightmare:log did-get-response-details +18ms [{},false,"http://assets.pinterest.com/js/pinit_main.js?0.38259125121950777","http://assets.pinterest.com/js/pinit_main.js?0.38259125121950777",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=1209600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["23211"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"last-modified":["Mon, 22 Aug 2016 18:54:36 GMT"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +8ms [{},false,"http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAgEAr~&jid=&cid=1547714710.1471873082&tid=UA-3893611-1&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=304301832","http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAgEAr~&jid=&cid=1547714710.1471873082&tid=UA-3893611-1&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=304301832",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["532307"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Wed, 24 Aug 2016 11:39:13 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-62530145-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=1543945797","http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-62530145-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=1543945797",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["534019"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Wed, 24 Aug 2016 11:10:41 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-get-response-details +14ms [{},false,"http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-56824083-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=2142935458","http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-56824083-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=2142935458",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["534019"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Wed, 24 Aug 2016 11:10:41 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-31541120-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=1771720338","http://www.google-analytics.com/collect?v=1&_v=j46&a=52999382&t=pageview&_s=1&dl=http%3A%2F%2Fwww.albertsons.com%2F&ul=en-us&de=UTF-8&dt=Albertsons&sd=24-bit&sr=1440x900&vp=800x578&je=0&_u=SCCAiEArB~&jid=&cid=1547714710.1471873082&tid=UA-31541120-2&gtm=GTM-9XZQ&cd9=no&cd10=undefined&cd11=false&z=1771720338",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["532334"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Wed, 24 Aug 2016 11:38:46 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-frame-finish-load +110ms [{},false]
  nightmare:log did-get-redirect-request +11ms [{},"http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mono;cat=alb_m615;ord=9178421215068;~oref=http%3A%2F%2Fwww.albertsons.com%2F?","http://3412342.fls.doubleclick.net/activityi;dc_pre=CPL73Ne66c4CFea7swoduFEEag;src=3412342;type=mono;cat=alb_m615;ord=9178421215068;~oref=http%3A%2F%2Fwww.albertsons.com%2F",false,302,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:00 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["http://3412342.fls.doubleclick.net/activityi;dc_pre=CPL73Ne66c4CFea7swoduFEEag;src=3412342;type=mono;cat=alb_m615;ord=9178421215068;~oref=http%3A%2F%2Fwww.albertsons.com%2F"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-frame-finish-load +21ms [{},false]
  nightmare:log did-frame-finish-load +33ms [{},false]
  nightmare:log did-frame-finish-load +7ms [{},false]
  nightmare:log did-get-response-details +1ms [{},false,"http://tpc.googlesyndication.com/safeframe/1-0-4/html/container.html","http://tpc.googlesyndication.com/safeframe/1-0-4/html/container.html",200,"GET","http://www.albertsons.com/",{"age":["485068"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["1736"],"content-type":["text/html"],"date":["Thu, 25 Aug 2016 00:40:16 GMT"],"expires":["Fri, 25 Aug 2017 00:40:16 GMT"],"last-modified":["Tue, 31 May 2016 23:11:56 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"other"]
  nightmare:log did-frame-finish-load +0ms [{},false]
  nightmare:log did-frame-finish-load +5ms [{},false]
  nightmare:log did-frame-finish-load +6ms [{},false]
  nightmare:log did-frame-finish-load +5ms [{},false]
  nightmare:log did-frame-finish-load +4ms [{},false]
  nightmare:log did-frame-finish-load +5ms [{},false]
  nightmare:log did-get-response-details +38ms [{},false,"http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-0&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Be%20a%20Hero%20Get%20Vaccinated!&time=1472571060989&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%231","http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-0&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Be%20a%20Hero%20Get%20Vaccinated!&time=1472571060989&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%231",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["11717"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"a9930de9204810eaeed538247bdb97fe+gzip\""],"last-modified":["Thu, 25 Aug 2016 22:06:26 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4A8)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-get-response-details +1ms [{},false,"http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-1&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Albertsons%20is%20now%20offering%20Gas%20Rewards&time=1472571060996&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%232","http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-1&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Albertsons%20is%20now%20offering%20Gas%20Rewards&time=1472571060996&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%232",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["11717"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"a9930de9204810eaeed538247bdb97fe+gzip\""],"last-modified":["Thu, 25 Aug 2016 22:06:26 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4A8)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-get-response-details +1ms [{},false,"http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-2&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Let%20Us%20be%20Your%20Pharmacy&time=1472571061000&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%233","http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-2&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Let%20Us%20be%20Your%20Pharmacy&time=1472571061000&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%233",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["11717"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"a9930de9204810eaeed538247bdb97fe+gzip\""],"last-modified":["Thu, 25 Aug 2016 22:06:26 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4A8)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-get-response-details +1ms [{},false,"http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-3&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Great%20deals%20start%20with%20Great%20Recipes&time=1472571061004&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%234","http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-3&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Great%20deals%20start%20with%20Great%20Recipes&time=1472571061004&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%234",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["11717"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"a9930de9204810eaeed538247bdb97fe+gzip\""],"last-modified":["Thu, 25 Aug 2016 22:06:26 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4A8)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-get-response-details +1ms [{},false,"http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-4&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Get%20Your%20Weekly%20Ad%20Online!&time=1472571061009&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%235","http://platform.twitter.com/widgets/tweet_button.a9a07b811338df26287681bd6727fd0a.en.html#dnt=false&id=twitter-widget-4&lang=en&original_referer=http%3A%2F%2Fwww.albertsons.com%2F%231&size=m&text=Get%20Your%20Weekly%20Ad%20Online!&time=1472571061009&type=share&url=http%3A%2F%2Fwww.albertsons.com%2F%235",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["11717"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:24:44 GMT"],"etag":["\"a9930de9204810eaeed538247bdb97fe+gzip\""],"last-modified":["Thu, 25 Aug 2016 22:06:26 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/F4A8)"],"vary":["Accept-Encoding"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-get-response-details +29ms [{},false,"https://dmsapi.mywebgrocer.com/lopex/1.0.0/3a7a217ffa41309ae754bd3bc2ac64f9/lotame.js","https://bcp.crwdcntrl.net/5/c=3841/?https://dmsapi.mywebgrocer.com/lopex/1.0.0/${profile_id}/lotame.js",200,"GET","http://www.albertsons.com/",{"cache-control":["private"],"content-encoding":["gzip"],"content-length":["224"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:30:59 GMT"],"strict-transport-security":["max-age=16000000; includeSubDomains; preload;"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"]},"script"]
  nightmare:log did-frame-finish-load +19ms [{},false]
  nightmare:log did-frame-finish-load +4ms [{},false]
  nightmare:log did-frame-finish-load +6ms [{},false]
  nightmare:log did-get-response-details +1ms [{},false,"http://3412342.fls.doubleclick.net/activityi;dc_pre=CPL73Ne66c4CFea7swoduFEEag;src=3412342;type=mono;cat=alb_m615;ord=9178421215068;~oref=http%3A%2F%2Fwww.albertsons.com%2F","http://3412342.fls.doubleclick.net/activityi;src=3412342;type=mono;cat=alb_m615;ord=9178421215068;~oref=http%3A%2F%2Fwww.albertsons.com%2F?",200,"GET","http://www.albertsons.com/",{"cache-control":["private, max-age=0"],"content-encoding":["gzip"],"content-length":["177"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:31:01 GMT"],"p3p":["policyref=\"http://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"server":["cafe"],"strict-transport-security":["max-age=21600"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"subFrame"]
  nightmare:log did-frame-finish-load +5ms [{},false]
  nightmare:log did-frame-finish-load +4ms [{},false]
  nightmare:log did-frame-finish-load +17ms [{},false]
  nightmare:log did-get-response-details +19ms [{},false,"https://securepubads.g.doubleclick.net/gampad/ads?gdfp_req=1&correlator=2850735292186708&output=json_html&callback=callbackProxy&impl=fif&eid=108809080%2C108809134&sc=0&sfv=1-0-4&iu=%2F4644%2Fmwl.albertsons.wp_home&sz=300x250&scp=page%3D17%26sdn%3Dalbertsons%26dn%3Dmywebgrocer.com%26pos%3D1%26tile%3D1%26plat%3Dp2g%26a%3Dv1.0.0%257C%257C22%257C&cookie=ID%3D0542f509840c8223%3AT%3D1471873082%3AS%3DALNI_MZCEMw5XpGg7quBL8P62opPPjm8ow&lmt=1472571060&dt=1472571060959&cc=99&frm=20&biw=800&bih=578&oid=3&adx=680&ady=839&adk=2630130257&gut=v2&ifi=1&u_tz=-240&u_his=1&u_h=900&u_w=1440&u_ah=877&u_aw=1436&u_cd=24&u_sd=2&flash=0&url=http%3A%2F%2Fwww.albertsons.com%2F%231&dssz=53&icsg=141012362854412&std=0&vrg=94&vrp=94&ga_vid=1547714710.1471873082&ga_sid=1472571061&ga_hid=52999382","https://securepubads.g.doubleclick.net/gampad/ads?gdfp_req=1&correlator=2850735292186708&output=json_html&callback=callbackProxy&impl=fif&eid=108809080%2C108809134&sc=0&sfv=1-0-4&iu=%2F4644%2Fmwl.albertsons.wp_home&sz=300x250&scp=page%3D17%26sdn%3Dalbertsons%26dn%3Dmywebgrocer.com%26pos%3D1%26tile%3D1%26plat%3Dp2g%26a%3Dv1.0.0%257C%257C22%257C&cookie=ID%3D0542f509840c8223%3AT%3D1471873082%3AS%3DALNI_MZCEMw5XpGg7quBL8P62opPPjm8ow&lmt=1472571060&dt=1472571060959&cc=99&frm=20&biw=800&bih=578&oid=3&adx=680&ady=839&adk=2630130257&gut=v2&ifi=1&u_tz=-240&u_his=1&u_h=900&u_w=1440&u_ah=877&u_aw=1436&u_cd=24&u_sd=2&flash=0&url=http%3A%2F%2Fwww.albertsons.com%2F%231&dssz=53&icsg=141012362854412&std=0&vrg=94&vrp=94&ga_vid=1547714710.1471873082&ga_sid=1472571061&ga_hid=52999382",200,"GET","http://www.albertsons.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34,33,32,31,30\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-disposition":["attachment; filename=\"f.txt\""],"content-encoding":["gzip"],"content-length":["10360"],"content-type":["text/javascript; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"google-creative-id":["70701603724"],"google-lineitem-id":["216501844"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +14ms [{},false,"https://tpc.googlesyndication.com/pagead/imgad?id=CICAgKCTke_G2wEQARgBMgg6nQEfBKD3Yw","https://tpc.googlesyndication.com/pagead/imgad?id=CICAgKCTke_G2wEQARgBMgg6nQEfBKD3Yw",200,"GET","http://www.albertsons.com/",{"age":["523099"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"35,34,33,32,31,30\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=604800"],"content-length":["48125"],"content-type":["image/jpeg"],"date":["Wed, 24 Aug 2016 14:08:32 GMT"],"expires":["Wed, 31 Aug 2016 14:08:32 GMT"],"p3p":["policyref=\"https://www.googleadservices.com/pagead/p3p.xml\", CP=\"NOI DEV PSA PSD IVA IVD OTP OUR OTR IND OTC\""],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://pagead2.googlesyndication.com/pagead/osd.js","http://pagead2.googlesyndication.com/pagead/osd.js",200,"GET","http://www.albertsons.com/",{"age":["22"],"cache-control":["public, max-age=3600"],"content-disposition":["attachment; filename=\"f.txt\""],"content-encoding":["gzip"],"content-length":["26517"],"content-type":["text/javascript; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:27:04 GMT"],"etag":["2135682555142291511"],"expires":["Tue, 30 Aug 2016 16:27:04 GMT"],"p3p":["policyref=\"http://www.googleadservices.com/pagead/p3p.xml\", CP=\"NOI DEV PSA PSD IVA IVD OTP OUR OTR IND OTC\""],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-frame-finish-load +64ms [{},false]
  nightmare:log did-frame-finish-load +9ms [{},false]
  nightmare:log did-get-response-details +194ms [{},false,"https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D4&callback=PIN_1472571061283.f.callback[3]","https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D4&callback=PIN_1472571061283.f.callback[3]",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["250"],"cache-control":["must-revalidate, max-age=887"],"connection":["keep-alive"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:41:51 GMT"],"transfer-encoding":["chunked"],"via":["1.1 varnish-v4","1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["1"],"x-content-type-options":["nosniff"],"x-pinterest-host":["widgets.pinterest.com"],"x-served-by":["cache-atl6225-ATL"],"x-timer":["S1472571061.426865,VS0,VE0"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D2&callback=PIN_1472571061283.f.callback[1]","https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D2&callback=PIN_1472571061283.f.callback[1]",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["250"],"cache-control":["must-revalidate, max-age=887"],"connection":["keep-alive"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:41:51 GMT"],"transfer-encoding":["chunked"],"via":["1.1 varnish-v4","1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["1"],"x-content-type-options":["nosniff"],"x-pinterest-host":["widgets.pinterest.com"],"x-served-by":["cache-atl6245-ATL"],"x-timer":["S1472571061.426568,VS0,VE0"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D3&callback=PIN_1472571061283.f.callback[2]","https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D3&callback=PIN_1472571061283.f.callback[2]",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["327"],"cache-control":["must-revalidate, max-age=887"],"connection":["keep-alive"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:40:34 GMT"],"transfer-encoding":["chunked"],"via":["1.1 varnish-v4","1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["1"],"x-content-type-options":["nosniff"],"x-pinterest-host":["widgets.pinterest.com"],"x-served-by":["cache-atl6228-ATL"],"x-timer":["S1472571061.426821,VS0,VE0"]},"script"]
  nightmare:log did-get-response-details +14ms [{},false,"https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D1&callback=PIN_1472571061283.f.callback[0]","https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D1&callback=PIN_1472571061283.f.callback[0]",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["250"],"cache-control":["must-revalidate, max-age=887"],"connection":["keep-alive"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:41:51 GMT"],"transfer-encoding":["chunked"],"via":["1.1 varnish-v4","1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["1"],"x-content-type-options":["nosniff"],"x-pinterest-host":["widgets.pinterest.com"],"x-served-by":["cache-atl6222-ATL"],"x-timer":["S1472571061.426517,VS0,VE15"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D5&callback=PIN_1472571061283.f.callback[4]","https://widgets.pinterest.com/v1/urls/count.json?url=http%3A%2F%2Fwww.albertsons.com%2F%3Fhomeslide%3D5&callback=PIN_1472571061283.f.callback[4]",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"age":["652"],"cache-control":["must-revalidate, max-age=887"],"connection":["keep-alive"],"content-type":["application/javascript"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:35:09 GMT"],"transfer-encoding":["chunked"],"via":["1.1 varnish-v4","1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["1"],"x-content-type-options":["nosniff"],"x-pinterest-host":["widgets.pinterest.com"],"x-served-by":["cache-atl6235-ATL"],"x-timer":["S1472571061.427014,VS0,VE16"]},"script"]
  nightmare:log did-get-redirect-request +30ms [{},"https://syndication.twitter.com/i/jot","https://platform.twitter.com/jot.html",false,302,"POST","",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-length":["0"],"content-type":["text/html;charset=utf-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 30 Aug 2016 15:31:01 GMT"],"location":["https://platform.twitter.com/jot.html"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["tsa_b"],"status":["302","302 Found"],"strict-transport-security":["max-age=631138519"],"x-connection-hash":["dce766e917ebc12edbf785f2729dd6e8"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["14"],"x-transaction":["009b613100991960"],"x-tsa-request-body-time":["0"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +179ms [{},false,"https://platform.twitter.com/jot.html","https://syndication.twitter.com/i/jot",200,"GET","",{"accept-ranges":["bytes"],"cache-control":["public, max-age=315569260"],"content-length":["80"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"etag":["\"d9592a6c704736fa4da218d4357976dd\""],"last-modified":["Fri, 26 Aug 2016 17:43:47 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["ECS (dfw/27E6)"],"x-cache":["HIT"]},"subFrame"]
  nightmare:log did-fail-load +5ms [{},-3,"","https://platform.twitter.com/jot.html",false]
  nightmare:log did-get-response-details +79ms [{},false,"https://www.facebook.com/tr/?id=811207002269085&ev=PixelInitialized&dl=http%3A%2F%2Fwww.albertsons.com%2F%231&rl=http%3A%2F%2Fwww.albertsons.com%2F%231&if=false&ts=1472571061706","https://www.facebook.com/tr/?id=811207002269085&ev=PixelInitialized&dl=http%3A%2F%2Fwww.albertsons.com%2F%231&rl=http%3A%2F%2Fwww.albertsons.com%2F%231&if=false&ts=1472571061706",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache, must-revalidate, max-age=0"],"content-length":["44"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Tue, 30 Aug 2016 15:31:01 GMT"],"last-modified":["Fri, 21 Dec 2012 00:00:01 GMT"],"server":["proxygen"],"set-cookie":[""],"status":["200"]},"image"]
  nightmare:log did-frame-finish-load +74ms [{},false]
  nightmare:log did-get-response-details +103ms [{},false,"http://bcp.crwdcntrl.net/5/c=3841/rand=615391281/pv=y/rt=ifr","http://bcp.crwdcntrl.net/5/c=3841/rand=615391281/pv=y/rt=ifr",200,"GET","http://www.albertsons.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-length":["163"],"content-type":["text/html;charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:31:01 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=NOI DSP COR NID PSAa PSDa OUR UNI COM NAV"],"pragma":["no-cache"],"set-cookie":["_cc_aud=\"ABR4nC2We1CWVRCH3%2FMikDrcZcSUS4CgKDexyTEDLajBxhJQgcrAQbPRbMYpMrKkLJsSiwGjm1CIRngrJUQQLEjBksbyIy5FZCSGyXSBKMrsMvwe%2BeN72HN29z27Z8%2BeY1mWld5SedS69mdqLHtCoP71XyLExIOfhPmfC0k3CBlXZPPAj5JGDgsFDWO%2FdsT7zH2vwapPhP50IeVJoXep8PMuobgBL7uFkwfBAbBfzqYWCV%2BNF3wXCIvWCyueEpZECSsPo2mEDWEYxIE58tlORCPVQtAZzZX1sOpm4XZ%2FNC9KqjJIRNTex6pLkc7jOhjpG6Xg%2BrvJxGVhsbdUuvulUoHBigykHvC1BqfvkbRwWHalHWimoNIB2jVYp4js7peEzf%2BguRi7MuHPxjE4uXgKk%2Beh%2Bbu89L%2BG9JukD3xx%2FTFQCuwTsUgf8T1Ko6IRaRrLvVWavW0M%2BuHzAppHUWGr6iYhzdfcolXYketxL2tw1IkMvqFB52UsQnZWjHbaCvpUoQQMofkiyaLcxj0myfNNSUl1klLasbPxksrXHxZig%2FSFQ4l4eRufjwrF0fIyidPRjkEQlezxFs4StBb3zdI8xubELAA3C16umGcyqPq0AtnwQDb8EsV%2BoUTSWmKIbQbaDtN9p9a5Xim3NrLFU55lLdl8IUKDpc6Sdt6Ez8eFIlWr3VghqSIGRONzAhjP4CwS6Yk0A4TjbJ3mQvcRdKgkZ0KpWSmkFjHHOhfOBlqZFd1FlpRI40sRLd%2Bmr0cMIm0V1nzB4C%2BYT5HPgFTM7xWSQpjzIiE6m%2FZDBwkznbSSAg8C8yAvCaNIFIMHZ9r9P0JZLslxmsEr4C%2FsBpEwd2hX7HXKhJX9gsxzB1D5lWgLwQ7mzuOFZFVr1Sa9gYhoMwmqHtvvX7z0MkjDdadQTq%2BWVHSfJB%2BdMfOqdsXa%2BwyaMjBddMyuKgzS5LqA45tNBnN1OkyY4rOTsavcK9TXEKYKzMltuwZDyaCDg%2BCg7w60IT1ItNS8g3U6suX6ulW4VimaEDZ1mLujay2DbP%2BaSOw4og7uh6KJ8vLE81JJVJhm2VnBaS5QH7QCToGTqNDIAriPtp9AMwRwgQUrMPsqe7t7Lolki49wuI5sBWQ3IRkpH2zBtZJsSgZYoBq1PaMen0EazKXvdqrhmlZaZW0e5iXgFQ3uu4hUDIpAIeukJUTR%2FBPnAA7s6DvC6jNkl%2BIbpqmWj5KQjcTgJpz7ToO2g%2BUSbQLtt%2FySBn03SGrewme5ls59prn9f8i8sxtwtG1Kyj4GagVvCjpKSzJxZaAU7AL06zh1feu5L4WsTYB2mJXLh44LAzwBBlwAhRmXAyi%2B%2BFPk%2Bh7SQ8ec%2FSFzWqDdcwjorFh9XcwdYJBW2adjYWfqbrRdlQkz%2BC5zuojsPAzy8OK2h9iz8MLt1DxZ0nEeEp1ERCbsiVOFeRmofAt60eSo1boTih%2BSN%2BC63hZNdmeyCLrpVY5M3tOAai3Xc8QEdwrebHj8tWSpe5s0Dkka92Y5t3Z9NaEkgzs0eJmW3rpTUqaya3Jola2vI1F1ORSK7YE0IpWmVmGojrQS2JDqxUrk%2Buzk%2BRNOEbnSOONvRPM9DRo6tH%2BBpBY2vIULs6VJc3c9Ii8udJvbuI8iqeT7eZx0MJfDE8dQyW2cacP2h5NIFxYRyaP0lr%2BRaLH%2B9Cx%2FelZkOeCV4FOJMx7IhZuQVHzmB2IPxs5HXcMsLeMLZ%2FE5C8wEXMlNvAf9w8D0sV%2Bnadxq%2BS6AY5E%2FDnC086VivMYulP8BTZWnMw%3D%3D\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT;Max-Age=23328000","_cc_cc=\"ACZ4nJXU204TQRjA8S4RCaWhb2BIvDMhCkUJD%2BAzeF1QnkMQOTUqoMGAEgIIxigXaowCPdDDVo4FgW4pZYEiFDmUk1QQgRVJ2%2Bz879yLzfz2m5md75vdMeRZrMXWwoLi8nJrUYHlRon1XvHNotK7ltKyQmvZraLyEsP5dUfu%2BeTx%2BDWzIXV96XfnZ45LjqeaZtYk6cnt05Ozi5b9WqpVccVwft%2FNSPUx9P3%2FkMkaT1byqSGmTJulkTz1KBmLw7ZowCi5MzpSfj0yLngltmuSPl5%2Fc5j0dzjSv5Grd7Oj3ah3VWuN0D%2BK8dvBnWzpQ%2F77X0lvKaIV2AfLsAvuhjvgNrgZtsF1cBV8hHwScByOwavwMrwEL8AqHIYVOAhPwQF4FB6Gh%2BCvsAz7YA%2Fshl3wfuOMUe81eBVehqPwIjwHz8IKHISn4DHYBztf2M1CPWEv7IHd8CDsgh1w9K0srGcJXoQXYBWehyPwHByG3Q1KzvlZlkgkPdP22KR3sOHirEu7Gd7q8gpusYnxxF5rtt6z8Xph%2Ft521SStXe1L2QY%2Fgr2donvUpkwpkuWIJ31g7zNJB9lp78N78A68DcfhLXgTXodX4RW4e7P6Xz3SjiF%2BGGoU8nMiX7n2%2BLK%2B%2F27lgDDfBubzB%2Bpy9R6GR%2BGfGD%2BJ%2BDRsX2kQ3j9QLa6v1xXK0bsGrnfUZenzewhXwPdhzS76DD6B%2F8C%2F4a7%2BFqP08lLaa%2FNi%2FU9hDV5CfRZgFZ6HI%2FAcHIZn4RAchGfgb%2FAEHIDH4TF4CJZhH%2ByFPbAbHoSd8AA8%2Beq5Ub8%2FE3D4s7jfITgIj8DDsB92wu%2FgTvzfbXAL%2FAxugmvhB3AlfIbv9wQ%2BhtfhH3AMVuEQ%2FBfikeCP\";Version=1;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT;Max-Age=23328000","_cc_id=3a7a217ffa41309ae754bd3bc2ac64f9;Path=/;Domain=crwdcntrl.net;Expires=Sat, 27-May-2017 15:31:01 GMT"],"x-server":["172.20.10.119"]},"subFrame"]
  nightmare:log did-frame-finish-load +6ms [{},false]
  nightmare:log did-frame-finish-load +0ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +2ms [{},["http://www.albertsons.com/wp-content/themes/albertsons/favicon.png"]]
  nightmare:log did-stop-loading +0ms [{}]
Page loaded
{ url: 'http://www.albertsons.com/',
  code: 200,
  method: 'GET',
  referrer: '',
  headers: 
   { 'accept-ranges': [ 'bytes' ],
     age: [ '0' ],
     connection: [ 'keep-alive' ],
     'content-length': [ '74875' ],
     'content-type': [ 'text/html; charset=UTF-8' ],
     date: [ 'Tue, 30 Aug 2016 15:30:59 GMT' ],
     link: 
      [ '<http://www.albertsons.com/wp-json/>; rel="https://api.w.org/"',
        '<http://www.albertsons.com/>; rel=shortlink' ],
     server: [ 'Apache/2.2.15 (CentOS)' ],
     via: [ '1.1 varnish' ],
     'x-cache': [ 'MISS' ],
     'x-pingback': [ 'http://www.albertsons.com/xmlrpc.php' ],
     'x-powered-by': [ 'PHP/5.3.3' ],
     'x-varnish': [ '1348405685' ] } }
Closing nightmare
  nightmare running +17ms
  nightmare electron child process exited with code 0: success! +65ms
Has results
undefined
Closing process after 3595ms
```
### Headless Output (not working)

```
Starting nightmare
  nightmare queuing process start +0ms
In generator
  nightmare queueing action "goto" for http://albertsons.com +5ms
  nightmare running +2ms
  nightmare:log Navigating: "http://albertsons.com",
            headers: [none],
            timeout: 30000 +347ms
  nightmare:log did-start-loading +10ms [{}]
  nightmare:log did-get-redirect-request +48ms [{},"http://albertsons.com/","http://www.albertsons.com/",true,301,"GET","",{"accept-ranges":["bytes"],"age":["0"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:13:50 GMT"],"location":["http://www.albertsons.com/"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-pingback":["http://www.albertsons.com/xmlrpc.php"],"x-powered-by":["PHP/5.3.3"],"x-varnish":["2379973646"]}]
  nightmare:log did-get-response-details +711ms [{},false,"http://www.albertsons.com/","http://albertsons.com/",200,"GET","",{"accept-ranges":["bytes"],"age":["0"],"connection":["keep-alive"],"content-length":["74875"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 30 Aug 2016 15:28:29 GMT"],"link":["<http://www.albertsons.com/wp-json/>; rel=\"https://api.w.org/\"","<http://www.albertsons.com/>; rel=shortlink"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-pingback":["http://www.albertsons.com/xmlrpc.php"],"x-powered-by":["PHP/5.3.3"],"x-varnish":["887738404"]},"mainFrame"]
  nightmare:log did-get-response-details +101ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1","http://www.albertsons.com/wp-content/themes/albertsons/style.css?v1",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["887"],"content-length":["40430"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3f0678-9dee-523958c824480\""],"last-modified":["Mon, 02 Nov 2015 21:34:58 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367068 1348341851"]},"stylesheet"]
  nightmare:log did-get-response-details +2ms [{},false,"http://fonts.googleapis.com/css?family=Droid+Sans","http://fonts.googleapis.com/css?family=Droid+Sans",200,"GET","http://www.albertsons.com/",{"access-control-allow-origin":["*"],"cache-control":["private, max-age=86400, stale-while-revalidate=604800"],"content-encoding":["gzip"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"expires":["Tue, 30 Aug 2016 15:06:31 GMT"],"last-modified":["Tue, 30 Aug 2016 15:06:31 GMT"],"link":["<http://fonts.gstatic.com>; rel=preconnect; crossorigin"],"server":["ESF"],"timing-allow-origin":["*"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"stylesheet"]
  nightmare:log did-get-response-details +4ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/fonts/Caferus/Caferus.css","http://www.albertsons.com/wp-content/themes/albertsons/fonts/Caferus/Caferus.css",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["2243"],"content-length":["2730"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"2a20ba-aaa-517b342a13800\""],"last-modified":["Thu, 04 Jun 2015 15:59:28 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658167 2300595184"]},"stylesheet"]
  nightmare:log did-get-response-details +5ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-pinboard-widget/style.css?v=1&ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-pinboard-widget/style.css?v=1&ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes","bytes"],"age":["0"],"content-length":["981"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"2261d-3d5-5131e4c439f40\""],"last-modified":["Tue, 07 Apr 2015 08:35:33 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-varnish":["2379961485"]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/style.css?ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/style.css?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["47"],"content-length":["1147"],"content-type":["text/css"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"28a61b-47b-53679248211c0\""],"last-modified":["Thu, 30 Jun 2016 06:40:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658166 2300656609"]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-includes/js/jquery/jquery.js?ver=1.12.4","http://www.albertsons.com/wp-includes/js/jquery/jquery.js?ver=1.12.4",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3064"],"content-length":["97184"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"120084-17ba0-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887702384 887612854"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1","http://www.albertsons.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2843"],"content-length":["10056"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"264708-2748-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741832 1838658105"]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/jquery.nailthumb.1.0.min.js?ver=4.5.3","http://www.albertsons.com/wp-content/plugins/pinterest-rss-widget/jquery.nailthumb.1.0.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2358"],"content-length":["15886"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"44437a-3e0e-53679248211c0\""],"last-modified":["Thu, 30 Jun 2016 06:40:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["509304541 509234795"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/superfish.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/superfish.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2103"],"content-length":["3833"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"36366-ef9-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961487 2379900259"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/hoverIntent.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/hoverIntent.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3132"],"content-length":["3257"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3f035e-cb9-4d7478ef65200\""],"last-modified":["Wed, 06 Mar 2013 20:37:28 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367071 1348275024"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.watermark.min.js?ver=4.5.3","http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.watermark.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2373"],"content-length":["4629"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"36363-1215-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961488 2379891705"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.cycle.all.min.js","http://www.albertsons.com/wp-content/themes/albertsons/js/jquery.cycle.all.min.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1707"],"content-length":["32066"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3f0361-7d42-4d7478f14d680\""],"last-modified":["Wed, 06 Mar 2013 20:37:30 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367073 1348318069"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/scripts/getCustomerData.js","http://www.albertsons.com/wp-content/themes/albertsons/scripts/getCustomerData.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["160"],"content-length":["1713"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"270368-6b1-4f6388ca3f740\""],"last-modified":["Fri, 04 Apr 2014 14:44:05 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741834 1838738410"]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/scripts/json2.js","http://www.albertsons.com/wp-content/themes/albertsons/scripts/json2.js",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1623"],"content-length":["3377"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"2923fd-d31-4ca6492d7d000\""],"last-modified":["Sun, 23 Sep 2012 20:46:56 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658168 2300612871"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/android_robot_21x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/android_robot_21x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["866"],"content-length":["3619"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3fe255-e23-5166f15887a80\""],"last-modified":["Tue, 19 May 2015 13:14:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367075 1348342337"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/app-store-icon_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/app-store-icon_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1784"],"content-length":["4330"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"474284-10ea-5166f15887a80\""],"last-modified":["Tue, 19 May 2015 13:14:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["509304543 509252520"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/instagram_icon_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/instagram_icon_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3548"],"content-length":["4558"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"280258-11ce-5166f15b64140\""],"last-modified":["Tue, 19 May 2015 13:14:05 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741835 1838638483"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/youtube_social_squircle_red_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/youtube_social_squircle_red_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2230"],"content-length":["3872"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"4225b-f20-5166f15d4c5c0\""],"last-modified":["Tue, 19 May 2015 13:14:07 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961491 2379896082"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/twitter_logo_white_bluebkgrnd_radius_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/twitter_logo_white_bluebkgrnd_radius_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1434"],"content-length":["3967"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3fe25a-f7f-5166f15c58380\""],"last-modified":["Tue, 19 May 2015 13:14:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367076 1348325643"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://assets.pinterest.com/images/pidgets/pin_it_button.png","http://assets.pinterest.com/images/pidgets/pin_it_button.png",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=1209600"],"content-length":["909"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"last-modified":["Thu, 02 Jun 2016 17:17:12 GMT"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4fc14192152e30a5","http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4fc14192152e30a5",200,"GET","http://www.albertsons.com/",{"cache-control":["public, no-check, max-age=600"],"cf-cache-status":["HIT"],"cf-ray":["2da9455030df0880-IAD"],"content-encoding":["gzip"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:28:07 GMT"],"etag":["\"3742628-59c64-53b3796df2600\""],"last-modified":["Mon, 29 Aug 2016 15:33:44 GMT"],"server":["cloudflare-nginx"],"surrogate-key":["client_dist"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-distribution":["99"],"x-host":["s7.addthis.com"]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-includes/js/wp-embed.min.js?ver=4.5.3","http://www.albertsons.com/wp-includes/js/wp-embed.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["73"],"content-length":["1403"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"24613-57b-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961489 2379959307"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://assets.pinterest.com/js/pinit.js","http://assets.pinterest.com/js/pinit.js",200,"GET","http://www.albertsons.com/",{"cache-control":["max-age=1209600"],"content-encoding":["gzip"],"content-length":["286"],"content-type":["application/javascript; charset=utf-8"],"date":["Mon, 29 Aug 2016 18:34:36 GMT"],"last-modified":["Fri, 19 Aug 2016 18:24:17 GMT"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/pinterest_badge_red_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/pinterest_badge_red_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3333"],"content-length":["3472"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"280259-d90-5166f15c58380\""],"last-modified":["Tue, 19 May 2015 13:14:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741836 1838644626"]},"image"]
  nightmare:log did-get-response-details +4ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/05/fb_f_logo_radius_25x25.png","http://www.albertsons.com/wp-content/uploads/2015/05/fb_f_logo_radius_25x25.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1236"],"content-length":["3821"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"474285-eed-5166f1597bcc0\""],"last-modified":["Tue, 19 May 2015 13:14:03 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["509304545 509269439"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2015/11/abslogo2000v4.jpg","http://www.albertsons.com/wp-content/uploads/2015/11/abslogo2000v4.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1346"],"content-length":["60925"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"2aa17a-edfd-524c4efbec480\""],"last-modified":["Tue, 17 Nov 2015 23:32:18 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658172 2300620633"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn.gif",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1881"],"content-length":["1881"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3632e-759-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961494 2379907755"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/truck_icon.png","http://www.albertsons.com/wp-content/themes/albertsons/images/truck_icon.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1837"],"content-length":["2340"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3f0626-924-521e93b16cd80\""],"last-modified":["Mon, 12 Oct 2015 14:34:46 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367077 1348314549"]},"image"]
  nightmare:log did-get-response-details +4ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn-black.gif","http://www.albertsons.com/wp-content/themes/albertsons/images/go-btn-black.gif",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2332"],"content-length":["1877"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"27032d-755-4d7478e9ac480\""],"last-modified":["Wed, 06 Mar 2013 20:37:22 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741838 1838674573"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/FluShot_2016_ALB_HomepageSlider_ABS-975x490.png","http://www.albertsons.com/wp-content/uploads/2016/08/FluShot_2016_ALB_HomepageSlider_ABS-975x490.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["182"],"content-length":["168430"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"48e0dd-291ee-539d35ba55d80\""],"last-modified":["Thu, 11 Aug 2016 22:33:42 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["509304546 509300557"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://connect.facebook.net/en_US/all.js#xfbml=1","http://connect.facebook.net/en_US/all.js#xfbml=1",200,"GET","http://www.albertsons.com/",{"access-control-expose-headers":["X-FB-Content-MD5"],"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["57975"],"content-md5":["XVAhccZbh8y/K53R7ebAIQ=="],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 30 Aug 2016 15:28:07 GMT"],"etag":["\"39b9f10bc5006674609e90f432f626b4\""],"expires":["Tue, 30 Aug 2016 15:40:40 GMT"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-content-md5":["7c5561ce50db8237991d435c3442da53"],"x-fb-debug":["cWVOamhRtD56IIeOw/Y/BqZ+2JwVZJTSeKq7ZRl+0117kbQj/nYei2Cy460SJQcdt+6kS063EC0vtYNFKlva4g=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/07/ABS-Fuel-Program-Homepage-FeatureUnit-Desktop.jpg","http://www.albertsons.com/wp-content/uploads/2016/07/ABS-Fuel-Program-Homepage-FeatureUnit-Desktop.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2563"],"content-length":["118887"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"5a323-1d067-5381a55f55580\""],"last-modified":["Thu, 21 Jul 2016 00:24:06 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961495 2379885875"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/04/albciv56063_rxplus_alb_homepageslider_976x492-976x490.jpg","http://www.albertsons.com/wp-content/uploads/2016/04/albciv56063_rxplus_alb_homepageslider_976x492-976x490.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["3415"],"content-length":["66098"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"13e1b1-10232-52f73e01880c0\""],"last-modified":["Fri, 01 Apr 2016 22:26:51 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887702388 887602986"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.albertsons.com/wp-content/uploads/2012/10/Homepage-Slider-ROTW1-978x490.jpg","http://www.albertsons.com/wp-content/uploads/2012/10/Homepage-Slider-ROTW1-978x490.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2970"],"content-length":["160628"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"3dea5d-27374-4cb1912826900\""],"last-modified":["Tue, 02 Oct 2012 20:07:32 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1348367079 1348279762"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/01/Weekly-Ad-Homepage-Slider-976x492-976x490.jpg","http://www.albertsons.com/wp-content/uploads/2016/01/Weekly-Ad-Homepage-Slider-976x492-976x490.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2791"],"content-length":["117205"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"28e1c3-1c9d5-52a530fe6f640\""],"last-modified":["Wed, 27 Jan 2016 16:12:01 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741840 1838659648"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/themes/albertsons/images/AdBar_2.jpg","http://www.albertsons.com/wp-content/themes/albertsons/images/AdBar_2.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1686"],"content-length":["13394"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"2923b1-3452-4f0f80bb7e780\""],"last-modified":["Mon, 27 Jan 2014 18:40:46 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658175 2300610986"]},"image"]
  nightmare:log did-get-response-details +7ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-CakesAndDeliTrays-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-CakesAndDeliTrays-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2961"],"content-length":["2366"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"9c0cf-93e-4df7ab75a5f80\""],"last-modified":["Wed, 19 Jun 2013 05:01:02 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658176 2300573784"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-Coupons-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-Coupons-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1776"],"content-length":["2325"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"11257d-915-4df7ae59b3180\""],"last-modified":["Wed, 19 Jun 2013 05:13:58 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887702389 887649678"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-ShoppingList-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-ShoppingList-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2970"],"content-length":["2446"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"9c0dd-98e-4df7adf7789c0\""],"last-modified":["Wed, 19 Jun 2013 05:12:15 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658178 2300573511"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-WeeklyAdEmail-780x585-60x45.png","http://www.albertsons.com/wp-content/uploads/2013/06/ClipsBar-WeeklyAdEmail-780x585-60x45.png",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["2577"],"content-length":["2311"],"content-type":["image/png"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"11258b-907-4df7ae000de00\""],"last-modified":["Wed, 19 Jun 2013 05:12:24 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["887702390 887626582"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/ProteinTravelBarsABS.jpg","http://www.albertsons.com/wp-content/uploads/2016/08/ProteinTravelBarsABS.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1494"],"content-length":["20266"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"29649d-4f2a-53aafb4d37cc0\""],"last-modified":["Mon, 22 Aug 2016 21:26:51 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["1838741843 1838700231"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.albertsons.com/wp-includes/js/wp-emoji-release.min.js?ver=4.5.3","http://www.albertsons.com/wp-includes/js/wp-emoji-release.min.js?ver=4.5.3",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1762"],"content-length":["9802"],"content-type":["text/javascript"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"28d39a-264a-536791d980cc0\""],"last-modified":["Thu, 30 Jun 2016 06:38:19 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2300658170 2300608868"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.albertsons.com/wp-content/uploads/2016/08/getty_686341746996879530-300x200.jpg","http://www.albertsons.com/wp-content/uploads/2016/08/getty_686341746996879530-300x200.jpg",200,"GET","http://www.albertsons.com/",{"accept-ranges":["bytes"],"age":["1157"],"content-length":["18127"],"content-type":["image/jpeg"],"date":["Tue, 30 Aug 2016 15:06:31 GMT"],"etag":["\"5a4ec-46cf-53b009527b700\""],"last-modified":["Fri, 26 Aug 2016 21:56:12 GMT"],"server":["Apache/2.2.15 (CentOS)"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-varnish":["2379961498 2379930121"]},"image"]
  nightmare:log did-frame-finish-load +138ms [{},false]
  nightmare:log did-frame-finish-load +9ms [{},false]
  nightmare:log did-get-response-details +5ms [{},false,"http://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f6618d74b88a2&origin=http%3A%2F%2Fwww.albertsons.com","http://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f6618d74b88a2&origin=http%3A%2F%2Fwww.albertsons.com",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["11270"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob:;"],"content-type":["text/html; charset=utf-8"],"date":["Mon, 29 Aug 2016 18:34:38 GMT"],"expires":["Sat, 26 Aug 2017 01:52:14 GMT"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["u/TpS01Nu/2Clly6q1iY5dYq697TPzy82gj/e1YEBr8TiR/4whEGvtlXiCHeFBpMetIWumr9oU0oymZAWmjjGg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +2ms [{},false,"https://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f6618d74b88a2&origin=http%3A%2F%2Fwww.albertsons.com","https://staticxx.facebook.com/connect/xd_arbiter/r/uN4_cXtJDGb.js?version=42#channel=f6618d74b88a2&origin=http%3A%2F%2Fwww.albertsons.com",200,"GET","http://www.albertsons.com/",{"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["11270"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob:;"],"content-type":["text/html; charset=utf-8"],"date":["Mon, 29 Aug 2016 18:34:38 GMT"],"expires":["Sat, 26 Aug 2017 01:52:14 GMT"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["u/TpS01Nu/2Clly6q1iY5dYq697TPzy82gj/e1YEBr8TiR/4whEGvtlXiCHeFBpMetIWumr9oU0oymZAWmjjGg=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-frame-finish-load +22ms [{},false]
  nightmare:log did-frame-finish-load +11ms [{},false]
  nightmare:log did-get-response-details +28ms [{},false,"https://www.facebook.com/impression.php/f3cf51f3cf75f9/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D","https://www.facebook.com/impression.php/f3cf51f3cf75f9/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D",200,"GET","http://www.albertsons.com/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-length":["43"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: data:;style-src data: 'unsafe-inline' *;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: chrome-extension://boadgeojelhgndaghljhdicfkmllpafd chrome-extension://dliochdbjfkdbacpmhlcpmleaejidimm;"],"content-type":["image/gif"],"date":["Tue, 30 Aug 2016 15:28:30 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"x-content-type-options":["nosniff"],"x-fb-debug":["C0HAWc/0Xs9Vkxv+ayZL+rsPcZMWrM2x5l2k87vTHFgIs0I+XAnXoP28UzcbUo8yaQiKXcTbVCCKgv4rFymf8w=="],"x-frame-options":["DENY"],"x-xss-protection":["0"]},"image"]
Has error
{ message: 'navigation error',
  code: -7,
  details: 'Navigation timed out after 30000 ms',
  url: 'http://albertsons.com' }
Closing process after 30393ms
```
 It consistently fails when loading this resource in headless: 

```
https://albertsons.mywebgrocer.com//Ajax/CustomerData/Get/98829CD9-7DC8-4B9E-AE3B-36E0944F5E9B?timestamp=1472571059737
```

Which returns the following

```
var CustomerData =
{"error":"","customerIdentified":false,"pseudoChainId":"3694327"}
OnCustomerDataReceived();
```

I updated the test script to try the following, but it did no good:

```
  , webPreferences: {
    webSecurity: false
  }
```
 Starting with:

`xvfb-run --server-args="-screen 0 1920x1080x24" node test.js`

Versions:
`nightmare 2.6.1`
`electron-prebuilt 1.3.4`
`node 6.3.1` && `node 4.4.4`
`Ubuntu 14.04.5 LTS`
  I need to wait for "DOMContentLoaded" + images, so I need the full "load" event. Having difficulty finding a way to make it work.

These didn't work:

``` js
.wait(() => document.readyState==="complete")
```

``` js
.wait(function(){ return document.readyState==="complete" })
```
 Hmm, it turns out that my issue was not with a "load" event, but with `documentElement.offsetHeight` calculations. Doing `wait(50)` fixes it -- so it's just an old browser issue.

My original question stills stands though. This needs to be documented somewhere at least, so it might as well be here.
 I'm actually having a similar issue. I have found that using the above `wait` function _does_ work, but not consistently on a headless linux setup.

The reason I am not simply relying on nightmare's idea of when the page is finished loading is that in my testing, the `did-stop-loading` event is fired once there is a significant (but small) amount of time after any assets (scripts, css, iframes) referenced on the page have finished loading. The event is then fired again after those assets have loaded, but by that point, nightmare has already moved on and (in my case) taken a screenshot of a mostly blank page. 

I am loading pages that tend to have a large number of iframes, all of which typically load in external assets as well. Maybe this could be the problem (as I haven't seen too many issues regarding premature promise resolutions)?

Strangely, running the same service that's responsible for loading the pages and using nightmare to take screenshots locally on my Mac almost _never_ (if ever) has a problem using the above `wait` function in order to determine when the page is actually finished loading.

I understand that nightmare most likely does not much of a recourse in terms of listening to events fired from the underlying electron instance, but I haven't delved into the code too deeply, so if it is possible to fix that way, then great!

If anyone has an alternative way to help nightmare make a best guess as to when the page has loaded, I'm all ears!

Edit: #770 looks to be related. 
 @rosshinkley In regards to your comment https://github.com/segmentio/nightmare/issues/769#issuecomment-244780554:

> Nightmare, by default, will wait for the did-stop-loading event. This event is typically emitted once the page is "finished" loading (be it from the original 20x completing or stop being called). At that point, the page should already be in a ready state. (Should. If it isn't, or you have a a countercase, I'd love to hear about it.)

I have opened https://github.com/segmentio/nightmare/issues/854 which provides a test case showing that there in fact is an issue with nightmare not finishing loading before moving on to the next chained method.
  At least that's what I think is happening. Here's a very simple snippet that works for most sites. For the login page below, however, Nightmare just hangs after the page renders:

``` javascript
const nightmare = require("nightmare")({ show: true, width: 1000 })
nightmare
  .goto("https://vip.pet-records.com/users/sign_in")
  // .goto("https://www.google.com")
  .title()
  .end()
  .then(result => {
    console.log(result)
  })
```

If you open the console you can see a JS error:

```
Uncaught SyntaxError: Invalid regular expression: /^D:\Users\bcreel\Documents\_Projects\muninn\node_modules\electron-prebuilt\dist\resources\/: \ at end of pattern
```

Is this a problem in Nightmare or Electron? Is there anything I can do to work around it?
 Right, it works for the commented out Google page but not the one I have active.

I did go back through the electron-prebuilt tags and it looks like this problem is Electron-specific and was introduced in v1.2.6 and remains a problem at the current version (v1.3.4). Should I report this over on their repo? If so, do you think the snippet above would be sufficient as a recreation?

Thanks for the help!
 I raised this issue with the Electron project. I'll either close or post more information here once I hear from them.
 Sure! [Here is the issue.](https://github.com/electron/electron/issues/7071)
 Someone from the Electron team has pointed out that the problem seems to be caused by a redefinition of String.prototype.startsWith() done by this specific site. So, bad on them, and I'm closing both issues. Thanks for your time on this.
  Bellow is simple example that I am trying to make work, but no success. It don't have much sense and purpose. I am just trying to figure out how to make script go to some another page and then execute some function inside `.evaluate()` if possible. Or if can't be done inside `.evaluate()` , what is the way and best practice?

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({
    show: true
});

nightmare

    .goto("https://www.google.com/")
    .type("input", "nightmare.js")
    .wait(3000)
    .click("button[type=submit]")
    .wait(2000)
    .evaluate(function() {
        var title = document.querySelectorAll("h3 a");
        i = 0;

        if (title.length > 0) {
            title[i].addEventListener("click", function() {
                setTimeout(function() {
                    that.click();
                    if ('a[href*=github]') {
                        document.querySelector('a[href*=github]').click();
                    }
                }, 5000);
            });
            title[i].click();
        }
    })

.then(function(result) {
        console.log("result", result);
    })
    .catch(function(error) {
        console.error('Search failed:', error);
    });
```
 @rosshinkley  Thanks! :) [asynchronous operations and loops](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) explanation helped me understand.

Script above is super basic, just to test this. Not much sense in there. :D

Thanks again!
  I'm trying to figure out a way to discover the url that resulted in a timeout when running nightmare.

I'm scraping a website that is very slow and i'm receiving lots of timeouts on my requests.
The ideal solution would be if .wait() returned a exception array that contained the actual error and the url that resulted in a timeout.

Here's the code

setInterval(function () {
    if (i <= limit) {
        var nightmare = Nightmare({show: false, gotoTimeout: 400000});
        console.log(endpointPsicos + i);
        nightmare
            .goto(endpointPsicos + i)
            //Pega o id ou espera 200 seg
            .wait('#tblMedicos', 200000)
            .inject('js', './node_modules/jquery/dist/jquery.js')
            .wait(500)
            .evaluate(function () {
                var psicoList = [];
                if ($('#tblMedicos')) {
                    $('#tblMedicos').find(("[data-medico-id][data-nome-medico]")).each(function () {
                        var psicoUrl = $(this).attr("data-medico-url");
                        psicoList.push(psicoUrl)
                    });
                    var url = $(location).attr('href');
                    return ([psicoList, url])
                } else{
                    var psicoList = [];
                    var url = $(location).attr('href');
                    return ([psicoList, url])
                }

```
        })
        .end()
        .then(function (result) {
            var psicoList = result[0];
            var url = result[1];
            if (psicoList.length > 0) {
                for (item of psicoList) {
                    psicoListUrl.push(item)
                }
                psicoListUrl = uniqueArray(psicoListUrl);
                console.log(psicoListUrl, psicoListUrl.length);
            }
            else {
                psicoListUrlError.push(url);
                console.log("Erro na URL " + psicoListUrlError)
            }
        })
        .catch(function (error) {
            console.error('Search failed:', error);
            var url = $(location).attr('href');
            psicoListUrlError.push(url);
            console.log(url)
        });
    i = i + 1;
}
else {
    return
}
```

}, 10000);
  After doing a click on a button, this error is logged in the console, and nothing happens - the page just hangs. I'm wondering if this has something to do with the encoding on the page.. the button is a 'submit' form button from the Atlassian AUI framework. Any way to fix this issue?
 Interesting. I just started using it and the same thing just happened to me. Unfortunately, I can't dig into it right now. But I'm afraid it is not related to clicking the button but most likely the blur event fired by leaving the previous form field.

I don't know I'm only guessing. I'll continue to investigate, the API in this thing seems really cool, and Electron should be fine for my tests. 

The version I'm on is 2.6.1
 @shanewignall Quick update, yup. Just as I thought. In my case, the selector for the field was wrong. the querySelector was not matching anything. 

The interesting part is why it all the way in the blur event, and not in the while trying to put values in the element. Hope this helps you, too.
 @jhenriquez Thanks for the info! I'll see if I can find the issue with  the previous field..
 @jhenriquez so one of my issues was just having to use a 'wait' in a certain place. This allowed for the button to actually switch back to the parent form.. but then I still get the blur event error. After that happens, again, the script hangs. This is driving me nuts. The button that is clicked makes the form disappear, so the user sees the parent form, which is then focused on again. Why would it not be focusing back on the parent form like it should?
 @shanewignall Well, my use case was way simpler I'm afraid :sweat_smile: but then again I believe it seems to be similar in nature. In my case I was only filling a form and clicking submit. Yet, my field selectors where actually incorrect. So, my selectors were not returning any elements so when nightmare tried to move from field one, to let's say field two (calling blur() on field one) the result is this error.

In your case, I believe it might be similar. By disappearing, I suppose we're not talking about only _hiding_, if the markup is being removed this could render all selectors associated with that previous form invalid.

I would suggest you dig a little bit into the libraries code, and do a quick debug to try and identify which selector is being handled that doesn't bring any results at that particular moment in time. I think the stack trace indicates directly where to look in this case.

Hope this helps. 
 @rosshinkley Thanks for the response. I added a .wait('body') before and after the button click. Unfortunately, I still get the blur event about a second after the script clicks the button that makes the little inline-dialogue form disappear. I noticed that between clicking the button and the blur event error, a little banner appears and disappears on the page that just tells the user that the form was updated successfully. I wonder if this specific element disappearing and appearing causes a blur event? 

Also

@jhenriquez Looking back on your previous comment, I found that when I say the child form "disappears", the elements are actually dynamically removed from the page. This element is an inline-dialogue in the AUI framework. 
The thing is, I'm not trying to do anything with those elements after clicking the button to make the dialogue go away, so I _wouldn't think_ that this causes the issue..any thoughts?
 I've also been skewered by this, with a selector for a form field that didn't exist. The call to    document.activeElement.blur(); in the nightmare .click() handler sucked me in, assuming it was the culprit. It was a red herring, it was indeed an incorrect selector in a call to .insert() that caused it.

I'm dropping this here in case it helps anyone in the mean time, until/if/when a fix for the deeper issue (I assume at a deeper level) can be made.
  I am doing some browser automation and there are times where code I'm executing in the target page (e.g. an `.evaluate()`) dies.

Best I can tell there's no way to timeout waiting for an `.evaluate` to come back, so the entire nightmare queue/promise chain kinda just hangs until I notice and kill it.

Any suggestions?

My set up looks like:

``` javascript
        .goto(urlBase + 'frmLogin.aspx')
        .type('#txtLoginName', username)
        .type('#txtPassword', password)
        .click('#btnLogin')
        .wait(function() {
            console.log('waiting for URL to become default.aspx');
            return window.location.href.includes('Default.aspx');
        })
        .evaluate(function() {
            // NOTE IT OFTEN DIES RIGHT HERE AS I NEVER
            // SEE THAT CONSOLE.LOG
            console.log('building base URL as', window.location.href.replace('Default.aspx', ''));
            return window.location.href.replace('Default.aspx', '');
        })
        .then(function(url) {
            logger.info('base URL built', url);
            self.options.urlBase = url;
            return callback();
        })
        .catch(function(e) {
            return callback(e);
        });
```

I've tried to wrap a `setTimeout` with a `throw` in the eval block, like so:

``` javascript
.evaluate(function() {
    doTheThingWhichSometimesDoesntWorkButCasuesAPageNagivationWhenItWorks()
    setTimeout(function() {
        throw new Error('page hasnt navigated yet, so throwing');
    }, 10000);
})
```

but that doesn't always work, nor do I really want to do that in all my `.eval` blocks.
 Another options/idea here would be to have a timeout on a `queue` so one could specify how long the entire set of queue'ed commands could run?
 I'm having an identical problem, would love to know if anyone came up with a workaround. Right now I'm messing with splitting up the chain into steps and having a Promise.all after a certain amount of time to see if I can pinpoint an evaluate that never finishes.
 @GWP this ended up solving the problem for me (as a workaround): https://github.com/segmentio/nightmare/issues/688#issuecomment-238473332
  As-is the test will time out.
 Actually the test still doesn't work; it "passes" no matter what.  Any idea what the problem there is?
 Since it's a generator you need to yield at the beginning of the chain. Also, you will no longer need the done() callback, or done variable in the generator declaration.

```
yield nightmare
  .goto('http://yahoo.com')
```

With no yield keyword there the generator function completes before the nightmare chain and because no assertion errors are thrown it passes. With yield there it halts execution until the completion of the chain, allowing time for the assertion error to be thrown in the .then() block if the expected results aren't there.

This is also why there is no longer a need for the done callback, because we can halt execution instead of calling back, so there is actually no callback injected into the function when it's a generator. If you were to leave the done variable declaration, and call to done() then it would result in the following error:

```
TypeError: done is not a function
```

Also, the selector won't return the right results, since the first results are from yahoo image search. The following selector delivers the desired results:

```
#main .searchCenterMiddle > li:nth-child(2) a
```

Complete test:

```
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

require('mocha-generators').install();

describe('test yahoo search results', function () {
  it('should find the nightmare github link first', function* () {
    var nightmare = Nightmare();
    yield nightmare
      .goto('http://yahoo.com')
      .type('form[action*="/search"] [name=p]', 'github nightmare')
      .click('form[action*="/search"] [type=submit]')
      .wait('#main')
      .evaluate(function () {
        return document.querySelector('#main .searchCenterMiddle > li:nth-child(2) a').href;
      })
      .end()
      .then(function (link) {
        expect(link).to.equal('https://github.com/segmentio/nightmare');
      });
  });
});
```
 Awesome; PR updated. Thanks!
 FYIâ€”all the examples in the readme used to use generators and were explicitly changed to _not_ use them several months ago. Which is to say, it might be better to make this PR just use promises. (Though it sounds like it still would've needed fixing anyway!)
 Gotcha.  I might have time to update this later in the week, but if anyone wants to take care if it first, please do.
 I ended up not using Nightmare for the project that prompted this, so I'm not going to have time to rewrite and test the example code.
  Still not sure what exactly is causing the problem but it seams when you kill() the process is not giving time to electron.app to quit gracefully and that is not allowing the cookies/session to be saved. 

More info can be found here: [Quit gracefully when Ctrl-C is pressed in console #5273](https://github.com/electron/electron/issues/5273)

Fixes bug:
[Nightmare persist partition on windows bug #755](https://github.com/segmentio/nightmare/issues/755) 

Probable fix for:
[Always fail to set cookie #531](https://github.com/segmentio/nightmare/issues/531) 
[sharing a session between different machines? #398](https://github.com/segmentio/nightmare/issues/398)
[Sessions are not persisting in Ubuntu #536](https://github.com/segmentio/nightmare/issues/536)
 What's the status here?
 Im using it in the moment with this modifications so i can persist session between 2 electron windows. I have noted some of the issues i think will fix but nobody have replied yet.
  modified:   lib/actions.js
- map .wait(selector, timeout)->args[1] to this.options.waitTimeout if typeof === 'number'
 Sure, I will write them up in a bit.
 @rosshinkley I have added the test for timeout when no element exists, and it passes. Above you mention "one handling the element existing before the timeout", this test existed already for the .wait(selector) call, so for the .wait(selector, timeout) call I just added a non-existent selector and 150ms to ensure it still passes, it does not pass if I just wait for the ul.

Is there another specific case you want me to test for?
  I was having problems to get Nightmare and Electron app to share a [persist partition](https://github.com/segmentio/nightmare/issues/754)

It turn out is a bug for some reason in windows environment you need to use app.quit() in order to save the persist partition by adding this code

```

/**
 * Make sure we close the app
 */
app.on('window-all-closed', function () {
  // On OS X it is common for applications and their menu bar
  // to stay active until the user quits explicitly with Cmd + Q
  if (process.platform !== 'darwin') {
    app.quit()
  }
})

/**
 * Listen for the app being "ready"
 */
app.on('ready', function() {
  var win, frameManager, options, closed; 

......

```

to runner.js it fixes the problem it may be related with other issues
 Actually only this don't fix the problem it seams the way Nightmare is kilning the process on .end() is not the best way of closing electron process.

ignore the first comment code i posted the one bellow seams to work i cannot find any issue with Nightmare and persist partition works now :cookie: 

in runner.js after line 69

```
  /**
   * Exit the electron app correctly
   */
  parent.respondTo('quit', function(done) {
    app.quit(); done();
  });
```

and in the nightmare.js replace line 211 with this

```
    // instead instance.proc.kill(); use quit
    instance.child.call('quit', () =>{
      instance.child.removeAllListeners();
    });
```
  Using nightmare 2.6.0, electron seems to load nightmare but then stops running. Can provide Dockerfile which reproduces it fully.

```
Mon, 08 Aug 2016 09:39:16 GMT nightmare queuing process start
Mon, 08 Aug 2016 09:39:16 GMT nightmare queueing action "viewport"
Mon, 08 Aug 2016 09:39:16 GMT nightmare queueing action "useragent"
Mon, 08 Aug 2016 09:39:16 GMT nightmare queueing action "goto" for https://www.example.com
Mon, 08 Aug 2016 09:39:16 GMT nightmare queueing action "wait"
Mon, 08 Aug 2016 09:39:16 GMT nightmare queueing action "evaluate"
Mon, 08 Aug 2016 09:39:16 GMT nightmare running
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr App threw an error during load
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr Error: Cannot find module 'sliced'
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module._resolveFilename (module.js:440:15)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Function.Module._resolveFilename (/node_modules/electron-prebuilt/dist/resources/electron.asar/common/reset-search-paths.js:35:12)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Function.Module._load (module.js:388:25)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module.require (module.js:468:17)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at require (internal/module.js:20:19)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Object.<anonymous> (/node_modules/nightmare/lib/ipc.js:8:14)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module._compile (module.js:541:32)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Object.Module._extensions..js (module.js:550:10)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module.load (module.js:458:32)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at tryModuleLoad (module.js:417:12)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr A JavaScript error occurred in the main process
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr Uncaught Exception:
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr Error: Cannot find module 'sliced'
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module._resolveFilename (module.js:440:15)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Function.Module._resolveFilename (/node_modules/electron-prebuilt/dist/resources/electron.asar/common/reset-search-paths.js:35:12)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Function.Module._load (module.js:388:25)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module.require (module.js:468:17)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at require (internal/module.js:20:19)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Object.<anonymous> (/node_modules/nightmare/lib/ipc.js:8:14)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module._compile (module.js:541:32)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Object.Module._extensions..js (module.js:550:10)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at Module.load (module.js:458:32)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr     at tryModuleLoad (module.js:417:12)
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".
Mon, 08 Aug 2016 09:39:16 GMT electron:stderr libudev: udev_has_devtmpfs: name_to_handle_at on /dev: Operation not permitted
```
 Working workaround is:

``` bash
cd /node_modules/nightmare && npm install --save
```
 Use https://github.com/rrva/nightmare-752-repro to reproduce
 Cannot reproduce using that repo:

```
~/Devel/Temp
â¯ git clone git@github.com:rrva/nightmare-752-repro.git
Cloning into 'nightmare-752-repro'...
remote: Counting objects: 7, done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 7 (delta 0), reused 7 (delta 0), pack-reused 0
Receiving objects: 100% (7/7), done.
Checking connectivity... done.

~/Devel/Temp
â¯ cd nightmare-752-repro/

~/Devel/Temp/nightmare-752-repro master
â¯ npm i

> electron-prebuilt@1.3.3 postinstall /Users/albinekb/Devel/Temp/nightmare-752-repro/node_modules/electron-prebuilt
> node install.js

Downloading electron-v1.3.3-darwin-x64.zip
[============================================>] 100.0% of 43.49 MB (2.42 MB/s)
app@1.0.0 /Users/albinekb/Devel/Temp/nightmare-752-repro

~/Devel/Temp/nightmare-752-repro master*
â¯ git status
On branch master
Your branch is up-to-date with 'origin/master'.
Untracked files:
  (use "git add <file>..." to include in what will be committed)

    node_modules/

nothing added to commit but untracked files present (use "git add" to track)

~/Devel/Temp/nightmare-752-repro master*
â¯ node app.js
sections []
null
```
 @albinekb: To reproduce, you have to use the instructions in the README, i.e. run it in the environment provided in the Dockerfile. For example, this uses node v5.12.0 if this matters. 
 Since others have trouble reproducing I suspect it is something in my environment, thats why I provided the Dockerfile which reproduces it. There is nothing nonstandard about the environment, it uses the official node:5 docker image and adds the library dependencies which electron needs. When using nodejs 6.x image, I instead get problems when the dependency electron-prebuilt is installed: https://github.com/electron-userland/electron-prebuilt/issues/178 so I downgraded to node:5.
 When looking at the require error in electron-userland/electron-prebuilt#178 and here, it seems like it's not a problem with nightmare, maybe it's a problem with the prebuilt electron/electron itself. 

But most likely it's something with your setup  since it works fine on macOS & Ubuntu (headless on amazon)?
 Seems like your npm isn't installing all dependencies...
 If you do a clean install, with your dockerfile and run `npm ls` in the project, and diff that with an install that's not in docker I think you'll see your problem ðŸ˜ƒ 
 The problem was that the application was installed in / and installing it in a separate directory fixed it.

See below changes. Was totally related to my env, so not a bug, closing.

https://github.com/rrva/nightmare-752-repro/pull/1/files

`npm ls -json` looked identical to my eyes both inside and outside the docker env though.

Thanks.
 Great that you got it working @rrva ðŸ˜Š
  version: 2.5.3

I run the program with the command `xvfb-run -a -s '-screen 0, 1024x768x24' node index.js`. At some time, it will be blocked in `wait` forever.

It turns out that electron process was died, and the debug log shows - 

```
electron:stderr [11982:0804/225110:ERROR:browser_main_parts.cc(126)] X IO error received (X server probably went away)
electron:stderr [12044:0804/225110:ERROR:x11_util.cc(89)] X IO error received (X server probably went away)
```

I'm curious how to capture this, so I can kill the main process? The supervisor, a process control system will restart  it for me. Thanks in advancedï¼
 Will try it and keep you updated, thanks!
 I can confirm that my app is blocked in wait forever after running for like 15-30min, it never gets a timeout after submitting a form that is stuck by webserver with latest 2.6.1 release
 @Snake4life ,  you may give this code a try - 

```
nm.goto("...")
      .then(() => {
        nm.proc.on('close', (code) => {
          debug('electron process exited, kill myself...');
          process.exit(code);
        });
      });

```
 thanks Im gonna try it out
  Possibly noob question (sorry)... but I just can't explain this behavior:

``` js
let load = nightmare
  .goto("http://facebook.com") 
  .wait(200)
  .type("#email", "xxx") // starts typing in #email field  
```

``` js
let load = nightmare
  .goto("http://facebook.com") 
  .type("#email", "xxx") // starts typing in #firstname field  
```

Any clues what's going on?
 OS: OSX, 
NodeJS: 6.2.2
Nighmare: 2.6.0

---

Full test snippet:

``` js
let Nightmare = require("nightmare")

let nightmare = Nightmare({
  show: true,
  dock: true,
  openDevTools: {
    mode: "detach"
  },
})

nightmare
  .goto("http://facebook.com")
  .type("#email", "xxx") // starts typing in #firstname field
  .then(() => {
    console.log("!!!")
  })
```

With such settings 100% runs end up filling the wrong field.
With other settings I observed random behavior for each run.
Sometimes it even was one character in one field and two subsequent in another field!

I believe this is somehow related to React and DOM timings but dunno who exactly.
  I'm using the screenshot function to grab some images for a selection of webpages.

I use `document.documentElement` to retrieve the height of the page in an attempt to capture a screenshot of the full page, however the document's height returned from the `evaluate` function is different to the value returned in devtools when I manually execute it on the webpage.

It results in the addition of a large blank area at the bottom of the screenshot, which is the same colour as the background of the webpage itself.

I've included the code I'm using below to see if it can be replicated, using the BBC News website as an example. I've also attached the image produced from the below code.

Any help would be hugely appreciated! Thanks.

``` javascript
var Nightmare = require('nightmare');
var nightmare = Nightmare({
  frame: false,
  useContentSize: true,
});

nightmare
  .goto('http://bbc.co.uk/news')
  .wait(1000)
  .evaluate(function() {
    var rect = document.documentElement.getBoundingClientRect();
    return {
      x: Math.round(rect.left),
      y: Math.round(rect.top),
      width: 1200,
      height: Math.round(rect.height)
    };
  })
  .then(function(dimensions) {
    return nightmare
      .viewport(dimensions.width, dimensions.height)
      .wait(1000)
      .then(function() {
        return nightmare.screenshot('test.png', dimensions);
      })
      .then(function() {
        nightmare.end(function() {
          console.log('Done.');
        });
      });
  });
```

Image:

![test](https://cloud.githubusercontent.com/assets/1469007/17373986/846b2bf6-59a2-11e6-8e4c-3d9dfa0dc6b0.png)
  Builds for #746 were failing in CIâ€”it turns out this is because JSON serialization is failing from circular references. This is not the first time weâ€™ve seen exceptions on serializing the raw event data, so Iâ€™m opting for just removing it altogether here. Thereâ€™s very little meaningful information that actually comes with them to begin with.
 @rosshinkley Whatever you did in https://github.com/segmentio/nightmare/pull/653/commits/03f43fc0b63640d1d05f46434545fcb82c9b2c6a seems to have stopped working for Node 6 :(
(must be that libnotify no longer depends on Node 6?)

Would it be better to `nvm install` in the `pre` scripts?
 > I'm curious what changed, but in this case, I imagine fixing it first might be simpler.

With the events? TBH, I donâ€™t really want to do the dig-through-the-event-and-find-all-the-problems-and-patch-them-then-lobby-electron-for-a-fix-then-see-this-break-later dance again. It seems prone to having serialization issues, and I donâ€™t think that should be a problem Electron cares aboutâ€”thereâ€™s great utility in having some oddball structures and/or exotic objects in the event, just not for Nightmare. Better to leave it alone and only surface the bits that are meaningfully additive here.

> I think a modification to the circle yaml to run nvm install for possibly all three versions in the pre would work. Thoughts?

Yeah, makes sense to me.
 Dâ€™oh, sorry to unload when you werenâ€™t even asking about that.

> Haven't we had this conversation before?

Yep, way back in #576 :P
  This fixes #740. We used to only listed for `did-fail-load` events to signal failure because they were always emitted in any kind of failure. In Electron v1.2.6, some kinds of provisional failures stopped emitting `did-fail-load`, so we now also need to listen for `did-fail-provisional-load`.
 See #747 to address test failures in CIâ€”itâ€™s an issue with electron events (again), not an issue with the changes here. Posted it separately because itâ€™ll affect any new PRs :\
 Rebased on #747 for passing tests.
 D'oh. Could swear I ran the whole suite locally and didn't see that, but there's no way it couldn't have happened :P

Guess Iâ€™m going to have to make that reset algorithm a lot more complicated.

Obviously not germane here, but I wonder if plugins should be made to be either a) uninstallable or b) instance-only.
 @rosshinkley Looks like the fix is passing the tests now. A merge and release will be appreciated.
  Title says it all. Very interested in this.
 I suppose you can use the [`webContents new-window`](https://github.com/electron/electron/blob/master/docs/api/web-contents.md#event-new-window) event.
  Hi, my company is trying to choose a test framework. Nightmare looks great. It provides promises, ES6, await.  

But the docs don't state if it's headless - i.e. does it open an instance of Electron for every test? (Like Selenium opens Firefox for each test).

Or is Electron just Javascript that runs in memory (like Phantom.js & Casper.js which I imagine is much faster because it doesn't have to open an entire application and Window on your screen).

Please will you add a brief note on this to your readme.md
 Oh no, I ran an example an it opens a whole Electron window :(

So it's not headless. Please put this in the docs.  Now I can't run it in Docker to have automated tests.
 Ahhh, now I see: 

> Pass { show: true } to the nightmare constructor to have it create a visible, rendered window that you can watch what's happening.

It would be cool if at the top of your readme you changed this line:

`var nightmare = Nightmare({ show: true })`

to 

`var nightmare = Nightmare({ show: true })  //use false for headless testing (e.g. in Docker)`
 You can run it headless using xvfb or xvfb-run. See #224.
 Are you saying if I don't have `show: true` and don't use xvfb it's still not headless?
 @RichardJECooke perhaps this docker image https://hub.docker.com/r/smtx/nightmarejs-webservice/ helps you build your nightmare app inside a docker container.

Here is the Dockerfile: https://hub.docker.com/r/smtx/nightmarejs-webservice/~/dockerfile/
 > https://github.com/segmentio/nightmare/issues/744#issuecomment-236570644

@RichardJECooke I agree, having that information there would be helpful. I just started using the example and noticed it opened a window, which is great while debugging but when I did a search on README.md for headless or hide, to my surprise I did not get an answer. So, having this would have saved me some time from continuing to dig for an answer or having to read the electron docs.
 If it requries X, it's not headless.
  I think this is a common question but I could not find a clear answer.

``` Javascript
var items = [];
var nightmare = Nightmare({show: true});
for (var i = 1; i < 5; ++i) {
    nightmare
    .goto('http://www.example.com/page' + i)
    .evaluate(function () {
        return document.querySelector('#item');
    })
    .then(function (item) {
        items.push(item);
    });
}
nightmare.end();
```

This doesn't work.
In most of the examples in Readme.md, `.end()` is called before `.then()`, but if i do that then nightmare instance is shut down before having the chance to execute the next `.goto()`.
  The process hangs after the 'did-stop-loading' event if the response' HTTP status code is 304 (not modified). I simulated the HTTP 304 response using httpbin (https://httpbin.org/status/304). Here's the Nightmare debug log:

```
  nightmare queuing process start +24s
  nightmare queueing action "useragent" +0ms
  nightmare queueing action "goto" for https://httpbin.org/status/304 +0ms
  nightmare running +1ms
  nightmare:log Navigating: "https://httpbin.org/status/304",
            headers: If-Modified-Since: Sat, 21 Jul 2016 00:00:00 GMT
,
            timeout: 30000 +13ms
  nightmare:log did-start-loading +7ms 
  nightmare:log did-get-response-details +58ms 
  nightmare:log did-fail-provisional-load +2ms 
  nightmare:log did-stop-loading +0ms 
```

There's no timeout or further signal until the process is stopped (Ctrl+C), and then it displays:

```
nightmare electron child process exited with code 0: success! +2m
```

Any clues as to why the process hangs this way.
 Is your nightmare script what you showed over on #737? If so, itâ€™s not hanging at all; because of the provisional load failure, `goto` is returning an error. Youâ€™re missing the `catch()` clause (or a second argument to handle errors in `then()`), which would get the error from `goto`.

Itâ€™s just firing an error youâ€™re not handling :P

(Nightmare _probably_ should be better about logging unhandled errors, but for that see the discussion in #501)
 Tried with `catch()` but on HTTP 304 it still hangs without any error or further message (until Ctrl+C):

``` node
nightmare
  .goto(url)
  .then(gotoStatus => {
    if (gotoStatus.code !== 200) {
      return Promise.reject("HTTP error");
    }
    // OK response
    return nightmare
      .wait(250)
      .evaluate(function() {
        // some eval code that returns results
      });
  })
  .then(result => console.log('Result:', result))
  .catch(error => console.log('An error occurred:', error))
  .then(_ => nightmare.end());
```
 @rosshinkley Using Nightmare 2.5.3 (latest on npm I suppose).

Tested a bit more, but HTTP 304 is still hanging, and it doesn't raise any exception. All other HTTP errors invoke `catch` via `Promise.reject` in the first `then`.
 @voidmonk Hmmm, v2.5.3 does not hang for me using the exact same code you pasted above (save substituting `'https://httpbin.org/status/304'` for `url`). Are you sure thatâ€™s exactly the code youâ€™re using?
 @Mr0grog Yeah, same code. It times-out, but doesn't end gracefully. Try running it verbose: `DEBUG=* node 304test.js`. You'll see that there's no activity after `did-stop-loading` event, until it eventually times-out.

I think the expected behaviour for a 304 response should be for the Nightmare process to be terminated instantly (as Chrome does to the request) rather than wait endlessly & timeout. I was [told by the Electron guys](https://github.com/electron/electron/issues/6657#issuecomment-236465680) that it needs to handled by checking the response code in the `did-get-response-details` event.

Here's the modified full code, but now how do we suspend further events and end the Nightmare process on HTTP 304:

``` node
var Nightmare = require("nightmare");
var nightmare = Nightmare();

var url = "https://httpbin.org/status/304";

nightmare
  .on("did-get-response-details", function(event,status,newURL,originalURL,httpResponseCode,requestMethod,referrer,headers,resourceType) {
    console.log("Response code: " + httpResponseCode);
    if (httpResponseCode === 304) {
      // Not Modified - how to suspend further events and end process?
    }
  })
  .goto(url)
  .then(gotoStatus => {
    if (gotoStatus.code !== 200) {
      return Promise.reject("HTTP " + gotoStatus.code);
    }
    // OK response
    return nightmare
      .wait(250)
      .evaluate(function() {
        // some eval code that returns results
      });
  })
  .then(result => console.log('Result:', result))
  .catch(error => console.log('An error occurred:', error))
  .then(_ => nightmare.end());
```
 Based on #474 and #487, I could get the process to end:

``` node
  .on("did-get-response-details", function(event,status,newURL,originalURL,httpResponseCode,requestMethod,referrer,headers,resourceType) {
    console.log("Response code: " + httpResponseCode);
    if (httpResponseCode === 304) {
      // Not Modified - suspend further events and end process
      nightmare.proc.disconnect();
      nightmare.proc.kill();
      nightmare.ended = true;
    }
```

It works when executed from the command-line, but when run within the `http` module (`http.createServer` handler) it halts execution but doesn't seem to kill the process.
 > It times-out, but doesn't end gracefully

Sorry, I guess I should have been more clear: it ends gracefully and immediately for meâ€”there's no timeout.

What platform and electron version are you using?
 @Mr0grog That's strange. It just hangs for me on HTTP 304 until timeout. I'm using:

Ubuntu 14.04.2 LTS on AWS
Node.js v6.3.0
Electron (electron-prebuilt) v1.3.1
Nightmare v2.5.3
 Tried the same code on another VM (Ubuntu 14.04.1 LTS on Azure, Node.js v6.3.1), but same problem -- process hangs after `did-stop-loading` and then times-out after 30 seconds. Beats me.

By the way, I'm running it headless via xvfb-run:

``` bash
DEBUG=* xvfb-run --server-args="-screen 0 1024x768x24" node 304test.js
```

It doesn't run without xvfb:

```
  nightmare electron child process exited with code 1: general error - you may need xvfb +74ms
  nightmare electron child process not started yet, skipping kill. +1ms
```

I also see these warnings. Don't think they're related to this issue:

```
  electron:stderr Xlib:  extension "RANDR" missing on display ":1". +50ms
  electron:stderr Xlib:  extension "RANDR" missing on display ":1". +172ms
```
 Tried a third time in a Docker cloud container (Ubuntu 14.04.1, Node.js v5.10.0), but same problem. This doesn't look like an isolated issue.
 Oh, interesting, looks like my Electron build was [very] out of date. Will have to see what they changed in the navigation events :\
 Yep, broke a little over a month ago because of https://github.com/electron/electron/pull/6201 (in Electron 1.2.6, one release newer than Nightmare requires)
 @Mr0grog Ah ok. So it this a bug in Electron or Nightmare? Any workaround to it?
 @voidmonk Itâ€™s more a bug in Nightmare than anything else, but only caused because Electron changed its behavior Â¯\_(ãƒ„)_/Â¯

No workaround that I can think of, sorry. #746 fixes it, though.
 @Mr0grog Thanks for looking into it, and for the quick fix!

Hoping for it to be merged and released to npm soon.
 Updated to Nightmare v2.6.0 (Electron 1.3.2) which seems to include the fix. Now the test code ([same as above](#issuecomment-236326180)) logs:

```
  nightmare:log did-start-loading +4ms [{}]
  nightmare:log did-get-response-details +64ms [{},false,"https://httpbin.org/status/304","https://httpbin.org/status/304",304,"GET","",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"connection":["keep-alive"],"date":["Wed, 03 Aug 2016 05:09:18 GMT"],"server":["nginx"]},"mainFrame"]
  nightmare:log did-fail-provisional-load +2ms [{},-3,"ERR_ABORTED","https://httpbin.org/status/304",true]
  nightmare:log did-stop-loading +1ms [{}]
```

And then it still hangs -- doesn't end the process, nor shows any other message, until timeout.
 @rosshinkley Oh ok, no worries. Thanks again. I'll await the next release.
 Any news about that issue ?
Running nightmare 2.6.1 + electron 1.3.4 and still have that issue.

Thanks
 @geostant I cannot reproduce with nightmare 2.6.1 or later with electron 1.3.4 or later. Using the @voidmonk's example code from https://github.com/segmentio/nightmare/issues/740#issuecomment-236467461 .

If you can provide a reproducible test case, Iâ€™ll look at it. Otherwise I canâ€™t seem to get the behavior you are seeing.
 And as @rosshinkley noted, better to open a new issue when you have reproducible example :)
 It seems that it was an issue with headless server while trying to set "show: true" which is impossible obviously :)
  Not an issue but an announcement that we have added Nightmare as a running backend for [CodeceptJS](http://codecept.io/nightmare/) testing framework. We are using one API for Selenium and Nightmare tests so you can easily switch between drivers. One of the major technical improvements that CodeceptJS allows to use not only CSS but XPath locators in tests. It was pretty complicated but it works.

Thanks to segmentio and all Nightmare contributors!
  I am working on moving from Phantom JS to Nightmare in an effort to get more CSS compatibility on my pages.

As a high-level view, my Nightmare instance lives inside a Docker container and listens for data to be pushed onto a queue. Once that data is pushed, I pull some data (including a string of HTML) out of the queue, alter the page a bit using Cheerio, and then turn the data into a HTML Data URL. 

Then, I goto the data url, use a couple of evaluate functions, scroll the page, and take a screenshot.

Here is a condensed version of my code:

``` javascript
function callNightmare(nightmare, html, data) {
  return new Promise(function(resolve, reject){
    var imageLoc = "./screenshot" + data.randomGuid + '.png';
    nightmare
      .userAgent(data.agentString)
      .goto(html)
      .wait()
      .then(function() {
        //remove scrollbar from image
        return nightmare.evaluate(function() { 
          var s = document.styleSheets[0];
          s.insertRule('::-webkit-scrollbar { display:none; }'); }
      })
      .then(function() {
        return nightmare.viewport(data.width, data.height);
      })
      .then(function() {
        return nightmare.inject('js', './localScript.js');
      })
      .then(function() {
        return nightmare.evaluate(getScrollPositionFromPage);
      })
      .then(function(scrollPosition) {
        return nightmare.scrollTo(scrollPosition.top, scrollPosition.left);
      })
      .then(function() {
        return nightmare.evaluate(fillInputsOnPageWithValues);
      })
      .then(function(){
        return nightmare.screenShot(imageLoc);
      })
      .then(function() {
        return nightmare.end();
      })
      .then(function() {
        resolve(imageLoc);
      })
      .catch(function(err) { 
        reject(err); 
      })
  });
}
```

However, my script will occasionally lock up during various evaluate functions, or during the screenshot function. Other times, the script runs successfully. I have tried this on various websites with the same results.

I can't pinpoint anything in the script that is causing this issue, and I didn't know if any of you had any thoughts on the problem?
 Yeah, I run it with DEBUG=*, it outputs 2 lines indicating the initialization of Nightmare, but then I stop getting output from that debug path for the remainder of the program.
  This is a _censored_ gist
https://gist.github.com/antonellopasella/0efa1fe935a4fbcc5b561b0699e809df

If can be useful, contact me on gitter and I can provide a couple proxy+auth for testing

Thanks!
 how can I force the proxy to stay when page is changing by a link?
 oh yeah sorry forget my question I fixed it thanks!
  Hi everybody.

I have a question.
I haven't found the way how set up Nightmare's logs output to be saved to file, not to be displayed in the console. 
It seems that I could listen to the [specific Electron's events and work with them](https://github.com/segmentio/nightmare#onevent-callback), but my I'm interested in this one: **nightmare:log**. Could I catch it or something?

Thanks in advance.
 Thanks a lot!
  I am currently attempting to take a screenshot using **Nightmare JS** where it also includes the dropdown (`<option>`) of a `<select>`. 

In order to get the dropdown to appear, I use the [**nightmare-real-mouse package**](https://github.com/Mr0grog/nightmare-real-mouse) to click the `<select>`. Locally, I have verified that this click will open the select (I set `show:true` on initialization of the nightmare object). However, the screenshot does not include the dropdown menu.

I have also tried adding a `nightmare.wait(1000)`, just in case the response to the `nightmare.realClick()` is not rendering quickly.
  Currently Click() clicks the first instance of a class/element/selector.

Is there a way to click all of the elements at once?

ie, click all of the check boxes with the same element at one, or all of one type of button at once, instead of it clicking the first one in in order in source.
 Alternatively, I suggest you do so:
....
.evalutate() {
 let elems = document.querySelectorAll('div.click');
elems.forEach(function(elem){
elem.click();
});
return "sucsess";
}
 code snippet not working, hmm. Any other suggestions?
  Adds an identifier to javascript responder events for electron code invocations.

Should fix: https://github.com/segmentio/nightmare/issues/727 
 ðŸ‘  Ah, so this is why everything is blowing up! `nightmare` doesn't support concurrency. ðŸ‘Ž
@cchamplin do you plan on reviving this PR or should I pick up the torch? ðŸ˜„ 

edit: https://github.com/Timer/nightmare/commit/803732b1b33936500b1a6918efc1f067b5253bad  I'm trying to take an screenshot of 375x667 (in order to simulate an iPhone 6 capture) with the code below, but the screenshot is taken as a wrong size of 359x608 and also is showing scrollbar (can scrollbar be hidden?)

Enviroment:
- Windows 10
- Node v6.2.2
- Nightmare.version: 2.5.3

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: false })

nightmare
  .useragent('Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1')
  .viewport(375, 667)
  .wait()
  .goto('http://www.google.com')
  .wait()
  .screenshot('test.png')
  .end()
  .then(function (result) {
    console.log('Nightmare.version: ' + Nightmare.version);
  })
  .catch(function (error) {
    console.error('Error:', error);
  })
```

**Image Generated**
![test](https://cloud.githubusercontent.com/assets/17678220/16848350/c9000f7a-49cb-11e6-9a67-e0720c991026.png)

Thanks,
FD
 try

```
var nightmare = Nightmare({
  frame: false,
  useContentSize: true
})
```
 Thanks Shuichiro, this solves the screenshot size issue.
Now is taking the screenshot at 375x667 but the scrollbar is still shown
and included in this size.
Is there any way to hide the scrollbar? Or any way to add the width of the
scrollbar so I can take screenshot of 375+scrolllbar_widthx667?

El Thursday, July 14, 2016, Shuichiro Kamiya notifications@github.com
escribiÃ³:

> try
> 
> Nightmare({
>   frame: false,
>   useContentSize: true
> })
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/726#issuecomment-232841431,
> or mute the thread
> https://github.com/notifications/unsubscribe-auth/AQ2_jEDy5tpcZULaSkMTUBapjCKIdp8Iks5qVuk5gaJpZM4JMpQS
> .
 Beautiful! this seems to work!

2016-07-15 0:24 GMT-03:00 Ross Hinkley notifications@github.com:

> I don't think you can hide the scrollbars with Electron before DOM ready
> https://github.com/electron/electron/issues/3534.
> 
> Out of curiosity, could you use -webkit-scrollbar set to display:none to
> hide the scrollbar? It will still be there before dom-ready, but I _think_
> you can hide it:
> 
> nightmare
>   .goto('http://example.com')
>   .evaluate(function() {
>     var s = document.styleSheets[0];
>     s.insertRule('::-webkit-scrollbar { display:none; }');
>   })
>   .viewport(100, 100)
>   .then(function() {
>     console.log('done');
>   });
> 
> Would something like that work for you?
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/726#issuecomment-232851174,
> or mute the thread
> https://github.com/notifications/unsubscribe-auth/AQ2_jGl4epxTK-CA02B5N2URHulBBRR_ks5qVv1pgaJpZM4JMpQS
> .
 `frame`, `show` and `useContentSize` are not documented in the readme and do not appear to do anything with v2.6.1
  I am having the same problem.
node --version
v0.10.36
But still getting this error.
PLEASE ADVICE
 Hey,
First of all thanks allot for you answer, it got lost in my tons of emails
and i already managed by my self.
Now that i see you answer i run into a problem when scrapping a webpage:
i scroll to the bottom of the page and every scroll actually triggers a
request with a response and i want to store this response without any luck
screenshot:
[image: Inline images 1]

[image: Inline images 2]



how can i do it?
The page that i am trying to scrap written in AngularJS and i know that the
response that i am looking for i stored somewhere on
*window.self.$scope.ctrl._ads* but i found it only once and it happen after
a several of events that i can't reproduce.

please help since this a really important project that i have to finish in
a couple of days

Thanks allot for your help and great day


On 8 August 2016 at 17:13, Ross Hinkley <notifications@github.com> wrote:

> @varsano <https://github.com/varsano> Upgrade NodeJS. Nightmare will not
> work with anything <4.x.
>
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/segmentio/nightmare/issues/725#issuecomment-238268811>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AOqEzp1fRuYss6T0I4ANBCdgQq1oYxh6ks5qd0eLgaJpZM4JMD6C>
> .
>
  Hi. i have some issue with running form filling in for loop. The problem is that i can't enable DevTool because i'm using "nightmare-upload" it wont work if i will enable DevTools. So i can't see is there any error in console or something else. It's running several times and stopping/freezing on some page. 
My question : is there any option to get all messages, events, errors with listening only one event so i can see what is happening on the page. 
After some more investigation i detected that it's stopping on .wait(selector) function. I checked and the callback is not working always once it's not working and the wait function is stopping working.
This is the code to test it. Sometimes it's working sometimes no, so i think it's some bug maybe.

```
const Nightmare = require('nightmare');
require('nightmare-upload')(Nightmare);
var co = require('co');
var sleep = require('co-sleep');

function* call() {
    let win = Nightmare({
        show: true,
        switches: {
            "proxy-server": "5.135.176.41:3123",
            'ignore-certificate-errors': true
        }
    });

    yield win.goto('https://www.leboncoin.fr/')
        .click('#header > section > section > aside > button')
        .wait('#popin-content > section > main > section.connexion-form.visible > form')
        .type('input[name="st_username"]', "alextuteur44@gmail.com")
        .type('input[name="st_passwd"]', "leboncoin123")
        .click('input[type="submit"]')
        .wait(".create a")
        .click(".create a");

    for (let i = 0; i < 50; i++) {
        console.log('Running ' + i);
        //win.goto("http://www2.leboncoin.fr/ai?ca=12_s")
        try {
            yield win.wait("#category")
                .select("#category", 36)
                .insert("#subject", "subject")
                .insert("#body", "ad text just for exmaple")
                .insert("#location_p", "")
                .insert("#location_p", "97017")
                .insert("#address", "")
                .insert("#phone", "+337743457865")
                .check("#phone_hidden")
                .upload('#image0', __dirname + "/original.jpg")
                .wait('#uploadPhoto-0[data-state="uploaded"]')
                .click("#newadSubmit")
                .wait("#accept_rule")
                .check("#accept_rule")
                .click("#lbc_submit")
                .wait(".confirm a:not(:first-child)")
                .click(".confirm a:not(:first-child)")
            let t = 1000;
            console.log(`Sleeping thread for ${t}s`);

            yield sleep(t);

            console.log(`Timeout is ${t}`)
        } catch (e) {
            console.log(e)
        }
        console.log('Finished ' + i);
    }

    win.end();
}

co(call()).then((m) => {
    console.log(`Thats ok ${m}`)
}).catch((err) => {
    console.log(err)
})
```
 hi, thanks for respond. Yeah i'm already using DEBUG flags. But can't get information about my issue.

It's every time in same page but the count of loops is different so once it may stop on 15 another time it will stop on 5.

And what about callback i meant the 

```
setTimeout(function () {
          tick.apply(self, args);
        }, _timeoutMs);
```

in **action.js** line : 405 .

I think this is the same issue #251 
I tried with .wait(milliseconds) and it's working, so my trouble may be fixed. But i think this we still have the issue, probably bug. 
  Tried it on multiple sites, different elements, the element is being acquired, but the return is an empty object.
 @rosshinkley correct, that is what i'm trying to do. However, i've also tried explicitly doing that, by Object.keys it, however in both cases the return is an empty array [object]. Unless you meant something completely different.
 anyone?
 @rosshinkley: sure:

`nightmare.viewport(800,600).goto(url)wait().evaluate(()=>document.getElementById('selector').getBoundingClientRect()).then(bounds=>console.log(bounds. .... )).catch(...)`

where the console.log can be specific or JSON.stringify, i've tested both. 
 @rosshinkley Thank you so much! this seems to work!
 Do you guys would happen to know in which unit these coordinates are returned? The bounding rectangle I'm getting is distorted vertically...  I have 4 divs, each 100px tall. I set the viewport height to 400px. The viewport should be the same height as the 3 divs combined, but the last div is cutoff. I noticed the amount cutoff is the same height of the window control bar at the top of the window. In other words, it would seem that `.viewport()` sets the height of the window not the height of the viewport.

![Screenshot](https://i.imgsafe.org/6698013ac1.png)
  I'm creating a custom action and I want to call another action in an 'evaluate_now' manner. Is there any way to do this?

e.g. I'd like to do something like this...

```
Nightmare.action('something', function (done) {
  this.screenshot(function(err, buffer) {
    ...
    done();
  }));
})
```

I appreciate any help you can give! 
  Hi all,
I would like to scrap multi-site with one restful api, I use express to implement it.
But I only triggered nightmare successfully in first time with my api,
when I call again my api I can't trigger nightmare any more :(

Have any idea?

another question, in below case, I need to instantiate new Nightmare object individually , so that I can scrap three different site, have any smarter way to achieve that?

bellow `getScrap` is my apiControler function with express `Router` GET callback:

```
import Nightmare from 'nightmare';
import cheerio from 'cheerio';

let nightmare = Nightmare({show: false});
let nightmare2 = Nightmare({show: false});
let nightmare3 = Nightmare({show: false});

const urlObject = {
  site1: 'http://www.site1.com',
  site2: 'http://www.site2.com',
  site3: 'http://www.site3.com'
};

export function getScrap(req, res){
  let result = {};

  result.site1 = {
    topList: []
  };
  result.site2 = {
    topList: []
  };
  result.site3 = {
    topList: []
  };

  const pro1 = Promise.resolve(
    nightmare
      .goto(urlObject.site1)
      .wait(200)
      .evaluate(() => {
        console.log('site1 into evaluate');
        return document.querySelector('.ninenine').innerHTML;
      })
      .end()
  )
  .then((html) => {
    let $ = cheerio.load(html);
    let tt = $('.horizontal-li');
    let sections = $(".section-board-title");

    sections.each((index, elm) => {
      if($(elm).text() === 'TopList'){
        $(elm).next('ul').find('li').each((index, elm_li) => {
          let title =$(elm_li).find('.cabinet-instruction').text();
          let price =$(elm_li).find('.cabinet-middle .price').text();
          let imgSrc = $(elm_li).find('.cabinet-img').attr('data-temp-src');
          if(title !== '' && price !==''){
            result.site1.topList.push({
              title,
              price,
              imgSrc
            });
          }
        });
      }
    });
  })
  .catch((err) => {
    console.log('site1 scrap err:', err);
    return res.status(400).send({reason:'site1 scrap err'});
  });

  const pro2 = Promise.resolve(
    nightmare2
      .goto(urlObject.site2)
      .wait(200)
      .evaluate(() => {
        return document.querySelector('.ninenine').innerHTML;
      })
      .end()
  )
  .then((html) => {
    let $ = cheerio.load(html);
    let tt = $('.horizontal-li');
    let sections = $(".section-board-title");

    sections.each((index, elm) => {
      if($(elm).text() === 'TopList'){
        $(elm).next('ul').find('li').each((index, elm_li) => {
          let title =$(elm_li).find('.cabinet-instruction').text();
          let price =$(elm_li).find('.cabinet-middle .price').text();
          let imgSrc = $(elm_li).find('.cabinet-img').attr('data-temp-src');
          if(title !== '' && price !==''){
            result.site2.topList.push({
              title,
              price,
              imgSrc
            });
          }
        });
      }
    });
  })
  .catch((err) => {
    console.log('site2 scrap err:', err);
    return res.status(400).send({reason:'site2 scrap err'});
  });

  const pro3 = Promise.resolve(
    nightmare3
      .goto(urlObject.site3)
      .wait(200)
      .evaluate(() => {
        return document.querySelector('#layout').innerHTML;
      })
      .end()
  )
  .then((html) => {
    let $ = cheerio.load(html);
    let sections = $(".pditem");

    sections.each((index, elm) => {

      let title = $(elm).find('.name').text();
      let price = $(elm).find('.price').find('span').eq(1).text();
      let imgSrc = ['www.site3.com',$(elm).find('li').eq(1).find('img').attr('src')].join('');

      result.site3.topList.push({
        title,
        price,
        imgSrc
      });
    });
  })
  .catch((err) => {
    console.log('site3 scrap err:', err);
    return res.status(400).send({reason:'site3 scrap err'});
  });


  Promise.all([pro1, pro2, pro3])
  .then(values => {
    res.json(result);
  })
  .catch((err) => {
    return res.status(500).send({reason:err.toString()});
  });
}


```
 Thanks a lot! it could work now and I will check nightmare-example. about cheerio, because I am familiar jquery, it is handy to me. It means the performance is better when I use css queries in `.evaluate()`?
  When I use .click('#submitLink') to submit a form, I would like to get the response headers...but I cannot find a way to do this with nightmare.  Am I missing something?  Any help is appreciated...thanks,

Brian
  I've got an automated test-suite for a few paypal actions, manually testing stuff works (ie put an URL in the browser, complete the transaction), but going through nightmare/elector child processes closes from to time (based on what A/B testing bucket my test had fallen in).

Logs for the build:
https://semaphoreci.com/makeomatic/ms-payments/branches/fix-updated-transport/builds/1

Code for the test that fail:
https://github.com/makeomatic/ms-payments/blob/fix/updated-transport/test/suites/sales.js#L24-L85

Gets to this point:
https://github.com/makeomatic/ms-payments/blob/fix/updated-transport/test/suites/sales.js#L65

Then electron closes right away. I'm not sure what I can do here and how to avoid such a case or at least fail not on a timeout
 @rosshinkley restored branch so you can see the code, logs are also available again on this same build
 I'll check it. Thanks for pointing out
 @AVVS Most crashes in electron in my experience are due to invalid selectors, run electron with the verbose flag, it should reveal invalid selectors (or whatever else is making it crash).
 @rosshinkley not yet, still playing with this. Please leave this issue opened and I'll let you know
 @inakianduaga : how to run electron with verbose flag ? @rosshinkley recent versions seem fine & thanks for the tips  Is it possible to re-inject (manually or otherwise) previously injected files when the electron app refreshes due to file change (via watcher). The goal being to inject test files every time I update them (without having to restart nightmare).
 Great, thanks for help.

For others, here's the MWP to append a file:

```
window.__nightmare = {};
__nightmare.ipc = require('electron').ipcRenderer;

const fs = require('fs');
const contents = fs.readFileSync( 'path/to/file', { encoding: 'utf8' });

document.addEventListener( 'DOMContentLoaded', () => {
    var script = document.createElement('script');
    script.innerHTML = contents;
    document.head.appendChild(script);
}, false);
```

But, you may want to copy/paste the default contents of [preload](https://github.com/segmentio/nightmare/blob/master/lib/preload.js), too, as stated.
  I did some research on switching to an iframe and found a package someone made for it. Unfortunately, this package is outdated.
I would like to switch to an iframe based on both the index and the name of the frame.
Thanks.
 @rosshinkley https://www.npmjs.com/package/nightmare-iframe
https://github.com/segmentio/nightmare/issues/203
  What about if I have the follow test case:

``` javascript
nightmare
  .goto('http://yahoo.com')
  .type('form[action*="/search"] [name=p]', 'github nightmare')
  .click('form[action*="/search"] [type=submit]')
  .wait('#main')
  .evaluate(function () {
    // send an ajax request and how can I wait to execute next step until the response is return?
  })
  .end()
```
 $.ajax has a setting named `async`, you can set up to "false". Maybe it works :dancer: 
 Thanks @icaromh for your information. Actually ajax is just an example, I actually want to know how to handle the async case, because with phantomjs, if you execute a javascript function on the page you open, there is an API called `window.callPhantom` to communicate with the phantom process outside, so the async handler won't be a problem. I just want to ask whether there are corresponding solution in nightmarejs
  If the page load fails, the error will be an object **wit** the following properties
  Hey - this project is awesome!

I am, however, having a bit of trouble with the .pdf functionality. I have set breakpoints in the callback for the internal pdf action function, and it does return an error - however that error is just a blank object - nothing in it. I've been trying multiple options and such to try to get this to work, or to at lest return an actionable error, but come up empty... Would really appreciate any input/advise you may have :smile: 

```
var tmpFileName = path.join(__dirname, reportId + '.pdf'),
    pdfOpts = {
        marginsType: 2, //minimum
        pageSize: 'letter',
        landscape: false
};

function renderReport(reportData, reportId) {
    return Nightmare(nightmareOpts)
        .goto(reportData.url + '&format=pdf', {
            'Authorization': 'Bearer ' + superSecretToken
        })
        // internal action - it works fine and has been tested  
        .forcePrintMedia()
        .wait(function() {
            //Client app sets this to true when data has been
            //  processed and report fully generated
            return window.isReadyToRumble;
        })
        .screenshot(tmpFileName.replace('.pdf', '.png')) // this works perfectly!
        //.pdf(tmpFileName, pdfOpts) // --> this gives a sad :(
        .end()
        .then(function() {
            //this is what gets passed to consumer in .then function
            return fs.createReadStream(tmpFileName.replace('.pdf', '.png'));
        });
}
```
 @rosshinkley Oh man - I totally overlooked the casing being off... that solved it - so sorry to have bugged you for that. Thanks a ton for your excellent help!!!
  Addresses issue #704, also removes "it.only" from unit tests (assuming that was unintentional).

I admit that I'm not sure what to write for a unit test here.  If you can give me some guidance, that would great.  Otherwise, existing tests pass, and a test run on my machine appears to use the TZ environment variable.  Thanks!
 Thanks!  I'll get that going.
 So what I'm finding, is that the "env" object doesn't get attached to the ChildProcess object in a way that node can access it (i.e. this.child.env, this.proc.env, or this.proc._handle.env).  Unless I'm missing something, it might be hidden under the covers in V8.  Do you have any other suggestions?
 That's great, thanks!  That makes a lot of sense, I had to learn a little how the process communication was working.  I really appreciate your help and patience.
 Whoops - my mistake.  Removed.  Thanks!
  I'm actually not 100% sure if this works, but would it be possible to allow environment variables to be set for the child process?  I would like to set TZ to change the timezone that electron is running on.  I can create a pull requests if needed.
  I have an issue with a web application we develop in our company: There are presented the first results of a search and to see more results you have to scroll down. As there are many indexes to choose, there is a second scrollbar. And I wanted Nightmare to scroll down to the bottom of the page until no more results are presented. But it was not possible to scroll down.
I tried to reproduce it with another website and I found a website where I can see the same behaviour.

I am running the latest version of NightmareJS on Windows 7, 64 bit

Here is my code: 

```
var Nightmare = require('nightmare');
var vo = require('vo');
var nightmare = Nightmare({
    show: false
});
var run = function * () {
    yield nightmare.goto('http://codepen.io/Yakudoo/pen/YXxmYR');

    var previousHeight, currentHeight = 0;
    while (previousHeight !== currentHeight) {
        yield nightmare.screenshot('screenBefore.png');
        previousHeight = currentHeight;
        var currentHeight = yield nightmare.evaluate(function () {
            return document.body.scrollHeight;
        });      
        yield nightmare
            .scrollTo(currentHeight, 0)
            .wait(3000);
        console.log('Current: ' + currentHeight);
        console.log('Previous: ' + previousHeight);
        yield nightmare.screenshot('screenAfter.png');
    }
    yield nightmare.end();
};
vo(run)(function (err) {
    console.dir(err);
    console.log('done');
});
```

And I also will attach the screenshots to show you that none of the scrollbars scrolled down: 

Before:
![screenbefore](https://cloud.githubusercontent.com/assets/10739344/16480387/e34f3f1a-3e9d-11e6-9c82-fd1f92a84c72.png)

After:
![screenafter](https://cloud.githubusercontent.com/assets/10739344/16480388/e35252e0-3e9d-11e6-9ede-1997d65ac5cd.png)

If anybody has found a solution for my problem, please let me know. 
Thank you
 @rosshinkley Thank you very much for your help.
  I'm trying to load 1 URL, then select all items from a select menu, to download multiple bank statements.

I'm following the guide [here](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) to loop using reduce.

partial code:

``` js
const statementOptions = [
  '1:accepted:1',
  '3:accepted:3',
  '4:accepted:4',
  ...
]

nightmare.goto('https://www.homesavings.com')
//login
.viewport(900, 800)
.wait('form[name="Login"]')
.insert('#userid', config.userid)
.insert('#password', config.password)
.click('#submit input')

// go to Online Statements page
.wait('a[data-app-code="Online Statements"]')
.goto('https://www.hslonline2.com/onlineserv/HB/OnlineStatements.cgi')
.evaluate(statementOptions => statementOptions, statementOptions)
.then(statementOptions => {
  return statementOptions.reduce(function(acc, option, index) {
    console.log(`reduce it: option=${option} index=${index}`)
    return acc.then(function(results) {
      return nightmare
        // wait for the account select box to load..
        .wait('select[name="acctRef"]')
        .select('select[name="acctRef"]', option)
        //.wait(1000)
        .click('input[type="submit"]')
        //.wait(2000)
        .wait('td a img')
        .click('td a')
        .download(`${downloadDir}/bankPDF_${index}`)
        .then(info => {
          console.log(`after download. info -> ${JSON.stringify(info, null, 2)}`)
          results.push(info)
          return results
        })
      })
   }, Promise.resolve([])).then(infos => infos)
})
```

After this runs, there is one file in the tmp folder, and it corresponds to the first select Option.

Also, the file name is bankPDF_0.

So the option and index are not iterating inside the nested nightmare section, though they are inside the reduce callback...

Here is some of the console output:

```
nightmare:actions .evaluate() fn on the page +3ms

reduce it: option=1:accepted:1 index=0
reduce it: option=3:accepted:3 index=1
reduce it: option=4:accepted:4 index=2

nightmare:actions .wait() for select[name="acctRef"] element +3ms
nightmare:actions .select() select[name="acctRef"] +4ms
nightmare:actions .click() on input[type="submit"] +2ms
nightmare:actions .wait() for td a img element +4ms
nightmare:actions .click() on td a +7s

after download. info => {
"filename": "ImageRequestor.pdf",
"mimetype": "application/pdf",
"receivedBytes": 172446,
"totalBytes": 172446,
"path": "/Users/cdock/Desktop/bank-statements/tmp/bankPDF_0",
"state": "completed"
}

nightmare:actions .wait() for select[name="acctRef"] element +2s
nightmare:actions .select() select[name="acctRef"] +1ms
nightmare:actions .click() on input[type="submit"] +1ms
nightmare:actions .wait() for td a img element +7s
nightmare:actions .click() on td a +2ms

after download. info => {
"filename": "ImageRequestor.pdf",
"mimetype": "application/pdf",
"receivedBytes": 172446,
"totalBytes": 172446,
"path": "/Users/cdock/Desktop/bank-statements/tmp/bankPDF_0",
"state": "completed"
}

nightmare:actions .wait() for select[name="acctRef"] element +1s
nightmare:actions .select() select[name="acctRef"] +1ms
nightmare:actions .click() on input[type="submit"] +1ms
nightmare:actions .wait() for td a img element +6s
nightmare:actions .click() on td a +2ms

after download. info => {
"filename": "ImageRequestor.pdf",
"mimetype": "application/pdf",
"receivedBytes": 172446,
"totalBytes": 172446,
"path": "/Users/cdock/Desktop/bank-statements/tmp/bankPDF_0",
"state": "completed"
}
```

What I'm doing wrong to loop using reduce / promises?
 It was, thanks!
  Can I change the screen resolution in nightmarejs?
For example, how it works in Casperjs:

```
var casper = require("casper").create({
    onPageInitialized: function (page) {
        page.evaluate(function () {
            window.screen = {
                width: 1920,
                height: 1080
            };
        });
    }
});
```

Already more than 4 hours trying to figure out. Thank you!
  Hey,

I'm using nightmare to build scrapers,
till now it went pretty well with fast response website - however I've encountered a very slow response website which give me timeouts on wait for elements (it's set to 30 seconds).

I know that I can change the wait timeout, however I'm trying to figure out a better way to solve it as a static timeout isn't the great solution when it fluctuating.

Thanks !
  LGTM
 LGTM
  Hi, 

For now, it looks like the nightmare is hanged if the http authenticate with wrong password and need to wait navigation timeout. 

Thanks,
Tim 
  I was trying out rosshinkley's solution in [#328](https://github.com/segmentio/nightmare/issues/328#issuecomment-159311982) for taking full screenshots, that is, where the height adjusts to the measured dimensions of the `body`-element. As a test, I ran it against BBC.com, which in console returns:

```
{ height: 7119, width: 997 }
```

But the returned screenshot is 987px wide and 1025px high. I saw in some other issues that this may have to do with the system, so for reference this was run on Windows 10 64-bit 1920x1080 resolution (no HiDPI or other peculiarity, plain old laptop with an Nvidia card).

Why would the dimensions of the output image not match the recorded dimensions?

For reference, the script ran:

```
var Nightmare = require('nightmare'),
    vo = require('vo');

function * run() {
    var nightmare = new Nightmare({
        show: false,
        width: 1024,
        height: 768
    });
    var dimensions = yield nightmare.goto('http://bbc.com')
        .wait('body')
        .evaluate(function() {
            var body = document.querySelector('body');
            return { 
                height: body.scrollHeight,
                width: body.scrollWidth
            }
        });

    console.dir(dimensions);
    yield nightmare.viewport(dimensions.width, dimensions.height)
        .wait(1000)
        .screenshot(require('path')
            .join(__dirname, 'bbc.png'));

    yield nightmare.end();
}   

vo(run)(function() {
    console.log('done');
});
```
 Seemingly not, as the resulting screenshot is limited to a "standard" viewport, not affected by scaling. There is no zooming or proportionally dubious screenshots, rather just the absence of a variable height. The outcome width is as expected, but the outcome height is 1025px where it should be 7119px.
 +1 I have the same issue too (with almost equal code) on windows 7 x64.
But I getting the page size with following method:

``` javascript
Nightmare.action('dimensions', function (done) {
  this.evaluate_now(function() {
    var body = document.body,
        html = document.documentElement;

    var height = Math.round(Math.max(
      body.scrollHeight,
      body.offsetHeight,
      html.clientHeight,
      html.scrollHeight,
      html.offsetHeight
    ));

    var width = Math.round(Math.max(
      body.scrollWidth,
      body.offsetWidth,
      html.clientWidth,
      html.scrollWidth,
      html.offsetWidth
    ));

    return {width, height};
  }, done)
});
```
 Running the same script as above, but with `yield nightmare.viewport(dimensions.width, 4000)`, the resulting image is 987x1025.
 With `yield nightmare.viewport(dimensions.width, 4000)` the output image is 1914x1025, and the console output `{ height: 7469, width: 997 }`. So seems like a texture limit, not quite sure how to port that gist to Windows, but it would be very handy to be able to take unconstrained screenshots.
 Not sure which details matter most, but: Windows 10 64-bit, DirectX 12 on Nvidia GeForce GT 540M (driver v353.62). Resolution is 1920x1080, and since the graphics are integrated (Intel HD Graphics 3000) its current resolution is reported by Speccy as 1536x864 pixels.
 I found electron option code.
https://github.com/electron/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions

Try this code, 
`var nightmare = new Nightmare({
maxHeight:2000,
maxWidth:2000
    });`
 var nightmare = new Nightmare({ maxHeight:2000, maxWidth:2000 }); **almost** fixed it for me. It's only getting 95% of the screenshot now even with max-height being extremely large and the actually screenshot being nowhere near the max height. For some reason the viewport still does not expand all the way to the height specified. @jimmaay/@OleVik, can you try 
var nightmare = new Nightmare({ minHeight:7119, minWidth:1000 });

It worked for me. @BhavinPatel04 It is indeed much closer to the expected output than before. Using Nightmare v2.9.1, running the same script as before but with

```
    var nightmare = new Nightmare({
        show: false,
        minWidth: 1000,
        width: 1024,
        minHeight: 7119,
        height: 768
    });
```

The returned image is 1914px wide and 7060px high. Apart from the small error margins in dimension, which presumably could be offset with higher `min`-properties, there is a fairly large discrepancy with set `width` and `height`. When I add in `maxHeight:2000` and `maxWidth:2000`, as suggested by @mkmkku, the returned image is 1990px wide and 7060px high.

I should add, the output of `console.dir(dimensions);` is `{ height: 7144, width: 993 }`, so there is also a discrepancy between how big Nightmare measures the target to be, and what the output is, at least with the setup from the initial post updated with the above. Yeah I ended up changing maxHeight to 16384, anything higher will cause #906  I use `xvfb-maybe` to run electron in Docker but since 2.5.1, it seems to crash with no further indication.

`nightmare@2.5.1`:

```
...
  nightmare queueing action "wait" +1ms
  nightmare queueing action "viewport" +0ms
  nightmare queueing action "screenshot" +0ms
  nightmare queueing action "viewport" +1ms
  nightmare queueing action "screenshot" +0ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +1ms
  electron:stderr Xlib:  extension "RANDR" missing on display ":99". +120ms
  electron:stderr Fontconfig warning: ignoring C.UTF-8: not a valid language tag +222ms
  nightmare electron child process exited with code null: undefined +21ms
```

`nightmare@2.5.2`:

```
...
  nightmare queueing action "wait" +1ms
  nightmare queueing action "viewport" +0ms
  nightmare queueing action "screenshot" +0ms
  nightmare queueing action "viewport" +1ms
  nightmare queueing action "screenshot" +0ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +1ms
  electron:stderr Xlib:  extension "RANDR" missing on display ":99". +100ms
  electron:stderr Fontconfig warning: ignoring C.UTF-8: not a valid language tag +200ms
  nightmare electron child process exited with code null: undefined +22ms
  nightmare electron child process not started yet, skipping kill. +1ms
```

Reverting to 2.5.0 solves the problem.
 What OS? We have seen the same issue on Ubuntu 16.04, it has nothing to do with nightmare but is a problem in electron 1.x.x, which nightmare upgraded to in `2.5.1`
 `nightmare electron child process exited with code null: undefined +21ms`

I saw this as well on Ubuntu 16.04, it seems like the electron binary is exiting with a SIGSEGV right away. Could you try just starting electron (`./node_modules/electron-prebuilt/dist/electron`) and post the output?
 It uses an old Ubuntu:

``` bash
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 14.04.4 LTS
Release:    14.04
Codename:   trusty
```

Sadly when I run the following, nothing gets returned:

``` bash
$ DEBUG=* ./node_modules/electron-prebuilt/dist/electron
```
 There is an issue in electron repo that looks related https://github.com/electron/electron/issues/6186
 This is fixed with electron `1.2.5` and `electron-prebuilt` is released.
So run `npm install` again and it should work ðŸ˜„ 
close? @oncletom
 Please bump the dependency in Nightmare before closing
 I confirm the problem is solved thanks the new release of electron.

Thank you all for your help :-)
 I am getting this error too.
Nightmare: 2.5.3
Electron prebuilt: 1.2.8
Ubuntu 14.04 in docker container
`electron:stderr Xlib:  extension "RANDR" missing on display ":1".`
  It seems like evaluate can sometimes hang and never resolve the promise if the page is navigating at the same time that the evaluation is happening.

In our application we are constantly running a polling function that will check in what state we are in, on a page that is reloading from time to time to show new data. The code looks something like this:

``` js
const waitForState = co.wrap(function * (browser) {
  for (let tries = 720; tries > 0; tries--) {
    debug('Queing read of state')
    const state = yield browser.evalutate(readState)
    debug(`Got state "${state}")

    // (yield sleep or return value)
  }

  // (throw timeout)
})
```

In some cases the function simply hangs, this is an example of the output:

``` text
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
linusu:test Queueing read of state +256ms
nightmare:actions .evaluate() fn on the page +0ms
linusu:test Got state "null" +18ms
nightmare:log did-get-response-details +210ms ...
nightmare:log did-start-loading +16ms ...
linusu:test Queueing read of state +24ms
nightmare:actions .evaluate() fn on the page +5ms
linusu:test Got state "null" +2ms
nightmare:log did-get-redirect-request +44ms ...
nightmare:log will-navigate +0ms ...
nightmare:log did-fail-provisional-load +5ms ...
nightmare:log did-fail-load +0ms ...
nightmare:log page-favicon-updated +0ms ...
nightmare:log did-get-response-details +111ms ...
linusu:test Queueing read of state +90ms
nightmare:actions .evaluate() fn on the page +1ms
nightmare:log did-get-response-details +21ms ...
nightmare:log did-get-response-details +1ms ...
nightmare:log did-get-response-details +4ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +2ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +1ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +26ms ...
nightmare:log did-get-response-details +41ms ...
nightmare:log did-get-response-details +1ms ...
nightmare:log did-get-response-details +1ms ...
nightmare:log did-get-response-details +1ms ...
nightmare:log did-get-response-details +19ms ...
nightmare:log did-get-response-details +25ms ...
nightmare:log dom-ready +0ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-frame-finish-load +12ms ...
nightmare:log did-finish-load +0ms ...
nightmare:log did-get-response-details +347ms ...
nightmare:log did-get-response-details +109ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +3ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +7ms ...
nightmare:log dom-ready +6ms ...
nightmare:log did-get-response-details +30ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-get-response-details +2ms ...
nightmare:log did-get-response-details +4ms ...
nightmare:log did-get-response-details +2ms ...
nightmare:log did-get-response-details +0ms ...
nightmare:log did-frame-finish-load +0ms ...
nightmare:log did-finish-load +0ms ...
nightmare:log page-favicon-updated +1ms ...
nightmare:log did-stop-loading +0ms ...
```

It's a bit spammy, sorry about that, but as you can see it prints my first debug statement (`linusu:test Queueing read of login status +90ms`) and then nightmare runs the action (`nightmare:actions .evaluate() fn on the page +1ms`), but then it never returns to me so that my second debug statement can run.

I'd be happy to provide any more information that might be relevant, and I'll try to put together a test case.
 Sorry for the radio silence, I never managed to solve it but I worked around it by not running evaluate in a loop :)

I have still to put together a test case, time has been tight as always...
 I just resolved race condition in `navit`. Assuming that the electron wrapper is written the same way, I decided to write here in case you're having the similar issue.

The problem was: during initial page load, `webContents.executeJavaScript` never actually executes (it never returns a callback if you're using `executeJavaScript(code, callback)` interface, the same I imagine is true for events).

So you'd need to wait until the page actually loads. I suggest checking `webContents.isWaitingForResponse` and if it's true, delay javascript evaluation until `did-stop-loading` event.

Something like this should work (I'm not entirely sure, so please test it out):

``` diff
--- a/lib/runner.js
+++ b/lib/runner.js
@@ -335,7 +335,14 @@ app.on('ready', function() {
     renderer.once('error', error);
     renderer.on('log', log);

-    win.webContents.executeJavaScript(src);
+    if (win.webContents.isWaitingForResponse()) {
+      win.webContents.once('did-stop-loading', () => {
+        // isWaitingForResponse() flips to false at this point
+        win.webContents.executeJavaScript(src);
+      });
+    } else {
+      win.webContents.executeJavaScript(src);
+    }
   });

   /**
```

Here is a the commit in `navit`, so you can try to salvage tests and such: https://github.com/nodeca/navit/commit/6525dc7bf414894324d2ca8e99f076c24781f06f
 +1 . 
Evaluate sometimes files if page is navigating.
Workaround was to ensure somehow that page is not navigating (eg. wait on some fix selector)
 Experiencing this mostly on production (free/slow Heroku dyno). This definitely feels like a race condition.

My workaround was to wrap every `evaluate` call (or function like `wait` which can use evaluate internally) and perform `nightmare.wait('html')` before attempting the _real_ wait/evaluate call.

**EDIT**: Turns out this workaround does improve the success rate but not to 100%. Still getting hung up on evaluate occasionally.  Hello! Since new versions of `electron` (in our case `electron-prebuilt`) is released pretty often, have you thought about using [greenkeeper](https://greenkeeper.io/)? This would save some manual-work time and make sure nightmare is updated with the latest `electron`.
  I already called .end() function somehow there is a electron still running in the task.
Anyone has a great idea how can i solve this issue? This issue bothering almost 1 month I can't find any solution.

Thanks
 Basically, what I did make a lot of instances of nightmare until the nightmare stuck up when I stopped the process the electron still running in background even though I already stopped the process.
 @AaronTrazona or @rosshinkley, it has been about a month since there was activity on this thread. ny further headway made on this? On my end, I have electron processes hanging around when my app is idle and nightmare.end() has been called. 

Was any route cause or solution found?
 Nightmare is killing the main process it launches via child_process.spawn, and intermittently renderer processes are being orphaned after the kill()

I have a script that runs periodically purging abandoned electron.exe processes as I have a long running service based app using nightmare.

It is fairly easily re-produceable.  I've had it happen even just launch electron.exe manually and then killing the main process.

It may be worth having end() send a message to the spawned Electron process asking it to kill itself via app.quit() to see if that makes a difference.

If I get time next week I'll create a simple test app that can reproduce it.
 @TimNZ that makes a whole lot of sense. I've experienced this on MacOSX as well as on linux (specifically running in a docker instance so the flavour of linux is the one that the official "node:6.2.2" is based on).

Hopefully there is a solution that can be used cross platform. I am attempting to use nightmare in a production environment but can't until this problem is solved.
 Ross, details here: https://github.com/electron/electron/issues/6120

It's orphaned Renderer/Helper processes, not Main.

As I said I don't think it is a Nightmare issue, and at this stage think it may have only been happening on Windows.

I haven't investigated further either since about Electron 1.2.3 since the app I deployed runs just fine in conjunction with an hourly script to kill orphaned renderer processes.

I'll try to do a mini app next week to replicate, and see if it getting the runner process to do app.quit() makes any difference.
 In my testing as well, I've noticed that if Nightmare is run in a service/daemon or HTTP server, Electron instances don't get killed by `nightmare.end()` alone. One workaround that works, is to disconnect & kill the child process explicitly (see code below):

``` node
.then(function(result) {
  // process the result
})
.catch(function(err) {
  // handle any error
})
.then(_ => {
  // finally cleanup
  nightmare.end();
  // kill the Electron process explicitly to ensure no orphan child processes
  nightmare.proc.disconnect();
  nightmare.proc.kill();
  nightmare.ended = true;
  nightmare = null;
});
```

It seems to me that this issue is to do with Nightmare. In a service/daemon model, the final process termination of Nightmare doesn't occur properly. When the main service/daemon is terminated, a bunch of Nightmare log messages (example below) are dumped, hinting that previous processes didn't end until now.

`nightmare electron child process not started yet, skipping kill. +1ms`

By the way, I tested on Ubuntu 14.04.2 LTS running Nodejs 6.3.0, Electron 1.3.2, Nightmare 2.6.1, xvfb.
 Do you have example app to be tested the #757 maybe have fixed the issue.
 This issue was not fixed by #757 .
 @rafalneves Can you give more info your comment is not really constructive what did you test what is not fixed?
 I just replied to the previous comment. I tried to run the latest code (that includes #757 commited code) and I run into same problem (electron instances are not destroyed). Right now I'm using the fix proposed by @voidmonk that solved the issue.

I was using debian 8. Was an sporadic need, so I didn't test it anywhere else.
If I can assist you more, let me know.
 I have figured out this bug in my code, but do not know exactly why. 
Electron instances is not destroyed in this example:
```javascript
function get(url, options) {
  return new Promise((resolve, reject) => {
    new Nightmare({
      show: false,
      executionTimeout: 15000,
      gotoTimeout: 10000
    })
      .goto(url)
      .pdf(null, options, function (err, buffer) {
        if (err) {
          reject(err);
          return;
        }
        resolve(buffer);
        return true;
      })
      .end();
  });
}
```

Here is working example:
```javascript
function get(url, options) {
  const nightmare = new Nightmare({
    show: false,
    executionTimeout: 15000,
    gotoTimeout: 10000
  });

  return nightmare
    .goto(url)
    .pdf(null, options)
    .end();
}
```
 @itomas i'm unable to reproduce the issue

>  Electron instances is not destroyed 

after executing the script you provided. Electron is closed correctly only thing I had to do to make it run was to add `.then()` otherwise the script is not working try running this on your machine and let me know if you still experiencing the same issue.

```javascript
var Nightmare = require('nightmare');

function get(url, options) {
  const nightmare = new Nightmare({
    show: false,
    executionTimeout: 15000,
    gotoTimeout: 10000
  });

  return nightmare
    .goto(url)
    .pdf('print.pdf', options)
    .end()
    // i had to add this to get it working
    //-----------------------------------------------------
    .then(function (result) {})
    .catch(function (error) { console.error(error); });
}

get('http://yahoo.com')
```

`os` Microsoft Windows [Version 6.3.9600] - Windows 8.1
`node` 6.9.1
`electron` 1.3.2
`nightmare`  2.9.0

> Note that if you're using promises, `.then()` must be called after `.end()`
[check the above here](https://github.com/segmentio/nightmare#end)
  Add useful information found in issue #665 for devs looking for proxy info.
 I'm not married to the changes in the first two commits so if you don't like them, I'm happy to drop them.
 Sure thing. I intended that to reduce the duplication but it's minimal and might make things easier on the reader. One sec and I'll have an update.
 @rosshinkley updated, thanks for the review
  Hi all,
im new in using nightmarejs. and i just install the node & nightmare just today
im assume the version are pretty new
i have an automation on do some specific action within some website.
the problem is, when i do click the button to login to that website. naturally, it will popup a new window.

in program( java script), when i do command click("submit1"), the browser are now closed, the popup window doesnt show up and also seems my program crash(exit). so i cant continue that automation
![screenshot from 2016-06-17 10 01 32](https://cloud.githubusercontent.com/assets/5646599/16139525/8769e5b8-3472-11e6-9368-6c4966476b6d.png)

is there any idea regarding that issue.
   I need this too. Not because I need to directly interact with a flash app, but because the web page I load need flash to work.
(e.g load spotify with nightmare)
 Sorry for the delay ! It's working perfectly, thanks ! :)
  When nighmare instance have not used it have no process attached and process property. As the result process termination handler as the event reaction trying to detach process using not existing attribute what is producing slightly misleading error.

The least impact fix seems to become aware that process attribute does not exists.

/Users/justaman/projects/ifetch/node_modules/nightmare/lib/nightmare.js:178
  if (instance.proc.connected) {
                   ^

TypeError: Cannot read property 'connected' of undefined
    at endInstance (/Users/justaman/projects/ifetch/node_modules/nightmare/lib/nightmare.js:178:20)
    at emitOne (events.js:96:13)
    at process.emit (events.js:188:7)
 Thanks @mrjj but I think we still doesn't have a _workaround_ on this, right?
 @gjmveloso, please, see my answer in related bug #680
  OS X 10.11.5
Node 6.2.0
Electron 1.2.2

Got an issue where running the main example the Electron process will sit at 99% for ages and the example may or may not eventually complete.

Runs fine in a Windows 2008 VM hosted on MS Azure

What's the best way to debug this?
 Feels like an Electron issue.  No issue in other Win 2008/Win 7 VM environments.
  Hi,

I've started playing around with Nightmare on **Windows** and I'm receiving the _TypeError: Cannot read property 'connected' of undefined_ error every time I try to run my basic code:

``` javascript
var config = require("./settings.json");
var Nightmare = require("nightmare");
var browser = Nightmare({
    "waitTimeout": config.timeout * 1000
});
browser.goto(config.url);
if (browser.title() === config.loginTitle && browser.exists("input.login")) {
    doLogin(config.expectedTitle);
} else if (browser.title() === config.loginTitle) {
    console.log("Application Check Passed \u2713");       
} else {
    console.error("Unknown page was open: ${browser.title()}");
}
browser.end();
```

> TypeError: Cannot read property 'connected' of undefined
>     at endInstance (C:\Code\test\node_modules\nightmare\lib\nightmare.js:178:20)
>     at emitOne (events.js:96:13)
>     at process.emit (events.js:188:7)
> [Finished in 0.256s]

Thoughts?

_Nightmare Version:_ 2.5.1
_NodeJS Version:_ 6.2.1
_Windows 7 x64_
 The root cause is that there were no process created, because you didn't finalise your request;
This code will work:

```
var config = require("./settings.json");
var Nightmare = require("nightmare");
var browser = Nightmare({
    "waitTimeout": config.timeout * 1000
});

browser.goto(config.url);

if (browser.title() === config.loginTitle && browser.exists("input.login")) {
    doLogin(config.expectedTitle);
} else if (browser.title() === config.loginTitle) {
    console.log("Application Check Passed \u2713");
} else {
    console.error("Unknown page was open: ${browser.title()}");
}
// -------- changed ---------
browser.end().then(
  function (val) {
    console.log('Success: ', val)
  },
  function (val) {
    console.error('Failure:', val)
  }
);
```

Have a nice day!
 Thanks for your help @mrjj and @rosshinkley - I'd completed forgot about the _asynchronous_ thing.

But I think I'm still doing something wrong :cry: 

Here is my complete code:

``` javascript
var config = require("./settings.json");
var Nightmare = require("nightmare");
var browser = Nightmare({
    "show": true,
    "waitTimeout": config.timeout * 1000
});

browser
    .goto(config.app.url)
    .evaluate(() => {
        return browser.title() === config.login.title;
    })
    .exists("input#submit")
    .then(() => console.log("Login Detected, trying to login using ${config.login.user}"))
    .then(doLogin, performCheck)
    .end()
    .then(result => {
        console.log(result);
        console.log("Application Check Passed \u2713");
    })
    .catch(err => {
        console.error(err);
    });

var doLogin = function() {
    return browser
        .type("input#user", config.app.user)
        .type("input#pwd", config.app.pwd)
        .click("input#input")
        .wait(() => {
            browser.title() === config.app.title;
        })
        .wait(() => {
            return !browser.visible(".loading");
        });
};

var performCheck = function() {
    return browser
        .evaluate(() => {
            return browser.title() === config.app.title;
        })
        .then(() => {
            console.warn("App detected, Login was skipped");
        }, () => {
            console.error("Unknown page was open: ${browser.title()}");
        })
        .visible("div#main");
};
```

I'm receiving the following error message:

> TypeError: browser.goto(...).title(...).evaluate(...).exists(...).then(...).then
> (...).end is not a function
>     at Object.<anonymous> (C:\Code\test\app.js:16:6)
>     at Module._compile (module.js:541:32)
>     at Object.Module._extensions..js (module.js:550:10)
>     at Module.load (module.js:458:32)
>     at tryModuleLoad (module.js:417:12)
>     at Function.Module._load (module.js:409:3)
>     at Function.Module.runMain (module.js:575:10)
>     at startup (node.js:160:18)
>     at node.js:456:3

**Line 16 is on _end()_ call**

Thanks again, really appreciated your help
  I want to download CSV with Nightmare and [Nightmare-download-manager](https://github.com/rosshinkley/nightmare-download-manager).

Target site generated new window when use '.click' for download.
`<input confirm="Download CSV. \n Is it ok ?" onclick="window.open('/customers/apply/inbox.csv?', '_blank');" style="float:right;margin-right:16px;_margin-right:8px;" type="button" value="Download CSV" />`
`.click('input[value=Download CSV]')`
Electron open new window but doesn't start download.
New windows's title is '_blank'.

How to rewrite '_blank' to '_self' or download or disable '_blank'

Thanks.
 Had the same issue, overwriting the `onclick` or `target` solved it for me.  `nightmare.cookies.clear()` only clears cookies for the current website.

It'd be handy to be able to clear all cookies, so you know you start with a fresh start no matter what tests you ran with the electron browser before.

My precise use case is I want to clear all cookies after payment, and the payment processor & store both have different domains obviously so I have to make a bit of extra code to really clear all cookies.

In any case, it's natural to assume being able to control the electron browser like that.
 ```
const uuid = require('uuid')
const Nightmare = require('nightmare')

const nightmare = Nightmare({ webPreferences: { partition: uuid.v4() })

```

If you use a different partition each time you'll be sure that you get a "clean" browser, as the default is a persistent partition.
  Sample code:

``` js
const Nightmare = require('nightmare');
const nightmare = Nightmare({
  show: true
});

nightmare
  .goto("http://bash.org/?random")
  .then(() => {}); /* Why do I need to do .then() to make things show? */

setInterval(() => {
    nightmare.goto("http://bash.org/?random").then(() => {
        console.log("Went to page");
    });
}, 5000);
```

Expected behavior: the page refreshes every 5000 ms.
Observed behavior: the page doesn't refresh (but the logged messages still show).

I'm aware that `refresh()` would work in this instance but sometimes it's not known whether the page we want to get the latest data from is already the current page. And such information is hard to get as there's no easy way to directly get the current url.

Imo, there should be one of the following:
- Doc of `goto` specifies that nothing happens if the url given is already the current page
- Behavior of `goto` changed to correctly reload the page if url is the same
- Possibly add an option to the `goto` command.to specify the behavior
 A workaround to achieve the desired behavior at the moment is doing `url = `${baseUrl}#${counter++}`` (as the correct way to achieve the behavior is much too verbose).
 Extracting the information is straightforward, but chaining is not.

Instead of having:

```
nightmare
   .goto(page)
   .doStuff(); //<- can be .type, .then or whatever
```

If not using the hack (page + "#..."), the code becomes:

```
nightmare
    .evaluate( () => window.location.toString() )
    .then((location) => {
        if (location == page) {
            return nightmare.refresh().then(); 
       } else {
           return nightmare.goto(page).then();
       }
    }, (error) => {
        /* In case there's no page to do evaluate() in */
       return nightmare.goto(page).then();
    }).then ( () => {
       /* Unfortunately since the previous .then call, this is a promise and the only
         way to do stuff like .type() is inside the body of another then() */
       return nightmare.doStuff();
   })
```

And objectively speaking, I don't see why the current behavior is like it is. I used `zombiejs` before which admittedly is not a reference, but looking at phantomjs' `.open()` they too seem to load the page anyway. Without the programmer asking _not to reload if url is same_, it seems strange to me.

The [code seems pretty old](https://github.com/segmentio/nightmare/blob/1b11714183cff93fe96cdbc03db1b500f4bc5cb8/lib/runner.js#L62-L64) and was [added amongst other major changes](https://github.com/segmentio/nightmare/commit/1b11714183cff93fe96cdbc03db1b500f4bc5cb8).

There is no specific commit or reason why.
  Just read about chrome is actively implementing the headless mode, do you have plan to incorporate it into nightmare?

https://bugs.chromium.org/p/chromium/issues/detail?id=546953#c54
  I am new to nightmare and electron's api. I want to access the underlying electron browser to show a image that i scrape using nightmare. Can someone show me an example?
 No, I am trying to get the source of an image and use the source to display
an image in a new electron window.

On Wed, Jun 8, 2016 at 5:33 AM, Ross Hinkley notifications@github.com
wrote:

> I'm a little confused by your question, and would like to clarify - are
> you trying to save an image from a page?
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/674#issuecomment-224450336,
> or mute the thread
> https://github.com/notifications/unsubscribe/ALcELbh62O3FlcxHIJRAdjxbSg0YpxD1ks5qJgbQgaJpZM4Iu8Hq
> .
 @rosshinkley I just want to open an additional electron window to display the scraped image.
  Hi guys!
How about "Referer" header?

Usage:

``` javascript
const url = 'https://www.whatismybrowser.com/detect/what-http-headers-is-my-browser-sending';
var nightmare = new Nightmare();
yield nightmare
  .viewport(1920, 1080)
  .goto(url, {
    'Referer': 'http://my-referer.tld/'
  })
  .wait('body')
  .screenshot(path.join(__dirname, 'referer.png'))
  .end()
;
```

Result:
![headers](https://habrastorage.org/files/4ca/d21/34a/4cad2134ae524cc6b1a581ed9eeef0c2.png)
   as the subject, i may cancel the automation when it is typing and kill the process
  I am trying to run the example code:

```
var Nightmare = require('nightmare');
new Nightmare({show : true})  
  .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit')
    .run(function (err, nightmare) {
      if (err) return console.log(err);
      console.log('Done!');
    });
```

Its returning an error `Cannot read property 'blur' of null` in the console. 
Any solutions?
 Thanks. I had encountered it in my code too when there is no selector
found.
On Jun 8, 2016 5:09 AM, "Ross Hinkley" notifications@github.com wrote:

> In versions prior to 2.5.0, this (cryptic) error generally meant that one
> of your selectors was not finding the specified element. I think Yahoo runs
> some form of A/B or has different page characteristics based on the
> requester. This problem has cropped up before (#116
> https://github.com/segmentio/nightmare/issues/116, #490
> https://github.com/segmentio/nightmare/issues/490, and I think there
> were some others). The Readme version of the example was patched in 2.4.0,
> the ru nnable e xample
> https://github.com/segmentio/nightmare/blob/2.5.0/example.js in 2.5.0.
> 
> My first suggestion would be to update your example to the 2.5.0 version
> and try running it again.
> 
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/669#issuecomment-224446331,
> or mute the thread
> https://github.com/notifications/unsubscribe/ALcELemYikc_Fm8QHeQ59rEbk5JpUK0qks5qJgEjgaJpZM4IqMpX
> .
 I am running the example code on c9,io, a virtual machine for ubuntu. 
The example.js does not return anything. Could someone review what the problem here?
I am a total beginner for node.js and c9 so the issue might lie in some very simple process. 
![qq 20161129141240](https://cloud.githubusercontent.com/assets/8443821/20698718/f11e9c40-b63d-11e6-96ad-dcbb443af18f.jpg)
![qq 20161129141223](https://cloud.githubusercontent.com/assets/8443821/20698717/f11de214-b63d-11e6-8b9a-5c378f664144.jpg)
![qq 20161129141152](https://cloud.githubusercontent.com/assets/8443821/20698719/f1236202-b63d-11e6-82fd-ea032d08df4d.jpg)

  Hi,

How does one skip all the previous tests when writing a new test? Currently I have about 20 nightmare tests that take about 2000ms each. Whenever I save my file they have to rerun from the beginning. Is there some sort of flag or something that will skip the previous tests and only run the new one? Something of that sort. 

Thanks
 Thank you, I will try it out. 
 Sorry for the late response. The issue has been resolved once we upgraded some npm deps. Thanks for the reply/support!
  ```
<form ...>
  <input type="hidden" value="12">
  <button type="submit">...</button>
</form>
<form ...>
  <input type="hidden" value="13">
  <button type="submit">...</button>
</form>
```

nightmare.exist('input[type="hidden"][value="12"]').then(exists => {
  // i want to click the submit button.
})
 solved by:

```
let query = input[type="hidden"][value="12"]
nightmare.evaluate(query => {
  let el = document.querySelector(query).parentElement.querySelector('button')
  let event = document.createEvent('MouseEvent')
  event.initEvent('click', true, false)
  el.dispatchEvent(event);
  return el.innerHTML
}, query).run((err, nightmare) => {
  console.log('run here', nightmare)
})
```

nightmare is awesome ^^. But need more documents.
  Is there a code example where the proxy, and proxyAuth options are working. I spent a few hours trying to get it work, but could not. I tried maybe 100 different variations of the syntax as the documentation is not really clear about this, and about half did not return any errors, the remaining code ran fine, but the IP did not change to the one set in the proxy settings. After every attempt I checked the log files on the server, to confirm if requests came in and if the IP was changed. 

Here is where I was left (I've replaced my test domain with google.com below):

```
var Nightmare = require('nightmare');

var testbot = new Nightmare({
    switches: {
    proxy: 'http://1.proxy.com:80', 
    proxyType: 'http', 
    proxyAuth : 'user:password'
}})
testbot
  .goto('http://google.com')
  .wait()
  .run(function(err, nightmare) {
   if (err) return console.log(err);
  console.log('Done!');
  process.exit()
  });
```
 I donâ€™t think any of those are actually valid switches (you can see the whole list at http://peter.sh/experiments/chromium-command-line-switches). I think the switch you want is `proxy-server`:

``` js
var Nightmare = require('nightmare');

var testbot = new Nightmare({
  switches: {
    'proxy-server': 'http://1.proxy.com:80'
  }
});
```

I donâ€™t know if you can set the auth info in the URL (e.g. `http://user:pass@1.proxy.com:80`) or if you would need to use the `authentication()` action, e.g:

``` js
Nightmare({
  switches: { 'proxy-server': 'http://1.proxy.com:80' }
})
.authentication('user', 'password')
.goto('http://google.com')
.doSomething()
.run(function (error, result) { ... });
```

Alternatively, you could write a plugin that uses the `setProxy` method on Electronâ€™s `session` object, as documented here: http://electron.atom.io/docs/api/session/#sessetproxyconfig-callback
 Thank you. 

I had tried that as well. I tried again and neither of the examples you change anything i.e. I could change the switch (proxy-server) to lkjlkj-weioruweoriu and the code still runs the rest of the program. It seems to me that for some reason the switches part is totally ignored at the moment, because it can be changed to anything without any effect on the rest of code. Thank you for the plugin tip, though it would be great if this could work as in the examples you had provided given how amazing Nightmare otherwise is! 
 @rosshinkley : you need to use authentication() with setting 'proxy-server' (with out user + password)
 @xmen4u can you clarify, is this what should work, or something that you have actually effectively worked with? In case it's the latter, can you please provide exact code example and I will test it also.

I got the proxy authentication to work on Electron, but would prefer to use Nightmare if possible. At the moment, given that there are no specific detailed answers to this issue, unless someone provides a working code example, my suggestion is to assume that proxy authentication does not work. 
 This works just fine for me:

``` js
Nightmare({
  switches: {
    'proxy-server': '192.92.205.132:80'
  }
})
  .goto('http://whatismyip.com')
  .evaluate(() => document.querySelector('.ip').textContent)
  .end()
  .then(ip => console.log(ip))
  .catch(error => console.error('oops', error));
```

Granted, that proxy does not require auth, but it is clearly proxying.
 @mikkokotila:

```
let nightmare = Nightmare({
      switches: {
        'proxy-server': proxy,
        'ignore-certificate-errors': true
      }
    });

    nightmare
    .authentication('user','pwd')
    .goto('http://www.cnn.com') 
```

Works well. Changing the proxy during run-time is an issue i couldn't figure out how.
 Thanks @xmen4u for the answer and @mikkokotila for already posting what I needed help with. I've added this information to the Read me for others to find more easily in PR #687.
  Awesome :raised_hands:
  Is there a way to make page actions based on extracted data? I'm interacting with an asp.net webforms application so after i load the page and perform the search, I have to use that Nightmare instance to do all of the remaining scraping as none of the "links" are true urls they are javascript ajax calls which update portions of the page.

The only way I can find to operate on scraped data from .evaluate is after an end() call which just won't work.

Is it possible to click or perform other actions based on data returned from an .evaluate() call?
 Perfect! I didn't realize there was an examples repo!

This is exactly what I was looking for:

``` javascript
  ...
  .then(function() {
    //since Nightmare has an internal `.then()`, return the instance returned by the final call in the chain
    return nightmare
      //click the next button to get the next page of search results
      .click('.next')
      //get the first HREF from the second page of results
      .evaluate(function() {
        return document.querySelector('#main .searchCenterMiddle li a')
          .href;
      })
  })
...
```
  What is the intended use case for `.use(fn)`?

I had hoped that it could be used to add actions to nightmare instances, but I haven't gotten that to work since it seems that I can only add actions on the global Nightmare class.

Maybe I'm just missing something...
 I'm trying to build a module for dealing with `<select>` elements, and I want an easy way for other people to consume the library. At first, I thought that `.action` was an instance method and thus I wrote my readme as this:

``````
## Usage

```js
const Nightmare = require('nightmare')
const NightmareSelect = require('nightmare-select')

const nightmare = new Nightmare()

nightmare.use(NightmareSelect)

await nightmare.goto('http://...')

if (await nightmare.selectHasOption('select.color', 'blue')) {
  await nightmare.selectOption('select.color', 'blue')
}

if (await nightmare.selectHasOptionWithText(select.color, 'Blue color')) {
  await nightmare.selectOptionWithText('select.color', 'Blue color')
}
```
``````

I don't like the idea of encouraging my users to patch the _global_ `Nightmare` object, as that is considered a bad practice and could potentially have side effects on other libraries.
 Nice! That helped me understand what `.use` was intended for.

I don't know if this should be encouraged at all but I've been extending the prototype manually so that I can get support for plugins in a nice way, not sure if I want to release anything using this though, but this is what it looks like:

**`nightmare-select.js`**

``` js
function selectHasOption (selector, value) {
  return this.evaluate((selector, value) => {
    // ...
  }, selector, value)
}

function selectHasOptionWithText (selector, text) {
  return this.evaluate((selector, text) => {
    // ...
  }, selector, text)
}

// ...

module.exports = function (nightmare) {
  nightmare.prototype.selectHasOption = selectHasOption
  nightmare.prototype.selectHasOptionWithText = selectHasOptionWithText
  // ...
}
```

**`usage.js`**

``` js
const Nightmare = require('nightmare')
const NightmareSelect = require('nightmare-select')

const nightmare = new Nightmare()

nightmare.use(NightmareSelect)

await nightmare.goto('http://...')

if (await nightmare.selectHasOption('select.color', 'blue')) {
  await nightmare.selectOption('select.color', 'blue')
}

if (await nightmare.selectHasOptionWithText(select.color, 'Blue color')) {
  await nightmare.selectOptionWithText('select.color', 'Blue color')
}
```

This way I won't ever clobber the global instance which I really want to avoid...
 Yes, but the problem with that I don't see a way of using that without going down a path of anti-patterns. The use case here is that I want to distribute a third party "plugin" to nightmare.

The first problem with the action approach, is 1) modifying global state potentially affecting other parts of the code, and 2) require with side effects.

``` js
require('nightmare-select') // Nightmare is now magically patched
const Nightmare = require('nightmare')

// ...
```

So I refactor a bit to avoid the require with side effects. Instead of running on load, I'll export a function that will patch the nightmare object.

``` js
const Nightmare = require('nightmare')
const NightmareSelect = require('nightmare-select')

NightmareSelect.patch(Nightmare)

// ...
```

But the bigger problem still exists, I'm modifying global state. Lets say that I have several scrapers for different sites published on npm. Two of them, `scrape-bikes-stockholm` and `scrape-bikes-uppsala` depends on two different versions of `nightmare-select`. Since I made a breaking change in the api, I had to bump the version to `2.0.0`. I have updated `scrape-bikes-stockholm`, but I haven't gotten around to updating `scrape-bikes-uppsala` just yet.

Now there will be a huge conflict in my app, `bikes-in-sweden`, which shows the position of all bike racks in Sweden. Since it depends on both `scrape-bikes-stockholm` and `scrape-bikes-uppsala`, it will pull in both versions of `nightmare-select`. But when the second to load version is loaded, it will simply replace the first version and the scraper depending on that version will start to fail.

The Node.js community is very centered on small reusable modules, and I think that publishing a lot of small modules is not an uncommon use case. Encouraging users to patch global state is dangerous and considered an anti-pattern.

I would be very happy if we could see if there are any alternative approaches to a great plugin system, that is both easy to use, reliable and compatible with the Node.js ecosystem ðŸ™Œ 

also, Nightmare is really awesome and it beats all the other similar tools I've used, keep up the good work!
  The **end()** function ends queue, disconnects, ends the program. But isn't it possible just to end the queue but not disconnect or end the program so that we can start the queue anew and avoid possible memory leak? Here, something that might catch your eyes.

``` js
require('events')
  .EventEmitter.defaultMaxListeners = Infinity;
process.setMaxListeners(0); 
// Doesn't work
// Emits 11 events and node warning pops up, if I can close all previous queues, it'll be just like cake.
var finalhandler = require('finalhandler')
var http = require('http')
var Router = require('router')
var router = Router()
var Nightmare = require('nightmare');
var nightmare = Nightmare({
    show: true
  })
  /* INIT */
nightmare.goto('http://localhost:3000/')
  .inject('js', 'jquery.js')
  .evaluate(function () {
    return $(location)
      .attr('href');
  })
  .then(function (title) {
    console.log(title);
  });
/* MODULES */
function filllogin(callback) {
  nightmare.type('#exampleInputEmail1', 'someone')
    .type('#exampleInputPassword1', 'somepassword')
    .click('body > div > div > div > form > button')
    .then(function () {
      callback("Filled Login Form")
    })
}
/* ROUTES */
router.get('/', function (req, res) {
  res.setHeader('Content-Type', 'text/plain; charset=utf-8');
  res.end("API OK");
});
router.get('/login', function (req, res) {
  res.setHeader('Content-Type', 'text/plain; charset=utf-8');
  filllogin(function (data) {
    res.end(data);
  });
});
/*Server Listener*/
var server = http.createServer(function (req, res) {
  router(req, res, finalhandler(req, res));
});
server.listen(4000);
```

Here is the goal,
Instead of this,

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();

nightmare.goto('http://cnn.com')
  .evaluate(function(){
    return document.title;
  })
  .end()
  .then(function(title){
    console.log(title);
  })
```

Maybe we can do this,

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();
nightmare.goto('http://cnn.com')
  .evaluate(function () {
    return document.title;
  })
  .endqueue()
  .then(function (title) {
    console.log(title);
  })
  .goto('http://yahoo.com')
  .evaluate(function () {
    return document.title;
  })
  .endqueue()
  .then(function (title) {
    console.log(title);
  })
```

Or, 

``` js
nightmare.goto('http://example.com')
  .evaluate(function () {
    return document.title;
  })
  .then(function (title) {
    console.log(title);
  })
  .endquery()
  .goto('http://example.com')
  .evaluate(function () {
    return document.title;
  })
  .then(function (title) {
    console.log(title);
  })

```

Releasing the memory, yet keeping the instance up.
 Yeah, I heavily use then(), but it was just an idea after seeing the behavior of end() and EventEmitter.
Edit: How stupid of me, the issue was about end() and not about blocking contents.
I use Nightmarejs for a long time, but was unaware of such small modules.
Anyway, if you think ending won't mean any good, then lets drop this idea.
Closing this issue.
  https://gist.github.com/Stankye/31c7b6ef65613aecc919730165601ce3
^ Log ^
npm install nightmare is gently tossing errors 
Any ideas/help?

"12159 error Failed at the electron-prebuilt@0.37.8 postinstall script 'node install.js'.
12159 error Make sure you have the latest version of node.js and npm installed.
12159 error If you do, this is most likely a problem with the electron-prebuilt package,
12159 error not with npm itself.
12159 error Tell the author that this fails on your system:
12159 error     node install.js"

Ubuntu 16.04
NodeJS Version: 4.2.6
npm Version: 3.5.2
  The HTTP status code (e.g. 200, 404, 500)
 Thank you Ross, but it does not work.

On May 22, 2016, at 1:38 PM, Ross Hinkley <notifications@github.com<mailto:notifications@github.com>> wrote:

The resolution of .goto()https://github.com/segmentio/nightmare#gotourl-headers has that information. For example:

var nightmare = require('nightmare')();
nightmare.goto('http://example.com')
  .then((gotoResult) => {
    console.log(gotoResult.code); //prints out the HTTP status for the request
  })

â€”
You are receiving this because you authored the thread.
Reply to this email directly or view it on GitHubhttps://github.com/segmentio/nightmare/issues/656#issuecomment-220830268
 Oops, it works now. Just by updating nightmare.
Thank you very much Ross.
 Hi Ross,

Thank you very much for your previous help. One more question. How to force kill the electron.
my code:
setTimeout(() => {
nightmare.end(_ => {}) // it does not exit immediately.
reject('Promise timed out after ' + timeout + ' ms')
}, timeout)

Regards,
Yu Chen

On May 22, 2016, at 1:50 PM, Ross Hinkley <notifications@github.com<mailto:notifications@github.com>> wrote:

What does not work? How is it failing?

â€”
You are receiving this because you authored the thread.
Reply to this email directly or view it on GitHubhttps://github.com/segmentio/nightmare/issues/656#issuecomment-220830733
 Thank you Ross, You are genius. At moment, everything is OK.
BTW, this is my Repo using nightmare.js https://github.com/kuyoonjo/google-auto-oauth2

On May 22, 2016, at 4:50 PM, Ross Hinkley <notifications@github.com<mailto:notifications@github.com>> wrote:

@kuyoonjohttps://github.com/kuyoonjo also, if you have a more complete example, I'd like to see it. I might be able to help more that way.

â€”
You are receiving this because you were mentioned.
Reply to this email directly or view it on GitHubhttps://github.com/segmentio/nightmare/issues/656#issuecomment-220839559
 ^^ Yes. Really helpful. Thank you again.

On May 22, 2016, at 5:13 PM, Ross Hinkley <notifications@github.com<mailto:notifications@github.com>> wrote:

Awesome. Closing this as I think it's resolved. If you have any more problems, reopen/open a new issue.

â€”
You are receiving this because you were mentioned.
Reply to this email directly or view it on GitHubhttps://github.com/segmentio/nightmare/issues/656#issuecomment-220840871
  nightmare.html() should save temporary files in a folder next to the script instead.
  Basically, if you click, scroll, etc so that the content of the page gets extended via JavaScript, when using the save page option with `HTMLOnly` option, Nightmare does not save the latest HTML, but the one that was loaded at the beginning. However, it saves the latest version when using `HTMLComplete`.
 Its ok like this. Thank you.
  Can we also drop the `--harmony` flags as noted all over the README, then? (I _think_ we can, but honestly not totally sure.)
 May also want to add multiple node versions for testing in `circle.yml` as described here: https://discuss.circleci.com/t/testing-multiple-versions-of-node/542
 > what do you think is reasonable? Latest 4, latest 5, latest 6? Something like that?

Thatâ€™s what I would do :)

If you only specify the main version number with NVM, itâ€™ll use the latest available (e.g. `nvm use 4` will use `4.4.4`).
  Gives more helpful errors when using `.click`, `.mousedown` or `.mouseover`, and the selector cannot be found.

e.g. when running `.click('a.not-here')` and the element cannot be found, it will give back the error "Unable to find element by selector: a.not-here" instead of the previous "Cannot read property 'dispatchEvent' of null".
  2 changes:
1) Made the example script shown in the readme.md to actually be the
content of example.js (fix the existing mismtach)
2) small correction to be able to run the example directly after install
(at least on windows) by including the 'node_module\nightmare' as part
of the path and changing yahoo.js to example.js
 @Mr0grog @rosshinkley,

Thanks for encouraging me to contribute.  I hope I got it right this time.  I closed #643 and created this one based on the latest.

Let me know if I did it wrong or if you have questions.
Olivier
 Oh, ha, paths, didnâ€™t even think about how those would be different on Windows when I noted it in #643 :(
Probably agree with @rosshinkley there.
 Sounds good to me.  I can make the change later on today and update the PR
(I guess this is doable, I've never tried to update a PR before)

Thanks

On Fri, May 20, 2016 at 11:35 AM, Rob Brackett notifications@github.com
wrote:

> Oh, ha, paths, didnâ€™t even think about how those would be different on
> Windows when I noted it in #643
> https://github.com/segmentio/nightmare/pull/643 :(
> Probably agree with @rosshinkley https://github.com/rosshinkley there.
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/pull/650#issuecomment-220639655
 @oliviervaillancourt just make another commit on the same branch and itâ€™ll automatically get picked up :)
 Thanks Rob,

I'll try that tonight.

On Fri, May 20, 2016 at 11:55 AM, Rob Brackett notifications@github.com
wrote:

> @oliviervaillancourt https://github.com/oliviervaillancourt just make
> another commit on the same branch and itâ€™ll automatically get picked up :)
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/pull/650#issuecomment-220645336
 Hey @rosshinkley and @Mr0grog,

I think I've updated this PR with the outcome of the discussion by simply stating `example.js` on line 55.

Let me know if you feel this should be done otherwise.

Thanks for your help
 Looks awesome to me. Thanks!
  Is there a way to asynchronously `.evaluate()`?

I was taking a look at [horseman](https://github.com/johntitus/node-horseman), and they provide a handy `done` callback...

```
horseman
  .open('http://en.wikipedia.org/wiki/Headless_Horseman')
  .evaluate(function(ms, done){
    var start = Date.now();
    setTimeout(function() {
      done(null, Date.now() - start);
   ..
```

I'm thinking in implementing it myself to nightmare, but want to be sure this doesn't exist already?
  > (From #645) Once we've got consistent error reporting between the parent and child process, the errors over IPC almost falls out of that for free. Entirely possible I'm missing something, though.

So, quick example of what I was getting at:

``` js
// runner.js
parent.respondTo('goto', function(url, headers, done) {
  if (typeof url !== 'string') {
    throw new TypeError('goto: `url` must be a non-empty string');
  }
```

Results in an error object back in the userâ€™s process of `{}`â€”not super helpful! Right now we return strings or generic objects for errors (when we bother to return errors :P), which is not as nice. And if there is an actual exception in Nightmareâ€™s code (as opposed to Nightmare explicitly returning error information), we have the same situation. That said, returning _something_ in all the explicit error cases is waaaaaaaay more important. The serialization thing is more of a nicety (but not a free one).
 VIOLENT AGREEMENT! Anyway, back to the main topic here: figuring out the current state of affairs:

**goto**
- Error: a string for bad arguments (ideally, this should be a `TypeError`)
- Error: an object when the operation fails
- Return: an object with data about the HTTP response

**engineVersions**
- Cannot error
- Return: Object with data

**title**
- Should not ever error
- Return: string

**url**
- Should not ever error
- Return: string

**visible**
- Should not ever error
- Return: boolean

**exists**
- Should not ever error
- Return: boolean

**click, mousedown, mouseover, type, insert, check, uncheck, select**
- Error: may get a string error message, but not one that clearly indicates what went wrong (selector not found). See also #651
- Return: nothing

**forward**
- Should not ever error (open question: _should_ it error if thereâ€™s nothing to go forward _to?_)
- Return: nothing

**back**
- Should not ever error (open question: _should_ it error if thereâ€™s nothing to go back _to?_)
- Return: nothing

**refresh**
- Should not ever error
- Return: nothing

**wait**
- Error: actual `Error` instance on timeout
- Return: nothing if too few args (but does debug log the situation)
- Return: nothing if argument is an unknown type (does _not_ debug log the situation)
- Return: nothing on success

**evaluate**
- Error: actual `Error` instance for invalid arguments (ideally should be `TypeError`)
- Error: string for errors in the evaluated function
- Return: return value of evaluated function (when JSON-serializable)

**inject**
- Error: throws unhandleable async error for errors reading the file
- Return: nothing

**viewport**
- Appears to be incapable of erroring, but may behave oddly or hang if args are incorrect
- Return: nothing (could be value here in returning the actual resulting size, which may differ from requested size)

**useragent**
- Should not ever error
- Return: nothing

**scrollTo**
- Error: throws unhandleable async error if too few args (`TypeError: done is not a function`)
- No error, but potentially odd behavior if wrong argument types
- Return: nothing (like viewport, maybe useful to return the resulting scroll position)

**screenshot**
- Error: actual `Error` instance for file writing issues (permissions, paths, etc)
- Error: throws unhandleable async error if clip rect doesnâ€™t have the required properties or is not an object
- Return: buffer if no path specified, nothing if path is specified

**html**
- Error: empty object if invalid value for `saveType` (itâ€™s an error in Electron, but gets quashed by IPC serialization)
- Return: nothing

**pdf**
- Error: throws unhandleable async error if only one argument and it is not a string or object or if first argument of two is truthy but not a string
- Error: throws unhandleable async error if PDF generation actually fails (using, for example, an invalid `options` object like `{printBackground: 5}`)
- Return: buffer if no path specified, nothing if path is specified

**authentication**
- Should not be capable of erroring directly
- **Hangs indefinitely if given incorrect credentials**
- Error: throws unhandleable async error if called more than once (`Error: callback can only be called for once`)
- Return: nothing

**cookies.get, cookies.set, cookies.clear**
- May have odd errors if too many args
- Errors because of incorrect values get quashed into an empty object
- Return: single cookie object or array of cookie objects for get, nothing for set and clear

**run**
- Error: asynchronous, unhandleable runtime error if a callback function is not provided (See #500)

**then**
- Should never error
- Return: promise
 AH, the `throw new Error` from evaluate is just a string, not an error object.

That's why `error.message` wasn't working.

OK, I fixed my code in two places.  Fixes #642.

Ultimately, I think it would be better to reject with an instance of `TypeError` (with the same message), but that requires properly serializing and deserializing errors over IPC, which is a non-trivial task (would love to hear your thoughts on this, @rosshinkley). I wanted to get the immediate problem solved first.
  We fixed this in the actual preload script, but missed the test! This doesnâ€™t upgrade Electron, but it is a prerequisite for upgrading. (The API is gone entirely in Electron 1.0)
  Hi,

While trying to test nightware, I had to modify the example.js a little bit.  It seems that yahoo.com may have removed the 'title' attribute on the search input.  

Also the readme tells you to node yahoo.js instead of example.js.

Maybe I misunderstood something.  But if this was really a correction to be done, here it is.

Thanks
 Hi @oliviervaillancourt, the selectors in the README were specifically chosen to be more robust against the regular changes Yahoo makes and they do still work: https://github.com/segmentio/nightmare/pull/613

It looks to me like itâ€™s just `example.js` that is out of date (my bad; I completely failed to update it in the above PR.)
 Hi Rob,

Thanks for taking the time to look into my PR.  I see the more robust way of doing selector in PR 613.  

I'm still having this issue and I'm not sure if it's because I misunderstood something or the PR hasn't been merged yet.

Anyways, I've made a video of what I'm doing and you can have a look to if you want.

[https://onedrive.live.com/redir?resid=9A82B122E214504!6250&authkey=!ALWRmtGHO62jr_M&ithint=video%2cmp4 ](https://onedrive.live.com/redir?resid=9A82B122E214504!6250&authkey=!ALWRmtGHO62jr_M&ithint=video%2cmp4)

Thanks
 @oliviervaillancourt Right, your issues are with:
- README should say to run `node node_modules/nightmare/example.js`
- The actual content of `example.js` doesnâ€™t match the example in the README

Both of those things totally need to be fixed! :thumbsup: on your PR changing those. I was only trying to say that it probably shouldnâ€™t change the example code (changing the shell command is good) that is currently in the README (and, where it changes `example.js`, it should match the code in the README). Sorry if I worded it poorly!
 Hey Rob,

Sounds like we are on the same page now and I completely agree with the way you stated things.

I guess at this point, although my PR is not exactly the best, you have enough to make the changes required.

If you need me to update the PR, let me know but I'll assume you have enough info to make the changes.

Thanks for taking the time to help me understand.  I'll continue to play around with nightmare
 > you have enough to make the changes required.

Iâ€™m not a committer and donâ€™t have any more rights to make changes than you do, so you should probably keep working on this PR. (I just thought Iâ€™d give some feedback since I wrote #613 and knew a little bit about the stuff you were touching here.)
 Ah,  got it.

Thanks for your input.  I'll look into that.

Thanks
On May 18, 2016 21:20, "Rob Brackett" notifications@github.com wrote:

> you have enough to make the changes required.
> 
> Iâ€™m not a committer and donâ€™t have any more rights to make changes than
> you do, so you should probably keep working on this PR. (I just thought Iâ€™d
> give some feedback since I wrote #613
> https://github.com/segmentio/nightmare/pull/613 and knew a little bit
> about the stuff you were touching here.)
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/pull/643#issuecomment-220203551
 Created a new PR  #(650) that replaces this one.  So closing this PR.
  It felt very awkward to be able to use `.then`, but not `.catch` directly, leading me to write code like this:

``` js
browser.evaluate(checkErrors).then(x => x).catch(err => {
  // ...
})
```

This pr will allow me to skip the `.then(x => x)` part and just use `catch` directly, making it work even more as a normal promise.

``` js
browser.evaluate(checkErrors).catch(err => {
  // ...
})
```
 Ping @Mr0grog ðŸ˜ƒ 
 Cool, I think this would be great to have! But why isnâ€™t the implementation just:

``` js
return this.then(undefined, reject);
```

Itâ€™s much simpler and more robust. After all, thatâ€™s how itâ€™s specified: http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise.prototype.catch
and even how itâ€™s implemented in V8: https://chromium.googlesource.com/external/v8/+/master/src/promise.js#256

Also, it needs a test ;)

(Side note: Iâ€™m not a committer here, just a helpful handyman, so I canâ€™t approve your PR.)
 @Mr0grog Thanks for the comments!
  This helps to alleviate the problems noted in #612 (and hinted at in other issues as well), but does not solve the core problem (deadlocking on a disk cache shared between Electron processes).

This turned out to require a much bigger change than one might expectâ€”Nightmare checks whether the window is ready to receive actions (i.e. whether it is loading) between every action, but since we can now be in a state where we are ok to continue but loading is still going on, we have to track for ourselves whether is OK to perform the next action instead of simply asking Electron whether resources are loading. This is accomplished by way of a method named `isReady()` that returns a boolean and `setIsReady(newValue)` that takes a boolean and fires an event on the `BrowserWindow` instance called `did-change-is-ready`.

The actual timeout value can be customized at construction time (via an option called `gotoTimeout`, analagous to `waitTimeout`) and at method time with a third argument `goto(url, headers, timeout)`.

@rosshinkley Iâ€™m not 100% providing _both_ those methods for overriding is bestâ€”maybe it should just follow the example of `wait` and only support the constructor option?

I also wonder if, based on this, certain actions should be exempted from the `continue` check (e.g. `goto`, `viewport`, `wait(number)`), since itâ€™s not really relevant for everything. I think thatâ€™s definitely out of scope for this PR, though.
 > I can't think of a case offhand where having differing timeouts by URL would be helpful. Is there a use case buried here that I'm not thinking of?

I _think_ this came from my personal angst that itâ€™s not an option with `wait(selector|function)`â€”where I do think there are clear use cases for different timeouts on different calls (bits of this PR have been hanging around in my git stash for a while). I think, upon reflection, that it doesnâ€™t have any especially great use-cases. Maybe when loading a local page you might expect it to be fast and want to time out more quickly than when loading something from the web? Iâ€™m not sure thatâ€™s a very strong case, though.
 Updated to resolve merge conflicts.
 > Wholly agree it makes sense for .wait(), but for .goto() ... I'm leaning toward "no".

Yeah, already changed it yesterday in c9679938e64ec4196d3defd8a84d90171b591d14 :)
  ``` js
const Nightmare = require('nightmare')
const browser = new Nightmare()

function throwTest () {
  throw new Error('Test')
}

browser.goto('about:blank').evaluate(throwTest).then(x => x).catch(err => {
  console.log(typeof err)
})
```

Expected output:

``` text
object
```

Actual output:

``` text
string
```
  ``` Javascript
import Nightmare from 'nightmare';

const browser = new Nightmare({
  doc: true, // option to show the electron app icon in the os x doc
  show: true, // show the browser
  openDevTools: true, // open browser dev tools
  waitTimeout: 10000,
  switches: {
    'ignore-certificate-errors': true
  }
}).viewport(1624, 1020).on('console', function(type, message, errorStack){
  console[type]('    - ' + type + ' - ' + message, errorStack || '');
});

let response = browser.goto('http://google.com').evaluate(function() {
  try {
    console.log('expected_state_obj keys:', Object.keys({ data_url : 'http://foo.bar' }));
  } catch(error) {
    console.log(`ERROR! ${error.message} / ${error.stack}`);
  }
});
```

throws this error stack:

``` Bash
    - log - ERROR! _keys2 is not defined / ReferenceError: _keys2 is not defined
    at <anonymous>:6:61
    at javascript (<anonymous>:10:15)
    at <anonymous>:15:3
    at EventEmitter.electron.ipcRenderer.on (.../node_modules/electron-prebuilt/dist/Electron.app/Contents/Resources/electron.asar/renderer/init.js:44:29)
    at emitMany (events.js:121:13)
    at EventEmitter.emit (events.js:195:7) 
  âœ– PAGE LOADED IN BROWSER : https://doc.soa
```
 Are you using Babel or some other source transformer on this code? (guessing so because you are using `import`). Most likely, the source transformer is changing the `Object.keys()` call to call some other library function, which is then not available in the actual browser window where it gets evaluated.

Have you tried this example code on its own without source transformations?
 Also, what versions of Node, Nightmare, and Electron are you using?
 Hi @Mr0grog - well, that's a good thought, but the thing is I can run `Object.keys(...)` without error from everywhere in my test scripts with no error at all. I only get the error when it's run from within a function in a `wait()` or `evaluate()` call.
 > I only get the error when it's run from within a function in a wait() or evaluate() call.

That adds more evidence for the conclusion, then! The functions you pass to `wait` and `evaluate` donâ€™t run in the current environmentâ€”they get transformed back to source code, sent to the browser (an entirely different process, so you canâ€™t share function objects with it), then turned back into functions and executed there. If you have code in those functions that depends on something in your environment (such as a custom implementation of `Object.keys`), theyâ€™ll break, because they donâ€™t actually run in your environment.
 @Mr0grog yep - you must be right. I find it quite surprising that Ava's babel transpiler would mess with Object.keys though!
 One workaround if you are stuck with that transpiler would be:

``` js
let response = browser.goto('http://google.com').evaluate(Function('', `
  console.log('expected_state_obj keys:', Object.keys({ data_url : 'http://foo.bar' }));
`));
```
  Im using nightmare to turn some large webpages into pdfs and I've been having some issues. After digging around for a bit, here is what I've got.
Generally, everything works, but sometimes I see electron just crash (the process dies) during the pdf generation phase and then nothing else happens. No error is thrown, nightmare never returns anything, promises aren't evaluated. It just stalls out indefinitely. 
I have also seen the same thing happen on occasion with the one difference being the following error

```
Nightmare runner error:
    RangeError: Invalid string length
        at Object.stringify (native)
        at process.target._send (internal/child_process.js:586:23)
        at process.target.send (internal/child_process.js:507:19)
        at EventEmitter.IPC.emitter.emit [as emit] (/Users/roryjesseshevin/Documents/go/src/github.com/parsable/scrivener/node_modules/nightmare/lib/ipc.js:33:15)
        at Function.<anonymous> (/Users/roryjesseshevin/Documents/go/src/github.com/parsable/scrivener/node_modules/nightmare/lib/runner.js:270:14)
```

Any suggestions here?

Edit: Its probably worth noting that I'm not printing directly to a pdf, but storing it as a buffer and passing it along to some compression scripts. 
Also, after playing around with the different debugging options, I got a logline 
`nightmare electron child process exited with code null: undefined +29s`
Edit2: Tried to get some more info out of nightmare when electron crashes. Its shutting down due to the signal SIGILL
 I have the same problem.  ``` js
const Nightmare = require('nightmare')

function electronAction (name, options, parent, win, renderer, done) {
  parent.respondTo('test', (cb) => cb(new Error('Test')))
  done()
}

function nightmareAction (cb) {
  this.child.call('test', cb)
}

Nightmare.action('test', electronAction, nightmareAction)

const browser = new Nightmare()

browser.test().then(() => {
  console.log('???')
}).catch(err => {
  console.log(err)
})
```

Expected output:

``` text
[Error: Test]
```

Actual output:

``` text
{}
```
 Yeah, this is a long-standing known issue and thereâ€™s been a _little_ bit of discussion about better serializing things like errors. But for now, what you send across processes has to be JSON-serializable.
  Right know it logs something like "Cannot read property 'blur' of null" when there is a not existing selector, would be great for next version to have additional info of the action and what triggered the error, etc :)

Also, if there is a fatal error like a not existing selector, shouldn't the error be logged even if there is no catch?
 > Also, if there is a fatal error like a not existing selector, shouldn't the error be logged even if there is no catch?

This part is a little debatable (Iâ€™m totally with you on better messages)â€”the reason promises donâ€™t natively do this is because you can always add a rejection handler via `then` or `catch` later after the error occurs. Instead, you can listen for [the `process` objectâ€™s `unhandledRejection` event](https://nodejs.org/dist/latest-v4.x/docs/api/process.html#process_event_unhandledrejection):

``` js
process.on('unhandledRejection', (error, promise) => {
    console.error("An action failed because:", error);
});
```
  Electron have released version 1.0, nightmare needs to upgrade electon-prebuilt. 
http://electron.atom.io/blog/2016/05/11/electron-1-0
 #644 is merged, what is next for making this happening?
 Tried it locally with Electron 1.0.2 and seems to be working great. All tests are passing and I was able to use our internal app as before.

I'm affected by electron/electron#5444 so it would be really nice to be able to upgrade to version 1.0.2...
 `1.2.1` is released from electron, just need to wait for `electron-prebuilt` to upgrade
 @rosshinkley @LinusU 
`1.2.1` is now released in `electron-prebuilt` https://www.npmjs.com/package/electron-prebuilt
I ran the tests with `1.2.1` and everything passes ðŸŽ‰ 
 ping @rosshinkley @matthewmueller 
  npm ERR! Windows_NT 10.0.10586
npm ERR! argv "C:\Program Files\nodejs\node.exe" "C:\Program Files\nodejs\node_modules\npm\bin\npm-cli.js" "install" "--save" "nightmare"
npm ERR! node v6.1.0
npm ERR! npm  v3.8.6
npm ERR! code ELIFECYCLE

npm ERR! electron-prebuilt@0.37.8 postinstall: `node install.js`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the electron-prebuilt@0.37.8 postinstall script 'node install.js'.
npm ERR! Make sure you have the latest version of node.js and npm installed.
 @Muyv This is an issue in `electron-prebuilt` and I believe itâ€™s already been filed: https://github.com/electron-userland/electron-prebuilt/issues/125 (but you should make sure that bug matches what youâ€™re experiencing)
 @rosshinkley Nope, maybe this issue is WINDOWS-only, I tried to do it in CentOS, eveything goes well.
 @Mr0grog Thx, It seems a compatibility problem of `electron-prebuilt`. In fact I've already used another Phantomjs bridge to realize my requirements.
  First off, you should still be able to write the exact same code with generators. Nothingâ€™s changed there so far as Iâ€™m aware. (The generator support was always based on the promise-style API; I think the change in messaging was just a desire not to push learning both Nightmare _and_ async generators on a new user.)

Iâ€™m imagining you might have had code likeâ€¦

``` js
function doTheThing*() {
  var showingFailedMessage = yield nightmare
    .goto('loginpage.html')
    .wait('selector')
    .type('text-field-selector', 'login-info')
    .exists('failed-message-selector');
  if (showingFailedMessage) {
    var image yield nightmare.screenshot();
    saveScreenshot(); // <-- this is just made up; it's whatever you would do with the screenshot
    throw new Error('login failed!');
  }
}
```

If that's way off, drop an actual example in here so we can see what you're trying to translate to promises.

A promise version of the above might be:

``` js
function doTheThing() {
  return nightmare
    .goto('loginpage.html')
    .wait('selector')
    .type('text-field-selector', 'login-info')
    .exists('failed-message-selector')
    .then(function(showingFailedMessage) {
      if (showingFailedMessage) {
        var image yield nightmare.screenshot();
        saveScreenshot(); // <-- this is just made up; it's whatever you would do with the screenshot
        throw new Error('login failed!');
      }
    });
  }
```

In the above, `doTheThing()` would return a promise that resolves if the login worked and rejects if the login failed.
 Oh no, I think you might have some crossed wires here about how promises and generators work, probably caused by a **horrible** copy/paste error in my initial reply. So sorry about that :(

While you _can_ mix the promise-style `then()` API with generators, you really donâ€™t want to. (Youâ€™d still need `vo`; setting it up right would be complicated, etc). When I wrote:

``` js
.then(function(showingFailedMessage) {
  if (showingFailedMessage) {
    var image yield nightmare.screenshot();
    saveScreenshot(); // <-- this is just made up; it's whatever you would do with the screenshot
    throw new Error('login failed!');
  }
});
```

That was a copy/paste error from the window Iâ€™d written the code in. Itâ€™s completely wrong and wouldnâ€™t ever work _at all._ That was supposed to be:

``` js
.then(function(showingFailedMessage) {
  if (showingFailedMessage) {
    return nightmare.screenshot().then(function(imageBuffer) {
      saveScreenshot(); // <-- this is just made up; it's whatever you would do with the screenshot
      throw new Error('login failed!');
    }
  }
});
```
 > It's possible for my use-case that using the generator form may be better altogether because I have other actions that need to occur after .then, an example building off the original

Soâ€¦ this is equally do-able in generator form or in promise-form. The main difference is in the way you branch. Letâ€™s say we fixed my original example with the code from above (sorry again):

``` js
function doTheThing() {
  return nightmare
    .goto('loginpage.html')
    .wait('selector')
    .type('text-field-selector', 'login-info')
    .exists('failed-message-selector')
    .then(function(showingFailedMessage) {
      if (showingFailedMessage) {
        return nightmare.screenshot().then(function(imageBuffer) {
          saveScreenshot(); // <-- this is just made up; it's whatever you would do with the screenshot
          throw new Error('login failed!');
        }
      }
    });
  }
```

The easiest way to use that would be:

``` js
doTheThing().then(function() {
  return nightmare
    .someActionAfterLoggingIn()
    .anotherActionAfterLoggingIn()
    .youGetTheIdea()
    .screenshot()
    .end()
    .then(function(imageBuffer) {
      fs.writeFileSync('success-screenshot.png', imageBuffer);
      console.log('Success!');
    })
}).catch(function() {
  // make sure to end nightmare in case something went wrong along the way
  return nightmare.end();
});
```

It might also just be simpler to:

``` js
// this is just a quick utility that makes screenshotting a little simpler
function saveScreenshotAndEnd(savePath) {
  return nightmare.screenshot().end().then(function(imageBuffer) {
    fs.writeFileSync(savePath, imageBuffer);
  });
}

nightmare
  .goto('loginpage.html')
  .type('text-field-selector', 'login-info')
  .click('login-button-selector')
  .wait('selector-that-indicates-you-are-logged-in')
  .someActionAfterLoggingIn()
  .anotherActionAfterLoggingIn()
  .youGetTheIdea()
  .then(function() {
    console.log('Success!');
    saveScreenshotAndEnd('success.png');
  })
  .catch(function(error) {
    console.error('Something broke:', error);
    saveScreenshotAndEnd('failure.png');
  });
```

There are _a lot_ of ways to formulate this. What works best will depend on exactly what it is you want to do.
  In testing my app I am using `wait('element_selector')` a lot. Often I need to return a boolean value once the element is found in order to use it in a truthy assertion. SO I end up doing : `let el_found = await browser.wait('el_selector').evaluate(() => { return true; });` or ``let el_found = await browser.wait('el_selector').exists('el_selector');`

It seems to me it would be much nicer if wait simply returned true once the element was found?
 Just making sure I understand, you're doing:

``` js
async function doTheThing() {
  return await browser.wait('el_selector').evaluate(() => { return true; });
}
```

Why not:

``` js
async function doTheThing() {
  await browser.wait('el_selector');
  return true; // if the selector is never found it should throw, so you wouldn't get here
}
```

Seems a little simpler unless I'm misunderstanding what you're getting at.

That said, if I understand right, it _would_ be nice if `wait()` also returned `true` when it succeeded. In general, a lot of the Nightmare methods could probably stand to return more informative values. ðŸ‘ 
 @Mr0grog Thanks. 

Yes, I can see I should have provided more context with my question. Specifically, I am using Nightmare.js with the testing framework [Ava](https://github.com/sindresorhus/ava) - (incidentally Nightmare and Ava almost feel made for each other!).

I am writing a series of functional tests for my app, that run in serial and tend to each perform a small action and/or then test a single part of my app's state. So they tend to look a lot like this:

``` Javascript
test.serial('CONTENT TABS POPULATED', async t => {

  t.plan(1); // number of passes required

  let content_tabs_populated = await browser.wait('#content-tabs-list > .tab').evaluate(() => { return true });

  t.truthy(content_tabs_populated === true, 'Failed to populate content tabs.');
});
```
 Hmmm, in that case, you ought to just be able to:

``` js
test.serial('CONTENT TABS POPULATED', async t => {
  await browser.wait('#content-tabs-list > .tab');
});
```

In an `async` function (or async generator), `browser.wait()` should throw an exception if the selector never shows up, so you you _shouldnâ€™t_ need to assert anything at all there. Iâ€™ve never actually used Ava, though, so I donâ€™t know if there are any idiosyncrasies there.
 I agree with @Mr0grog, and I think that it would be weird API-wise if `wait` returned a `Promise<bool>`.

I've been using Ava with Nightmare as well and a just to `await browser.wait(...)`, it will throw an error if the promise is rejected.
 @Mr0grog yes, you are correct that you could choose not to use the assertion and it would still work - although I'd still like to attempt to have a descriptive fail message - unfortunately when ava times out the error message is not shown even with the assertion :(
 That must because ava times out before the `browser.await` times out in that case...
 @LinusU Bingo - set Ava's timeout so that it's longer than the 30s Nightmare.js wait timeout and I now get the proper test failure message when the wait times out. Thanks!
 @atomless you can also reduce how long `wait` waits if you need:

``` js
Nightmare({waitTimeout: 5000})
  .goto('someurl')
  .wait('#content-tabs-list > .tab');
```

Would only wait 5 seconds.
 @Mr0grog even better - thanks!
 @atomless 
Is not more easy use `JSDOM` instead `Nightmare` for your test?

But if you really want use `AVA` + `Nightmare` you can use `test.cb`

**Example**

``` js
test.cb('apenas um show', t => {
    t.plan(1);
    Nightmare()
        .goto('someurl')
        .inject('js', join(__dirname, '../node_modules/simulant/dist/simulant.umd.js'))
        .evaluate(() => {
            let hasTouches = false;
            document.body.addEventListener('touchstart', event => {
                hasTouches = event.touches.length > 0;
            });

            simulant.fire(document.body, 'touchstart', {
                touches: [
                    new Touch({
                        identifier: 0,
                        target: document.body
                    })
                ]
            });
            return hasTouches;
        })
        .end()
        .then(result => {
            t.true(result);
            t.end();
        });
});
```
  I am trying to update the package `x-ray-phantom` from using old nightmare phantom driver to using electron. Fork here https://github.com/ivawzh/x-ray-phantom

However, `.evaluate()` seems not being triggered. 

```
return function electron_driver(ctx, done) {
    debug('going to %s', ctx.url)

    nightmare
      .on('unresponsive', function() {
        console.warn('the web page ' + ctx.url + 'becomes unresponsive.')
      })
      .on('responsive', function() {
        console.log('the unresponsive web page ' + ctx.url + 'becomes responsive again.')
      })
      .on('did-fail-load', function(event, errorCode, errorDescription) {
        console.error('nightmare did-fail-load error: ' + errorCode + '; ' + errorDescription)
        return new Error(errorDescription, errorCode)
      })
      .on('did-get-response-details', function(event, status, newUrl, originalUrl, httpResponseCode, requestMethod, referrer, headers) {
        if (normalize(originalUrl) == normalize(ctx.url)) {
          debug('got response from original url: %s, actual url: %s, httpResponseCode: %s', originalUrl, newUrl, httpResponseCode)
          ctx.status = httpResponseCode
        }
      })
      .on('dom-ready', function() {
        debug('dom-ready for %s', ctx.url)
      })
      .on('will-navigate', function(event, url) {
        debug('redirect: %s', url)
        ctx.url = url
      })

    wrapfn(fn, select)(ctx, nightmare)

    function select(err, ret) {
      if (err) done(err)
      console.log(11111)
      nightmare
        .evaluate(function() {
          console.log(22222)
          return document.documentElement.outerHTML
        }, function(body) {
          console.log(33333)
          ctx.body = body
        })
        .run(function(err) {
          console.log(44444)
          if (err) return done(err)
          debug('nightmare .run url: %s ; status: %s', ctx.url, ctx.status)
          done(null, ctx)
        })
    }
  }
```

Result from running `npm test`:

```
electron driver
  x-ray:electron going to http://google.com +5m
  x-ray:electron got response from original url: http://google.com/, actual url: https://www.google.com.au/?gfe_rd=cr&ei=NBQvV4TeJanM8gfioZnYCw&gws_rd=ssl, httpResponseCode: 200 +1s
  x-ray:electron dom-ready for http://google.com +246ms
11111
44444
  x-ray:electron nightmare .run url: http://google.com ; status: 200 +67ms
ctx:
context {
  response: { status: 200, message: 'OK', header: {}, body: null },
  request: { method: null, url: 'http://google.com', header: {} } }
    1) should have sensible defaults


  0 passing (2s)
  1 failing

  1) electron driver should have sensible defaults:
     Uncaught TypeError: Cannot read property 'parent' of null
      at Function.exports.update (node_modules/cheerio/lib/parse.js:55:25)
      at module.exports (node_modules/cheerio/lib/parse.js:17:11)
      at Function.exports.load (node_modules/cheerio/lib/static.js:19:14)
      at test/phantom.js:26:23
```
 @rosshinkley Thanks for the answer. Your fork looks awesome, just one thing I cannot get pagination to works. Is there anything special I need to config?
  I want it to scroll down until the size of the returned document does not increase anymore. 
How can I achieve this?
  ```
Nightmare.action('scrollPage', function (done) {
  this.evaluate_now(function () {
    var hitRockBottom = false; 
    while (!hitRockBottom) {
        // console.log("1");
    // Scroll the page (not sure if this is the best way to do so...)
    this.scrollTo(100000, 0);

    // Check if we've hit the bottom
    hitRockBottom = this.evaluate(function() {
        // console.log("0");
        return this.exists('selector') === null;
    }); }
  }, done)
})
```
 It looks like maybe you are trying to call nightmare functions from within `evaluate_now`, which wonâ€™t work. The code passed to `evaluate_now` runs _inside the browser window,_ where `this` represents the same `window` object any JavaScript running inside the page would have access to.

Also, unless the page specifically does something special when the page scrolls, scrolling the page isnâ€™t going to make the result of `exists(selector)` change.
 ```
.goto("url")
.scrollPage()
```

The selector that I use in exists() is available until no further scrolling down is possible.

On a sidenote, I have a different ideea. There are pages where you can't figure out very easily how the infinite scroll is implemented, or which is the selector, at least if you are a beginner like me. 

I want it to scroll down until the size of the returned document does not increase anymore. 
How can I achieve this?

Javascript kills me, in Perl this would have been so easy, but Mechanize::Firefox is outdated and very slow. 
  Fixes #622.
#595 should be almost exactly the same as â€˜should be constructable with switchesâ€™ since it is the same, just only supporting switches with no values (or switch + value together in one string).
  Should probably document it clearly in the README, too. To be honest, Iâ€™m not really sure what the compatibility requirement _is._ (I was under the impression, based on some comment in an issue or PR I canâ€™t find a little while back, that it was Node 4+ now.)
 > Template strings don't work with <4.

Worth noting that doesn't matter for node compatibility (for now), since we only use template strings on the Electron side, which does support them in the version we require in `package.json`.
 d'oh, forgot `ipc.js` also runs in the user process! (Was only looking at `nightmare.js`.)
 (Do we need to change `ipc.js`?)
 I am cool with thatâ€”especially since I was the one who thought the minimum had been updated to 4.x in the first place :P  (Also since 6.x will soon be the new long-term-support version of node)
  With the following error:

```

/Users/mathisonian/projects/.../node_modules/nightmare/lib/nightmare.js:75
  this.proc.stdout.pipe(split2()).on('data', (data) => {
                                                    ^^
SyntaxError: Unexpected token =>
    at exports.runInThisContext (vm.js:73:16)
    at Module._compile (module.js:443:25)
    at Object.Module._extensions..js (module.js:478:10)
    at Module.load (module.js:355:32)
    at Function.Module._load (module.js:310:12)
    at Module.require (module.js:365:17)
    at require (module.js:384:17)
    at Object.<anonymous>
```

Is this expected / documented anywhere?
 Ah no, I wasn't running with `--harmony`. Not a huge deal, but I ran into the error when I depended on `^2.1.0` and got the semantic upgrade. 

Thanks for the response!
 i have this issue.
 root@ubuntu-2gb-tor1-01:/images# node --harmony e.js

/images/node_modules/google-images-scraper/node_modules/nightmare/lib/nightmare.js:94
  this.queue((done) => {
                     ^
SyntaxError: Unexpected token >
    at Module._compile (module.js:439:25)
    at Object.Module._extensions..js (module.js:474:10)
    at Module.load (module.js:356:32)
    at Function.Module._load (module.js:312:12)
    at Module.require (module.js:364:17)
    at require (module.js:380:17)
    at Object.<anonymous> (/images/node_modules/google-images-scraper/lib/google-images-scraper.js:6:17)
    at Module._compile (module.js:456:26)
    at Object.Module._extensions..js (module.js:474:10)
    at Module.load (module.js:356:32)
    at Function.Module._load (module.js:312:12)
    at Module.require (module.js:364:17)
    at require (module.js:380:17)
    at Object.<anonymous> (/images/node_modules/google-images-scraper/index.js:1:80)
    at Module._compile (module.js:456:26)
    at Object.Module._extensions..js (module.js:474:10)
 root@ubuntu-2gb-tor1-01:~# nodejs --version
v0.10.25

and 

{
  "name": "nightmare",
  "version": "2.5.2",
  "license": "MIT",
  "main": "lib/nightmare.js",
  "scripts": {
    "test": "make test"
  I have a slider in a page that can be clicked to choose the value.
This slider is really a div, styled with js to inject the right value in a React Component.
From the dom point of view everything is ruled with the left value of this div:

```
<div 
    class="handle handle-0 " 
    style="position: absolute; z-index: 1; left: 144px;" 
    data-reactid=".0.2.0.0.1.0.0.4.0.1.1.0.1.0.1:$handle0">
</div>
```

I would like to know if it is possible to simulate a mouse click in a position x,y with nightmare.
Any help is appreciated.
 I used the evaluate function. Inside that I find the dom element that is basicaly a div rectangle listening for clicks.
I successfully have the element of the DOM.

```
var el = document.querySelector('#risk_profile > div');
var ev = new MouseEvent('click', {
        'view': window,
        'bubbles': true,
    'cancelable': true,
    'clientX': 100,
        'clientY': 1
});
el.dispatchEvent(ev);

```

I create than an offset element and I give an offset of 100.
Unfortunately the event is not dispatched correctly. What do you think I'm missing here?

Thanks
 I have tried the following.
First I find the correct position of the slider in absolute coordinates. Then I try to click it via the function.
It doesn't work via the browser console, nor via electron browser...

```
.evaluate(function(){
    var el = document.querySelector('#risk_profile > div');
    var xPos = 0;
    var yPos = 0;
    while (el) {
        if (el.tagName == "BODY") {
            // deal with browser quirks with body/window/document and page scroll
            var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
                var yScroll = el.scrollTop || document.documentElement.scrollTop;
            xPos += (el.offsetLeft - xScroll + el.clientLeft);
            yPos += (el.offsetTop - yScroll + el.clientTop);
        } else {
            // for all other non-BODY elements
            xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
            yPos += (el.offsetTop - el.scrollTop + el.clientTop);
        }
        el = el.offsetParent;
        }
    el = document.querySelector('#risk_profile > div');
    // now you have the right left,top global position!
    var ev = new MouseEvent('click', {
            'view': window,
        'bubbles': true,
        'cancelable': true,
        'screenX': xPos + 50,
        'screenY': yPos
    });
    el.dispatchEvent(ev);
    return true;
})
```

In reality the 
`el.dispatchEvent(ev)`
give `true` as answer, so it is actually really executing the code correctly, but the event doesn't have impact in the gui. I don't know why.
 @maiopirata your code above seems perfectly correct. What are you expecting to have happen? Do you have a `click` event listener on the `div` or on an element that contains it? When you dispatch a simulated event this way, an element _inside_ the div at the given position _will not receive the event._ This will also not automatically trigger the relevant `mousedown` and `mouseup` events, so if you are actually listening for those, your listeners will not be triggered.

It is also worth noting that none of the default behaviors that a browser does will be triggered when you dispatch events this way (thatâ€™s why you might want to use `webContents.sendInputEvent` as @rosshinkley mentionedâ€”that _will_ cause default browser behaviors).

Side note: you can actually get the position of the element relative to the viewport much more easily than you are doing above:

``` js
var el = document.querySelector('#risk_profile > div');
var bounds = el.getBoundingClientRect();
var xPos = bounds.left;
var yPos = bounds.top;
```
 Thank you @Mr0grog for your answer. I will definitely test webContents, it seems that this is the point.
Thank you also that you show me bounds.left, top.. It would have saved me a lot of time knowing it some days before.

I will let you know soon
 I'm trying to do similar as well. I want to write automation tests for canvas drawing and need to do mousemove/mousedown/mouseup at a specific coordinate (x,y).

Is there any reason _not_ to attempt to expose a method like sendEvent that PhantomJS has? 
http://phantomjs.org/api/webpage/method/send-event.html

For this specific use case, I was able to get sendEvent working with PhantomJS events, but would prefer Nightmare because it's just a lot nicer/cleaner overall. Initially I just assumed it was an Electron bug/ swallowed event, but figured I'd ask first if it was working as intended. 

@rosshinkley I'm not sure this is fancy, but I'm not sure how to make the driver yet either. :)
 @rosshinkley do you have any idea why the `click()` (and `mouseover/mousedown`) action doesnâ€™t use `sendInputEvent`? Assuming no, since according to git, they pretty much appeared out of whole cloth, but asking just in case.

Seems like upgrading them to use `sendInputEvent` would be more â€œcorrect,â€ though it would change behavior slightly. (Maybe a good v3 change?)
 If it helps anyone here, I wrote a little example plugin for how to use `sendEvent` over on #639. @dsowsy for your case, just throw some `mousemove` events in between the `mousedown` and `mouseup`:

``` js
win.webContents.sendInputEvent({ type: 'mousemove', x: x, y: y });
```

It would be good to get a sense if this approach actually works for you and others experiencing issues before spending the effort cleaning it up for adding to core.
 > Given that it seems to be causing enough problems, I'd be open to moving it into core. Thoughts?

Well, it sounds like there are either some bugs with it or it is not solving the problem: https://github.com/segmentio/nightmare/issues/639#issuecomment-219953581 It needs feedback from @timotgl or I or someone should do some testing w/ React. I wouldnâ€™t want to change this part of core if it doesnâ€™t actually solve the issues people are encountering.

It also might be worth postponing to v3â€”it wonâ€™t work on elements that arenâ€™t being displayed (the current implementation does) and it will work differently than the current implementation on elements with children or that are obscured/overlapped by other elements (the events will go to the element at the click location, not necessarily to the element identified by the selector). Most of the time this should be a non-issue, but itâ€™ll almost certainly bite someone.
 Basic plugin that people can use here: https://github.com/Mr0grog/nightmare-real-mouse
Or just `npm install nightmare-real-mouse`

Maybe that can sit for a while and see if it solves issues for people?
 Sorry for the late answer. What you did looks great. I'll let you know as soon as I put my hands on it again...
  Hi Guys, nightmareJs returns me empty objects when I run the code below. 
I want to grab the stackoverflow questions from the main page. 

```
var Nightmare = require('nightmare');
var startingLink = "http://stackoverflow.com"

var nightmare = Nightmare({show:true});

nightmare 
    .goto(startingLink)
    .evaluate(function() {
        return document.getElementsByClassName('question-hyperlink')
    })
    .end()
    .then(function(content) {
        console.log(content);
    })
```

My Results

```
ming_o01 (master) nightmare1 $ DEBUG=nightmare node stackoverflow.js
  '48': {},
  '49': {},
  '50': {},
  '51': {},
  '52': {},
  '53': {},
  '54': {},
  '55': {},
  '56': {},
  '57': {},
  '58': {},
  '59': {},
  '60': {},
  '61': {},
  '62': {},
  '63': {},
  '64': {},
  '65': {},
  '66': {},
  '67': {},
  '68': {},
  '69': {},
  '70': {},
  '71': {},
  '72': {},
  '73': {},
  '74': {},
  '75': {},
  '76': {},
  '77': {},
  '78': {},
  '79': {},
  '80': {},
  '81': {},
  '82': {},
  '83': {},
  '84': {},
  '85': {},
  '86': {},
  '87': {},
  '88': {},
  '89': {},
  '90': {},
  '91': {},
  '92': {},
  '93': {},
  '94': {},
  '95': {} }
ming_o01 (master) nightmare1 $ ^C
```

Appreciate any advise. Thanks. 
 have you tried evaluating the same argument in the browser console?
 Works perfectly. 
 @rosshinkley @mingsterism
Using `Array.from()` is a nicer way to do this ;)

```
var Nightmare = require('nightmare');
var startingLink = "http://stackoverflow.com"

var nightmare = Nightmare({
  show: true
});

nightmare
  .goto(startingLink)
  .evaluate(function() {
    var elements = Array.from(document.getElementsByClassName('question-hyperlink'));
    return elements.map(function(element) {
      return {
        href: element.href,
        title: element.innerText
      }
    });
  })
  .end()
  .then(function(content) {
    console.log(content);
  })
```
  I am trying to make a screenshot at the bottom of the long page (e.g. http://www.taoism.net/ttc/complete.htm) like so:

```
oNightmare
    .viewport(1024, 30000)
    .goto('http://www.taoism.net/ttc/complete.htm')
    .wait()
    .screenshot(sImagePath, {
        x      : 0,
        y      : 27711,
        width  : 1024,
        height : 133
    });
```

Screenshot file size is 0 bytes. Tested with different `y` parameters, it works until ~8000px.
Expected: screenshot clip works with any `y` value.

Tried using `.scrollTo`, it did not help.
  Is it possible to remotely control other browsers? Thanks
  This issue may be related to #564 (I sometimes get the same error in that issue with this code). The following code will occasionally (about ~10% of the time) hang (with this example, it generally hangs on the 'https://teamtreehouse.com/' URL). Here is my code:

``` javascript
var Nightmare = require('nightmare');
var async = require('async');

var urls = [
    'https://www.spotify.com/uk/',
    'http://tiendas.mediamarkt.es/',
    'https://www.kairos.com/',
    'https://society6.com/',
    'https://teamtreehouse.com/',
    'https://www.npmjs.com/',
    'http://imgur.com/',
    'http://conversion.com',
    'http://adidas.com',
    'http://adp.com'
];

var q = async.queue(function (website, callback) {
    var nightmare = Nightmare({
        show: true, 
        dock: true,
    }).useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36').viewport(1280, 800);
    nightmare.goto(website.url)
    .evaluate(function() {
        return window;
    }).end().then(function(window){
        console.log('Window object available for: %s', website.url);
        callback(false, website.url);
    })
    .catch(function(err) {
        console.error(err);
        callback(err, 0);
    });
}, 10);

q.drain = function() {
    console.log('Finished all URLs');
    process.exit(1);
};

urls.forEach(function(url) {
    q.push({
        url: url
    }, function(err) {
        console.log('Finished processing: '+url);
    });
});
```

Here is the command I'm using `DEBUG=nightmare:actions,electron:* node --harmony nightmare.js` and the output:

``` cli
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +0ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +63ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +229ms
  nightmare:actions .viewport() +14ms
  nightmare:actions .viewport() +31ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +130ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +45ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +54ms
  nightmare:actions .viewport() +11ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +149ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +27ms
  nightmare:actions .viewport() +51ms
  nightmare:actions .viewport() +1ms
  nightmare:actions .viewport() +56ms
  nightmare:actions .viewport() +29ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +100ms
  nightmare:actions .viewport() +162ms
  nightmare:actions .viewport() +108ms
  nightmare:actions .useragent() to Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36 +105ms
  nightmare:actions .viewport() +114ms
  electron:stderr Apr 29 11:49:05  Electron Helper[6649] <Error>: CGAffineTransformInvert: singular matrix. +3s
  electron:stderr Apr 29 11:49:05  Electron Helper[6657] <Error>: CGAffineTransformInvert: singular matrix. +16ms
  nightmare:actions .evaluate() fn on the page +1s
Window object available for: http://conversion.com
Finished processing: http://conversion.com
  nightmare:actions .evaluate() fn on the page +1s
  electron:stderr Apr 29 11:49:08  Electron Helper[6663] <Error>: CGAffineTransformInvert: singular matrix. +336ms
  electron:stderr Apr 29 11:49:08  Electron Helper[6663] <Error>: CGAffineTransformInvert: singular matrix. +3ms
Window object available for: https://www.npmjs.com/
Finished processing: https://www.npmjs.com/
  nightmare:actions .evaluate() fn on the page +1s
Window object available for: http://adidas.com
Finished processing: http://adidas.com
  nightmare:actions .evaluate() fn on the page +1s
  nightmare:actions .evaluate() fn on the page +24ms
Window object available for: http://imgur.com/
Finished processing: http://imgur.com/
Window object available for: https://www.spotify.com/uk/
Finished processing: https://www.spotify.com/uk/
  nightmare:actions .evaluate() fn on the page +1s
  nightmare:actions .evaluate() fn on the page +372ms
Window object available for: https://www.kairos.com/
Finished processing: https://www.kairos.com/
Window object available for: http://adp.com
Finished processing: http://adp.com
  nightmare:actions .evaluate() fn on the page +695ms
Window object available for: https://society6.com/
Finished processing: https://society6.com/
  nightmare:actions .evaluate() fn on the page +2s
Window object available for: http://tiendas.mediamarkt.es/
Finished processing: http://tiendas.mediamarkt.es/
```

The result is that occasionally it displays the fully loaded page but does nothing with it:
![screen shot 2016-04-29 at 11 36 20](https://cloud.githubusercontent.com/assets/8442161/14913993/9f661050-0dfe-11e6-961c-61458404e01b.png)

My node version is `v4.4.3` and here is my `package.json`:

``` json
{
  "name": "node.js-test-files",
  "version": "1.0.0",
  "description": "Testing Folder",
  "main": "test.js",
  "scripts": {
    "test": "node test.js"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "async": "^2.0.0-rc.3",
    "nightmare": "^2.3.4"
  }
}
```
 @JWMarchant it might be helpful to see the logs with `nightmare:*` instead of just `nightmare:actions` â€” anything happening in the electron process goes under `nightmare:log`, so there might be some good details missing in your debug output above.

I wouldnâ€™t _think_ this is related to #405 since you are stilling seeing the window just hanging around open, so itâ€™s not crashing.
 Hi guys,

Here are the logs with `nightmare:*` run:

``` cli
  nightmare:log did-get-response-details +13ms [{},false,"http://www.google-analytics.com/analytics.js","http://www.google-analytics.com/analytics.js",200,"GET","http://www.adp.com/",{"age":["4493"],"cache-control":["public, max-age=7200"],"content-encoding":["gzip"],"content-length":["10938"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 08:25:12 GMT"],"expires":["Tue, 03 May 2016 10:25:12 GMT"],"last-modified":["Mon, 04 Apr 2016 19:58:52 GMT"],"server":["Golfe2"],"strict-transport-security":["max-age=10886400"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"]},"script"]
  nightmare:log did-get-redirect-request +21ms [{},"https://www.google.com/ads/user-lists/1018590256/?fmt=1&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=1063845615","https://www.google.co.uk/ads/user-lists/1018590256/?fmt=1&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=1063845615&ipr=y",false,302,"GET","http://www.adp.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=43200"],"content-length":["345"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Tue, 03 May 2016 09:40:05 GMT"],"location":["https://www.google.co.uk/ads/user-lists/1018590256/?fmt=1&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=1063845615&ipr=y"],"server":["adclick_server"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
Window object available for: https://www.spotify.com/uk/
Finished processing: https://www.spotify.com/uk/
  nightmare:log did-frame-finish-load +18ms [{},false]
  nightmare:log page-favicon-updated +0ms [{},["http://s.imgur.com/images/favicon-16x16.png","http://s.imgur.com/images/favicon-32x32.png","http://s.imgur.com/images/favicon-96x96.png"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:log navigated to: http://imgur.com/ +0ms
Window object available for: http://imgur.com/
Finished processing: http://imgur.com/
  nightmare:log did-frame-finish-load +22ms [{},false]
  nightmare:log did-get-response-details +31ms [{},false,"https://js-agent.newrelic.com/nr-918.min.js","https://js-agent.newrelic.com/nr-918.min.js",200,"GET","https://society6.com/",{"accept-ranges":["bytes"],"cache-control":["public, max-age=3600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["8668"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"etag":["\"07fddb3720b5e77e10d486281e40571d\""],"last-modified":["Mon, 28 Mar 2016 18:05:52 GMT"],"server":["AmazonS3"],"vary":["Accept-Encoding"],"via":["1.1 varnish"],"x-amz-id-2":["3IhOCqiuFS++bjx9vWXECygJbH9uu+1DzArThUvxxqV/Yl9zilMOloOybrXVZZPenEUxEPVKI4s="],"x-amz-request-id":["A720618EE0E50170"],"x-cache":["HIT"],"x-cache-hits":["28220"],"x-served-by":["cache-lcy1121-LCY"],"x-timer":["S1462268405.758130,VS0,VE0"]},"script"]
  nightmare:log did-get-response-details +20ms [{},false,"https://pixel-geo.prfct.co/tagjs?a_id=57309&source=js_tag","https://pixel-geo.prfct.co/tagjs?a_id=57309&source=js_tag",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["17"],"content-type":["text/javascript"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 09:40:05 GMT"]},"script"]
  nightmare:log did-get-response-details +7ms [{},false,"http://maps.google.com/maps-api-v3/api/js/24/10/common.js","http://maps.google.com/maps-api-v3/api/js/24/10/common.js",200,"GET","http://www.adp.com/",{"age":["453287"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["39825"],"content-type":["text/javascript"],"date":["Thu, 28 Apr 2016 03:45:18 GMT"],"expires":["Fri, 28 Apr 2017 03:45:18 GMT"],"last-modified":["Thu, 28 Apr 2016 01:57:56 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"http://maps.google.com/maps-api-v3/api/js/24/10/util.js","http://maps.google.com/maps-api-v3/api/js/24/10/util.js",200,"GET","http://www.adp.com/",{"age":["453287"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["48951"],"content-type":["text/javascript"],"date":["Thu, 28 Apr 2016 03:45:18 GMT"],"expires":["Fri, 28 Apr 2017 03:45:18 GMT"],"last-modified":["Thu, 28 Apr 2016 01:57:56 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +9ms [{},false,"http://maps.google.com/maps-api-v3/api/js/24/10/geocoder.js","http://maps.google.com/maps-api-v3/api/js/24/10/geocoder.js",200,"GET","http://www.adp.com/",{"age":["453253"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["1322"],"content-type":["text/javascript"],"date":["Thu, 28 Apr 2016 03:45:52 GMT"],"expires":["Fri, 28 Apr 2017 03:45:52 GMT"],"last-modified":["Thu, 28 Apr 2016 01:57:56 GMT"],"server":["sffe"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +54ms [{},false,"https://198303326.log.optimizely.com/event?a=198303326&d=165817466&y=false&src=js&s198340375=direct&s198416283=none&s198418477=gc&s198472144=false&tsent=1462268405.431&n=http%3A%2F%2Fwww.adp.com%2F&u=oeu1461674055670r0.8735515501445965&wxhr=true&time=1462268405.429&f=3557235677,3682661375,3720860750,4037112366,4055726617,4063513794,5757182983,5554450059,5197570703,5551810089,5547530537,5198762931,5546670265,5571740058,5014840391,4791624160,5117160161,4605877223,5193954937&g=&cx2=61bf12f0","https://198303326.log.optimizely.com/event?a=198303326&d=165817466&y=false&src=js&s198340375=direct&s198416283=none&s198418477=gc&s198472144=false&tsent=1462268405.431&n=http%3A%2F%2Fwww.adp.com%2F&u=oeu1461674055670r0.8735515501445965&wxhr=true&time=1462268405.429&f=3557235677,3682661375,3720860750,4037112366,4055726617,4063513794,5757182983,5554450059,5197570703,5551810089,5547530537,5198762931,5546670265,5571740058,5014840391,4791624160,5117160161,4605877223,5193954937&g=&cx2=61bf12f0",200,"GET","http://www.adp.com/",{"access-control-allow-credentials":["true"],"access-control-allow-headers":["Content-Type, X-Requested-With"],"access-control-allow-methods":["GET"],"access-control-allow-origin":["http://www.adp.com"],"connection":["keep-alive"],"content-length":["2"],"content-type":["application/json"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"p3p":["CP=\"IDC DSP COR CURa ADMa OUR IND PHY ONL COM STA\""],"server":["nginx"]},"xhr"]
  nightmare:log did-get-response-details +2ms [{},false,"https://www.google.co.uk/ads/user-lists/1018590256/?fmt=1&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=1063845615&ipr=y","https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1018590256/?random=1462268404372&cv=8&fst=1462268404372&num=1&fmt=1&guid=ON&u_h=1080&u_w=1920&u_ah=1053&u_aw=1920&u_cd=24&u_his=1&u_tz=60&u_java=false&u_nplug=0&u_nmime=0&frm=0&url=http%3A//www.adp.com/&tiba=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management",200,"GET","http://www.adp.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-length":["76"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["adclick_server"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"subFrame"]
  nightmare:log did-get-redirect-request +2ms [{},"https://www.google.com/ads/user-lists/1017883234/?fmt=3&num=1&cv=8&frm=0&url=https%3A//teamtreehouse.com/&random=2806200099","https://www.google.co.uk/ads/user-lists/1017883234/?fmt=3&num=1&cv=8&frm=0&url=https%3A//teamtreehouse.com/&random=2806200099&ipr=y",false,302,"GET","https://teamtreehouse.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=43200"],"content-length":["352"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Tue, 03 May 2016 09:40:05 GMT"],"location":["https://www.google.co.uk/ads/user-lists/1017883234/?fmt=3&num=1&cv=8&frm=0&url=https%3A//teamtreehouse.com/&random=2806200099&ipr=y"],"server":["adclick_server"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +7ms [{},false,"http://csi.gstatic.com/csi?v=2&s=mapsapi3&v3v=24.10&action=apiboot2&e=10_1_0,10_2_0,11_9_0,11_10_0,11_14_U&rt=main.50","http://csi.gstatic.com/csi?v=2&s=mapsapi3&v3v=24.10&action=apiboot2&e=10_1_0,10_2_0,11_9_0,11_10_0,11_14_U&rt=main.50",204,"GET","http://www.adp.com/",{"access-control-allow-origin":["*"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Wed, 21 Jan 2004 19:51:30 GMT"],"pragma":["no-cache"],"server":["Golfe2"]},"image"]
  nightmare:log did-get-redirect-request +24ms [{},"https://sslwidget.criteo.com/event?a=24635&v=3.6.1&p0=e%3Dexd%26site_type%3Dd&p1=e%3Dce%26m%3D%255B%255D%26h%3Dnone&p2=e%3Dvh&p3=e%3Ddis&adce=1","https://widget.us.criteo.com/event?a=24635&v=3.6.1&p0=e%3Dexd%26site_type%3Dd&p1=e%3Dce%26m%3D%255B%255D%26h%3Dnone&p2=e%3Dvh&p3=e%3Ddis&adce=1",false,302,"GET","https://teamtreehouse.com/",{"content-length":["284"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"location":["https://widget.us.criteo.com/event?a=24635&v=3.6.1&p0=e%3Dexd%26site_type%3Dd&p1=e%3Dce%26m%3D%255B%255D%26h%3Dnone&p2=e%3Dvh&p3=e%3Ddis&adce=1"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]}]
  nightmare:log did-get-response-details +9ms [{},false,"http://now.eloqua.com/visitor/v200/svrGP.aspx?pps=70&siteid=937&ref=http://www.adp.com/&ms=778","http://now.eloqua.com/visitor/v200/svrGP.aspx?pps=70&siteid=937&ref=http://www.adp.com/&ms=778",200,"GET","http://www.adp.com/",{"cache-control":["private"],"content-encoding":["gzip"],"content-length":["106"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:39:42 GMT"],"p3p":["CP=\"IDC DSP COR DEVa TAIa OUR BUS PHY ONL UNI COM NAV CNT STA\""],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +18ms [{},false,"https://dx.steelhousemedia.com/spx?dxver=4.0.0&shaid=12271&tdr=&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750","https://dx.steelhousemedia.com/spx?dxver=4.0.0&shaid=12271&tdr=&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750",200,"GET","https://teamtreehouse.com/",{"connection":["close"],"content-encoding":["gzip"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"transfer-encoding":["chunked"]},"script"]
  nightmare:log did-get-response-details +103ms [{},false,"http://www.google-analytics.com/collect?v=1&_v=j41&a=2023425765&t=pageview&_s=1&dl=http%3A%2F%2Fwww.adp.com%2F&ul=en-us&de=UTF-8&dt=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&sd=24-bit&sr=1920x1080&vp=1265x778&je=0&_u=AACAAEABI~&jid=&cid=101117405.1461674056&tid=UA-38583288-1&z=699946190","http://www.google-analytics.com/collect?v=1&_v=j41&a=2023425765&t=pageview&_s=1&dl=http%3A%2F%2Fwww.adp.com%2F&ul=en-us&de=UTF-8&dt=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&sd=24-bit&sr=1920x1080&vp=1265x778&je=0&_u=AACAAEABI~&jid=&cid=101117405.1461674056&tid=UA-38583288-1&z=699946190",200,"GET","http://www.adp.com/",{"access-control-allow-origin":["*"],"age":["407785"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Thu, 28 Apr 2016 16:23:41 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-get-response-details +18ms [{},false,"https://www.google.co.uk/ads/user-lists/1017883234/?fmt=3&num=1&cv=8&frm=0&url=https%3A//teamtreehouse.com/&random=2806200099&ipr=y","https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1017883234/?random=1462268405440&cv=8&fst=1462268405440&num=1&fmt=3&guid=ON&u_h=1080&u_w=1920&u_ah=1053&u_aw=1920&u_cd=24&u_his=1&u_tz=60&u_java=false&u_nplug=0&u_nmime=0&frm=0&url=https%3A//teamtreehouse.com/&tiba=Start%20Learning%20at%20Treehouse%20for%20Free&async=1",200,"GET","https://teamtreehouse.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["adclick_server"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +39ms [{},false,"https://www.facebook.com/tr/?id=1649418102002310&ev=PageView&dl=https%3A%2F%2Fwww.kairos.com%2F&rl=&if=false&ts=1462268406047&v=2.5.0&pv=visible","https://www.facebook.com/tr/?id=1649418102002310&ev=PageView&dl=https%3A%2F%2Fwww.kairos.com%2F&rl=&if=false&ts=1462268406047&v=2.5.0&pv=visible",200,"GET","https://www.kairos.com/",{"cache-control":["no-cache, must-revalidate, max-age=0"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Fri, 21 Dec 2012 00:00:01 GMT"],"server":["proxygen"],"status":["200"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://cdn.krxd.net/userdata/get?pub=66822801-aa35-4f0d-a6ab-78970028f03f&callback=Krux.ns.demandmedia.kxjsonp_userdata","https://cdn.krxd.net/userdata/get?pub=66822801-aa35-4f0d-a6ab-78970028f03f&callback=Krux.ns.demandmedia.kxjsonp_userdata",200,"GET","https://society6.com/",{"accept-ranges":["bytes"],"age":["23"],"cache-control":["private, max-age=1800"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["333"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"vary":["Accept-Encoding"],"via":["1.1 varnish"],"x-age":["0"],"x-cache":["MISS, HIT"],"x-cache-hits":["0, 1"],"x-cdn-backend":["4FrRTvEr9h480D4BywjehZ--F_userdata_krxd_net___UserData_Service_V2"],"x-request-backend":["kuser_data"],"x-served-by":["userdata-a004.krxd.net, cache-lcy1129-LCY"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"https://analytics.twitter.com/i/adsct?p_id=Twitter&p_user_id=0&txn_id=nujee&tw_sale_amount=0&tw_order_quantity=0&tw_iframe_status=0","https://analytics.twitter.com/i/adsct?p_id=Twitter&p_user_id=0&txn_id=nujee&tw_sale_amount=0&tw_order_quantity=0&tw_iframe_status=0",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-encoding":["gzip"],"content-length":["65"],"content-type":["image/gif;charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 03 May 2016 09:40:06 GMT"],"pragma":["no-cache"],"server":["tsa_b"],"status":["200","200 OK"],"strict-transport-security":["max-age=631138519"],"x-connection-hash":["2ec96cfd4ad1d747f8026a62ae7bffa2"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["6"],"x-transaction":["33f1636a1be5bd23"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +14ms [{},false,"http://js.bizographics.com/insight.min.js","http://js.bizographics.com/insight.min.js",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"age":["50278"],"cache-control":["max-age=86400"],"connection":["keep-alive"],"content-length":["22455"],"content-type":["application/x-javascript"],"date":["Mon, 14 Mar 2016 17:38:43 GMT"],"etag":["\"67534aa7df24f127de4c55f40c1d8b41\""],"last-modified":["Wed, 14 Oct 2015 17:36:09 GMT"],"server":["AmazonS3"],"via":["1.1 18ab487c2f9a73b18d18515f1dde6556.cloudfront.net (CloudFront)"],"x-amz-cf-id":["wxjDOFriG0eKlaWw24da6ML59_s6mKQcKAAbKjREkByochCaaB1tMQ=="],"x-amz-version-id":["xpIc4sjZ8hNDnvkdGEErMrBF013uhXGt"],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"http://cdn.getsmartcontent.com/ND424NFK.js","http://cdn.getsmartcontent.com/ND424NFK.js",200,"GET","http://www.adp.com/",{"cache-control":["public, max-age=900"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["W/\"712f60292e3bcca11df70cb32b98cdac\""],"last-modified":["Wed, 27 Apr 2016 22:37:35 GMT"],"server":["NetDNA-cache/2.2"],"transfer-encoding":["chunked"],"x-amz-id-2":["kD4GEu0fdwOKD10Oud4sqHbZ3bbu7HdK3cauGbulqQh9RmYPLWhANGVUvH8nrxpYIK+x0LMUm6M="],"x-amz-request-id":["A27AED4B6C812586"],"x-cache":["HIT"]},"script"]
  nightmare:log did-get-response-details +17ms [{},false,"http://www.googleadservices.com/pagead/conversion_async.js","http://www.googleadservices.com/pagead/conversion_async.js",200,"GET","http://www.adp.com/",{"cache-control":["private, max-age=86400"],"content-disposition":["attachment; filename=\"f.txt\""],"content-encoding":["gzip"],"content-length":["3053"],"content-type":["text/javascript; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["15651140183788128597"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"p3p":["policyref=\"http://www.googleadservices.com/pagead/p3p.xml\", CP=\"NOI DEV PSA PSD IVA IVD OTP OUR OTR IND OTC\""],"server":["cafe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://t.co/i/adsct?p_id=Twitter&p_user_id=0&txn_id=nujee&tw_sale_amount=0&tw_order_quantity=0&tw_iframe_status=0","https://t.co/i/adsct?p_id=Twitter&p_user_id=0&txn_id=nujee&tw_sale_amount=0&tw_order_quantity=0&tw_iframe_status=0",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-encoding":["gzip"],"content-length":["65"],"content-type":["image/gif;charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 03 May 2016 09:40:06 GMT"],"pragma":["no-cache"],"server":["tsa_b"],"status":["200","200 OK"],"strict-transport-security":["max-age=0"],"x-connection-hash":["cd6e7e9cff7507d844dac7cd03c9e5cb"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["6"],"x-transaction":["7f1af8952638e7f4"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +9ms [{},false,"http://j.6sc.co/6si.min.js","http://j.6sc.co/6si.min.js",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-headers":["*"],"access-control-allow-methods":["GET,POST"],"access-control-allow-origin":[""],"access-control-max-age":["86400"],"connection":["keep-alive"],"content-length":["13360"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["\"57118969-3430\""],"last-modified":["Sat, 16 Apr 2016 00:38:01 GMT"],"server":["nginx/1.8.1"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://connect.facebook.net/en_US/fbevents.js","http://connect.facebook.net/en_US/fbevents.js",200,"GET","http://www.adp.com/",{"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["3663"],"content-md5":["3P+c6fqWtmLHLUTg3yCipQ=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["\"44fd33153db94d7371ce02d34b8a6972\""],"expires":["Tue, 03 May 2016 09:42:52 GMT"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-fb-debug":["coZ95FNAAREiHVe77LJCnHVuHlVEB/A0QwFqpL9eH6qgVSWpCMGgzDNL0HNHnC+JGlUIVfDUbn4txiAULbza2g=="]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"https://s.yimg.com/wi/ytc.js","https://s.yimg.com/wi/ytc.js",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"age":["6013"],"cache-control":["max-age=7200"],"content-encoding":["gzip"],"content-length":["3553"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 07:59:53 GMT"],"expires":["Tue, 03 May 2016 09:59:53 GMT"],"last-modified":["Fri, 18 Dec 2015 17:04:06 GMT"],"server":["ATS"],"status":["200"],"vary":["Accept-Encoding"],"via":["http/1.1 spdc0005.pbp.ir2.yahoo.com (ApacheTrafficServer), https/1.1 l6.ycs.loa.yahoo.com (ApacheTrafficServer [cRs f ])"],"y-trace":["BAEAQAAAAAA_KEHMzv2q0gAAAAAAAAAAuBdjTtNEHAkAAAAAAAAAAAAFMezk6dcYAAUx7OTp2D32vfT0AAAAAA--"]},"script"]
  nightmare:log did-get-response-details +24ms [{},false,"https://beacon.krxd.net/optout_check?callback=Krux.ns.demandmedia.kxjsonp_optOutCheck","https://beacon.krxd.net/optout_check?callback=Krux.ns.demandmedia.kxjsonp_optOutCheck",200,"GET","https://society6.com/",{"cache-control":["private, max-age=0, s-max-age=0"],"connection":["keep-alive"],"content-length":["93"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a244-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 23:00:05 GMT"],"x-request-time":["D=214 t=1462268405624653"],"x-served-by":["beacon-a244-dub.krxd.net"]},"script"]
  nightmare:log did-get-response-details +66ms [{},false,"http://bat.bing.com/bat.js","http://bat.bing.com/bat.js",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-encoding":["gzip"],"content-length":["2770"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"etag":["\"0ea19534e8cd11:0\""],"last-modified":["Fri, 01 Apr 2016 19:40:20 GMT"],"server":["Microsoft-IIS/8.5"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log did-get-response-details +60ms [{},false,"https://s7.addthis.com/static/layers.a7702f25264fb009847d.js","https://s7.addthis.com/static/layers.a7702f25264fb009847d.js",200,"GET","https://www.kairos.com/",{"cache-control":["public, no-check, max-age=86313600"],"cf-cache-status":["HIT"],"cf-ray":["29d2bfe31d9f3506-LHR"],"content-encoding":["gzip"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Mon, 02 May 2016 17:57:16 GMT"],"server":["cloudflare-nginx"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-host":["s7.addthis.com"]},"script"]
  nightmare:log did-get-response-details +15ms [{},false,"https://m.addthis.com/live/boost?pub=ra-54e5170351df8b3a&callback=_ate.track.config_resp","https://m.addthis.com/live/boost?pub=ra-54e5170351df8b3a&callback=_ate.track.config_resp",200,"GET","https://www.kairos.com/",{"cache-control":["public, max-age=60, s-maxage=86400"],"cf-cache-status":["HIT"],"cf-ray":["29d2bfe3476334dc-LHR"],"content-encoding":["gzip"],"content-length":["510"],"content-type":["application/javascript;charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["-1036988394"],"server":["cloudflare-nginx"],"status":["200"],"surrogate-key":["ra-54e5170351df8b3a"],"vary":["Accept-Encoding"]},"script"]
  nightmare:log dom-ready +47ms [{}]
  nightmare:log did-get-response-details +17ms [{},false,"https://s7.addthis.com/static/menu.2035b368a9dbff642aac.js","https://s7.addthis.com/static/menu.2035b368a9dbff642aac.js",200,"GET","https://www.kairos.com/",{"accept-ranges":["bytes"],"cache-control":["public, no-check, max-age=86313600"],"cf-cache-status":["HIT"],"cf-ray":["29d2bfe3bdaa3506-LHR"],"content-encoding":["gzip"],"content-length":["14753"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Mon, 02 May 2016 17:57:16 GMT"],"server":["cloudflare-nginx"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-host":["s7.addthis.com"]},"script"]
  nightmare:log did-frame-finish-load +4ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +1ms [{},["https://www.kairos.com/templates/t3_bs3_blank/favicon.ico","https://www.kairos.com/templates/t3_bs3_blank/kairos-favicon.svg"]]
  nightmare:log did-stop-loading +1ms [{}]
  nightmare:actions .evaluate() fn on the page +1ms
  nightmare:log did-get-response-details +0ms [{},false,"https://widget.us.criteo.com/event?a=24635&v=3.6.1&p0=e%3Dexd%26site_type%3Dd&p1=e%3Dce%26m%3D%255B%255D%26h%3Dnone&p2=e%3Dvh&p3=e%3Ddis&adce=1","https://sslwidget.criteo.com/event?a=24635&v=3.6.1&p0=e%3Dexd%26site_type%3Dd&p1=e%3Dce%26m%3D%255B%255D%26h%3Dnone&p2=e%3Dvh&p3=e%3Ddis&adce=1",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-cache"],"content-length":["895"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["-1"],"p3p":["NON DSP COR CURa PSA PSD OUR BUS NAV STA"],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"script"]
  nightmare:log did-get-response-details +8ms [{},false,"http://www.adp.com/ADP%20USA%202015/images/overlay.png","http://www.adp.com/ADP%20USA%202015/images/overlay.png",200,"GET","http://www.adp.com/ADP%20USA%202015/css/colorbox.css",{"accept-ranges":["bytes"],"access-control-allow-methods":["GET,POST,OPTIONS"],"access-control-allow-origin":["*"],"cache-control":["max-age=86400, max-age=432000"],"connection":["Keep-Alive"],"content-length":["954"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"etag":["\"7640102a9991d11:0\""],"expires":["Sun, 08 May 2016 09:40:06 GMT"],"keep-alive":["timeout=5, max=81"],"last-modified":["Fri, 08 Apr 2016 13:18:39 GMT"],"server":["Microsoft-IIS/7.5"],"x-powered-by":["ASP.NET"],"x-ua-compatible":["IE=9"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.adp.com/ADP%20USA%202015/images/home-hero-pager.png","http://www.adp.com/ADP%20USA%202015/images/home-hero-pager.png",200,"GET","http://www.adp.com/ADP%20USA%202015/css/main.css",{"accept-ranges":["bytes"],"access-control-allow-methods":["GET,POST,OPTIONS"],"access-control-allow-origin":["*"],"cache-control":["max-age=86400, max-age=432000"],"connection":["Keep-Alive"],"content-length":["1167"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"etag":["\"c27bd7299991d11:0\""],"expires":["Sun, 08 May 2016 09:40:06 GMT"],"keep-alive":["timeout=5, max=84"],"last-modified":["Fri, 08 Apr 2016 13:18:38 GMT"],"server":["Microsoft-IIS/7.5"],"x-powered-by":["ASP.NET"],"x-ua-compatible":["IE=9"]},"image"]
  nightmare:log did-start-loading +12ms [{}]
  nightmare:log did-get-response-details +11ms [{},false,"https://s7.addthis.com/static/sh.f7bb2665ec36f40231cf9d0b.html#rand=0.49331860220991075&iit=1462268406251&tmr=load%3D1462268405239%26core%3D1462268405914%26main%3D1462268406229%26ifr%3D1462268406285&cb=0&cdn=0&md=0&kw=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&ab=-&dh=www.kairos.com&dr=&du=https%3A%2F%2Fwww.kairos.com%2F&href=https%3A%2F%2Fwww.kairos.com%2F&dt=Human%20Analytics%2C%20Face%20Recognition%20%26%20Analysis%20%7C%20Kairos&dbg=0&cap=tc%3D0%26ab%3D0&inst=1&jsl=8193&prod=undefined&lng=en-gb&ogt=&pc=men&pub=ra-54e5170351df8b3a&ssl=1&sid=572871f50a2f09e9&srpl=1&srf=0.01&srx=1&ver=300&xck=0&xtr=0&og=&csi=undefined&rev=v5.12.0-wp&ct=1&xld=1&xd=1","https://s7.addthis.com/static/sh.f7bb2665ec36f40231cf9d0b.html#rand=0.49331860220991075&iit=1462268406251&tmr=load%3D1462268405239%26core%3D1462268405914%26main%3D1462268406229%26ifr%3D1462268406285&cb=0&cdn=0&md=0&kw=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&ab=-&dh=www.kairos.com&dr=&du=https%3A%2F%2Fwww.kairos.com%2F&href=https%3A%2F%2Fwww.kairos.com%2F&dt=Human%20Analytics%2C%20Face%20Recognition%20%26%20Analysis%20%7C%20Kairos&dbg=0&cap=tc%3D0%26ab%3D0&inst=1&jsl=8193&prod=undefined&lng=en-gb&ogt=&pc=men&pub=ra-54e5170351df8b3a&ssl=1&sid=572871f50a2f09e9&srpl=1&srf=0.01&srx=1&ver=300&xck=0&xtr=0&og=&csi=undefined&rev=v5.12.0-wp&ct=1&xld=1&xd=1",200,"GET","https://www.kairos.com/",{"accept-ranges":["bytes"],"cache-control":["public, no-check, max-age=86313600"],"cf-cache-status":["HIT"],"cf-ray":["29d2bfe3edae3506-LHR"],"content-encoding":["gzip"],"content-length":["27174"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Mon, 02 May 2016 17:56:13 GMT"],"p3p":["CP=\"NON ADM OUR DEV IND COM STA\""],"server":["cloudflare-nginx"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-host":["s7.addthis.com"]},"subFrame"]
  nightmare:log did-frame-finish-load +98ms [{},false]
  nightmare:log did-get-response-details +2ms [{},false,"https://px.steelhousemedia.com/st?fdx=1&dxver=4.0.0&shaid=12271&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750&shpn=treehouse&shpi=http%3A%2F%2Fblog.teamtreehouse.com%2Fwp-content%2Fuploads%2F2016%2F04%2FGitHub-Basics.png&shps=treehouse","https://px.steelhousemedia.com/st?fdx=1&dxver=4.0.0&shaid=12271&plh=https%3A%2F%2Fteamtreehouse.com%2F&cb=91603207779356750&shpn=treehouse&shpi=http%3A%2F%2Fblog.teamtreehouse.com%2Fwp-content%2Fuploads%2F2016%2F04%2FGitHub-Basics.png&shps=treehouse",200,"GET","https://teamtreehouse.com/",{"access-control-allow-origin":["*"],"connection":["close"],"content-encoding":["gzip"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NON DSP COR NID CURa ADMa DEVa PSAa PSDa OUR STP UNI COM NAV INT STA PRE\""],"set-cookie":["guid=b1965d13-9e87-426b-bca9-509290aec6cb;Path=/;Domain=.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT","rt=\"MTIwNzY6MTQ2MTg1OTU2OCwxMTg5OToxNDYxNzUyNDk5LDExNTc2OjE0NjE3NjY4MzgsMTIzMDg6MTQ2MTc2MDk2NywxMDU3OToxNDYxNzY3NTUwLDEyMjcxOjE0NjAxMzAwMjgsMTE3MjM6MTQ2MTc1OTk4Mw==\";Path=/;Domain=.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT","tt=\"H4sIAAAAAAAAAG1USZIkMQj7S537gDGL3Y+Yw3ygftGXjvn7eMGZoqpOGUHKIITg9/Hn77OQNX8yKz++y9eKlO785FbbiXTxAfFeXwNyvSH1/pT++GYE6A0orffIITvClVpE/OuRqooVt6JiVnqAidvKf9I513hcDwPKJK+I5M7es0yaFXtH4kFzRjzlrfpSCRQ7eTKbUat5uTHqFhGGLq/qhch6ksRrlzolCVbXr87qzCwl5UnV/aSKWmvuocUhd1VSUWnKOiuVxfL8akZt5J+Vxif/GtSaMBsU+NQwkmjUk9zLODChALzrCFoHjVvH7T6E7PaXFTg9Qi6BqSsSGmLf7uKlxXP2cniRTQUX0RuupZKRpM5PblAH27hHGkbjYuUFsyOg6bIejNGTYawRU5e5Xsvq9y/xPoTUOn9pGuN4NUzmQuilQyJxCjCNwadxJeXHabkjOJmt0rASFUsqKUxpybzxZKDT7NixwrU0+9CAlVm6mk4NMJvYMKqa+ZgS5EHr7bxhPdygWEYdiUnhkszHFYS4xgKz3stqY1t7Pid4cpbGp/LPi2cSkj77ChcGBJGMgcM4lb/PN7plOgSHuHqfN6DqtThUP12bD4Ncxk2D3DFPXluof/8Bdr88B58GAAA=\";Path=/;Domain=.px.steelhousemedia.com;Expires=Fri, 03-May-2019 09:40:06 GMT"]},"script"]
  nightmare:log did-get-response-details +17ms [{},false,"https://beacon.krxd.net/pixel.gif?source=smarttag&fired=report&confid=JprpolCG&_kpid=66822801-aa35-4f0d-a6ab-78970028f03f&_kcp_s=society6.com&_kcp_d=society6.com&_knifr=4&_kua_kx_tz=-60&geo_country=uk&geo_region=lnd&geo_dma=826044&_kua_kx_lang=en-us&_kua_kx_tech_browser_language=en-us&_kua_kx_geo_country=uk&_kua_kx_geo_region=lnd&_kua_kx_geo_dma=826044&_kua_kx_tech_browser=Chrome&_kua_kx_tech_manufacturer=Apple%20Inc.&_kua_kx_tech_device=Computer&_kua_kx_tech_os=Mac%20OS%20X&_kua_kx_whistle=0&_kpa_domain=society6.com&_kpa_pagetype=home&_kpa_subpagetype=home&_kpa_title=Society6%20%7C%20Affordable%20Art%20Prints%2C%20iPhone%20Cases%20and%20T-shirts&kx_streaming=1&t_navigation_type=0&t_dns=14&t_tcp=646&t_http_request=-1&t_http_response=2&t_content_ready=6909&t_window_load=10319&t_redirect=0&interchange_ran=false&userdata_was_requested=true&userdata_did_respond=true&store_user_after=qlfi24omj&store_segs_after=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&userdata_user=KdjQEHAZ%2Cqlfi24omj&userdata_segs=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&_kpa_dfpsite=viewthroughconversion&_kpa_dfpzone=980702394&sview=1&kplt0=17990&kplt9=17981&kplt26=18066&kplt27=18067&kplt28=18068&jsonp_requests=%2F%2Fbeacon.krxd.net%2Foptout_check%2C240%2C%2F%2Fcdn.krxd.net%2Fuserdata%2Fget%2C163","https://beacon.krxd.net/pixel.gif?source=smarttag&fired=report&confid=JprpolCG&_kpid=66822801-aa35-4f0d-a6ab-78970028f03f&_kcp_s=society6.com&_kcp_d=society6.com&_knifr=4&_kua_kx_tz=-60&geo_country=uk&geo_region=lnd&geo_dma=826044&_kua_kx_lang=en-us&_kua_kx_tech_browser_language=en-us&_kua_kx_geo_country=uk&_kua_kx_geo_region=lnd&_kua_kx_geo_dma=826044&_kua_kx_tech_browser=Chrome&_kua_kx_tech_manufacturer=Apple%20Inc.&_kua_kx_tech_device=Computer&_kua_kx_tech_os=Mac%20OS%20X&_kua_kx_whistle=0&_kpa_domain=society6.com&_kpa_pagetype=home&_kpa_subpagetype=home&_kpa_title=Society6%20%7C%20Affordable%20Art%20Prints%2C%20iPhone%20Cases%20and%20T-shirts&kx_streaming=1&t_navigation_type=0&t_dns=14&t_tcp=646&t_http_request=-1&t_http_response=2&t_content_ready=6909&t_window_load=10319&t_redirect=0&interchange_ran=false&userdata_was_requested=true&userdata_did_respond=true&store_user_after=qlfi24omj&store_segs_after=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&userdata_user=KdjQEHAZ%2Cqlfi24omj&userdata_segs=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&_kpa_dfpsite=viewthroughconversion&_kpa_dfpzone=980702394&sview=1&kplt0=17990&kplt9=17981&kplt26=18066&kplt27=18067&kplt28=18068&jsonp_requests=%2F%2Fbeacon.krxd.net%2Foptout_check%2C240%2C%2F%2Fcdn.krxd.net%2Fuserdata%2Fget%2C163",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a225-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 23:00:05 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 09:40:05 GMT; domain=.krxd.net"],"x-request-time":["D=206 t=1462268405990677"],"x-served-by":["beacon-a225-dub.krxd.net"]},"image"]
  nightmare:log did-frame-finish-load +1ms [{},false]
  nightmare:log did-get-response-details +19ms [{},false,"https://connect.facebook.net/en_US/fbevents.js","https://connect.facebook.net/en_US/fbevents.js",200,"GET","https://teamtreehouse.com/",{"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["3663"],"content-md5":["3P+c6fqWtmLHLUTg3yCipQ=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["\"44fd33153db94d7371ce02d34b8a6972\""],"expires":["Tue, 03 May 2016 09:42:52 GMT"],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-fb-debug":["coZ95FNAAREiHVe77LJCnHVuHlVEB/A0QwFqpL9eH6qgVSWpCMGgzDNL0HNHnC+JGlUIVfDUbn4txiAULbza2g=="]},"script"]
  nightmare:log did-get-response-details +24ms [{},false,"https://www.facebook.com/tr/?id=1758757081022387&ev=ViewContent&dl=https%3A%2F%2Fteamtreehouse.com%2F&rl=&if=true&ts=1462268406534&cd[content_ids]=%5B%22treehouse%22%5D&cd[content_type]=product&cd[currency]=USD&v=2.5.0&pv=visible","https://www.facebook.com/tr/?id=1758757081022387&ev=ViewContent&dl=https%3A%2F%2Fteamtreehouse.com%2F&rl=&if=true&ts=1462268406534&cd[content_ids]=%5B%22treehouse%22%5D&cd[content_type]=product&cd[currency]=USD&v=2.5.0&pv=visible",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-cache, must-revalidate, max-age=0"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Fri, 21 Dec 2012 00:00:01 GMT"],"server":["proxygen"],"status":["200"]},"image"]
  nightmare:log did-get-response-details +48ms [{},false,"https://insight.adsrvr.org/track/evnt/?adv=09u6bcp&ct=0:oockr5z&fmt=3","https://insight.adsrvr.org/track/evnt/?adv=09u6bcp&ct=0:oockr5z&fmt=3",200,"GET","https://teamtreehouse.com/",{"cache-control":["private,no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["70"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:13 GMT"],"p3p":["CP=\"NOI DSP COR CUR ADMo DEVo PSAo PSDo OUR SAMo BUS UNI NAV\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"set-cookie":["TDID=4a61710e-63ae-4def-8ca5-734dc833a919; domain=.adsrvr.org; expires=Wed, 03-May-2017 09:40:14 GMT; path=/","TDCPM=CAESFwoIZmFjZWJvb2sSCwiwjZvH7OjvMxAFEhkKCmktYmVoYXZpb3ISCwikvd3M6+jvMxAFEhQKBXRhcGFkEgsIiNzE5ezo7zMQBRIZCgpkcmF3YnJpZGdlEgsIhu/q5ezo7zMQBRIWCgdhZGJyYWluEgsI9Iin6uzo7zMQBRIWCgdibHVla2FpEgsIuue21e6J+DMQBRIWCgdydWJpY29uEgsIiOns/PXo7zMQBRIXCghwdWJtYXRpYxILCPKmwdH26O8zEAUSFQoGY2FzYWxlEgsI1qb+ncCg9zMQBRIZCgpzdGVlbGhvdXNlEgsIypbtwv7i9zMQBRIVCgZnb29nbGUSCwi67KC+v6D3MxAFEhgKCWJpZHN3aXRjaBILCICDhqjE8+8zEAUSGAoJbW9va2llLXBzEgsIuvqHy9Xz7zMQBRIYCgljcm9zc3dpc2USCwjcw+De1/PvMxAFEhgKCVF1YW50Y2FzdBILCPaN+q6W9fYzEAUSFgoHYWRkdGhpcxILCODP+Y+k9vYzEAUSGQoKcmlnaHRtZWRpYRILCIC1y+yMq+wzEAUSFwoIYXBwbmV4dXMSCwjczKbl4In4MxAFEhIKA2FhbRILCPrO2Pek9vYzEAUSFgoHZXhlbGF0ZRILCKzPm/ek9vYzEAUSFgoHbmV1c3RhchILCMyP4fyk9vYzEAUSFQoGbW9va2llEgsIhL6m5K329jMQBRIYCglhb2xhZHRlY2gSCwiEvqbkrfb2MxAFEhQKBXNwb3R4EgsIvOiNmK729jMQBRIYCglzdGlja3lhZHMSCwj8sM+10/v2MxAFEhUKBmFkYXB0dhILCK6Hjp2Y/PYzEAUSFAoFb3BlbngSCwie7YbBnqD3MxAFEhUKBmFkbWFucxILCPT1tsK/oPczEAUSGgoLc21hcnRzdHJlYW0SCwjM+sGZv6D3MxAFEh0KDnNtYXJ0LWFkc2VydmVyEgsIjvbTleeJ+DMQBRIVCgZzb25vYmkSCwior43PyKD3MxAFEhUKBmxvdGFtZRILCIzNxa+2ofczEAUSFwoIbGl2ZXJhbXASCwjShr/xt6H3MxAFEhQKBXRlYWRzEgsIrOjptqWu9zMQBRIdCg5mZWRlcmF0ZWRtZWRpYRILCIqG+86VpfczEAUSGAoJYWRhZHZpc29yEgsIkJba9I6s9zMQBRIaCgthcmV5b3VodW1hbhILCJ6i1I6RrPczEAUSGwoMY2hvaWNlc3RyZWFtEgsI2tqko6qs9zMQBRIWCgdyYWt1dGVuEgsIyLX/2euJ+DMQBRIZCgpjcm9zc3BpeGVsEgsImMWls7Ou9zMQBRgFOAFCBCICCAFSGQoKaS1iZWhhdmlvchILCJiRuvPD8+8zEAVSFgoHYWRicmFpbhILCJiRuvPD8+8zEAVSFAoFdGFwYWQSCwiYkbrzw/PvMxAFUhkKCmRyYXdicmlkZ2USCwjYwtS81/PvMxAFUhYKB2JsdWVrYWkSCwjYwtS81/PvMxAFUhUKBmNhc2FsZRILCNjC1LzX8+8zEAVSGAoJY3Jvc3N3aXNlEgsIkJCIoIj17zMQBVIXCghwdWJtYXRpYxILCJCQiKCI9e8zEAVSFQoGZ29vZ2xlEgsIkJCIoIj17zMQBVIXCghmYWNlYm9vaxILCNK1xomW9fYzEAVSGAoJYmlkc3dpdGNoEgsI0rXGiZb19jMQBVIYCgltb29raWUtcHMSCwjStcaJlvX2MxAFUhYKB3J1Ymljb24SCwi05cqhmvX2MxAFag5Vbml0ZWQgS2luZ2RvbQ==; domain=.adsrvr.org; expires=Wed, 03-May-2017 09:40:14 GMT; path=/"],"x-aspnet-version":["4.0.30319"]},"image"]
  nightmare:log did-get-redirect-request +17ms [{},"https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1018590256/?random=1462268406562&cv=8&fst=1462268406562&num=1&fmt=3&guid=ON&u_h=1080&u_w=1920&u_ah=1053&u_aw=1920&u_cd=24&u_his=1&u_tz=60&u_java=false&u_nplug=0&u_nmime=0&frm=0&url=http%3A//www.adp.com/&tiba=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&async=1","https://www.google.com/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395",false,302,"GET","http://www.adp.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"location":["https://www.google.com/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +3ms [{},false,"https://bam.nr-data.net/1/fdeacbf9e7?a=7745172&v=918.2e0ff1d&to=MVFXZhEDVhJWVRBYDQgbdkcQFlcMGHULXxYUW1leBhBnJVJQBUQOEhtcXAcHQA%3D%3D&rst=10810&ap=41&be=2594&fe=7726&dc=4336&f=%5B%22err%22,%22xhr%22,%22stn%22,%22ins%22%5D&perf=%7B%22timing%22:%7B%22of%22:1462268395406,%22n%22:0,%22dl%22:1529,%22di%22:6909,%22ds%22:6929,%22de%22:7149,%22dc%22:10319,%22l%22:10319,%22le%22:10781,%22f%22:594,%22dn%22:645,%22dne%22:659,%22c%22:659,%22ce%22:1305,%22s%22:743,%22rq%22:1306,%22rp%22:1525,%22rpe%22:1527%7D,%22navigation%22:%7B%7D%7D&at=HRZUEFkZRRw%3D&jsonp=NREUM.setToken","https://bam.nr-data.net/1/fdeacbf9e7?a=7745172&v=918.2e0ff1d&to=MVFXZhEDVhJWVRBYDQgbdkcQFlcMGHULXxYUW1leBhBnJVJQBUQOEhtcXAcHQA%3D%3D&rst=10810&ap=41&be=2594&fe=7726&dc=4336&f=%5B%22err%22,%22xhr%22,%22stn%22,%22ins%22%5D&perf=%7B%22timing%22:%7B%22of%22:1462268395406,%22n%22:0,%22dl%22:1529,%22di%22:6909,%22ds%22:6929,%22de%22:7149,%22dc%22:10319,%22l%22:10319,%22le%22:10781,%22f%22:594,%22dn%22:645,%22dne%22:659,%22c%22:659,%22ce%22:1305,%22s%22:743,%22rq%22:1306,%22rp%22:1525,%22rpe%22:1527%7D,%22navigation%22:%7B%7D%7D&at=HRZUEFkZRRw%3D&jsonp=NREUM.setToken",200,"GET","https://society6.com/",{"content-length":["57"],"content-type":["text/javascript;charset=ISO-8859-1"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"set-cookie":["JSESSIONID=94192ae83a1f424;Path=/;Domain=.nr-data.net"]},"script"]
  nightmare:log did-get-response-details +10ms [{},false,"http://bat.bing.com/action/0?ti=5105257&Ver=2&mid=41383769-81d6-b201-3a3c-e98e2f061d4f&evt=pageLoad&lt=10030&pi=0&lg=en-US&sw=1920&sh=1080&sc=24&tl=Payroll%20Services%20|%20Human%20Resource%20Management%20|%20Human%20Capital%20Management&p=http%3A%2F%2Fwww.adp.com%2F&r=&rn=109510","http://bat.bing.com/action/0?ti=5105257&Ver=2&mid=41383769-81d6-b201-3a3c-e98e2f061d4f&evt=pageLoad&lt=10030&pi=0&lg=en-US&sw=1920&sh=1080&sc=24&tl=Payroll%20Services%20|%20Human%20Resource%20Management%20|%20Human%20Capital%20Management&p=http%3A%2F%2Fwww.adp.com%2F&r=&rn=109510",204,"GET","http://www.adp.com/",{"access-control-allow-origin":["*"],"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"]},"image"]
  nightmare:log did-get-response-details +6ms [{},false,"http://sp.analytics.yahoo.com/sp.pl?a=1000955916811&jsonp=YAHOO.ywa.I13N.handleJSONResponse&d=Tue%2C%2003%20May%202016%2009%3A40%3A06%20GMT&n=-1d&b=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&.yp=440887&f=http%3A%2F%2Fwww.adp.com%2F&enc=UTF-8","http://sp.analytics.yahoo.com/sp.pl?a=1000955916811&jsonp=YAHOO.ywa.I13N.handleJSONResponse&d=Tue%2C%2003%20May%202016%2009%3A40%3A06%20GMT&n=-1d&b=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&.yp=440887&f=http%3A%2F%2Fwww.adp.com%2F&enc=UTF-8",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"age":["0"],"cache-control":["no-cache, private, must-revalidate"],"connection":["keep-alive"],"content-length":["0"],"content-type":["application/x-javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"pragma":["no-cache"],"server":["ATS"],"via":["http/1.1 spdc0018.pbp.ir2.yahoo.com (ApacheTrafficServer)"]},"script"]
  nightmare:log did-get-response-details +8ms [{},false,"http://bat.r.msn.com/action-uic/0?ti=5105257&Ver=2&mid=41383769-81d6-b201-3a3c-e98e2f061d4f&evt=pageLoad&lt=10030&pi=0&lg=en-US&sw=1920&sh=1080&sc=24&tl=Payroll%20Services%20|%20Human%20Resource%20Management%20|%20Human%20Capital%20Management&p=http%3A%2F%2Fwww.adp.com%2F&r=&rn=623875","http://bat.r.msn.com/action-uic/0?ti=5105257&Ver=2&mid=41383769-81d6-b201-3a3c-e98e2f061d4f&evt=pageLoad&lt=10030&pi=0&lg=en-US&sw=1920&sh=1080&sc=24&tl=Payroll%20Services%20|%20Human%20Resource%20Management%20|%20Human%20Capital%20Management&p=http%3A%2F%2Fwww.adp.com%2F&r=&rn=623875",204,"GET","http://www.adp.com/",{"access-control-allow-origin":["*"],"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"]},"image"]
  nightmare:log did-get-response-details +6ms [{},false,"https://www.facebook.com/tr/?id=1656684611243400&ev=PageView&dl=http%3A%2F%2Fwww.adp.com%2F&rl=&if=false&ts=1462268406593&v=2.5.0&pv=visible","https://www.facebook.com/tr/?id=1656684611243400&ev=PageView&dl=http%3A%2F%2Fwww.adp.com%2F&rl=&if=false&ts=1462268406593&v=2.5.0&pv=visible",200,"GET","http://www.adp.com/",{"cache-control":["no-cache, must-revalidate, max-age=0"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"last-modified":["Fri, 21 Dec 2012 00:00:01 GMT"],"server":["proxygen"],"status":["200"]},"image"]
  nightmare:log did-get-response-details +8ms [{},false,"https://dis.us.criteo.com/dis/dis.aspx?p=11954&cb=30613732388&ref=&sc_r=1920x1080&sc_d=24","https://dis.us.criteo.com/dis/dis.aspx?p=11954&cb=30613732388&ref=&sc_r=1920x1080&sc_d=24",200,"GET","https://society6.com/",{"cache-control":["no-cache,no-cache"],"content-length":["1528"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:05 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT,Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP='CUR ADM OUR NOR STA NID'","CP='CUR ADM OUR NOR STA NID'"],"pragma":["no-cache,no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"subFrame"]
  nightmare:log did-get-redirect-request +10ms [{},"http://api.bizographics.com/v5/profile.json?callback=window._gsc.con.li&api_key=16d000c7848b4754aa1dc85caca87473&","https://eu-west-1.profile-api.ads.linkedin.com/v5/profile.json?api_key=16d000c7848b4754aa1dc85caca87473&callback=window._gsc.con.li&ck=",false,302,"GET","http://www.adp.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"location":["https://eu-west-1.profile-api.ads.linkedin.com/v5/profile.json?api_key=16d000c7848b4754aa1dc85caca87473&callback=window._gsc.con.li&ck="],"server":["nginx"]}]
  nightmare:log did-get-redirect-request +17ms [{},"https://www.google.com/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395","https://www.google.co.uk/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395&ipr=y",false,302,"GET","http://www.adp.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=43200"],"content-length":["345"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 03 May 2016 09:40:06 GMT"],"location":["https://www.google.co.uk/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395&ipr=y"],"server":["adclick_server"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +13ms [{},false,"https://www.google.co.uk/ads/user-lists/1018590256/?fmt=3&num=1&cv=8&frm=0&url=http%3A//www.adp.com/&random=2223624395&ipr=y","https://googleads.g.doubleclick.net/pagead/viewthroughconversion/1018590256/?random=1462268406562&cv=8&fst=1462268406562&num=1&fmt=3&guid=ON&u_h=1080&u_w=1920&u_ah=1053&u_aw=1920&u_cd=24&u_his=1&u_tz=60&u_java=false&u_nplug=0&u_nmime=0&frm=0&url=http%3A//www.adp.com/&tiba=Payroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management&async=1",200,"GET","http://www.adp.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["adclick_server"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +20ms [{},false,"https://m.addthis.com/live/red_lojson/300lo.json?si=572871f50a2f09e9&bl=1&pdt=2528&sid=572871f50a2f09e9&pub=ra-54e5170351df8b3a&rev=v5.12.0-wp&ln=en&pc=men&cb=0&adu6=0&ab=-&dp=www.kairos.com&fp=&fr=&of=0&pd=0&irt=1&vcl=2&md=0&ct=1&tct=0&abt=0&cdn=0&lnlc=gb&pi=1&rb=0&gen=100&chr=UTF-8&mk=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&colc=1462268406335&jsl=8193&uvs=572870bf6d54f42c008&skipb=1&callback=addthis.cbs.oln9_32281651723402070","https://m.addthis.com/live/red_lojson/300lo.json?si=572871f50a2f09e9&bl=1&pdt=2528&sid=572871f50a2f09e9&pub=ra-54e5170351df8b3a&rev=v5.12.0-wp&ln=en&pc=men&cb=0&adu6=0&ab=-&dp=www.kairos.com&fp=&fr=&of=0&pd=0&irt=1&vcl=2&md=0&ct=1&tct=0&abt=0&cdn=0&lnlc=gb&pi=1&rb=0&gen=100&chr=UTF-8&mk=human%20analytics%2Cface%20analysis%2Cemotion%20analysis&colc=1462268406335&jsl=8193&uvs=572870bf6d54f42c008&skipb=1&callback=addthis.cbs.oln9_32281651723402070",200,"GET","https://www.kairos.com/",{"cache-control":["max-age=0, no-cache, no-store, no-transform"],"cf-ray":["29d2bfe3a76934dc-LHR"],"content-encoding":["gzip"],"content-length":["110"],"content-type":["application/javascript;charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"NON ADM OUR DEV IND COM STA\""],"pragma":["no-cache"],"server":["cloudflare-nginx"],"set-cookie":["bt2=572871f60023s00060027s0004002cs0001001qs0003001rs0007001ss0003001ts0002008ts0002001us0003001vs0002001ws0002001xs0003001ys0006001zs0005001Cs000O001Ds0002001Fs0005001Gs000Q001Is0002004Js0006001Js0002001Ks0006001Ls0002002Ls0002002Ns0002001Ns0007001Ps0006007Rs0004002Rs0004001Ss0002007Ss0002003Ts000200aTs000101wVs0002002Ws0001003_s0002;Path=/;Domain=.addthis.com;Expires=Sat, 14-Jan-2017 09:40:06 GMT","uid=5720d7483fba8713;Path=/;Domain=.addthis.com;Expires=Thu, 03-May-2018 09:40:06 GMT","vc=92;Path=/;Domain=.addthis.com;Expires=Thu, 03-May-2018 09:40:06 GMT"],"status":["200"]},"script"]
  nightmare:log navigating... +1ms
  nightmare:log did-frame-finish-load +39ms [{},false]
  nightmare:log did-get-response-details +9ms [{},false,"https://eu-west-1.profile-api.ads.linkedin.com/v5/profile.json?api_key=16d000c7848b4754aa1dc85caca87473&callback=window._gsc.con.li&ck=","http://api.bizographics.com/v5/profile.json?callback=window._gsc.con.li&api_key=16d000c7848b4754aa1dc85caca87473&",200,"GET","http://www.adp.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-length":["223"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"p3p":["CP=\"NON DSP COR CURa ADMo DEVo TAIo PSAo PSDo OUR DELa IND PHY ONL UNI COM NAV DEM\""],"pragma":["no-cache"],"server":["nginx"],"set-cookie":["BizoData=Jr3BxHJOIisOlQTJnXQoN8IiiHGAKl0mBJKwXt38eFMnfcV9ipXSdD0iiDZXMthf2YipisDm8uLb945H2LLhJUptCJ9bQ07DiigeipnojYNqNkSvE79gOeuTxvc8l7ASJZILtiidtv6ipe8buSyipnlLMqHLnRAQ8EiifuQ8Uip1tisVgI79tSHKuTutZfMz4oc4EE6HlmzEKXfZeVyMOBfL2l1QHXoEE8WXUws3EmGgeFkIsUZiin94NQ4BLTdbUqO8hUKKlUrZywJfTE2Xu0RPH9MQ46zKhfwis3N7ExisrTcel3qlhp5AfkWIie;Version=0;Domain=.ads.linkedin.com;Path=/;Max-Age=15768000;Secure","BizoID=e39cfaa6-4d7c-4f9f-bbf9-ac26a3555dc4;Version=0;Domain=.ads.linkedin.com;Path=/;Max-Age=15768000;Secure"],"x-content-type-options":["nosniff"]},"script"]
  nightmare:log did-frame-finish-load +8ms [{},false]
  nightmare:log did-frame-finish-load +1ms [{},true]
  nightmare:log did-finish-load +1ms [{}]
  nightmare:log page-favicon-updated +0ms [{},["https://society6.com/favicon.ico"]]
  nightmare:log did-stop-loading +1ms [{}]
  nightmare:actions .evaluate() fn on the page +0ms
  nightmare:log did-get-response-details +30ms [{},false,"http://tiendas.mediamarkt.es/ecommerce/ajax/json/leftNavi.cfm","http://tiendas.mediamarkt.es/ecommerce/ajax/json/leftNavi.cfm",200,"GET","http://tiendas.mediamarkt.es/",{"age":["0"],"connection":["Keep-alive"],"content-encoding":["gzip"],"content-type":["text/html;charset=UTF-8"],"date":["Tue, 03 May 2016 09:33:38 GMT"],"pragma":["public"],"transfer-encoding":["chunked"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-served-by":["20"],"x-session-id":["21819974_ff05e83eb429200d-9BE1C464-0977-20B7-74786913B7BED82F"],"x-varnish":["2312178766"]},"xhr"]
  nightmare:log did-get-response-details +27ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["484484"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["211710"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:18:06 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["wQOIdhDxAQHp8f2fweZhXgAcxDmkTGj5RVKjuyvL6FZvP0hXrZ7LLg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-crazy-car.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-crazy-car.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["441897"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["237089"],"content-type":["image/jpeg"],"date":["Thu, 28 Apr 2016 06:55:12 GMT"],"last-modified":["Thu, 28 Apr 2016 06:51:52 GMT"],"via":["1.1 0e74db3db7a48d7f6e7f64382ca5c629.cloudfront.net (CloudFront)"],"x-amz-cf-id":["nqNqzDtyoEV-knWMzAmx-UlBZpogav6ryNimxq4ALuOCsKqif63YTg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-battleborn-preventa.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-battleborn-preventa.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["438631"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["179505"],"content-type":["image/jpeg"],"date":["Thu, 28 Apr 2016 07:49:38 GMT"],"last-modified":["Thu, 28 Apr 2016 07:47:42 GMT"],"via":["1.1 be27f8aa8af4ef7f3d1f074ecbf3b266.cloudfront.net (CloudFront)"],"x-amz-cf-id":["e0QQ6Nz8kXrHNqDyL7fc0_xjKaUojm3qvu77_hON8V3zxQrB5lg7uQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-viaje.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-viaje.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["484484"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["237736"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:24:41 GMT"],"via":["1.1 5f27ca52729763588bba68f65c5cb11d.cloudfront.net (CloudFront)"],"x-amz-cf-id":["hGMVC2kqEkaed0ag_H-XF6PyNPp2EDeW0W9pGppqC4Bx9-Ilcc4wJQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-Floco-tv.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-Floco-tv.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["93234"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["253808"],"content-type":["image/jpeg"],"date":["Mon, 02 May 2016 07:46:11 GMT"],"last-modified":["Mon, 02 May 2016 07:41:02 GMT"],"via":["1.1 fb592d1377921b63fca3b504191c34b1.cloudfront.net (CloudFront)"],"x-amz-cf-id":["eyBLa90MV9DDdUBIGQXTesMbttxeUQKm-Lzf3OQBuCkIHvuY0GeX-w=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +7ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-gafas.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-gafas.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["484484"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["209538"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:35:09 GMT"],"via":["1.1 b47ef3766a859c0c1ae31872e114e497.cloudfront.net (CloudFront)"],"x-amz-cf-id":["TgRPb-4zthR4AjHUKjBFxSKyQTKW6N5sWnZkTs6KUYgxo7LsP0tSGw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +10ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["838"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-encoding":["gzip"],"content-length":["1002"],"content-type":["text/css"],"date":["Tue, 03 May 2016 09:33:38 GMT"],"last-modified":["Fri, 07 Nov 2014 18:52:07 GMT"],"vary":["Accept-Encoding,User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2312179051 2312067686"]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/dummy.png","http://www.mediamarkt.es/static/index/slider/img/dummy.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["3279"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Wed, 04 May 2016 09:40:06 GMT"],"last-modified":["Fri, 08 Apr 2016 08:29:57 GMT"],"set-cookie":["TS015b134e=014cde7230e7abb8b885954848b86c2113c78ecc19727ee18d6565a40a550e88a50e5878fd; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache02"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://b.6sc.co/v1/beacon/img.gif?token=8a2c7f8468e7f232917b0eeadeffb65e&visitor=&session=1ec28f87-3dfe-4ad0-8531-624ca9beee8f&event=a_pageload&q=%7B%7D&isIframe=false&m=%7B%22description%22%3A%22ADP%20provides%20comprehensive%20payroll%20services%20and%20human%20resources%20management%20solutions%20for%20businesses%20of%20all%20sizes.%20ADP%2C%20A%20more%20Human%20Resource.%22%2C%22keywords%22%3A%22Payroll%20Services%2C%20Human%20Capital%20Management%2C%20Employee%20Benefits%20Administration%2C%20Human%20Resource%20Management%2C%20HCM%2C%20Health%20Care%20Reform%22%2C%22title%22%3A%22%5Cn%5CtPayroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management%5Cn%22%7D&cb=68406584&r=&thirdParty=%7B%7D","http://b.6sc.co/v1/beacon/img.gif?token=8a2c7f8468e7f232917b0eeadeffb65e&visitor=&session=1ec28f87-3dfe-4ad0-8531-624ca9beee8f&event=a_pageload&q=%7B%7D&isIframe=false&m=%7B%22description%22%3A%22ADP%20provides%20comprehensive%20payroll%20services%20and%20human%20resources%20management%20solutions%20for%20businesses%20of%20all%20sizes.%20ADP%2C%20A%20more%20Human%20Resource.%22%2C%22keywords%22%3A%22Payroll%20Services%2C%20Human%20Capital%20Management%2C%20Employee%20Benefits%20Administration%2C%20Human%20Resource%20Management%2C%20HCM%2C%20Health%20Care%20Reform%22%2C%22title%22%3A%22%5Cn%5CtPayroll%20Services%20%7C%20Human%20Resource%20Management%20%7C%20Human%20Capital%20Management%5Cn%22%7D&cb=68406584&r=&thirdParty=%7B%7D",200,"GET","http://www.adp.com/",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-headers":["*"],"access-control-allow-methods":["GET,POST"],"access-control-allow-origin":[""],"access-control-max-age":["86400"],"cache-control":["private, no-cache, no-cache=Set-Cookie, proxy-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"etag":["\"57153dbd-2b\""],"expires":["Wed, 19 Apr 2000 11:43:00 GMT"],"last-modified":["Mon, 18 Apr 2016 20:04:13 GMT"],"pragma":["no-cache"],"server":["nginx/1.8.1"],"x-content-type-options":["nosniff"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/imgs-campaigns/20160428/botones.png","http://www.mediamarkt.es/static/index/slider/img/imgs-campaigns/20160428/botones.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["7340"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Wed, 04 May 2016 09:40:06 GMT"],"last-modified":["Tue, 26 Apr 2016 16:10:59 GMT"],"set-cookie":["TS015b134e=014cde7230e7abb8b885954848b86c2113c78ecc19727ee18d6565a40a550e88a50e5878fd; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache01"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +52ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12859"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:06 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"p3p":["CP=\"This is not a P3P policy! See http://support.google.com/accounts/answer/151657?hl=en for more info.\""],"server":["Ytfe_Worker"],"set-cookie":["YSC=8vRb0dDvzNg; path=/; domain=.youtube.com; httponly"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-frame-finish-load +104ms [{},false]
  nightmare:log page-favicon-updated +1ms [{},["https://www.kairos.com/templates/t3_bs3_blank/favicon.ico","https://www.kairos.com/templates/t3_bs3_blank/kairos-favicon.svg"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:log navigated to: https://www.kairos.com/ +0ms
Window object available for: https://www.kairos.com/
Finished processing: https://www.kairos.com/
  nightmare:log did-get-response-details +37ms [{},false,"http://static-rmk.blueknow.com/descriptors/BK-228300128806-7.js?cac=20165310","http://static-rmk.blueknow.com/descriptors/BK-228300128806-7.js?cac=20165310",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["73335"],"connection":["keep-alive"],"content-length":["11245"],"content-type":["application/javascript"],"date":["Mon, 18 Apr 2016 13:14:58 GMT"],"etag":["\"a5c106ba2aa45e71c1d9334ab423ae33\""],"last-modified":["Mon, 18 Apr 2016 13:09:00 GMT"],"server":["AmazonS3"],"via":["1.1 3905f6b396c96f958286f8e228e61547.cloudfront.net (CloudFront)"],"x-amz-cf-id":["u31_dSBYGZZVVungdq4mLANxjdt13aWp5rT1IvsMVquU5XHI-Xzt7A=="],"x-amz-meta-s3cmd-attrs":["uid:501/gname:staff/uname:ameller/gid:20/mode:33188/mtime:1460984896/atime:1460984897/md5:a5c106ba2aa45e71c1d9334ab423ae33/ctime:1460984896"],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +23ms [{},false,"https://s.getsmartcontent.com/serving?tm=1462268407&i=xrcoy8hi2i4auuq2mht67cxfw10rz3qp&w=ND424NFK&c=&v=1461674056.1462268383.1462268407.81&g=1462268407.8490638&s=xrcoy8hi2i4auuq2mht67cxfw10rz3qp.1462268383&d=1280%2C778&ab=&r=&m.eg=&svc=&li=%7B%22bizographics%22%3A%7B%22li_location%22%3A%5B%7B%22code%22%3A%22europe%22%2C%22name%22%3A%22Europe%22%7D%2C%7B%22code%22%3A%22united_kingdom%22%2C%22name%22%3A%22United%20Kingdom%22%2C%22parent_code%22%3A%22europe%22%7D%5D%7D%2C%22piggyback_url%22%3A%22%22%2C%22third_pc_accepted%22%3A%22true%22%2C%22usage%22%3A0%7D","https://s.getsmartcontent.com/serving?tm=1462268407&i=xrcoy8hi2i4auuq2mht67cxfw10rz3qp&w=ND424NFK&c=&v=1461674056.1462268383.1462268407.81&g=1462268407.8490638&s=xrcoy8hi2i4auuq2mht67cxfw10rz3qp.1462268383&d=1280%2C778&ab=&r=&m.eg=&svc=&li=%7B%22bizographics%22%3A%7B%22li_location%22%3A%5B%7B%22code%22%3A%22europe%22%2C%22name%22%3A%22Europe%22%7D%2C%7B%22code%22%3A%22united_kingdom%22%2C%22name%22%3A%22United%20Kingdom%22%2C%22parent_code%22%3A%22europe%22%7D%5D%7D%2C%22piggyback_url%22%3A%22%22%2C%22third_pc_accepted%22%3A%22true%22%2C%22usage%22%3A0%7D",200,"GET","http://www.adp.com/",{"cache-control":["max-age=0, must-revalidate, no-store, nocache, private"],"connection":["keep-alive"],"content-length":["161"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:12 GMT"],"pragma":["no-cache"],"server":["nginx/1.8.0"],"set-cookie":["gsci=xrcoy8hi2i4auuq2mht67cxfw10rz3qp; expires=Thu, 03-May-2018 09:40:12 GMT; Max-Age=63072000"],"x-powered-by":["PHP/5.5.9-1ubuntu4.14"]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.3","https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.3",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["56384"],"content-md5":["7Gz7XThQHpMl3/KkN5PyOw=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"etag":["\"e0b4909839cf7657221a468ea68cd9aa\""],"expires":["Tue, 03 May 2016 09:29:21 GMT"],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-fb-debug":["2yObGth7yJC1Idk/r322F7SbdKskYqgsoHtpOmhcmZpzKe9GMa4Z/5p8ZK6fGGdbBxv/vVIflFlKq5gEowvidw=="]},"script"]
Window object available for: https://society6.com/
Finished processing: https://society6.com/
  nightmare:log did-get-response-details +143ms [{},false,"https://s.getsmartcontent.com/connections/eloqua?guid=ac2f082e-7add-4d33-aa19-d09de3057011&website_public_id=ND424NFK&method=addGUIDForVisitor&visitor_id=xrcoy8hi2i4auuq2mht67cxfw10rz3qp&","https://s.getsmartcontent.com/connections/eloqua?guid=ac2f082e-7add-4d33-aa19-d09de3057011&website_public_id=ND424NFK&method=addGUIDForVisitor&visitor_id=xrcoy8hi2i4auuq2mht67cxfw10rz3qp&",204,"GET","http://www.adp.com/",{"age":["446115"],"cache-control":["no-cache=Set-Cookie, private, proxy-revalidate"],"connection":["keep-alive"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:19 GMT"],"expires":["Wed, 19 Apr 2000 11:43:00 GMT"],"last-modified":["Wed, 21 Jan 2004 19:51:30 GMT"],"pragma":["no-cache"],"server":["nginx/1.8.0"],"set-cookie":["gsci=91048f125e5b1301358df6447b1cc949; expires=Thu, 03-May-2018 09:40:19 GMT; Max-Age=63072000"],"x-content-type-options":["nosniff"],"x-powered-by":["PHP/5.5.9-1ubuntu4.14"]},"image"]
  nightmare:log did-frame-finish-load +63ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log navigating... +1ms
  nightmare:log page-favicon-updated +0ms [{},["http://www.adp.com/favicon.ico"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:log navigated to: http://www.adp.com/ +1ms
  nightmare:actions .evaluate() fn on the page +0ms
  nightmare:log did-get-response-details +3ms [{},false,"https://specials.mediamarkt.es/chat/css/style.css","https://specials.mediamarkt.es/chat/css/style.css",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["11888"],"content-type":["text/css"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"etag":["\"2e70-52fa6249de515\""],"expires":["Tue, 17 May 2016 09:40:07 GMT"],"last-modified":["Mon, 04 Apr 2016 10:25:08 GMT"],"server":["Apache"],"x-served-by":["web01"]},"stylesheet"]
  nightmare:log did-get-response-details +249ms [{},false,"http://www.mediatrends.es/api/trends/get_last_post/?callback=callback","http://www.mediatrends.es/api/trends/get_last_post/?callback=callback",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["266"],"connection":["keep-alive"],"content-length":["917"],"content-type":["application/javascript; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["469"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719767 249702071"]},"script"]
  nightmare:log did-get-redirect-request +0ms [{},"http://www.mediatrends.es/api/trends/get_mt_noticias","http://www.mediatrends.es/api/trends/get_mt_noticias/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["267"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_noticias/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["328"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719768 249702029"]}]
  nightmare:log did-get-redirect-request +1ms [{},"http://www.mediatrends.es/api/trends/get_mt_reviews","http://www.mediatrends.es/api/trends/get_mt_reviews/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["267"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_reviews/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["327"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719769 249702028"]}]
  nightmare:log did-get-redirect-request +1ms [{},"http://www.mediatrends.es/api/trends/get_mt_comparativas","http://www.mediatrends.es/api/trends/get_mt_comparativas/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["267"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_comparativas/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["329"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719770 249701979"]}]
  nightmare:log did-get-redirect-request +2ms [{},"http://www.mediatrends.es/api/trends/get_mt_howto","http://www.mediatrends.es/api/trends/get_mt_howto/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["267"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_howto/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["329"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719771 249701981"]}]
  nightmare:log did-get-redirect-request +0ms [{},"http://www.mediatrends.es/api/trends/get_mt_videos","http://www.mediatrends.es/api/trends/get_mt_videos/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["266"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_videos/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["327"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719772 249702075"]}]
  nightmare:log did-get-response-details +37ms [{},false,"https://specials.mediamarkt.es/search/js/doofinder.js?_=1462268398756","https://specials.mediamarkt.es/search/js/doofinder.js?_=1462268398756",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["927"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"etag":["\"39f-5318a5fd9439f\""],"expires":["Tue, 17 May 2016 09:40:07 GMT"],"last-modified":["Thu, 28 Apr 2016 12:07:46 GMT"],"server":["Apache"],"x-served-by":["web01"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://specials.mediamarkt.es/search/js/script.js?_=1462268398757","https://specials.mediamarkt.es/search/js/script.js?_=1462268398757",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["7052"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"etag":["\"1b8c-531dd08e483bd\""],"expires":["Tue, 17 May 2016 09:40:07 GMT"],"last-modified":["Mon, 02 May 2016 14:44:50 GMT"],"server":["Apache"],"x-served-by":["web01"]},"script"]
  nightmare:log did-get-response-details +15ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/bg-img.jpg","http://www.mediamarkt.es/static/index/slider/img/bg-img.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["2085"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"expires":["Wed, 04 May 2016 09:40:07 GMT"],"last-modified":["Fri, 02 Oct 2015 06:46:18 GMT"],"set-cookie":["TS015b134e=014cde7230e7abb8b885954848b86c2113c78ecc19727ee18d6565a40a550e88a50e5878fd; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache01"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +31ms [{},false,"https://dc.ads.linkedin.com/collect/?time=1462268407271&pid=1205&url=http%3A%2F%2Fwww.adp.com%2F&pageUrl=http%3A%2F%2Fwww.adp.com%2F&ref=&bzid=e39cfaa6-4d7c-4f9f-bbf9-ac26a3555dc4&cksm=A83753D2DF34985A&fmt=js&np.0.id=14&np.0.time=107&s=1","https://dc.ads.linkedin.com/collect/?time=1462268407271&pid=1205&url=http%3A%2F%2Fwww.adp.com%2F&pageUrl=http%3A%2F%2Fwww.adp.com%2F&ref=&bzid=e39cfaa6-4d7c-4f9f-bbf9-ac26a3555dc4&cksm=A83753D2DF34985A&fmt=js&np.0.id=14&np.0.time=107&s=1",200,"GET","http://www.adp.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-language":["en-US"],"content-length":["310"],"content-type":["text/javascript;charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"p3p":["CP=\"NON DSP COR CURa ADMo DEVo TAIo PSAo PSDo OUR DELa IND PHY ONL UNI COM NAV DEM\""],"pragma":["no-cache"],"server":["nginx"],"set-cookie":["BizoID=e39cfaa6-4d7c-4f9f-bbf9-ac26a3555dc4; Domain=.ads.linkedin.com; Expires=Tue, 01-Nov-2016 21:40:07 GMT; Path=/; Secure","BizoData=Jr3BxHJOIisP57a1XishVF0Lfii0ipyKxDwbvx9Z3AWLzWIz9iiyxii2gFipnJA3Dbql4IDNE3PPkV0e5ujNKL9BAmXWZdis3v7CtG43lLQIkLmzbOSBcISJuylJB3P4o28QO5Jw5iiGzz2sJE6ipDIIVKL1weZhbMii69Lnda1fn8FZcxdqtipwe7kSeRPMtdipsCOeEJXkanroNrB3Q3Whz69ZFhC7xL1RuLUxjWTmvvTBaLmZWALIeDLhb04Fy6w2FW4dJ0xOBZJipjgHKAAaLis9NP6EqbG7ac4ZKe5MtoaFaf8ipfYPipCh2Q0bjlkO0I1R6tiivvs54m; Domain=.ads.linkedin.com; Expires=Tue, 01-Nov-2016 21:40:07 GMT; Path=/; Secure","BizoCustomSegments=3BtuOM5OYbEPpwWUVGgFAa8AN7d6vlOKHzdLtck9g1j3YNcDFcrisTtfOGGaEN5sTXoZumX31OdHYlSSvIaukrSEvlmiiiphIipaAUUOY3avpvRLJzmTkPvOK3OASnSo7bX3VTDipkBjyiiFft6jTBvb3pKLJKPjrjPZnC; Domain=.ads.linkedin.com; Expires=Sun, 30-Oct-2016 09:40:07 GMT; Path=/; HttpOnly"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://ad.bizo.com/pixel?id=1311870&t=2","http://ad.bizo.com/pixel?id=1311870&t=2",200,"GET","http://www.adp.com/",{"connection":["close"],"content-length":["0"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["ATS"]},"image"]
  nightmare:log did-get-response-details +12ms [{},false,"https://imp2.ads.linkedin.com/l","https://imp2.ads.linkedin.com/l",200,"GET","http://www.adp.com/",{"cache-control":["no-cache"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif;charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"p3p":["CP=\"NON DSP COR CURa ADMo DEVo TAIo PSAo PSDo OUR DELa IND PHY ONL UNI COM NAV DEM\""],"pragma":["no-cache"],"server":["nginx"]},"image"]
Window object available for: http://adp.com
Finished processing: http://adp.com
  nightmare:log did-get-response-details +108ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/1272049-logo%20garantia_m.png","http://d243u7pon29hni.cloudfront.net/images/products/1272049-logo%20garantia_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["438052"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["32988"],"content-type":["image/png"],"date":["Thu, 31 Mar 2016 07:37:50 GMT"],"last-modified":["Thu, 16 Jul 2015 08:04:50 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["g_W4nkWJ2zIATUo0Pga9vLUWDdNlAX6bzyLd300AJYtt6XrfsjE_Kw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/gigaset-a120-naranja-estacion-mobile-d-200004496_m.png","http://d243u7pon29hni.cloudfront.net/images/products/gigaset-a120-naranja-estacion-mobile-d-200004496_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["586714"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["68756"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 14:41:35 GMT"],"last-modified":["Thu, 21 Apr 2016 14:09:47 GMT"],"via":["1.1 fb592d1377921b63fca3b504191c34b1.cloudfront.net (CloudFront)"],"x-amz-cf-id":["cfXVD8_9R7MNYubzUSAsQz4bc-Dd-5UwbDAeptiww82o93VtjamMog=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products//portatil-asus-f540la-xx069t-i3-4005u-1320821-6_l1_m.png","http://d243u7pon29hni.cloudfront.net/images/products//portatil-asus-f540la-xx069t-i3-4005u-1320821-6_l1_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["82288"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["68810"],"content-type":["image/png"],"date":["Mon, 02 May 2016 10:48:38 GMT"],"last-modified":["Mon, 02 May 2016 10:47:07 GMT"],"via":["1.1 b47ef3766a859c0c1ae31872e114e497.cloudfront.net (CloudFront)"],"x-amz-cf-id":["Jvbb864AoBXrahSVFCgzTVaLPwoRZOEq4XcLsrC8BUDme_3-NvBGpw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/nikon_d3300_18-55_55-200_objetivos_mochila_01_m.png","http://d243u7pon29hni.cloudfront.net/images/products/nikon_d3300_18-55_55-200_objetivos_mochila_01_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["598483"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["68196"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 11:25:26 GMT"],"last-modified":["Mon, 14 Mar 2016 11:22:36 GMT"],"via":["1.1 be27f8aa8af4ef7f3d1f074ecbf3b266.cloudfront.net (CloudFront)"],"x-amz-cf-id":["l7v5MurF7rXCWwqUlqxjouKSzbDHzMJnUjv-HqLCSf7vK5NCqnafUg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +8ms [{},false,"https://seal.godaddy.com/getSeal?sealID=YAwwJM189bYsVBGGetOifD89r0KMt4gKC2nR8wrv4snMwAUkxeHkoif1f1nC","https://seal.godaddy.com/getSeal?sealID=YAwwJM189bYsVBGGetOifD89r0KMt4gKC2nR8wrv4snMwAUkxeHkoif1f1nC",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"cache-control":["max-age=14400"],"connection":["Keep-Alive"],"content-encoding":["gzip"],"content-length":["1553"],"content-type":["text/html;charset=ISO-8859-1"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"expires":["Tue, 03 May 2016 13:40:07 GMT"],"keep-alive":["timeout=2, max=100"],"p3p":["CP=\"IDC DSP COR LAW CUR ADM DEV TAI PSA PSD IVA IVD HIS OUR SAM PUB LEG UNI COM NAV STA\""],"server":["Apache"],"set-cookie":["JSESSIONID=F56716F80D94436198ADBACDDF82566C.p3p04jb; Path=/; Secure"],"vary":["Accept-Encoding"],"x-frame-options":["SAMEORIGIN"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/TV_LED_43_pulgadas_SAMSUNG_43J5570_Smart_TV_Quad_Core_Full_HD_principal_m.png","http://d243u7pon29hni.cloudfront.net/images/products/TV_LED_43_pulgadas_SAMSUNG_43J5570_Smart_TV_Quad_Core_Full_HD_principal_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["536068"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["106903"],"content-type":["image/png"],"date":["Wed, 30 Mar 2016 04:45:08 GMT"],"last-modified":["Thu, 30 Apr 2015 08:04:46 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["lFn7pNdxBAcBz6rkRTBOnnHw67AGpNkVF6l67LYed9Pf0oFjAW-bJw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/microcadena_SONY_CMT-SBT100B_principalb_m.png","http://d243u7pon29hni.cloudfront.net/images/products/microcadena_SONY_CMT-SBT100B_principalb_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["1115837"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["71192"],"content-type":["image/png"],"date":["Wed, 06 Apr 2016 11:42:34 GMT"],"last-modified":["Tue, 22 Mar 2016 11:19:10 GMT"],"via":["1.1 fb592d1377921b63fca3b504191c34b1.cloudfront.net (CloudFront)"],"x-amz-cf-id":["V8FBoZPY4gzCqOotxVMsVa1wcrex4d-3PYPkaUhYFcUcO7HCI6xUgA=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +22ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/cargador-multifuncion-minibatt-st-12-1281351_2_l_m.png","http://d243u7pon29hni.cloudfront.net/images/products/cargador-multifuncion-minibatt-st-12-1281351_2_l_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["1086566"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["60545"],"content-type":["image/png"],"date":["Wed, 20 Apr 2016 19:50:40 GMT"],"last-modified":["Wed, 20 Apr 2016 16:32:49 GMT"],"via":["1.1 b47ef3766a859c0c1ae31872e114e497.cloudfront.net (CloudFront)"],"x-amz-cf-id":["STzNwheYarNVnuer11fiy8NGdwl3O7NpkZitK9pRjLVxwoNQUbYESQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/DS7331PA01_m.png","http://d243u7pon29hni.cloudfront.net/images/products/DS7331PA01_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["448034"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["37240"],"content-type":["image/png"],"date":["Thu, 31 Mar 2016 05:00:44 GMT"],"last-modified":["Wed, 02 Dec 2015 11:22:19 GMT"],"via":["1.1 be27f8aa8af4ef7f3d1f074ecbf3b266.cloudfront.net (CloudFront)"],"x-amz-cf-id":["zGY8TKQhdCcOhUs_0ydBrfrVtja3jPfPdHRKGHnHJv0Bs8Ko9CKHIw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Aire-acondicionado_Universal_Uas_12_A16_principal_C_m.png","http://d243u7pon29hni.cloudfront.net/images/products/Aire-acondicionado_Universal_Uas_12_A16_principal_C_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["346984"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["43118"],"content-type":["image/png"],"date":["Fri, 01 Apr 2016 09:16:31 GMT"],"last-modified":["Wed, 23 Mar 2016 18:21:08 GMT"],"via":["1.1 fb592d1377921b63fca3b504191c34b1.cloudfront.net (CloudFront)"],"x-amz-cf-id":["YvpPiw_rfmIRGwwftaCaaTyyO0XlIav2KSA6qn_x-gE_enXuQYFxxQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +16ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/1234605_reloj_deportivo_garmin_forerunner_910XT_negro_ad_l_l2_m.png","http://d243u7pon29hni.cloudfront.net/images/products/1234605_reloj_deportivo_garmin_forerunner_910XT_negro_ad_l_l2_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["146794"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["47356"],"content-type":["image/png"],"date":["Sun, 03 Apr 2016 16:44:08 GMT"],"last-modified":["Mon, 27 Apr 2015 14:44:24 GMT"],"via":["1.1 be27f8aa8af4ef7f3d1f074ecbf3b266.cloudfront.net (CloudFront)"],"x-amz-cf-id":["HpuEsaBIfew3Lqo5JArA5JCTMieoQ3lEA3w9OjzS3ldRGY1NGUrGQw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +13ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Horno_Balay_3HB506XM_front_logo_m.jpg","http://d243u7pon29hni.cloudfront.net/images/products/Horno_Balay_3HB506XM_front_logo_m.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["448034"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["11693"],"content-type":["image/jpeg"],"date":["Thu, 31 Mar 2016 05:00:44 GMT"],"last-modified":["Thu, 08 May 2014 08:25:12 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["urf50SgIRs9tzhgWWfKdEQa8T-_DDdFBBVwTQV5V6J-J9QUN-xCOpQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Cafetera_Delonghi_EN80B_front_m.jpg","http://d243u7pon29hni.cloudfront.net/images/products/Cafetera_Delonghi_EN80B_front_m.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["422668"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["9823"],"content-type":["image/jpeg"],"date":["Thu, 28 Apr 2016 12:15:42 GMT"],"last-modified":["Wed, 07 Jan 2015 08:28:52 GMT"],"via":["1.1 b47ef3766a859c0c1ae31872e114e497.cloudfront.net (CloudFront)"],"x-amz-cf-id":["hekbMjEQCen9B5oJbYLPXediJvESuOJlqsqxhINnLhjPpqRsc9wIdQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +9ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Aspirador_Roomba_621_Principal_sinfondo_l_m.png","http://d243u7pon29hni.cloudfront.net/images/products/Aspirador_Roomba_621_Principal_sinfondo_l_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["567087"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["90200"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 20:08:42 GMT"],"last-modified":["Thu, 20 Aug 2015 15:58:24 GMT"],"via":["1.1 fb592d1377921b63fca3b504191c34b1.cloudfront.net (CloudFront)"],"x-amz-cf-id":["HfKdKmojn-M5WxOI88Oz-R5-gc31M3TI1izA0_Udj0vCIcZnYnOhJg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Robot_Cocina_Taurus_mycook_touch_Frontal_m.png","http://d243u7pon29hni.cloudfront.net/images/products/Robot_Cocina_Taurus_mycook_touch_Frontal_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["65320"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["89049"],"content-type":["image/png"],"date":["Mon, 04 Apr 2016 15:30:05 GMT"],"last-modified":["Mon, 04 Apr 2016 15:24:17 GMT"],"via":["1.1 b47ef3766a859c0c1ae31872e114e497.cloudfront.net (CloudFront)"],"x-amz-cf-id":["GH713qOougSmXS-RG24ZmEJbdYR6SZajFHJ57I-CZf6Ja9afpB2n0A=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/consola-xbox-one-negra-500-gb-microsof-200004536_m.png","http://d243u7pon29hni.cloudfront.net/images/products/consola-xbox-one-negra-500-gb-microsof-200004536_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["440216"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["43545"],"content-type":["image/png"],"date":["Thu, 28 Apr 2016 07:23:13 GMT"],"last-modified":["Thu, 28 Apr 2016 07:08:53 GMT"],"via":["1.1 be27f8aa8af4ef7f3d1f074ecbf3b266.cloudfront.net (CloudFront)"],"x-amz-cf-id":["T8p3nvpWg8RAIC7he0sEbGznsDItC8zcln2h-Oq_6lLx0VrLgvJuVw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +15ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/8414906524584_m.jpg","http://d243u7pon29hni.cloudfront.net/images/products/8414906524584_m.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["14341"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["18142"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 05:41:05 GMT"],"last-modified":["Mon, 04 Apr 2016 15:26:55 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["UurBCktXmOnM1uNqtwM1pwxj0ons9n_EK6CLDKsr2ayWmuNG6C_ABw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +15ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/Termostato%20para%20smartphone%20Netatmo%20NTH01-EN-EU.1_m.jpg","http://d243u7pon29hni.cloudfront.net/images/products/Termostato%20para%20smartphone%20Netatmo%20NTH01-EN-EU.1_m.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["448034"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["6159"],"content-type":["image/jpeg"],"date":["Thu, 31 Mar 2016 05:00:44 GMT"],"last-modified":["Mon, 26 Jan 2015 12:31:53 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["h5XEAzefvAlOEFj7LZ8WW12XxJyf__u4iuYHUcZwjz9v_bn4e2VsPQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +19ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/products/meizu_m2_m.png","http://d243u7pon29hni.cloudfront.net/images/products/meizu_m2_m.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["600010"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["38341"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 10:59:59 GMT"],"last-modified":["Tue, 29 Dec 2015 17:36:26 GMT"],"via":["1.1 5f27ca52729763588bba68f65c5cb11d.cloudfront.net (CloudFront)"],"x-amz-cf-id":["3kz_yV46h1-ALRYQFgziQGE3Yjp6H2gNRlRuoldI5W_TP3RkI0Q3mA=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +54ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_noticias/","http://www.mediatrends.es/api/trends/get_mt_noticias/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["253"],"connection":["keep-alive"],"content-length":["907"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["394"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719790 249703077"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_reviews/","http://www.mediatrends.es/api/trends/get_mt_reviews/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["253"],"connection":["keep-alive"],"content-length":["857"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["393"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719791 249703076"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_comparativas/","http://www.mediatrends.es/api/trends/get_mt_comparativas/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["253"],"connection":["keep-alive"],"content-length":["939"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["393"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719792 249703079"]},"xhr"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_howto/","http://www.mediatrends.es/api/trends/get_mt_howto/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["253"],"connection":["keep-alive"],"content-length":["768"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["392"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719793 249703081"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_videos/","http://www.mediatrends.es/api/trends/get_mt_videos/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["253"],"connection":["keep-alive"],"content-length":["836"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["395"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249719794 249703084"]},"xhr"]
  nightmare:log did-fail-load +7ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-get-response-details +49ms [{},false,"http://css.redblue.de/MediaES/skins/cms-custom/es/img/banners/blank.gif","http://css.redblue.de/MediaES/skins/cms-custom/es/img/banners/blank.gif",200,"GET","http://d243u7pon29hni.cloudfront.net/templates/WLSMERGED/cssMergedMM_4422.css",{"accept-ranges":["bytes"],"age":["396"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["49"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:07 GMT"],"expires":["Wed, 04 May 2016 09:33:32 GMT"],"last-modified":["Mon, 02 May 2016 08:14:00 GMT"],"set-cookie":["TS015b134e=014cde72304708c1a34c7c81ab046d251399241ac298ebf3e531afdcc45e13e917d8f19d8b; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["HIT"],"x-cache-hits":["105"],"x-cache-host":["cache03"],"x-vcl":["(recv)(hash)(hit)(deliver)"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12832"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-redirect-request +20ms [{},"http://www.youtube.com/iframe_api?_=1462268398758","https://www.youtube.com/iframe_api?_=1462268398758",false,307,"GET","http://tiendas.mediamarkt.es/",{"location":["https://www.youtube.com/iframe_api?_=1462268398758"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-fail-provisional-load +4ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-fail-load +0ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-get-response-details +49ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.png","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.png",200,"GET","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css",{"accept-ranges":["bytes"],"age":["815"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-length":["10518"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:33:39 GMT"],"last-modified":["Sun, 28 Sep 2014 09:02:40 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2312179221 2312071222"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12866"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-response-details +25ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/css/blank.gif","http://tiendas.mediamarkt.es/static/index/slider/css/blank.gif",404,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["627"],"connection":["Keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 09:33:39 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2312179228 2312095848"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/shadow.png","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/shadow.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["24"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-length":["8242"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:33:39 GMT"],"last-modified":["Fri, 12 Apr 2013 14:07:00 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2312179229 2312176192"]},"image"]
  nightmare:log did-get-response-details +27ms [{},false,"http://specials.mediamarkt.es/landings/bannerleftnavy/bannerInformatica.jpg","http://specials.mediamarkt.es/landings/bannerleftnavy/bannerInformatica.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["32798"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"etag":["\"801e-5306057ad3ffb\""],"expires":["Tue, 17 May 2016 09:40:08 GMT"],"last-modified":["Wed, 13 Apr 2016 16:33:49 GMT"],"server":["Apache"],"x-served-by":["web01"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://specials.mediamarkt.es/landings/bannerleftnavy/revelaldo-online.jpg","http://specials.mediamarkt.es/landings/bannerleftnavy/revelaldo-online.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["28011"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"etag":["\"6d6b-5306ea9ed3f06\""],"expires":["Tue, 17 May 2016 09:40:08 GMT"],"last-modified":["Thu, 14 Apr 2016 09:38:58 GMT"],"server":["Apache"],"x-served-by":["web01"]},"image"]
  nightmare:log did-get-response-details +12ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/05/NTE020203-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/05/NTE020203-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["265"],"connection":["keep-alive"],"content-length":["3657"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"last-modified":["Tue, 03 May 2016 08:14:46 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["378"],"x-varnish":["249719803 249702271"]},"image"]
  nightmare:log did-get-response-details +59ms [{},false,"http://d3chj0zb5zcn0g.cloudfront.net/media/js/doofinder-4.latest.min.js","http://d3chj0zb5zcn0g.cloudfront.net/media/js/doofinder-4.latest.min.js",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["1980"],"cache-control":["max-age=3600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["66587"],"content-type":["application/javascript"],"date":["Thu, 31 Mar 2016 03:52:41 GMT"],"etag":["\"e0549d863b9785584ff5bc350ff88dd2\""],"last-modified":["Wed, 09 Mar 2016 10:26:48 GMT"],"server":["AmazonS3"],"via":["1.1 d9f4ab417da92d345373e35fdfe09034.cloudfront.net (CloudFront)"],"x-amz-cf-id":["2n8xFUudFCMNd2effb22QjkTdF3AGZ0dbhbcPmXBEQG_tm3e30KIng=="],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +17ms [{},false,"https://seal.godaddy.com/images/3/es/siteseal_gd_3_h_l_m.gif","https://seal.godaddy.com/images/3/es/siteseal_gd_3_h_l_m.gif",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"accept-ranges":["bytes"],"cache-control":["max-age=86400"],"connection":["Keep-Alive"],"content-length":["5444"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Wed, 04 May 2016 09:40:08 GMT"],"keep-alive":["timeout=2, max=99"],"p3p":["CP=\"IDC DSP COR LAW CUR ADM DEV TAI PSA PSD IVA IVD HIS OUR SAM PUB LEG UNI COM NAV STA\""],"server":["Apache"],"x-frame-options":["SAMEORIGIN"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"https://www.mediamarkt.es/static/fonts/mm-head-webfont.woff2","https://www.mediamarkt.es/static/fonts/mm-head-webfont.woff2",200,"GET","https://specials.mediamarkt.es/chat/css/style.css",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"access-control-allow-origin":["https://webchates.emergiacc.com"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["29836"],"content-type":["text/plain"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Wed, 04 May 2016 09:40:08 GMT"],"last-modified":["Thu, 13 Nov 2014 17:50:48 GMT"],"set-cookie":["TS015b134e=014cde7230ac2170f48eeee0b7de5948ad0c090fb7d896645d5030eedc7c537a9bd32d1cf5; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache02"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"other"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.mediamarkt.es/static/fonts/regular.woff2","https://www.mediamarkt.es/static/fonts/regular.woff2",200,"GET","https://specials.mediamarkt.es/chat/css/style.css",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"access-control-allow-origin":["https://webchates.emergiacc.com"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["54420"],"content-type":["text/plain"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Wed, 04 May 2016 09:40:08 GMT"],"last-modified":["Fri, 15 Apr 2016 14:09:36 GMT"],"set-cookie":["TS015b134e=014cde72300260aff79269304d4196e58b195cf324cf307ab1ec72568556c97e9a53b72671; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache02"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"other"]
  nightmare:log did-get-response-details +16ms [{},false,"https://assets.empathybroker.com/clients/mediamarkt/js/eb.min.js?_=1462268398759","https://assets.empathybroker.com/clients/mediamarkt/js/eb.min.js?_=1462268398759",200,"GET","http://tiendas.mediamarkt.es/",{"age":["85324"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-type":["application/javascript"],"date":["Mon, 02 May 2016 09:58:05 GMT"],"last-modified":["Mon, 02 May 2016 09:54:40 GMT"],"server":["AmazonS3"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding"],"via":["1.1 18ab487c2f9a73b18d18515f1dde6556.cloudfront.net (CloudFront)"],"x-amz-cf-id":["6XaU7KYwRjIsRi7loJ7v7VBcZtNBy4T657Q3ipGtC7ccYjl2eZDEVA=="],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/shutterstock_155697419-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/shutterstock_155697419-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["57901"],"connection":["keep-alive"],"content-length":["8456"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"last-modified":["Mon, 02 May 2016 10:15:26 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["34811"],"x-varnish":["249719811 247585963"]},"image"]
  nightmare:log did-get-response-details +11ms [{},false,"https://www.youtube.com/iframe_api?_=1462268398758","http://www.youtube.com/iframe_api?_=1462268398758",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-length":["745"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"script"]
  nightmare:log did-get-response-details +18ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/pacman-768x480-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/pacman-768x480-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["72304"],"connection":["keep-alive"],"content-length":["2795"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"last-modified":["Thu, 21 Apr 2016 16:29:57 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["43651"],"x-varnish":["249719812 246751484"]},"image"]
  nightmare:log did-get-response-details +14ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/rizar-cabello-668x400x80xX-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/rizar-cabello-668x400x80xX-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["72304"],"connection":["keep-alive"],"content-length":["5283"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"last-modified":["Tue, 26 Apr 2016 08:14:18 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["45829"],"x-varnish":["249719815 246751507"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/PORTADA_POST_COOLPAD_S-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/PORTADA_POST_COOLPAD_S-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["72304"],"connection":["keep-alive"],"content-length":["25545"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"last-modified":["Tue, 26 Apr 2016 17:08:12 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["45952"],"x-varnish":["249719816 246751509"]},"image"]
  nightmare:log did-get-response-details +12ms [{},false,"https://specials.mediamarkt.es/search/css/style.css","https://specials.mediamarkt.es/search/css/style.css",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["21115"],"content-type":["text/css"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"etag":["\"527b-53165beb26ceb\""],"expires":["Tue, 17 May 2016 09:40:08 GMT"],"last-modified":["Tue, 26 Apr 2016 16:25:44 GMT"],"server":["Apache"],"x-served-by":["web01"]},"stylesheet"]
  nightmare:log did-frame-finish-load +105ms [{},false]
  nightmare:log did-frame-finish-load +18ms [{},false]
  nightmare:log did-frame-finish-load +10ms [{},false]
  nightmare:log did-frame-finish-load +54ms [{},false]
  nightmare:log did-get-response-details +40ms [{},false,"https://www.facebook.com/impression.php/f104917e4f2b8f8/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D","https://www.facebook.com/impression.php/f104917e4f2b8f8/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"status":["200"],"x-content-type-options":["nosniff"],"x-fb-debug":["7kruBIYRa15o+gPDMReVnb1tIu4Gezz42w5QkCAGQ7Teoo+1pv6CquDGFf+rI6GBBqCP/4ZjKnKnr3IEMThUCg=="]},"image"]
  nightmare:log did-get-response-details +82ms [{},false,"https://staticxx.facebook.com/connect/xd_arbiter.php?version=42#channel=f304173391240dc&origin=http%3A%2F%2Fspecials.mediamarkt.es","https://staticxx.facebook.com/connect/xd_arbiter.php?version=42#channel=f304173391240dc&origin=http%3A%2F%2Fspecials.mediamarkt.es",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["public, max-age=31536000"],"content-length":["34898"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Wed, 03 May 2017 08:59:14 GMT"],"status":["200"],"strict-transport-security":["max-age=3600; preload"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["qzcjEGns2NYOHduZZm2eDvLGSmovlsJ12M3uO+nkfFgr8F14hS1uys5KYRKcihI0Q+kalZQsg3HdYVzkbi487w=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-frame-finish-load +7ms [{},false]
  nightmare:log did-get-response-details +4ms [{},false,"http://staticxx.facebook.com/connect/xd_arbiter.php?version=42#channel=f304173391240dc&origin=http%3A%2F%2Fspecials.mediamarkt.es","http://staticxx.facebook.com/connect/xd_arbiter.php?version=42#channel=f304173391240dc&origin=http%3A%2F%2Fspecials.mediamarkt.es",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["public, max-age=31536000"],"connection":["keep-alive"],"content-length":["34898"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Wed, 03 May 2017 08:59:14 GMT"],"strict-transport-security":["max-age=3600; preload"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["qzcjEGns2NYOHduZZm2eDvLGSmovlsJ12M3uO+nkfFgr8F14hS1uys5KYRKcihI0Q+kalZQsg3HdYVzkbi487w=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-get-response-details +54ms [{},false,"https://s.ytimg.com/yts/cssbin/www-embed-player-webp-vfl7T7Hx7.css","https://s.ytimg.com/yts/cssbin/www-embed-player-webp-vfl7T7Hx7.css",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["519851"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["40437"],"content-type":["text/css"],"date":["Wed, 27 Apr 2016 09:15:57 GMT"],"expires":["Thu, 27 Apr 2017 09:15:57 GMT"],"last-modified":["Wed, 27 Apr 2016 07:52:57 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"stylesheet"]
  nightmare:log did-get-response-details +6ms [{},false,"https://s.ytimg.com/yts/jsbin/www-embed-player-vflkMbUkT/www-embed-player.js","https://s.ytimg.com/yts/jsbin/www-embed-player-vflkMbUkT/www-embed-player.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["430516"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=691200"],"content-encoding":["gzip"],"content-length":["68786"],"content-type":["text/javascript"],"date":["Thu, 28 Apr 2016 10:04:52 GMT"],"expires":["Fri, 06 May 2016 10:04:52 GMT"],"last-modified":["Thu, 28 Apr 2016 09:17:40 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +5ms [{},false,"https://s.ytimg.com/yts/jsbin/player-en_US-vflA_6ZRP/base.js","https://s.ytimg.com/yts/jsbin/player-en_US-vflA_6ZRP/base.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["346831"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=691200"],"content-encoding":["gzip"],"content-length":["400506"],"content-type":["text/javascript"],"date":["Fri, 29 Apr 2016 09:19:37 GMT"],"expires":["Sat, 07 May 2016 09:19:37 GMT"],"last-modified":["Fri, 29 Apr 2016 08:55:50 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +44ms [{},false,"https://s.ytimg.com/yts/jsbin/www-widgetapi-vflDEA8Bd/www-widgetapi.js","https://s.ytimg.com/yts/jsbin/www-widgetapi-vflDEA8Bd/www-widgetapi.js",200,"GET","http://tiendas.mediamarkt.es/",{"age":["522068"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=691200"],"content-encoding":["gzip"],"content-length":["8778"],"content-type":["text/javascript"],"date":["Wed, 27 Apr 2016 08:39:00 GMT"],"expires":["Thu, 05 May 2016 08:39:00 GMT"],"last-modified":["Wed, 27 Apr 2016 08:15:38 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +59ms [{},false,"https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl;style-src * 'unsafe-inline' data:;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: 127.0.0.1:*;"],"content-type":["text/html"],"date":["Tue, 03 May 2016 09:40:08 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"facebook-api-version":["v2.3"],"pragma":["no-cache"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["BHVNb8o3xrFh4bwGG+tJIVHAJ33L1he2AE3iIxNVriCKcuu+lFaw35QtO8NGcNVj3yhneGG1egJJWTglAtJyIQ=="],"x-xss-protection":["0"]},"subFrame"]
  nightmare:log did-frame-finish-load +223ms [{},false]
  nightmare:log did-frame-finish-load +13ms [{},false]
  nightmare:log did-get-response-details +74ms [{},false,"http://img.youtube.com/vi/-MMIjtLXN2g/maxresdefault.jpg","http://img.youtube.com/vi/-MMIjtLXN2g/maxresdefault.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"age":["1951"],"cache-control":["public, max-age=7200"],"content-length":["221282"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:07:38 GMT"],"etag":["\"1461579721\""],"expires":["Tue, 03 May 2016 11:07:38 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-frame-finish-load +7ms [{},false]
  nightmare:log did-get-response-details +22ms [{},false,"https://www.facebook.com/rsrc.php/v2/yi/r/xhK4b-gLCBl.css","https://www.facebook.com/rsrc.php/v2/yi/r/xhK4b-gLCBl.css",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["1308"],"content-md5":["YSP7YjJyXSWD20R8/zFbAQ=="],"content-type":["text/css; charset=utf-8"],"date":["Thu, 28 Apr 2016 16:37:46 GMT"],"expires":["Fri, 28 Apr 2017 16:37:46 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["UDYVXUzNy0XQ1gpXwPUhZwLWucmdZwn5NBVpgJENaOQ6kxhNuLoyyuIwaUAnTuqLuA9Ns1DfeczhFtpe4KNSeQ=="]},"stylesheet"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2/yV/r/BxHWQHjTiGT.css","https://www.facebook.com/rsrc.php/v2/yV/r/BxHWQHjTiGT.css",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["5436"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 26 Apr 2016 13:51:22 GMT"],"expires":["Wed, 26 Apr 2017 13:51:22 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["dBA2utdEL7K9IxxEodDaTwY8kas2s4u0qcvC0mS/RuBh/PGr0hIEk5FlPE6E7tKmWBWG8WpSrHu966wBXwGB8g=="]},"stylesheet"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.facebook.com/rsrc.php/v2/ya/r/D6j03OZ0sMs.css","https://www.facebook.com/rsrc.php/v2/ya/r/D6j03OZ0sMs.css",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["5499"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 26 Apr 2016 03:28:07 GMT"],"expires":["Wed, 26 Apr 2017 03:28:07 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["iPYSN0zOJoJCxngu0Z3R9Wqvh4Aod+smWi2WiRuwwBGY528bs1bu5Qro6z3zuzYLDnsBajR1oi2I+RouI4n8Pg=="]},"stylesheet"]
  nightmare:log did-get-response-details +4ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-frc3/v/t1.0-1/c0.0.50.50/p50x50/1891219_549142188537109_408040901_n.jpg?oh=e8b2c994355128859f08f5a5cd753c4b&oe=57A0500C","https://scontent.xx.fbcdn.net/hprofile-frc3/v/t1.0-1/c0.0.50.50/p50x50/1891219_549142188537109_408040901_n.jpg?oh=e8b2c994355128859f08f5a5cd753c4b&oe=57A0500C",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1624"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Thu, 05 May 2016 15:20:16 GMT"],"last-modified":["Tue, 11 Mar 2014 16:33:52 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xaf1/v/t1.0-1/p50x50/11075143_893766123994970_1602666424510824626_n.png?oh=2568398103a303763e9a68ba8186ce2e&oe=57B60D7C","https://scontent.xx.fbcdn.net/hprofile-xaf1/v/t1.0-1/p50x50/11075143_893766123994970_1602666424510824626_n.png?oh=2568398103a303763e9a68ba8186ce2e&oe=57B60D7C",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["3131"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Tue, 10 May 2016 03:01:50 GMT"],"last-modified":["Mon, 23 Mar 2015 09:06:58 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +4ms [{},false,"https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/10347400_1621009471502807_5760299865672541963_n.jpg?oh=5c8dbb4a91c7167c3ab0d060d661adb9&oe=57A56849","https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/10347400_1621009471502807_5760299865672541963_n.jpg?oh=5c8dbb4a91c7167c3ab0d060d661adb9&oe=57A56849",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1881"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Thu, 05 May 2016 18:13:39 GMT"],"last-modified":["Wed, 24 Jun 2015 15:19:11 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xtl1/v/t1.0-1/p50x50/13015224_10209044916698498_7852563377344045802_n.jpg?oh=6f16e95a9007f50ba90d3305ab52ed16&oe=57B924C3","https://scontent.xx.fbcdn.net/hprofile-xtl1/v/t1.0-1/p50x50/13015224_10209044916698498_7852563377344045802_n.jpg?oh=6f16e95a9007f50ba90d3305ab52ed16&oe=57B924C3",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1740"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Mon, 16 May 2016 17:42:27 GMT"],"last-modified":["Thu, 14 Apr 2016 21:52:44 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +12ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xpt1/v/t1.0-1/p50x50/11873360_763414500471076_6146458279104550239_n.jpg?oh=ee7a5a175868bd41e55f4b7e8b00651d&oe=57B33896","https://scontent.xx.fbcdn.net/hprofile-xpt1/v/t1.0-1/p50x50/11873360_763414500471076_6146458279104550239_n.jpg?oh=ee7a5a175868bd41e55f4b7e8b00651d&oe=57B33896",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1623"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Mon, 16 May 2016 11:21:31 GMT"],"last-modified":["Sat, 22 Aug 2015 20:15:01 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://scontent.xx.fbcdn.net/v/t1.0-0/p130x130/13103299_1104607056244208_3387632926376575291_n.png?oh=cb468bea33387c23ca2bf73d1d7b0242&oe=57BA429F","https://scontent.xx.fbcdn.net/v/t1.0-0/p130x130/13103299_1104607056244208_3387632926376575291_n.png?oh=cb468bea33387c23ca2bf73d1d7b0242&oe=57BA429F",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["97927"],"content-type":["image/png"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Sun, 15 May 2016 06:56:54 GMT"],"last-modified":["Wed, 27 Apr 2016 21:43:05 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2iJjU4/yg/l/es_ES/v-oXCbqITGS.js","https://www.facebook.com/rsrc.php/v2iJjU4/yg/l/es_ES/v-oXCbqITGS.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["53657"],"content-md5":["d8qLUeyshC0XSuIDyC3MiA=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Sun, 01 May 2016 20:45:15 GMT"],"expires":["Mon, 01 May 2017 20:45:15 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["y5S9nINy0yHSvskT61tGxRJ4un6cZ300wwe6idiNJ5G+YcOQeoYW7DIY5indakf9RHrak0JhMORwPkFnJJtlow=="]},"script"]
  nightmare:log did-get-response-details +6ms [{},false,"https://www.facebook.com/rsrc.php/v2/yd/r/6g7o8-V3L5m.js","https://www.facebook.com/rsrc.php/v2/yd/r/6g7o8-V3L5m.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["36778"],"content-md5":["rbuEhDUlVV3qy/1KL7KRKw=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Fri, 29 Apr 2016 15:33:02 GMT"],"expires":["Sat, 29 Apr 2017 15:33:02 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["jmvxP8hfF/fUe2tlrSg1sCpCJFehPqb74OtJIHEH0rmCLBelp8PxvRRirE+LMBC+ttTXG0hyFj5H0uU/Mid7qw=="]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.facebook.com/rsrc.php/v2iMal4/y1/l/es_ES/kyEqXhlhyPb.js","https://www.facebook.com/rsrc.php/v2iMal4/y1/l/es_ES/kyEqXhlhyPb.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["53919"],"content-md5":["c0CAU0jemtAlLWi6X8D4IA=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Mon, 02 May 2016 01:12:36 GMT"],"expires":["Tue, 02 May 2017 01:12:36 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["6kk/NBkm/eNdnPnfVhYRCzmM+nrUoYPBgLh9kv1Nm8SlvDCN5eBWAIf1F+8gKsp/udu2xAwpFUCtAGLdxxhVsw=="]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.facebook.com/rsrc.php/v2/y7/r/gZ7IAY3202F.js","https://www.facebook.com/rsrc.php/v2/y7/r/gZ7IAY3202F.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["6974"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 26 Apr 2016 13:56:33 GMT"],"expires":["Wed, 26 Apr 2017 13:56:33 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["xXN8XTkAYwri0UIDh7XUCOzWj19WWgimVe2dG+cl1W1x9MY1Y7UxCJNxszkELBWc4EWHZ06e1DWkm9bH/B2tzg=="]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2ipOn4/yW/l/es_ES/0lvpPd0e4sH.js","https://www.facebook.com/rsrc.php/v2ipOn4/yW/l/es_ES/0lvpPd0e4sH.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["18642"],"content-md5":["mnXxWhs3SgPY50rkc1ZG8Q=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Fri, 29 Apr 2016 15:42:29 GMT"],"expires":["Sat, 29 Apr 2017 15:42:29 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["cIHAB2sbmpI+4C/AkrGTnYvK8It4SmyhJ+yexD84ye0NijnCe73LIWZffChl1wi9bAb9+eYW9UC4WwIPCAZVSQ=="]},"script"]
  nightmare:log did-get-response-details +26ms [{},false,"https://www.facebook.com/rsrc.php/v2i1Ze4/yk/l/es_ES/P39AcLQQtS5.js","https://www.facebook.com/rsrc.php/v2i1Ze4/yk/l/es_ES/P39AcLQQtS5.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["60343"],"content-md5":["S9wKcFc/pmY4mBQT25QUJQ=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Mon, 02 May 2016 10:00:39 GMT"],"expires":["Tue, 02 May 2017 10:00:39 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["Rwj2OvnZc2E6tJqUiQ439SHWWV1r/fbSdwBp2dlNLrLJ7AyTP/ktZVgx8S/ma6WyT0WbcEQDK6t5sj1eLUCkRQ=="]},"script"]
  nightmare:log did-get-response-details +15ms [{},false,"https://www.facebook.com/rsrc.php/v2/yp/r/er8h_ATQ_Ek.js","https://www.facebook.com/rsrc.php/v2/yp/r/er8h_ATQ_Ek.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["31847"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 26 Apr 2016 14:01:45 GMT"],"expires":["Wed, 26 Apr 2017 14:01:45 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["YojDsCr7j2TfK5SMcfgsk01lOlMfkECnt3Y7IP7d+zRqDNm0srd2IVnIPQnUe2kPqX+VvpM73jkFAz22RH6gTw=="]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.facebook.com/rsrc.php/v2/yi/r/fTE87nSwcnI.js","https://www.facebook.com/rsrc.php/v2/yi/r/fTE87nSwcnI.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["1243"],"content-md5":["IgP4Zz31Zn6fjlt9BQKqZg=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Mon, 02 May 2016 00:14:57 GMT"],"expires":["Tue, 02 May 2017 00:14:57 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["Bv3XNu2h/vxj/M7L2aCRbuZG7ccrlL6YW/lUUq4CSEs0vpqig6otGXVS7BIDnLeOG8FsKibSxo9R6VLaoGK61g=="]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"https://www.facebook.com/rsrc.php/v2/ye/r/7PKktC35Nw6.js","https://www.facebook.com/rsrc.php/v2/ye/r/7PKktC35Nw6.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["824"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 26 Apr 2016 13:55:03 GMT"],"expires":["Wed, 26 Apr 2017 13:55:03 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["c+Jl0y924SCV69ej7RXxHg6WmToEm5GXuoBk5sYKKqi8Ia8Q8JTq5XHf7VzH84MhZ+DQx8qyiLXfzBhkXzwLvw=="]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xal1/v/t1.0-1/p50x50/13015383_934355396682117_8237212272369782603_n.jpg?oh=7667e2ea20761df624cc3b6843e371db&oe=57E334A6","https://scontent.xx.fbcdn.net/hprofile-xal1/v/t1.0-1/p50x50/13015383_934355396682117_8237212272369782603_n.jpg?oh=7667e2ea20761df624cc3b6843e371db&oe=57E334A6",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1493"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Thu, 05 May 2016 16:03:07 GMT"],"last-modified":["Thu, 21 Apr 2016 15:51:14 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xfa1/v/t1.0-1/c0.0.50.50/p50x50/1535592_10202393582256407_1770741181_n.jpg?oh=0f31a19c7340d4a4d16c2f4379cf3e57&oe=57ABE2C0","https://scontent.xx.fbcdn.net/hprofile-xfa1/v/t1.0-1/c0.0.50.50/p50x50/1535592_10202393582256407_1770741181_n.jpg?oh=0f31a19c7340d4a4d16c2f4379cf3e57&oe=57ABE2C0",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1746"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Tue, 17 May 2016 08:47:09 GMT"],"last-modified":["Wed, 15 Jan 2014 18:26:55 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://scontent.xx.fbcdn.net/hprofile-xtp1/v/t1.0-1/p50x50/13043465_1595030780786985_5583757645371244840_n.jpg?oh=7c00ee680e1ff2b54cf1edf9d441472c&oe=57B7FED3","https://scontent.xx.fbcdn.net/hprofile-xtp1/v/t1.0-1/p50x50/13043465_1595030780786985_5583757645371244840_n.jpg?oh=7c00ee680e1ff2b54cf1edf9d441472c&oe=57B7FED3",200,"GET","https://www.facebook.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=1209600, no-transform"],"content-length":["1593"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Tue, 17 May 2016 09:38:00 GMT"],"last-modified":["Wed, 20 Apr 2016 09:00:54 GMT"],"status":["200"],"timing-allow-origin":["*"]},"image"]
  nightmare:log did-get-response-details +158ms [{},false,"https://www.facebook.com/rsrc.php/v2/y_/r/8Pydq4OvMYJ.png","https://www.facebook.com/rsrc.php/v2/y_/r/8Pydq4OvMYJ.png",200,"GET","https://www.facebook.com/rsrc.php/v2/yV/r/BxHWQHjTiGT.css",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-length":["2862"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 13:51:23 GMT"],"expires":["Wed, 26 Apr 2017 13:51:23 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-fb-debug":["XX8e2ZF1MuS6BoF5+DWkowpwz8nSbKmULssIUlkAZYxQE9m/VsuPJT4BHke8S9uAFW5cOQJ/0csBtYbt+iKIow=="]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2/ye/r/FXR5eNvSyqw.png","https://www.facebook.com/rsrc.php/v2/ye/r/FXR5eNvSyqw.png",200,"GET","https://www.facebook.com/rsrc.php/v2/yV/r/BxHWQHjTiGT.css",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-length":["1450"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 17:02:49 GMT"],"expires":["Wed, 26 Apr 2017 17:02:49 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-fb-debug":["IeWeSEhPPgNCClXAuz8eSDRwgPrjR7B7dLTTsb8XMXlTjCbdBODXvFR49aAWs91qijBR+9At1spxNxf1JaNreg=="]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2/y1/r/wL6VQj7Ab77.png","https://www.facebook.com/rsrc.php/v2/y1/r/wL6VQj7Ab77.png",200,"GET","https://www.facebook.com/rsrc.php/v2/yV/r/BxHWQHjTiGT.css",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-length":["1232"],"content-type":["image/png"],"date":["Tue, 26 Apr 2016 03:23:54 GMT"],"expires":["Wed, 26 Apr 2017 03:23:54 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-fb-debug":["zp/ef85aM5zDjQsxq7caDXy9IajSMBHY4kPityNariWVYqe2+PdbHctJkEMMkoFXmFs+dWqb8KglV15RRIN1Gg=="]},"image"]
  nightmare:log did-get-response-details +147ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["484484"],"cache-control":["public,max-age=1209600"],"content-length":["211710"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:18:06 GMT"],"via":["1.1 a038e18809b2b8ea7c607f48d7981dc0.cloudfront.net (CloudFront)"],"x-amz-cf-id":["wQOIdhDxAQHp8f2fweZhXgAcxDmkTGj5RVKjuyvL6FZvP0hXrZ7LLg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +9ms [{},false,"https://www.facebook.com/rsrc.php/v2/yu/r/-N4O24bI2Vm.png","https://www.facebook.com/rsrc.php/v2/yu/r/-N4O24bI2Vm.png",200,"GET","https://www.facebook.com/rsrc.php/v2/ya/r/D6j03OZ0sMs.css",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-length":["8871"],"content-md5":["SMalv0bs1v3zQvXXvj8cyg=="],"content-type":["image/png"],"date":["Thu, 28 Apr 2016 20:04:06 GMT"],"expires":["Fri, 28 Apr 2017 20:04:06 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-fb-debug":["tY0OOrxvgMEBJVoGfjyfOVgJheJHwroeyHLi0t2XOXmXm1yzeoEl6awC3laVBzVKizm7rOsUlWplygBlqqXX+w=="]},"image"]
  nightmare:log did-frame-finish-load +9ms [{},false]
  nightmare:log did-get-response-details +12ms [{},false,"https://www.facebook.com/rsrc.php/v2/yl/r/waXUfQyg2LB.js","https://www.facebook.com/rsrc.php/v2/yl/r/waXUfQyg2LB.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["588"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Thu, 21 Apr 2016 13:36:11 GMT"],"expires":["Fri, 21 Apr 2017 13:36:11 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["QXFFYNQu1+gM6bt76i9jbEIdHIRIJVvHhAf1ATXWEIljK3AipQumiSVElrhe+paOi12wJ6XL39vrb5GTofGXJw=="]},"script"]
  nightmare:log did-get-response-details +2ms [{},false,"https://www.facebook.com/rsrc.php/v2/yd/r/cUh6Crhcnhs.js","https://www.facebook.com/rsrc.php/v2/yd/r/cUh6Crhcnhs.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["374"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 26 Apr 2016 03:36:55 GMT"],"expires":["Wed, 26 Apr 2017 03:36:55 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["IhvwIpZy3lip41pjVs0dfvk1LBHB1JQp1N2XCGozU/JTZME03VJx990WcfB92QUI0tlarJ/DkgdirGDRDsPzqA=="]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/rsrc.php/v2/yT/r/kTn63TnRtMK.js","https://www.facebook.com/rsrc.php/v2/yT/r/kTn63TnRtMK.js",200,"GET","https://www.facebook.com/v2.3/plugins/page.php?app_id=&channel=http%3A%2F%2Fstaticxx.facebook.com%2Fconnect%2Fxd_arbiter.php%3Fversion%3D42%23cb%3Df4666c627f6e38%26domain%3Dspecials.mediamarkt.es%26origin%3Dhttp%253A%252F%252Fspecials.mediamarkt.es%252Ff304173391240dc%26relation%3Dparent.parent&container_width=320&height=240&hide_cover=false&href=https%3A%2F%2Fwww.facebook.com%2FMediaMarkt.ES&locale=es_ES&sdk=joey&show_facepile=true&show_posts=false&width=320",{"access-control-allow-credentials":["true"],"access-control-allow-origin":["*"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["651"],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 26 Apr 2016 03:36:55 GMT"],"expires":["Wed, 26 Apr 2017 03:36:55 GMT"],"last-modified":["Mon, 01 Jan 2001 08:00:00 GMT"],"status":["200"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["bbonGyO2hvQl3P+vSo6NZqXYegohfWfpJgFCR/NfPEkJOg/WES+nPz4QJcTPnky+0ENlaDwE5kfsl0AEP812NA=="]},"script"]
  nightmare:log did-get-response-details +3ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12893"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:09 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-response-details +343ms [{},false,"https://www.google.com/js/bg/bjEnSSRtkQDmV5c2Pm_sWdo8WoIWRicVzzTAt_BvtSY.js","https://www.google.com/js/bg/bjEnSSRtkQDmV5c2Pm_sWdo8WoIWRicVzzTAt_BvtSY.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"age":["1067950"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["4183"],"content-type":["text/javascript"],"date":["Thu, 21 Apr 2016 01:00:59 GMT"],"expires":["Fri, 21 Apr 2017 01:00:59 GMT"],"last-modified":["Wed, 13 Apr 2016 15:04:39 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +16ms [{},false,"https://static.doubleclick.net/instream/ad_status.js","https://static.doubleclick.net/instream/ad_status.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"access-control-allow-origin":["*"],"age":["801"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=900"],"content-length":["29"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 09:26:48 GMT"],"expires":["Tue, 03 May 2016 09:41:48 GMT"],"last-modified":["Thu, 12 Dec 2013 23:40:16 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +75ms [{},false,"https://fonts.gstatic.com/s/roboto/v15/oMMgfZMQthOryQo9n22dcuvvDin1pK8aKteLpeZ5c0A.woff2","https://fonts.gstatic.com/s/roboto/v15/oMMgfZMQthOryQo9n22dcuvvDin1pK8aKteLpeZ5c0A.woff2",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"access-control-allow-origin":["*"],"age":["407782"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-length":["10292"],"content-type":["font/woff2"],"date":["Thu, 28 Apr 2016 16:23:47 GMT"],"expires":["Fri, 28 Apr 2017 16:23:47 GMT"],"last-modified":["Wed, 14 Jan 2015 22:48:18 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"other"]
  nightmare:log did-frame-finish-load +18ms [{},false]
  nightmare:log did-frame-finish-load +38ms [{},false]
  nightmare:log did-get-response-details +122ms [{},false,"https://www.youtube.com/get_video_info?html5=1&video_id=-MMIjtLXN2g&cpn=nzfN-AdQi1ocwiqo&eurl=http%3A%2F%2Ftiendas.mediamarkt.es%2F&el=embedded&hl=en_US&sts=16918&lact=31&autoplay=1&width=995&height=300&ei=-XEoV9qXII27cq_SreAK&iframe=1&c=WEB&cver=1.20160428&cplayer=UNIPLAYER&cbr=Chrome&cbrver=50.0.2661.86&cos=Macintosh&cosver=10_11_4","https://www.youtube.com/get_video_info?html5=1&video_id=-MMIjtLXN2g&cpn=nzfN-AdQi1ocwiqo&eurl=http%3A%2F%2Ftiendas.mediamarkt.es%2F&el=embedded&hl=en_US&sts=16918&lact=31&autoplay=1&width=995&height=300&ei=-XEoV9qXII27cq_SreAK&iframe=1&c=WEB&cver=1.20160428&cplayer=UNIPLAYER&cbr=Chrome&cbrver=50.0.2661.86&cos=Macintosh&cosver=10_11_4",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-store"],"content-encoding":["gzip"],"content-length":["5953"],"content-type":["application/x-www-form-urlencoded"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"xhr"]
  nightmare:log did-get-response-details +37ms [{},false,"https://ebmediamarkt.empathybroker.com/eb-mediamarkt/services/ping?createSession=true&createUser=false&jsonCallback=angular.callbacks._0","https://ebmediamarkt.empathybroker.com/eb-mediamarkt/services/ping?createSession=true&createUser=false&jsonCallback=angular.callbacks._0",200,"GET","http://tiendas.mediamarkt.es/",{"connection":["keep-alive"],"content-length":["75"],"content-type":["application/json"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"server":["Apache/2.4.7 (Ubuntu)"],"x-frame-options":["DENY"]},"script"]
  nightmare:log did-frame-finish-load +52ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +2ms [{},["http://d243u7pon29hni.cloudfront.net/images/favicon.ico"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:actions .evaluate() fn on the page +0ms
  nightmare:log did-get-response-details +37ms [{},false,"http://eu1-search.doofinder.com/4/options/376fd770479c4a00b10f5b80887878e0.js","http://eu1-search.doofinder.com/4/options/376fd770479c4a00b10f5b80887878e0.js",200,"GET","http://tiendas.mediamarkt.es/",{"cache-control":["public, max-age=3600"],"connection":["keep-alive"],"content-length":["820"],"content-type":["text/javascript; charset=utf-8"],"date":["Tue, 03 May 2016 09:40:10 GMT"]},"script"]
  nightmare:log did-get-response-details +35ms [{},false,"https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=9C3FE81A557C64BA279FC45FEBF2A634A453C1F9.4C9ED20D5E30EDA1EA9D4A1ABB6958AD258D7611&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.921&sver=3&source=youtube&mime=audio%2Fwebm&pl=18&initcwndbps=4077500&itag=250&lmt=1461579958404327&clen=3436&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-3435&rn=0&rbuf=0","https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=9C3FE81A557C64BA279FC45FEBF2A634A453C1F9.4C9ED20D5E30EDA1EA9D4A1ABB6958AD258D7611&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.921&sver=3&source=youtube&mime=audio%2Fwebm&pl=18&initcwndbps=4077500&itag=250&lmt=1461579958404327&clen=3436&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-3435&rn=0&rbuf=0",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-origin":["https://www.youtube.com"],"access-control-expose-headers":["Client-Protocol, Content-Length, Content-Type, X-Bandwidth-Est, X-Bandwidth-Avg, X-Walltime-Ms"],"alt-svc":["quic=\":443\"; ma=2592000"],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=21300"],"connection":["keep-alive"],"content-length":["3436"],"content-type":["audio/webm"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Tue, 03 May 2016 09:40:10 GMT"],"last-modified":["Mon, 25 Apr 2016 10:25:58 GMT"],"server":["gvs 1.0"],"timing-allow-origin":["https://www.youtube.com"],"x-content-type-options":["nosniff"]},"xhr"]
  nightmare:log did-get-response-details +4ms [{},false,"https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=A4AF0885CE94F03AC3B5FD67DC3645C8DDFC1931.DF0DFB662A60883D4F59781C4328C6AADE0B81BC&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.880&sver=3&source=youtube&mime=video%2Fwebm&pl=18&initcwndbps=4077500&itag=244&lmt=1461580131350055&clen=389559&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-122614&rn=1&rbuf=0","https://r19---sn-aiglln76.googlevideo.com/videoplayback?ip=89.197.64.162&key=yt6&signature=A4AF0885CE94F03AC3B5FD67DC3645C8DDFC1931.DF0DFB662A60883D4F59781C4328C6AADE0B81BC&mm=31&mn=sn-aiglln76&id=o-AGCAHeZrzPLk9tCOzT4d7XYhDbuRGUCLpHphnRkSXpY_&ms=au&mt=1462268332&mv=m&dur=6.880&sver=3&source=youtube&mime=video%2Fwebm&pl=18&initcwndbps=4077500&itag=244&lmt=1461580131350055&clen=389559&requiressl=yes&nh=IgpwcjAzLmxocjE0KgkxMjcuMC4wLjE&ipbits=0&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cnh%2Cpl%2Crequiressl%2Csource%2Cupn%2Cexpire&expire=1462290010&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&upn=rkZLHvlSJ88&gir=yes&cpn=nzfN-AdQi1ocwiqo&alr=yes&keepalive=yes&ratebypass=yes&c=WEB&cver=1.20160428&range=0-122614&rn=1&rbuf=0",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"accept-ranges":["bytes"],"access-control-allow-credentials":["true"],"access-control-allow-origin":["https://www.youtube.com"],"access-control-expose-headers":["Client-Protocol, Content-Length, Content-Type, X-Bandwidth-Est, X-Bandwidth-Avg, X-Walltime-Ms"],"alt-svc":["quic=\":443\"; ma=2592000"],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=21300"],"connection":["keep-alive"],"content-length":["122615"],"content-type":["video/webm"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Tue, 03 May 2016 09:40:10 GMT"],"last-modified":["Mon, 25 Apr 2016 10:28:51 GMT"],"server":["gvs 1.0"],"timing-allow-origin":["https://www.youtube.com"],"x-content-type-options":["nosniff"]},"xhr"]
  nightmare:log did-get-response-details +230ms [{},false,"https://s.youtube.com/api/stats/qoe?event=streamingstats&fmt=244&afmt=250&cpn=nzfN-AdQi1ocwiqo&ei=-XEoV_CnOdT4iAb04YWwAg&el=embedded&docid=-MMIjtLXN2g&ns=yt&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&html5=1&c=WEB&cver=1.20160428&cplayer=UNIPLAYER&cbr=Chrome&cbrver=50.0.2661.86&cos=Macintosh&cosver=10_11_4&vps=0.000:N,0.015:B,0.364:B&cmt=0.015:0.000,0.364:0&afs=0.364:250::i&vfs=0.364:244:244::i&view=0.364:995:300&bwe=0.364:2013200&bh=0.364:0.000&bat=0.364:1:1&vis=0.364:0","https://s.youtube.com/api/stats/qoe?event=streamingstats&fmt=244&afmt=250&cpn=nzfN-AdQi1ocwiqo&ei=-XEoV_CnOdT4iAb04YWwAg&el=embedded&docid=-MMIjtLXN2g&ns=yt&fexp=9405972%2C9407191%2C9407472%2C9416126%2C9416891%2C9418405%2C9422596%2C9428398%2C9428520%2C9429381%2C9431012%2C9431530%2C9431621%2C9433096%2C9433643%2C9433946%2C9434290%2C9434845%2C9435039%2C9435483&html5=1&c=WEB&cver=1.20160428&cplayer=UNIPLAYER&cbr=Chrome&cbrver=50.0.2661.86&cos=Macintosh&cosver=10_11_4&vps=0.000:N,0.015:B,0.364:B&cmt=0.015:0.000,0.364:0&afs=0.364:250::i&vfs=0.364:244:244::i&view=0.364:995:300&bwe=0.364:2013200&bh=0.364:0.000&bat=0.364:1:1&vis=0.364:0",204,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1&wmode=opaque&html5=1&enablejsapi=1&version=3",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 09:40:10 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"pragma":["no-cache"],"server":["Video Stats Server"],"status":["204"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]},"image"]
Window object available for: http://tiendas.mediamarkt.es/
Finished processing: http://tiendas.mediamarkt.es/
```

and the log after I close the electron window manually:

``` cli
  nightmare:log did-get-response-details +3m [{},false,"https://2281002.log.optimizely.com/event?a=2281002&d=2281002&y=false&src=js&s175595850=false&s175648874=gc&s175754388=direct&s175759765=none&tsent=1462268572.293&n=engagement&u=oeu1460111807423r0.20435854396782815&wxhr=true&time=1462268572.291&f=4154580812&g=28930509&cx2=83a9dc65","https://2281002.log.optimizely.com/event?a=2281002&d=2281002&y=false&src=js&s175595850=false&s175648874=gc&s175754388=direct&s175759765=none&tsent=1462268572.293&n=engagement&u=oeu1460111807423r0.20435854396782815&wxhr=true&time=1462268572.291&f=4154580812&g=28930509&cx2=83a9dc65",200,"GET","https://teamtreehouse.com/",{"access-control-allow-credentials":["true"],"access-control-allow-headers":["Content-Type, X-Requested-With"],"access-control-allow-methods":["GET"],"access-control-allow-origin":["https://teamtreehouse.com"],"connection":["keep-alive"],"content-length":["2"],"content-type":["application/json"],"date":["Tue, 03 May 2016 09:42:52 GMT"],"p3p":["CP=\"IDC DSP COR CURa ADMa OUR IND PHY ONL COM STA\""],"server":["nginx"]},"xhr"]
  nightmare:log destroyed +498ms [{}]
```

The program I'm using (iTerm) cuts off the logs, so if you need more just let me know and I'll try and figure out how to get it all in full.

Thanks
 @rosshinkley, here's a separate log file this https://drive.google.com/a/conversion.com/file/d/0B5HUOoRm9YUbR1FtaVphZjR6TWc/view - thanks for  that useful tip! Unfortunately I couldn't recreate the issue when running `async.queue` with `1` as the concurrency parameter, so the log file is showing it as `10` so perhaps that may be it? Ideally I'd like to run Nightmare multiple times as I want to scrape thousands of websites everyday and doing it one by one is not really feasible...
 Ok, Iâ€™ve only gotten this to reproduce a few times, but it seems like the issue is well below Nightmare or Electronâ€”the HTTP request for the initial HTML content of the page never actually closes and finishes, so we never move on to evaluating the JS that gets `window`. Iâ€™m not sure if this is something funky with Treehouseâ€™s server (I _only_ observed this behavior with Treehouse), with Chromium, or deep in the network stack on the OS.

On the Electron side, we get response details for the beginning of the HTML and we get the `dom-ready` event, but we get no finish or failure events. Inside the browser window, `document.readyState` never moves from `interactive` to `complete` and the windowâ€™s `load` event never fires. Oddly, though, the `DOMContentLoaded` event _does_ fire.

Soâ€¦ Iâ€™m thinking the best way to address this is:
1. Listen for the `dom-ready` event on `webContents`.
2. Add a timeout to `goto` (default it toâ€¦ 30s? Make it customizableâ€¦ by goto call? By Nightmare instance?) If the timer runs out and `dom-ready` has happened, consider the load successful. If the event didnâ€™t happen, consider the load a failure.

Alternatively, we could just have the timer and consider it a failure regardless of what events have happened. I can certainly understand that argument given that things inside the browser window are certainly not in a 100% a-ok state (though they do seem 99.999% ok).

@rosshinkley thoughts?
 More digginâ€™: I believe the issue is related to caching/sessions/user data:
- I occasionally get the exact same crash in Chromiumâ€™s disk cache backend creating an entry when running this (specifically, in `disk_cache::BackendImpl::CreateEntryImpl`) and
- The hanging requests appear to be exclusively requests Chromium is attempting to serve from cache. 

Treehouse happens to use ETags and set relatively long expire headers, which may be causing/exacerbating the issue.

Iâ€™m going to guess (based on very little data) that this is probably a result of so many separate Electron processes using the same persistent (disk-based) session by virtue of their sessions having the same name (the default session) and sharing the same user data directory. @inversion suspected something along these lines quite a while back, too: https://github.com/segmentio/nightmare/issues/238#issuecomment-155024950 So:
1. I still think the above approach (timeout, succeed w/ DOM ready) is a good practice regardless and it will alleviate the symptoms of this issue, so I will see about writing a PR for it.
2. Eventually moving to a 1 electron process, N browser windows model will probably alleviate this.
3. Other methods for â€œfixingâ€ the problem include randomizing the partition name (or keeping it in memory) or randomizing the user data directory (only do those if they arenâ€™t explicitly specified by the user).

Iâ€™m a little hesitant on (3) since it changes caching drastically and I donâ€™t really have _hard_ evidence of the problem. _If_ we did some version of it, I think Iâ€™d go for in-memory partitions unless the user specifies a partition name. I think (?) (2) is still probably something we want to doâ€”in which case, I think thatâ€™s the best long term solution.
 (Lending credence to the above theory, I have so far been unable to reproduce the issue while using memory partitions.)
  I've got a file input in a form, how to handle it?
 @kud Or you can use Nightmare v1.8.2, which does have file upload functionality, but uses PhantomJS instead of Electron. https://github.com/segmentio/nightmare/tree/1.8.2 ðŸ˜‰
  Hello!

This pull is the result of doing a pretty extensive rewrite of nightmare. The readme.md describes some of the new functionality introduced, however, beyond using promises and the auto-chain (fluent) functionality as well as rebasing on 'Nightmare.prototype', there are other dev-centric goals that I wanted to get into the codebase. These are using ecmascript 5 features when it made sense, reducing boilerplate code, modularizing when possible, and reducing dependencies to well known and maintained libraries.

I've been forward porting pulls when they were committed to nightmare. While the commits aren't 1:1 the functionality should be close nee identical to what is in the base fork.

If you would, please check it out and see if these changes align with Nightmare's goals.

Thanks!
 I personally wouldn't mind dropping the `.chain()` altogether. When using with `async`/`await` (via babel) or with [co](https://github.com/tj/co) it's seldom needed.

e.g.

``` javascript
async function browserGoogle () {
  const browser = new Nightmare()

  await browser.goto('http://yahoo.com')
  await browser.type('input[title="Search"]', 'github nightmare')
  await browser.click('.searchsubmit')
}
```

or

``` javascript
co(function * () {
  const browser = new Nightmare()

  yield browser.goto('http://yahoo.com')
  yield browser.type('input[title="Search"]', 'github nightmare')
  yield browser.click('.searchsubmit')
})
```

When writing code that has a lot of evaluates that are used to choose branch it's especially useful.
 Yeah, I tend to agree - aside from really simple code you're going to have a number of branches which reduces the length of the chain -- plus it leaves the door open for harder to troubleshoot exceptions that may occur somewhere in the chain.

That said, however, it does provide for an easy migration path from the current Nightmare and slightly more readable code when using the fluent, chained, style.

The pattern also has prior precedence in libraries such as lodash that include a chain method for similar readability benefit.

since it's one method, it's easy enough to deprecate in the future...
 Hey guys, can we please have a follow-up on this one? (e.g. when/if could we expect this PR to be merged, can `.chain()` be considered deprecated, etc.) I'd really like to start using fresh new Nightmare with pure async/await env.
 Thank you for detailed response! I didn't realize that each manipulation returns thenable, thus can basically be used individually. That's exactly what I was looking for.
  the missing catch wouldn't happen to cause a 'Cannot read property 'dock'' would it?
 @shesmu no, it doesnâ€™t. Are you referring to #602, or are you seeing that error independently (and do you have a reproducible test case)? I can see, where that error is happening, but canâ€™t see how the conditions that cause it would ever be true. Iâ€™d love to know if you have a way to make it reliably happen.
  Hi, 
I'm running this code below. the Yahoo.js example. The electron window shows in events in following order.
1) Yahoo search button being clicked
2) 'github nightmare' typed in search box
3) Terminates suddenly whilst on the same page. 

Appreciate some advise. Thanks very much. 

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

nightmare
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('#uh-search-button')
  .wait('#main')
  .evaluate(function () {
    return document.querySelector('#main .searchCenterMiddle li a').href
  })
  .end()
  .then(function (result) {
    console.log(result)
  })
```

This is the debug messages I get.

```
ming_o01 (master) nightmare1 $ DEBUG=nightmare node --harmony yahoo.js
  nightmare queueing action "goto" for http://yahoo.com +0ms
  nightmare queueing action "type" +19ms
  nightmare queueing action "click" +17ms
  nightmare queueing action "wait" +2ms
  nightmare queueing action "evaluate" +2ms
  nightmare running +3ms
ming_o01 (master) nightmare1 $
```
 @rosshinkley I got the output below. 

```
ming_o01 (master) nightmare1 $ DEBUG=nightmare node yahoo.js
  nightmare queueing action "goto" for http://yahoo.com +0ms
  nightmare queueing action "type" +14ms
  nightmare queueing action "click" +7ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "evaluate" +1ms
  nightmare running +3ms
'Cannot read property \'blur\' of null'
ming_o01 (master) nightmare1 $
```

Any ideas on the error? 
 @rosshinkley I posted a new issue on the followup of the error. Appreciate your help. Thanks very much. 
  I'm running the example yahoo.js code locally on windows 8 with electron and node v6.0.0  installed locally. 
iI'ved tried both `node yahoo.js` and  `node --harmony yahoo.js`  but i get this error message. 

```
C:\Users\ming_o01\nightmarejs\electron-quick-start\nightmare1\yahoo.js:5
    var link = yield nightmare
                     ^^^^^^^^^
SyntaxError: Unexpected identifier
    at exports.runInThisContext (vm.js:53:16) 
    at Module._compile (module.js:511:25) 
    at Object.Module._extensions..js (module.js:550:10)
    at Module.load (module.js:456:32)
    at tryModuleLoad (module.js:415:12)
    at Function.Module._load (module.js:407:3)
    at Function.Module.runMain (module.js:575:10)
    at startup (node.js:159:18)
    at node.js:444:3
```

this is the actual code. 

```
var Nightmare = require('nightmare');
var nightmare = Nightmare({ show: true })

var nightmare = Nightmare()
    var link = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('#UHSearchWeb')
      .wait('#main')
      .evaluate(function () {
    return document.querySelector('#main .searchCenterMiddle li a').href
  })
  .end()
  .then(function (result) {
    console.log(result)
  })
```

Thanks very much. 
 @rosshinkley Thanks for the clarification. 
  > The only thing I'm not real crazy about is the debugging of the version information. That seems to defeat the purpose of using a lazy getter that props up the cached version values.

Would agree. Maybe not really necessary at all. If you still want the logging, the electron process could just `parent.emit('log', [versions])` when it starts.

Other note: if `engineVersions` is only available on a Nightmare _instance,_ maybe no great need for `execSync`. I know I kind of lobbied for this over on Gitter, but thatâ€™s because I was thinking of it being on the Nightmare constructor/the library exports, where it was less tied to an instance.
  I have done fresh installs of nightmare JS repeatedly, in an attempt to solve this issue. No dice.

I run `npm i nightmare`. It installs nightmare NPM version 3.3.6. It also installs electron for me. Electron-download NPM version 2.14.15 is installed, as well as electron-prebuilt NPM version 2.14.6.

Running it inside of my virtual box (running Ubuntu 14.04.3), it produces the error `nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly +8ms`.

I have reinstalled multiple times. I've tried installing electron separately. No matter what I attempt, I always get that error.

I should point out, I can get the code to run perfectly on OSX. After I do a fresh reinstall outside of my virtual box, it works perfectly fine on OSX.

EDIT: Summary commands I have attempted:
`npm uninstall electron && npm uninstall nightmare`
`npm i nightmare`
`npm i -g electron`
`npm i segmentio/nightmare`
 First off, your version numbers look like versions of NPM rather than versions of nightmare (latest is 2.3.4) or electron (latest is 0.37.7). You should only need to install nightmare, though.

Are you running the install commands inside your virtual box or on OSX? Nightmare has a dependency on electron-prebuilt, which downloads a platform-appropriate binary on install. So if you're installing on OSX but running on Linux it won't find the Linux binary.
 I'm installing nightmare using `npm i nightmare` inside the virtual box. I did an uninstall of both electron and nightmare before that. All of this was done within the virtual box.
 For versions: electron-download is 2.1.1, prebuilt is 0.37.7, and nightmare is 2.3.4
 What do you have installed in node_modules/nightmare/node_modules/electron-prebuilt/dist?

Do you have any output from npm install?
 Nothing inside of node_modules/nightmare/node_modules. That directory doesn't exist.

npm install outputs that the packages were installed correctly, from what I can tell. I can add the output here if you'd like to see it.
 To give a lil more context, here's the sample code I have that's failing.

```
var Nightmare = require('nightmare');

var nightmare = Nightmare({
    show: false,
    webPreferences: {
        partition: 'custom'
    }
});

nightmare
    .goto('http://google.com')
    .evaluate(function () {
        return document.title;
    }).then(function (title) {
        console.log(title);
    });

```

That outputs:

```
nightmare queueing action "goto" for http://google.com +0ms
nightmare queueing action "evaluate" +5ms
nightmare running +7ms
nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly +7ms
```
 You may want to run with `DEBUG=nightmare:*,electron:*` to see output from electron, too. You might get some better details about why things are failing.
 @Mr0grog Just tried that. Getting this error now:

`electron:stderr /vagrant/code/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libgtk-x11-2.0.so.0: cannot open shared object file: No such file or directory +0m`
 Ok, so you are at least missing libgtk, which Electron needs to run. You may want to look at #224 for a better sense of all the binary dependencies you need when running on Linux.
 I've got an update: I installed all the dependencies listed here: http://electron.atom.io/docs/v0.25.0/development/build-instructions-linux/

Now, my debug outputs literally nothing, even with `DEBUG=nightmare:*,electron:*` on. It just appears to exit silently.

Full command running:

`clear && DEBUG=nightmare:*,electron:* node --harmony workbench.js`

EDIT: I was running the command wrong. Now here's the error I'm getting: 

```
nightmare queueing action "goto" for http://google.com +0ms
nightmare queueing action "evaluate" +7ms
nightmare running +1ms
nightmare electron child process exited with code 1: general error - you may need xvfb +246ms
```

However, xvfb is installed and the newest version?

EDIT 2: running `xvfb-run node workbench.js` works perfectly fine. Unfortunately, I need to run this as part of a node server process.
 > xvfb is installed and the newest version

Is it running? _Generally_ you want to start Xvfb as a daemon process. Alternatively, you can `xvfb-run [xvfb args] node your-nightmare-script.js`

Additionally, if you donâ€™t have a system well-configured for running headlessly, there are a bunch of other things youâ€™ll want to ensure are configured and running properly. Check out the scripts in `nightmare/test` or bug @rosshinkley over on Gitter for moreâ€”he knows the ins-and-outs of the headless Linux issues much better than I.

Note also, if you are on Node v4+ (which is kind of a requirement nowâ€¦?) you donâ€™t need the `--harmony` flag anymore. (Though using it doesnâ€™t hurt anything.)
 @Mr0grog Do I need to? I was working under the assumption that nightmare would start the virtual display itself. Maybe that was my problem.
 > Do I need to?

Yes. In my experience, at least, itâ€™s pretty unusual for any tool that uses an X Windows display to actually _create_ oneâ€”the idea is usually that the program is simply asking the window server for a display to use (well, really a window to draw in, not even a display); itâ€™s not really the programâ€™s responsibility to worry about whether that display is real or virtual, how itâ€™s managed, etc.

There was some brief discussion not too long ago (https://github.com/segmentio/nightmare/issues/502#issuecomment-210601980) about whether it would be useful to do this automatically, but I donâ€™t know that itâ€™s gone anywhere. 
 Okay. I'm currently trying out Phantom+Casper+Spooky, seeing if that works a lil better. If I can't get that running, I'll probably switch back to nightmare again. I'll be sure to update this issue provided that doesn't go well.
 Gave it a try again this morning. I'm using https://www.npmjs.com/package/xvfb to spin up my xvfb process prior to my code. However, I'm still getting `nightmare electron child process exited with code 1: general error - you may need xvfb +56ms`

EDIT: My code:

My code:

```
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');

var xvfb = new Xvfb({
    silent: true
});
xvfb.startSync();

var nightmare = Nightmare({
    show: false,
    webPreferences: {
        partition: 'custom'
    }
});

nightmare
    .goto('https://google.com')
    .evaluate(function () {
        return document.title;
    })
    .end()
    .then(function (title) {
        console.log(title);
    });

xvfb.stopSync();
```

EDIT - using [node headless](https://github.com/kesla/node-headless) also doesn't work. I still get `nightmare electron child process exited with code 1: general error - you may need xvfb +0ms`
 Nightmare is async, so at least part of your problem is this:

``` js
xvfb.startSync();

Nightmare(...)
    .goto('https://google.com')
    .evaluate(function () {
        return document.title;
    })
    .end()
    .then(function (title) {
        console.log(title);
    });

// this stops xvfb before Nightmare even starts!
xvfb.stopSync();
```

Instead, you should be doing something more like:

``` js
xvfb.startSync();

Nightmare(...)
    .goto('https://google.com')
    .evaluate(function () {
        return document.title;
    })
    .end()
    .then(function (title) {
        console.log(title);
        // wait to stop xvfb until nightmare is actually finished
        xvfb.stop();
    })
    // and make sure to stop it even if something broke
    .catch(function() {
        xvfb.stop();
    });
```
 No dice. Even with `xvfb.stop` done inside the `then`, or calling nightmare inside of the `xvbp.start` callback, I still get the error.
 Whatâ€™s the actual electron output?
 Nothing. It just sits there. Using `DEBUG=nightmare:*,electron:* node workbench.js` yields nothing and the process just sits.
 > Using DEBUG=nightmare:_,electron:_ node workbench.js yields nothing and the process just sits.

Soâ€¦ does it just sit, printing nothing, or does it print the error about Xvfb? If nothing, youâ€™ve likely got some other issue, because that sounds like Electron isnâ€™t even getting a chance to try and start.
 @Mr0grog It literally just sits, printing nothing. Switching to `DEBUG=nightmare node workbench.js` shows me the nightmare log, which looks something like this:

```
nightmare queueing action "goto" for https://google.com +65ms
nightmare queueing action "evaluate" +1ms
nightmare running +0ms
nightmare electron child process exited with code 1: general error - you may need xvfb +25ms
```

I also get this error now:

```
Nightmare runner error:

    TypeError: Cannot read property 'dock' of undefined
        at Object.<anonymous> (/vagrant/code/node_modules/nightmare/lib/runner.js:54:29)
        at Module._compile (module.js:413:34)
        at Object.Module._extensions..js (module.js:422:10)
        at Module.load (module.js:357:32)
        at Function.Module._load (module.js:314:12)
        at loadApplicationPackage (/vagrant/code/node_modules/electron-prebuilt/dist/resources/default_app.asar/main.js:253:23)
        at Object.<anonymous> (/vagrant/code/node_modules/electron-prebuilt/dist/resources/default_app.asar/main.js:293:5)
        at Module._compile (module.js:413:34)
        at Object.Module._extensions..js (module.js:422:10)
        at Module.load (module.js:357:32)
```

EDIT: Never mind, now the original debug command is returning errors as well. Following output:

```
electron:stderr Xlib:  extension "RANDR" missing on display ":107". +0ms
electron:stderr App threw an error when running [TypeError: Cannot read property 'dock' of undefined] +186ms
```

EDIT 2: We're back to nothing after I tweaked my code again. No output, process just hangs forever.

```
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');

var xvfb = new Xvfb({
    silent: true
});


var nightmare = Nightmare({
    show: false,
    webPreferences: {
        partition: 'custom'
    }
});

try {
    xvfb.start(function () {
        nightmare
            .goto('https://google.com')
            .evaluate(function () {
                return document.title;
            })
            .end()
            .then(function (title) {
                console.log(title);
                xvfb.stop();
            });
    });
} catch (e) {
    xvfb.stop();
}
```

This outputs nothing again. Changing to `DEBUG=nightmare` outputs:

```
nightmare queueing action "goto" for https://google.com +0ms
  nightmare queueing action "evaluate" +3ms
  nightmare running +3ms
  nightmare electron child process exited with code 1: general error - you may need xvfb +48ms
```
 Okay, I'm basically starting from scratch. I re-provisioned my vagrant box. I'm reinstalling nightmare entirely via `npm uninstall nightmare && npm i nightmare`. I'm gonna be using node 5.5.0, npm 3.3.12. 
EDIT: Also installed xvfb via `sudo apt-get install xvfb`
My code is gonna be exactly this:

```
var Xvfb = require('xvfb');
var Nightmare = require('nightmare');

var xvfb = new Xvfb({
    silent: true
});
xvfb.startSync();

var nightmare = Nightmare({
    show: false,
    webPreferences: {
        partition: 'custom'
    }
});

nightmare
    .goto('https://google.com')
    .evaluate(function () {
        return document.title;
    })
    .end()
    .then(function (title) {
        console.log(title);
        xvfb.stopSync();
    });
```
 Result, even after all that:

```
nightmare queueing action "goto" for https://google.com +0ms
nightmare queueing action "evaluate" +9ms
nightmare running +8ms
nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly +12ms
```
 I have the same issue, the weird thing is it works perfectly on my laptop, but within my vps I got the `general error - you may need xvfb` error. I am not using `xvfb` in my code, as I did not use it on my laptop and it worked. Is the use of `xvfb` needed on virtual servers ? If yes, could you explain why?

Thanks a lot :-)

EDIT: I ran the code provided by @jamesaspence and it's working, but i'm still willing not to use `xvfb` if I don't understand the need to use it - it worked without it before...
 To solve this, I needed to install libxss. 
Use this command to install it on ubuntu 14: sudo apt-get install libxss1
  something like this:

``` javascript
var user_marks = yield nightmare
  .evaluate(function(){
    //return an object:
    var marks = {mark_1:"1001", mark_2:"2001", mark_3:"3001"};
    // or an array: var marks = [1001,2001,3001];
    return marks;
  });
```
 verified, works well :)
  I would add a `Nightmare.VERSION` for the version of Nightmare. And maybe rename `.versions()` to `.browserVersions()` or `engineVersions()`?
  To help people with debugging and other issues, we should make the versions of:
- Nightmare itself
- Electron
- Chromium

available at runtime via the API. See also #597
 A quick note on this: getting the versions for Electron/Chromium requires running Electron, so this either needs to be an async call or it will be a potentially slow, blocking call (the first time; we can cache it after that). Any thoughts on which approach is better, @rosshinkley?
 Well, maybe the Electron/Chrome version stuff isnâ€™t necessarily needed in API? We _could_ just log it whenever starting Electron if people only need it informationally. Not quite as much utility there, but maybe enough.
  Here is my code:

`Nightmare({ show: false })
    .viewport(150, 200)
    .goto('http://www.taoism.net/ttc/complete.htm')
    .wait()
    .screenshot('test.png')
    .end()
    .run(function(err, nightmare) {
        console.log('Done.');
    });`

RESULT:
Screenshot dimensions generated: 300x356
Resolution doubled

EXPECTED:
Screenshot dimensions generated: 150x200
Resolution normal (100% zoom)

Attaching generated screenshot.
![test](https://cloud.githubusercontent.com/assets/2205877/14786437/bbf11d44-0ab3-11e6-8af1-295adb046f67.png)

NOTE: the generated result is not proportionally scaled to expected (separate bug?)
 As far as proportions, thatâ€™s because `viewport` sets the size of the _window_ (debatable about whether thatâ€™s correct, but thatâ€™s what it does), while the screenshot only captures the actual content area, so it loses some pixels from the height for the title bar (and on the edges for the window frame, depending on platform).
 Is there any workaround to this? I want to be able to rely on the size I ask of it. Perhaps, a setting that I don't know of or an evaluate call?
 Thereâ€™s no super-easy way, but, as @rosshinkley noted, I wrote a short description of what you can do to counterract this [at the bottom of #498](https://github.com/segmentio/nightmare/issues/498#issuecomment-210710684). You could use a similar mechanism to [set the windowâ€™s content area](http://electron.atom.io/docs/v0.37.7/api/browser-window/#winsetcontentsizewidth-height-animate) instead of using Nightmareâ€™s `viewport()` method.
  Curious question: why name this `chromiumArguments` when the corresponding switches version is just `switches` (no â€œchromiumâ€ prefix)?
 Also, tests?
   #596 makes me wonder if changing `viewport()` to actually set the _viewport_ (as opposed to window) size would be a good breaking change for v3.
 Maybe have `goto` return as soon as a page is loading so you can execute scripts ASAP during load?

Have actions with selectors wait for the selector before doing the action (#388). Capybara (Ruby), for example, does this. It could possibly be configurable (though I think youâ€™d want opt-out rather than opt-in).
 > how are you planning on [changing the viewport size instead of window size]?

I think just calling [`window.setContentSize()`](http://electron.atom.io/docs/v0.37.8/api/browser-window/#winsetcontentsizewidth-height-animate) instead of [`window.setSize()`](http://electron.atom.io/docs/v0.37.8/api/browser-window/#winsetsizewidth-height-animate)

> To what end? Should preload be extended (or pluggable) instead?

I think I was thinking so you could get in as early as DOMContentLoaded or maybe before other scripts, but maybe specifying preload stuff somehow would be better. Not an idea Iâ€™d thought through deeply.
 I definitely agree that function signature is not only a little ugly, but very hard to get right. I have had to look it up in the README _literally every single time_ Iâ€™ve needed to use it and Iâ€™ve gone so far as to write it like `function (_, __, parent, ___, ____, done)` in some examples because you really only need one or two of those most of the time.

But why not just make those variables ambiently available in the pluginâ€™s closure instead of wrapping require? Or, barring that, have plugins take two args: an object with all the things (as youâ€™d get from the require call in your example) and the `done` callback?

(Also agree that dropping `renderer` would be pretty reasonable because there are other ways to get it.)
 > I was pondering out loud, and now I'm wondering if plugging preload is a good idea.

Itâ€™s probably not. I think my _real_ desire, initially, was just to be able to run code before waiting for the whole page to fully finish loading all its resources (exactly how, in the client, you often want to run on `DOMContentLoaded` instead of on `load`). My use case is basically: â€œI want to click this button and I donâ€™t care whether images have loaded yet.â€

BUT the more I think about it, that makes a lot of things more complicated: have all the pageâ€™s scripts (if some where deferred) loaded yet? What if you just want to load a page and screenshot it? Now you have to load, wait, then screenshot. Etc. A possible alternative might just be to add an option to `goto` asking it to return as soon as the HTML is loaded, but keep the default behavior the same. (e.g. `goto('url', {waitForResources: false})`)
 Generally: have every action return something? In a similar vein, be better about errors. Also: make all errors instances of `Error` (maybe a subtype, like `NightmareError` or something). This covers a lot of things, so probably requires an audit of all existing actions first (if it seems like a good idea).
 Seriously, when this release will be available? Popups / New windows are giving me serious nightmares and struggling a lot ðŸ˜­ I'm still using nightmare-window-manager, but sometimes it does not help (popup logins for example, triggered by javascript with anti csrf token + link of something, etc and all of these are obfuscated or really painful to dig in).  Is there some way to get the pixels of what Nightmare is doing? Would be cool to specify a window size that Nightmare operates in and then get those pixels to pipe them somewhere.
 You could write a plugin that does thisâ€”on the Electron side, just subscribe to `FrameManager`â€™s `data` event and youâ€™ll receive a buffer with full-frame image data each time the browser window renders.

Maybe something like (totally untested):

``` js
Nightmare.action(
  'renderStream',
  function(name, options, parent, win, renderer, done) {
    var manager = FrameManager(win);
    function sendFrame(buffer) {
      parent.emit('renderStreamFrame', buffer);
    }
    parent.on('startRenderStream', function() {
      manager.on('data', sendFrame);
    });
    parent.on('stopRenderStream', function() {
      manager.removeListener('data', sendFrame);
    });
    done();
  },
  function(done) {
    this.child.emit('startRenderStream');
    done();
  });

Nightmare.action('stopRenderStream', function(done) {
  this.child.emit('stopRenderStream');
  done();
});
```

And use it like so to watch yahoo.com load and render, frame by frame:

``` js
Nightmare()
  .on('renderStreamFrame', function(buffer) {
    // do something here with the image data, e.g. save to disk
  })
  .renderStream()
  .goto('http://yahoo.com')
  .stopRenderStream()
  .end()
  .then(function() {
    console.log('done');
  });
```
 @rosshinkley I haven't tried it yet. Seems like it will though. I'll re-open if I get around to it (or if anyone reading tries and it doesn't work, they can re-open too).
  Fixes #590.

We used to support `javascript:` URLs, but lost that feature in #553. TBH, Iâ€™m slightly skeptical on bringing it back, _but_ #553 got released in an extra-minor update, so it seems worth fixing since it actually broke some people.

Bonus: this supports page loading data for URLs like `javascript:window.location='http://google.com'`. It could be ever so slightly faster if we didnâ€™t bother to support that. Seemed nice to have, though. Â¯\_(ãƒ„)_/Â¯

Also worth noting: we donâ€™t handle errors especially well this way. Itâ€™s not any worse than before, but I wonder if calling `goto('javascript:notAnActualFunction()')` should return error instead of success, which I think we could do by passing JS URLs through the evaluate code and then, if the result is not `undefined`, setting the URL. Thatâ€™s complicated, though. (You _can_ currently capture errors with the `page-error` event, but itâ€™s hard to connect that with the URL.)
 > I'd be curious to see a proposed implementation for supporting rejection of bad javascript: links.

The more I think about it, the less I want to do it. Itâ€™s pretty edge-casey.
  Contains upstream fixes for #375, #563, #572. For the dev tools issues, I think we should still take #576, but this does obviate it on a technical level.
 Not sure why that test failed. It seems to run fine locally. Hopefully something didnâ€™t break in this Electron release :\
  ```
process.on('uncaughtException', function(err) {
    console.error(err.stack);
    endInstance(self);
    // This allows any user defined 'uncaughtException' handlers
    // to run before exiting
    process.nextTick(function() {
        process.exit(1);
    });
  });
```

Please give to nightmare consumer decide when to kill process.
Thanks
 > I'm wondering now is if instead of exiting, the Nightmare instance should be put into an error state where any further calls would cause exceptions as the IPC parts are no longer reliable.

I definitely think this would be great. But some thoughts: there are two different kinds of `uncaughtException` handlers and I think the story is a little different for each.
1. Exceptions in the child (electron) process. This is what #558 was about. I think the reality here is that when this happens, we pretty much have to assume everything in the process (and therefore in the Nightmare instance controlling it) is hosed. I think youâ€™re on the right track here, @rosshinkley:
   1. Treat this like an error in any action, stopping all running queues, and calling the callback/rejecting the promise for each of them with information about the exception.
   2. Marking the instance as dead so any later calls to `run/then/end` either throw or reject (Iâ€™d lean towards reject, but throwing might make sense, too). The same goes for when the Electron process crashes, which is currently totally silent. ðŸ˜± Arguably, we should be doing this when the instance is explicitly ended, too (IIRC, you can currently call `run/then` again after the process is ended and have unclear problems).
2. Exceptions in the parent (user) process (the handler @demongloom cited). As Iâ€™m thinking about this one more critically now, **Iâ€™m not sure we should be handling this event at all:**
   - Handling it is not great practice for library code (as opposed to user code) because it changes the behavior of the process. We â€œfixedâ€ this in #554, but this gets in the userâ€™s way if they want to not crash on an exception (rarely ever a good idea, but _sometimes_ there are legitimate reasons). In hindsight, the better fix for #554 might have been to just remove the handler altogether.
   - Handling it in order to clean up the electron process is unnecessary because we already trap all the possible close/exit/signal events and cleanup there. Whether the system exits because of an uncaught exception or the user explicitly does so in their own code, weâ€™re still covered without trapping this event.
   - Presumably the handler was originally added to ease debugging, but what about cases where Electron is a useful additional piece of functionality in a larger app, rather than the central purpose of someoneâ€™s app? Itâ€™s not great to just be spewing stack traces to the console if theyâ€™re trying to redirect errors somewhere else (logs, a remote service, etc). (If we really like this functionality, maybe send it to `debug` and then only exit the process if there are no other uncaught exception handlers?)
   
   To some extent, I simply did wrong by adding the `endInstance` call to the existing uncaught exception handler on the parent in #487. We donâ€™t have to assume, unlike with the child process, that Nightmareâ€™s internals are hosed here. Itâ€™s plenty likely that the exception came from code that didnâ€™t have anything to do with Nightmare.
  > Should Nightmare override the environment variable for ELECTRON_ENABLE_LOGGING

I would say nah. For high-level issues someone is likely to care about (deprecation notices, info about why Electron failed to start, etc.), info gets logged regardless of this env var. It gets pretty verbose if you turn it on. Better to leave that up to a user, I think.

> Should the nightmare: namespace be on the debug calls for Electron?

Iâ€™d say nah to this, too, but I donâ€™t really have any good reasoning or a strong case for it.
  Running across #581 made me think it would be a good idea to get automatic warning of deprecated API usage. This causes the test suite to fail at the end if any deprecated APIs are used.

The implementation basically wraps the Nightmare constructor used in tests and watches Electronâ€™s `stderr` for deprecation warnings, then throws an exception at the end if there were any.
 Note the tests _should_ fail, since we are using some deprecated APIs :P

#581 should be merged first in order to keep these tests happy.
 > something I had been thinking about was wrapping the Electron instance stdout and possibly stderr up with calls to debug (rather than piping them straight through to the parent process stdio). Then I started thinking about possibly having log levels and maybe introducing something slightly more complex than debug like winston.

I generally like that idea, but the place for it is probably #421.

As for _this_ PR, I thought it was valuable to programmatically examine stderr for these warnings so we could explicitly cause tests to fail (and if that doesnâ€™t feel great, cool, we shouldnâ€™t take this). We couldnâ€™t do that with just a logger. It also lets us a) group all the warnings together so they arenâ€™t spread though-out the test output and b) dedupe them, so you only see â€œprintToPDF is deprecated.â€ once, for example:

```
  82 passing (1m)
  1 failing

  1) Nightmare "after all" hook:
     Error: Used 2 deprecated Electron APIs:
        (electron) printToPDF is deprecated. Use webContents.printToPDF instead.
        (electron) use-content-size is deprecated. Use useContentSize instead.
```

Since Electronâ€™s stdio are just streams, thereâ€™s no reason we canâ€™t pipe them to multiple places if we want to. Doing this shouldnâ€™t get in the way of piping to `debug` or some other logging tool.
 Oh, ha, sorry. Violent agreement!
  We were using a few deprecated Electron APIs in various spots. Best to fix that before they disappear entirely and break! Happily, they were all just renamings or moves to other locations, so this was very straightforward.

Noticed while looking at #421.
  Hi all,

I'm attempting to go to a page, grab a URL from an anchor tag, and then use `goto` to change the current browser window to that URL (since otherwise it opens a new window I'm unable to access at all).

I don't see a way to do this in the docs. Is this possible?

I've tried using `evaluate.then` to return the url to `then`, which works, but then I can't change my current nightmare instance from within the `then`. It appears to have no effect.

EDIT: The equivalent of what I'm trying:

```
var nightmare = Nightmare({});
nightmare.goto('http://website.com')
    .evaluate(function () {
        return document.querySelector('#url').href;
    })
    .then(function (url) {
        //Never does anything, never changes the current URL
        nightmare.goto(url);
    })
```
 Works perfectly! Thanks for the help.
  This addresses one aspect of #493. It should make IPC between the userâ€™s process and the Electron process a) â€œsafeâ€ in that simultaneous calls canâ€™t cause incorrect results and b) simpler. Itâ€™s based on discussion with @rosshinkley in issue #493.

The main idea here is that Nightmareâ€™s IPC objects gain two methods, each to be used in opposite processes:
- `ipc.respondTo(name, responder)` Registers a function that can respond to calls from another process. The `name` is a handle by which other processes call it. The responder takes any number of arguments, where the last one is a callback. This callback should be called when the responderâ€™s work is complete. Any arguments will be passed back to the caller in the other process. In addition, the callback has a method named `progress` that can be called to emit `data` events in the other process.
  
  ``` js
  ipc.respondTo('cookies.get', function(query, done) {
    webContents.session.cookies.get(query, function(error, cookies) {
      if (error) { return done(error); }
      done(null, query.name ? cookies[0] : cookies);
    });
  });
  ```
- `ipc.call(name, [arg, [arg, [...]]], [callback])` Calls a responder with the given `name` in another process. Any arguments between the `name` and `callback` are passed as arguments to the responder. The callback will be called when the responderâ€™s work is finished. In addition, this returns an event emitter than can be used to handle `data` events indicating progress from the responder or a single `end` event, which will be called with the same arguments as and immediately prior to `callback`.
  
  ``` js
  ipc.call('cookies.get', {name: 'my-cookie'}, function(error, cookie) {
    if (error) { return console.error('UHOH!', error); }
    console.log('OM NOM NOM I GOT ME A COOKIE!', cookie);
  });
  ```

Under the hood this is accomplished by having three special IPC messages:
- `CALL` indicates that a responder should be called. Sent from the parent, to the child. It has at least 2 arguments:
  1. A unique ID identifying the call. This is used to ensure responses donâ€™t get tied up with other calls to the same responder.
  2. The name of the responder to call
  3. Arguments to pass to the responder.
- `CALL_DATA_{ID}` indicates progress data related to a call is being sent. Sent from the child to the parent. The ID in the name is the unique ID that was sent with the initial call above.
- `CALL_RESULT_{ID}` indicates that this is the final result of the call. Sent from the child to the parent. The ID in the name is the unique ID that was sent with the initial call above.

The above set of messages can be used in either direction, but they are probably only relevant now in terms of calls from the parent to the child. Maybe worth noting: a very similar (but more heavily built out and robust) mechanism is used internally in Electronâ€™s `remote` module. This one is more minimal and light-weight, but sacrifices a lot of nice features that one has (support for circular references, complex types like dates, functions, promises, errors, and placeholder objects instead of string names).
## Notes and open questions
1. This doesnâ€™t convert all calls yet. It just does `evaluate_now` and `useragent` as demo cases. A later commit will have to do the rest.
2. In implementing this, I noticed that we can wind up with multiple IPC objects for a single process. It doesnâ€™t actively cause problems, but depending on the order things are registered in, it could, so I made sure there could only be one IPC instance per process.
3. This implementation differs slightly from the initial proposal in #493â€”it is intended to be backwards-compatible (so it doesnâ€™t break plugins). Iâ€™m not sure if that a virtue or unnecessary, since plugins that can run in the Electron process are pretty new. The method names are also slightly different; I thought these were clearer.
4. The progress capability is neat, but it incurs a lot of additional complexity and Iâ€™m not sure how much real value it adds. No existing actions use anything like it. The situations where it would be useful might be just as well handled with more judicious debug messages, error throwing, or simple events. We could easily remove the progress support and add it again later.
   - If we keep it, should be a stream instead of a simple emitter? Like the progress capability itself, its benefits are primarily theoretical and it probably comes with a more complex implementation.
5. This implementation sits atop the existing `ipc.emit()` and `ipc.on()` methods. That means the special `CALL*` messages can be pretty easily observed. Iâ€™m not sure thatâ€™s a big deal, but we could call the appropriate methods on the `process` instead to make intercepting things harder.
6. My initial implementation relied heavily on the spread operator, which made things much simpler. However, spread isnâ€™t available in Node v4.x without the `--harmony` flag (itâ€™s ðŸ‘ in v5.x), so I removed it in favor of lots of `apply()` calls.
   - `--harmony` is still mentioned in the README (only down at the bottom), but not actually required in practice on Node 4+. I think itâ€™s good that itâ€™s not required.
   - In hindsight, a lot of the `apply()` noise (not all) could be avoided by just sending arguments as an array through IPC instead of spreading them into the message arguments.
7. Some action implementations in the Electron process will get more complex (only slightly) because of this. Several actions are fire-and-forget, but in this implementation, they _have_ to call a callback. Because arguments are so dynamic in Nightmare, I canâ€™t think of a good way to detect whether an action (on the Electron side) actually uses the callback. Probably not a big deal, but I just wanted to call it out.
8. You only get to have one responder for a given name. I think thatâ€™s reasonable (what would you do with more??), but not sure if itâ€™s worth adding some logging or throw errors if `respondTo` is called with the same `name` more than once.
9. Thereâ€™s no way to unregister a responder. Iâ€™m not sure we need it, but maybe?

Iâ€™d love feedback from anybody on this. Ideally this is a safe, backwards-compatible change (see (3) above), but itâ€™s still a major (and deep) API change. We should be more ðŸ‘ than Â¯\_(ãƒ„)_/Â¯ in order to accept it.
 > a similar concept is used in the download manager to look at download state out-of-band.

Oh, neat. I donâ€™t think the progress mechanism here would simplify that use case, but it does make me wonder if thereâ€™s room for some sort of more abstract create-a-ipc-sub-channel mechanism. That would probably have some utility in the single-electron-process model described in #561. Probably out-of-scope here, though?

> My first off-the-cuff idea would be to wrap .on() and/or .emit() to warn of safety concerns when it is used in plugins (although I can think of situations where one might want to manage events themselves).

I feel like `on/emit` still have a lot of value for sending events or event-like messages. As far as built-in stuff, I think thatâ€™s just event forwarding from the browser window and logging from the Electron process.

> What change were you planning to propose that would break plugins?

I think I mistyped it on the issue thread, but I was originally thinking of _replacing_ `emit/on` with `call/respondTo` instead of having differently-named methods.

> I would think responding to a given event twice would constitute a runtime error.

So do you think it should throw an exception? Or maybe just log a warning?
 > it's probably out of scope, but it does feel like process management/window management is going to depend on this change. (Or at least borrow from it heavily.)

Definitely out of scope, but if `call` returned a scoped IPC instance instead of the emitter it doesâ€¦

``` js
function Nightmare(options) {
  ...
  this.window = electronProcess.call('createWindow', function onEnded(reason) {
    // mark instance as cleaned up and done
  });
}

// in actions.js
exports.useragent = function(useragent, done) {
  this.window.call('useragent', useragent, done);
};
```

> it does seem like a raw .on()/.emit() pair is dangerous enough to warrant... something.

At the very least, I should update the plugin example in the README. Totally forgot about that.

Maybe (this is a bit hare-brained), rename `emit` to `send` and make `emit` log a warning, then forward to `send`? That way, we are forcing people to opt-in to the fact that they donâ€™t want the call-response structure. Itâ€™s kind of ridiculous to rename a method to make people consider whether they _really_ want to use it, though.

Really I think it should be clear that this `call` is the better, future API and you can opt-in to improved behavior. `emit/on` isnâ€™t getting any _worse._

> I don't think you can cause execution problems as the results are executed with .once()

True, but that kind of problem is actually prevented even earlier by the fact that the responder registry can only hold one responder per name. So registering a second one with the same name bumps out the old one, and there is only ever one function that even has the opportunity to call back. I think we established that thatâ€™s fine.

The â€œshould we throw?â€ question is more about whether itâ€™s ok to bump out a previously registered responder.
- Logging a warning would notify you that a responder was overridden, but would still allow your program to continue.
- Throwing would basically mean you canâ€™t override a previous responder; doing so would just stop everything and Nightmare couldnâ€™t run until you fixed the issue.
- Staying silent as the implementation currently does is probably not a great idea the more I think about it. Youâ€™d probably at least want some diagnostic logging informing you that the original responder has been replaced.
 I went ahead and added logging of duplicate calls to `respondTo` with the same name. Can easily change to throwing if we decide thatâ€™s preferable, though.
 > Would you be willing to complete this PR and put it against that branch?

Sure? Whatâ€™s â€œcompletingâ€ meanâ€”just wrapping up the rest of the built-in actions?

> Thoughts on doing such a thing?

Generally Iâ€™d flip it around and have `master` be current development (e.g. v3) and have a `v2` branch for any additional 2.x releases. But Â¯\_(ãƒ„)_/Â¯ all good either way.
 @rosshinkley do you want a new PR pointing to another branch, or should this still be going to master? (per discussion the other day about whether this is v2.4 or v3 feature)
 Cool, I think this is done if nothing looks out of place to you, then.
  I start nightmare with the following snippet.

```
 Nightmare({
    switches: {
      'proxy-server': 'socks5://0.0.0.0:9150',
      'ignore-certificate-errors': true
    },
    paths: {
      userData: './cookies/' + port
    },
    openDevTools: true,
    show: true
  });
```

But unfortunately it crashes when calling `nightmare.goto('http://google.com')` because of      `openDevTools: true`. When I comment this line everything's working perfect. 
 confirming it crashes on `openDevTools` (running no proxy server), v `2.3.2`.
  Electron has a potential crasher (on OS X, at least) when the devtools are open: https://github.com/electron/electron/issues/5180

This is an extremely simple workaround. Nightmareâ€™s event forwarding code sends the `event.sender` argument, which may contain properties that crash Electron when accessed. Nightmare triggers the crash by stringifying everything when forwarding the event across IPC. This simply avoid including the `sender`.

I _think_ it would be nicer not to send the `event` object at all (since this patch leaves it as an empty object in most cases and I donâ€™t think it provided any users with useful data), but I am ever so slightly worried that changing which arguments are where in the events could bite somebody. This seemed safer.
 Fixes #572, #563.
 Well, I guess the sped up tests go so fast they complete before Electron has a chance to crash! Theyâ€™re still valid, but no longer a good canary for the crash this PR is mainly about preventing. Should I roll them back?
 > Is there a reason to keep the changes?

Well, they allow the test to complete in a fraction of a second rather than several seconds (and still have accurate results). Nightmareâ€™s test suite isnâ€™t so big that itâ€™s a problem now, but Iâ€™ve seen plenty of projects where that is a problem, so it seemed like a reasonable change while I was poking at the dev tools stuff.

The question, I guess, is whether itâ€™s useful to have a much slower test that _might_ also tell us we avoided the crasher (since the crash is intermittent).
 > This problem seems important enough to merit reasonably quick attention from the folks at Electron, so I imagine it will be addressed fairly quickly.

Yeah, Iâ€™d imagine so. I would tend towards not worrying about it under that expectation, but we could leave the tests as-is (that is roll back the changes here) until the bug is addressed, and then add the improvements here.

If we really want to test for the crash, we should have an explicit test for it and, since itâ€™s intermittent, probably write it like [the screenshot reliability tests](https://github.com/segmentio/nightmare/blob/master/test/index.js#L717), where it gets repeated a few times to get a better guarantee that everything is working.
 The crash is fixed upstream in Electron: https://github.com/electron/electron/pull/5191. Weâ€™ll have to watch for the next release and update.

Based on that, I think we should just go with the faster test. I also still think cutting the `sender` out of forwarded events would be good since it reduces a lot of noise in the debug logsâ€”once you get to the parent process, itâ€™s no longer a meaningful reference and thereâ€™s not much useful data that gets serialized there, either.
  This is spawned from discussion on #501. @rosshinkley notes:

> `.run()` is really intended for internal use and usage isn't directly supported. Should it be?
1. `run` is not documented, itâ€™s not the â€œofficialâ€ API, and nothing internal ever calls it except `end`, which could just as easily call `then` instead. If `run` isnâ€™t intended for external usage, it should be removed (or at least deprecated by logging warnings to the console when called until v3 is released).
2. On the other hand, even though itâ€™s not documented, â€œofficial,â€ or public, I get the impression that it _is_ widely used. It comes up in issues a lot. Does that mean it should _become_ documented and official?

I can see a lot of value in simply canonizing a thing lots of people seem to be using. That said I personally like a smaller API surface, so I think I lean towards deprecating `run`. In the end, though, Iâ€™m not sure I have a real horse in the race here. Iâ€™d love to hear othersâ€™ thoughts.
 > At the possible expense of being "that guy," .then() uses .run() internally too.

Oh, fine! ;)

> I believe the PhantomJS implementation used .run() to execute the Nightmare chain.

Ah! Well that explains a lot. That actually makes me feel not-so-hot about deprecating it, too :\
 @rosshinkley writes in #979 

> TL;DR: don't use .run(). It's a holdover from Nightmare 1.x. Use .then() instead.

If that's indeed the case, let's decide this & close this issue.

My 2 cents, without getting into the whole history here, is the syntax of `run()` is nice, and I don't really understand why it can't/shouldn't be a wrapper. But whether it is supported or isn't supported, a decision one way or another would be nice :)  Hi, we're trying to do something crazy here at https://github.com/resin-io/etcher. We're trying to automate the process of taking screenshots to our application (for the website, etc) by controlling the real Electron app with Nightmare.

The plan is to run the Etcher app with Nightmare utilities to drive the application into certain states, and take screenshots of it.

So far I tried the following:
- Pointing Nightmare's `electronPath` to the Electron Etcher binary generated when packaging the application. The app seems to run fine, but `.evaluate()` blocks or any other Nightmare function don't seem to run at all.
- Using Nightmare's Electron, and opening the `index.html` file of Etcher. This seems to work, and every NightmareJS function, including `.evaluate()` works fine, however I get: `require is not defined`. Any ideas? Is NightmareJS blocking `require` calls from the site it opens? 
 Actually, not even `process` is defined. Looks like the app is running in a more restricted environment, and not in a normal Electron environment?
 <img width="997" alt="screenshot 2016-04-15 11 16 57" src="https://cloud.githubusercontent.com/assets/2192773/14565985/990d2eb8-02fb-11e6-9330-36eb97a36168.png">
 In [this comment](https://github.com/segmentio/nightmare/issues/242#issuecomment-142985863), the user seems to be running scripts using `require()` with NightmareJS. I'll try various NightmareJS versions to see if it makes any difference.
 Okay, I found the reason. `nodeIntegration` is set to `false` on `runner.js`: https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L71. Setting it to `true` works like a charm. Any reason why this is disables? I'm happy to provide a PR to implement an option to control this value.
 > Any reason why this is disables?

Well, Nightmare is primarily meant to be a scripted _web browser,_ and loading any content from the web into an environment where `nodeIntegration = true` makes your whole machine extremely vulnerable to all manner of crazy attacks.

Iâ€™m not a committer or anything here, so I canâ€™t say anything about whether other people might be interested in making this happen. Personally, though, Iâ€™m sure making that property changeable is really the best way to go about this. Using Nightmare (or something like it or its API) to control an Electron app is a _really cool idea,_ but I think doing it right would require a much more thoughtful approach. Maybe better to fork it, make all the adjustments you wind up needing to make it work well for you, and come back with ideas about what actually worked out well (or not) in practice?
 Github also released [Spectron](http://electron.atom.io/spectron/) sometime after this issue was originally posted. Itâ€™s probably a much better way to accomplish this stuff.  If a function passed to `.evaluate` return a promise then nightmare will wait for it to be resolved before sending the value (or reject before sending an error). This allows to execute async tasks in `.evaluate` and closes #552.

Also template strings are used for javascript templates (both `execute` and `inject`) - closes #447.
 Hmm... Failing tests in CI doesn't seem to be related to the change, esp. since I have only added two test cases and before that CI was passing. I had some troubles with screenshots related tests before. Is it possible they are not deterministic?
 Thanks for your feedback. I'll be happy to do it.

What do you think should be expected behaviour of wait when promise is returned? I guess Nightmare should wait for it to be settled.

What if it's rejected?

Also, if it's fulfilled, should we care about value?
 I looked at existing test cases for `wait` and I think we have a problem here. They are not really testing anything. There are no assertions there. As long as the code doesn't throw the tests are passing even if behaviour is wrong.

Further more following test case executed in current `master`\* passes immediately instead of timing out:

``` javascript
it.only('should wait until the evaluate fn returns true', function*() {
  yield nightmare
    .goto(fixture('navigation'))
    .wait(function () {
      return false;
    });
});
```

Am I right this proves a bug in `wait`? If you agree I will file an issue.

\* i.e. before modifications introduced in this PR, but with them it's the same.
 You are right about `.only` being a problem. I got expected results (timeout) without it as well. I discovered that you can set `.only` on describe to get reasonably fast test cycle without having this side effect. It is certainly a bug in mocha / mocha-generators though.

What could be asserted is the passing of time. Currently this case looks more like it is testing if element `a` will eventually get text content of `'A'`. The correctness of `.wait` is kind of assumed. If at some point a bug is introduced and `.wait` returns immediately no matter what the return value of callback is, the tests would not discover it.

How about something like this:

``` javascript
it('should wait until the evaluate fn returns true', function*() {
  const beggening = Date.now();

  yield nightmare
    .goto(fixture('navigation'))
    .evaluate(function() {
      window.now_is_the_time = false;
      setTimeout(function() {
        window.now_is_the_time = true;
      }, 1000);
    })
    .wait(function () {
      return window.now_is_the_time;
    });

  beggening.should.be.below(Date.now() - 1000);
});
```
 Oh, it's a good idea to test for falsy resolution of a promise! Let me push again :)
 Yes, when you run test like that:

``` javascript
it('should wait for returned promise to be resolved to truthy value', function() {
  var nightmare = Nightmare({waitTimeout:1000});

  return nightmare
    .goto(fixture('navigation'))
    .wait(function() {
      return new Promise(function(resolve) {
        setTimeout(resolve, 2000, false);
      })
    })
    .then(function () {
      throw Error("Promise should have been rejected.");
    })
    .catch(function(error) {
      error.message.should.be.equal(".wait() timed out after 1000msec");
    });
})
```

then Nightmare's timeout is never enforced. It's Mocha that times out after 10s. I think it's a legitimate issue and we should deal with it.

Splitting the templates doesn't seem compelling. Shouldn't we have a timeout for `.evaluate` just as well as for `.wait`? It would probably prevent some hard to debug errors in applications using Nightmare. So I would go with your first idea. Just not sure where this logic would fit.
 It seems the timeout logic is in `waitFn` function in `actions.js`. It seems quite complex. Couldn't simple `setTimeout` be used?
 Anything I can do to help this along? 
 Hey, sorry for abandoning this conversation. It's because my first child was recently born and I was quite occupied with this wonderful if somewhat difficult change in my life :)

@carebdayrvis thanks for asking. Any help is appreciated.

Back to the topic. It seams that `waitFn()` calculates the time elapsed by just adding 250ms after every tick. This way it ignores the time that the evaluation on page took. With async evaluation this can be significant. Am I understanding correctly?

This could be improved by storing the start timestamp and comparing it with current time on every tick, like that:

``` diff
 var _timeoutMs = 250;
 function waitfn() {
-  var waitMsPassed = 0;
+  var startTime = Date.now();
   return tick.apply(this, arguments)

   function tick (self, fn/**, arg1, arg2..., done**/) {
     var args = sliced(arguments);
     var done = args[args.length-1];
+    var timeElapsed = Date.now() - startTime;
     var waitDone = function (err, result) {
       if (result) {
         return done();
       }
-      else if (self.optionWaitTimeout && waitMsPassed > self.optionWaitTimeout) {
+      else if (self.optionWaitTimeout && timeElapsed > self.optionWaitTimeout) {
         return done(new Error('.wait() timed out after '+self.optionWaitTimeout+'msec'));
       }
       else {
-        waitMsPassed += _timeoutMs;
         setTimeout(function () {
           tick.apply(self, args);
         }, _timeoutMs);
```

but still wouldn't work for very long running evaluations - it will only timeout after the job is done, and only if the result if negative (`false` is returned). The commit that I've just pushed demonstrates this by introducing a (failing) test case.
 Whoa! Everything is timing out in the CI.

ðŸ¤”
 Ok, merged master into this PR's branch and it **fails as expected** now. Guess the configuration of the CI environment changed and some adjustments were needed in the code base as well.

What's the status of #609? It looks like our efforts may collide.
  Hello, I'm playing with Nightmare and mostly love the experience. Thanks for this tool.

It seems like electron instance is sometimes (but not always) crushing when openDevTools option is set to `true`. I was not able to find a pattern. Here is a debug log for failing case:

```
 $ DEBUG=nightmare* npm test

> nightmare@2.3.2 test /Users/tadeuszlazurski/Projects/nightmare
> make test



  Nightmare
    devtools
  nightmare queueing child action addition for "checkDevTools" +0ms
  nightmare queueing action "goto" for http://localhost:7500/simple +5ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "checkDevTools" +0ms
  nightmare running +0ms
  nightmare:log adding action for checkDevTools +289ms
  nightmare:log did-start-loading +57ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-get-redirect-request +38ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}},"http://localhost:7500/simple","http://localhost:7500/simple/",true,303,"GET","",{"connection":["keep-alive"],"content-length":["47"],"content-type":["text/html; charset=UTF-8"],"date":["Fri, 15 Apr 2016 08:34:10 GMT"],"location":["/simple/"],"x-content-type-options":["nosniff"],"x-powered-by":["Express"]}]
  nightmare:log did-get-response-details +13ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://localhost:7500/simple/","http://localhost:7500/simple",200,"GET","",{"accept-ranges":["bytes"],"cache-control":["public, max-age=0"],"connection":["keep-alive"],"content-length":["121"],"content-type":["text/html; charset=UTF-8"],"date":["Fri, 15 Apr 2016 08:34:10 GMT"],"etag":["W/\"79-15415804728\""],"last-modified":["Thu, 14 Apr 2016 16:00:09 GMT"],"x-powered-by":["Express"]}]
  nightmare:log dom-ready +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-frame-finish-load +15ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}},true]
  nightmare:log did-finish-load +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log page-favicon-updated +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}},["http://localhost:7500/favicon.ico"]]
  nightmare:log did-stop-loading +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":27,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/tadeuszlazurski/Projects/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:actions .wait() for 2000ms +1ms
  nightmare electron child process exited with code null: undefined +396ms
      1) should open devtools
  nightmare running +9s
      2) "after each" hook for "should open devtools"


  0 passing (20s)
  2 failing

  1) Nightmare devtools should open devtools:
     Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.


  2) Nightmare devtools "after each" hook for "should open devtools":
     Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.




make: *** [test] Error 2
npm ERR! Test failed.  See above for more details.
```

I've been also seeing this behaviour with real use (i.e. outside the tests). Might be related to #563.
 Ha! I spent all day isolating this in Election (https://github.com/electron/electron/issues/5180) and never even saw this issue :P

Thereâ€™s a patch for Nightmare: #576. It just needs review.
  I have been battling this issue for some time now and can not seem to find a solution. When running tests with NightmareJS on mocha on the server they fail.

I have a stackoverflow question: http://stackoverflow.com/questions/36641279/running-nightmarejs-with-mocha-on-server-bamboo-agent

I though that maybe people here would know better.
 Do you get any output with the test failures at all? Any error messages Bamboo is able to report for you?

Do you have XVFB installed and running on your Bamboo server? Itâ€™s been a long time since Iâ€™ve touched anything with Bamboo and am not sure if itâ€™s built-in. You need it to run Nightmare (well, Chromium, really) without a screen.

You might want to look into some of the stuff on issue #224. Thereâ€™s a lot of back-and-forth there, but maybe some of it will be helpful to you.
 Yes, I get only that Error: timeout of 30000ms exceeded. Ensure the done() callback is being called in this test.

Thanks Mr0grog, I will check it out...
 Also, if you have XVFB installed but not running, this change in v2.3.2 _may_ make it just work for you: #565
 Yes, but now I found out more, it seems the electron is not installed correctly? I get the following error when running:

`nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly`
 Hey Ross, I didnt get that resolved at the time and now do not work on the
project anymore. But if no-one else is having it maybe it can be closed for
now

On Monday, 8 August 2016, Ross Hinkley notifications@github.com wrote:

> @mxmz- https://github.com/mxmz- Did you get this resolved?
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> https://github.com/segmentio/nightmare/issues/571#issuecomment-238298838,
> or mute the thread
> https://github.com/notifications/unsubscribe-auth/AHXcH4ynizSaTOnj_XSSgJHQ8AhHUZRtks5qd18IgaJpZM4IIE-W
> .

## 

Maksim Luzik
+358 50 574 8025
maksim.luzik@gmail.com
  What is internal/external concerns? :confused: 
 @rosshinkley sounds great! Awesome! :+1:
  I love using Nightmare so far, thanks for creating it :tada: 

Here's a short script that illustrates my questions:

``` javascript
var Nightmare = require('nightmare');
var n = Nightmare();
var logo, height;

Promise.resolve()
.then(function () { 
  return n.goto('http://google.com')
    .wait('#hplogo')
    .evaluate(function () {
      return document.getElementById('hplogo');
    });
})
.then(function (_logo) {
  logo = _logo;

  return n.evaluate(function () {
    return document.getElementById('hplogo').height;
  });
})  
.then(function (_height) {
  height = _height

  n.end();
})
.then(function () {
  console.log(logo);    // <-- prints out "undefined" (expected to see a DOM element)
  console.log(height);  // <-- prints out "92" (as expected)

  console.log(logo);    // <-- prints out "{ __jsaction: {} }" (???)

  process.exit();
});
```
1. From this it looks like I can't just return a DOM element from the page context? If that's the case, can you explain to my why? Does it have to do with the magic of distinguishing the script's runtime from that of the page?
2. What is that weird object with the `__jsaction` property?
3. (Somewhat unrelated question; if I don't call `process.exit()` in the final callback, the script just hangs. Can you explain why?)

Thanks!
 Thank you for getting back to me so quickly!

On Wed, Apr 13, 2016 at 12:33 PM Ross Hinkley notifications@github.com
wrote:

> From this it looks like I can't just return a DOM element from the page
> context? If that's the case, can you explain to my why? Does it have to do
> with the magic of distinguishing the script's runtime from that of the page?
> 
> .evaluate() executes in the page context, and I believe the return value
> is stripped down to primitives for transport over an inter-process channel.
> If you need properties from the element, you'd be better off returning the
> property or returning a projection. For example (snipped for brevity):
> 
> ```
> .evaluate(function () {
>   var element =  document.getElementById('hplogo');
>   return {
>     src: element.src,
>     height: element.height
>   }
> });
> ```
> 
> This makes sense, and confirms my vague intuition of what was happening,
> thanks.
> 
> It really depends on what you're trying to accomplish, though. Why do you
> need the DOM element in the calling process?
> 
> I don't really, I was just poking around to see what is possible. I just
> expected the DOM element to come back out with no problem, and wondered why
> it wouldn't (or whether it was supposed to, and I had done something wrong,
> etc.).

Computing a projection stored and returned in a plain JavaScript object
will be my new SOP.

> What is that weird object with the __jsaction property?
> 
> That's a good question. Judging from the minified JS on google, it looks
> like it might be a container for attaching custom actions to the image
> (like a Doodle, for example) directly added to the DOM element. That's a
> wild guess, though.
> 
> I think you're right. Googling for __jsaction links to some sort of event
> handling magic library and I assume that's what this is. I had really just
> been curious if it was coming from Nightmare somehow (good to know it's
> not).
> 
> Somewhat unrelated question; if I don't call process.exit() in the final
> callback, the script just hangs. Can you explain why?
> 
> The .end() call is queued but not run. Try changing:
> 
> .then(function (_height) {
>   height = _height
> 
>   n.end();
> })
> 
> to:
> 
> .then(function (_height) {
>   height = _height
> 
>   return n.end();
> })
> 
> ... and I think you'll have better luck. Returning the Nightmare thenable
> ensures the chain is executed.
> 
> I had to change them to `return n.end().then()` but that did the trick.
> It feels weird to call `then()` without a callback argument but... seems
> to work.

Any reason I should avoid doing it that way?

> It also might interest you to go read #546
> https://github.com/segmentio/nightmare/issues/546's thread on .end().
> 
> Ah, thanks.
  Extra minor note here (sorry I completely missed you posting this PR, @rosshinkley): it might be nice if the two new scripts got sequestered into their own directory since they arenâ€™t really part of the tests per se. Maybe `/scripts` or `/test/scripts`?
 > Irritation-driven acceptance is a thing, right?

Not until you write a post about it on Medium! ;)
  The output is

```
screenshot DEBUG=* ./screen.js 2ality.com test
/Users/AJ/dev/personal/screenshot/test/screenshot-04122016-105911626.png
  nightmare queueing action "goto" for http://2ality.com +0ms
  nightmare queueing action "wait" +2ms
  nightmare queueing action "evaluate" +1ms
  nightmare running +1ms
  nightmare:log did-start-loading +278ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-get-redirect-request +212ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},"http://2ality.com/","http://www.2ality.com/",true,301,"GET","",{"content-length":["219"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:59:10 GMT"],"location":["http://www.2ality.com/"],"server":["ghs"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +168ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":27,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.2ality.com/","http://2ality.com/",200,"GET","",{"cache-control":["private, max-age=0"],"content-encoding":["gzip"],"content-length":["20061"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:59:10 GMT"],"etag":["\"a3abd8eb-e0ca-4c02-ab4a-14eb07059773\""],"expires":["Tue, 12 Apr 2016 15:59:10 GMT"],"last-modified":["Tue, 12 Apr 2016 11:56:05 GMT"],"server":["GSE"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +98ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://www.blogger.com/static/v1/widgets/3375562265-css_bundle_v2.css","https://www.blogger.com/static/v1/widgets/3375562265-css_bundle_v2.css",200,"GET","http://www.2ality.com/",{"age":["681991"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["8030"],"content-type":["text/css"],"date":["Mon, 04 Apr 2016 18:15:00 GMT"],"expires":["Tue, 04 Apr 2017 18:15:00 GMT"],"last-modified":["Mon, 04 Apr 2016 09:08:13 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://img1.blogblog.com/img/icon18_wrench_allbkg.png","http://img1.blogblog.com/img/icon18_wrench_allbkg.png",200,"GET","http://www.2ality.com/",{"age":["593629"],"cache-control":["public, max-age=604800"],"content-length":["475"],"content-type":["image/png"],"date":["Tue, 05 Apr 2016 18:47:42 GMT"],"expires":["Tue, 12 Apr 2016 18:47:42 GMT"],"last-modified":["Tue, 05 Apr 2016 09:04:22 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://yandex.st/highlightjs/8.0/styles/github.min.css","http://yandex.st/highlightjs/8.0/styles/github.min.css",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=315360000","public"],"content-encoding":["gzip"],"content-type":["text/css"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["W/\"34293900-575\""],"expires":["Thu, 31 Dec 2037 23:55:55 GMT"],"last-modified":["Wed, 24 Sep 1997 16:00:00 GMT"],"server":["nginx/1.9.4"],"timing-allow-origin":["*"]}]
  nightmare:log did-get-response-details +14ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://yandex.st/highlightjs/8.0/highlight.min.js","http://yandex.st/highlightjs/8.0/highlight.min.js",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"cache-control":["max-age=315360000","public"],"content-encoding":["gzip"],"content-type":["application/x-javascript"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["W/\"34293900-75de\""],"expires":["Thu, 31 Dec 2037 23:55:55 GMT"],"last-modified":["Wed, 24 Sep 1997 16:00:00 GMT"],"server":["nginx/1.9.4"],"timing-allow-origin":["*"]}]
  nightmare:log did-get-response-details +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://www.blogger.com/static/v1/widgets/1976504288-widgets.js","https://www.blogger.com/static/v1/widgets/1976504288-widgets.js",200,"GET","http://www.2ality.com/",{"age":["595473"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["37758"],"content-type":["text/javascript"],"date":["Tue, 05 Apr 2016 18:16:58 GMT"],"expires":["Wed, 05 Apr 2017 18:16:58 GMT"],"last-modified":["Tue, 05 Apr 2016 00:18:08 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://apis.google.com/js/plusone.js","https://apis.google.com/js/plusone.js",200,"GET","http://www.2ality.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=1800, stale-while-revalidate=1800"],"content-encoding":["gzip"],"content-security-policy":["script-src 'unsafe-inline' 'unsafe-eval' 'self' https://*.gstatic.com https://www.google-analytics.com https://pagead2.googleadservices.com https://pagead2.googlesyndication.com https://tpc.googlesyndication.com https://s.ytimg.com https://www.youtube.com;report-uri /_/cspreport/es_oz_20160410.00_p1"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["\"2dc6e4a22979267096c35d6c4d646339\""],"expires":["Tue, 12 Apr 2016 15:41:31 GMT"],"server":["ESF"],"status":["200"],"timing-allow-origin":["*"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-ua-compatible":["IE=edge, chrome=1"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=2alitycom","http://cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=2alitycom",200,"GET","http://www.2ality.com/",{"cache-control":["max-age=3600"],"content-encoding":["gzip"],"content-type":["application/javascript"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["W/\"2314-5304ae55a9e4f\""],"expires":["Tue, 12 Apr 2016 16:06:42 GMT"],"last-modified":["Tue, 12 Apr 2016 14:58:37 GMT"],"server":["NetDNA-cache/2.2"],"vary":["Accept-Encoding"],"x-cache":["HIT"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://img2.blogblog.com/img/icon18_edit_allbkg.gif","http://img2.blogblog.com/img/icon18_edit_allbkg.gif",200,"GET","http://www.2ality.com/",{"age":["77180"],"cache-control":["public, max-age=604800"],"content-length":["162"],"content-type":["image/gif"],"date":["Mon, 11 Apr 2016 18:15:11 GMT"],"expires":["Mon, 18 Apr 2016 18:15:11 GMT"],"last-modified":["Mon, 11 Apr 2016 01:08:12 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://1.bp.blogspot.com/-3Lwt1Zl1Fck/VB1JFw4C9PI/AAAAAAAAA3Q/RGeIGo3UQRk/s170/axel_twitter_toulouse.jpg","http://1.bp.blogspot.com/-3Lwt1Zl1Fck/VB1JFw4C9PI/AAAAAAAAA3Q/RGeIGo3UQRk/s170/axel_twitter_toulouse.jpg",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"age":["2163"],"cache-control":["public, max-age=86400, no-transform"],"content-disposition":["inline;filename=\"axel_twitter_toulouse.jpg\""],"content-length":["6082"],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:05:28 GMT"],"etag":["\"v375\""],"expires":["Tue, 12 Apr 2016 17:53:38 GMT"],"server":["fife"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +774ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://www.blogger.com/dyn-css/authorization.css?targetBlogID=8100407163665430627&zx=a3abd8eb-e0ca-4c02-ab4a-14eb07059773","https://www.blogger.com/dyn-css/authorization.css?targetBlogID=8100407163665430627&zx=a3abd8eb-e0ca-4c02-ab4a-14eb07059773",200,"GET","http://www.2ality.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["private, max-age=1800"],"content-encoding":["gzip"],"content-length":["21"],"content-security-policy":["script-src   'self' *.google.com *.google-analytics.com 'unsafe-inline'   'unsafe-eval' *.gstatic.com *.googlesyndication.com *.blogger.com   *.googleapis.com uds.googleusercontent.com https://s.ytimg.com   www-onepick-opensocial.googleusercontent.com   www-bloggervideo-opensocial.googleusercontent.com   www-blogger-opensocial.googleusercontent.com https://www.blogblog.com; report-uri /cspreport"],"content-type":["text/css; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:59:11 GMT"],"expires":["Tue, 12 Apr 2016 15:59:11 GMT"],"last-modified":["Tue, 12 Apr 2016 15:59:11 GMT"],"p3p":["CP=\"This is not a P3P policy! See https://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info.\""],"pragma":["no-cache"],"server":["GSE"],"status":["200"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +3ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.blogblog.com/1kt/watermark/body_background_birds.png","http://www.blogblog.com/1kt/watermark/body_background_birds.png",200,"GET","http://www.2ality.com/",{"age":["75357"],"cache-control":["public, max-age=604800"],"content-length":["22568"],"content-type":["image/png"],"date":["Mon, 11 Apr 2016 18:45:34 GMT"],"expires":["Mon, 18 Apr 2016 18:45:34 GMT"],"last-modified":["Mon, 11 Apr 2016 13:12:54 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.blogblog.com/1kt/watermark/body_overlay_birds.png","http://www.blogblog.com/1kt/watermark/body_overlay_birds.png",200,"GET","http://www.2ality.com/",{"age":["309756"],"cache-control":["public, max-age=604800"],"content-length":["3523"],"content-type":["image/png"],"date":["Sat, 09 Apr 2016 01:38:55 GMT"],"expires":["Sat, 16 Apr 2016 01:38:55 GMT"],"last-modified":["Fri, 08 Apr 2016 03:06:03 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +49ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.blogblog.com/1kt/watermark/post_background_birds.png","http://www.blogblog.com/1kt/watermark/post_background_birds.png",200,"GET","http://www.2ality.com/",{"age":["22124"],"cache-control":["public, max-age=604800"],"content-length":["103"],"content-type":["image/png"],"date":["Tue, 12 Apr 2016 09:32:47 GMT"],"expires":["Tue, 19 Apr 2016 09:32:47 GMT"],"last-modified":["Tue, 12 Apr 2016 04:38:38 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-redirect-request +17ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},"http://2ality.disqus.com/blogger_index.js","http://a.disquscdn.com/blogger_index.js",false,302,"GET","http://www.2ality.com/",{"cache-control":["public, max-age=3600"],"content-length":["0"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"location":["http://a.disquscdn.com/blogger_index.js"],"server":["Varnish"]}]
  nightmare:log did-get-response-details +26ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://a.disquscdn.com/blogger_index.js","http://2ality.disqus.com/blogger_index.js",200,"GET","http://www.2ality.com/",{"accept-ranges":["bytes"],"cache-control":["public, max-age=86400"],"content-encoding":["gzip"],"content-length":["1409"],"content-type":["application/javascript"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["\"56e341d4-581\""],"last-modified":["Fri, 11 Mar 2016 22:08:20 GMT"],"p3p":["CP=\"DSP IDC CUR ADM DELi STP NAV COM UNI INT PHY DEM\""],"server":["nginx"],"vary":["Accept-Encoding"]}]
  nightmare:log did-get-response-details +3ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://platform.twitter.com/widgets.js","http://platform.twitter.com/widgets.js",200,"GET","http://www.2ality.com/",{"accept-ranges":["bytes"],"age":["298"],"cache-control":["public, max-age=1800"],"content-encoding":["gzip"],"content-length":["28448"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 12 Apr 2016 15:47:02 GMT"],"etag":["\"72672bb557775c8731139dbcb75e47d8+gzip\""],"last-modified":["Thu, 07 Apr 2016 19:35:45 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"vary":["Accept-Encoding,Host"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-served-by":["cache-tw-dfw1-cr1-18-TWDFW1"],"x-timer":["S1460476022.992600,VS0,VE0"]}]
  nightmare:log did-get-response-details +20ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.google-analytics.com/analytics.js","http://www.google-analytics.com/analytics.js",200,"GET","http://www.2ality.com/",{"age":["1543"],"cache-control":["public, max-age=7200"],"content-encoding":["gzip"],"content-length":["10938"],"content-type":["text/javascript"],"date":["Tue, 12 Apr 2016 15:15:48 GMT"],"expires":["Tue, 12 Apr 2016 17:15:48 GMT"],"last-modified":["Mon, 04 Apr 2016 19:58:52 GMT"],"server":["Golfe2"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"]}]
  nightmare:log did-get-response-details +12ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.blogblog.com/1kt/watermark/body_background_navigator.png","http://www.blogblog.com/1kt/watermark/body_background_navigator.png",200,"GET","http://www.2ality.com/",{"age":["31472"],"cache-control":["public, max-age=604800"],"content-length":["35181"],"content-type":["image/png"],"date":["Tue, 12 Apr 2016 06:56:59 GMT"],"expires":["Tue, 19 Apr 2016 06:56:59 GMT"],"last-modified":["Mon, 11 Apr 2016 23:28:32 GMT"],"server":["sffe"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +13ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.en_US.HDWrPTQeElg.O/m=plusone/rt=j/sv=1/d=1/ed=1/am=EQ/rs=AGLTcCMRKOszkSt7nC7VqlwAc96EM5osfQ/cb=gapi.loaded_0","https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.en_US.HDWrPTQeElg.O/m=plusone/rt=j/sv=1/d=1/ed=1/am=EQ/rs=AGLTcCMRKOszkSt7nC7VqlwAc96EM5osfQ/cb=gapi.loaded_0",200,"GET","http://www.2ality.com/",{"age":["63607"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["41807"],"content-type":["text/javascript; charset=UTF-8"],"date":["Mon, 11 Apr 2016 22:01:24 GMT"],"expires":["Tue, 11 Apr 2017 22:01:24 GMT"],"last-modified":["Sat, 09 Apr 2016 01:59:11 GMT"],"server":["sffe"],"status":["200"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log dom-ready +16ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-get-response-details +3ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://2ality.disqus.com/count.js","http://2ality.disqus.com/count.js",200,"GET","http://www.2ality.com/",{"age":["2492310"],"cache-control":["max-age=2592000"],"content-encoding":["gzip"],"content-length":["888"],"content-type":["application/javascript"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["\"56e31be6-378\""],"expires":["Wed, 13 Apr 2016 19:22:59 GMT"],"last-modified":["Fri, 11 Mar 2016 19:26:30 GMT"],"p3p":["CP=\"DSP IDC CUR ADM DELi STP NAV COM UNI INT PHY DEM\""],"server":["nginx"],"vary":["Accept-Encoding"]}]
  nightmare:log did-get-response-details +62ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://2ality.disqus.com/count-data.js?2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Farrow-functions-vs-bind.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fjs-fatigue-fatigue.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fjs-name-clashes.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fobject-getownpropertydescriptors.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F03%2Fmulti-platform-npm-packages.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F03%2Fpromise-rejections-vs-exceptions.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F04%2Funhandled-rejections.html","http://2ality.disqus.com/count-data.js?2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Farrow-functions-vs-bind.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fjs-fatigue-fatigue.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fjs-name-clashes.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F02%2Fobject-getownpropertydescriptors.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F03%2Fmulti-platform-npm-packages.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F03%2Fpromise-rejections-vs-exceptions.html&2=http%3A%2F%2Fwww.2ality.com%2F2016%2F04%2Funhandled-rejections.html",200,"GET","http://www.2ality.com/",{"age":["376"],"cache-control":["public, max-age=600"],"content-encoding":["gzip"],"content-length":["358"],"content-type":["application/javascript; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:58:07 GMT"],"p3p":["CP=\"DSP IDC CUR ADM DELi STP NAV COM UNI INT PHY DEM\""],"server":["nginx"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +33ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://platform.twitter.com/js/timeline.0eae788bc4fdbe9cd3e72dca3bc26358.js","https://platform.twitter.com/js/timeline.0eae788bc4fdbe9cd3e72dca3bc26358.js",200,"GET","http://www.2ality.com/",{"accept-ranges":["bytes"],"age":["423784"],"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["8598"],"content-type":["application/javascript; charset=utf-8"],"date":["Tue, 12 Apr 2016 15:41:31 GMT"],"etag":["\"bcfcf68cddab543e831ce413d3ac65b7+gzip\""],"last-modified":["Thu, 07 Apr 2016 17:45:49 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"server":["Apache"],"vary":["Accept-Encoding,Host"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-served-by":["cache-tw-dfw1-cr1-18-TWDFW1"],"x-timer":["S1460475691.783763,VS0,VE0"]}]
  nightmare:log did-get-response-details +20ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://syndication.twitter.com/widgets/timelines/372995588821757952?callback=__twttr.callbacks.tl_i0_372995588821757952&dnt=true&domain=www.2ality.com&lang=en&suppress_response_codes=true&t=1622751&tweet_limit=5","https://syndication.twitter.com/widgets/timelines/372995588821757952?callback=__twttr.callbacks.tl_i0_372995588821757952&dnt=true&domain=www.2ality.com&lang=en&suppress_response_codes=true&t=1622751&tweet_limit=5",200,"GET","http://www.2ality.com/",{"cache-control":["must-revalidate, max-age=300"],"content-disposition":["attachment; filename=jsonp.jsonp"],"content-encoding":["gzip"],"content-length":["3340"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 12 Apr 2016 15:58:06 GMT"],"expires":["Tue, 12 Apr 2016 16:03:06 GMT"],"last-modified":["Tue, 12 Apr 2016 15:58:06 GMT"],"server":["tsa_a"],"status":["200"],"timing-allow-origin":["*"],"x-connection-hash":["3c5893a9a7803d7332a2c8e7e5cccfc0"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["33"],"x-transaction":["3797a30a0fb8f285"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-frame-finish-load +5ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false]
  nightmare:log did-get-response-details +18ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://platform.twitter.com/css/timeline.f7130f11be9c2719286897ede16853b9.light.ltr.css","http://platform.twitter.com/css/timeline.f7130f11be9c2719286897ede16853b9.light.ltr.css",200,"GET","",{"accept-ranges":["bytes"],"age":["423778"],"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["10693"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"etag":["\"2b691630387ceb51a8edeaef31765001+gzip\""],"last-modified":["Thu, 07 Apr 2016 17:45:29 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"vary":["Accept-Encoding,Host"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-served-by":["cache-tw-dfw1-cr1-11-TWDFW1"],"x-timer":["S1460475692.100015,VS0,VE0"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://platform.twitter.com/css/timeline.f7130f11be9c2719286897ede16853b9.light.ltr.css","http://platform.twitter.com/css/timeline.f7130f11be9c2719286897ede16853b9.light.ltr.css",200,"GET","",{"accept-ranges":["bytes"],"age":["423778"],"cache-control":["public, max-age=315569260"],"content-encoding":["gzip"],"content-length":["10693"],"content-type":["text/css; charset=utf-8"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"etag":["\"2b691630387ceb51a8edeaef31765001+gzip\""],"last-modified":["Thu, 07 Apr 2016 17:45:29 GMT"],"p3p":["CP=\"CAO DSP LAW CURa ADMa DEVa TAIa PSAa PSDa IVAa IVDa OUR BUS IND UNI COM NAV INT\""],"vary":["Accept-Encoding,Host"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-served-by":["cache-tw-dfw1-cr1-11-TWDFW1"],"x-timer":["S1460475692.100015,VS0,VE0"]}]
  nightmare:log did-get-response-details +17ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://pbs.twimg.com/profile_images/465652495306731520/weqOd4wr_bigger.jpeg","https://pbs.twimg.com/profile_images/465652495306731520/weqOd4wr_bigger.jpeg",200,"GET","",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-length":["3151"],"content-md5":["yM6wtbYFuE6NL8QXv3alUQ=="],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"last-modified":["Mon, 12 May 2014 00:39:40 GMT"],"server":["ECS (dfw/27A1)"],"surrogate-key":["profile_images profile_images/bucket/9 profile_images/465652495306731520"],"x-cache":["HIT"],"x-connection-hash":["f278202941dae7dddf1fa5e4b4e37bc8"],"x-content-type-options":["nosniff"],"x-response-time":["35"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://pbs.twimg.com/profile_images/467581434434453504/iFzELOBn_bigger.jpeg","https://pbs.twimg.com/profile_images/467581434434453504/iFzELOBn_bigger.jpeg",200,"GET","",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-length":["2439"],"content-md5":["Wwmqwg856csBSn7FKMaxfQ=="],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"last-modified":["Sat, 17 May 2014 08:24:35 GMT"],"server":["ECS (dfw/5671)"],"surrogate-key":["profile_images profile_images/bucket/0 profile_images/467581434434453504"],"x-cache":["HIT"],"x-connection-hash":["cc2cc365c9a264d41e518c7e37c7394a"],"x-content-type-options":["nosniff"],"x-response-time":["27"]}]
  nightmare:log did-get-response-details +6ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://pbs.twimg.com/profile_images/567240870588854272/1JPtRTF6_bigger.jpeg","https://pbs.twimg.com/profile_images/567240870588854272/1JPtRTF6_bigger.jpeg",200,"GET","",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-length":["1794"],"content-md5":["2myoP8bTwwjTCWdElSiX9A=="],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"last-modified":["Mon, 16 Feb 2015 08:35:37 GMT"],"server":["ECS (dfw/F4A5)"],"surrogate-key":["profile_images profile_images/bucket/0 profile_images/567240870588854272"],"x-cache":["HIT"],"x-connection-hash":["e9c129b9c25cc6c2dae887bfd6dfe765"],"x-content-type-options":["nosniff"],"x-response-time":["21"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://pbs.twimg.com/media/CfxVCRpW8AADJ1i.jpg:small","https://pbs.twimg.com/media/CfxVCRpW8AADJ1i.jpg:small",200,"GET","",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-length":["14188"],"content-md5":["/dxeOq5766jRPHd9XPfG3A=="],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:41:32 GMT"],"last-modified":["Mon, 11 Apr 2016 15:12:02 GMT"],"server":["ECS (dfw/278E)"],"surrogate-key":["media media/bucket/5 media/719543538057408512"],"x-cache":["HIT"],"x-connection-hash":["144800c7724259189b562e8273d4c1b8"],"x-content-type-options":["nosniff"],"x-response-time":["71"]}]
  nightmare:log did-get-response-details +8ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://www.google-analytics.com/collect?v=1&_v=j41&a=699027842&t=pageview&_s=1&dl=http%3A%2F%2Fwww.2ality.com%2F&ul=en-us&de=UTF-8&dt=%E2%91%A1ality%20%E2%80%93%20JavaScript%20and%20more&sd=24-bit&sr=1440x900&vp=1200x578&je=0&_u=AACAAAABI~&jid=&cid=164324354.1460475693&tid=UA-46839352-1&z=1126839064","http://www.google-analytics.com/collect?v=1&_v=j41&a=699027842&t=pageview&_s=1&dl=http%3A%2F%2Fwww.2ality.com%2F&ul=en-us&de=UTF-8&dt=%E2%91%A1ality%20%E2%80%93%20JavaScript%20and%20more&sd=24-bit&sr=1440x900&vp=1200x578&je=0&_u=AACAAAABI~&jid=&cid=164324354.1460475693&tid=UA-46839352-1&z=1126839064",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"age":["297810"],"cache-control":["no-cache, no-store, must-revalidate"],"content-length":["35"],"content-type":["image/gif"],"date":["Sat, 09 Apr 2016 05:15:41 GMT"],"expires":["Mon, 01 Jan 1990 00:00:00 GMT"],"last-modified":["Sun, 17 May 1998 03:00:00 GMT"],"pragma":["no-cache"],"server":["Golfe2"],"x-content-type-options":["nosniff"]}]
  nightmare:log did-get-response-details +116ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://pbs.twimg.com/media/CfxVCRpW8AADJ1i.jpg","https://pbs.twimg.com/media/CfxVCRpW8AADJ1i.jpg",200,"GET","",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"content-length":["37775"],"content-md5":["AKUqkeyJTTodAfyXMLWe2w=="],"content-type":["image/jpeg"],"date":["Tue, 12 Apr 2016 15:42:07 GMT"],"last-modified":["Mon, 11 Apr 2016 15:12:02 GMT"],"server":["ECS (dfw/2794)"],"surrogate-key":["media media/bucket/5 media/719543538057408512"],"x-cache":["HIT"],"x-connection-hash":["f352db9435c3ac00a6a34b971551b6ab"],"x-content-type-options":["nosniff"],"x-response-time":["13"]}]
  nightmare:log did-get-response-details +161ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://syndication.twitter.com/i/jot/syndication?dnt=1&l=%7B%22_category_%22%3A%22syndicated_impression%22%2C%22triggered_on%22%3A1460476753462%2C%22dnt%22%3Atrue%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22impression%22%7D%7D","https://syndication.twitter.com/i/jot/syndication?dnt=1&l=%7B%22_category_%22%3A%22syndicated_impression%22%2C%22triggered_on%22%3A1460476753462%2C%22dnt%22%3Atrue%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22impression%22%7D%7D",200,"GET","http://www.2ality.com/",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-encoding":["gzip"],"content-length":["65"],"content-type":["image/gif;charset=utf-8"],"date":["Tue, 12 Apr 2016 15:59:11 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 12 Apr 2016 15:59:11 GMT"],"pragma":["no-cache"],"server":["tsa_a"],"status":["200","200 OK"],"strict-transport-security":["max-age=631138519"],"x-connection-hash":["463d5e670b6a2fea4f8cc1891dce5829"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["4"],"x-transaction":["20ef7c48991ff71e"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +137ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://syndication.twitter.com/i/jot?dnt=1&l=%7B%22widget_origin%22%3A%22http%3A%2F%2Fwww.2ality.com%2F%22%2C%22widget_frame%22%3Afalse%2C%22widget_id%22%3A%22372995588821757952%22%2C%22query%22%3Anull%2C%22profile_id%22%3Anull%2C%22widget_in_viewport%22%3Afalse%2C%22item_ids%22%3A%5B%22719856924687278080%22%2C%22719843752534220801%22%2C%22719543539542192128%22%2C%22719286885898719232%22%2C%22719262180215037952%22%5D%2C%22item_details%22%3A%7B%22719856924687278080%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719856963304210435%22%7D%2C%22719843752534220801%22%3A%7B%22item_type%22%3A0%7D%2C%22719543539542192128%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719543689278791685%22%7D%2C%22719286885898719232%22%3A%7B%22item_type%22%3A0%7D%2C%22719262180215037952%22%3A%7B%22item_type%22%3A0%7D%7D%2C%22_category_%22%3A%22tfw_client_event%22%2C%22triggered_on%22%3A1460476753773%2C%22dnt%22%3Atrue%2C%22client_version%22%3A%221fee1b0%3A1460048100015%22%2C%22format_version%22%3A1%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22component%22%3A%22timeline%22%2C%22element%22%3A%22initial%22%2C%22action%22%3A%22results%22%7D%7D","https://syndication.twitter.com/i/jot?dnt=1&l=%7B%22widget_origin%22%3A%22http%3A%2F%2Fwww.2ality.com%2F%22%2C%22widget_frame%22%3Afalse%2C%22widget_id%22%3A%22372995588821757952%22%2C%22query%22%3Anull%2C%22profile_id%22%3Anull%2C%22widget_in_viewport%22%3Afalse%2C%22item_ids%22%3A%5B%22719856924687278080%22%2C%22719843752534220801%22%2C%22719543539542192128%22%2C%22719286885898719232%22%2C%22719262180215037952%22%5D%2C%22item_details%22%3A%7B%22719856924687278080%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719856963304210435%22%7D%2C%22719843752534220801%22%3A%7B%22item_type%22%3A0%7D%2C%22719543539542192128%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22719543689278791685%22%7D%2C%22719286885898719232%22%3A%7B%22item_type%22%3A0%7D%2C%22719262180215037952%22%3A%7B%22item_type%22%3A0%7D%7D%2C%22_category_%22%3A%22tfw_client_event%22%2C%22triggered_on%22%3A1460476753773%2C%22dnt%22%3Atrue%2C%22client_version%22%3A%221fee1b0%3A1460048100015%22%2C%22format_version%22%3A1%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22page%22%3A%22timeline%22%2C%22component%22%3A%22timeline%22%2C%22element%22%3A%22initial%22%2C%22action%22%3A%22results%22%7D%7D",200,"GET","http://www.2ality.com/",{"cache-control":["no-cache, no-store, must-revalidate, pre-check=0, post-check=0"],"content-encoding":["gzip"],"content-length":["65"],"content-type":["image/gif;charset=utf-8"],"date":["Tue, 12 Apr 2016 15:59:12 GMT"],"expires":["Tue, 31 Mar 1981 05:00:00 GMT"],"last-modified":["Tue, 12 Apr 2016 15:59:12 GMT"],"pragma":["no-cache"],"server":["tsa_a"],"status":["200","200 OK"],"strict-transport-security":["max-age=631138519"],"x-connection-hash":["463d5e670b6a2fea4f8cc1891dce5829"],"x-content-type-options":["nosniff"],"x-frame-options":["SAMEORIGIN"],"x-response-time":["7"],"x-transaction":["0b5c58d40287d643"],"x-twitter-response-tags":["BouncerCompliant"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://srv.carbonads.net/ads/C6AILKT.json?segment=placement:2alitycom&callback=_carbonads_go","http://srv.carbonads.net/ads/C6AILKT.json?segment=placement:2alitycom&callback=_carbonads_go",200,"GET","http://www.2ality.com/",{"cf-ray":["2927e2520ba403e8-DFW"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["729"],"content-type":["application/javascript"],"date":["Tue, 12 Apr 2016 15:59:12 GMT"],"server":["cloudflare-nginx"],"vary":["Accept-Encoding"]}]
  nightmare:log did-get-redirect-request +528ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},"https://ad.doubleclick.net/ddm/ad/N9515.734586CARBONADS.NET/B8661482.117093741;sz=130x100;ord=1460476752?","https://ad.doubleclick.net/ddm/ad/N9515.734586CARBONADS.NET/B8661482.117093741;dc_pre=CKTmq_C7icwCFU5KXgodApEARw;sz=130x100;ord=1460476752?",false,302,"GET","http://www.2ality.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:59:12 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"follow-only-when-prerender-shown":["1"],"location":["https://ad.doubleclick.net/ddm/ad/N9515.734586CARBONADS.NET/B8661482.117093741;dc_pre=CKTmq_C7icwCFU5KXgodApEARw;sz=130x100;ord=1460476752?"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"set-cookie":["test_cookie=CheckForPermission; expires=Tue, 12-Apr-2016 16:14:12 GMT; path=/; domain=.doubleclick.net"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-redirect-request +160ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},"https://ad.doubleclick.net/ddm/ad/N9515.734586CARBONADS.NET/B8661482.117093741;dc_pre=CKTmq_C7icwCFU5KXgodApEARw;sz=130x100;ord=1460476752?","https://s1.2mdn.net/viewad/4534608/J647_TCO_Bnr_130x100.jpg",false,302,"GET","http://www.2ality.com/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 12 Apr 2016 15:59:12 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"location":["https://s1.2mdn.net/viewad/4534608/J647_TCO_Bnr_130x100.jpg"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"set-cookie":["id=226b63e55107002b||t=1460476752|et=730|cs=002213fd4899c164052815dc36; expires=Thu, 12-Apr-2018 15:59:12 GMT; path=/; domain=.doubleclick.net","test_cookie=; domain=.doubleclick.net; path=/; expires=Mon, 21 Jul 2008 23:59:00 GMT","IDE=AHWqTUmZDy2cGD0ZSk-v4G-AUpy5ZsxBnbnNF9MnA7mtRmthSF6bGHtxOw; expires=Thu, 12-Apr-2018 15:59:12 GMT; path=/; domain=.doubleclick.net; HttpOnly"],"status":["302"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-response-details +615ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"https://s1.2mdn.net/viewad/4534608/J647_TCO_Bnr_130x100.jpg","https://ad.doubleclick.net/ddm/ad/N9515.734586CARBONADS.NET/B8661482.117093741;sz=130x100;ord=1460476752?",200,"GET","http://www.2ality.com/",{"access-control-allow-origin":["*"],"age":["72076"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=86400"],"content-length":["33718"],"content-type":["image/jpeg"],"date":["Mon, 11 Apr 2016 19:57:57 GMT"],"expires":["Tue, 12 Apr 2016 19:57:57 GMT"],"last-modified":["Tue, 16 Feb 2016 19:14:33 GMT"],"server":["sffe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log page-favicon-updated +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},["http://www.2ality.com/favicon.ico"]]
  nightmare:log did-stop-loading +1ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-frame-finish-load +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},true]
  nightmare:log did-finish-load +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:actions .wait() for body element +1ms
  nightmare:actions .evaluate() fn on the page +4ms
{ height: 9167, width: 1200 }
  nightmare queueing action "viewport" +14ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "screenshot" +0ms
  nightmare running +0ms
  nightmare:actions .viewport() +0ms
  nightmare:actions .wait() for 1000ms +52ms
  nightmare:actions .screenshot() +1s
  nightmare:log subscribing to browser window frames +1ms
  nightmare:log altering page to force rendering +0ms
  nightmare:log did-start-loading +223ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log page-favicon-updated +4ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},["http://www.2ality.com/favicon.ico"]]
  nightmare:log did-stop-loading +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare:log did-frame-finish-load +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"width":1200,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/AJ/dev/personal/screenshot/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false]
  nightmare:log unsubscribing from browser window frames +49s
^CError: IPC channel is already disconnected
    at ChildProcess.target.disconnect (internal/child_process.js:660:26)
    at Pipe.channel.onread (internal/child_process.js:453:14)
```

Running the same code on google.com does not produce the error.
 `screen.js`

```
#!/usr/bin/env node

'use strict';

const Nightmare = require('nightmare');
const path = require('path');
const assert = require('assert');
const url = require('url');
const vo = require('vo');
const mkdirp = require('mkdirp-promise');
const fs = require('fs');

function padLeft(num, base, chr) {
  let len = (String(base || 10).length - String(num).length)+1;
  return len > 0? new Array(len).join(chr || '0')+num : num;
}

function getDate() {
  let d = new Date();
  return [padLeft((d.getMonth()+1)),
           padLeft(d.getDate()),
           d.getFullYear()].join('') + '-' +
          [padLeft(d.getHours()),
           padLeft(d.getMinutes()),
           padLeft(d.getSeconds()),
           padLeft(d.getMilliseconds(), 100)].join('');
}

function* run() {
  let inputURI = process.argv.slice(2)[0];
  let outputDir = process.argv.slice(3)[0];
  let filename = '/screenshot-' + getDate() + '.png';
  let width = process.argv.slice(4)[0];
  width = width || 1200;

  assert.ok(inputURI, 'Must have a url');
  assert.ok(outputDir, 'Must have an output URL');

  outputDir = path.join(__dirname, outputDir);

  if( inputURI.indexOf('http://') != 0 ) {
    inputURI = 'http://' + inputURI;
  }

  let savePath = outputDir + filename;
  console.log( savePath );

  let nightmare = Nightmare({
    show: false,
    width: width
  });

  var dimensions = yield nightmare.goto(inputURI)
    .wait('body')
    .evaluate(function() {
        var body = document.querySelector('body');
        return {
            height: body.scrollHeight,
            width:body.scrollWidth
        }
    });

  console.dir(dimensions);

  yield mkdirp( outputDir );

  let screenshot = yield nightmare.viewport(dimensions.width, dimensions.height)
    .wait(1000)
    .screenshot();

  console.log( screenshot );

  fs.writeFileSync( savePath, screenshot );

  yield nightmare.end();
}

vo(run)(function() {
  console.log('done');
});
```

`package.json`

```
{
  "name": "screenshots",
  "private": true,
  "dependencies": {
    "graceful-fs": "^4.1.3",
    "mkdirp-promise": "^1.0.4",
    "nightmare": "^2.3.1",
    "vo": "^3.1.1"
  },
  "scripts": {
    "example": "DEBUG=* ./screen.js http://www.google.com/ test",
    "example-bugged": "DEBUG=* ./screen.js http://www.2ality.com/ test"
  }
}
```

This is the code I'm running, see commands in package.json
 Nightmare did hang, after 60 seconds no response.
 Hey, I'm also seeing the same issue. Here's my code:

``` javascript
var Nightmare = require('nightmare');
var async = require('async');

var urls = [
    'https://www.spotify.com/uk/',
    'http://tiendas.mediamarkt.es/',
    'https://www.kairos.com/',
    'https://society6.com/',
    'https://teamtreehouse.com/',
    'https://www.npmjs.com/',
    'http://imgur.com/',
    'http://conversion.com',
    'http://adidas.com',
    'http://adp.com'
];

var q = async.queue(function (website, callback) {
    var nightmare = Nightmare({
        show: true, 
        dock: true,
    }).useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36').viewport(1280, 800);
    nightmare.goto(website.url)
    .evaluate(function() {
        return window;
    }).end().then(function(window){
        console.log('Window object available for: %s', website.url);
        callback(false, website.url);
    })
    .catch(function(err) {
        console.error(err);
        callback(err, 0);
    });
}, 10);

q.drain = function() {
    console.log('Finished all URLs');
    process.exit(1);
};

urls.forEach(function(url) {
    q.push({
        url: url
    }, function(err) {
        console.log('Finished processing: '+url);
    });
});
```

and the logs:

``` cli
  nightmare:log did-get-response-details +17ms [{},false,"https://beacon.krxd.net/pixel.gif?source=smarttag&fired=report&confid=JprpolCG&_kpid=66822801-aa35-4f0d-a6ab-78970028f03f&_kcp_s=society6.com&_kcp_d=society6.com&_knifr=4&_kua_kx_tz=-60&geo_country=uk&geo_region=lnd&geo_dma=826044&_kua_kx_lang=en-us&_kua_kx_tech_browser_language=en-us&_kua_kx_tech_browser=Chrome&_kua_kx_tech_manufacturer=Apple%20Inc.&_kua_kx_tech_device=Computer&_kua_kx_tech_os=Mac%20OS%20X&_kua_kx_whistle=0&_kua_kx_geo_country=uk&_kua_kx_geo_region=lnd&_kua_kx_geo_dma=826044&_kpa_domain=society6.com&_kpa_pagetype=home&_kpa_subpagetype=home&_kpa_title=Society6%20%7C%20Affordable%20Art%20Prints%2C%20iPhone%20Cases%20and%20T-shirts&kx_streaming=1&t_navigation_type=0&t_dns=14&t_tcp=501&t_http_request=-1&t_http_response=4&t_content_ready=7609&t_window_load=10971&t_redirect=0&interchange_ran=false&userdata_was_requested=true&userdata_did_respond=true&store_user_after=qlfi24omj&store_segs_after=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&userdata_user=KdjQEHAZ%2Cqlfi24omj&userdata_segs=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&_kpa_dfpsite=viewthroughconversion&_kpa_dfpzone=980702394&sview=1&kplt0=17990&kplt1=17980&kplt2=17991&kplt3=17992&kplt4=17994&kplt5=19372&kplt6=19453&kplt7=17977&kplt8=17978&kplt9=17981&kplt10=17982&kplt11=18752&kplt12=18753&kplt13=18754&kplt14=18755&kplt15=18756&kplt16=18757&kplt17=17987&kplt18=18758&kplt19=17997&kplt20=17998&kplt21=18000&kplt22=18002&kplt23=18003&kplt24=18004&kplt25=18005&kplt26=18066&kplt27=18067&kplt28=18068&kplt29=17995&kplt30=17983&kplt31=17984&kplt32=17988&kplt33=17993&jsonp_requests=%2F%2Fbeacon.krxd.net%2Foptout_check%2C408%2C%2F%2Fcdn.krxd.net%2Fuserdata%2Fget%2C409","https://beacon.krxd.net/pixel.gif?source=smarttag&fired=report&confid=JprpolCG&_kpid=66822801-aa35-4f0d-a6ab-78970028f03f&_kcp_s=society6.com&_kcp_d=society6.com&_knifr=4&_kua_kx_tz=-60&geo_country=uk&geo_region=lnd&geo_dma=826044&_kua_kx_lang=en-us&_kua_kx_tech_browser_language=en-us&_kua_kx_tech_browser=Chrome&_kua_kx_tech_manufacturer=Apple%20Inc.&_kua_kx_tech_device=Computer&_kua_kx_tech_os=Mac%20OS%20X&_kua_kx_whistle=0&_kua_kx_geo_country=uk&_kua_kx_geo_region=lnd&_kua_kx_geo_dma=826044&_kpa_domain=society6.com&_kpa_pagetype=home&_kpa_subpagetype=home&_kpa_title=Society6%20%7C%20Affordable%20Art%20Prints%2C%20iPhone%20Cases%20and%20T-shirts&kx_streaming=1&t_navigation_type=0&t_dns=14&t_tcp=501&t_http_request=-1&t_http_response=4&t_content_ready=7609&t_window_load=10971&t_redirect=0&interchange_ran=false&userdata_was_requested=true&userdata_did_respond=true&store_user_after=qlfi24omj&store_segs_after=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&userdata_user=KdjQEHAZ%2Cqlfi24omj&userdata_segs=payqhlof4%2Cpr1zazxer%2Cpayah4ljm%2Co2ttswcd9%2Co964xfl5l%2Cpayjohatv%2Cpze22g37k%2Cpetggegwl%2Cqnc9trer3%2Cpc5wh9pbr%2Cpf468bk50%2Cqb8np9e6l%2Cpbudwus95%2Cpe0yfzos1%2Cpaymccolj&_kpa_dfpsite=viewthroughconversion&_kpa_dfpzone=980702394&sview=1&kplt0=17990&kplt1=17980&kplt2=17991&kplt3=17992&kplt4=17994&kplt5=19372&kplt6=19453&kplt7=17977&kplt8=17978&kplt9=17981&kplt10=17982&kplt11=18752&kplt12=18753&kplt13=18754&kplt14=18755&kplt15=18756&kplt16=18757&kplt17=17987&kplt18=18758&kplt19=17997&kplt20=17998&kplt21=18000&kplt22=18002&kplt23=18003&kplt24=18004&kplt25=18005&kplt26=18066&kplt27=18067&kplt28=18068&kplt29=17995&kplt30=17983&kplt31=17984&kplt32=17988&kplt33=17993&jsonp_requests=%2F%2Fbeacon.krxd.net%2Foptout_check%2C408%2C%2F%2Fcdn.krxd.net%2Fuserdata%2Fget%2C409",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a235-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=307 t=1462265667703675"],"x-served-by":["beacon-a235-dub.krxd.net"]},"image"]
  nightmare:log did-get-response-details +19ms [{},false,"https://www.facebook.com/fr/u.php?p=474445595912814&m=3c1c3f46-95fc-4602-b078-e8fce01d120e&t=2592000","https://www.facebook.com/fr/u.php?p=474445595912814&m=3c1c3f46-95fc-4602-b078-e8fce01d120e&t=2592000",200,"GET","",{"cache-control":["public, max-age=0"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl;style-src * 'unsafe-inline' data:;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: 127.0.0.1:*;"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 01:54:27 PDT"],"expires":["Tue, 03 May 2016 01:54:27 PDT"],"pragma":["public"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["7c7xhLlnkdQp+Fn9CTt+VkSbTyNUKQGdBsZH4nQ929LZn6kk59ka2rHbCL311l2R9CsyQoMHWpeYeTfo90wmKQ=="],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +41ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=21551410;ord=158192cf-14b6-4b14-9538-d33c05a5fc90","https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=21551410;ord=158192cf-14b6-4b14-9538-d33c05a5fc90",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/google/cookiematch.aspx?id=&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_gid=CAESEMBwXoi3GUHw0s-ZMnL_qes&google_cver=1&google_ula=913071,0","https://cm.g.doubleclick.net/pixel?google_nid=cjp&google_sc&google_ula=913071&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_cm&google_hm=Rj8cPPyVAkaweOj84B0SDg",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-redirect-request +13ms [{},"https://r.nexac.com/e/getdata.xgi?dt=br&pkey=bckw15bckwu20&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D8bf57916-aac8-4f01-a386-4baf103b3e1f%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E","https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=8bf57916-aac8-4f01-a386-4baf103b3e1f&dlxid=2016042702425739821951529685&dlxdata=",false,302,"GET","https://society6.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=8bf57916-aac8-4f01-a386-4baf103b3e1f&dlxid=2016042702425739821951529685&dlxdata="],"server":["Apache-Coyote/1.1"]}]
  nightmare:log did-get-redirect-request +10ms [{},"https://match.adsrvr.org/track/cmf/generic?ttd_pid=steelhouse&ttd_tpi=1","https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919",false,302,"GET","https://teamtreehouse.com/",{"cache-control":["private,no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["189"],"content-type":["text/html"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"location":["https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919"],"p3p":["CP=\"NOI DSP COR CUR ADMo DEVo PSAo PSDo OUR SAMo BUS UNI NAV\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"set-cookie":["TDID=4a61710e-63ae-4def-8ca5-734dc833a919; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/","TDCPM=CAESFwoIZmFjZWJvb2sSCwiwjZvH7OjvMxAFEhkKCmktYmVoYXZpb3ISCwikvd3M6+jvMxAFEhQKBXRhcGFkEgsIiNzE5ezo7zMQBRIZCgpkcmF3YnJpZGdlEgsIhu/q5ezo7zMQBRIWCgdhZGJyYWluEgsI9Iin6uzo7zMQBRIWCgdibHVla2FpEgsIuue21e6J+DMQBRIWCgdydWJpY29uEgsIiOns/PXo7zMQBRIXCghwdWJtYXRpYxILCPKmwdH26O8zEAUSFQoGY2FzYWxlEgsI1qb+ncCg9zMQBRIZCgpzdGVlbGhvdXNlEgsImPDhrdLO+TMQBRIVCgZnb29nbGUSCwi67KC+v6D3MxAFEhgKCWJpZHN3aXRjaBILCICDhqjE8+8zEAUSGAoJbW9va2llLXBzEgsIuvqHy9Xz7zMQBRIYCgljcm9zc3dpc2USCwjcw+De1/PvMxAFEhgKCVF1YW50Y2FzdBILCPaN+q6W9fYzEAUSFgoHYWRkdGhpcxILCODP+Y+k9vYzEAUSGQoKcmlnaHRtZWRpYRILCIC1y+yMq+wzEAUSFwoIYXBwbmV4dXMSCwjczKbl4In4MxAFEhIKA2FhbRILCPrO2Pek9vYzEAUSFgoHZXhlbGF0ZRILCKzPm/ek9vYzEAUSFgoHbmV1c3RhchILCMyP4fyk9vYzEAUSFQoGbW9va2llEgsIhL6m5K329jMQBRIYCglhb2xhZHRlY2gSCwiEvqbkrfb2MxAFEhQKBXNwb3R4EgsIvOiNmK729jMQBRIYCglzdGlja3lhZHMSCwj8sM+10/v2MxAFEhUKBmFkYXB0dhILCK6Hjp2Y/PYzEAUSFAoFb3BlbngSCwie7YbBnqD3MxAFEhUKBmFkbWFucxILCPT1tsK/oPczEAUSGgoLc21hcnRzdHJlYW0SCwjM+sGZv6D3MxAFEh0KDnNtYXJ0LWFkc2VydmVyEgsIjvbTleeJ+DMQBRIVCgZzb25vYmkSCwior43PyKD3MxAFEhUKBmxvdGFtZRILCIzNxa+2ofczEAUSFwoIbGl2ZXJhbXASCwjShr/xt6H3MxAFEhQKBXRlYWRzEgsIrOjptqWu9zMQBRIdCg5mZWRlcmF0ZWRtZWRpYRILCIqG+86VpfczEAUSGAoJYWRhZHZpc29yEgsIkJba9I6s9zMQBRIaCgthcmV5b3VodW1hbhILCJ6i1I6RrPczEAUSGwoMY2hvaWNlc3RyZWFtEgsI2tqko6qs9zMQBRIWCgdyYWt1dGVuEgsIyLX/2euJ+DMQBRIZCgpjcm9zc3BpeGVsEgsImMWls7Ou9zMQBRgBIAEoAjILCJjo5NrozvkzEAU4AVIZCgppLWJlaGF2aW9yEgsImJG688Pz7zMQBVIWCgdhZGJyYWluEgsImJG688Pz7zMQBVIUCgV0YXBhZBILCJiRuvPD8+8zEAVSGQoKZHJhd2JyaWRnZRILCNjC1LzX8+8zEAVSFgoHYmx1ZWthaRILCNjC1LzX8+8zEAVSFQoGY2FzYWxlEgsI2MLUvNfz7zMQBVIYCgljcm9zc3dpc2USCwiQkIigiPXvMxAFUhcKCHB1Ym1hdGljEgsIkJCIoIj17zMQBVIVCgZnb29nbGUSCwiQkIigiPXvMxAFUhcKCGZhY2Vib29rEgsI0rXGiZb19jMQBVIYCgliaWRzd2l0Y2gSCwjStcaJlvX2MxAFUhgKCW1vb2tpZS1wcxILCNK1xomW9fYzEAVSFgoHcnViaWNvbhILCLTlyqGa9fYzEAVaCnN0ZWVsaG91c2VgAmoOVW5pdGVkIEtpbmdkb20=; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/"],"x-aspnet-version":["4.0.30319"]}]
  nightmare:log did-get-response-details +7ms [{},false,"https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=8bf57916-aac8-4f01-a386-4baf103b3e1f&dlxid=2016042702425739821951529685&dlxdata=","https://r.nexac.com/e/getdata.xgi?dt=br&pkey=bckw15bckwu20&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D8bf57916-aac8-4f01-a386-4baf103b3e1f%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a247-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=194 t=1462265667791994"],"x-served-by":["beacon-a247-dub.krxd.net"]},"image"]
  nightmare:log did-get-redirect-request +5ms [{},"https://r.nexac.com/e/getdata.xgi?dt=br&pkey=iefs40iefsj26&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D536f0daa-aaaa-4d9e-9a25-dde40646786a%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E","https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=536f0daa-aaaa-4d9e-9a25-dde40646786a&dlxid=2016042702425739821951529685&dlxdata=",false,302,"GET","https://society6.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:26 GMT"],"location":["https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=536f0daa-aaaa-4d9e-9a25-dde40646786a&dlxid=2016042702425739821951529685&dlxdata="],"server":["Apache-Coyote/1.1"]}]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-viaje.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-viaje.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["481745"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["237736"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:24:41 GMT"],"via":["1.1 4301cae4279742217ac2404c33644d60.cloudfront.net (CloudFront)"],"x-amz-cf-id":["Vjbe4kuiD3YWbAYd8CSXEcAYBk1ktly1liFSNk6Vf_rezldvucDP3w=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-redirect-request +5ms [{},"https://r.nexac.com/e/getdata.xgi?dt=br&pkey=gwjn34gwjnh86&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3Dd7158cb7-a851-4e3c-b7ab-cc9e815b2399%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E","https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=d7158cb7-a851-4e3c-b7ab-cc9e815b2399&dlxid=2016042702425739821951529685&dlxdata=",false,302,"GET","https://society6.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=d7158cb7-a851-4e3c-b7ab-cc9e815b2399&dlxid=2016042702425739821951529685&dlxdata="],"server":["Apache-Coyote/1.1"]}]
  nightmare:log did-get-response-details +1ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-coche.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["481745"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["211710"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:18:06 GMT"],"via":["1.1 b3e0421894f059989c9239ce483af1a6.cloudfront.net (CloudFront)"],"x-amz-cf-id":["fB0EtgExgr9Y67dY9sd5ENrpd3xDxQOKugaa_sV89nvKqJuupETMdg=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-crazy-car.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-crazy-car.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["439158"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["237089"],"content-type":["image/jpeg"],"date":["Thu, 28 Apr 2016 06:55:12 GMT"],"last-modified":["Thu, 28 Apr 2016 06:51:52 GMT"],"via":["1.1 4301cae4279742217ac2404c33644d60.cloudfront.net (CloudFront)"],"x-amz-cf-id":["kSPd2KXanc1GWMPHLiISKfhUsuz6QgLtLV_UMutZRccMaq5T-GB4ww=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +10ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-Floco-tv.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-Floco-tv.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["90495"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["253808"],"content-type":["image/jpeg"],"date":["Mon, 02 May 2016 07:46:11 GMT"],"last-modified":["Mon, 02 May 2016 07:41:02 GMT"],"via":["1.1 92423f766303b20998ffc97d623638f7.cloudfront.net (CloudFront)"],"x-amz-cf-id":["JGSzV1HIdjZgsh68UHrt_IbU7Bm7ksHuZlNwR8BeRLnnqN-894-cag=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-gafas.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-FLoco-gafas.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["481745"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["209538"],"content-type":["image/jpeg"],"date":["Wed, 27 Apr 2016 19:05:25 GMT"],"last-modified":["Wed, 27 Apr 2016 16:35:09 GMT"],"via":["1.1 587dc871e0b842458664a6c4d7607f67.cloudfront.net (CloudFront)"],"x-amz-cf-id":["1Jl2xUTk1K-RWnnb13M8WuGmgYo6IigeALjqvHwO6yDytzp0-iLFzw=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-battleborn-preventa.jpg","http://d243u7pon29hni.cloudfront.net/images/slide-big-banner/big-banner/img/995x300-battleborn-preventa.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["435892"],"cache-control":["public,max-age=1209600"],"connection":["keep-alive"],"content-length":["179505"],"content-type":["image/jpeg"],"date":["Thu, 28 Apr 2016 07:49:38 GMT"],"last-modified":["Thu, 28 Apr 2016 07:47:42 GMT"],"via":["1.1 5708bb5bf7c6584fb61b0ea84d7bead3.cloudfront.net (CloudFront)"],"x-amz-cf-id":["CNbbdWe80XHP3VJwLxkKvFGHp49DVG8txb9AckuiqYf1v1AXosfHvQ=="],"x-cache":["Hit from cloudfront"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=1","https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=1",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["0"],"p3p":["CP=\"NOI CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Rubicon Project"],"set-cookie":["put_2263=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Sun, 29-May-2016 10:58:12 GMT; Path=/","rpb=8981%3D1%265421%3D1%266359%3D1%266434%3D1%26189868%3D1%269019%3D1%2613368%3D1%2612244%3D1%266433%3D1%2613466%3D1%2613508%3D1%2612370%3D1%2612368%3D1%267884%3D1%267883%3D1%267882%3D1%26112468%3D1%2613746%3D1%2613752%3D1%2613750%3D1%2612372%3D1%26194538%3D1%264894%3D1%264222%3D1%267249%3D1%2611203%3D1%2631950%3D1%2613490%3D1%2670596%3D1%267751%3D1%267727%3D1%2671604%3D1%26183462%3D1%266286%3D1%2682080%3D1%26186028%3D1%262372%3D1%26203184%3D1%26215638%3D1%26108792%3D1%26212364%3D1%26143762%3D1%26143760%3D1%26212368%3D1%26159872%3D1%262374%3D1%2614965%3D1%2617149%3D1%265364%3D1%269073%3D1%2650194%3D1%26100834%3D1%26144598%3D1%2614459%3D1%2615796%3D1%267859%3D1%267935%3D1%2642062%3D1%2616728%3D1%26109108%3D1%2645396%3D1%2645392%3D1%2617255%3D1%26124944%3D1%264210%3D1%2697126%3D1%2645398%3D1%26111756%3D1%267975%3D1%266564%3D1%2661894%3D1%2616386%3D1%264705%3D1%2650978%3D1%2675676%3D1%26102574%3D1%26101402%3D1%2664580%3D1%2666372%3D1%26203918%3D1%26203866%3D1%26203952%3D1%26203878%3D1%26203914%3D1%26203900%3D1%26113624%3D1; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:27 GMT; Path=/","put_2054=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Wed, 04-May-2016 08:54:26 GMT; Path=/","rpx=8981%3D54938%2C434%2C3%2C%2C%265421%3D54938%2C598%2C62%2C%2C%266359%3D54938%2C504%2C17%2C%2C%266434%3D54938%2C504%2C71%2C%2C%26189868%3D54938%2C0%2C1%2C%2C%269019%3D54943%2C455%2C6%2C%2C%2613368%3D54943%2C498%2C8%2C%2C%2612244%3D54943%2C498%2C14%2C%2C%266433%3D54943%2C499%2C42%2C%2C%2613466%3D54943%2C498%2C13%2C%2C%2613508%3D54943%2C498%2C8%2C%2C%2612370%3D54943%2C499%2C12%2C%2C%2612368%3D54943%2C478%2C5%2C%2C%267884%3D54943%2C499%2C16%2C%2C%267883%3D54943%2C499%2C22%2C%2C%267882%3D54943%2C498%2C8%2C%2C%26112468%3D54943%2C499%2C24%2C%2C%2613746%3D54944%2C498%2C21%2C%2C%2613752%3D55372%2C70%2C17%2C%2C%2613750%3D55372%2C70%2C8%2C%2C%2612372%3D55372%2C70%2C12%2C%2C%26194538%3D55372%2C70%2C93%2C%2C%264894%3D55372%2C27%2C6%2C%2C%264222%3D55372%2C20%2C2%2C%2C%267249%3D55392%2C31%2C2%2C%2C%2611203%3D55392%2C31%2C2%2C%2C%2631950%3D55392%2C4%2C2%2C%2C%2613490%3D55392%2C50%2C17%2C%2C%2670596%3D55392%2C0%2C1%2C%2C%267751%3D55392%2C1%2C2%2C%2C%267727%3D55392%2C0%2C1%2C%2C%2671604%3D55393%2C0%2C1%2C%2C%26183462%3D55393%2C0%2C1%2C%2C%266286%3D55393%2C0%2C1%2C%2C%2682080%3D55393%2C0%2C1%2C%2C%26186028%3D55393%2C0%2C1%2C%2C%262372%3D55394%2C2%2C2%2C29%2C%26203184%3D55394%2C2%2C2%2C29%2C%26215638%3D55394%2C2%2C2%2C29%2C%26108792%3D55394%2C2%2C2%2C29%2C%26212364%3D55394%2C2%2C2%2C29%2C%26143762%3D55394%2C2%2C2%2C29%2C%26143760%3D55394%2C2%2C2%2C29%2C%26212368%3D55394%2C2%2C2%2C29%2C%26159872%3D55394%2C2%2C2%2C29%2C%262374%3D55394%2C2%2C2%2C29%2C%2614965%3D55394%2C0%2C1%2C%2C%2617149%3D55394%2C0%2C1%2C%2C%265364%3D55394%2C0%2C1%2C90%2C%269073%3D55394%2C30%2C11%2C%2C%2650194%3D55396%2C2%2C3%2C%2C%26100834%3D55396%2C2%2C2%2C%2C%26144598%3D55396%2C0%2C1%2C%2C%2614459%3D55396%2C0%2C1%2C%2C%2615796%3D55396%2C0%2C1%2C28%2C%267859%3D55396%2C2%2C2%2C29%2C%267935%3D55396%2C0%2C1%2C%2C%2642062%3D55396%2C0%2C1%2C90%2C%2616728%3D55398%2C0%2C1%2C27%2C%26109108%3D55398%2C0%2C1%2C27%2C%2645396%3D55398%2C0%2C2%2C30%2C%2645392%3D55398%2C0%2C2%2C30%2C%2617255%3D55398%2C26%2C2%2C30%2C%26124944%3D55398%2C0%2C1%2C%2C%264210%3D55398%2C0%2C1%2C%2C%2697126%3D55398%2C26%2C4%2C30%2C%2645398%3D55398%2C26%2C4%2C30%2C%26111756%3D55398%2C0%2C1%2C%2C%267975%3D55398%2C0%2C1%2C10%2C%266564%3D55399%2C0%2C2%2C%2C%2661894%3D55399%2C0%2C1%2C%2C%2616386%3D55400%2C0%2C1%2C13%2C%264705%3D55416%2C0%2C1%2C29%2C%2650978%3D55421%2C0%2C1%2C28%2C%2675676%3D55421%2C0%2C1%2C28%2C%26102574%3D55421%2C0%2C1%2C28%2C%26101402%3D55421%2C0%2C1%2C28%2C%2664580%3D55421%2C0%2C1%2C28%2C%2666372%3D55421%2C0%2C1%2C28%2C%26203918%3D55421%2C0%2C1%2C28%2C%26203866%3D55421%2C0%2C1%2C28%2C%26203952%3D55421%2C0%2C1%2C28%2C%26203878%3D55421%2C0%2C1%2C28%2C%26203914%3D55421%2C0%2C1%2C28%2C%26203900%3D55421%2C0%2C1%2C28%2C%26113624%3D55442%2C0%2C1%2C29%2C; Domain=.pixel.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:27 GMT; Path=/","khaos=IMRKV2IF-1A-5DAO; Domain=.rubiconproject.com; Expires=Tue, 01-Nov-2016 20:54:27 GMT; Path=/"],"x-rphost":["tnNnTiY_nVPQbFjrxp6WVA"]},"image"]
  nightmare:log did-get-redirect-request +9ms [{},"https://r.nexac.com/e/getdata.xgi?dt=br&pkey=rowp70rowpu60&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D7c6392c9-e878-492c-8b14-bf06e3828ebd%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E","https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=7c6392c9-e878-492c-8b14-bf06e3828ebd&dlxid=2016042702425739821951529685&dlxdata=",false,302,"GET","https://society6.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=7c6392c9-e878-492c-8b14-bf06e3828ebd&dlxid=2016042702425739821951529685&dlxdata="],"server":["Apache-Coyote/1.1"]}]
  nightmare:log did-get-response-details +4ms [{},false,"https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=536f0daa-aaaa-4d9e-9a25-dde40646786a&dlxid=2016042702425739821951529685&dlxdata=","https://r.nexac.com/e/getdata.xgi?dt=br&pkey=iefs40iefsj26&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D536f0daa-aaaa-4d9e-9a25-dde40646786a%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a243-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=184 t=1462265667300298"],"x-served-by":["beacon-a243-dub.krxd.net"]},"image"]
  nightmare:log did-get-redirect-request +11ms [{},"https://r.nexac.com/e/getdata.xgi?dt=br&pkey=rsxs71rsxsk73&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3Dbb8ae0e2-9cd7-45b2-ad37-7737269627d8%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E","https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=bb8ae0e2-9cd7-45b2-ad37-7737269627d8&dlxid=2016042702425739821951529685&dlxdata=",false,302,"GET","https://society6.com/",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=bb8ae0e2-9cd7-45b2-ad37-7737269627d8&dlxid=2016042702425739821951529685&dlxdata="],"server":["Apache-Coyote/1.1"]}]
  nightmare:log did-get-response-details +1ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["838"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-encoding":["gzip"],"content-length":["1002"],"content-type":["text/css"],"date":["Tue, 03 May 2016 08:47:59 GMT"],"last-modified":["Fri, 07 Nov 2014 18:52:07 GMT"],"vary":["Accept-Encoding,User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2311823332 2311724053"]},"stylesheet"]
  nightmare:log did-get-response-details +2ms [{},false,"https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=d7158cb7-a851-4e3c-b7ab-cc9e815b2399&dlxid=2016042702425739821951529685&dlxdata=","https://r.nexac.com/e/getdata.xgi?dt=br&pkey=gwjn34gwjnh86&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3Dd7158cb7-a851-4e3c-b7ab-cc9e815b2399%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a266-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=185 t=1462265667836082"],"x-served-by":["beacon-a266-dub.krxd.net"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/dummy.png","http://www.mediamarkt.es/static/index/slider/img/dummy.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["3279"],"content-type":["image/png"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Wed, 04 May 2016 08:54:27 GMT"],"last-modified":["Fri, 08 Apr 2016 08:29:57 GMT"],"set-cookie":["TS015b134e=014cde7230f1eb1e6248752299e4c0ef394cea600b04264276f824a38b5a5e4cabde6b174d; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache02"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +16ms [{},false,"https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=7c6392c9-e878-492c-8b14-bf06e3828ebd&dlxid=2016042702425739821951529685&dlxdata=","https://r.nexac.com/e/getdata.xgi?dt=br&pkey=rowp70rowpu60&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3D7c6392c9-e878-492c-8b14-bf06e3828ebd%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a244-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=266 t=1462265667325279"],"x-served-by":["beacon-a244-dub.krxd.net"]},"image"]
  nightmare:log did-get-response-details +16ms [{},false,"https://beacon.krxd.net/data.gif?_kuid=KdjQEHAZ&_kdpid=bb8ae0e2-9cd7-45b2-ad37-7737269627d8&dlxid=2016042702425739821951529685&dlxdata=","https://r.nexac.com/e/getdata.xgi?dt=br&pkey=rsxs71rsxsk73&ru=https://beacon.krxd.net/data.gif?_kuid%3DKdjQEHAZ%26_kdpid%3Dbb8ae0e2-9cd7-45b2-ad37-7737269627d8%26dlxid%3D%3Cna_id%3E%26dlxdata%3D%3Cna_da%3E",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a219-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=169 t=1462265667871338"],"x-served-by":["beacon-a219-dub.krxd.net"]},"image"]
  nightmare:log did-get-response-details +45ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12826"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"p3p":["CP=\"This is not a P3P policy! See http://support.google.com/accounts/answer/151657?hl=en for more info.\""],"server":["Ytfe_Worker"],"set-cookie":["YSC=-ssCuWA4xQ0; path=/; domain=.youtube.com; httponly"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-redirect-request +22ms [{},"https://secure.adnxs.com/seg?add=1731327&t=2&redir=pxj","https://secure.adnxs.com/pxj",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["pxj"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/5N:5[f:4Z(+M<Md%]/Q7r^B<PuvKDu'8i>FiP0xGu@<8(e'a%qf#1]IRv(sAZ2<1A+'(:WMBB:b2H%Ht.C2hGg]]dE4n:QG`AA6yC0Psqi*)(H9U9lovMsn_j6s.7o'h8vBNEtqaK5s3ris9K19$?6gUae61(to?'v)aXtbi.DbA9n_huLQbff)oEnZS#RI:V>Q(Cc$Aas6Z1bWq)lL2H`rfAt_ivR=OqUEwzgW+R9QzCaeEMVL?%@YXA/f@b0sy0v#!K__`C:Aw2$6i4VgVY`v4m^CzbKriDFz:N7aXp>WxS4pK3-P]kN>?Na/QP^22-I6P_8XpQVNij!rA]vl(C/6g[:@S*Ca-mtOlUNKKLFLSg5[S6?c9oQ'7N5#k:fHxdP`jP[t_@lw>rV)lWl)sFnmKT</O*7eDkTLv(FT><e47N/>JI=Aj<RpX#%fpjqM=Egx=>+q!k?bml:v_H'd[KgU4VsNgBje#eS5C5QZ0gVEyX7Z'QRz_?FRRM_qg_`G<6(uWw%Zpf(pvzzBHr(gnZ)^(lmAr2xSfsDQ%(-O.C6oUBr(Ah#NnmdY5*#M>0Cx`GwR.h1_1.6UC*+>=qtpHiFm2=xQ7U?c9:Ki=.b*Vl.Di#Z*y#0RTFKTXY0zvB%'AZ^`<uqUsK.1#GqEtZvq05w#bLY$/$Ob*q3GM[@`waoCavtndo^/[@>GTl)7hyl.gl`]pkmGvObC3(6p^9:a+pc9BLM9Z`t5hc_']m%E2!Ow[:4Z>#THicgp#_32z5#jvCY0B^<yxv7RF`erN426_0NxTLP7q+Jui+5nh$mwDN?vPL-l<+Uc>5HvqFKzb6b$-44shKn_AZ)%gwy]B$QbSFBE8NHqbi/TID%1`*'e(6k^d_]N:5?T01BP4[Qn9'!ey*EV2H8:HN-3O'LQva+*jq^>_U$?:J-4nl*GBUeGh6_ILA=AM#/6H3bm$2dAV'4phri6srD_G1`4_AAurwF(s/Guj!aJrw'j[*d-PJP51cLcyzD3qdVUa/X>5@]u'`9W'n.%nBSo03O@bopP14g7<DUifXigt/y^s#Jl@<bOuaTl.^#Hr-Q^WeUn_^_ebRJn($J34NORYyd1(PNvdniF@](-#1$>NmSvF'1.go0$WRN%yt58!@rko^f(UT5R.L?fCDD`f(ZFKxeSsg(/ncFV5mV^3Rj<qcpfnwRY*9$fna@!!sD$!soPx[+ZDaS0mx5kbCFxu3uB3AhL'SON45ic[le2)?=!3rmVIF0qd9p8Q?TtwuUA(g%s:8#A@ZypG[6w'$A%v>pu=krS.@s/fl'#w++2_tKuB8wyQw?m2uiXe[?V:wYCwM/+OYz6Z:63t3VZw=vcx33bRGxdpyqgSeF; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:28 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:28 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:28 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +6ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/imgs-campaigns/20160428/botones.png","http://www.mediamarkt.es/static/index/slider/img/imgs-campaigns/20160428/botones.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["7340"],"content-type":["image/png"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Wed, 04 May 2016 08:54:27 GMT"],"last-modified":["Tue, 26 Apr 2016 16:10:59 GMT"],"set-cookie":["TS015b134e=014cde7230f1eb1e6248752299e4c0ef394cea600b04264276f824a38b5a5e4cabde6b174d; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache03"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +4ms [{},false,"https://ads.yahoo.com/pixel?id=595205&t=2","https://ads.yahoo.com/pixel?id=595205&t=2",200,"GET","",{"age":["0"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"server":["ATS"],"strict-transport-security":["max-age=0"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"http://static-rmk.blueknow.com/descriptors/BK-228300128806-7.js?cac=2016539","http://static-rmk.blueknow.com/descriptors/BK-228300128806-7.js?cac=2016539",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["70595"],"connection":["keep-alive"],"content-length":["11245"],"content-type":["application/javascript"],"date":["Mon, 18 Apr 2016 13:14:58 GMT"],"etag":["\"a5c106ba2aa45e71c1d9334ab423ae33\""],"last-modified":["Mon, 18 Apr 2016 13:09:00 GMT"],"server":["AmazonS3"],"via":["1.1 289241c3af05a479dc26e3b6a8f02210.cloudfront.net (CloudFront)"],"x-amz-cf-id":["5i6kGqnREpZ9zTLO_a_XsXX0KLeC93VUjK2EKk09T1T_H92ugz2wvQ=="],"x-amz-meta-s3cmd-attrs":["uid:501/gname:staff/uname:ameller/gid:20/mode:33188/mtime:1460984896/atime:1460984897/md5:a5c106ba2aa45e71c1d9334ab423ae33/ctime:1460984896"],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"https://secure.adnxs.com/pxj","https://secure.adnxs.com/seg?add=1731327&t=2&redir=pxj",200,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:28 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:28 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +28ms [{},false,"https://rtb-csync.smartadserver.com/redir/?partnerid=79&partneruserid=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://rtb-csync.smartadserver.com/redir/?partnerid=79&partneruserid=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["no-cache, no-store"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["-1"],"p3p":["CP=\"BUS CUR CONo FIN IVDo ONL OUR PHY SAMo TELo\""],"pragma":["no-cache"],"set-cookie":["csync=79:3c1c3f46-95fc-4602-b078-e8fce01d120e|80:qS2bhKQjydKxKM6CqnuG1_4imoGxI5PX-H-gJ2yM|86:1267099506496825196|21:13775344891926931912|23:f8qhrlnngu0wu|25:3766571f-6050-4a00-85c5-b4e4f7a521d3|68:b4f1ba33-1602-433a-bfc8-a2fc69a1b58f|49:6277842508468516888|33:VweJsblQJEMAAD-fnXMAAAAM&230|31:ed0ec49d-62d8-4c67-a4da-f48084302b86|32:7583537490505916663|88:e42e78ae1c14cde094fe0a31547885db; domain=smartadserver.com; expires=Fri, 28-Apr-2017 08:54:27 GMT; path=/"]},"image"]
  nightmare:log did-get-response-details +17ms [{},false,"https://ad.360yield.com/match?publisher_dsp_id=38&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://ad.360yield.com/match?publisher_dsp_id=38&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NOI DSP COR NID CURa ADMa DEVa PSAa PSDa OUR BUS COM INT OTC PUR STA\""],"pragma":["no-cache"],"server":["nginx/1.7.10"],"set-cookie":["tuuid=37b4ff34-c80b-4964-859c-4a55749914e3; path=/; expires=Thu, 03-May-2018 08:54:28 GMT","um=!38,FAwlb3p3N2b3yXG4NyAR1Jn-HnecDKbAVmuA6l4N2xkIHOj3SKTVSc5otfBjOkkeZKw#,1470041668!40,-TiVOYk2Nn7oSFDShm8MrofmuXqX0Y1IBOGilhiqnhK8,1469701689!261,FAwlb4RmVaMtoimi4AHtl1hEWMhkkecq5MwqSn85wSCPL43lqzZth.eWF93BZorTRuE#,1469701318!2,K-KKvZckiR1NdOX4P.zT2h6Na164v2DB02.DRsV.-EzX9w##,1469636457!201,cMXUB7s00TkfnwNxS3.r8nc.eKSo-razXOnO2sUxh2Mh,1469627534!60,5ygtlWVNV30NtVdTErRevDM4CbMZ1eDwQjowvM7cRlWW,1469627534!37,ksDwO5hQSLVsin2uQaOTzpFzVJPZp6PlbGgy96TEqs3vmXIPINK.H4FrCGYTbh-0jiw#,1469627534!191,rZjGRY66x1ufp4Z6hpEYOZc3QaTtQBmKllKKu4.iR5ZShlMgfcgjBXiZof0jRNemwQw#,1469627533!4,cEALtEC4Q6XleCkuumyQxroObbwZ9H52uFA6X9PejHkX,1469627250!55,ifqTEWgy5FyS0f3qzl0X9VlrS7ZOVlK4pUYocH7S8mOPF-SqnZp1L4g#,1469627248!125,fbeGOsmR1nRrHlWcnoMMXkHfxc.IbuhbCi9zuEiTuMkncWM6.-Ajj3Q#,1469546055!63,kTzinT9YEqiQsaIfr45AvaD8t98gxyd.u9Jm-UQ#,1469543483!5,djOCsdFliqilrE.0n6AmHPD9ya8Od94-KxGpdHIRceQkKGnBFz.7LX8lOCQXvZhajLk#,1469541810!35,x9N2XedQN4CBf58EX2l0To8K4GIx5vImjxSk,1469537486!75,i-pzCSOvW.JsSR08tB02DvaAbJ2C.BukxVIhfV6LnT3npd.4Bs4p8QJ5XejnPw##,1469535683!69,UPB8S59krs.WmXnxq-ulCwyFw5Hhdj8rUQqYBAKpwzXT391KA7QJ-S.p-kLcofRp9og#,1462962082!167,A1uuSRbvY.A9gQTMBRgXdXlXK7da6mSjQM21D0yyjfu2LNu8MnD412iEcwkt8kTVYm8#,1469528482!42,rIg0P.lQvWDPKluBVvgRX9lr3kBtRXriYiC3LaF4kHRJ,1469528482!254,Z9AjiAUVjfMqCsM.IDQQryCnkRDyaHyHiHv9a.HQLJDJHDn9mlUme5oHJ3aX--79sWIKPpjj,1469448219; path=/; expires=Mon, 01-Aug-2016 08:54:28 GMT","umeh=!38,0,293716468,-1!40,0,293376489,-1!261,0,293376118,-1!2,0,293311257,-1!201,0,293302334,-1!60,0,293302334,-1!37,0,293302334,-1!57,0,293302333,-1!191,0,293302333,-1!4,0,293302050,-1!55,0,293302048,-1!125,0,293220855,-1!63,0,293218283,-1!5,0,293216610,-1!35,0,293212286,-1!75,0,293203283,-1!61,0,293203283,-1!69,0,293203283,-1!167,0,293203282,-1!81,0,293203282,-1!42,0,293203282,-1!254,0,293123019,-1; path=/; expires=Mon, 01-Aug-2016 08:54:28 GMT"]},"image"]
  nightmare:log did-get-redirect-request +23ms [{},"https://cms.analytics.yahoo.com/cms?partner_id=KRUX","https://beacon.krxd.net/usermatch.gif?partner=yhoo&partner_uid=DLlmOK0_nqtzAyZWecXToQ8QzJoftQDnXYIX.iApM_I-",false,302,"GET","https://society6.com/",{"age":["0"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html;charset=utf-8"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://beacon.krxd.net/usermatch.gif?partner=yhoo&partner_uid=DLlmOK0_nqtzAyZWecXToQ8QzJoftQDnXYIX.iApM_I-"],"server":["ATS"]}]
  nightmare:log did-get-response-details +3ms [{},false,"https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NOI DSP COR NID CURa ADMa DEVa PSAa PSDa OUR BUS COM INT OTC PUR STA\""],"pragma":["no-cache"],"server":["nginx/1.7.10"],"set-cookie":["tuuid=ed0ec49d-62d8-4c67-a4da-f48084302b86; path=/; expires=Wed, 03-May-2017 08:54:28 GMT; domain=.bidswitch.net"]},"image"]
  nightmare:log did-get-response-details +6ms [{},false,"https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.3","https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.3",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["public, max-age=1200, stale-while-revalidate=3600"],"content-encoding":["gzip"],"content-length":["56384"],"content-md5":["lU6tIgC7kNjxJY0a2F8gZw=="],"content-type":["application/x-javascript; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"etag":["\"e0b4909839cf7657221a468ea68cd9aa\""],"expires":["Tue, 03 May 2016 09:02:29 GMT"],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"timing-allow-origin":["*"],"vary":["Accept-Encoding"],"x-fb-debug":["cbWkqwSFBFx2xc3Czqryu/uyoAH7bq3jJAYN2M04q6sOanLq96IyI2hUkmTl6f/cai57CSiwniFwEe+ubdAQ6g=="]},"script"]
  nightmare:log did-get-response-details +15ms [{},false,"https://beacon.krxd.net/usermatch.gif?partner=yhoo&partner_uid=DLlmOK0_nqtzAyZWecXToQ8QzJoftQDnXYIX.iApM_I-","https://cms.analytics.yahoo.com/cms?partner_id=KRUX",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a254-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=182 t=1462265667545932"],"x-served-by":["beacon-a254-dub.krxd.net"]},"image"]
  nightmare:log did-get-response-details +30ms [{},false,"https://bh.contextweb.com/bh/rtset?do=add&pid=538064&ev=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://bh.contextweb.com/bh/rtset?do=add&pid=538064&ev=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"accept-ranges":["bytes"],"cache-control":["private, max-age=0, no-cache, no-store"],"connection":["keep-alive"],"content-language":["en-US"],"content-type":["image/gif; charset=ISO-8859-1"],"cw-server":["ams-bh02"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["-1"],"p3p":["policyref=\"/bh/w3c/p3p.xml\", CP=\"NOI DSP COR NID CURa DEVa PSAa OUR BUS COM NAV INT\""],"server":["Jetty(9.2.3.v20140905)"],"set-cookie":["V=9FewimNlq3DK;Path=/;Domain=.contextweb.com;Expires=Fri, 28-Apr-2017 08:54:28 GMT","pb_rtb_ev=3-8wv|14W.o.f8qhrlnngu0wu|6zB.o.ed0ec49d-62d8-4c67-a4da-f48084302b86|79f.0.kDMeqp09TPyINkusk2UD-cc8H6-IPRb5wWHqZsxv|-5.q.292E025B-E1CA-5ECD-B227-53CDF7ACE4D7|7dW.m.1|1ea.k.7583537490505916663|aE.m.o8c9ne5ehnoi|3XO.18.1267099506496825196|7aw.Q.1|4Ec.k.83d6edbb5db441b79f6e0387d69f5aa3|7fK.o.1|17m.r.EXEeQAZQ1AOywc5|1U9.2E.3c1c3f46-95fc-4602-b078-e8fce01d120e|3qC.o.e93f197308321213-060e064510f8fc2d|0.q.3766571f-6050-4a00-85c5-b4e4f7a521d3;Path=/;Domain=.contextweb.com;Expires=Wed, 01-Jun-2016 08:54:28 GMT","sto-id-20480-bh=DJANNMAKJBBP; Domain=contextweb.com; Expires=Tue, 03-May-2016 09:09:27 GMT; Path=/"],"transfer-encoding":["chunked"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-cache-hits":["0"],"x-served-by":["cache-lhr6339-LHR"]},"image"]
  nightmare:log did-get-response-details +19ms [{},false,"https://match.adsrvr.org/track/cmf/generic?ttd_pid=krux&ttd_tpi=1","https://match.adsrvr.org/track/cmf/generic?ttd_pid=krux&ttd_tpi=1",200,"GET","https://society6.com/",{"cache-control":["private,no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["70"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"p3p":["CP=\"NOI DSP COR CUR ADMo DEVo PSAo PSDo OUR SAMo BUS UNI NAV\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"set-cookie":["TDID=4a61710e-63ae-4def-8ca5-734dc833a919; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/","TDCPM=CAESFwoIZmFjZWJvb2sSCwiwjZvH7OjvMxAFEhkKCmktYmVoYXZpb3ISCwikvd3M6+jvMxAFEhQKBXRhcGFkEgsIiNzE5ezo7zMQBRIZCgpkcmF3YnJpZGdlEgsIhu/q5ezo7zMQBRIWCgdhZGJyYWluEgsI9Iin6uzo7zMQBRIWCgdibHVla2FpEgsIuue21e6J+DMQBRIWCgdydWJpY29uEgsIiOns/PXo7zMQBRIXCghwdWJtYXRpYxILCPKmwdH26O8zEAUSFQoGY2FzYWxlEgsI1qb+ncCg9zMQBRIZCgpzdGVlbGhvdXNlEgsIypbtwv7i9zMQBRIVCgZnb29nbGUSCwi67KC+v6D3MxAFEhgKCWJpZHN3aXRjaBILCICDhqjE8+8zEAUSGAoJbW9va2llLXBzEgsIuvqHy9Xz7zMQBRIYCgljcm9zc3dpc2USCwjcw+De1/PvMxAFEhgKCVF1YW50Y2FzdBILCPaN+q6W9fYzEAUSFgoHYWRkdGhpcxILCODP+Y+k9vYzEAUSGQoKcmlnaHRtZWRpYRILCIC1y+yMq+wzEAUSFwoIYXBwbmV4dXMSCwjczKbl4In4MxAFEhIKA2FhbRILCPrO2Pek9vYzEAUSFgoHZXhlbGF0ZRILCKzPm/ek9vYzEAUSFgoHbmV1c3RhchILCMyP4fyk9vYzEAUSFQoGbW9va2llEgsIhL6m5K329jMQBRIYCglhb2xhZHRlY2gSCwiEvqbkrfb2MxAFEhQKBXNwb3R4EgsIvOiNmK729jMQBRIYCglzdGlja3lhZHMSCwj8sM+10/v2MxAFEhUKBmFkYXB0dhILCK6Hjp2Y/PYzEAUSFAoFb3BlbngSCwie7YbBnqD3MxAFEhUKBmFkbWFucxILCPT1tsK/oPczEAUSGgoLc21hcnRzdHJlYW0SCwjM+sGZv6D3MxAFEh0KDnNtYXJ0LWFkc2VydmVyEgsIjvbTleeJ+DMQBRIVCgZzb25vYmkSCwior43PyKD3MxAFEhUKBmxvdGFtZRILCIzNxa+2ofczEAUSFwoIbGl2ZXJhbXASCwjShr/xt6H3MxAFEhQKBXRlYWRzEgsIrOjptqWu9zMQBRIdCg5mZWRlcmF0ZWRtZWRpYRILCIqG+86VpfczEAUSGAoJYWRhZHZpc29yEgsIkJba9I6s9zMQBRIaCgthcmV5b3VodW1hbhILCJ6i1I6RrPczEAUSGwoMY2hvaWNlc3RyZWFtEgsI2tqko6qs9zMQBRIWCgdyYWt1dGVuEgsIyLX/2euJ+DMQBRIZCgpjcm9zc3BpeGVsEgsImMWls7Ou9zMQBRgFOAFCBCICCAFSGQoKaS1iZWhhdmlvchILCJiRuvPD8+8zEAVSFgoHYWRicmFpbhILCJiRuvPD8+8zEAVSFAoFdGFwYWQSCwiYkbrzw/PvMxAFUhkKCmRyYXdicmlkZ2USCwjYwtS81/PvMxAFUhYKB2JsdWVrYWkSCwjYwtS81/PvMxAFUhUKBmNhc2FsZRILCNjC1LzX8+8zEAVSGAoJY3Jvc3N3aXNlEgsIkJCIoIj17zMQBVIXCghwdWJtYXRpYxILCJCQiKCI9e8zEAVSFQoGZ29vZ2xlEgsIkJCIoIj17zMQBVIXCghmYWNlYm9vaxILCNK1xomW9fYzEAVSGAoJYmlkc3dpdGNoEgsI0rXGiZb19jMQBVIYCgltb29raWUtcHMSCwjStcaJlvX2MxAFUhYKB3J1Ymljb24SCwi05cqhmvX2MxAFag5Vbml0ZWQgS2luZ2RvbQ==; domain=.adsrvr.org; expires=Wed, 03-May-2017 08:54:30 GMT; path=/"],"x-aspnet-version":["4.0.30319"]},"image"]
  nightmare:log did-get-response-details +22ms [{},false,"https://eb2.3lift.com/xuid?mid=2711&xuid=3c1c3f46-95fc-4602-b078-e8fce01d120e&dongle=013b","https://eb2.3lift.com/xuid?mid=2711&xuid=3c1c3f46-95fc-4602-b078-e8fce01d120e&dongle=013b",200,"GET","",{"cache-control":["no-store, no-cache, private, must-revalidate, max-age=0, s-maxage=0"],"connection":["keep-alive"],"content-length":["37"],"content-type":["image/gif"],"p3p":["policyref=\"http://cdn.3lift.com/w3c/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"set-cookie":["tluid=14010532894904516244; Max-Age=7776000; Expires=Mon, 01 Aug 2016 08:54:28 GMT; Path=/; Domain=.3lift.com"],"x-rev":["4976cc1"],"x-served-by":["eb3.europe.prod"]},"image"]
  nightmare:log did-get-response-details +13ms [{},false,"https://px.steelhousemedia.com/tdsync?tdid=4a61710e-63ae-4def-8ca5-734dc833a919","https://match.adsrvr.org/track/cmf/generic?ttd_pid=steelhouse&ttd_tpi=1",200,"GET","https://teamtreehouse.com/",{"connection":["close"],"content-encoding":["gzip"],"content-type":["application/javascript;charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["CP=\"NON DSP COR NID CURa ADMa DEVa PSAa PSDa OUR STP UNI COM NAV INT STA PRE\""]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://simage2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTE5MjgmdGw9NDMyMDA=&piggybackCookie=uid:3c1c3f46-95fc-4602-b078-e8fce01d120e","https://simage2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTE5MjgmdGw9NDMyMDA=&piggybackCookie=uid:3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["no-store, no-cache, private"],"connection":["close"],"content-length":["42"],"content-type":["image/gif; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["CP=\"NOI DSP COR LAW CUR ADMo DEVo TAIo PSAo PSDo IVAo IVDo HISo OTPo OUR SAMo BUS UNI COM NAV INT DEM CNT STA PRE LOC\""],"pragma":["no-cache"],"server":["Apache/2.2.24 (Unix) mod_ssl/2.2.24 OpenSSL/1.0.1e-fips mod_fastcgi/2.4.6"],"set-cookie":["KRTBCOOKIE_97=3385-uid:3c1c3f46-95fc-4602-b078-e8fce01d120e; domain=pubmatic.com; expires=Thu, 02-Jun-2016 08:54:28 GMT; path=/","PUBRETARGET=2626_1556296502; domain=pubmatic.com; expires=Fri, 26-Apr-2019 16:35:02 GMT; path=/","PUBMDCID=3; domain=pubmatic.com; expires=Mon, 01-Aug-2016 08:54:28 GMT; path=/"],"x-lat":["Pug22041:0:837"]},"image"]
  nightmare:log did-get-response-details +17ms [{},false,"https://specials.mediamarkt.es/chat/css/style.css","https://specials.mediamarkt.es/chat/css/style.css",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["11888"],"content-type":["text/css"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"etag":["\"2e70-52fa6249de515\""],"expires":["Tue, 17 May 2016 08:54:28 GMT"],"last-modified":["Mon, 04 Apr 2016 10:25:08 GMT"],"server":["Apache"],"x-served-by":["web01"]},"stylesheet"]
  nightmare:log did-get-redirect-request +10ms [{},"https://pixel-geo.prfct.co/cs/?partnerId=yah","https://ads.yahoo.com/pixel?id=2539961&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fnwid%3D10001073209%26eid%3Dpa_u4rLyvTcCEMlB369J%26sigv%3D1%26esig%3D2%7E7d48dff57cf007a4997e2f8d04aeb38b84202f64",false,302,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["0"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://ads.yahoo.com/pixel?id=2539961&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fnwid%3D10001073209%26eid%3Dpa_u4rLyvTcCEMlB369J%26sigv%3D1%26esig%3D2%7E7d48dff57cf007a4997e2f8d04aeb38b84202f64"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT","pa_yahoo_ts=1462265668170;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT"]}]
  nightmare:log did-get-response-details +5ms [{},false,"https://js-agent.newrelic.com/nr-918.min.js","https://js-agent.newrelic.com/nr-918.min.js",200,"GET","https://teamtreehouse.com/",{"accept-ranges":["bytes"],"cache-control":["public, max-age=3600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["8668"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"etag":["\"07fddb3720b5e77e10d486281e40571d\""],"last-modified":["Mon, 28 Mar 2016 18:05:52 GMT"],"server":["AmazonS3"],"vary":["Accept-Encoding"],"via":["1.1 varnish"],"x-amz-id-2":["3IhOCqiuFS++bjx9vWXECygJbH9uu+1DzArThUvxxqV/Yl9zilMOloOybrXVZZPenEUxEPVKI4s="],"x-amz-request-id":["A720618EE0E50170"],"x-cache":["HIT"],"x-cache-hits":["52643"],"x-served-by":["cache-lcy1124-LCY"],"x-timer":["S1462265668.176868,VS0,VE0"]},"script"]
  nightmare:log did-get-response-details +6ms [{},false,"https://idsync.rlcdn.com/362338.gif?partner_uid=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://idsync.rlcdn.com/362338.gif?partner_uid=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["no-cache, no-store"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif; charset=ISO-8859-1"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP: \"NON DSP COR PSDo SAMo BUS IND UNI COM NAV INT POL PRE\""],"set-cookie":["rlas3=\"aYcdF7IRQasPGwf7fkkGDLTOCtoDLiIINzZ0K0q19y+MyA9jEACu5w==\";Version=1;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:28 GMT;Max-Age=15552000","rtn1=0b4469f2f9f556c408a3512ca214fd60f397ab0062992523e889e11aa52b4ba99566af2ff4679f4f6e3ca272fb90a8e5e1135f323e4294866dd31f532b2a382569298b4cc637dbc9;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:28 GMT","dids2068734721=;Domain=.rlcdn.com;Expires=Thu, 01-Jan-1970 00:00:00 GMT","dids620263050=81a72ee3e7b2100a4443fc3bc074f5bb690f5226d8213585359e27517646e78b4b92852987219490fdcbcebfd1d4e935ab7df354206743de4a4cd1ef3d825b4bfb3e42f990759e1b51a014febdc1cedfbb292a04cacd5c6ad4909b190ba11714c633986ca82094e2ef5a67ccff0a088a17233073c77cf1bc8bc1ce5686bce3490214a7b4aca8ea439ce1ce1abbfe848bebc2f092a684b7de;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:24 GMT"]},"image"]
  nightmare:log did-get-response-details +5ms [{},false,"https://d3cxv97fi8q177.cloudfront.net/mediasource-A187849-72ad-44c6-83bc-3d4f458b85e71.js","https://d3cxv97fi8q177.cloudfront.net/mediasource-A187849-72ad-44c6-83bc-3d4f458b85e71.js",200,"GET","https://teamtreehouse.com/",{"age":["172"],"cache-control":["max-age=300"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-type":["text/javascript"],"date":["Thu, 31 Mar 2016 03:56:44 GMT"],"last-modified":["Wed, 25 Nov 2015 00:15:48 GMT"],"server":["AmazonS3"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding"],"via":["1.1 6516f52a94629c649ba7aed438a3e8bf.cloudfront.net (CloudFront)"],"x-amz-cf-id":["qJZP2B8-QghP3TUniWvkx2gF-L_lXnijRvgHp7tnsYgIgt0v7oFFbQ=="],"x-amz-version-id":["OmFh3BGOeM2l.YlxOMdT6rFUE2nqk07G"],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +1ms [{},false,"https://srv.clickfuse.com/pixels/create.php?name=criteo&expire=30","https://srv.clickfuse.com/pixels/create.php?name=criteo&expire=30",200,"GET","",{"cache-control":["no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 26 Jul 1997 05:00:00 GMT"],"server":["Apache/2.4.10 (Unix) OpenSSL/1.0.1h"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://gum.criteo.com/sync?c=6&r=1&a=1&u=https%3A%2F%2Fidsync.rlcdn.com%2F397596.gif%3Fpartner_uid%3D%40USERID%40","https://idsync.rlcdn.com/397596.gif?partner_uid=x1uyN4P7CprNmZc-H2ikHgBfaEu4wFDU",false,302,"GET","",{"cache-control":["private, max-age=0, no-cache, no-store, must-revalidate"],"content-length":["197"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"location":["https://idsync.rlcdn.com/397596.gif?partner_uid=x1uyN4P7CprNmZc-H2ikHgBfaEu4wFDU"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]}]
  nightmare:log did-get-redirect-request +1ms [{},"https://pixel-geo.prfct.co/cs/?partnerId=opx","https://us-u.openx.net/w/1.0/sd?id=537114372&val=pa_u4rLyvTcCEMlB369J",false,302,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["0"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://us-u.openx.net/w/1.0/sd?id=537114372&val=pa_u4rLyvTcCEMlB369J"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT","pa_openx_ts=1462265668188;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT"]}]
  nightmare:log did-get-redirect-request +13ms [{},"https://pixel-geo.prfct.co/cs/?partnerId=pub","https://image2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTMyNDMmdGw9MTI5NjAw&piggybackCookie=uid:pa_u4rLyvTcCEMlB369J",false,302,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["0"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://image2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTMyNDMmdGw9MTI5NjAw&piggybackCookie=uid:pa_u4rLyvTcCEMlB369J"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT","pa_pubmatic_ts=1462265668202;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT"]}]
  nightmare:log did-get-response-details +14ms [{},false,"https://pub.weatherbug.com/RealMedia/ads/adstream.cap/123?c=crwe&va=1&e=30d","https://pub.weatherbug.com/RealMedia/ads/adstream.cap/123?c=crwe&va=1&e=30d",200,"GET","",{"cache-control":["no-cache,no-store,private"],"connection":["Keep-Alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Fri, 30 Oct 1998 14:19:41 GMT"],"keep-alive":["timeout=60"],"p3p":["CP=\"NON NID PSAa PSDa OUR IND UNI COM NAV STA\",policyref=\"/w3c/p3p.xml\""],"pragma":["no-cache"],"server":["Apache/2.2.15 (CentOS)"],"set-cookie":["crwe=1; path=/; expires=Thu, 02-Jun-16 08:54:29 GMT; domain=.weatherbug.com","NSC_pbt.d18ef_c_wtfswfs_ttm=ffffffff090b8e5a45525d5f4f58455e445a4a423660;expires=Tue, 03-May-2016 08:56:29 GMT;path=/;secure;httponly"]},"image"]
  nightmare:log did-get-redirect-request +4ms [{},"https://sp.analytics.yahoo.com/spp.pl?a=10001287818027&.yp=39872&js=no","https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1",false,302,"GET","",{"age":["0"],"cache-control":["no-cache, private, must-revalidate"],"connection":["keep-alive"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1"],"pragma":["no-cache"],"server":["ATS"],"transfer-encoding":["chunked"],"via":["http/1.1 spdc0021.pbp.ir2.yahoo.com (ApacheTrafficServer)"]}]
  nightmare:log did-get-response-details +8ms [{},false,"https://secure.adnxs.com/seg?t=2&add=4728398","https://secure.adnxs.com/seg?t=2&add=4728398",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/67@BbYLGNLv?9Wd$08H']!I>e)Pu^Oz_19o/)l??7EB-.f=C`M/U*tGy(5G0?3d2RSwejAyZdO9V!S=tQHf?p+A0*E%K/A[C%neJPgNw!vqva%Y-`VNs:0`H@a7Vdr8uLE=K#$fEXH4%z_!OTLN^16Lb70Q47hbTwg2.0r%@]A%.tEMy`M:=ffhNvB24bJ0dRhLN:D>oKkn*?8/U]PE#Hm)gSvQVNFdaU2R@rRz=*LBu5#FV7%n5uq4hQ.1jwM8[b#>NVhW::j(Gpg2th$hI5uCX2l_7NVM%X]]m8:=3jW-E6XJ92uZo4=FD%shQR=_Ex#a66Cl4EQs3oI8h*Je*U+NKp.yp6/BdMNNoVA!@w@+9wD%*bPuaPMuv#-dF=TX+%vMf(cMIO8`XhmPWlZ@fLvCK*#$PVZS*9AymGD<n+s.o61(+j196?78kB[0G-um?svx#6X1m4T@2EhVcyd(0c]aqjE(UHkS$^I6SW$/7i94+IVlx+jbH@ZIeLZQXF3[=Y*E@:vX=-qafk@a_3.*2vWb`?I9`l!g8M0)'Jye=ajq%5@DwVd+oW7f`YyPoYuYQ<-L#.0stUJ-WXY57N2Tx<8`/1+!88.VQpo3E)Ts%m(PBJuOISg%/2j#y5S$Y'IIs-(%qw^+_S*qnS4VC-%)u#mf3>1I(O0b_)F2W.-gUz>9+4uA]OBt-44Zr3PsT/4:E>Ba%8:QsFOJ#Q23_-Dw7Y?IoJb%gKJw*lv7T^r*S@@Gq:PQ#M@z%6snq5g0x1WDdjPLYjc2*>4bq#sS*nvEAI>Q:*T!UV*?05n5o_Q_$$@lf>Z'[#A8y$4DO9Avbz%tlAkr[hJ2CES0jcsor#>ZVH#ERelCMK^3'SUHPgYOf=>Gs%QG1]?<zWS=)'B*3ht#3W<9F#5U?h4P6o`gTb[BAY`-`HC?Wb9WB_#+=%hcDMQ*rYfo+?#t7OKu)`#HIG_>ubVRCSp`ZRq?#H4EZxAzN3[7$#@^rag=@vET>x@I5HtRQ>tDL+cM:[`jdq_7^`n[5j.t]S3pL-^=3^_g4EHn%2f55MeyGDt8k43SPE'<Tu]GFQA8BP6ckkR^/rAb=dycLP.#zlPb>Nu6!WF/`O=Sr^Ak^Ls8[!(xLo_%#k!'U?t>WQ!OJ(b`#/XP4-MgZD/uBEpU:*9Fq4X8^-1f/ey*91*r%q%6d'3YK<4+lZWSW@xaS7t+i/nM3>0$)nD]AnGEF@X99XB($^cOIO@LsJT.onBZ'Z*De?.mdMUs?TX_*ooa0xp@'<WcY5_:@7pACLWAP2mIx?c+9wmbwC-3FWvSVYs=[h7dNUJ+FA'@g=b=d?:h03c8@>3I^I%BLQ<b1jMw(yU$6w]tw>42cdwwHnE.bNJE; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-redirect-request +8ms [{},"https://trc.taboola.com/sg/criteo/1/rtb/","https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510",false,302,"GET","",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510"],"server":["nginx/1.7.9"],"set-cookie":["t_gid=ebcb6f30-52c1-4304-a818-479428e6e510;Path=/;Domain=.taboola.com;Expires=Wed, 03-May-2017 08:54:28 GMT","taboola_usg=EgIIARoMCOSpPhCGkD8QzKg_;Path=/;Domain=.taboola.com;Expires=Wed, 03-May-2017 08:54:28 GMT"],"x-cdn":["Served-By-Akamai"]}]
  nightmare:log did-get-redirect-request +8ms [{},"https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1","https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved",false,302,"GET","",{"age":["0"],"cache-control":["private"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/plain; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved"],"p3p":["policyref=\"https://policies.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-redirect-request +8ms [{},"https://ads.yahoo.com/pixel?id=2539961&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fnwid%3D10001073209%26eid%3Dpa_u4rLyvTcCEMlB369J%26sigv%3D1%26esig%3D2%7E7d48dff57cf007a4997e2f8d04aeb38b84202f64","https://ads.yahoo.com/cms/v1?nwid=10001073209&eid=pa_u4rLyvTcCEMlB369J&sigv=1&esig=2~7d48dff57cf007a4997e2f8d04aeb38b84202f64",false,302,"GET","https://teamtreehouse.com/",{"age":["0"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://ads.yahoo.com/cms/v1?nwid=10001073209&eid=pa_u4rLyvTcCEMlB369J&sigv=1&esig=2~7d48dff57cf007a4997e2f8d04aeb38b84202f64"],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +5ms [{},false,"https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510","https://trc.taboola.com/sg/criteo/1/rtb/",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +13ms [{},false,"https://r.casalemedia.com/rum?cm_dsp_id=20&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://r.casalemedia.com/rum?cm_dsp_id=20&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["max-age=0, no-cache, no-store"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"NOI DSP COR DEVa TAIa OUR BUS UNI\""],"pragma":["no-cache"],"server":["Apache"],"set-cookie":["CMID=VweJsblQJEMAAD-fnXMAAAAM;domain=casalemedia.com;path=/;expires=Wed, 03 May 2017 08:54:28 GMT","CMPS=230;domain=casalemedia.com;path=/;expires=Mon, 01 Aug 2016 08:54:28 GMT","CMSC=VyhnRA**;domain=casalemedia.com;path=/;","CMST=VyhnRFcoZ0QA;domain=casalemedia.com;path=/;expires=Wed, 04 May 2016 08:54:28 GMT","CMDD=;domain=casalemedia.com;path=/;expires=Wed, 04 May 2016 08:54:28 GMT","CMRUM3=5a57207b9f2760385A17C635841F57E54DB8A5027F7A36&4757233ec82760Vx9gfgAAAOSh2ClB.CAESEMGrg4fdcD0Iz9oc6OSeD-8&46572092a227604a61710e-63ae-4def-8ca5-734dc833a919&0257207e512760df726fda-73ce-4fdd-b89a-dab3aa834689&4857207c2427600a5a7a1a-0c54-11e6-be90-1217c0005024&1e57233ed102d00fffa78e-0c53-11e6-a8c0-00259035d5c6&6457207e512760c40f2bcde3ce1d7c4e0a563e738c6986&375723375b2760e93f197308321213-060e064510f8fc2d&525722373e05a00&1b57209ad32760o8c9ne5ehnoi&1c572092a22760d2102eb9-8710-48bf-c845-7039e545c8b8&3957233e452760637611197687692908&2857207e51276043920645-1924-4c24-b9ef-d255c146531d&3d5720b5ce2760f8qhrlnngu0wu&e65720c95e27600&145728674427603c1c3f46-95fc-4602-b078-e8fce01d120e&c95720c95ec3500&0a5720e83b276000000000-0000-0000-0000-0019a001487d&1f57207e512760Q5149698171652853682&35572337a127603c1c3f46-95fc-4602-b078-e8fce01d120e&cf5720c95e05a00&4f57207e512760c16bc0ae-7571-4cb2-946d-b7b5affa1868&3057207c00276083d6edbb5db441b79f6e0387d69f5aa3&cd5720c95e05a00&2a5720e7fe2760292E025B-E1CA-5ECD-B227-53CDF7ACE4D7&4d57207ba027608715c8d2f9a57a5e34d8adfc3aa00bcb&2e5720e86327601267099506496825196&605722374027606348_69214&415722373e05a0AQENMGwVbfC5GAEBAQErAQEBAQE&6957233e852760YzgyY2Y4NmE3ODcwMjcwMWRiODY3NjRkZWQ3NTVjOGU&2757207b9f27604a61710e-63ae-4def-8ca5-734dc833a919&4057207c252760b4f1ba33-1602-433a-bfc8-a2fc69a1b58f&035720c6b427603766571f-6050-4a00-85c5-b4e4f7a521d3&24572336e927603c1c3f46-95fc-4602-b078-e8fce01d120e&61572092a22760BGkrb3qlTINR5b6yC6R807EFtuCx&29572092a227600a5a7a1a-0c54-11e6-be90-1217c0005024&d35720c95e27600&2f57207c252760EXEeQAZQ1AOywc5&265720c8b42760f8qhrlnngu0wu&51571f84382760vwFdvLIPD-qnBAi6vFdA7-gOXLmnD1Xv7lNTCWP5&0457207ba127607583537490505916663&425722381f0001jd300014616742420094&495722373b05a00&2d5720b3f12760CAESEJGJzo-UXsYmtjRLiLwZtCU&3e5722381f0001jd300014616742420094&3657223869276013775344891926931912;domain=casalemedia.com;path=/;expires=Wed, 03 May 2017 08:54:28 GMT"]},"image"]
  nightmare:log did-get-redirect-request +2ms [{},"https://ads.yahoo.com/cms/v1?nwid=10001073209&eid=pa_u4rLyvTcCEMlB369J&sigv=1&esig=2~7d48dff57cf007a4997e2f8d04aeb38b84202f64","https://pixel.prfct.co/cb?partnerId=yah&eid=pa_u4rLyvTcCEMlB369J&xid=uRKcddha9HT2Kfa7DdPYTfdP",false,302,"GET","https://teamtreehouse.com/",{"age":["0"],"cache-control":["private"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/plain; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://pixel.prfct.co/cb?partnerId=yah&eid=pa_u4rLyvTcCEMlB369J&xid=uRKcddha9HT2Kfa7DdPYTfdP"],"p3p":["policyref=\"https://policies.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +7ms [{},false,"https://idsync.rlcdn.com/397596.gif?partner_uid=x1uyN4P7CprNmZc-H2ikHgBfaEu4wFDU","https://gum.criteo.com/sync?c=6&r=1&a=1&u=https%3A%2F%2Fidsync.rlcdn.com%2F397596.gif%3Fpartner_uid%3D%40USERID%40",200,"GET","",{"cache-control":["no-cache, no-store"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif; charset=ISO-8859-1"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP: \"NON DSP COR PSDo SAMo BUS IND UNI COM NAV INT POL PRE\""],"set-cookie":["rlas3=\"aYcdF7IRQasPGwf7fkkGDLTOCtoDLiIINzZ0K0q19y+MyA9jEACu5w==\";Version=1;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:25 GMT;Max-Age=15551997","rtn1=0b4469f2f9f556c408a3512ca214fd60f397ab0062992523e889e11aa52b4ba99566af2ff4679f4f6e3ca272fb90a8e5e1135f323e4294866dd31f532b2a382569298b4cc637dbc9;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:25 GMT","dids620263050=;Domain=.rlcdn.com;Expires=Thu, 01-Jan-1970 00:00:00 GMT","dids1262906664=c8815fab46bf252ddbedef106257547d8f11b0d4d02f092d413c1f5f903b819b9898f0bb0721bacc59867f10c2dc8333cbffc3a454645f9bf2fc836fd11080a13b6128c73b0d527b28e3a4fd0fe118de655e504e31de65d5a55774a7b6f169faaf844bee998553c9045ce198c52107507415534a6ad6c01e244cbf5872499d1c117a423b7a4670921693a7dfadc08e9d455bd1a30291838fa7ad948d2b195f237c5e876fe7afe95256a7ede0f60fbb523819c78efd3af407650b3311c73efa1e1b25f0d6f8822d14;Domain=.rlcdn.com;Expires=Sun, 30-Oct-2016 08:54:24 GMT"]},"image"]
  nightmare:log did-get-response-details +3ms [{},false,"https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=14","https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=14",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["0"],"p3p":["CP=\"NOI CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Rubicon Project"],"set-cookie":["rpb=8981%3D1%265421%3D1%266359%3D1%266434%3D1%26189868%3D1%269019%3D1%2613368%3D1%2612244%3D1%266433%3D1%2613466%3D1%2613508%3D1%2612370%3D1%2612368%3D1%267884%3D1%267883%3D1%267882%3D1%26112468%3D1%2613746%3D1%2613752%3D1%2613750%3D1%2612372%3D1%26194538%3D1%264894%3D1%264222%3D1%267249%3D1%2611203%3D1%2631950%3D1%2613490%3D1%2670596%3D1%267751%3D1%267727%3D1%2671604%3D1%26183462%3D1%266286%3D1%2682080%3D1%26186028%3D1%262372%3D1%26203184%3D1%26215638%3D1%26108792%3D1%26212364%3D1%26143762%3D1%26143760%3D1%26212368%3D1%26159872%3D1%262374%3D1%2614965%3D1%2617149%3D1%265364%3D1%269073%3D1%2650194%3D1%26100834%3D1%26144598%3D1%2614459%3D1%2615796%3D1%267859%3D1%267935%3D1%2642062%3D1%2616728%3D1%26109108%3D1%2645396%3D1%2645392%3D1%2617255%3D1%26124944%3D1%264210%3D1%2697126%3D1%2645398%3D1%26111756%3D1%267975%3D1%266564%3D1%2661894%3D1%2616386%3D1%264705%3D1%2650978%3D1%2675676%3D1%26102574%3D1%26101402%3D1%2664580%3D1%2666372%3D1%26203918%3D1%26203866%3D1%26203952%3D1%26203878%3D1%26203914%3D1%26203900%3D1%26113624%3D1; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:28 GMT; Path=/","put_2054=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Tue, 17-May-2016 08:54:27 GMT; Path=/","rpx=8981%3D54938%2C434%2C3%2C%2C%265421%3D54938%2C598%2C63%2C%2C%266359%3D54938%2C504%2C17%2C%2C%266434%3D54938%2C504%2C71%2C%2C%26189868%3D54938%2C0%2C1%2C%2C%269019%3D54943%2C455%2C6%2C%2C%2613368%3D54943%2C498%2C8%2C%2C%2612244%3D54943%2C498%2C14%2C%2C%266433%3D54943%2C499%2C42%2C%2C%2613466%3D54943%2C498%2C13%2C%2C%2613508%3D54943%2C498%2C8%2C%2C%2612370%3D54943%2C499%2C12%2C%2C%2612368%3D54943%2C478%2C5%2C%2C%267884%3D54943%2C499%2C16%2C%2C%267883%3D54943%2C499%2C22%2C%2C%267882%3D54943%2C498%2C8%2C%2C%26112468%3D54943%2C499%2C24%2C%2C%2613746%3D54944%2C498%2C21%2C%2C%2613752%3D55372%2C70%2C17%2C%2C%2613750%3D55372%2C70%2C8%2C%2C%2612372%3D55372%2C70%2C12%2C%2C%26194538%3D55372%2C70%2C93%2C%2C%264894%3D55372%2C27%2C6%2C%2C%264222%3D55372%2C20%2C2%2C%2C%267249%3D55392%2C31%2C2%2C%2C%2611203%3D55392%2C31%2C2%2C%2C%2631950%3D55392%2C4%2C2%2C%2C%2613490%3D55392%2C50%2C17%2C%2C%2670596%3D55392%2C0%2C1%2C%2C%267751%3D55392%2C1%2C2%2C%2C%267727%3D55392%2C0%2C1%2C%2C%2671604%3D55393%2C0%2C1%2C%2C%26183462%3D55393%2C0%2C1%2C%2C%266286%3D55393%2C0%2C1%2C%2C%2682080%3D55393%2C0%2C1%2C%2C%26186028%3D55393%2C0%2C1%2C%2C%262372%3D55394%2C2%2C2%2C29%2C%26203184%3D55394%2C2%2C2%2C29%2C%26215638%3D55394%2C2%2C2%2C29%2C%26108792%3D55394%2C2%2C2%2C29%2C%26212364%3D55394%2C2%2C2%2C29%2C%26143762%3D55394%2C2%2C2%2C29%2C%26143760%3D55394%2C2%2C2%2C29%2C%26212368%3D55394%2C2%2C2%2C29%2C%26159872%3D55394%2C2%2C2%2C29%2C%262374%3D55394%2C2%2C2%2C29%2C%2614965%3D55394%2C0%2C1%2C%2C%2617149%3D55394%2C0%2C1%2C%2C%265364%3D55394%2C0%2C1%2C90%2C%269073%3D55394%2C30%2C11%2C%2C%2650194%3D55396%2C2%2C3%2C%2C%26100834%3D55396%2C2%2C2%2C%2C%26144598%3D55396%2C0%2C1%2C%2C%2614459%3D55396%2C0%2C1%2C%2C%2615796%3D55396%2C0%2C1%2C28%2C%267859%3D55396%2C2%2C2%2C29%2C%267935%3D55396%2C0%2C1%2C%2C%2642062%3D55396%2C0%2C1%2C90%2C%2616728%3D55398%2C0%2C1%2C27%2C%26109108%3D55398%2C0%2C1%2C27%2C%2645396%3D55398%2C0%2C2%2C30%2C%2645392%3D55398%2C0%2C2%2C30%2C%2617255%3D55398%2C26%2C2%2C30%2C%26124944%3D55398%2C0%2C1%2C%2C%264210%3D55398%2C0%2C1%2C%2C%2697126%3D55398%2C26%2C4%2C30%2C%2645398%3D55398%2C26%2C4%2C30%2C%26111756%3D55398%2C0%2C1%2C%2C%267975%3D55398%2C0%2C1%2C10%2C%266564%3D55399%2C0%2C2%2C%2C%2661894%3D55399%2C0%2C1%2C%2C%2616386%3D55400%2C0%2C1%2C13%2C%264705%3D55416%2C0%2C1%2C29%2C%2650978%3D55421%2C0%2C1%2C28%2C%2675676%3D55421%2C0%2C1%2C28%2C%26102574%3D55421%2C0%2C1%2C28%2C%26101402%3D55421%2C0%2C1%2C28%2C%2664580%3D55421%2C0%2C1%2C28%2C%2666372%3D55421%2C0%2C1%2C28%2C%26203918%3D55421%2C0%2C1%2C28%2C%26203866%3D55421%2C0%2C1%2C28%2C%26203952%3D55421%2C0%2C1%2C28%2C%26203878%3D55421%2C0%2C1%2C28%2C%26203914%3D55421%2C0%2C1%2C28%2C%26203900%3D55421%2C0%2C1%2C28%2C%26113624%3D55442%2C0%2C1%2C29%2C; Domain=.pixel.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:28 GMT; Path=/","khaos=IMRKV2IF-1A-5DAO; Domain=.rubiconproject.com; Expires=Tue, 01-Nov-2016 20:54:28 GMT; Path=/"],"x-rphost":["tnNnTiY_nVPQbFjrxp6WVA"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://match.sharethrough.com/sync/v1?source_id=7658cb1d77a660882b48db06&source_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://match.sharethrough.com/sync/v1?source_id=7658cb1d77a660882b48db06&source_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"connection":["keep-alive"],"content-length":["68"],"content-type":["image/png"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://d.agkn.com/pixel/5500/?atr=000&fl=&age=&gender=&st=&sk=164451201942000149264&pd=&cbr=&mip=&dm=&py=&l0=https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264","https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264",false,302,"GET","https://society6.com/",{"cache-control":["no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"location":["https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264"],"p3p":["CP=\"NOI DSP COR CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Apache-Coyote/1.1"],"set-cookie":["uuid=513230237341791276; Version=1; Domain=.agkn.com; Max-Age=157680000; Expires=Sun, 02-May-2021 08:54:28 GMT; Path=/","u=C|0GEoeshUXHrsjxAAAwAAiAAABAC0BB-gWAgYBDI4BAIYHEUEABwAACi8ABgAACiwABgAACikABgAAEVcABgAABykABAAAARYAAAAABAAjAAAAAAAEx7D__z_Bl-ZTAuMn4wAAAAAAAAHLAAAAAACkbQoAAAAAAqQeKwAAAAAAJJwZAAYAGwAAAAAAF9j3__8vG_1tBzf9FHkAAAAAAAAAAQAAAAAAJ9QfAAAAAAEagHwABgAHAAAAAACPoUP__z4AAAAAABinDgAAAAAHn80uAAAAAAQWKYUAAAAAEfFKnAAGAAcAAAAAAIoyiP__PgAAAAAAInN7AAAAAAdMnSYAAAAAA-XYZwAAAAARnnHXAAU; Version=1; Domain=.agkn.com; Max-Age=63072000; Expires=Thu, 03-May-2018 08:54:28 GMT; Path=/"]}]
  nightmare:log did-get-response-details +4ms [{},false,"https://us-u.openx.net/w/1.0/sd?id=537072953&val=3c1c3f46-95fc-4602-b078-e8fce01d120e&c=us","https://us-u.openx.net/w/1.0/sd?id=537072953&val=3c1c3f46-95fc-4602-b078-e8fce01d120e&c=us",200,"GET","",{"cache-control":["private, max-age=0, no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"CUR ADM OUR NOR STA NID\""],"pragma":["no-cache"],"server":["OXGW/11.17.1"],"vary":["Accept"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://ads.yahoo.com/pixel?id=1643278&id=2482076&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fesig%3D1~7315a025058f3128185459bfaf16e164414683fc%26nwid%3D10000545908%26sigv%3D1","https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1",false,302,"GET","",{"age":["0"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1"],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +9ms [{},false,"https://secure.adnxs.com/setuid?entity=52&code=3c1c3f46-95fc-4602-b078-e8fce01d120e&seg=95287","https://secure.adnxs.com/setuid?entity=52&code=3c1c3f46-95fc-4602-b078-e8fce01d120e&seg=95287",200,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/5N:5[f:4Z(+M<Md%]/Q7r^B<PuvKDu'8i>FiP0xGu@<8(G1m?3g%[u%>i<?t=[DfnlJ+f]x-G`7<+?WkcG[QV$RkYFkZDToh/MOc3u(@WkLCdX[2KOEY7<^3VjpG+67mvD%$kTJA?kO0NH-4C4yu?!QO0G0lS9`g?k7]MTb(K40-nW_vOeWXMWo5Hhnu9/qII%lnbEtB0?1J/WrEMdN?O2e`l)roWN2Bez`Bc0m-J5mjz^%GT:BQY[wqh[GowI^V'gcb>dVX`8/(hY!6?i'F2Hi1<+9In0ooGvFl/2As5ZI@TZU4MsJqioY/69yr_ApGM.jnd7Ne/krNkFPI1aYH1)-_Lio:z#E:=8ns%QWW%@^[a(^uwCw0=UAK9I2.8^r!!Z7arhIxKYq2Wu@ZF7svtbysJz]LaNFg@L)BT54sC6d`T]ALwLW%k#04%5?U98wtp]$q#0.La[VP@O[?LS?sz9T)x0qkHwrl<[]$=^B!DTSz@Q-k'ZnHmBA/oE4qLIG!(dOBH`3teOo0es[hlW%IQ@2A/Vgid(pI4=8[]JR(3j1oZBFdvb1HgIA2O3lHB?RtUj<ej%r=Hh%h@]ecZ]9TMH(KpJtWO29T!YXu^X_m5S@HVX(kF$T(A:Sr>lzn5$rq(<Kb>*:$5t+=rXGZXAWB_]d`@<2E761hOR%ONWC9%!=ynFm`^C_bSO'1hP-oyYQ-e45=`O6%pr2_DPnnJVo=f#1!(j!=M>k?nN8Uh)hFGzTD'k7AlGryMrpR0YXsa]Q?87e+P3wb8(Y=rxgm-@BY4=4y(K7Ywn=eE9abIdJI:73%iiv1.Vb-@L#WYJ:*6`D6qAE.F[q24(khKXV('(0IW)UYD3(P<>Q)fL:R/(e-i[H!Y4l-A)9:$u#UyHE7]w:]7ieX25TeG7ETqs6QJ+NaN9Npr=!D+O):E`.B*gfNk/DoWjX[)>9]T6S!5Lr-)4517[Oqxmk@s6I0c'%Hcl!'SBd!rZ=X(22dHdwE7@AVT?Q4SMyEd)QV[Gk*p:VDO[qC:_<:e3Du>lj:st%4o!'qxJBPx%!df!A9qM!+dCeMyfu3i1pcowMvp>:+*RB2n]q^s-cQUaCS9kB*>KIw1gD-eeM=^ugI$=Xkz:Ur'5j>:ZK2^78F^6v!:oP*VDS2l01D2Vg4[3wC+u.i+Tc9pZsdsH=Xe)PbOrefwg#%SbIo.q$X6%WbOo(Sc?.9zh*[0n[3oqWVC?<m]hV-jyFq`'#<39y2V)<v=RjfliOc.]11EUvIMA@'As=n@$Cr]oi51b/cg6%oMwzqO5vJl<cpZlF71_B-!LR^AB1kQA0#C2aU>vVEtm[6uwu+KX+'%N^UwW9S+y(w!y?dcbs_Y!ZoQX?zhrz; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +7ms [{},false,"https://beacon.krxd.net/data.gif?_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e&_kua_seg=000&_kua_zip=&_kua_age=&_kua_gender=&_k_adadvisor_key=164451201942000149264","https://adadvisor.net/adscores/g.js?sid=9212244187&_kdpid=2111c0af-fc3a-446f-ab07-63aa74fbde8e",204,"GET","https://society6.com/",{"cache-control":["private, no-cache, no-store"],"connection":["keep-alive"],"content-length":["0"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"p3p":["policyref=\"http://cdn.krxd.net/kruxcontent/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"server":["Apache"],"set-cookie":["ServedBy=beacon-a238-dub; path=/; domain=.krxd.net; expires=Sun, 30-Oct-2016 22:14:27 GMT","_kuid_=KdjQEHAZ; path=/; expires=Sun, 30-Oct-16 08:54:27 GMT; domain=.krxd.net"],"x-request-time":["D=195 t=1462265667790037"],"x-served-by":["beacon-a238-dub.krxd.net"]},"image"]
  nightmare:log did-frame-finish-load +0ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +0ms [{},["https://society6.com/favicon.ico"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:log did-get-response-details +1ms [{},false,"https://image2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTMyNDMmdGw9MTI5NjAw&piggybackCookie=uid:pa_u4rLyvTcCEMlB369J","https://pixel-geo.prfct.co/cs/?partnerId=pub",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["close"],"content-length":["42"],"content-type":["image/gif; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["CP=\"NOI DSP COR LAW CUR ADMo DEVo TAIo PSAo PSDo IVAo IVDo HISo OTPo OUR SAMo BUS UNI COM NAV INT DEM CNT STA PRE LOC\""],"pragma":["no-cache"],"server":["Apache/2.2.24 (Unix) mod_ssl/2.2.24 OpenSSL/1.0.1e-fips mod_fastcgi/2.4.6"],"set-cookie":["KRTBCOOKIE_931=18118-uid:pa_u4rLyvTcCEMlB369J; domain=pubmatic.com; expires=Mon, 01-Aug-2016 08:54:28 GMT; path=/","PUBRETARGET=2626_1556296502; domain=pubmatic.com; expires=Fri, 26-Apr-2019 16:35:02 GMT; path=/","PUBMDCID=3; domain=pubmatic.com; expires=Mon, 01-Aug-2016 08:54:28 GMT; path=/"],"x-lat":["Pug22051:0:3200"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://us-u.openx.net/w/1.0/sd?id=537114372&val=pa_u4rLyvTcCEMlB369J","https://pixel-geo.prfct.co/cs/?partnerId=opx",200,"GET","https://teamtreehouse.com/",{"cache-control":["private, max-age=0, no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"CUR ADM OUR NOR STA NID\""],"pragma":["no-cache"],"server":["OXGW/11.17.1"],"vary":["Accept"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1","https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved",false,302,"GET","",{"age":["0"],"cache-control":["private"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/plain; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved"],"p3p":["policyref=\"https://policies.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:actions .evaluate() fn on the page +0ms
  nightmare:log did-get-response-details +3ms [{},false,"https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["0"],"p3p":["CP=\"NOI CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Rubicon Project"],"set-cookie":["rpb=8981%3D1%265421%3D1%266359%3D1%266434%3D1%26189868%3D1%269019%3D1%2613368%3D1%2612244%3D1%266433%3D1%2613466%3D1%2613508%3D1%2612370%3D1%2612368%3D1%267884%3D1%267883%3D1%267882%3D1%26112468%3D1%2613746%3D1%2613752%3D1%2613750%3D1%2612372%3D1%26194538%3D1%264894%3D1%264222%3D1%267249%3D1%2611203%3D1%2631950%3D1%2613490%3D1%2670596%3D1%267751%3D1%267727%3D1%2671604%3D1%26183462%3D1%266286%3D1%2682080%3D1%26186028%3D1%262372%3D1%26203184%3D1%26215638%3D1%26108792%3D1%26212364%3D1%26143762%3D1%26143760%3D1%26212368%3D1%26159872%3D1%262374%3D1%2614965%3D1%2617149%3D1%265364%3D1%269073%3D1%2650194%3D1%26100834%3D1%26144598%3D1%2614459%3D1%2615796%3D1%267859%3D1%267935%3D1%2642062%3D1%2616728%3D1%26109108%3D1%2645396%3D1%2645392%3D1%2617255%3D1%26124944%3D1%264210%3D1%2697126%3D1%2645398%3D1%26111756%3D1%267975%3D1%266564%3D1%2661894%3D1%2616386%3D1%264705%3D1%2650978%3D1%2675676%3D1%26102574%3D1%26101402%3D1%2664580%3D1%2666372%3D1%26203918%3D1%26203866%3D1%26203952%3D1%26203878%3D1%26203914%3D1%26203900%3D1%26113624%3D1; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:28 GMT; Path=/","put_2054=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:27 GMT; Path=/","rpx=8981%3D54938%2C434%2C3%2C%2C%265421%3D54938%2C598%2C64%2C%2C%266359%3D54938%2C504%2C17%2C%2C%266434%3D54938%2C504%2C71%2C%2C%26189868%3D54938%2C0%2C1%2C%2C%269019%3D54943%2C455%2C6%2C%2C%2613368%3D54943%2C498%2C8%2C%2C%2612244%3D54943%2C498%2C14%2C%2C%266433%3D54943%2C499%2C42%2C%2C%2613466%3D54943%2C498%2C13%2C%2C%2613508%3D54943%2C498%2C8%2C%2C%2612370%3D54943%2C499%2C12%2C%2C%2612368%3D54943%2C478%2C5%2C%2C%267884%3D54943%2C499%2C16%2C%2C%267883%3D54943%2C499%2C22%2C%2C%267882%3D54943%2C498%2C8%2C%2C%26112468%3D54943%2C499%2C24%2C%2C%2613746%3D54944%2C498%2C21%2C%2C%2613752%3D55372%2C70%2C17%2C%2C%2613750%3D55372%2C70%2C8%2C%2C%2612372%3D55372%2C70%2C12%2C%2C%26194538%3D55372%2C70%2C93%2C%2C%264894%3D55372%2C27%2C6%2C%2C%264222%3D55372%2C20%2C2%2C%2C%267249%3D55392%2C31%2C2%2C%2C%2611203%3D55392%2C31%2C2%2C%2C%2631950%3D55392%2C4%2C2%2C%2C%2613490%3D55392%2C50%2C17%2C%2C%2670596%3D55392%2C0%2C1%2C%2C%267751%3D55392%2C1%2C2%2C%2C%267727%3D55392%2C0%2C1%2C%2C%2671604%3D55393%2C0%2C1%2C%2C%26183462%3D55393%2C0%2C1%2C%2C%266286%3D55393%2C0%2C1%2C%2C%2682080%3D55393%2C0%2C1%2C%2C%26186028%3D55393%2C0%2C1%2C%2C%262372%3D55394%2C2%2C2%2C29%2C%26203184%3D55394%2C2%2C2%2C29%2C%26215638%3D55394%2C2%2C2%2C29%2C%26108792%3D55394%2C2%2C2%2C29%2C%26212364%3D55394%2C2%2C2%2C29%2C%26143762%3D55394%2C2%2C2%2C29%2C%26143760%3D55394%2C2%2C2%2C29%2C%26212368%3D55394%2C2%2C2%2C29%2C%26159872%3D55394%2C2%2C2%2C29%2C%262374%3D55394%2C2%2C2%2C29%2C%2614965%3D55394%2C0%2C1%2C%2C%2617149%3D55394%2C0%2C1%2C%2C%265364%3D55394%2C0%2C1%2C90%2C%269073%3D55394%2C30%2C11%2C%2C%2650194%3D55396%2C2%2C3%2C%2C%26100834%3D55396%2C2%2C2%2C%2C%26144598%3D55396%2C0%2C1%2C%2C%2614459%3D55396%2C0%2C1%2C%2C%2615796%3D55396%2C0%2C1%2C28%2C%267859%3D55396%2C2%2C2%2C29%2C%267935%3D55396%2C0%2C1%2C%2C%2642062%3D55396%2C0%2C1%2C90%2C%2616728%3D55398%2C0%2C1%2C27%2C%26109108%3D55398%2C0%2C1%2C27%2C%2645396%3D55398%2C0%2C2%2C30%2C%2645392%3D55398%2C0%2C2%2C30%2C%2617255%3D55398%2C26%2C2%2C30%2C%26124944%3D55398%2C0%2C1%2C%2C%264210%3D55398%2C0%2C1%2C%2C%2697126%3D55398%2C26%2C4%2C30%2C%2645398%3D55398%2C26%2C4%2C30%2C%26111756%3D55398%2C0%2C1%2C%2C%267975%3D55398%2C0%2C1%2C10%2C%266564%3D55399%2C0%2C2%2C%2C%2661894%3D55399%2C0%2C1%2C%2C%2616386%3D55400%2C0%2C1%2C13%2C%264705%3D55416%2C0%2C1%2C29%2C%2650978%3D55421%2C0%2C1%2C28%2C%2675676%3D55421%2C0%2C1%2C28%2C%26102574%3D55421%2C0%2C1%2C28%2C%26101402%3D55421%2C0%2C1%2C28%2C%2664580%3D55421%2C0%2C1%2C28%2C%2666372%3D55421%2C0%2C1%2C28%2C%26203918%3D55421%2C0%2C1%2C28%2C%26203866%3D55421%2C0%2C1%2C28%2C%26203952%3D55421%2C0%2C1%2C28%2C%26203878%3D55421%2C0%2C1%2C28%2C%26203914%3D55421%2C0%2C1%2C28%2C%26203900%3D55421%2C0%2C1%2C28%2C%26113624%3D55442%2C0%2C1%2C29%2C; Domain=.pixel.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:28 GMT; Path=/","khaos=IMRKV2IF-1A-5DAO; Domain=.rubiconproject.com; Expires=Tue, 01-Nov-2016 20:54:28 GMT; Path=/"],"x-rphost":["tnNnTiY_nVPQbFjrxp6WVA"]},"image"]
  nightmare:log did-get-response-details +2ms [{},false,"https://pixel-geo.prfct.co/seg/?add=4728398&source=js_tag&a_id=57309","https://pixel-geo.prfct.co/seg/?add=4728398&source=js_tag&a_id=57309",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT"]},"image"]
  nightmare:log did-get-redirect-request +3ms [{},"https://secure.adnxs.com/seg?add=95287&redir=https%3A%2F%2Fsecure.adnxs.com%2Fgetuid%3Fhttps%3A%2F%2Fdis.criteo.com%2Fdis%2Frtb%2Fappnexus%2Fcookiematch.aspx%3Fappnxsid%3D%24UID","https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/5N:5[f:4Z(+M<Md%]/Q7r^B<PuvKDu'8i>FiP0xGu@<8(G1m?3g%[u%>i<?t=[DfnlJ+f]x-G`7<+?WkcG[QV$RkYFkZDToh/MOc3u(@WkLCdX[2KOEY7<^3VjpG+67mvD%$kTJA?kO0NH-4C4yu?!QO0G0lS9`g?k7]MTb(K40-nW_vOeWXMWo5Hhnu9/qII%lnbEtB0?1J/WrEMdN?O2e`l)roWN2Bez`Bc0m-J5mjz^%GT:BQY[wqh[GowI^V'gcb>dVX`8/(hY!6?i'F2Hi1<+9In0ooGvFl/2As5ZI@TZU4MsJqioY/69yr_ApGM.jnd7Ne/krNkFPI1aYH1)-_Lio:z#E:=8ns%QWW%@^[a(^uwCw0=UAK9I2.8^r!!Z7arhIxKYq2Wu@ZF7svtbysJz]LaNFg@L)BT54sC6d`T]ALwLW%k#04%5?U98wtp]$q#0.La[VP@O[?LS?sz9T)x0qkHwrl<[]$=^B!DTSz@Q-k'ZnHmBA/oE4qLIG!(dOBH`3teOo0es[hlW%IQ@2A/Vgid(pI4=8[]JR(3j1oZBFdvb1HgIA2O3lHB?RtUj<ej%r=Hh%h@]ecZ]9TMH(KpJtWO29T!YXu^X_m5S@HVX(kF$T(A:Sr>lzn5$rq(<Kb>*:$5t+=rXGZXAWB_]d`@<2E761hOR%ONWC9%!=ynFm`^C_bSO'1hP-oyYQ-e45=`O6%pr2_DPnnJVo=f#1!(j!=M>k?nN8Uh)hFGzTD'k7AlGryMrpR0YXsa]Q?87e+P3wb8(Y=rxgm-@BY4=4y(K7Ywn=eE9abIdJI:73%iiv1.Vb-@L#WYJ:*6`D6qAE.F[q24(khKXV('(0IW)UYD3(P<>Q)fL:R/(e-i[H!Y4l-A)9:$u#UyHE7]w:]7ieX25TeG7ETqs6QJ+NaN9Npr=!D+O):E`.B*gfNk/DoWjX[)>9]T6S!5Lr-)4517[Oqxmk@s6I0c'%Hcl!'SBd!rZ=X(22dHdwE7@AVT?Q4SMyEd)QV[Gk*p:VDO[qC:_<:e3Du>lj:st%4o!'qxJBPx%!df!A9qM!+dCeMyfu3i1pcowMvp>:+*RB2n]q^s-cQUaCS9kB*>KIw1gD-eeM=^ugI$=Xkz:Ur'5j>:ZK2^78F^6v!:oP*VDS2l01D2Vg4[3wC+u.i+Tc9pZsdsH=Xe)PbOrefwg#%SbIo.q$X6%WbOo(Sc?.9zh*[0n[3oqWVC?<m]hV-jyFq`'#<39y2V)<v=RjfliOc.]11EUvIMA@'As=n@$Cr]oi51b/cg6%oMwzqO5vJl<cpZlF71_B-!LR^AB1kQA0#C2aU>vVEtm[6uwu+KX+'%N^UwW9S+y(w!y?dcbs_Y!ZoQX?zhrz; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +2ms [{},false,"https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved","https://sp.analytics.yahoo.com/spp.pl?a=10001287818027&.yp=39872&js=no",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +12ms [{},false,"https://tl.r7ls.net/fl/?d=%7Bacc:%22187849%22,sd:1238,t:%5B%7Bid:3236,ls:1,lb:2365,ld:55,spg:%221684%22%7D%5D,cl:1213%7D","https://tl.r7ls.net/fl/?d=%7Bacc:%22187849%22,sd:1238,t:%5B%7Bid:3236,ls:1,lb:2365,ld:55,spg:%221684%22%7D%5D,cl:1213%7D",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, must-revalidate, post-check=0, pre-check=0"],"connection":["keep-alive"],"content-length":["50"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:27 GMT"],"expires":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"ALL BUS LEG DSP COR ADM CUR DEV PSA OUR NAV INT\""],"pragma":["no-cache"],"server":["Resin/3.1.8"],"set-cookie":["brwsr=59c540a2-8ed2-ba64-99ec-71b9964ae2fc; domain=.r7ls.net; path=/; expires=Sun, 02-May-2021 08:54:27 GMT"]},"image"]
  nightmare:log did-get-redirect-request +163ms [{},"http://www.mediatrends.es/api/trends/get_mt_noticias","http://www.mediatrends.es/api/trends/get_mt_noticias/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4729"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_noticias/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5245"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549658 249301588"]}]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediatrends.es/api/trends/get_last_post/?callback=callback","http://www.mediatrends.es/api/trends/get_last_post/?callback=callback",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4728"],"connection":["keep-alive"],"content-length":["941"],"content-type":["application/javascript; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["7403"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549657 249301613"]},"script"]
  nightmare:log did-get-redirect-request +2ms [{},"http://www.mediatrends.es/api/trends/get_mt_comparativas","http://www.mediatrends.es/api/trends/get_mt_comparativas/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4729"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_comparativas/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5242"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549659 249301590"]}]
  nightmare:log did-get-redirect-request +1ms [{},"http://www.mediatrends.es/api/trends/get_mt_reviews","http://www.mediatrends.es/api/trends/get_mt_reviews/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4729"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_reviews/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5243"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549660 249301593"]}]
  nightmare:log did-get-redirect-request +0ms [{},"http://www.mediatrends.es/api/trends/get_mt_howto","http://www.mediatrends.es/api/trends/get_mt_howto/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4729"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_howto/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5244"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549661 249301591"]}]
  nightmare:log did-get-redirect-request +0ms [{},"http://www.mediatrends.es/api/trends/get_mt_videos","http://www.mediatrends.es/api/trends/get_mt_videos/",false,301,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4728"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["http://www.mediatrends.es/api/trends/get_mt_videos/"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5241"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549662 249301610"]}]
  nightmare:log did-get-response-details +33ms [{},false,"https://specials.mediamarkt.es/search/js/doofinder.js?_=1462265659220","https://specials.mediamarkt.es/search/js/doofinder.js?_=1462265659220",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["927"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"etag":["\"39f-5318a5fd9439f\""],"expires":["Tue, 17 May 2016 08:54:28 GMT"],"last-modified":["Thu, 28 Apr 2016 12:07:46 GMT"],"server":["Apache"],"x-served-by":["web01"]},"script"]
  nightmare:log did-get-response-details +0ms [{},false,"https://specials.mediamarkt.es/search/js/script.js?_=1462265659221","https://specials.mediamarkt.es/search/js/script.js?_=1462265659221",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["7052"],"content-type":["text/javascript"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"etag":["\"1b8c-531dd08e483bd\""],"expires":["Tue, 17 May 2016 08:54:28 GMT"],"last-modified":["Mon, 02 May 2016 14:44:50 GMT"],"server":["Apache"],"x-served-by":["web01"]},"script"]
  nightmare:log did-get-response-details +14ms [{},false,"http://www.mediamarkt.es/static/index/slider/img/bg-img.jpg","http://www.mediamarkt.es/static/index/slider/img/bg-img.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["2085"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Wed, 04 May 2016 08:54:28 GMT"],"last-modified":["Fri, 02 Oct 2015 06:46:18 GMT"],"set-cookie":["TS015b134e=014cde7230f1eb1e6248752299e4c0ef394cea600b04264276f824a38b5a5e4cabde6b174d; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache03"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"image"]
  nightmare:log did-get-response-details +26ms [{},false,"https://sync.1rx.io/usersync/criteo/3c1c3f46-95fc-4602-b078-e8fce01d120e","https://sync.1rx.io/usersync/criteo/3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx"]},"image"]
  nightmare:log did-get-response-details +10ms [{},false,"https://dis.us.criteo.com/dis/dis.aspx?p=24635&cb=82855563291&ref=&sc_r=1920x1080&sc_d=24","https://dis.us.criteo.com/dis/dis.aspx?p=24635&cb=82855563291&ref=&sc_r=1920x1080&sc_d=24",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-cache,no-cache"],"content-length":["6021"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT,Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP='CUR ADM OUR NOR STA NID'","CP='CUR ADM OUR NOR STA NID'"],"pragma":["no-cache,no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"subFrame"]
  nightmare:log did-get-response-details +24ms [{},false,"https://srv.clickfuse.com/pixels/create.php?name=criteo_970_125_u&expire=30","https://srv.clickfuse.com/pixels/create.php?name=criteo_970_125_u&expire=30",200,"GET","",{"cache-control":["no-cache, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 26 Jul 1997 05:00:00 GMT"],"server":["Apache/2.4.10 (Unix) OpenSSL/1.0.1h"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved","https://ads.yahoo.com/pixel?id=1643278&id=2482076&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fesig%3D1~7315a025058f3128185459bfaf16e164414683fc%26nwid%3D10000545908%26sigv%3D1",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID","https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196","https://secure.adnxs.com/seg?add=95287&redir=https%3A%2F%2Fsecure.adnxs.com%2Fgetuid%3Fhttps%3A%2F%2Fdis.criteo.com%2Fdis%2Frtb%2Fappnexus%2Fcookiematch.aspx%3Fappnxsid%3D%24UID",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://ad.afy11.net/ad?mode=7&publisher_dsp_id=7&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://ad.afy11.net/ad?mode=7&publisher_dsp_id=7&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"access-control-allow-origin":["*"],"cache-control":["private, max-age=0, no-cache, no-store, must-revalidate, proxy-revalidate"],"connection":["close"],"content-length":["45"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Sat, 1 Jan 2000 01:01:00 GMT"],"last-modified":["Sat, 1 Jan 2000 01:01:00 GMT"],"p3p":["policyref=\"https://ad.afy11.net/privacy.xml\", CP=\" NOI DSP NID ADMa DEVa PSAa PSDa OUR OTRa IND COM NAV STA OTC\""],"pragma":["no-cache"],"server":["Microsoft-IIS/7.5","AdifyServer"],"set-cookie":["s=1,5*57209ad3*Zk3gbkYIp8*ZvwHIUWA5Po9pZL5*,7*571f589b*h6gOK2F5xT*FiwRBjv8dwBmTtSWACW2sHiYz9UStlMlZfL1VXxnbPSPK8A3*; path=/; expires=Thu, 03 May 2018 08:54:28 GMT; domain=afy11.net;"],"x-powered-by":["ASP.NET"]},"image"]
Window object available for: https://society6.com/
Finished processing: https://society6.com/
  nightmare:log did-get-response-details +20ms [{},false,"https://bam.nr-data.net/1/d98036d1cc?a=1824378&v=918.2e0ff1d&to=cQ5eRRQNCQ8BFhZVVkAKVUUPDAJMCAVXXF5cBm9BBwUAEEsXUVdA&rst=12891&qt=1&ap=257&be=2876&fe=9959&dc=6866&f=%5B%22err%22,%22xhr%22,%22stn%22,%22ins%22%5D&perf=%7B%22timing%22:%7B%22of%22:1462265655298,%22n%22:0,%22dl%22:1661,%22di%22:9739,%22ds%22:9741,%22de%22:9811,%22dc%22:12834,%22l%22:12834,%22le%22:12857,%22f%22:667,%22dn%22:807,%22dne%22:816,%22c%22:816,%22ce%22:1217,%22s%22:902,%22rq%22:1217,%22rp%22:1658,%22rpe%22:1659%7D,%22navigation%22:%7B%7D%7D&jsonp=NREUM.setToken","https://bam.nr-data.net/1/d98036d1cc?a=1824378&v=918.2e0ff1d&to=cQ5eRRQNCQ8BFhZVVkAKVUUPDAJMCAVXXF5cBm9BBwUAEEsXUVdA&rst=12891&qt=1&ap=257&be=2876&fe=9959&dc=6866&f=%5B%22err%22,%22xhr%22,%22stn%22,%22ins%22%5D&perf=%7B%22timing%22:%7B%22of%22:1462265655298,%22n%22:0,%22dl%22:1661,%22di%22:9739,%22ds%22:9741,%22de%22:9811,%22dc%22:12834,%22l%22:12834,%22le%22:12857,%22f%22:667,%22dn%22:807,%22dne%22:816,%22c%22:816,%22ce%22:1217,%22s%22:902,%22rq%22:1217,%22rp%22:1658,%22rpe%22:1659%7D,%22navigation%22:%7B%7D%7D&jsonp=NREUM.setToken",200,"GET","https://teamtreehouse.com/",{"content-length":["57"],"content-type":["text/javascript;charset=ISO-8859-1"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"set-cookie":["JSESSIONID=60758d6a0063cf83;Path=/;Domain=.nr-data.net"]},"script"]
  nightmare:log did-get-response-details +13ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_noticias/","http://www.mediatrends.es/api/trends/get_mt_noticias/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4715"],"connection":["keep-alive"],"content-length":["931"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["6289"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549672 249302006"]},"xhr"]
  nightmare:log did-get-response-details +2ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_comparativas/","http://www.mediatrends.es/api/trends/get_mt_comparativas/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4715"],"connection":["keep-alive"],"content-length":["939"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["6278"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549673 249302008"]},"xhr"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_reviews/","http://www.mediatrends.es/api/trends/get_mt_reviews/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4716"],"connection":["keep-alive"],"content-length":["857"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["6279"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549674 249301961"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_howto/","http://www.mediatrends.es/api/trends/get_mt_howto/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4715"],"connection":["keep-alive"],"content-length":["768"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["6278"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549675 249302009"]},"xhr"]
  nightmare:log did-get-response-details +0ms [{},false,"http://www.mediatrends.es/api/trends/get_mt_videos/","http://www.mediatrends.es/api/trends/get_mt_videos/",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4715"],"connection":["keep-alive"],"content-length":["836"],"content-type":["application/json; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["6269"],"x-powered-by":["PHP/5.5.33-1~dotdeb+7.1"],"x-varnish":["249549676 249302007"]},"xhr"]
  nightmare:log did-get-response-details +4ms [{},false,"https://pixel.prfct.co/cb?partnerId=yah&eid=pa_u4rLyvTcCEMlB369J&xid=uRKcddha9HT2Kfa7DdPYTfdP","https://pixel-geo.prfct.co/cs/?partnerId=yah",200,"GET","https://teamtreehouse.com/",{"cache-control":["no-store, no-cache, private","no-cache=\"set-cookie\""],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"p3p":["CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"server":["Jetty(9.0.5.v20130815)"],"set-cookie":["pa_uid=pa_u4rLyvTcCEMlB369J;Path=/;Domain=.prfct.co;Expires=Thu, 03-May-2018 08:54:28 GMT","AWSELB=B91D518304C41D26F2E262C1B04B163CFB753805FF6E7DB033878BD2120D94348D18A6089702461DD4EE69A2C5FFB1AC7664DF5EC1345A41CCC8DA19005D76CE67E9BBCD02;PATH=/"]},"image"]
  nightmare:log did-get-response-details +35ms [{},false,"https://s.ytimg.com/yts/cssbin/www-embed-player-webp-vfl7T7Hx7.css","https://s.ytimg.com/yts/cssbin/www-embed-player-webp-vfl7T7Hx7.css",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["517111"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=31536000"],"content-encoding":["gzip"],"content-length":["40437"],"content-type":["text/css"],"date":["Wed, 27 Apr 2016 09:15:57 GMT"],"expires":["Thu, 27 Apr 2017 09:15:57 GMT"],"last-modified":["Wed, 27 Apr 2016 07:52:57 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"stylesheet"]
  nightmare:log did-get-response-details +5ms [{},false,"https://s.ytimg.com/yts/jsbin/www-embed-player-vflkMbUkT/www-embed-player.js","https://s.ytimg.com/yts/jsbin/www-embed-player-vflkMbUkT/www-embed-player.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["427776"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=691200"],"content-encoding":["gzip"],"content-length":["68786"],"content-type":["text/javascript"],"date":["Thu, 28 Apr 2016 10:04:52 GMT"],"expires":["Fri, 06 May 2016 10:04:52 GMT"],"last-modified":["Thu, 28 Apr 2016 09:17:40 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +4ms [{},false,"https://s.ytimg.com/yts/jsbin/player-en_US-vflA_6ZRP/base.js","https://s.ytimg.com/yts/jsbin/player-en_US-vflA_6ZRP/base.js",200,"GET","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",{"age":["344091"],"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["public, max-age=691200"],"content-encoding":["gzip"],"content-length":["400506"],"content-type":["text/javascript"],"date":["Fri, 29 Apr 2016 09:19:37 GMT"],"expires":["Sat, 07 May 2016 09:19:37 GMT"],"last-modified":["Fri, 29 Apr 2016 08:55:50 GMT"],"server":["sffe"],"status":["200"],"timing-allow-origin":["https://www.youtube.com"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"script"]
  nightmare:log did-get-response-details +45ms [{},false,"https://www.mediamarkt.es/static/fonts/regular.woff2","https://www.mediamarkt.es/static/fonts/regular.woff2",200,"GET","https://specials.mediamarkt.es/chat/css/style.css",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"access-control-allow-origin":["https://webchates.emergiacc.com"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["54420"],"content-type":["text/plain"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Wed, 04 May 2016 08:54:28 GMT"],"last-modified":["Fri, 15 Apr 2016 14:09:36 GMT"],"set-cookie":["TS015b134e=014cde72303d9056aa5250db92e31e07521297b9c71ccfcea9d570c60b4708cc5b380b1522; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache03"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"other"]
  nightmare:log did-get-response-details +2ms [{},false,"https://seal.godaddy.com/getSeal?sealID=YAwwJM189bYsVBGGetOifD89r0KMt4gKC2nR8wrv4snMwAUkxeHkoif1f1nC","https://seal.godaddy.com/getSeal?sealID=YAwwJM189bYsVBGGetOifD89r0KMt4gKC2nR8wrv4snMwAUkxeHkoif1f1nC",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"age":["8"],"cache-control":["max-age=14400"],"connection":["Keep-Alive"],"content-encoding":["gzip"],"content-length":["1553"],"content-type":["text/html;charset=ISO-8859-1"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Tue, 03 May 2016 12:54:20 GMT"],"keep-alive":["timeout=2, max=100"],"p3p":["CP=\"IDC DSP COR LAW CUR ADM DEV TAI PSA PSD IVA IVD HIS OUR SAM PUB LEG UNI COM NAV STA\""],"server":["Apache"],"vary":["Accept-Encoding"],"x-frame-options":["SAMEORIGIN"]},"script"]
  nightmare:log did-get-response-details +31ms [{},false,"https://www.mediamarkt.es/static/fonts/mm-head-webfont.woff2","https://www.mediamarkt.es/static/fonts/mm-head-webfont.woff2",200,"GET","https://specials.mediamarkt.es/chat/css/style.css",{"accept-ranges":["bytes","bytes"],"access-control-allow-headers":["origin, x-requested-with, content-type"],"access-control-allow-methods":["PUT, GET, POST, DELETE, OPTIONS"],"access-control-allow-origin":["https://webchates.emergiacc.com"],"age":["0"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["29836"],"content-type":["text/plain"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Wed, 04 May 2016 08:54:28 GMT"],"last-modified":["Thu, 13 Nov 2014 17:50:48 GMT"],"set-cookie":["TS015b134e=014cde72301f80217737d1929dc8a9e9510e2d64a2f8f9d816e087ea24614c0f6cb632c76a; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["MISS"],"x-cache-host":["cache02"],"x-vcl":["(recv)(hash)(pass)(fetch)(deliver)"]},"other"]
  nightmare:log did-frame-finish-load +16ms [{},false]
  nightmare:log did-frame-finish-load +9ms [{},false]
  nightmare:log did-frame-finish-load +0ms [{},true]
  nightmare:log did-finish-load +0ms [{}]
  nightmare:log page-favicon-updated +1ms [{},["https://teamtreehouse.com/assets/favicon.png"]]
  nightmare:log did-stop-loading +0ms [{}]
  nightmare:actions .evaluate() fn on the page +1ms
  nightmare:log did-get-response-details +42ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/05/750x500_AdrenaCard2028129-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/05/750x500_AdrenaCard2028129-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["4727"],"connection":["keep-alive"],"content-length":["3040"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"last-modified":["Mon, 02 May 2016 14:19:23 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["5111"],"x-varnish":["249549678 249301645"]},"image"]
  nightmare:log did-get-response-details +49ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/pacman-768x480-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/pacman-768x480-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["69565"],"connection":["keep-alive"],"content-length":["2795"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"last-modified":["Thu, 21 Apr 2016 16:29:57 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["40787"],"x-varnish":["249549680 246751484"]},"image"]
  nightmare:log did-get-response-details +46ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/shutterstock_155697419-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/shutterstock_155697419-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["55162"],"connection":["keep-alive"],"content-length":["8456"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"last-modified":["Mon, 02 May 2016 10:15:26 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["31194"],"x-varnish":["249549681 247585963"]},"image"]
  nightmare:log did-get-response-details +26ms [{},false,"http://d3chj0zb5zcn0g.cloudfront.net/media/js/doofinder-4.latest.min.js","http://d3chj0zb5zcn0g.cloudfront.net/media/js/doofinder-4.latest.min.js",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["2840"],"cache-control":["max-age=3600"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-length":["66587"],"content-type":["application/javascript"],"date":["Thu, 31 Mar 2016 03:52:41 GMT"],"etag":["\"e0549d863b9785584ff5bc350ff88dd2\""],"last-modified":["Wed, 09 Mar 2016 10:26:48 GMT"],"server":["AmazonS3"],"via":["1.1 5708bb5bf7c6584fb61b0ea84d7bead3.cloudfront.net (CloudFront)"],"x-amz-cf-id":["sQhtLQu20vNa2ke-JoiatS9QrDnx2uyAI-EseLMjx3yQaPSdNVl6wQ=="],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +9ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/rizar-cabello-668x400x80xX-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/rizar-cabello-668x400x80xX-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["69564"],"connection":["keep-alive"],"content-length":["5283"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"last-modified":["Tue, 26 Apr 2016 08:14:18 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["42319"],"x-varnish":["249549682 246751507"]},"image"]
  nightmare:log did-get-response-details +20ms [{},false,"http://www.mediatrends.es/wp-content/uploads/2016/04/PORTADA_POST_COOLPAD_S-150x90.jpg","http://www.mediatrends.es/wp-content/uploads/2016/04/PORTADA_POST_COOLPAD_S-150x90.jpg",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"access-control-allow-origin":["*"],"age":["69564"],"connection":["keep-alive"],"content-length":["25545"],"content-type":["image/jpeg"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"last-modified":["Tue, 26 Apr 2016 17:08:12 GMT"],"server":["nginx/1.2.1"],"via":["1.1 varnish"],"x-cache":["HIT"],"x-cache-hits":["42449"],"x-varnish":["249549684 246751509"]},"image"]
  nightmare:log did-frame-finish-load +11ms [{},false]
  nightmare:log did-fail-load +56ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-get-response-details +65ms [{},false,"http://css.redblue.de/MediaES/skins/cms-custom/es/img/banners/blank.gif","http://css.redblue.de/MediaES/skins/cms-custom/es/img/banners/blank.gif",200,"GET","http://d243u7pon29hni.cloudfront.net/templates/WLSMERGED/cssMergedMM_4422.css",{"accept-ranges":["bytes"],"age":["372"],"cache-control":["max-age=86400, s-maxage=900"],"connection":["keep-alive"],"content-length":["49"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Wed, 04 May 2016 08:48:17 GMT"],"last-modified":["Mon, 02 May 2016 08:14:00 GMT"],"set-cookie":["TS015b134e=014cde7230ccd602313ecca0e906b925f78705cd45ca74e39bb81ffaa49da64065b7a1416b; Path=/"],"vary":["Accept-Encoding,Origin"],"x-cache":["HIT"],"x-cache-hits":["117"],"x-cache-host":["cache03"],"x-vcl":["(recv)(hash)(hit)(deliver)"]},"image"]
  nightmare:log did-get-response-details +7ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12866"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-redirect-request +5ms [{},"https://ads.yahoo.com/pixel?id=1643278&id=2482076&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fesig%3D1~7315a025058f3128185459bfaf16e164414683fc%26nwid%3D10000545908%26sigv%3D1","https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1",false,302,"GET","",{"age":["0"],"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1"],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +12ms [{},false,"https://seal.godaddy.com/images/3/es/siteseal_gd_3_h_l_m.gif","https://seal.godaddy.com/images/3/es/siteseal_gd_3_h_l_m.gif",200,"GET","https://webchates.emergiacc.com/CHAT_Mediamarkt/welcome.aspx",{"accept-ranges":["bytes"],"cache-control":["max-age=86400"],"connection":["Keep-Alive"],"content-length":["5444"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Wed, 04 May 2016 08:54:29 GMT"],"keep-alive":["timeout=2, max=99"],"p3p":["CP=\"IDC DSP COR LAW CUR ADM DEV TAI PSA PSD IVA IVD HIS OUR SAM PUB LEG UNI COM NAV STA\""],"server":["Apache"],"x-frame-options":["SAMEORIGIN"]},"image"]
  nightmare:log did-get-redirect-request +13ms [{},"https://ads.yahoo.com/cms/v1?esig=1~7315a025058f3128185459bfaf16e164414683fc&nwid=10000545908&sigv=1","https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved",false,302,"GET","",{"age":["0"],"cache-control":["private"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/plain; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved"],"p3p":["policyref=\"https://policies.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://www.facebook.com/fr/u.php?p=474445595912814&m=3c1c3f46-95fc-4602-b078-e8fce01d120e&t=2592000","https://www.facebook.com/fr/u.php?p=474445595912814&m=3c1c3f46-95fc-4602-b078-e8fce01d120e&t=2592000",200,"GET","",{"cache-control":["public, max-age=0"],"content-encoding":["gzip"],"content-security-policy":["default-src * data: blob:;script-src *.facebook.com *.fbcdn.net *.facebook.net *.google-analytics.com *.virtualearth.net *.google.com 127.0.0.1:* *.spotilocal.com:* 'unsafe-inline' 'unsafe-eval' fbstatic-a.akamaihd.net fbcdn-static-b-a.akamaihd.net *.atlassolutions.com blob: chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl;style-src * 'unsafe-inline' data:;connect-src *.facebook.com *.fbcdn.net *.facebook.net *.spotilocal.com:* *.akamaihd.net wss://*.facebook.com:* https://fb.scanandcleanlocal.com:* *.atlassolutions.com attachment.fbsbx.com ws://localhost:* blob: 127.0.0.1:*;"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 01:54:28 PDT"],"expires":["Tue, 03 May 2016 01:54:28 PDT"],"pragma":["public"],"public-key-pins-report-only":["max-age=500; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"q4PO2G2cbkZhZ82+JgmRUyGMoAeozA+BSXVXQWB8XWQ=\"; report-uri=\"http://reports.fb.com/hpkp/\""],"status":["200"],"strict-transport-security":["max-age=15552000; preload"],"vary":["Accept-Encoding"],"x-content-type-options":["nosniff"],"x-fb-debug":["FWcOAT+tK65TBd7QcxCdj3Uwqyz6JyfRQ4lJ6RQmSNd8AnAaBAUfIpg7W1QnyePGzFI+YjRkwdpUovDCIHVUaw=="],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/4128/criteo_optin_s;dc_seg=21407410;ord=d47bb17e-ab72-4eb0-a487-0b19943de31e","https://pubads.g.doubleclick.net/activity;dc_iu=/4128/criteo_optin_s;dc_seg=21407410;ord=d47bb17e-ab72-4eb0-a487-0b19943de31e",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +11ms [{},false,"https://bh.contextweb.com/bh/rtset?do=add&pid=538064&ev=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://bh.contextweb.com/bh/rtset?do=add&pid=538064&ev=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"accept-ranges":["bytes"],"cache-control":["private, max-age=0, no-cache, no-store"],"connection":["keep-alive"],"content-language":["en-US"],"content-type":["image/gif; charset=ISO-8859-1"],"cw-server":["ams-bh01"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["-1"],"p3p":["policyref=\"/bh/w3c/p3p.xml\", CP=\"NOI DSP COR NID CURa DEVa PSAa OUR BUS COM NAV INT\""],"server":["Jetty(9.2.3.v20140905)"],"set-cookie":["V=9FewimNlq3DK;Path=/;Domain=.contextweb.com;Expires=Fri, 28-Apr-2017 08:54:28 GMT","pb_rtb_ev=3-8wv|14W.o.f8qhrlnngu0wu|6zB.o.ed0ec49d-62d8-4c67-a4da-f48084302b86|79f.0.kDMeqp09TPyINkusk2UD-cc8H6-IPRb5wWHqZsxv|-5.q.292E025B-E1CA-5ECD-B227-53CDF7ACE4D7|7dW.m.1|1ea.k.7583537490505916663|aE.m.o8c9ne5ehnoi|3XO.18.1267099506496825196|7aw.Q.1|4Ec.k.83d6edbb5db441b79f6e0387d69f5aa3|7fK.o.1|17m.r.EXEeQAZQ1AOywc5|1U9.2E.3c1c3f46-95fc-4602-b078-e8fce01d120e|3qC.o.e93f197308321213-060e064510f8fc2d|0.q.3766571f-6050-4a00-85c5-b4e4f7a521d3;Path=/;Domain=.contextweb.com;Expires=Wed, 01-Jun-2016 08:54:28 GMT","sto-id-20480-bh=DIANNMAKJABP; Domain=contextweb.com; Expires=Tue, 03-May-2016 09:09:27 GMT; Path=/"],"transfer-encoding":["chunked"],"via":["1.1 varnish"],"x-cache":["MISS"],"x-cache-hits":["0"],"x-served-by":["cache-lhr6325-LHR"]},"image"]
  nightmare:log did-get-redirect-request +0ms [{},"https://sp.analytics.yahoo.com/spp.pl?a=10001287818027&.yp=39872&js=no","https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1",false,302,"GET","",{"age":["0"],"cache-control":["no-cache, private, must-revalidate"],"connection":["keep-alive"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1"],"pragma":["no-cache"],"server":["ATS"],"transfer-encoding":["chunked"],"via":["http/1.1 spdc0034.pbp.ir2.yahoo.com (ApacheTrafficServer)"]}]
  nightmare:log did-get-redirect-request +0ms [{},"https://secure.adnxs.com/seg?add=2389630&t=2&redir=pxj","https://secure.adnxs.com/pxj",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["pxj"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?jt)6:5]o^V?B3IYp`1o$j$e2jw.Wp4S$0/=jS%h:<+8=G!%E2brHGP[u%Aj<?t=[Dfjbz+f]x-]9n7q?WkcG[QP0`Yh#1-e.ZN:Lo)x?Pj(L8Uky!sC#IbY/o6x*cDXZHgwyhch2zFr^F+jDnVyEJ'r<CpEdL/-F<PMb#JZ>h6>u!w_.%v(ABAM1MwwQ*embtfg^>$^fiHm2gjc=%sGKH(DimQuF-zNyv4rtpDw/Gmttc0NrbpaXN(_S%rzp'hwq^xmF)NKMud5.QEQrz7HXSA<d<@cHZeJfd!+tyjWsu5fhhPM<l]oY/7IJ83C'[Qmt2.][Ca!i4>5iWiWO!V]pg.g77LeIKL:V%=#Uq#Cr!:-:8Le]MQ^ZUk4AWl/c=ype)x'/k6zT(>D+jj'@x5J[mv@+8Au05<2[-B@6f:(aFjL'WnUUUT-1CK8?W@y8UgL$wW5fyXZew3z'lQMf?wA/E5pQ$h]7-N@G`Wp@>6dZu83c-(-bbAh+M-%bVFvas^ch6t*ZMyRZhWppcYdtFUG!3lK5K-MewbKG2jl*>[#ByLm>=qN$1Q*Rp_$UAh4)K.f)$raJ3^ZHbAaaOlS3*Y49?Q#T@BAJTs>%WZIgacNjGJEXRO9%BZUupRJBGTfVK.bO@(UE!5(cShm`sd)lQ7j?()H)1%g4+n:(5SF1O@9TL[64]h)h/1Veh=?au1#/Y(4M1R%`g'7!<l$t[9qs*qgy!(oF<86JCzXXq732H6C!-0Pin>Swym0XrLG+JCsbQfl+iw8PtDdkT3Wef2ti-KgW/Xa$g?s#juI:3c8So-)B2X$[Dl9yOuX^iajg^nF>zZmmcZ='pV@lZc8cNUzwyv(HFbsss+gpV)+EaATFgm'4:#]w(VEQ2=.Kj_L-@@G9i]szR6qq3/Xc6YoY=pPWw_vS2[HR7U/.U.#H?c3:#gn)#O!ZSLX?B6ibs<B[#1a5nA^5]!s9@OKt2eu7j[AhquBpuzOob@khBFNxYt*=ZK=!pXz-uj1Xh<nE2597blYK*8IJdOEAIXU%6HF2DE_->1Sa)nY*6E9FNxq7iFb%$wsE9?32>76$5zZG(xwRL`3l.'pIG%Y?$'N^fPRu53Jf[]:9i?'avn]@<.8)R*#Xj3yGK+FWzz_BTg@VTG)K!s.D*T'^GQ:[ky!/`nu$I@BK2mLx6<N44$Sa6i@:Q4Z0q4'WnB!sAX+*m#(D>lF4Ef.$ni8LZEPisC.Ahd*a0rJL(-S]aoP5-gaK)xWGT.kpjx[1uK4@nZXcmzb-mv1bjyBs9VP$*w'OJs@%cH/sz@rAE+A[z$U)^AHx%QA0$oaAX@sEm$xHR])<]SgXOAn+lsLX:Up`x5/3`^]1$sc3w2d; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +1ms [{},false,"https://simage2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTE5MjgmdGw9NDMyMDA=&piggybackCookie=uid:3c1c3f46-95fc-4602-b078-e8fce01d120e","https://simage2.pubmatic.com/AdServer/Pug?vcode=bz0yJnR5cGU9MSZjb2RlPTE5MjgmdGw9NDMyMDA=&piggybackCookie=uid:3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["no-store, no-cache, private"],"connection":["close"],"content-length":["42"],"content-type":["image/gif; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"p3p":["CP=\"NOI DSP COR LAW CUR ADMo DEVo TAIo PSAo PSDo IVAo IVDo HISo OTPo OUR SAMo BUS UNI COM NAV INT DEM CNT STA PRE LOC\""],"pragma":["no-cache"],"server":["Apache/2.2.24 (Unix) mod_ssl/2.2.24 OpenSSL/1.0.1e-fips mod_fastcgi/2.4.6"],"set-cookie":["KRTBCOOKIE_97=3385-uid:3c1c3f46-95fc-4602-b078-e8fce01d120e; domain=pubmatic.com; expires=Thu, 02-Jun-2016 08:54:28 GMT; path=/","PUBRETARGET=2626_1556296502; domain=pubmatic.com; expires=Fri, 26-Apr-2019 16:35:02 GMT; path=/","PUBMDCID=3; domain=pubmatic.com; expires=Mon, 01-Aug-2016 08:54:28 GMT; path=/"],"x-lat":["Pug22052:0:786"]},"image"]
  nightmare:log did-get-redirect-request +0ms [{},"https://gum.criteo.com/sync?c=6&r=1&a=1&u=https%3A%2F%2Fidsync.rlcdn.com%2F397596.gif%3Fpartner_uid%3D%40USERID%40","https://idsync.rlcdn.com/397596.gif?partner_uid=MhBDkkCqNQc4E27eSdbCF_X9epHppUs3",false,302,"GET","",{"cache-control":["private, max-age=0, no-cache, no-store, must-revalidate"],"content-length":["197"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://idsync.rlcdn.com/397596.gif?partner_uid=MhBDkkCqNQc4E27eSdbCF_X9epHppUs3"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/1014943/criteo_audience_mobile_US;criteo_seg=66472210;ord=a46f0bae-eb66-4700-b8b3-21679e9896a6?","https://pubads.g.doubleclick.net/activity;dc_iu=/1014943/criteo_audience_mobile_US;criteo_seg=66472210;ord=a46f0bae-eb66-4700-b8b3-21679e9896a6?",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://secure.adnxs.com/pxj","https://secure.adnxs.com/seg?add=2389630&t=2&redir=pxj",200,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:29 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-redirect-request +0ms [{},"https://ads.yahoo.com/cms/v1?esig=1~fa63d183df77c65a03eac82806b701b9c4f726b8&nwid=10000892938&sigv=1","https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved",false,302,"GET","",{"age":["0"],"cache-control":["private"],"connection":["keep-alive"],"content-length":["0"],"content-type":["text/plain; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"location":["https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved"],"p3p":["policyref=\"https://policies.yahoo.com/w3c/p3p.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE LOC GOV\""],"server":["ATS"],"strict-transport-security":["max-age=0"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://eb2.3lift.com/xuid?mid=2711&xuid=3c1c3f46-95fc-4602-b078-e8fce01d120e&dongle=013b","https://eb2.3lift.com/xuid?mid=2711&xuid=3c1c3f46-95fc-4602-b078-e8fce01d120e&dongle=013b",200,"GET","",{"cache-control":["no-store, no-cache, private, must-revalidate, max-age=0, s-maxage=0"],"connection":["keep-alive"],"content-length":["37"],"content-type":["image/gif"],"p3p":["policyref=\"http://cdn.3lift.com/w3c/p3p.xml\", CP=\"NON DSP COR NID OUR DEL SAM OTR UNR COM NAV INT DEM CNT STA PRE LOC OTC\""],"set-cookie":["tluid=14010532894904516244; Max-Age=7776000; Expires=Mon, 01 Aug 2016 08:54:28 GMT; Path=/; Domain=.3lift.com"],"x-rev":["4976cc1"],"x-served-by":["eb3.europe.prod"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=21551410;ord=33fdc5fb-6e8c-4f31-a2c0-4e8cdd070a18","https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=21551410;ord=33fdc5fb-6e8c-4f31-a2c0-4e8cdd070a18",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-redirect-request +0ms [{},"http://www.youtube.com/iframe_api?_=1462265659222","https://www.youtube.com/iframe_api?_=1462265659222",false,307,"GET","http://tiendas.mediamarkt.es/",{"location":["https://www.youtube.com/iframe_api?_=1462265659222"],"non-authoritative-reason":["HSTS"]}]
  nightmare:log did-fail-provisional-load +0ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-fail-load +0ms [{},-3,"","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",false]
  nightmare:log did-get-response-details +0ms [{},false,"http://tiendas.mediamarkt.es/ecommerce/ajax/json/leftNavi.cfm","http://tiendas.mediamarkt.es/ecommerce/ajax/json/leftNavi.cfm",200,"GET","http://tiendas.mediamarkt.es/",{"age":["0"],"connection":["Keep-alive"],"content-encoding":["gzip"],"content-type":["text/html;charset=UTF-8"],"date":["Tue, 03 May 2016 08:48:00 GMT"],"pragma":["public"],"transfer-encoding":["chunked"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-served-by":["20"],"x-session-id":["21814912_f6b0fa0aaa095aab-9A3FE693-D909-40A9-6393867649B868BB"],"x-varnish":["2311823186"]},"xhr"]
  nightmare:log did-get-response-details +1ms [{},false,"https://dis.criteo.com/dis/rtb/rightmedia/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved","https://ads.yahoo.com/pixel?id=1643278&id=2482076&t=2&piggyback=https%3A%2F%2Fads.yahoo.com%2Fcms%2Fv1%3Fesig%3D1~7315a025058f3128185459bfaf16e164414683fc%26nwid%3D10000545908%26sigv%3D1",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/1014943/criteo_audience_US;criteo_seg=62016010;ord=420ad78d-1f89-4562-97f8-ce97f0c9196c?","https://pubads.g.doubleclick.net/activity;dc_iu=/1014943/criteo_audience_US;criteo_seg=62016010;ord=420ad78d-1f89-4562-97f8-ce97f0c9196c?",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://x.bidswitch.net/sync?dsp_id=46&user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NOI DSP COR NID CURa ADMa DEVa PSAa PSDa OUR BUS COM INT OTC PUR STA\""],"pragma":["no-cache"],"server":["nginx/1.7.10"],"set-cookie":["tuuid=ed0ec49d-62d8-4c67-a4da-f48084302b86; path=/; expires=Wed, 03-May-2017 08:54:28 GMT; domain=.bidswitch.net"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/yahoogemini/cookiematch.aspx?xid=4JgvYi5tWPlbV6VF9pwXgved","https://sp.analytics.yahoo.com/spp.pl?a=10001287818027&.yp=39872&js=no",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=25867690;ord=41060fe4-69ed-494e-a203-6cd518143225","https://pubads.g.doubleclick.net/activity;dc_iu=/2605/mlb.mlb/CriteoAudience;dc_seg=25867690;ord=41060fe4-69ed-494e-a203-6cd518143225",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-redirect-request +0ms [{},"https://trc.taboola.com/sg/criteo/1/rtb/","https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510",false,302,"GET","",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Thu, 01 Jan 1970 00:00:00 GMT"],"location":["https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510"],"server":["nginx/1.7.9"],"set-cookie":["t_gid=ebcb6f30-52c1-4304-a818-479428e6e510;Path=/;Domain=.taboola.com;Expires=Wed, 03-May-2017 08:54:29 GMT","taboola_usg=EgIIARoMCOSpPhCGkD8QzKg_;Path=/;Domain=.taboola.com;Expires=Wed, 03-May-2017 08:54:29 GMT"],"x-cdn":["Served-By-Akamai"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://pubads.g.doubleclick.net/activity;dc_iu=/4204/pand.retargeting;dc_seg=23935210;ord=5026b039-5184-4b42-834b-842990998f7d","https://pubads.g.doubleclick.net/activity;dc_iu=/4204/pand.retargeting;dc_seg=23935210;ord=5026b039-5184-4b42-834b-842990998f7d",200,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["cafe"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/taboola/cookiematch.aspx?partner_uid=ebcb6f30-52c1-4304-a818-479428e6e510","https://trc.taboola.com/sg/criteo/1/rtb/",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://r.casalemedia.com/rum?cm_dsp_id=20&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e","https://r.casalemedia.com/rum?cm_dsp_id=20&external_user_id=3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"cache-control":["max-age=0, no-cache, no-store"],"connection":["keep-alive"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Tue, 03 May 2016 08:54:29 GMT"],"p3p":["policyref=\"/w3c/p3p.xml\", CP=\"NOI DSP COR DEVa TAIa OUR BUS UNI\""],"pragma":["no-cache"],"server":["Apache"],"set-cookie":["CMID=VweJsblQJEMAAD-fnXMAAAAM;domain=casalemedia.com;path=/;expires=Wed, 03 May 2017 08:54:29 GMT","CMPS=230;domain=casalemedia.com;path=/;expires=Mon, 01 Aug 2016 08:54:29 GMT","CMST=VyhnRFcoZ0UA;domain=casalemedia.com;path=/;expires=Wed, 04 May 2016 08:54:29 GMT","CMSC=VyhnRQ**;domain=casalemedia.com;path=/;","CMRUM3=5a57207b9f2760385A17C635841F57E54DB8A5027F7A36&46572092a227604a61710e-63ae-4def-8ca5-734dc833a919&4757233ec82760Vx9gfgAAAOSh2ClB.CAESEMGrg4fdcD0Iz9oc6OSeD-8&0257207e512760df726fda-73ce-4fdd-b89a-dab3aa834689&4857207c2427600a5a7a1a-0c54-11e6-be90-1217c0005024&1e57233ed102d00fffa78e-0c53-11e6-a8c0-00259035d5c6&6457207e512760c40f2bcde3ce1d7c4e0a563e738c6986&375723375b2760e93f197308321213-060e064510f8fc2d&525722373e05a00&1b57209ad32760o8c9ne5ehnoi&1c572092a22760d2102eb9-8710-48bf-c845-7039e545c8b8&3957233e452760637611197687692908&2857207e51276043920645-1924-4c24-b9ef-d255c146531d&3d5720b5ce2760f8qhrlnngu0wu&e65720c95e27600&145728674527603c1c3f46-95fc-4602-b078-e8fce01d120e&c95720c95ec3500&0a5720e83b276000000000-0000-0000-0000-0019a001487d&1f57207e512760Q5149698171652853682&35572337a127603c1c3f46-95fc-4602-b078-e8fce01d120e&cf5720c95e05a00&4f57207e512760c16bc0ae-7571-4cb2-946d-b7b5affa1868&3057207c00276083d6edbb5db441b79f6e0387d69f5aa3&cd5720c95e05a00&2a5720e7fe2760292E025B-E1CA-5ECD-B227-53CDF7ACE4D7&4d57207ba027608715c8d2f9a57a5e34d8adfc3aa00bcb&2e5720e86327601267099506496825196&605722374027606348_69214&415722373e05a0AQENMGwVbfC5GAEBAQErAQEBAQE&6957233e852760YzgyY2Y4NmE3ODcwMjcwMWRiODY3NjRkZWQ3NTVjOGU&2757207b9f27604a61710e-63ae-4def-8ca5-734dc833a919&24572336e927603c1c3f46-95fc-4602-b078-e8fce01d120e&035720c6b427603766571f-6050-4a00-85c5-b4e4f7a521d3&4057207c252760b4f1ba33-1602-433a-bfc8-a2fc69a1b58f&61572092a22760BGkrb3qlTINR5b6yC6R807EFtuCx&29572092a227600a5a7a1a-0c54-11e6-be90-1217c0005024&2f57207c252760EXEeQAZQ1AOywc5&d35720c95e27600&51571f84382760vwFdvLIPD-qnBAi6vFdA7-gOXLmnD1Xv7lNTCWP5&265720c8b42760f8qhrlnngu0wu&0457207ba127607583537490505916663&2d5720b3f12760CAESEJGJzo-UXsYmtjRLiLwZtCU&495722373b05a00&425722381f0001jd300014616742420094&3e5722381f0001jd300014616742420094&3657223869276013775344891926931912;domain=casalemedia.com;path=/;expires=Wed, 03 May 2017 08:54:29 GMT"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://us-u.openx.net/w/1.0/sd?id=537072953&val=3c1c3f46-95fc-4602-b078-e8fce01d120e&c=us","https://us-u.openx.net/w/1.0/sd?id=537072953&val=3c1c3f46-95fc-4602-b078-e8fce01d120e&c=us",200,"GET","",{"cache-control":["private, max-age=0, no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"CUR ADM OUR NOR STA NID\""],"pragma":["no-cache"],"server":["OXGW/11.17.1"],"vary":["Accept"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://secure.adnxs.com/setuid?entity=52&code=3c1c3f46-95fc-4602-b078-e8fce01d120e&seg=95287","https://secure.adnxs.com/setuid?entity=52&code=3c1c3f46-95fc-4602-b078-e8fce01d120e&seg=95287",200,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/5N:5[f:4Z(+M<Md%]/Q7r^B<PuvKDu'8i>FiP0xGu@<8(G1m?3g%[u%>i<?t=[Dfjbz+f]x-G`7<+?WkcG[QV$5$wVc=e.ZN:w!JDo.@pQscM6?Br_B'JT@D2XhmpFLc=b41_MygZsM=DD6)/`!nioZw^LI/dmBEm2H5#]id`5.ypvHh*Jj)vmV19jVI3R2]25Q^''<Z)0wDI$:L6>k?I7olg7+C]-D1nRxI1Ok)=2*^I%_Ki/I8#TL6[A7tB0VQLf*b2bp'AFIk4bl:E'zr*14@zSa@-YOtswkObYBD04Uw[R7T2y=oe$idF!WWYeY1wBTv.R)9!lLNBRf>p:]3A0j2XPRZH$bPo!p0'1oSfQqM%gYr7hQ07]4o3YRBBKnVp28M16`<jQk3yhhM`A[YF9F6LLgV?`]ue=pgv^M]LI+XHN-8:3fkak?+@]+A$mk13qE(Eq@<-fE@FSrhMM-X*yA?+_0WfV=.5)blKTBVF(Rw[dS[yThq!3wUPa=Pf%j[qB'6OdQw6`R7r!@jlLhQNf:P>4W5ZlG<ef!ie(0w[h%^Ei'ljl`cXuH/(TXtl5T+]a%uJ]vs3TV(FwiX!<=5n!uG>aB=st$Y3uCbPek!H.]Eg=(Owir_H$6rPdGJ!Iu6!wV<*O`Lib8X9ItlWM^NW5Q=*ODV3bc2s5S]d$g%0TEt1zrSx-hC>GOx_15'At?SJ.89iq[FCpQ]FIuFMc13-WVrUW-]%>*WIcBV-`G=YS%u%J67fsPNSSajH=S2YK6@q<mvho:?#8E)<=D-/a!CS4zJ6YkhcmLNt]+eZJ)7riS09?>I`:O[M(uFsRAEu$pD2UPiSW<<dR`P_TB_i'`OAiS)0ZfUe5.ncuG2srDE1':97*sr.v<8*m`9MzZP.HKGrB$'X(rI4#6WR74=FZFBvYozASa^DS)Ub/!bT:g.*5YKIjLxY_@EM$CjE]TF4W(18D=wrTRvz4m)_yxD<K%y-k7o[T9t2DWM[nGlBVe-#zQHJPtj8Vd8EP!qT?3FPh:ENl(7]e!HF9n^vd./PGH<bzkf**<]D*s`+T'%h8i%TD]'N/X:-'2xauJTDagm1c!a)+[!rLa12<Df2@7hhYuv/jB!/uudB)Cm%-2Bq8H(H0d.Kf!C*'+`qQ=Kei`gf/N1Oh(>$N@6B#<3WE:?3`Vw)flao<+qCa`ySz4Xg0[>otv/avCW='0HN!zdRXMnX99XB($^fPIQ$X+JTB!pBXysxDS7<hdMUsGTVwy3)mktI@'<ZdY5_:@c#0txW9_]*IxD<_E=MP*C$@XmP:RqqBhq'*d>TK<joP'fLc@QPh0318@$qPyI%BeYfm^2@w$q1U6w]rP2rxACwwGCH.XQOF; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=14","https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=14",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["0"],"p3p":["CP=\"NOI CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Rubicon Project"],"set-cookie":["rpb=8981%3D1%265421%3D1%266359%3D1%266434%3D1%26189868%3D1%269019%3D1%2613368%3D1%2612244%3D1%266433%3D1%2613466%3D1%2613508%3D1%2612370%3D1%2612368%3D1%267884%3D1%267883%3D1%267882%3D1%26112468%3D1%2613746%3D1%2613752%3D1%2613750%3D1%2612372%3D1%26194538%3D1%264894%3D1%264222%3D1%267249%3D1%2611203%3D1%2631950%3D1%2613490%3D1%2670596%3D1%267751%3D1%267727%3D1%2671604%3D1%26183462%3D1%266286%3D1%2682080%3D1%26186028%3D1%262372%3D1%26203184%3D1%26215638%3D1%26108792%3D1%26212364%3D1%26143762%3D1%26143760%3D1%26212368%3D1%26159872%3D1%262374%3D1%2614965%3D1%2617149%3D1%265364%3D1%269073%3D1%2650194%3D1%26100834%3D1%26144598%3D1%2614459%3D1%2615796%3D1%267859%3D1%267935%3D1%2642062%3D1%2616728%3D1%26109108%3D1%2645396%3D1%2645392%3D1%2617255%3D1%26124944%3D1%264210%3D1%2697126%3D1%2645398%3D1%26111756%3D1%267975%3D1%266564%3D1%2661894%3D1%2616386%3D1%264705%3D1%2650978%3D1%2675676%3D1%26102574%3D1%26101402%3D1%2664580%3D1%2666372%3D1%26203918%3D1%26203866%3D1%26203952%3D1%26203878%3D1%26203914%3D1%26203900%3D1%26113624%3D1; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:29 GMT; Path=/","put_2054=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Tue, 17-May-2016 08:54:28 GMT; Path=/","rpx=8981%3D54938%2C434%2C3%2C%2C%265421%3D54938%2C598%2C62%2C%2C%266359%3D54938%2C504%2C17%2C%2C%266434%3D54938%2C504%2C71%2C%2C%26189868%3D54938%2C0%2C1%2C%2C%269019%3D54943%2C455%2C6%2C%2C%2613368%3D54943%2C498%2C8%2C%2C%2612244%3D54943%2C498%2C14%2C%2C%266433%3D54943%2C499%2C42%2C%2C%2613466%3D54943%2C498%2C13%2C%2C%2613508%3D54943%2C498%2C8%2C%2C%2612370%3D54943%2C499%2C12%2C%2C%2612368%3D54943%2C478%2C5%2C%2C%267884%3D54943%2C499%2C16%2C%2C%267883%3D54943%2C499%2C22%2C%2C%267882%3D54943%2C498%2C8%2C%2C%26112468%3D54943%2C499%2C24%2C%2C%2613746%3D54944%2C498%2C21%2C%2C%2613752%3D55372%2C70%2C17%2C%2C%2613750%3D55372%2C70%2C8%2C%2C%2612372%3D55372%2C70%2C12%2C%2C%26194538%3D55372%2C70%2C93%2C%2C%264894%3D55372%2C27%2C6%2C%2C%264222%3D55372%2C20%2C2%2C%2C%267249%3D55392%2C31%2C2%2C%2C%2611203%3D55392%2C31%2C2%2C%2C%2631950%3D55392%2C4%2C2%2C%2C%2613490%3D55392%2C50%2C17%2C%2C%2670596%3D55392%2C0%2C1%2C%2C%267751%3D55392%2C1%2C2%2C%2C%267727%3D55392%2C0%2C1%2C%2C%2671604%3D55393%2C0%2C1%2C%2C%26183462%3D55393%2C0%2C1%2C%2C%266286%3D55393%2C0%2C1%2C%2C%2682080%3D55393%2C0%2C1%2C%2C%26186028%3D55393%2C0%2C1%2C%2C%262372%3D55394%2C2%2C2%2C29%2C%26203184%3D55394%2C2%2C2%2C29%2C%26215638%3D55394%2C2%2C2%2C29%2C%26108792%3D55394%2C2%2C2%2C29%2C%26212364%3D55394%2C2%2C2%2C29%2C%26143762%3D55394%2C2%2C2%2C29%2C%26143760%3D55394%2C2%2C2%2C29%2C%26212368%3D55394%2C2%2C2%2C29%2C%26159872%3D55394%2C2%2C2%2C29%2C%262374%3D55394%2C2%2C2%2C29%2C%2614965%3D55394%2C0%2C1%2C%2C%2617149%3D55394%2C0%2C1%2C%2C%265364%3D55394%2C0%2C1%2C90%2C%269073%3D55394%2C30%2C11%2C%2C%2650194%3D55396%2C2%2C3%2C%2C%26100834%3D55396%2C2%2C2%2C%2C%26144598%3D55396%2C0%2C1%2C%2C%2614459%3D55396%2C0%2C1%2C%2C%2615796%3D55396%2C0%2C1%2C28%2C%267859%3D55396%2C2%2C2%2C29%2C%267935%3D55396%2C0%2C1%2C%2C%2642062%3D55396%2C0%2C1%2C90%2C%2616728%3D55398%2C0%2C1%2C27%2C%26109108%3D55398%2C0%2C1%2C27%2C%2645396%3D55398%2C0%2C2%2C30%2C%2645392%3D55398%2C0%2C2%2C30%2C%2617255%3D55398%2C26%2C2%2C30%2C%26124944%3D55398%2C0%2C1%2C%2C%264210%3D55398%2C0%2C1%2C%2C%2697126%3D55398%2C26%2C4%2C30%2C%2645398%3D55398%2C26%2C4%2C30%2C%26111756%3D55398%2C0%2C1%2C%2C%267975%3D55398%2C0%2C1%2C10%2C%266564%3D55399%2C0%2C2%2C%2C%2661894%3D55399%2C0%2C1%2C%2C%2616386%3D55400%2C0%2C1%2C13%2C%264705%3D55416%2C0%2C1%2C29%2C%2650978%3D55421%2C0%2C1%2C28%2C%2675676%3D55421%2C0%2C1%2C28%2C%26102574%3D55421%2C0%2C1%2C28%2C%26101402%3D55421%2C0%2C1%2C28%2C%2664580%3D55421%2C0%2C1%2C28%2C%2666372%3D55421%2C0%2C1%2C28%2C%26203918%3D55421%2C0%2C1%2C28%2C%26203866%3D55421%2C0%2C1%2C28%2C%26203952%3D55421%2C0%2C1%2C28%2C%26203878%3D55421%2C0%2C1%2C28%2C%26203914%3D55421%2C0%2C1%2C28%2C%26203900%3D55421%2C0%2C1%2C28%2C%26113624%3D55442%2C0%2C1%2C29%2C; Domain=.pixel.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:29 GMT; Path=/","khaos=IMRKV2IF-1A-5DAO; Domain=.rubiconproject.com; Expires=Tue, 01-Nov-2016 20:54:29 GMT; Path=/"],"x-rphost":["tnNnTiY_nVPQbFjrxp6WVA"]},"image"]
  nightmare:log did-get-redirect-request +1ms [{},"https://secure.adnxs.com/seg?add=95287&redir=https%3A%2F%2Fsecure.adnxs.com%2Fgetuid%3Fhttps%3A%2F%2Fdis.criteo.com%2Fdis%2Frtb%2Fappnexus%2Fcookiematch.aspx%3Fappnxsid%3D%24UID","https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["anj=dTM7k!M4/C?k/5N:5[f:4Z(+M<Md%]/Q7r^B<PuvKDu'8i>FiP0xGu@<8(G1m?3g%[u%>i<?t=[Dfjbz+f]x-G`7<+?WkcG[QV$5$wVc=e.ZN:w!JDo.@pQscM6?Br_B'JT@D2XhmpFLc=b41_MygZsM=DD6)/`!nioZw^LI/dmBEm2H5#]id`5.ypvHh*Jj)vmV19jVI3R2]25Q^''<Z)0wDI$:L6>k?I7olg7+C]-D1nRxI1Ok)=2*^I%_Ki/I8#TL6[A7tB0VQLf*b2bp'AFIk4bl:E'zr*14@zSa@-YOtswkObYBD04Uw[R7T2y=oe$idF!WWYeY1wBTv.R)9!lLNBRf>p:]3A0j2XPRZH$bPo!p0'1oSfQqM%gYr7hQ07]4o3YRBBKnVp28M16`<jQk3yhhM`A[YF9F6LLgV?`]ue=pgv^M]LI+XHN-8:3fkak?+@]+A$mk13qE(Eq@<-fE@FSrhMM-X*yA?+_0WfV=.5)blKTBVF(Rw[dS[yThq!3wUPa=Pf%j[qB'6OdQw6`R7r!@jlLhQNf:P>4W5ZlG<ef!ie(0w[h%^Ei'ljl`cXuH/(TXtl5T+]a%uJ]vs3TV(FwiX!<=5n!uG>aB=st$Y3uCbPek!H.]Eg=(Owir_H$6rPdGJ!Iu6!wV<*O`Lib8X9ItlWM^NW5Q=*ODV3bc2s5S]d$g%0TEt1zrSx-hC>GOx_15'At?SJ.89iq[FCpQ]FIuFMc13-WVrUW-]%>*WIcBV-`G=YS%u%J67fsPNSSajH=S2YK6@q<mvho:?#8E)<=D-/a!CS4zJ6YkhcmLNt]+eZJ)7riS09?>I`:O[M(uFsRAEu$pD2UPiSW<<dR`P_TB_i'`OAiS)0ZfUe5.ncuG2srDE1':97*sr.v<8*m`9MzZP.HKGrB$'X(rI4#6WR74=FZFBvYozASa^DS)Ub/!bT:g.*5YKIjLxY_@EM$CjE]TF4W(18D=wrTRvz4m)_yxD<K%y-k7o[T9t2DWM[nGlBVe-#zQHJPtj8Vd8EP!qT?3FPh:ENl(7]e!HF9n^vd./PGH<bzkf**<]D*s`+T'%h8i%TD]'N/X:-'2xauJTDagm1c!a)+[!rLa12<Df2@7hhYuv/jB!/uudB)Cm%-2Bq8H(H0d.Kf!C*'+`qQ=Kei`gf/N1Oh(>$N@6B#<3WE:?3`Vw)flao<+qCa`ySz4Xg0[>otv/avCW='0HN!zdRXMnX99XB($^fPIQ$X+JTB!pBXysxDS7<hdMUsGTVwy3)mktI@'<ZdY5_:@c#0txW9_]*IxD<_E=MP*C$@XmP:RqqBhq'*d>TK<joP'fLc@QPh0318@$qPyI%BeYfm^2@w$q1U6w]rP2rxACwwGCH.XQOF; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly","sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-redirect-request +0ms [{},"https://cm.g.doubleclick.net/pixel?google_nid=cjp&google_sc&google_ula=913071&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_cm&google_hm=Rj8cPPyVAkaweOj84B0SDg","https://dis.criteo.com/dis/rtb/google/cookiematch.aspx?id=&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_gid=CAESEMBwXoi3GUHw0s-ZMnL_qes&google_cver=1&google_ula=913071,0",false,302,"GET","",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache, must-revalidate"],"content-length":["394"],"content-type":["text/html; charset=UTF-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Fri, 01 Jan 1990 00:00:00 GMT"],"location":["https://dis.criteo.com/dis/rtb/google/cookiematch.aspx?id=&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_gid=CAESEMBwXoi3GUHw0s-ZMnL_qes&google_cver=1&google_ula=913071,0"],"p3p":["policyref=\"https://googleads.g.doubleclick.net/pagead/gcn_p3p_.xml\", CP=\"CURa ADMa DEVa TAIo PSAo PSDo OUR IND UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\""],"pragma":["no-cache"],"server":["HTTP server (unknown)"],"status":["302"],"x-xss-protection":["1; mode=block"]}]
  nightmare:log did-get-redirect-request +0ms [{},"https://secure.adnxs.com/getuid?https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=$UID","https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196",false,302,"GET","",{"cache-control":["no-store, no-cache, private"],"content-length":["0"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:30 GMT"],"expires":["Sat, 15 Nov 2008 16:00:00 GMT"],"location":["https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196"],"p3p":["policyref=\"http://cdn.adnxs.com/w3c/policy/p3p.xml\", CP=\"NOI DSP COR ADM PSAo PSDo OURo SAMo UNRo OTRo BUS COM NAV DEM STA PRE\""],"pragma":["no-cache"],"set-cookie":["sess=1; Path=/; Max-Age=86400; Expires=Wed, 04-May-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly","uuid2=1267099506496825196; Path=/; Max-Age=7776000; Expires=Mon, 01-Aug-2016 08:54:30 GMT; Domain=.adnxs.com; HttpOnly"],"x-xss-protection":["0"]}]
  nightmare:log did-get-response-details +0ms [{},false,"https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30","https://pixel.rubiconproject.com/tap.php?v=5421&nid=2054&put=3c1c3f46-95fc-4602-b078-e8fce01d120e&expires=30",200,"GET","",{"cache-control":["no-cache, no-store, must-revalidate"],"connection":["keep-alive"],"content-length":["42"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["0"],"p3p":["CP=\"NOI CURa ADMa DEVa TAIa OUR BUS IND UNI COM NAV INT\""],"pragma":["no-cache"],"server":["Rubicon Project"],"set-cookie":["rpb=8981%3D1%265421%3D1%266359%3D1%266434%3D1%26189868%3D1%269019%3D1%2613368%3D1%2612244%3D1%266433%3D1%2613466%3D1%2613508%3D1%2612370%3D1%2612368%3D1%267884%3D1%267883%3D1%267882%3D1%26112468%3D1%2613746%3D1%2613752%3D1%2613750%3D1%2612372%3D1%26194538%3D1%264894%3D1%264222%3D1%267249%3D1%2611203%3D1%2631950%3D1%2613490%3D1%2670596%3D1%267751%3D1%267727%3D1%2671604%3D1%26183462%3D1%266286%3D1%2682080%3D1%26186028%3D1%262372%3D1%26203184%3D1%26215638%3D1%26108792%3D1%26212364%3D1%26143762%3D1%26143760%3D1%26212368%3D1%26159872%3D1%262374%3D1%2614965%3D1%2617149%3D1%265364%3D1%269073%3D1%2650194%3D1%26100834%3D1%26144598%3D1%2614459%3D1%2615796%3D1%267859%3D1%267935%3D1%2642062%3D1%2616728%3D1%26109108%3D1%2645396%3D1%2645392%3D1%2617255%3D1%26124944%3D1%264210%3D1%2697126%3D1%2645398%3D1%26111756%3D1%267975%3D1%266564%3D1%2661894%3D1%2616386%3D1%264705%3D1%2650978%3D1%2675676%3D1%26102574%3D1%26101402%3D1%2664580%3D1%2666372%3D1%26203918%3D1%26203866%3D1%26203952%3D1%26203878%3D1%26203914%3D1%26203900%3D1%26113624%3D1; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:29 GMT; Path=/","put_2054=3c1c3f46-95fc-4602-b078-e8fce01d120e; Domain=.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:28 GMT; Path=/","rpx=8981%3D54938%2C434%2C3%2C%2C%265421%3D54938%2C598%2C63%2C%2C%266359%3D54938%2C504%2C17%2C%2C%266434%3D54938%2C504%2C71%2C%2C%26189868%3D54938%2C0%2C1%2C%2C%269019%3D54943%2C455%2C6%2C%2C%2613368%3D54943%2C498%2C8%2C%2C%2612244%3D54943%2C498%2C14%2C%2C%266433%3D54943%2C499%2C42%2C%2C%2613466%3D54943%2C498%2C13%2C%2C%2613508%3D54943%2C498%2C8%2C%2C%2612370%3D54943%2C499%2C12%2C%2C%2612368%3D54943%2C478%2C5%2C%2C%267884%3D54943%2C499%2C16%2C%2C%267883%3D54943%2C499%2C22%2C%2C%267882%3D54943%2C498%2C8%2C%2C%26112468%3D54943%2C499%2C24%2C%2C%2613746%3D54944%2C498%2C21%2C%2C%2613752%3D55372%2C70%2C17%2C%2C%2613750%3D55372%2C70%2C8%2C%2C%2612372%3D55372%2C70%2C12%2C%2C%26194538%3D55372%2C70%2C93%2C%2C%264894%3D55372%2C27%2C6%2C%2C%264222%3D55372%2C20%2C2%2C%2C%267249%3D55392%2C31%2C2%2C%2C%2611203%3D55392%2C31%2C2%2C%2C%2631950%3D55392%2C4%2C2%2C%2C%2613490%3D55392%2C50%2C17%2C%2C%2670596%3D55392%2C0%2C1%2C%2C%267751%3D55392%2C1%2C2%2C%2C%267727%3D55392%2C0%2C1%2C%2C%2671604%3D55393%2C0%2C1%2C%2C%26183462%3D55393%2C0%2C1%2C%2C%266286%3D55393%2C0%2C1%2C%2C%2682080%3D55393%2C0%2C1%2C%2C%26186028%3D55393%2C0%2C1%2C%2C%262372%3D55394%2C2%2C2%2C29%2C%26203184%3D55394%2C2%2C2%2C29%2C%26215638%3D55394%2C2%2C2%2C29%2C%26108792%3D55394%2C2%2C2%2C29%2C%26212364%3D55394%2C2%2C2%2C29%2C%26143762%3D55394%2C2%2C2%2C29%2C%26143760%3D55394%2C2%2C2%2C29%2C%26212368%3D55394%2C2%2C2%2C29%2C%26159872%3D55394%2C2%2C2%2C29%2C%262374%3D55394%2C2%2C2%2C29%2C%2614965%3D55394%2C0%2C1%2C%2C%2617149%3D55394%2C0%2C1%2C%2C%265364%3D55394%2C0%2C1%2C90%2C%269073%3D55394%2C30%2C11%2C%2C%2650194%3D55396%2C2%2C3%2C%2C%26100834%3D55396%2C2%2C2%2C%2C%26144598%3D55396%2C0%2C1%2C%2C%2614459%3D55396%2C0%2C1%2C%2C%2615796%3D55396%2C0%2C1%2C28%2C%267859%3D55396%2C2%2C2%2C29%2C%267935%3D55396%2C0%2C1%2C%2C%2642062%3D55396%2C0%2C1%2C90%2C%2616728%3D55398%2C0%2C1%2C27%2C%26109108%3D55398%2C0%2C1%2C27%2C%2645396%3D55398%2C0%2C2%2C30%2C%2645392%3D55398%2C0%2C2%2C30%2C%2617255%3D55398%2C26%2C2%2C30%2C%26124944%3D55398%2C0%2C1%2C%2C%264210%3D55398%2C0%2C1%2C%2C%2697126%3D55398%2C26%2C4%2C30%2C%2645398%3D55398%2C26%2C4%2C30%2C%26111756%3D55398%2C0%2C1%2C%2C%267975%3D55398%2C0%2C1%2C10%2C%266564%3D55399%2C0%2C2%2C%2C%2661894%3D55399%2C0%2C1%2C%2C%2616386%3D55400%2C0%2C1%2C13%2C%264705%3D55416%2C0%2C1%2C29%2C%2650978%3D55421%2C0%2C1%2C28%2C%2675676%3D55421%2C0%2C1%2C28%2C%26102574%3D55421%2C0%2C1%2C28%2C%26101402%3D55421%2C0%2C1%2C28%2C%2664580%3D55421%2C0%2C1%2C28%2C%2666372%3D55421%2C0%2C1%2C28%2C%26203918%3D55421%2C0%2C1%2C28%2C%26203866%3D55421%2C0%2C1%2C28%2C%26203952%3D55421%2C0%2C1%2C28%2C%26203878%3D55421%2C0%2C1%2C28%2C%26203914%3D55421%2C0%2C1%2C28%2C%26203900%3D55421%2C0%2C1%2C28%2C%26113624%3D55442%2C0%2C1%2C29%2C; Domain=.pixel.rubiconproject.com; Expires=Thu, 02-Jun-2016 08:54:29 GMT; Path=/","khaos=IMRKV2IF-1A-5DAO; Domain=.rubiconproject.com; Expires=Tue, 01-Nov-2016 20:54:29 GMT; Path=/"],"x-rphost":["tnNnTiY_nVPQbFjrxp6WVA"]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://dis.criteo.com/dis/rtb/google/cookiematch.aspx?id=&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_gid=CAESEMBwXoi3GUHw0s-ZMnL_qes&google_cver=1&google_ula=913071,0","https://cm.g.doubleclick.net/pixel?google_nid=cjp&google_sc&google_ula=913071&CriteoUserId=3c1c3f46-95fc-4602-b078-e8fce01d120e&google_cm&google_hm=Rj8cPPyVAkaweOj84B0SDg",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://dis.criteo.com/dis/rtb/appnexus/cookiematch.aspx?appnxsid=1267099506496825196","https://secure.adnxs.com/seg?add=95287&redir=https%3A%2F%2Fsecure.adnxs.com%2Fgetuid%3Fhttps%3A%2F%2Fdis.criteo.com%2Fdis%2Frtb%2Fappnexus%2Fcookiematch.aspx%3Fappnxsid%3D%24UID",200,"GET","",{"cache-control":["no-cache"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:28 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]},"image"]
  nightmare:log did-get-response-details +0ms [{},false,"https://sync.1rx.io/usersync/criteo/3c1c3f46-95fc-4602-b078-e8fce01d120e","https://sync.1rx.io/usersync/criteo/3c1c3f46-95fc-4602-b078-e8fce01d120e",200,"GET","",{"connection":["keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"server":["nginx"]},"image"]
Window object available for: https://teamtreehouse.com/
Finished processing: https://teamtreehouse.com/
  nightmare:log did-get-response-details +41ms [{},false,"https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1","https://www.youtube.com/embed/-MMIjtLXN2g?rel=0&controls=0&showinfo=0&theme=light&modestbranding=1&autoplay=1",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-encoding":["gzip"],"content-length":["12767"],"content-type":["text/html; charset=utf-8"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"strict-transport-security":["max-age=604800"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"subFrame"]
  nightmare:log did-get-response-details +5ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.png","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.png",200,"GET","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/skin.css",{"accept-ranges":["bytes"],"age":["839"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-length":["10518"],"content-type":["image/png"],"date":["Tue, 03 May 2016 08:48:00 GMT"],"last-modified":["Sun, 28 Sep 2014 09:02:40 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2311823476 2311724177"]},"image"]
  nightmare:log did-frame-finish-load +15ms [{},false]
  nightmare:log did-get-response-details +11ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/css/blank.gif","http://tiendas.mediamarkt.es/static/index/slider/css/blank.gif",404,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["642"],"connection":["Keep-alive"],"content-length":["0"],"date":["Tue, 03 May 2016 08:48:00 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2311823480 2311747681"]},"image"]
  nightmare:log did-frame-finish-load +0ms [{},false]
  nightmare:log did-get-response-details +23ms [{},false,"http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/shadow.png","http://tiendas.mediamarkt.es/static/index/slider/skins/borderlesslight3d/shadow.png",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"age":["115"],"cache-control":["public,max-age=1209600"],"connection":["Keep-alive"],"content-length":["8242"],"content-type":["image/png"],"date":["Tue, 03 May 2016 08:48:00 GMT"],"last-modified":["Fri, 12 Apr 2013 14:07:00 GMT"],"vary":["User-Agent"],"via":["1.1 varnish","1.1 ID-0002262060300554 uproxy-2"],"x-varnish":["2311823481 2311809352"]},"image"]
  nightmare:log did-get-response-details +4ms [{},false,"https://assets.empathybroker.com/clients/mediamarkt/js/eb.min.js?_=1462265659223","https://assets.empathybroker.com/clients/mediamarkt/js/eb.min.js?_=1462265659223",200,"GET","http://tiendas.mediamarkt.es/",{"age":["82585"],"connection":["keep-alive"],"content-encoding":["gzip"],"content-type":["application/javascript"],"date":["Mon, 02 May 2016 09:58:05 GMT"],"last-modified":["Mon, 02 May 2016 09:54:40 GMT"],"server":["AmazonS3"],"transfer-encoding":["chunked"],"vary":["Accept-Encoding"],"via":["1.1 699f29706ac19519e0b631e243565331.cloudfront.net (CloudFront)"],"x-amz-cf-id":["FB00F4Px0KwZrpj69fLrBeHzAcr-3WHs8V0pDs7XuHWND4-uxxG_lg=="],"x-cache":["Hit from cloudfront"]},"script"]
  nightmare:log did-get-response-details +51ms [{},false,"https://specials.mediamarkt.es/search/css/style.css","https://specials.mediamarkt.es/search/css/style.css",200,"GET","http://tiendas.mediamarkt.es/",{"accept-ranges":["bytes"],"cache-control":["max-age=1209600"],"connection":["close"],"content-length":["21115"],"content-type":["text/css"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"etag":["\"527b-53165beb26ceb\""],"expires":["Tue, 17 May 2016 08:54:29 GMT"],"last-modified":["Tue, 26 Apr 2016 16:25:44 GMT"],"server":["Apache"],"x-served-by":["web01"]},"stylesheet"]
  nightmare:log did-get-response-details +20ms [{},false,"https://www.facebook.com/impression.php/f270bda4fb25e4/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D","https://www.facebook.com/impression.php/f270bda4fb25e4/?lid=115&payload=%7B%22source%22%3A%22jssdk%22%7D",200,"GET","http://specials.mediamarkt.es/facebook/",{"cache-control":["private, no-cache, no-store, must-revalidate"],"content-length":["43"],"content-type":["image/gif"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Sat, 01 Jan 2000 00:00:00 GMT"],"pragma":["no-cache"],"status":["200"],"x-content-type-options":["nosniff"],"x-fb-debug":["wVc57PHvRnt92Cew27A63UuobsLD6md//fLM63ml5UV3On0G1IMN0afAByrB7AHQMqmJqHJOBFHHxsvQ/Elnmw=="]},"image"]
  nightmare:log did-get-response-details +1ms [{},false,"https://www.youtube.com/iframe_api?_=1462265659222","http://www.youtube.com/iframe_api?_=1462265659222",200,"GET","http://tiendas.mediamarkt.es/",{"alt-svc":["quic=\":443\"; ma=2592000; v=\"33,32,31,30,29,28,27,26,25\""],"alternate-protocol":["443:quic"],"cache-control":["no-cache"],"content-length":["745"],"content-type":["application/javascript"],"date":["Tue, 03 May 2016 08:54:29 GMT"],"expires":["Tue, 27 Apr 1971 19:44:06 EST"],"server":["Ytfe_Worker"],"status":["200"],"x-content-type-options":["nosniff"],"x-xss-protection":["1; mode=block; report=https://www.google.com/appserve/security-bugs/log/youtube"]},"script"]
events.js:141
      throw er; // Unhandled 'error' event
      ^

Error: IPC channel is already disconnected
    at ChildProcess.target.disconnect (internal/child_process.js:637:26)
    at Pipe.channel.onread (internal/child_process.js:449:14)
```

The command I used was `DEBUG=nightmare:*,electron:* node --harmony nightmare.js` and my `package.json`:

``` json
{
  "name": "node.js-test-files",
  "version": "1.0.0",
  "description": "Testing Folder",
  "main": "test.js",
  "scripts": {
    "test": "node test.js"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "async": "^2.0.0-rc.3",
    "nightmare": "^2.3.4"
  }
}

```
 @JWMarchant Have you found a solution? I'm seeing the same problem. It has something to do with the foreach loop. If you run the loop once you don't see the error.
 Hi @misbach. Not yet, no, but in my other issue (#612) @rosshinkley and @Mr0grog seemed to be onto something and there is a pull request (#640) that might solve this.
 @JWMarchant @misbach does using the branch for #640 alleviate this issue for you?
 Hi @rosshinkley & @Mr0grog,

Unfortunately it seems I'm still getting the error.

Here is my code:

``` javascript
var Nightmare = require('nightmare');
var async = require('async');

var urls = [
    'https://www.spotify.com/uk/',
    'http://tiendas.mediamarkt.es/',
    'https://www.kairos.com/',
    'https://society6.com/',
    'https://teamtreehouse.com/',
    'https://www.npmjs.com/',
    'http://imgur.com/',
    'http://conversion.com',
    'http://adidas.com',
    'http://adp.com',
    'http://adroll.com',
    'http://aetv.com',
    'http://aflcio.org',
    'http://afvclub.com',
    'http://alaska.edu',
    'http://alexa.com',
    'http://allyou.com',
    'http://american.edu',
    'http://americanlanternalerts.com',
    'http://amleo.com',
    'http://animoto.com',
    'http://answerbag.com',
    'http://apartmentguide.com',
    'http://apartmentlist.com',
    'http://apartmentratings.com',
    'http://app-approved.com',
    'http://app.net',
    'http://areyoulivingsocial.com',
    'http://avaaz.org',
    'http://ayi.com',
    'http://eastbay.com',
    'http://educationconnection.com',
    'http://egotastic.com',
    'http://ehow.co.uk',
    'http://ehow.com',
    'http://elearners.com',
    'http://emilyslist.org',
    'http://en25.com',
    'http://engadget.com',
    'http://eset.com',
    'http://essortment.com',
    'http://eventful.com',
    'http://factoryoutletstore.com',
    'http://fanpop.com',
    'http://farespotter.net',
    'http://fast-growing-trees.com',
    'http://feedingamerica.org',
    'http://filedocs.net',
    'http://fileplanet.com',
    'http://findprices.com',
    'http://firedoglake.com',
    'http://flotrack.org',
    'http://flowrestling.org',
    'http://fluidsurveys.com',
    'http://footlocker.com',
    'http://formstack.com',
    'http://forrent.com',
    'http://foxsoccer.com',
    'http://foxsports.com',
    'http://freedomtomarry.org',
    'http://friendbuy.com',
    'http://gardenguides.com',
    'http://gazelle.com',
    'http://geek.com',
    'http://getbubbletrouble.com',
    'http://getsafemonitor.com',
    'http://getsatisfaction.com',
    'http://gigapan.com',
    'http://gilt.com',
    'http://giveforward.com',
    'http://glassesusa.com',
    'http://globalpost.com',
    'http://gmu.edu',
    'http://go.com',
    'http://godaddy.com',
    'http://gohawaii.com',
    'http://golflink.com',
    'http://greenpeace.org',
    'http://gurneys.com',
    'http://gybo.com',
    'http://ibtimes.co.uk',
    'http://icontact.com',
    'http://ie6update.com',
    'http://indeed.com',
    'http://independentlivingbullion.com',
    'http://independentlivingnews.com',
    'http://indiatimes.com',
    'http://insidermonkey.com',
    'http://inspectlet.com',
    'http://intuit.com',
    'http://inyopools.com',
    'http://ipage.com',
    'http://ipetitions.com',
    'http://ivillage.com',
    'http://ixl.com',
    'http://jigsaw.com',
    'http://jobapplicationmatch.org',
    'http://jobpath.com',
    'http://jobscore.com',
    'http://johnsonville.com'
];

var q = async.queue(function (website, callback) {
    var nightmare = Nightmare({
        show: true, 
        dock: true,
    }).useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.86 Safari/537.36').viewport(1280, 800);
    nightmare.goto(website.url)
    .evaluate(function() {
        return window;
    }).end().then(function(window){
        console.log('Window object available for: %s', website.url);
        callback(false, website.url);
    })
    .catch(function(err) {
        console.error(err);
        callback(err, 0);
    });
}, 50);

q.drain = function() {
    console.log('Finished all URLs');
    process.exit(1);
};

urls.forEach(function(url) {
    q.push({
        url: url
    }, function(err) {
        console.log('Finished processing: '+url);
    });
});
```

The command I ran was: `DEBUG_FD=3 DEBUG=nightmare:* ELECTRON_ENABLE_LOGGING=true ELECTRON_ENABLE_STACK_DUMPING=true node nightmare.js 3>debug.log`.

My package.json:

``` json
{
  "name": "node.js-test-files",
  "version": "1.0.0",
  "description": "Testing Folder",
  "main": "test.js",
  "scripts": {
    "test": "node test.js"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "async": "^2.0.0-rc.5",
    "mysql": "^2.10.2",
    "nightmare": "^2.5.0",
    "request": "^2.72.0"
  }
}
```

And the log file: [https://drive.google.com/file/d/0B_3Tmwogoca7eWRYQWo5cFhfVXc/view?usp=sharing](https://drive.google.com/file/d/0B_3Tmwogoca7eWRYQWo5cFhfVXc/view?usp=sharing)
 Is there a way to make the nightmare instances throttle as a workaround (for now; I'd rather have the bug fixed)?
 @JWMarchant as noted over on #640, does using memory partitions and/or randomly named partitions for each instance solve the problem for you? If not, we at least know you are likely experiencing a different issue than the one on #640.

To use memory partitions, construct a Nightmare instance like:

``` js
var nightmare = Nightmare({
  webPreferences: {partition: 'any-name-you-want-so-long-as-it-doesnt-start-with-persist:'}
});
```

To get a unique partition every time, do something like:

``` js
var nightmare = Nightmare({
  webPreferences: {partition: `memory-${Math.random().toString().slice(2)}`}
});
```
 I think itâ€™s also worth noting that, even if there arenâ€™t actual errors, opening too many windows at once will inevitably make things really really slow, no matter what. In the last example, the queue is explicitly being set to open 50 windows at a time. I donâ€™t think anyone would expect opening 50 tabs and navigating them all to new URLs at the same exact time would work very well on any computer. On a lot of computers, just having 50 Chrome tabs open, let alone having them all loading a new page simultaneously, can be a heavy load. There are still reasonable limits here.

(And I should also note that 50 Nightmare windows is _way_ more intense on your system than just 50 tabs in Chrome.)
 I'll try it out and leave feedback.  I'm intentionally using a pool of instances and topping out at 5, so it's quite fast; just I get this error every 10-20 minutes of continual traffic.  It might be useful to note that I am not using any nightmare instance more than 50 times.  So, recommendations are basically upgrade to 2.5.0 and then try partitions.  I'll check back soon.  Thank you.
 Also, I am not navigating to more than one URL at a time, so that isn't the issue.
 Upgrade did not work.  Question:  So I'm running independent gotos, but when I run a goto, does nightmare hold something open?  Is there a way to close a tab?  Or are we expected to make new nightmares to close up that tab?  I assumed that when a goto was finished, it was no longer held open.  Is this true?
 Nightmare doesnâ€™t really have â€œtabs,â€ per se. Every Nightmare instance corresponds to a new browser window (those windows donâ€™t have sub-windows or tabs or anything). Calling `end()` on the instance will cause the window to be closed at the end of the current queue of actions. After that, the window is pretty much unusable (but you might not get very clear errors if you do try and use it). If you donâ€™t call `end()`, the window is left open in whatever its last state was and you can call more actions on it.

In that sense, I guess you might say a window is â€œheld openâ€ unless you explicitly call `end()`. Itâ€™s also possible to wind up running several actions simultaneously in Nightmare window, which might cause you some trouble if thatâ€™s not what you were expecting (and is likely if you are pooling instances). For example:

``` js
var instance = Nightmare();
instance.goto('http://google.com').type('[name=q]', 'google nightmare').click('[type=submit]').then();
instance.goto('http://yahoo.com').type('form[action*="/search"] [name=p]', 'yahoo nightmare').click('form[action*="/search"] [type=submit]').then();
```

This will try and navigate to google and yahoo simultaneously. In newer versions of nightmare, I _think_ the navigation to yahoo will cause an error for the google navigation and the first series of actions will fail (in older versions of nightmare, they'd both succeed and both of the typing actions would try and work on the same page at the same time and you would not enjoy the results).

When pooling instances, the above could easily cause big problems. You might want to:
- Check the `running` property to see if a queue of actions is currently executing on the instance. If itâ€™s true, the instance isnâ€™t yet ready to be re-used.
- Check the `ended` property to see if the nightmare window is still open and usable. If itâ€™s true, you should throw the instance out of the pool and never try to use it again.
 Thank you @Mr0grog.  This is amazingly helpful in helping me make sure I'm properly cleaning everything up.  I've glazed through the nightmare code, but methinks I need to spend a good while staring at it as it is non-trivial code.

Partitions did not fix it.

BUT when I inspect the .running flag on the nightmares, it is sometimes still true.  I'm doing each goto with something like this code snippet:

```
Promise.resolve(nightmare
                .goto(url)
                .wait(timeout)
                .evaluate(function () {
                    return document.getElementsByTagName('html')[0].innerHTML;
                })).then(function (html) {
                // do a thing
            }).then(function (result) {
            }, function (err) {
                 // do an error thing
            });
```

So currently I'm just punting on the nightmare pool request until it is no longer running (and making a new nightmare in cases where I try to reach it too many times while it is still running).  

Do the promises or the .then not force the nightmare to finish running?  Is there a way to do so without ending the instance?  When I refuse to use a nightmare instance when I get a true for "running", it ceases to crash, so I suspect the .then is a lie?  Is there some other way I'm unaware of to force the goto to finish?
 > Do the promises or the .then not force the nightmare to finish running?

They do, but not synchronously. If you code is something like:

``` js
[array of urls].forEach(function() {
  Promise.resolve(getNightmareFromPool.some().actions())
    .then(function(html) {
      // do a thing
    })
    .catch(function(error) {
      // do a thing
    });
});
```

Then youâ€™ll probably wind up with your full pool used up and in a `running` state halfway through the loopâ€”the loop is synchronous, but the running of the nightmare queues is not. Instead, you might do something like:

``` js
var urls = [array of urls];
function runWithNextUrl() {
  var url = urls.shift();
  if (!url) return Promise.reject('No more URLs');
  return Promise.resolve(getNightmareFromPool.some().actions())
    .then(function(html) {
      // do a thing
    })
    .catch(function(error) {
      // do a thing
    });
}
var completedCount = 0;
for (var i = poolSize; i > 0; i--) {
  runWithNextUrl()
    .then(function() {
      return runWithNextUrl();
    })
    .catch(function() {
      completedCount += 1;
      if (completedCount === poolSize) {
        console.log('complete!');
      }
    });
}
```

That way, youâ€™re not trying to grab an instance from the pool until one of the instances has completed. There are definitely more elegant ways to write the above, but hopefully it gets the general idea across. Incidentally, this is basically the same thing @JWMarchant was doing above by using:

``` js
async.queue(function(website, callback) { /* do test */ }, 50);
```

(Where `50` would be the pool size. That param in `async` is the maximum number of simultaneous runs, which youâ€™d want to be the size of your pool.)
 This is fantastic.  I moved the return of the nightmare instance code into the .then function and it is fine now.  It seems slower, but I guess that is to be expected when things weren't fully cleaned up before we blundered onto the next thing.

Thank you.
  Hi there,

I was trying to get openDevTools to work for debugging, but as soon as it opens the electron instance, it hangs the operation and exits after a few seconds. Is this an issue, since the openDevTools was added recently and I couldn't find any tests to check if I am doing this correctly.

Here is the debug output:

```
nightmare:log did-start-loading +508ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":true,"openDevTools":true,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/Yogesh/Projects/drift/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
  nightmare electron child process exited with code null: undefined +4s
```
 In the latest version, `webPreferences` setting on nightmare object causing this problem for me: electron instance is crashing immediately.
  hey, 

I get constant warning about memory limits - when I edit the code in IPC.js to prevent the warning and set the level to max - my program constantly crashes due to node reaching max memory limit :( 

Is there something specific you need to keep in mind to prevent memory leakage problem. 
 Are you creating a lot of separate instances of the `Nightmare` object? If so, the easiest thing you can do now is just make a few and re-use them. Additionally, version 2.3.1 (released yesterday) has a patch that should significantly reduce memory usage.

Given the notes in #561, I think itâ€™s likely that Nightmare will grow some automatic methods for reducing memory usage, but for now, the best approach is to manage a pool of Nightmare instances yourself so as not to create too many and allocate a lot of memory.
 I do only one 

```
browser = require('nightmare')()
```

and then reuse browser. The only thing I would ask is 
when do you call ? 

```
browser.end()
```

I have a lot of code that looks like this 

``` livescript
 browser.goto("google.com")
 browser.evaluate(within)
 browser.run(then (browser) )
```

and then 

``` livescript
then = (browser) ->
 browser.goto "yahoo.com"
# ..evaluate 
# .. run ( then2 (browser))
```

or should I just use a for loop ? 

``` livescript
for I in ["google.com","yahoo.com"]
 browser.goto(I)
 browser.evaluate(within)
 browser.run(foo)
```
 > The only thing I would ask is when do you call `end()`?

`end()` totally shuts down the browser, so you should only call it when youâ€™re finished with everything. By itself, that wonâ€™t actually do anythingâ€”you have to call `run()` or `then()` afterwards, like so:

``` js
browser.goto("google.com")
browser.evaluate(within)
browser.end()
browser.run((result) ->
  # do something with the results
)
```

> I have a lot of code that looks like this
> 
> ``` coffee
> browser.run(then (browser) )
> ```

Is this actually the code that youâ€™re running and is it working? It looks like youâ€™re passing the _result_ of your `then` function to `run()` rather than your `then` function itself, which should trigger an error when nightmare finishes running all your actions.

> or should I just use a for loop?

A plain for loop would not be a good idea, since all of Nightmareâ€™s operations are asynchronous. You might want to read up on this article about loops with Nightmare: https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md
  ðŸ‘ to spending some time researching this.

That said, I think itâ€™s probably a given that, since every instantiation of `Nightmare()` creates at _least_ two new processes, thatâ€™s going to cause significant overhead. Regardless of deeper potential issues in Electron, it will be better to only create one electron process that handles a collection of windows. We could further pool those windowsâ€”when someone calls `end()` on an instance, thatâ€™s a signal that we can reuse a window.

Given that Chromium has also hit this, if we add a pooling mechanism as above, that also gives us a way to cap the number of Nightmare instances running simultaneously. We can just queue up the rest to run when a window becomes available.
 > the fix opens up an avenue of problems having to do with #502

Iiiinteresting. All ðŸ‘‚ðŸ‘‚ðŸ‘‚

> This isn't necessarily a resource problem. Having more memory or a faster CPU would likely mask the problem, but wouldn't eliminate it entirely.

Oh, totally; didnâ€™t mean to imply it was! Just that our heavy resource use probably exacerbates ðŸ˜¬ 

> I also agree that Nightmare should probably be what amounts to a BrowserWindow manager - at least, I think that's the kind of direction you're heading in.

Yup.

> The first BrowserWindow Electron opens has a special property where if you close it, the whole process dies.

Well, this is kind of funny. It turns out that, if you use the command line to launch a given app, e.g. `electron path/to/app`, instead of bundling everything up with Electron for distribution, it uses its â€œdefault_appâ€ as a sort of launcher (I had no idea this was how it worked). Interestingly, [the default_app installs a handler for the `window-all-closed` event](https://github.com/electron/electron/blob/f403950503eb82bcfa230b13a909572beff75fc0/default_app/main.js#L41) that shuts down the application!

Due to the way itâ€™s written, the solution is to simply add our own `window-all-closed` event. So long as thereâ€™s more than one listener (the default_appâ€™s and ours), the default_app one doesnâ€™t do anything. Who knew? (Not I.)

> Whatever the approach, I would argue it would need to be compatible with the current test suite.

Insofar as the test suite confines itself to public methods/properties on `Nightmare` and instances (pretty sure it does), I agree. Iâ€™m not totally sure we need to make sure things like `nightmareInstance.child` continues to exist and work the same, though.

> I'm betting you had parallel execution in mind as well, which makes the problems in #493 all the worse.

Indeed :D    I have a private laundry list of things Iâ€™d love to see changed in Nightmare, but the only one that is a Big Dealâ„¢ (aka the one that gives me that good old â€œis this a jenga towerâ€ feel [I kid, but still]) is that one. However! I think that issue is _largely_ independent of this one (save that care should be taken not to make it worse).

> Do you think Nightmare should return back Nightmare-side instances of BrowserWindow (or NightmareBrowserWindow?) to perform tasks?

No. I donâ€™t think switching from â€œN electrons, 1 windowâ€ to â€œ1 electron, N windowsâ€ should have any externally visible impact on the API (save for private, non-documented bits). The rule that an instance of `Nightmare` == a window in Electron, however itâ€™s accomplished, is pretty simple and straightforward. (If Iâ€™m missing what youâ€™re getting at here, let me know.)

> What's an acceptable maximum of BrowserWindows that can be open?

No idea, but:
- 10 seems like a maybe reasonable place to start Â¯\_(ãƒ„)_/Â¯
- This should probably be a constant/global so itâ€™s easy to adjust in future releases or as the work on this goes on
- This should probably be configurable by users at runtime for beefy or light-weight machines (e.g. `Nightmare.setPoolSize(1000)` if you like to live dangerously)
- A fancypants implementation might look at `os.totalmem()` + `os.freemem()` + `electron.screen` and decide for itself, but even then you are likely dealing with some wobbly heuristics.

Back in #479 I wrote:

> For reference, a really simple nightmare session takes 20-30 MB of RAM on my machine, but once a screenshot is taken, that can boost to as high as 360 MB.

The current screenshot API should be much lighter, but Iâ€™d guesstimate ~50 MB per window on my machine (13" retina MacBook Pro, 64 bit). That figure will definitely vary across hardware and OS.
 > Electron internally deals with it in that way, and the documentation is ... misleading?

Well, if I understand it right, that all only applies for â€œnon-bundledâ€ stuff. So if your electron app is sitting inside electronâ€™s resources folder (as it is when a standalone app is all bundled up for distribution), `default_app` doesnâ€™t get loaded and everything matches the docs. Regardless, that doesnâ€™t matter for us.

> The "window manager" would need to expose methods for listing, retrieving, creating, and closing windows.

I guess I was thinking this would be the role of some component that is entirely privateâ€”a new nightmare instance would ask that manager for a communications channel to a window when created and would close the channel/tell the manager itâ€™s done when `end`-ed.

> One of the biggest side perks to doing this is being able to handle pages that open new tabs/windows: when a new window is created from the browser, it could then be created with the Nightmare sugar and registered with the window manager.

Ah, hadnâ€™t thought about child windows. This would still necessarily require new API for interacting with those child windows, though, right? Or I guess you could have an event for `new-child-window` or something that includes as a parameter a wrapper for the window. That could definitely be a `Nightmare` instance, though. (_Seems_ like it would be the nicest way to do it for users at first blush.)

> Deathly curious what the memory footprint difference is. I'd like to put together something about that, if nothing else for justifying the change.

\+ ðŸ’¯ 

> I worry that [with complicated heuristics] you're at the whim and mercy of the OS and may introduce cross-platform problems that are hard to debug/track down. At least for now, I'm in favor of keeping it simple.

Toooootally. Said much more clearly than my â€œwobbly heuristicsâ€ note :P

> > Iâ€™d guesstimate ~50 MB per window on my machine (13" retina MacBook Pro, 64 bit). That figure will definitely vary across hardware and OS.
> 
> Per BrowserWindow or per Electron instance?

I have totally forgotten! I _think_ my â€œ20-30 MB normallyâ€ and â€œ50-300 MB screenshottingâ€ estimates were a combined 1 Electron + 1 window, so I guess each window would be a bit lighter (but Iâ€™m also guessing not a lotâ€”the electron app process is probably relatively light). I also donâ€™t remember whether this was with an essentially blank page or something fairly busy like yahoo.com.
 > Reorganizing how Nightmare and Electron interact seems like a good time to think about simultaneous calls/multiple runs/handling messaging spaghetti.

Not totally disagreeing. I think there are really two different things tied up in #493â€”one is about pure safety (making sure that two simultaneous attempts to perform a routine in electronâ€™s processes donâ€™t wind up with crossed wires), which fits in more tightly with the work weâ€™re talking about here. The other is whether the overall behavior/API should change to make those kinds of potential crossed-wire situations less likely to occur. That one is a big enough deal all on its own that I think itâ€™s worth separating out.

Both of those changes and this one are all potentially high impact, though. Ideally this process/window management work wonâ€™t have any API impact for users, but I suspect thereâ€™s a reasonable likelihood it might change the story for plugins. Whatever we do with IPC will almost undoubtedly affect both plugins and end-user usage. It might be worth _releasing_ all these changes together as a major revision given they all might be breaking changes.
  When I used nightmare and a mobile useragent, some of the clickable buttons went away and I was trying to fire an enter keypress using `.evaluate`. However, using `.type('document', '\u000d')` is much simpler and easier to fit into the flow of code. Would that be something that I could add to the documentation? Thanks.
 Is this solved by #560? If so, someone should close this.
  Occasionally because of bugs in Electron such as https://github.com/electron/electron/issues/4733 I run into errors that look like the following:

`Nightmare runner error:`
`TypeError: Cannot read property 'delete' of undefined at ObjectsRegistry.remove (/app/node_modules/electron-prebuilt/dist/resources/electron.asar/browser/objects-registry.js:53:31) at EventEmitter.<anonymous> (/app/node_modules/electron-prebuilt/dist/resources/electron.asar/browser/rpc-server.js:344:26) at emitTwo (events.js:100:13) at EventEmitter.emit (events.js:185:7) at EventEmitter.<anonymous> (/app/node_modules/electron-prebuilt/dist/resources/electron.asar/browser/api/web-contents.js:128:25) at emitTwo (events.js:100:13) at EventEmitter.emit (events.js:185:7)`

These seem to hang Nightmare - they log an error to the console and end the child process. However, I'd like to be able to catch such errors in my code that is using Nightmare. Is there a good way to do this?
 I am using custom actions I've defined, but I'm fairly confident it was due to the bug in Electron that I linked. (If "delete" is confusing to you, it is confusing to me too, because my custom action doesn't involve deletion; it is basically like `nightmare.insert(''); nightmare.insert(x);`)

I see that in Nightmare's handler there's a call to `process.exit(1)` when this happens - what if I don't want to end the parent process?
 > I see that in Nightmare's handler there's a call to process.exit(1) when this happens - what if I don't want to end the parent process?

Soâ€¦ it would be a _very_ bad idea not to exit the process at this point. Electronâ€™s underlying IPC machinery is now in a bad state, so further communication between the your node.js process and the â€œbrowserâ€ is not reliable. Worse, the underlying issue is a memory management problem on the C++ side, which means you are prone to crashing if you keep running.

If indeed https://github.com/electron/electron/issues/4733 is the problem, itâ€™s been fixed. When Nightmare next updates its Electron dependency, this should be solved. (You can update the version of Electron youâ€™re using yourself, too. The current release should have the fix for this issue.)
 https://github.com/electron/electron/issues/4733 was reopened, so I think that's still the underlying bug I'm trying to handle. (I had upgraded my version of electron-prebuilt and was still seeing this.)
 @yoz ah, thatâ€™s frustrating. It sounds like the issues in Electron are fairly thorny.

I get wanting to be able to continue on after Nightmare fails, but Iâ€™m pretty sure Nightmare really does not handle the underlying Electron process failing very gracefully. A lot more would need to be done to fix that if you want it to be safe to not just exit the process when Electron fails. It would probably be a good improvement if you want to work on it, though!
 @Mr0grog yes, unfortunately it's a pretty difficult bug to reproduce. I would look into it if I had an easier time with that. But I think the easiest for me is to downgrade my version of electron-prebuilt to 0.36.8.
 :+1:
 Hi !
How can i catch the 
```
Nightmare runner error:

	Error: Object has been destroyed
	    at Error (native)
	    at Timeout.wait [as _onTimeout] (eval at <anonymous> (/Users/gautier/Documents/Projets/lifebox/server/node_modules/nightmare/lib/runner.js:543:14), <anonymous>:89:35)
	    at tryOnTimeout (timers.js:232:11)
	    at Timer.listOnTimeout (timers.js:202:5)
```
To log it?

I'm on nightmare 2.10.0 / electron 1.4.4.
It's happening since 2-3 days after executing a script when i don't end nightmare and i let the window open. Very weird...
At least i would like to be able to send the error to sentry.
Thanks  +1  I'm trying to scrape a webpage with nightmareJS and got stuck.
In my program i pass to the function an array on links which i need to the same data from all of them 
The list can be very long (over 60) and if i try to do a

async.each(Links, function (url, callback) {
    var nightmare = Nightmare(size);
    ...
}
Only the first couple few instances actually return a value , others just hang up and wont load (blank page).When i try to do only three it work perfectly. 
How can i fix it? How can i redistribute the work , for example three in parallel and only when all done it will do the next set? One more thought maybe use the same instance and repeat the steps for all the links?
 @rosshinkley  sorry, im busy lately thanks im good.
 @AaronTrazona: how do you do, in order to make it work? Sorry, problem solved mostly thanks to #104: "`new Nightmare()`".

I was calling my function that is located in another file (with `module.exports`). And my `Nightmare` variable was defined on the very begining of my file and not **in the function**.

So, on each loop, when my *master function* call my `Nightmare` function, the same variable was used.

Now, I create the `Nightmare` variable **inside** the function, in order to create a new instance on each function call.  Nightmare adds an `uncaughtException` listener to clean up the child process. However adding a listener [overrides the default behaviour](https://nodejs.org/docs/latest/api/process.html#process_event_uncaughtexception) and can cause an exit code of zero.
### Steps to reproduce:

``` js
// a.js
var Nightmare = require("nightmare");
var n = Nightmare();
var a = require("does-not-exist");
```

And then running `node a.js; echo $?` show the error but reports an exit code of `0`.
### Fix:

Re-throw the error so node can pick it back up. I also changed the `console.log` to a `debug` as the default handler prints a stack trace.
 Given that Iâ€™m the person who made this mistake, it would be good if this patch included a test (I could easily see myself or someone else screwing this up again in the future). You could probably just check the exit code in the `exit` event in the test: https://github.com/segmentio/nightmare/blob/master/test/index.js#L48 â€¦or write a similar test that does so if the conditions need to be slightly different.
 Hi @Mr0grog, that's for the feedback. I thought about adding a test, but didn't as you're not meant to do anything after an uncaughtException in user space. However I've looked through some of your tests and seen you have some (rather nice!) tests using child processes so I'll have a go at encapsulating a test.
 Test added
 Thanks for cleaning up my mess! ðŸ˜…   (looks great!)
 @Mr0grog No problem, it was only because we introduced an error into our test framework that we found this bug, so you're in good company! Do you want this rebased into one commit?
 I'm not a committer, so that's above my pay grade. @matthewmuellerâ€™s your man (or maybe @rosshinkley; it seems like he might have the commit bit now and is much more active).
 > At a minimum, I'd like to get this + #553 in

If I were going to make a recommendation, I'd say this and #556 are good candidates for a patch release (v2.3.1) since they are small, make minor quality fixes without new features, and are immediately ship-able without other upstream fixes (like #553).
  ~~**This is just a work-in-progress at the moment, but filing the PR as there are open questionsâ€¦**~~

This adds tests (which fail), but no implementationâ€”I need to work out the best solution for https://github.com/atom/electron/issues/5013 and https://github.com/atom/electron/issues/4396 (this second one I canâ€™t actually reproduce, so it may have been fixed). For the former, the simplest solution is probably tracking the URL of the failed page and comparing it to the URL of the main frame. Need to make sure that works right for redirects, though. A more exacting solution might be to track resource requests on the `session` object, though doing so requires a bit more rigamarole.

There is also an open question of how this should behave w/r/t error responses (e.g. 404, 500, etc). For now, Iâ€™m planning to take the approach that any valid response (including things like 404s and 500s) are successes (after all, you might be trying to test a 404 page with Nightmare), but I can also imagine someone wanting the option to treat any non-2xx response as a failure. Maybe thatâ€™s something to wait for as a feature request, though? Curious what others think.
 Also: As you can see in the tests, Iâ€™ve made the assumption here that child frames and sub-resources (images, scripts, stylesheets) failing do not cause `goto` to fail (i.e. it only fails if the HTML itself fails to load). Iâ€™m pretty sure thatâ€™s the right thing, but happy to take feedback on that.
 Spent more time than I expected working through the technical issues (and adding a whole bunch more tests as a result) last night. Going to try and clean it up this evening when I have more time and push it up here.

> What if the end user wants to do something custom with redirects - would this effect the ability to handle redirects with a custom action?

I donâ€™t believe it would, since you canâ€™t manipulate the request from that event (you could do something that would abort and start a new one, but weâ€™d be able to see that). That said, I wound up not using `did-get-redirect-request` for a _different_ reason, so this probably doesnâ€™t matter much anyhow.

(Now using `webRequest.onBeforeRequest`, which requires some working around for safetyâ€”only one handler can be registered at a time, which means we could clobber a plugin or a plugin could clobber us. But this lets us figure out the _actual_ URL being requested, which may not match the URL a user passed in â€” `http://somewhere.com` gets requested as `http://somewhere.com/`, for example. Header redirects will cause `onBeforeRequest` to fire again, so the `did-get-redirect-request` becomes redundant.)

> The bigger problem with using session.webRequest.onErrorOccurred()â€¦ is I think it gets emitted when there is any problem, not just page load failures.

Well, any problem with a resource that has started loading, which, it turns out, doesnâ€™t cover everything because some load failures pre-empt actual requests (e.g. totally invalid URLs). Aside from that, though, you can sort things out pretty easily w/ the `resourceType` parameter, which is `mainFrame` for the page itself being loaded in the main frame.

> Are you envisioning an optional parameter for .goto()? Something like .goto(url[, status])? Or does this get back to the shorthand I mentioned above with some sort of destination filter/rule?

I was originally thinking â€œSomething like .goto(url[, status])â€ BUT had a more interesting thought last night, which was this: `goto` should return information about the response when itâ€™s successful (probably using `did-get-response-details` as you mentioned). Filtering acceptable page loads could be another action (perhaps a plugin!) that comes next, e.g:

``` js
nightmare
  .goto('somewhere')
  .withStatus(200)
  .evaluate(...)
  .etc;
```
 OK! This works and _seems_ pretty reliable now. As an interesting side note, this is the first time the [not-quite-normal-promise behavior](https://github.com/segmentio/nightmare/issues/527) has caught me in practice! (https://github.com/segmentio/nightmare/pull/553/commits/9acfa0dc4f2616e48748512373e3306065eaafa5#diff-910eb6f57886ca16c136101fb1699231R169)

---

## High level overview

`goto` now produces an error in the page fails to actually load. Completed requests with error _statuses_ (e.g. 404, 500) are successes, not errors in this situation.

When there is an error, `goto` returns an object with the following:
- message: The string 'navigation error'
- code: Chromium's error code describing what went wrong. Note this is _NOT_ the HTTP status code. For more details, see https://code.google.com/p/chromium/codesearch#chromium/src/net/base/net_error_list.h
- details: A string with additional details about the error. This may be null or an empty string.
- url: The URL that failed to load

When `goto` succeeds, it also now returns additional information about the request, so the user or other actions or plugins can do something meaningful with it. Success data is an object with the following:
- url: The URL that was loaded
- code: The HTTP status code (e.g. 200, 404, 500)
- method: The HTTP method used (e.g. "GET", "POST")
- referrer: The page that the window was displaying prior to this load or an empty string if this is the first page load.
- headers: An object where the property names are the HTTP header names and the values are arrays of the header values (if the same header was sent multiple times, the array will have multiple values).

Iâ€™m not totally sure if using `code` for both Chromiumâ€™s error code on a failure and the HTTP status code on a success is right. It seemed straightforward and expedient, but my one concern is that someone might expect `code` in an error to be an HTTP status code, which it most definitely is not. However, you can easily differentiate it by the fact that Chromium error codes are all negative values.

## Implementation Bits

There are a lot of tests for all the crazy edge cases I encountered trying to solve this well. Hopefully they are clear.

Additionally, thereâ€™s some serious craziness around `webRequest.onBeforeRequest()`. Between the fact that calling that method with a new listener (or no listener) removes any existing listener and the fact that plugins now have access to the Electron process, a plugin could easily clobber the mechanisms `goto` relies on (or vice versa). So I had to do some wacky gymnastics to protect against that.

An `onBeforeRequest` listener is registered immediately when the browser window is created. Then the `onBeforeRequest` method is removed so nobody can clobber the listener that was just registered. It gets replaced by a method with the same signature that tracks any new listener and calls it as appropriate, rather than actually registering it with Electron. The biggest downside here is that Electronâ€™s `filters` parameter is rather poorly approximated by my code. [The actual implementation is not small or simple](https://github.com/electron/electron/blob/master/chromium_src/extensions/common/url_pattern.cc) and this seemed good enough. Would love to hear other better ideas here.

I also thought about replacing the whole of `session.webRequest` with an event emitter, but that seemed like a change that was a) a little large/out-of-scope and b) is questionable in general because it would totally change a big piece of Electron APIâ€”it might be better to lobby for the change upstream (but no idea how well a request for that would be received).

Anyway, why is all that hijinx really necessary?? Well, the short answer is that the only way to tell whether a `did-fail-load` event came from the main frame (as a opposed to a sub-frame, which usually means an `<iframe>`) is to compare URLs. And determining the actual URL weâ€™re trying to load is not as straightforward as someone as naÃ¯ve as me might assume. (Note: I wrote a PR upstream in Electron to give us frame information on the failure event, but no idea if/when it will land: https://github.com/electron/electron/pull/5029)

So, URLs! Between the time we call `loadURL()` and when Electron attempts to make an actual request, it cleans up and reformats the URLâ€”which means we canâ€™t just match the failed URL agains the URL we asked to load. Some examples of how the URL gets modified:
- `Â Â Â http://fake.domain/Â Â Â `  ->  `http://fake.domain/`
- `http://///fake.domain/`  ->  `http://fake.domain/`
- `http:fake.domain/`  ->  `http://fake.domain/`
- `http://fake.domain`  ->  `http://fake.domain/`
- `http:// fake.domain`  ->  `http://%20fake.domain/`

Those are just ones I noticed in the course of doing this work. It would probably take a fair bit of Spelunking through Chromium to figure out everything it might do and, even then, weâ€™d be vulnerable to changes in the routine in the future. Better to just let Electron tell us what itâ€™s going to load, which is where `onBeforeRequest` comes in.

Itâ€™s also possible to get a failure event before any loading happens. Thatâ€™s usually because the URL was just totally malformed and fails basic validation. Happily `did-fail-load` is still called in that case, though `webRequest.onErrorOccurred()`â€”so itâ€™s not feasible to just use webContent events or just use `webRequest` listeners; we have to use them in combination to handle the full range of possible situations.

Whew! I think that covers it; please review for any issues!
 I think #556 might fix the CircleCI issues here. Not 100% sure, though. If not, Iâ€™ll have to poke at it more :\ (Tests run fine for me locally.)
 Well, still seeing errors here on Circle even with #556 merged in. Oddly, I donâ€™t see them if I SSH into Circle and run them on the console. Not entirely sure whatâ€™s up; probably going to give it a rest for tonight.
 9cfef7c should mitigate one of the issues I saw repeated on Circle last night: trying to load an unknown protocol seems to hang. It doesnâ€™t do so locally, nor does it if I SSH into the Circle box and manually run the tests from the command line. Not sure whatâ€™s different when Circle does its test run, but  Â¯\_(ãƒ„)_/Â¯

This doesnâ€™t fix the intermittent "should fail properly if request handler is presentâ€ issue you found, @rosshinkley. I noticed that sometimes on Circle, too, but wasnâ€™t able to repro locally and havenâ€™t dug into it yet, so if youâ€™ve got ideas, awesome. 

> It looks like once in a while, did-fail-load gets emitted after did-finish-load. (That's the difference in debug output anyway. I'm not clear on the underlying cause yet.)

_Sigh._ Hope this is not whatâ€™s really happening, but that would definitely cause this sort of problem :(

> I see in your tests that valid redirects are okay, but it doesn't check the internal information bubbled up from .goto(). Based on the changes you've put in, would that show the 3xx? At first blush, I don't think it would - wouldn't it show the 2xx (assuming success) for the final destination (after did-finish-load)?

Oh, thatâ€™s a good question. Iâ€™m pretty sure it would show the 2xx for the final destination, but havenâ€™t tested that case. Iâ€™m also not sure Iâ€™ve tested the case of invalid redirects.

> I'm not sure .goto() should track all of the redirect information from a given request, but I do want to clarify what to expect.

I actually hadnâ€™t thought about this case _at all!_ It would be interesting to report on all the redirects involved, but I hadnâ€™t really planned to. So yes, no reason to expect that.

> I don't know what kind of release schedule Electron is on, but they cut releases often enough that I think I'm willing to wait as it reduces the complexity of your solution (seemingly by quite a bit). What do you think?

Yeah, Iâ€™m not sure either, though they do certainly release often. Buuuuuuut gathering the response details also relies on the URL check, so https://github.com/electron/electron/pull/5029 no longer removes the need for the `onBeforeRequest` madness. Iâ€™ve just filed https://github.com/electron/electron/issues/5074, which would fix this for us.
 > The handler for the provisional load failure also makes a call to setImmediate, which in my understanding (which I will readily admit is probably flawed) could prop up a race condition between did-fail-load and the other events.

AH! I had seen that earlier, but didnâ€™t remember it when you mentioned the race condition. This could definitely cause it. Hmmmm.

> in my sandbox, did-fail-provisional-load doesn't get emitted for child parts that fail if I watch it directly. Did you experiment with that event? If so, why opt against it?

I did look into it, but ultimately just used `did-fail-load` as an expedient for not needing to hook an extra event `did-fail-provisional-load` (because one triggered the other). The potential for a race did not occur to me, though. Just hooking `did-fail-provisional-load` to `handleFailure` would fix things if the `setImmediate` call is in fact the real culprit here.

> > Iâ€™m also not sure Iâ€™ve tested the case of invalid redirects.
> > This doesn't cover it?

I forgot what I wrote! Maybe didnâ€™t get enough sleep last night :P

> [capturing redirect info] would be neat and make Nightmare more useful as a testing tool, but I'm okay for the moment putting it down as a future enhancement.

Agreed ðŸ‘ 

Side note: I realized while looking at https://circleci.com/gh/Mr0grog/nightmare/13 that I didnâ€™t really do a very good job with the â€œfail if the response dies in flightâ€ test. Going to rewrite it by adding a server endpoint that just kills the socket, which should make the test reliable.
 Also, on the `onBeforeRequest` stuff still being needed for the `did-get-response-details` eventâ€”Iâ€™m happy letting this PR sit while we wait to see what happens with https://github.com/electron/electron/issues/5074 if you want.
 > I'm not sure if it's a resource issue or what, but somewhere in the neighborhood of 50-60 runs, my sandbox (on my low-powered laptop) will hang when starting an Electron process. (I feel like there's an open issue for this already - #238, maybe?)

Oh, that issueâ€™s interesting; Iâ€™d never seen it. I feel like there are potentially a lot of causes there. Things like #493 could potentially contribute. I also recall seeing some issue about listeners not always being properly cleaned up that didnâ€™t seem like it got well resolved (canâ€™t find now). #556 should reduce the load a little, too.

I also wonder if moving to an architecture where every Nightmare instance is just a new `BrowserWindow` rather than a whole new process (so instead of one Electron process per Nightmare instance, one single Electron process that contains many windows, one for each nightmare instance).

But bottom line, no certainties here, other than that I generally suspect more than one cause. :\

> From that, I think it's increasingly likely this is a race condition, and as such, swapping out for did-fail-provisional-load is a decent call. Thoughts?

Seems reasonable to me. Will implement it as soon as I get a change.
 I also switched to generating a new in-memory partition for every test to avoid caching issues in this branch; itâ€™s possible that be exacerbating things, too: https://github.com/segmentio/nightmare/pull/553/files#diff-910eb6f57886ca16c136101fb1699231R81
 > do you (or anyone else) know why dom-ready events are emitted even for provisional load failures?

This is deep deep down (all the load-related events on WebContents come from way deep in Chromium), but it looks like, after sending the failure notification (https://chromium.googlesource.com/chromium/src/+/master/content/renderer/render_frame_impl.cc#3064), Chromium then loads, as part of the same navigation (so no new request cycle), the error page (https://chromium.googlesource.com/chromium/src/+/master/content/renderer/render_frame_impl.cc#3093). That would, I expect, trigger the `dom-ready` event. Not super straightforward, though.
 > Some of the other tests are now failing.

By any chance, is that â€œshould fire an event on page load failure?â€ If so, 52958f219813f883b85b7dcad909d94349b06b42 should fix it.
 OH MY GOD THE TESTS PASSED ON CIRCLE
 Electron PR for `resourceType` on `did-get-reponse-details` that should allow us to drop the funky stuff this PR does with `onBeforeRequest`: https://github.com/electron/electron/pull/5095
 I just added documentation in the README for this. (Canâ€™t believe I forgot to do that!) Iâ€™ve also updated the code so it no longer uses `webRequest` listeners, but will wait to actually push that until thereâ€™s an actual electron release that it works with.
 The race condition with `did-finish-load` and `did-fail-load` will be solved in the next Electron release, too! https://github.com/electron/electron/issues/5128 Wooo upstream fixes making things easier here :)
 @rosshinkley I think this is good to go. All green and no webRequest stuff.
  It would be great if there was a means to `.evaluate()` and wait on a promise. For example:

``` JS
nm.evaluate(function(nmjsResolver, nmjsRejector){
   navigator.api.
    .waitForThing
    .then(result => nmjsResolver(result))
    .catch(nmjsRejector);
});
```

This could avoid the unnecessary polling that Nightmarejs currently does while waiting for values to become true in the document. 
 > I'm not clear on what you're asking. Are you asking if .evaluate() could wait on a promise internally?

Sorry for not being clear. Yes, that's what I'm asking for. In fact, you could even check if the function passed to evaluate is a GeneratorFunction and underpin evaluate() with promise handling machinery ala async/await or returns a promise. This would allow evalute() to continue to be backwards compatible, but also work with async functions:

``` JS
nm.evaluate(function*(){
   const response  = yield fetch("thing");
   const json = yield response.json();
   return json; 
});
```

Or eventually:

``` JS
nm.evaluate(async function(){
   const response  = await fetch("thing");
   const json = await response.json();
   return json; 
}).then(json => doSomethingElse);
```

> Or are you asking if Nightmare can somehow pick up document changes via events to make .wait() passive?

No. Though semantically that could make sense... it would be like `waitUntil(promiseToResolve)` [API in Service Workers](https://www.w3.org/TR/service-workers/#wait-until-method). 
 Any updates? I'd like to have this implemented as well.
  Hello
I've installed the latest nightmare version on my linux box, and can run the example codes.
I want to do simple screenshot of a web app developed by EXTJS.
here is my simple script:

``` js
var Nightmare = require('nightmare')
  , nightmare = Nightmare({
    //  show: true
   });

nightmare
.goto('http://host_url/login.aspx')
.screenshot('shot.png')
.end()
```

however, running script via node never ends, and activating the show flag brings up a black screen.
  don't work:

``` js
var N = require('nightmare')

var n = N({
    show: true
})

n.goto('https://www.baidu.com/')
 .type('#kw', 'å“ˆå“ˆå“ˆ')
 .click('#su')
 .wait('#content_left')
 .evaluate(function () {
    return document.querySelector('#content_left').textContent
 })
 .end()
 .then(function (result) {
    console.log(result)
 })
```

work:

``` js
var N = require('nightmare')

var n = N({
    show: true
})

n.goto('https://www.baidu.com/')
 .type('#kw', 'hhh')
 .click('#su')
 .wait('#content_left')
 .evaluate(function () {
    return document.querySelector('#content_left').textContent
 })
 .end()
 .then(function (result) {
    console.log(result)
 })
```
 @rosshinkley  thank you
  I was inspired to do this because some event listeners e.g. 'change' are triggered on blur, so they don't happen until we actually click/focus another element.

P.S. insert and type are very similar - there's some potential for refactoring but I don't know what style we would prefer.
 Although some of the tests are timing out on CircleCI, it looks like that's an issue with flaky tests rather than with my change (tests pass for me locally).
 @rosshinkley Sorry, got caught up in other work - I think it makes sense to add focus/blur events when clearing inputs, too. Will hopefully get to that later today.
 Updated to trigger focus/blur events when we clear inputs.
  How do I easily use elements inside an iframe of a page?
Lets assume we have a path like:

`body iframe#id1 #email`

and I want to

``` js
.wait('#email')
.type('#email', 'xxx@example.com')
```

How do I do that without writing functions to select elements like `document.getElementById('myframe1').contentWindow.document.getElementById('x')`
 I don't think you can - at least, not yet.  You might want to read through #203  and #496.
  I'm using Nightmare in conjunction with tape in order to produce TAP output from my automated tests.
I have a test where I'm doing a chain of commands and assertions, e.g. assert a button exists, click the button, assert the expected result (opening an iframe) happened.

I've noticed some weird behaviour in ending Nightmare, I cannot call `.end()` after a `.then()` or within a `.then()`, which would be the logical place to put it, example:

```
var Nightmare = require('nightmare'),
  test = require('tape'),
  newWindow = function(url){
    return Nightmare({show: false}).goto(url);
  };

test('Example', function(t){
  var window = newWindow('http://localhost:3000/');

  // find script tag
  window.exists('script[src="./button.js"]')
  .then(function(r){
    t.ok(r, 'Found a script tag');
  })

  // find button
  .then(function(){
    return window.exists('button');
  })
  .then(function(r){
    t.ok(r, 'Found button');
  })

  // click button
  .then(function(){
    return window.click('button').exists('iframe');
  })
  .then(function(r){
    t.ok(r, 'Clicking button created iframe');
  })

  // find login button
  .then(function(){
    return window.evaluate(function(){
      return document.querySelector('iframe').contentDocument.querySelector('input[name="login"]');
    }).end();
  })
  .then(function(r){
    t.ok(r, 'Found login button inside iframe');
  })

  // end test
  .then(function(){
    t.end();
  });
});
```

This code works as expected, my issue is that I need to place `.end()` on the last call to `window` (my nightmare instance) so if I add more steps I need to move the `.end()` call to the last promise.

Putting `.end()` on the last `.then()` doesn't work, nor does calling `window.end()` within the last `.then()`. Is there any way I can do this cleaner than manually ensuring my last call to the nightmare instance is followed by `.end()` ?

Thanks
 Out of the box, `.end()` puts another action in the action queue, same as anything else.  Modifying your example, excerpted for brevity:

``` js
  // find login button
  .then(function(){
    return window.evaluate(function(){
      return document.querySelector('iframe').contentDocument.querySelector('input[name="login"]');
    });
  })
  .then(function(r){
    t.ok(r, 'Found login button inside iframe');
  })
  // end test
  .end()
  .then(function(){
    //instance is ended
  });
```

Alternatively, you could pass a callback to `.end()` as without it, Nightmare assumes you wanted to add the action to the queue.  Again, using your example:

``` js
  // find login button
  .then(function(){
    return window.evaluate(function(){
      return document.querySelector('iframe').contentDocument.querySelector('input[name="login"]');
    });
  })
  .then(function(r){
    t.ok(r, 'Found login button inside iframe');
  })
  .then(function(){
    t.end(function(){
      //instance is ended
    });
  });
```
 I know this has been sitting for a bit but wanted to make a minor note here. @wyqydsyq you should be able to make your final `then()` to end the test work by simply _returning_ `t.end()`, like so:

``` js
// end test
.then(function(){
  return t.end();
});
```

As @rosshinkley noted, â€œ`.end()` puts another action in the action queue, same as anything else,â€ so just calling `.end()` at the end queues up the end action, but never executes it. Returning a thennable from a promise handler causes that thennable to be run automatically, so the above code is _kind of_ like:

``` js
// end test
.then(function() {
  t.end().then();
})
```

â€¦but either way, yeah, this is definitely a little confusing :\
 @rosshinkley @Mr0grog your explanations are very helpful but you confuse `t.end()` and `window.end()`. I won't check your code snippets but this works, @wcjohnson11 :

``` js
var Nightmare = require('nightmare');
var tape = require('tape');

tape('Nightmare test', function (t) {
  var nightmare = Nightmare();
  nightmare
    .goto('http://localhost:4567/#1')
    .wait('.node-info')
    .exists('.node-info')
    .then((exists) => {
      t.assert(exists);
    })
    .then(() => {
      nightmare.end().then(() => {
        t.end()
      });
    });
});
```
 P.S. @rosshinkley , Add `queue` argument to callbacks, maybe? And why result of `nightmare.then(cb)` isn't chainable? Is it good that `TypeError: nightmare.goto(...).wait(...).exists(...).then(...).end is not a function`?
 @kuraga Augh, sorry. Did not read carefully :(

Either way, `.then(function() { return nightmare.end(); })` (or `.then(() => nightmare.end())` if you have fat arrow support) will do what you want. Hopefully that, at least, was clear!

As an even more concise bonus, since `tape.end()` takes a potential error as its first argument, you can _probably_ (I havenâ€™t tested this) do `nightmare.end(t.end)` at any point to end your tests, too.
 @rosshinkley @Mr0grog @wyqydsyq 
Hm, but for `.evaluate` it really doesn't work!

``` js
  t.test('Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð± ÑƒÐ·Ð»Ðµ 2', function(t) {
    page
      .wait('.node-info')
      .evaluate((selector) => {
        console.log(1);
        return document.querySelector(selector).innerText;
      }, '.node-info')
      .then((text) => {
        console.log(2);
        expect(text).to.match(/Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± ÑƒÐ·Ð»Ðµ 1:/);
      }).then(() => {
        console.log(3);  // ISN'T CALLED!
        t.end();
      });
  });
```
 @kuraga Does your expectation (`expect(text).to.match(/Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± ÑƒÐ·Ð»Ðµ 1:/)`) fail? If so, `console.log(3)` _shouldnâ€™t_ be called, because thatâ€™s in a success handler. The failed expectation will throw an exception, which will cause the promise returned by the `then` that itâ€™s in to _reject_ instead of resolve.

So if thatâ€™s your problem, you should probably:

``` js
  t.test('Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾Ð± ÑƒÐ·Ð»Ðµ 2', function(t) {
    page
      .wait('.node-info')
      .evaluate((selector) => {
        console.log(1);
        return document.querySelector(selector).innerText;
      }, '.node-info')
      .then((text) => {
        console.log(2);
        expect(text).to.match(/Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± ÑƒÐ·Ð»Ðµ 1:/);
      }).then(() => {
        console.log(3);
        t.end();
      }).catch((error) => {
        console.log(â€™something failed:â€™, error);
        t.end(error);
      });
  });
```

or

``` js
...
      }).then(() => {
        console.log(3);
        t.end();
      }).catch(t.end);
```
 Yeah, you're completely right, thanks!
 @wyqydsyq you also can use [`t.plan()`](https://github.com/substack/tape#tplann)
  I'm trying to automate testing paypal integrations and after another annoying update on the paypal side electron starts crashing at the last action, code that I'm posting had worked before (like 4 weeks ago), but then started resulting in a crash. Hopefully some1 can hint me on how to fix/avoid it - I would really appreciate it.

Here are the logs and the code:

https://gist.github.com/AVVS/f641c1535cde2a258e71

``` js
function approve(saleUrl) {
    const browser = new Nightmare({
      waitTimeout: 15000,
    });

    return new Promise(_resolve => {
      const resolve = once(_resolve);

      const _debug = require('debug')('nightmare');

      function parseURL(newUrl) {
        if (newUrl.indexOf('redirect-url') >= 0) {
          const parsed = url.parse(newUrl, true);
          resolve({ token: parsed.query.token, payer_id: parsed.query.PayerID, payment_id: parsed.query.paymentId });
        }
      }

      browser
        .on('did-get-redirect-request', (events, oldUrl, newUrl) => {
          _debug('redirect to %s', newUrl);
          parseURL(newUrl);
        })
        .on('did-get-response-details', (event, status, newUrl) => {
          _debug('response from %s', newUrl);
          parseURL(newUrl);
        })
        .on('will-navigate', (event, newUrl) => {
          _debug('navigate to %s', newUrl);
          parseURL(newUrl);
        })
        .goto(saleUrl)
        .screenshot('./ss/pre-email.png')
        .wait('#loadLogin')
        .click('#loadLogin')
        .wait('#login_email')
        .type('#login_email', false)
        .wait(3000)
        .type('#login_email', 'test@cappacity.com')
        .type('#login_password', '12345678')
        .wait(3000)
        .screenshot('./ss/after-email.png')
        .click('#submitLogin')
        .screenshot('./ss/right-after-submit.png')
        .wait(3000)
        .screenshot('./ss/after-submit.png')
        .wait('#continue')
        .screenshot('./ss/pre-confirm.png')
        .click('#continue')
        .screenshot('./ss/right-after-confirm.png')
        .wait(3000)
        .screenshot('./ss/after-confirm.png')
        .end()
        .then(() => {
          console.log('completed running %s', saleUrl);
          resolve();
        });
    });
  }
```
 First off, are you on the latest release of Nightmare? There have been some changes to screenshotting lately, which is the thing Nightmare does that is most likely to trigger crashers in Electron. The first thing I might try if you are on the latest Nightmare is to remove all your screenshot calls and see if it still crashes.

Regardless, this sounds like a problem in Electron. Are you using the latest version of electron? If you have Nightmare installed globally, you can check by calling:

``` sh
electron --version
```

Or if installed locally:

``` sh
./node_modules/.bin/electron --version
```

The latest that nightmare will install is 0.36.12 and the latest possible is 0.37.5. To update, you could blow away the directory for `electron-prebuilt` that is in either `node_modules` or `node_modules/nightmare` and then `npm install electron-prebuilt`.

If youâ€™re up-to-date and still crashing, you ought to be able to grab a crash report from somewhere on your system. Iâ€™m not sure where to get it on other OSes, but in OS X, you can most easily get it from the Console app in Applications -> Utilities -> Console. Youâ€™ll see a line like:

`4/12/16 10:54:50.155 AM ReportCrash[32556]: Saved crash report for Electron[32596] version 0.37.5 (0.37.5) to /Users/rbrackett/Library/Logs/DiagnosticReports/Electron_2016-04-12-105450_Lilpix.crash`

With a little arrow to the left. Click the arrow, then the â€œOpen Reportâ€ button that appears to get the crash report. It might help us here, but most likely youâ€™ll just want to submit it to the Electron team over at https://github.com/electron/electron/issues
 I have the latest electron-prebuilt and get exactly the same error (see #587).

Any other ideas?
 Regardless, since itâ€™s a crash in Electron, getting the crash report would help a lot. Itâ€™s extremely hard to know whatâ€™s causing the crash without either a reproducible test case or knowledge of what Electron is actually doing when it crashes (from the crash report).

If you canâ€™t get the crash report from the system, you can also try setting `ELECTRON_ENABLE_STACK_DUMPING` (not just `ELECTRON_ENABLE_LOGGING`) alongside `DEBUG=electron:*` as @rosshinkley suggested. Thatâ€™ll at least get you something similar to the system report.
 > would it be worth implementing a crash report server internal to Nightmare

Yeah, that would be really neat to have.
  - [ ] @reinpk 
- [ ] @matthewmueller
- [ ] @rosshinkley 

This works very similar to the screenshot or pdf actions, except it saves the page as html to disk. Its a pretty straight forward pass through to the corresponding electron api.
 Two nits: one, consider adding a link to the [`webContents.savePage()` documentation](https://github.com/atom/electron/blob/master/docs/api/web-contents.md#webcontentssavepagefullpath-savetype-callback) for easy reference to `saveType`.  Two, make sure this PR is properly unit tested.
 @rosshinkley Ok will do!
 Done. I added a passing test and the link to the documentation as requested.
  Type() stopped working for me in 2.2.0. Works fine with 2.0.2 with exact same code. 

> Empty or falsey values provided for text will clear the selector

 What are falsey values ? Something specific changed in 2.2.0 for type() ? 
 > What are falsey values ?

A value where `!value` is `true`.  `undefined`, `null`, `0`, `false` are all falsey.  In Nightmare's case, empty string (`''`) is also included.

> Something specific changed in 2.2.0 for type() ?

Not in 2.2.0, but 2.1.5 and 2.1.1 might be of interest.  Falsey or empty values clear the element retrieved by `selector` .

> Works fine with 2.0.2 with exact same code.

Could you provide an example of what is broken?
 `.type( '#search form.form-inline input' , "something")`
`.wait(1000)`
`.click('#search form.form-inline .pull-right')`

Using `var nightmare = new Nightmare({show: true});` the site returns 

> Search for "" 0 results 

Seems like I'm using a falsey value - empty string - in 2.2.0 but it gives me several results in 2.0.2
 That fragment looks okay to me.  What happens immediately before the first call to `.type()`?

Would it be possible to supply a more complete example or a minimum reproduction case?
 It's also worth pointing out that in 2.0.2, `.type()` set the text instead of trying to issue key events.   [`.insert()`](https://github.com/segmentio/nightmare#insertselector-text) is closer (although not exactly) to how `.type()` worked.  Might be worth a look.
 Hey Ross,

Below my code snippet and what I did to find the problem.

```
function searchSite(data){
button = '#search form.form-inline .pull-right'
inputfield = '#search form.form-inline input'
Promise.resolve(nightmare
    .goto('https://somesite/home')
    .wait(2000)
    .type(inputfield, 'something')
    .click(button)
    .wait(2000)
    .evaluate(function() {
      l = document.querySelectorAll(".article").length;
      group = document.querySelectorAll(".col-md-9 h1")[0].innerText;
      a=[];
      for (i = 0; i < l; i++) {
        a[i] = {price: document.querySelectorAll(".article div.price p.unit span:nth-child(2)")[i].innerText + document.querySelectorAll(".article div.price p.unit span:nth-child(1)")[i].innerText, name: document.getElementsByClassName('prodInfo')[i].title};
      }

      g={'products' : a, 'productgroup' : group, '#products' : i};
      return g;
    }))
.then(function(g){
    console.log(g);
    nightmare.proc.disconnect();
    nightmare.proc.kill();
    nightmare.ended = true;

});
}
```

I tried `.insert()`, same problem. 
I tried different  selectors, meaning I replaced `#search` with its parent divs. e.g. `#nav_bar div.container div.row div.col-md-3 div.ui-front form.form-inline input` ( `div.ui-front` is the same element as `#search` ) This time I saw 'something' being typed in the inputfield using type() - while previously I didn't saw this happening - but still 0 results.

Meanwhile I found a simpler method :
`.goto('https://somesite/search?z=something)` and it works.

Also worth mentioning is I used similar code on another inputfield on the same site and it works. Difference is this inputfield isn't  linked to the url, meaning `.goto('https://somesite/search?z=something)` isn't possible for this inputfield. 
  I am trying to enter multiple lines of text in a text area using nightmare. This is my sample code snippet.

```
nightmare
  .goto('http://www.google.com/intl/si/inputtools/try/')
  .type('textarea[id="demobox"]', 'typing text line 1')
  //enter key for new line
  .wait(200)
 .type('textarea[id="demobox"]', 'typing text line 2')
  //enter key for new line
  .wait(200)
  .evaluate(function () {
    return document.querySelector('#demobox').value
  })
  .end()
  .then(function (result) {
    console.log(result)
```

  })

how can this be done? 

I tried using 
`.type('textarea[id="demobox"]', '/n')`
 but didn't work 
 Nightmare's `.type()` splits the string into characters blindly, causing `\n` to be typed as `['\', 'n']`.

There are two alternatives I can think of.  One, [use `.insert()`](https://github.com/segmentio/nightmare#insertselector-text).  The `.insert()` method adds text without triggernig keyboard events.  Text will be entered into the selector as passed, honoring newlines, backspaces, etc.  

Two,  use `.evaluate()`.  If you need keyboard events (eg `keyup`, `keydown`, etc) to occur with the typed text, use `.type()` as you are now followed by an `.evaluate()` call.  Something like:

``` js
nightmare
  .goto('http://www.google.com/intl/si/inputtools/try/')
  .type('textarea[id="demobox"]', 'typing text line 1')
  .evaluate(function(){
    document.querySelector('#demobox').value += '\n';
  })
  .wait(200)
 .type('textarea[id="demobox"]', 'typing text line 2')
  .evaluate(function () {
    return document.querySelector('#demobox').value
  })
  .end()
  .then(function (result) {
    console.log(result)
})
```

It's worth pointing out that the keyboard events will not be fired for the newline.  Do you need the keyboard events for the newline?
 I was able to move to a new line using insert with \n. Thanks for that.
I am trying to use google input tools (http://www.google.com/intl/cn/inputtools/try/), so that after each letter I need to use the enter key. will this be possible?
  keep track of #393 , i will find time to support that 
 hi guys! how's it going?

I just need to include nightmare in a electron application
  My team and I are developing an application that monitors our other servers so we can be the first to know when a server goes down. We've used nightmare to achieve this, and it's really reliable.

.....That is, it's really reliable on our development machines and mac minis in our office. We tried to upload our code to an AWS instance running ubuntu 14.04.3 and had no success. After some research, we discovered that electron was the problem. For whatever reason, electron-prebuilt does not come with the right stuff to be run off of ubuntu and work as expected.

Because electron does not work, we suspect the headless browser does not get created, and therefore tests that we run fail silently. No errors are thrown, but we can see that as soon as the first test is hit no further progress is made and during the next testing cycle the first test is hit again before stopping and waiting until another testing cycle begins.

Is there a way around this? Maybe a different version of electron can be used? Has anyone else had problems running nightmare on an AWS instance, or been able to get nightmare working on one?
 You can use Xvfb (virtual framebuffer). See https://github.com/segmentio/nightmare/issues/224#issuecomment-182470015
 If I absolutely cannot get [zombiejs](http://zombie.js.org/) to work, which is what I am now trying to use, I will go back and try your suggestion.  It sounds like the guys who were participating in your linked thread were having to try some very involved processes which is a red flag for me.

Thanks for taking the time to reply,
 I've had success on Ubuntu 14.04 Server from installing the prerequisite packages (see the Dockerfile in the linked comment) and just running node with `xvfb-run node ...`.
 Xvfb is how we use Nightmare in-house. it's not nearly as complicated as its been made out to be either. I can help you get it setup if you like @mwiegant 
 linking #421 due to the underlying hidden failure here 
 I have gotten it working on travis-ci using this script:

```
sudo: false
language: node_js
node_js:
  - "stable"

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.8
    - g++-4.8
    - xvfb

before_install:
- export DISPLAY=':99.0'
- Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
- export CC=`which gcc-4.8`
- export CXX=`which g++-4.8`
- echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > .npmrc
```

I'm pretty sure that travis is just using linux on AWS
 I was able to get my tests running by prefixing `npm` with `xvfb-run`. E.g.

`$ xvfb-run npm test`
  How best way to get in cecle?
`
function clickBtn(){
    nightmare
        .goto('https://site.com/')
        .type('input[name="test-input"]', 'text')
        .click('.add-test')
}

for(var i= 0; i<5; i++) {
    clickBtn();
}
`
 This is similar to #522.  Nightmare's calls are asynchronous, but can only run one instruction at a time.  Your example is also queueing operations, but never executing them.

There are a couple of options for getting results in series.

### Use `Array.reduce`

You could prepare several operations in a loop, pushing each promise onto an array and then executing the promises in series using `Array.reduce`.  For example:

``` js
var Nightmare = require('nightmare');
var nightmare = Nightmare();
var promises = [];

for(var i=0; i<5; i++){
  promises.push(nightmare.goto('http://example.org').title().then());
}

promises.reduce(function(accumulator, promise){
  return accumulator.then(function(results){
    return promise.then(function(title){
      results.push(title);
      return results;
    });
  })
}, Promise.resolve([]))
.then(function(results){
  nightmare.end(function(){
    console.dir(results);
    console.log('done');
  });
});
```

Note the call to `.then()` in the loop.  Without this, Nightmare will queue the `.goto()` and `.title()` calls 5 times, executing them for the first then in the `.reduce()` series.  This will result in one instance of the title and four undefined array members.

### Use [`vo`](https://github.com/lapwinglabs/vo)

Style-wise, vo might be closer to what you have in mind.  This would let you yield in the loop to get the information you want.  For example:

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare(),
  vo = require('vo');

var run = function*(){
  var results = [];
  for(var i=0; i<5; i++){
    var result = yield nightmare.goto('http://example.org').title();
    results.push(result);
  }
  return results;
}

vo(run)(function(err, results){
  console.dir(results);
  console.log('done');
});
```

### Use [`co`](https://github.com/tj/co)

`co` is similar to `vo`, but instead of taking a callback, it returns a promise.  For example:

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare(),
  co = require('co');

var run = function*(){
  var results = [];
  for(var i=0; i<5; i++){
    var result = yield nightmare.goto('http://example.org').title();
    results.push(result);
  }
  return results;
}

co(run).then(function(results){
  console.dir(results);
  console.log('done');
});
```
 Maybe you can add this to the documentation? 

I guess it's a very common case, e.g. when you screen-scrape something and want to download a lot of documents (like invoices) available from a single page, for example.
  I am having this issue as well. My cookies are not transferrable from one nightmare instance to another, even when using cookies.set.
 I don't think you can transfer cookies across domains.  The [current specification](http://tools.ietf.org/html/rfc6265) that most browsers honor says the domain requested from the browser must match the cookie's origin domain or be a subdomain.  I'm paraphrasing, of course, but that's the spirit.  [This article on the current state of cookie domains](http://bayou.io/draft/cookie.domain.html) does a much more comprehensive job explaining how this works than I could do here.

@Velissel's example appears to be trying to put cookies from one domain onto another, which is forbidden to the best of my knowledge.

@rclai _might_ be talking about something different: are you trying to reuse cookies from the same domain across Nightmare instances?
 @rosshinkley I figured it out, this issue is not relevant to me anymore. I used the persistence options.
 @rclai Ah, okay.  Good to know.  Thanks for the response. :)
 > ... set cookies before I start anything...

Are you trying to set cookies before your first call to `.goto()`?  I don't think `.cookies.set()` will work prior to a page being loaded.
 > ...  I firstly go to google, then try to set cookies of a session I extracted from something.abc.com so that multiple newly opened instances will have the same session when I change those instances to something.abc.com...

@Velissel I understand you want to preload the cookies before navigation, but I don't think Nightmare allows for adding cookies _prior_ to navigation.  I still don't think adding cookies across domains like you're doing is permitted.

With #425, you could probably extend Electron to add a hook to the `'did-start-loading'` event to add cookies prior to the page loading.  If it interests you, I could pull together an experimental plugin to prove feasibility.

> I tried it with phantomJS, it works with dot prefixed. Maybe it is the implementation of electron preventing it?

I'm skeptical it works in exactly the manner you're describing under Phantom.  I'd have to put together an experiment to see for myself.

> As far as I know, cookies without dot as prefix is usually set through set-cookie header section of a server's response, but most modern browsers consider cookies with or without dot at beginning the same now, so I was expecting electron to act the same...

This is correct - with or without is considered equivalent, at least to the best of my knowledge.

> BTW, using persist:somthing does not work for the website I am working on

Could you expand on this?  What exactly isn't working?
  In attempting to explain the behavior of `run` and `then` for #516, I realized the details of how Nightmareâ€™s `then` method works means you canâ€™t just say â€œworks like `promise.then`.â€ The difference is minor and the likelihood of it tripping someone up is probably low, but it could still happen, especially given the promise-y expectations the methodâ€™s name sets up. Since `then` is now the preferred API, it should really be documented and, in doing so, the details of `then` should be made clear.

In the spirit of @rosshinkleyâ€™s comments on #491:

> I am certain it's going to come up in questions again and I wanted to have a reference to point at.

It might be helpful to understand _why_ Nightmareâ€™s `then` method does not behave in accordance with a promiseâ€™s `then` (or any Promises/A+ compliant thenable) in order to better document it.

Specifically, _if an error occurs in the success callback that is passed as the first argument to `then` (or if that callback returns a promise that rejects), the error callback passed as the second argument to `then` will handle it instead of it bubbling up the promise chain._

Is this difference intentional? If so, what was the intent behind that decision? What was it meant to enable or prevent, if anything? If not, is this a bug to be fixed?
 I suspect the difference is a side effect of ensuring `vo`, `co`, and possibly `mocha-generators` Just Work&trade;.  Consider the following (admittedly contrived) example:

``` js
var Nightmare = require('nightmare'),
    vo = require('vo');

function * run() {
    var nightmare = new Nightmare({
        show: false,
    });

    yield nightmare
        .goto('http://example.com')
        .wait('body')
        .evaluate(function(){
            throw new Error('uh oh');
        });

    yield nightmare.end();
}

vo(run)(function(err) {
    if (err) {
        console.dir(err);
    }
    console.log('done');
});
```

Out of the box, `vo` runs the promise and passes internal methods to `fulfill` and `reject` as prescribed by [the native promise documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise).  If you remove the `.catch()` call from Nightmare under `.then()`, the above example hangs.  Simillarly, with `co`, the rejection callback is never called (for hopefully obvious reasons).

All of that said, I agree with you that it is a _little_ misleading that you couldn't modify my original example to something like the following:

``` js
var Nightmare = require('nightmare'),
var nightmare = Nightmare();
nightmare
  .goto('http://example.com')
  .wait('body')
  .evaluate(function() {
    throw new Error('uh oh');
  }).then(function(){
    console.log('done');
  }).catch(function(err){
    console.dir(err);
  });
```

... which is the situation I think you have in mind.  I think this top-level `.catch()` is a legitimate use case.  I don't think it's as much of an edge case as you're leading us to believe. :)

And with that in mind, [I played around with Nightmare in an attempt to address this issue](https://github.com/rosshinkley/nightmare/blob/527/lib/nightmare.js#L321-L343).  I haven't opened a PR for it _just_ yet, I wanted to get feedback from you first.  Thoughts?

---

PS: excellent explanation at #516.  Thank you for taking the time to do that. :)
 Ok, Iâ€™m suddenly realizing that my initial post was super hand-wavey on what the exact difference was, and itâ€™s that we are doing this:

`nightmare.then(onSuccess, onError)  -->  promise.then(onSuccess).catch(onError)`

instead of:

`nightmare.then(onSuccess, onError)  -->  promise.then(onSuccess, onError)`

which is only very subtly different (namely, it conflates an error in the thing being promised [actions in Nightmare] with an error in user code _handling_ the promise). More belowâ€¦

> If you remove the .catch() call from Nightmare under .then(), the above example hangs.

Rightâ€”but you wouldnâ€™t want to just remove the `catch`, call; youâ€™d want to pass the `reject` callback as the second argument to `then`'s internal `then`. So then the implementation of `then` would then be:

``` js
Nightmare.prototype.then = function(fulfill, reject) {
  var self = this;

  return new Promise(function (success, failure) {
    self.run(function(err, result) {
      if (err) failure(err);
      else success(result);
    })
  })
  .then(fulfill, reject);  // <- the only change
};
```

If I make that change, I see identical behavior to the previous implementation when using Vo/Co (we get to logging 'done', but not to actually closing down nightmare). Is that what you see, or am I misunderstanding what you were getting at here?

> All of that said, I agree with you that it is a little misleading that you couldn't modify my original exampleâ€¦

Wellllll, as long as `console` is present (which it is), that example works â€œrightâ€ in promise terms, though it doesnâ€™t (and arguably shouldnâ€™t) do the same thing as your previous generator example. If you always want â€œdoneâ€ to get logged, youâ€™d have to do it after handling the error:

``` js
var Nightmare = require('nightmare'),
var nightmare = Nightmare();
nightmare
  .goto('http://example.com')
  .wait('body')
  .evaluate(function() {
    throw new Error('uh oh');
  })
  .then()
  .catch(function(err){ // you could combine w/ the above line: `.then(null, function(err){`
    console.dir(err);
  })
  .then(function(){
    console.log('done');
  });
```

But anyway, none of that really changes if `then` behaves like it currently does or if exactly like `promise.then`. Hereâ€™s (I think) the only difference in practice:

``` js
var Nightmare = require('nightmare'),
var nightmare = Nightmare();
nightmare
  .goto('http://example.com')
  .wait('body')
  .evaluate(function() { return document.title; })
  .then(function(title) {
    console.oops('Title:', title);
  }, function(error) {
    console.dir(error);
  });
```

In a normal promise, our error handler would never run because the only error here is in the success callback. The way Nightmare implements `then`, though, it doesâ€”the console logs `[TypeError: console.oops is not a function]`.

If you used `catch` (or a second `then`) instead of a two-arg `then`, youâ€™d both expect (with a standard promise) and get the same behavior Nightmare produced in the above example:

``` js
var Nightmare = require('nightmare'),
var nightmare = Nightmare();
nightmare
  .goto('http://example.com')
  .wait('body')
  .evaluate(function() { return document.title; })
  .then(function(title) {
    console.oops('Title:', title);
  })
  .catch(function(error) {  // or `.then(null, function(error) {`
    console.dir(error);
  });
```

Thatâ€™s why I donâ€™t think a lot of people will trip over thisâ€”the above is generally the recommended way to do things (to ensure you catch your own errors in your handler) and it behaves just fine with Nightmare right now.

> And with that in mind, I played around with Nightmare in an attempt to address this issue.

So assuming we _wanted_ `then` to behave exactly like a promiseâ€™s then (which I am trying not to assume is the case), I think the relevant change would be my first example at the top of this comment.

In your experiment, youâ€™re handling a lot of different conditions explicitly, but still using the `then(onSuccess).catch(onError)` construct, which is the source of the difference in behavior. That is to say, I donâ€™t think your change there would â€œsolveâ€ what I was trying to get at with this issue, though it might solve something else I wasnâ€™t thinking about :)
 As I'm rereading what I originally wrote, and the original content of my little experiment, three things jump out: one, that I was hopelessly vague; two, that your solution was staring me in the face and I didn't spot it off the bat; and three, I am pretty certain I am way, _way_ off.  (And now I feel silly.  More on your solution/my feelings in a moment.)

>  Is that what you see, or am I misunderstanding what you were getting at here?

I'm following now, and thank you for the clarification.  I can see why you were confused, though: I had gotten it in my head that the way Nightmare implemented `.then()`, it might be eating the exception, making a `.catch()` at the end of a chain never get called.  Clearly not, as `.then()`/`.catch()` with falsey arguments still returns a promise.  Looking over my original notes and sandbox, I'm not entirely sure how I got to the "eats exceptions" conclusion.

> If you always want â€œdoneâ€ to get logged, youâ€™d have to do it after handling the error:

No, I wouldn't expect "done" to always get logged, and this is where I _knew_ I had been vague, and was reasonably certain I had done something improperly.  See previous paragraph.  I was well into the weeds and wrong whole cloth.

> So assuming we wanted then to behave exactly like a promiseâ€™s then (which I am trying not to assume is the case),

I think expecting Nightmare's `.then()` implementation to behave like a compliant promise seems reasonable.  Why would that be an unfair assumption?  Is there something I'm not thinking of?  More to the point, would there be a reason for Nightmare's `.then()` _not_ to behave like Promise's `.then()`?

> That is to say, I donâ€™t think your change there would â€œsolveâ€ what I was trying to get at with this issue, though it might solve something else I wasnâ€™t thinking about :)

It doesn't, at least nothing your implementation doesn't also solve.  I was fighting my own ignorance - again, see above.

Setting self-deprecation and self-disappointment aside, I agree - especially now that I think (hope?) I understand the problem - this is a pretty minor inconsistency, but an inconsistency nonetheless.  I'd prefer to err on the side of compliance over not.  Thoughts?
 > Looking over my original notes and sandbox, I'm not entirely sure how I got to the "eats exceptions" conclusion.

Iâ€™m betting that might be at least partially my fault; I think I said something to that effect in my description on #516. _In fact,_ that is exactly what I thought was happening at the time, before I sat down to really think about it when writing this very issue. The original title was â€œdifference**s** betweenâ€¦â€ before I realized that wasnâ€™t actually happening :P

> Is there something I'm not thinking of? More to the point, would there be a reason for Nightmare's .then() not to behave like Promise's .then()?

Not that I can think of; thatâ€™s why I raised the issue! Hopefully @matthewmueller will fill us in at some point.

> I'd prefer to err on the side of compliance over not. Thoughts?

I would generally agree. But since @matthewmueller didnâ€™t write any docs and didnâ€™t invite any discussion or review of the feature, I didnâ€™t want to make an assumption about whether the non-compliant behavior was intended or just a bug. So I asked by way of this issue :)
 > > I'd prefer to err on the side of compliance over not. Thoughts?
> 
> I would generally agree. But since @matthewmueller didnâ€™t write any docs and didnâ€™t invite any discussion or review of the feature, I didnâ€™t want to make an assumption about whether the non-compliant behavior was intended or just a bug.

Since this has sat for more than a month with no feedback from @matthewmueller , Iâ€™m going to go ahead and just transform it from a question to a statement and call it a bug:

`then()` **should** act like Promises/A+ `then()` and ES6 Promise `then()`. The second argument should not be called because of an exception while running the first argument.

If thatâ€™s cool with you, @rosshinkley. The implications are minor and, I think, an improvement.
  I am trying to loop over array and call nightmare but I get this error:

``` js
possible EventEmitter memory leak detected. 11 ready listeners added. Use emitter.setMaxListeners() to increase limit.
```

I am using version 2.2.0 with node 5.7

``` js
Object.keys(urls).forEach(blogUrl => {
  getLinks(blogUrl, blogs[blogUrl].selector);
});

function getLinkst(url, selector) {
  nightmare
    .goto(url)
    .evaluate(() => {
     return document.querySelector(selector).href;
    })
    .end()
    .then(result => {
      console.log(result);
    })
}
```
 It might be that the maximum number of listeners should be boosted, but you may still want to restructure your code slightly anyway. As a side benefit, doing so might alleviate the problem, too.

Try rewriting `getLinks()` this way:

``` js
function getLinks(url, selector) {
  Nightmare()  // <- create a new Nightmare instance every time
    .goto(url)
    .evaluate((selector) => {
     return document.querySelector(selector).href;
    }, selector)
    .end()
    .then(result => {
      console.log(result);
    })
}
```

Each nightmare instance represents one browser window; if you donâ€™t wait for all the actions in that window to complete before triggering new actions, you can easily run into problems. In this case, your original code would likely result in the window constantly browsing to new URLs before ever getting around to looking for a selector, so most of your attempts to get the `href` from the selector would wind up getting it from the wrong page. Doing each query in a new Nightmare instance keeps it safe.

Alternatively, you could wait for each series of actions to complete before asking for the next link:

``` js
getLinks(Object.keys(urls));

function getLinks(blogUrls) {
  var blogUrl = blogUrls.shift();
  getLink(blogUrl, blogs[blogUrl].selector)
    .then(result => {
      console.log(result);
      getLinks(blogUrls);
    });
}

function getLink(url, selector) {
  return nightmare
    .goto(url)
    .evaluate((selector) => {
      return document.querySelector(selector).href;
    }, selector);
}
```

The flow is a little more complicated there, but you can avoid running lots of electron processes at once this way.
 Thanks you!
  This is just a question and not really an issue: 
Have you experienced any troubles with CI integration, (I believe your using circleci) after updating to 2.1.4?

Thanks
 no I still have no idea, we are using jenkins and installed bunch of plugins to get electron working, and it still is, but with the newst version it just "hangs" without any errors or logs. no idea how to debug it.
 @rosshinkley hey, i've just checked the 2.5.0 version, it still hangs without any logs. the highest version it works for me is 2.1.3
 node version 4.2.6

just turned debugging on and saw this:

```
+ DEBUG=nightmare* NODE_ENV=testing-production make ftest
node_modules/.bin/mocha --harmony test/functional/ ./apps/**/test/functional/*.coffee --opts test/functional/mocha.opts --reporter dot
Listening on port 4600
Tue, 31 May 2016 14:25:51 GMT nightmare running
Tue, 31 May 2016 14:25:51 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
```

"...may not have electron installed correctly" but it doesn't exit the process
 ah, thanks now its possible to see much more. I assume it fails every test very slowly or tries to recover over and over again.

```
Listening on port 4600
Tue, 31 May 2016 18:03:24 GMT nightmare running
Tue, 31 May 2016 18:03:24 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:03:24 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
  â€¤Tue, 31 May 2016 18:03:54 GMT nightmare running
â€¤Tue, 31 May 2016 18:04:24 GMT nightmare running
Tue, 31 May 2016 18:04:24 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:04:24 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
â€¤Tue, 31 May 2016 18:04:54 GMT nightmare running
â€¤Tue, 31 May 2016 18:05:25 GMT nightmare running
Tue, 31 May 2016 18:05:25 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:05:25 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
â€¤Tue, 31 May 2016 18:05:55 GMT nightmare running
â€¤Tue, 31 May 2016 18:06:25 GMT nightmare running
Tue, 31 May 2016 18:06:25 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:06:25 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
â€¤Tue, 31 May 2016 18:06:55 GMT nightmare running
â€¤Tue, 31 May 2016 18:07:25 GMT nightmare running
Tue, 31 May 2016 18:07:25 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:07:25 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
â€¤Tue, 31 May 2016 18:07:55 GMT nightmare running
â€¤Tue, 31 May 2016 18:08:25 GMT nightmare running
Tue, 31 May 2016 18:08:25 GMT electron:stderr /var/lib/jenkins/workspace/webapp-staging/node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
Tue, 31 May 2016 18:08:25 GMT nightmare electron child process exited with code 127: command not found - you may not have electron installed correctly
```
 That's what I though when I opened this issue! Thanks so much, I will try it tomorrow (gmt)
  I need to add custom header to the every request. Using `nigthmare.header()` method sends those only with `goto` call, so for instance if I have an XHReq in the app I'm automating with `nightmare`, the header isn't sent with it. Is there any way to make it happen?
 I don't think `.header()` was intended to wrap _every_ request from Electron.  (If I'm wrong on that, someone please correct me.)

If you wanted to add headers to every XHR request from the site's client code, you could conceivably use a [custom preload script](https://github.com/segmentio/nightmare#custom-preload-script) to override how `XMLHttpRequest.send()` works.  Something like this at the end of a custom preload script:

``` js
  XMLHttpRequest.prototype._send = XMLHttpRequest.prototype.send;
  XMLHttpRequest.prototype.send = function(){
    this.setRequestHeader('x-foo', 'some value');
    this._send();
  };
```

... would add `'x-foo'` to every request

Disclaimer: I don't think overriding the constructor for `XMLHttpRequest` is the best of ideas, but for a controlled, non-production test environment, it is probably okay.

Is that closer to what you had in mind?
 Thanks @rosshinkley .
The app I'm automating uses jQ for all of the requests so I just added this snippet that forces every XHReq to contain those headers, what is close to what you proposed.

``` javascript
  $.ajaxSetup({
    headers: { 'X-HWDP' : 'JP100' }
  })
```

Anyway, is there a chance to have a feature like this in Nigthmare? Or how to achieve this in Electron?
  Makes it possible to listen for `media-started-playing` and `media-paused` with the on method.

Useful in testing apps that deal with audio playback.
  `javscript` â†’ `javascript`
  **Test Case**

``` js
// test/index.js
it('should inject javascript and return result', function*() {
  var result = yield nightmare
    .goto(fixture('manipulation'))
    .inject('js', 'test/files/eval.js');
  result.should.equal(6);
});

it('should inject javascript and capture syntax error', function*() {
  var didFail = false;
  try {
    yield nightmare
      .goto(fixture('manipulation'))
      .inject('js', 'test/files/error.js');
  } catch (e) {
    didFail = true;
  }
  didFail.should.be.true;
});
```

``` js
// test/files/error.js
/* syntax error */
{
```

``` js
// test/files/eval.js
/* expression to eval */
alert(123), 2*3
```

**Source Code**

``` js
// lib/nightmare.js
Nightmare.prototype._inject = function(js, done) {
  // ...
  // ~~child.emit('javascript', template.inject({ src: js }));~~
  child.emit('javascript', template.inject({ src: JSON.stringify(js) }));
  // ...
};
```

``` js
// lib/javascript.js
var inject = [
  "(function javascript () {",
  // ...
  "  try {",
  // ~~"    var response = (function () { {{!src}} })()",~~
  "    var response = eval({{!src}})",
  "    ipc.send('response', response);",
  "  } catch (e) {",
  "    ipc.send('error', e.message);",
  "  }",
  // ...
].join("\n");
```

**Note: this solution uses `eval`, but I guess it is safe cuz the `src` is `JSON.stringify()`d.**

Before the fix, the test case would hang util timeout.
Related: #511 
  Fix #511
 Thanks!
  #### Question

When I click on a given button in my app it opens a popup window using good ol' `window.open(url)`. Can I somehow access it's content? I don't have an access to the `window` object returned by `window.open` in the app because it's in the closure and rebuilding the architecture to gain this access in tests is IMHO an overengineering.
#### Example

Let's say I'm doing something similar to this:

``` javascript
var nightmare = Nightmare({ show: true })

nightmare
  .goto('mysite.url')
  .click('#open-popup')
  .magicallySwitchContextOfTheFollowingMethodsToPopup() // <-- this is what I'm looking for
  .type('#popup-input', 'HWDP') // <- type in popup
  .evaluate(function () {
    // do stuff in the popup here
  })
  .end();
```

Any clues?
 I had experimented with creating a plugin solution for this using #425 to solve [this StackOverflow question](http://stackoverflow.com/questions/34912579/how-can-i-get-a-screenshot-of-a-popup-window-after-login-with-nightmarejs).  I had shelved the experiment because there are a couple of nasty problems - for starters, you can't arbitrarily reassign the `win` reference for the browser window Nightmare uses.  (Doing so would require _significant_ refactoring.)  Second, since the windows Nightmare uses are ostensibly hidden, the provided solution would have to handle/mock focus internally.  Finally, you will lose the ability to run ordinary Nightmare commands against the newly-created window (again, without significant refactoring).

With those limitations in mind, I humbly submit [the outgrowth of that experiment](https://github.com/rosshinkley/nightmare-window-manager).  It has a flavor of `.evaluate()` so you can still do _most_ of what Nightmare offers.  Feedback welcome.
  Is it possible to log to the console midway the nightmare session? Here is some code to clarify

```
nightmare
    .on('console', function (msg) {
        console.log(msg);
    })
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('#uh-search-button')
    .wait('#main')
    .evaluate(function () {
        var test = document.querySelector('#main .searchCenterMiddle li a')
            .href;
        console.log('LOGGING 1', test);
        return test
    })
    .type('input[title="Search"]', 'ghosts')
    .click('#uh-search-button')
    .wait('#main')
    .evaluate(function () {
        var test = document.querySelector('#main .searchCenterMiddle li a')
            .href;
        console.log('LOGGING 2', test);
        return test
    })
    .end()
    .then(function (result) {
        console.log(result)
    })
```

In the code above, I am using the search field twice on the Yahoo site and I am trying to log the result each time to the console for monitoring purposes.

. The console.logs() do not work in both cases
. One can only use evaluate once

Can some explain how I can achieve multiple eval and logging? Thanks
 I think these are two separate questions.  For the logging, the `console` calls were condensed and simplified in 2.1.0, but the template for `.evaluate()` didn't get updated to reflect those changes.  This was also reported in #504 and a proposed fix was submitted in #476.

As for evaluate: I think you're hitting a problem with element existence and Nightmare not being terribly good at warning you when you're performing actions on elements that don't exist.  The following will complete and print out the result of the `href`, but I doubt it does exactly what you want:

``` js
nightmare
    .on('console', function (type, msg) {
        console.log(msg);
    })
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('#uh-search-button')
    .wait('#main')
    .evaluate(function () {
        var test = document.querySelector('#main .searchCenterMiddle li a')
            .href;
        console.log('LOGGING 1', test);
        return test
    })
    .type('#yschsp', 'ghosts')
    .click('.sbb[type="submit"]')
    .wait('body')
    .evaluate(function () {
        var test = document.querySelector('#main .searchCenterMiddle li a')
            .href;
        console.log('LOGGING 2', test);
        return test
    })
    .end()
    .then(function (result) {
        console.log(result)
    })
```

The second search doesn't clear the searchbox, and will prepend "ghosts" to the original "github nightmare" search term.
 Hmm, which version are you using? I have just tried "nightmare": "^2.2.0" and I cannot execute multiple evaluate calls
 I'm using 2.2.0 as well.  Are you getting exceptions?

To be certain that you cannot execute multiple evaluate calls, I think it's worth trying a simpler example.  Consider:

``` js
var Nightmare = require('nightmare'),
  nightmare = Nightmare();
nightmare
  .goto('http://example.com')
  .evaluate(function() {
    return 'hello';
  })
  .then(function(str) {
    console.log(str);
  })
  .then(function() {
    return nightmare
      .evaluate(function() {
        return 'world';
      });
  })
  .then(function(str) {
    console.log(str);
  })
  .then(function(){
    return nightmare.end();
  })
  .then(function() {
    console.log('done');
  });
```

This should print:

``` text
hello
world
done
```

Does the above work for you?
 Once again, thanks @rosshinkley.

Actually, I think your firs example was more what I was looking for. May I clarify? I would like to test processes, for example a questionnaire or a wizard: I would like to evaluate the outcome after each step, in most cases a click and log the output to the console.

I am still having problems with the snippet, even with your fork

```
"nightmare":"git://github.com/rosshinkley/nightmare#505",
```
  https://github.com/segmentio/nightmare/blob/master/Makefile
so that we can just run the test on windows seamlessly
makefile seems to be unfriendly to windows

``` js
"scripts": {
  "test": "mocha --harmony"
}
```
 This is a little tangential, but #571 made me wonder if the scripts added in #565 should really be part of Nightmare itself instead of the tests. That is, using Nightmare as a testing tool on a CI server somewhere seems like a major use-case. As it stands now, every user of Nightmare will have to know that they need to replicate Nightmareâ€™s testing setup. If Nightmare just did all of that on its own before launching Electron, that would not only solve the deadlock for Nightmareâ€™s own tests but also for other tests that leverage Nightmare.

Doing so would also simplify the test script to the point where we might not need to worry about adding Gulp or some other solution to get things working on Windows.

(Note I have no idea whether this is the problem being encountered in #571; that issue just made me think of this.)
 > My main dev box is running both X and Xvfb - what if I want to see the Electron instance? What should Electron run under? Implementing your proposed changes has other setup complications, I'd think: I would want to preemptively check for an available framebuffer, but I don't know off the top of my head how to do that.

It might be enough to just be dumber. Maybe an env var like `NIGHTMARE_USE_XVFB` opts into the automagic. Itâ€™s easy enough to set that on your local box or on any CI platform.
 Works for me. Rewriting those scripts in JS makes sense, regardless, since it would still have to be done to get rid of the makefile.
 Is that https://github.com/rosshinkley/nightmare/tree/502 ?
1. Maybe start xvfb separately and, once itâ€™s running, then start Electron? This might be better anyway because we need to handle multiple instances of Electron starting/ending/overlapping at different times. Iâ€™m not sure if `xvfb-run` takes care of all that for you or not.
2. Can you get the PID for Electron somehow? I donâ€™t see anything obvious on `xvfb-run`â€™s manpage, but my knowledge of it is pretty rudimentary.
3. Directly killing Electron is sort of a simple expedient; you could re-write it as an IPC call that asks the Electron process to quit.
 > Well, it is. Kind of.

I guess I _mainly_ meant: as a separate process. Start the xvfb server, then start Electron so you have two process handles instead of doing it together with `xvfb-run`. I think (?) you could still maintain 1 nightmare instance : 1 xvfb : 1 electon, even if I wasnâ€™t directly proposing that. This is where my knowledge of what xvfb is doing isnâ€™t deep enough. I donâ€™t know what happens if you try to run two xvfb server instances at once, but was assuming (maybe wrongly) that you couldnâ€™t.

> I'd prefer Nightmare to clean up after itself when it's finished.

I wasnâ€™t suggesting that it shouldnâ€™t! Obviously this whole method requires more bookkeeping: whenever an Electron process ends, youâ€™d have to check and see whether any others are running in order to know whether to stop xvfb. For that purpose, though, it could be as simple as a counter.
 Side note: I _suspect_ the `xvfb-run` method will cause problems for dealing with the exit code of the Electron process (https://github.com/rosshinkley/nightmare/blob/502/lib/nightmare.js#L128), since `xvfb-run`â€™s manpage makes it sound like the exit code is not preserved.
 > The current incarnation adds another action to have Electron exit internally rather than killing the process from the parent. This works, but again, breaks the kill test.

If Iâ€™m reading right, think thatâ€™s just because youâ€™re changing the API. Youâ€™d have to update [`test/files/nightmare-unended.js`](https://github.com/rosshinkley/nightmare/blob/502/test/files/nightmare-unended.js) to pass back the right PID. (`nightmare.proc` is no longer the Electron process with your changes.)
 > You can run the processes independently, but it would appear that Electron picks whatever display is first available when not running as a child process.

Did you try setting the display via `app.commandLine.appendSwitch('display', 'displaynum')`? (http://peter.sh/experiments/chromium-command-line-switches/#display)

Alternatively, do the various XVFB displays show up in `electron.screen`? (http://electron.atom.io/docs/api/screen/) If so, we could possibly use that to make sure the window goes to the right display.

> The constructor starting Electron has been a long-standing bugbear for me, and I may split that part out into it's own PR. Thoughts?

Sounds good to me.

> What if a timeout [for `browser-initialize`] was propped up around that (say, 5s?) that if hit, would kill the Electron process and restart it?

Sounds not-so-lovely, but it probably would be a reliable end-run around the problem. Sometimes the ugly fix is the one that works best, though. If it seems like the automatically running XVFB stuff is working, I might want to avoid it, personally. But if this is all proving too crazy and problematic, than letting it lie and taking the timeout/retry approach might be the right thing to do.
  Should fix: #500 
 > The only cases I can maybe see this being useful is with .screenshot(), .pdf() or .html(). Even at that, it's only the most trivial of cases of each.

On the one hand, even the most trivial cases should arguably be accompanied by a callbackâ€”you want to handle, or at least be notified of, failures.

However, I think it's useful to make things super simple for someone just getting started with Nightmare and trying things. I also think simply loading a page and taking a screenshot or saving a PDF is a Big Deal of a use case (thatâ€™s all I was trying to do when I discovered Nightmare and wound up writing all the frame manager stuff).

I like allowing no callback to be passed to `run`â€”with one tweak: the default callback should probably `console.error()` when errors occur. Otherwise Iâ€™d agree with @rosshinkley. Bottom-line, either solution would be _much_ better than the current situation.
 > ...I have to begrudgingly agree. I am not sure I can articulate why I'd prefer input validation over this, but because that's almost precisely how .then() behaves, it's kind of hard to argue.

I think whether itâ€™s best to throw an error vs. just handle â€œbadâ€ input is pretty fuzzy, so I totally get you here.

One of my _very general_ rules of thumb is that itâ€™s good to throw an error when â€œbadâ€ input is meaningless (e.g. `sum(3)` makes no sense without a second argument) or is ambiguous in its intent. In the case of no callback for `run`, the intention is still clear and the behavior still has meaning and value.
 @h2non this patch would be awesome if you want to add some logging of errors to the default `fn` (unless you disagree with that notion). Thanks for writing it!
 I would prefer throwing the error if no callback function was provided, that's how all the bundled libs with Node.js works (e.g. `fs`)
 > that's how all the bundled libs with Node.js work (e.g. fs)

Maybe they used to and no longer do? Or I'm misunderstanding what you meant, @LinusU. I just tried the following in Node 4.4, 5.11, and 6.2; none of them threw an error:

``` js
fs.readFile('./README.md', 'utf8'); // where README.md is an actual file
fs.writeFile('./test-test.md', 'testing?');
```
 Sorry for being unclear, I'm referring to the asynchournous version when they are not being given a callback.

e.g.

``` js
const fs = require('fs')

fs.readFile('/i/do/not/exist', 'utf8')
```

running this file will throw an error.

Basically I mean making this the default callback:

``` js
function defaultCallback (err) {
  if (err) throw err
}
```
 > e.g. `fs.readFile('/i/do/not/exist', 'utf8')`

True enough! _But it does not throw because of the missing callback._ The error message refers to the non-existent file. If you run the same code with the path to an existing file, it does not throw.

While I think there are good arguments for throwing, I don't think â€œbuilt-ins do itâ€ is one of them. Some do (e.g. `fs.access`) and some donâ€™t (e.g. `fs.read/writeFile`). When it comes to Nodeâ€™s standard library, this behavior is inconsistent at best.
 Just to clarify one more time, if no callback is provided and everything goes well, I do not want any error thrown. When no callback is provided and something does go wrong, I want that error to be thrown.

I believe that this behaviour is what _all_ apis in Node.js does.

However, some apis throws an error directly when the function is being called without callback (e.g. `fs.access`). While I like that behaviour as well, that would be an backwards incompatible change (I think? maybe not).

I guess that there are four levels
1. When no callback is given, don't report any errors
2. When no callback is given, `console.error` if an error happens
3. When no callback is given, `throw` if an error happens
4. When no callback is given, `throw` immediately

What I was saying is that I would rather see 3 than 2 since that is what Node.js builtin api does.

As you correctly point out, Node.js builtin api is split between option 3 and 4. But none of them uses option 1 or 2, and for good reasons, and I don't think that we should either.
 Option 1. ðŸ˜± 

``` diff
 Nightmare.prototype.run = function(fn) {
+  if (typeof fn !== 'function') {
+    fn = function () {};
+  }
   debug('running')
   var ready = [this.ready.bind(this)];
   var steps = [ready].concat(this.queue());
   this.running = true;
```

Option 2. ðŸ˜¢ 

``` diff
 Nightmare.prototype.run = function(fn) {
+  if (typeof fn !== 'function') {
+    fn = function (err) { if (err) { console.error(err); } };
+  }
   debug('running')
   var ready = [this.ready.bind(this)];
   var steps = [ready].concat(this.queue());
   this.running = true;
```

Option 3. ðŸ‘ 

``` diff
 Nightmare.prototype.run = function(fn) {
+  if (typeof fn !== 'function') {
+    fn = function (err) { if (err) { throw err; } };
+  }
   debug('running')
   var ready = [this.ready.bind(this)];
   var steps = [ready].concat(this.queue());
   this.running = true;
```

Option 4. ðŸ‘Œ 

``` diff
 Nightmare.prototype.run = function(fn) {
+  if (typeof fn !== 'function') {
+    throw new TypeError('Expected callback to be a function')
+  }
   debug('running')
   var ready = [this.ready.bind(this)];
   var steps = [ready].concat(this.queue());
   this.running = true;
```
  I have code that looks for the `change` event on a text field.  In browsers, this is fired once the affected field loses focus (for example, when hitting the "submit" button).

Using the new `insert` method to clear out a field and then changing focus does not result in the `change` event being fired.

I seem to remember the previous implementation of `type` would work as expected, but now that `type` lacks the ability to clear text, that also doesn't work.

I can work around the problem for now by simulating clearing text using `evaluate` statements, but this is moving in the wrong direction, as I want things like the new `type` that behave more like we'd expect from a user typing things into a browser.

Happy to prepare a pull, but I can't figure out when to trigger the change without breaking the flow in the other direction (i.e. triggering the change too soon, when a real browser would wait until the loss of focus).

Any thoughts on addressing this? 
 I thought about this overnight, and did some tests.  I now have a workaround that I would like to propose as a solution.

If I pass the backspace key (`\b`) to `type`, it will erase one character of the existing text.  I would propose that when `type` receives a "falsy" value, it should look at the current value and type `\b` `value.length` times.

If this approach seems reasonable, I am happy to submit a pull request.
 Does PR #548 do what you want here? I submitted it because I was also trying to get 'change' events.
  First of all, thanks for the great library!

In order to take a whole page screenshot, I'm trying to set the viewport after evaluating `body`'s width and height. But, I'm not sure how to use the evaluated `width` and `height` when calling `.viewport()`:

``` js
Nightmare()
  .goto(url)
  .wait(selector)
  .evaluate(() => {
    const body = document.querySelector('body');

    return {
      height: body.scrollHeight,
      width: body.scrollWidth
    };
  })
  // How do I use the returned `width` and `height` to set viewport now?
```

I found [this example](https://github.com/segmentio/nightmare/issues/328#issuecomment-159311982), but it uses generators. I wonder if it's possible to achieve the same without generators?
 Yes.  As of v2.2.0, `.then()` returns a native `Promise`.  That original example from #328, rewritten without generators, using only promises:

``` javascript
var nightmare = Nightmare();
nightmare
  .goto(url)
  .wait(selector)
  .evaluate(() => {
    const body = document.querySelector('body');

    return {
      height: body.scrollHeight,
      width: body.scrollWidth
    };
  })
  .then(function(dimensions) {
    return nightmare
      .viewport(dimensions.width, dimensions.height)
      .wait(1000)
      .screenshot(require('path').join(__dirname, 'screenshot.png'))
  })
  .then(function() {
    nightmare.end(function() {
      console.log('done');
    });
  });
```

You could use your favorite native promise-supporting library to do flow control as well.
 @rosshinkley Thanks a lot for this! 
Just wondering, why `.wait(1000)` is required before taking the screenshot?
 No problem!

With respect to the call to `.wait()`, that is a _great_ question.  It has to do with allowing Electron's internal backing frame storage to catch up to the current rendering of the page.  If you don't allow this to take place, the image will be of the previous viewport dimensions distorted to the new dimensions.

You might want to take a look at #468 which outlines the issue and #479 which addresses the problem.
 @rosshinkley Ah! So, once #479 is merged, we'll no longer need the `.wait(1000)`?
 I'm going to dump this here due to no(obvious) better place (does nightmare have a irc/slack/gitter/etc?).

Using this method, the screenshot dimensions are exactly double the dimensions I set.  Am I missing something?
 @moroshko That's right.  Once #479 is fixed, no more "magic" wait calls.

@mousemke #272 was opened to petition for a gitter room, you might want to go give that some support. :)

Addressing your question: that's curious.  Is that the case for _any_ screenshot, or only screenshots taken with getting the body dimensions first?
 screen shots appear to always be double sized. in this case either 2048x1600 or double the supplied dimentions

``` javascript
/**
 * ## promiseScreenshot
 *
 * gets a screenshot of the supplied element
 *
 * @param {String} tag selector
 *
 * @return _Promise_ the nightmare must end eventually
 */
var promiseScreenshot = function( tag )
{
    return new Promise( function( resolve, reject )
    {
        var tagSafe = tag.split( ',' )[0];
        var nightmare = new Nightmare();

        nightmare.viewport( 1024, 768 )
            .goto( url )
            .wait()
            // i wont bother linking getBoundingRectangle, but it
            // just gets the dimentions
            .evaluate( getBoundingRectangle, tag )
            .then( rect =>
            {
                // console output to double check i'm getting the right values
                console.log( rect );
                if ( rect )
                {
                    var path = screenshotDir + '/' + tagSafe + '.png';

                    return nightmare.scrollTo( rect.y, rect.x )
                        // tested without the resize
                        .viewport( rect.width, rect.height )
                        .wait( 1000 )
                        // tested without the rect restraints.  
                        // it takes 2048x1600 screenshots
                        .screenshot( path, rect );
                }
            } )
            .then( () => resolve( nightmare.end() ) );
    } );
};
```
 btw: this was node version `5.0.0`.  I now updated to `5.7.0` and it has the same issue
 Hm, I still can't reproduce this behavior.

Even if you start a fresh project with a fresh install of Nightmare, doing a simple shot produces this result?  Something like:

``` js
var Nightmare= require('nightmare'),
  nightmare = Nightmare({show:true});

nightmare.goto('http://example.org')
  .viewport(150,150)
  .wait(1000)
  .screenshot('shot.png')
  .end()
  .then(function(){
    console.log('done');
  });
```
 Yes, but I've just learned to deal with it. Havn't looked into fixes in a while 
 @mousemke sorry if this is obvious and you already thought of it, but are you on a device with a retina or other high-res display, like a Chromebook pixel, Retina MacBook Pro, etc? Electron will definitely give you a screenshot with â€œdouble the pixelsâ€ (or something else if you have a more than 2x display). The viewport dimensions you set are in â€œeffective pixelsâ€ or â€œCSS pixels,â€ not device pixels.

Iâ€™m not sure thereâ€™s any way to explicitly change that, but writing a plugin will give you access to all the relevant modules in Electron: [`screen`](http://electron.atom.io/docs/v0.37.6/api/screen/) will tell you the scale factor for each display; [`WebFrame`](http://electron.atom.io/docs/v0.37.6/api/web-frame/) will let you do zooming, which you could use then use to counteract the scale factorâ€”set the viewport to half your desired size and zoom to 0.5 to get 1:1 pixels, for example.
 Able to reproduce on a high-dpi device: the screenshot is 2x the height/width set in nightmare. @Mr0grog's  reasoning about the source seems valid.
 The retina thing should probably go in the readme.  Just threw me when I tried it, and it totally makes sense! But should note that it ss's to dpi rather than strictly 1x1 pixels.
 @Mr0grog  I'm struggling on this one, how do you access WebFrame to do the zooming, from `evaluate()` ? I get a `webFrame is not defined`. Thx `WebFrame` and `screen` are Electron APIs, so you either need to get them by writing a plugin using [the `action` method](https://github.com/segmentio/nightmare#nightmareactionname-electronactionelectronnamespace-actionnamespace) or by using a [custom preload script](https://github.com/segmentio/nightmare#custom-preload-script).

If you just *always* want rendering at a particular resolution, you can also use the Chromium command line `force-device-scale-factor` switch. Hereâ€™s an example: https://github.com/segmentio/nightmare/blob/master/test/index.js#L1830 You can't change that after you start Nightmare, though. @Mr0grog `force-device-scale-factor` did the trick -- many thanks. Funny thing, my screenshots are now distorted too.
Capturing a simple screenshot worked. But capturing a rectangle produces a screenshot distorted vertically.

```
        var rect = yield nightmare
          .goto(url)
          .wait(screenshotSelector)
          .evaluate(function(selector) {
            var element = document.querySelector(selector)
            if (element) {
              var rect = element.getBoundingClientRect()
              return {
                x: Math.round(rect.left),
                y: Math.round(rect.top),
                width: Math.round(rect.width),
                height: Math.round(rect.height)
              }
            }
            return false
          }, screenshotSelector)

        if (rect !== false) {
          yield nightmare
            .screenshot(filename, rect)
        }
```
I'm not touching the viewport in this scenario. Should I make the viewport infinitely high?

UPDATE: yes apparently I do need to set the viewport to the whole `body` dimensions before capturing a specific DOM element. I take that back, I can't set the viewport to the the `body` dimensions, because it completely messes pages that use CSS `background-image` in cover mode.

Would you guys know why getBoundingClientRect would return "distorted" coordinates? Do I need to convert them to some physical pixel units through a multiplier? It doesn't look related to the device pixel ratio I'm on.  Enable support for IFrames, fixes #203

It creates two variables in the browser object `__nightmare`: `currentDocument` and `rootDocument`.

`rootDocument` is a reference to the main `document` used normally.

`currentDocument` starts as a reference to the main `document` but is updated to be a reference to the `document` of an iframe element by the action `Nightmare.prototype.enterIframe(selector)`.

The method `Nightmare.prototype.enterIframe(selector)` also works from inside iframes, so it allows traversing an arbitrary tree of iframes.

The method `Nightmare.prototype.exitIframe()` gets out of the iframes and comes back to the root `document` element.

An example would be:

```
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.goto('http://www.w3schools.com/tags/tryit.asp?filename=tryhtml_iframe').then();

nightmare.title().then(function(res){console.log(res)});

nightmare.enterIframe('#iframeResult').enterIframe('iframe');

nightmare.title().then(function(res){console.log(res)});

nightmare.exitIframe();

nightmare.title().then(function(res){console.log(res)});

nightmare.end();
```

It would print to the console:

```
Tryit Editor v2.6
W3Schools Online Web Tutorials
Tryit Editor v2.6
```

The two additional actions (`.enterIframe(selector)` and `exitIframe()`) are also documented in the `Readme.md`.

---

The way it works is by embedding the functions called with `.evaluate_now()` in a closure (to have an independent scope that allows overriding the `document` variable) giving them a `document` variable extracted from the `__nightmare.currentDocument` in the browser. That way, other actions (methods of `Nightmare.prototype`) don't have to be modified and user's code using `.evaluate()` would also work as expected.
 I see there are failing tests, I'm checking them (first setting up the environment to check them).
 - I fixed the errors
- refactored the creation of the variables to handle  `document` variables for iframe navigation (`__nightmare.currentDocument`)
- created fixtures for testing navigation with iframes
- created tests for navigation with iframes
 This would be super helpful for us since we use iframes in our widgets. :+1: 
 When will this be reviewed/merged?
 I'm nervous that this project hasn't seen a commit in almost a month.  Its like it just died off completely.
 Me too @erikdonohoo. I guess Segmentio folks are too busy to develop the project further, but they could al least merge PRs...
 In the meantime, maybe you could try it @erikdonohoo and @rclai to see if you find any bug or misbehavior... 

You could clone my fork, checkout to the branch with the fix and copy the code to your project's `node_modules` directory to test it... I guess if someone from the Segmentio team sees that others have tested this PR and agree that it's working it will be easier for them to merge it....
 It works great @tiangolo, thanks for this. I haven't seen any issues so far.
 > As I was working on [my issue](https://github.com/segmentio/nightmare/issues/536), I ran into this error:
> 
> ```
> Cannot read property 'contentDocument' of null
> ```
> 
> I'm thinking it's coming from [here](https://github.com/tiangolo/nightmare/blob/e1476d3f3f9dd41888f829818ca03ecf0bae933b/lib/actions.js#L293).
> 
> I got this error when I ran my Node script but using the Xvfb server instead of the `xvfb` NPM package.
> 
> ```
> # start xvfb server
> export DISPLAY=':99.0'
> Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
> # Finally run my node script
> node index.js
> ```

My mistake, nevermind that. The iframe wasn't there because I was already logged in.
 Actually perhaps a better error should be thrown indicating that the iframe does not exist?
 @rclai I'm glad it's working! And thanks for testing it :smile: 

---

For your issue / suggestion, I guess there are these approaches:
1. The user checks if the IFrame exists before entering in it, maybe using `.exists()`: https://github.com/segmentio/nightmare#existsselector
2. Nightmare checks if the IFrame exists before entering in it, and only proceeds if the IFrame exists.
3. Nightmare checks if the IFrame exists before entering in it and throws an error if it doesn't.

Nevertheless, I think none of the other methods check or throw any error, for example, if you run `nightmare.type('.weird .non .existent .selector', 'some text that never gets typed')` you don't receive any error either.

I think that options 1 or 2 would be the most similar to how the rest of the code works.

---

But now, I'm actually worried that no one from Segmentio has even entered the conversation, and it has been quite some time... :disappointed:  

...even though this seems a useful feature (at least for the three of us).
 Is it possible to turn it as a plugin? Or does it modify some internal stuff? 
 @rclai: It modifies internal stuff (quite "core" internal stuff).

It changes the preloaded JS sent to the browser.

I actually first tried creating a plug-in, but it wouldn't work without changing the core, or I would have had to override every method (and every future method) in Nightmare...

BTW, debugging tip (related to the internal stuff): It saves the root document object in `__nightmare.rootDocument` and the current IFrame's document object in `__nightmare.currentDocument`.

So, you can check in your Developer Tools (the console in your Nightmare Chromium window) if your `__nightmare.currentDocument` is pointing to the document that you expect to be in.
 Nice feature, works perfect 
 Great! Thanks @mbernabeu for testing it!
 merge this please, i really need the iframe support
 @rosshinkley, I tried that first but it's impossible as it modifies internal stuff. 

Check the full answer to that same question 4 comments above: https://github.com/segmentio/nightmare/pull/496#issuecomment-197568154
 Just my 2Â¢ as someone who is interested in this, but not currently hurting from a lack of it (i.e. please take this with a grain of salt):

Having this is super awesome (really!), BUT, reading the code, it seems like this will only really affect actions that use `evaluate` or `evaluate_now` under the hood. Even then, it only works for ones that confine themselves to `document`â€”so it wonâ€™t confine actions like `scrollTo` or `back` to the specified iframe because they use `window` (though that is an easy bug to fix here). `inject`, similarly, will have surprising results (in an iframe, the `document` jQuery is dealing with will be different from the `document` someone calling `evaluate` is dealing with).

It also might have surprising effects for someone using the `evaluate` action and touching the `window` object, using event constructors or other built-in functions, any globals, or, writing code that tests types (since code is running in the parent frame but meant to interact with content from the iframe, where constructor identities for things like `Array`, `Object`, etc. will be different).

And of course, does this work well with `type` and `insert`? (Thatâ€™s a legit question; Iâ€™m really not sure.) It certainly _wonâ€™t_ work with injecting CSS, `goto`, `size`, `userAgent`, `screenshot`, `html`, and `pdf`. Some of those are probably OK (I donâ€™t think anyone would expect `size` to just resize the iframe), but others are more questionable. What should happen when I do:

``` js
nightmare
  .goto('some_page_with_an_iframe')
  .enterIframe('#theframe')
    .inject('some_file.css')
    .inject('some_file.js')
    .html()
```

â€¦and so on? If the current behavior above with this PR is OK, the fact that some actions will behave a little oddly should definitely be made clear in documentation.

Bottom-line, though, it seems to me that there are a lot of caveats to this that havenâ€™t been talked through here.
 @rosshinkley, I tried at first all the ideas I had to make it a plug-in, but I had to throw all that code away and start from scratch because I found that I had to modify deeper functionality in Nightmare.

If you find a way to get that same behavior with a plug-in I would love to know how.

@Mr0grog that's a good point, not **every** action would work. I think the first approach would be to document which actions wouldn't work.

But at least for some cases, the actions that work seem to be quite useful for some of us.

I'm sure it works with `.type` (that's what I made it for).
I'm pretty sure it would also work for `.insert`, as the code is almost the same and also depends on `document`: https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L175

Could you list all the _caveats_ that you find that _havenâ€™t been talked through here_? How would you like to assess better those caveats so that we all know what would have to be done?
 > Could you list all the caveats that you find that havenâ€™t been talked through here?
- Globals variables (both built-ins and ones from scripts in the page in the frame). I think this is, far and away, the biggest thing. If people are expecting `evaluate` to execute code in the iframe, which is exactly the expectation this sets up, they would very reasonably expect to be able to access all the globals in that frame. Theyâ€™d also expect to be able to be able to do things like compare constructors (e.g. `someFunctionInFrameThatReturnsArray().constructor !== Array`). There are an infinitely ridiculous number of use cases and ways people could trip over this.
- I think thereâ€™s a reasonable argument that it should probably work with `inject`. There are several issues related to users `inject`-ing jQuery (or a helper library of their choice) so they can use it when calling `evaluate`, so we know itâ€™s something people are doing. On a cursory reading, it looks like it should _sort of_ work with JS (caveat the global issues above), but wonâ€™t work with CSS.
- Obviously, a discussion of all the Nightmare methods that are/arenâ€™t affected. @rosshinkley listed a few. If youâ€™re going to address possible caveats, you should list them all out. Ross also noted â€œthere might be other issues with some of the more advanced functions (authentication, for example), but I haven't had a chance to set up testing yet.â€ No offense to anyone here, butâ€¦ testing and validating that shouldnâ€™t be on Ross. There are _a lot_ of issues and PRs here that need attention and Ross appears to be the only active maintainer.
- I think the issue of security is kind of a big deal here. The patch adds documentation that suggests setting `{'webPreferences': {'webSecurity': false}}` without really discussing that someone should at least think twice before doing that. There are a few issues that demonstrate people are using Nightmare to do tasks in very security-sensitive settings (e.g. #545); setting `websecurity: false` while doing something like that is a Really Bad Ideaâ„¢. It may even be worth fixing https://github.com/electron/electron/issues/5115 upstream first to alleviate this.

Not a caveat, but probably also a good idea to have tests that cover all the other methods that are affected by this. e.g. `can type into elements in iframe`.

Other minor nit: maybe worth renaming to `enterFrame` since this is just as applicable to other kinds of frames? (`<frame>`, `<iframe>`, `<object>`)

And an open question, because thereâ€™s been no discussion of it here and I think itâ€™s important for any new API being added to core: is this the best API for working with subframes?
- The original issue (#203) had an API using functions that could have eliminated the need for a second method call to â€œexitâ€ the frame.
- If this is going into core, would it better to change the methods that take selectors to allow special selectors that reach into frames? e.g. `.click('.some > iframe / #a .button-in-the-frame')`
 Thank you @rosshinkley and @Mr0grog for paying attention to this.

I see that there are several issues that would be hard to deal with in trying to integrate this into Nightmare. And probably the way to go would be a new module as the one @rosshinkley built that patches `evaluate_now`.

Nevertheless, I'm being unable to use @rosshinkley's https://github.com/rosshinkley/nightmare-iframe-manager, its code never gets executed in the current environment. Maybe I'm doing something wrong, but I cloned the repo and tried to run the tests (after installing a couple undeclared packages) but they all seem to fail. Again, I'm probably doing something wrong, but maybe you can guide me on how we should use your package / module to get this feature.
 OK, get it @rosshinkley. 

Are you planning on uploading it later to NPM? Do you want to keep it just as a proof of concept or do you want to keep developing it?
Or do you want me to fork it, try to fix my issues and then upload to NPM?
 For the other Nightmare users in this thread that wanted this functionality (with all the risky security concerns already mentioned), using @rosshinkley's plug-in is working now. 

His plug-in is based on this PR and even improves the functionality.

Check his documentation at: https://github.com/rosshinkley/nightmare-iframe-manager

(Make sure to update your code as the names and meaning of the methods changed a little bit).

As there isn't an NPM package, to install it in your projects you need to run:

```
npm install --save rosshinkley/nightmare-iframe-manager
```

NPM will understand that it needs to go for the GitHub repo (but you will need to have git installed).

---

@rosshinkley and @Mr0grog, with that plug-in I have the functionality I (and I think most of us in this thread) wanted (with all the risks / security up to us). For me it's OK if you just reject and close this PR now. Thanks!
  I added the [`webRequest` API](https://github.com/atom/electron/blob/master/docs/api/session.md#seswebrequest) feature which is related to #461.

Please consider the way of working except name of api.

Still, I prefer to make this as a plugin like the way of @rosshinkley [made](https://github.com/rosshinkley/nightmare-load-filter).
 Use [nightmare-webrequest-addon](https://github.com/kyungw00k/nightmare-webrequest-addon)
 hi, how can i use nightmare-webrequest-addon?
 @skysilence See https://github.com/kyungw00k/nightmare-webrequest-addon/blob/master/README.md first
  Originally found as a byproduct of #465, also noted over in the discussion on #491.

If two queues on the same Nightmare instance are operating simultaneously and both call the same action (e.g. `evaluate()`), it is possible for one call to pick up the results from the first call and finish early, continuing its cue with the wrong data.

Here's an example from #465:

``` js
var Nightmare = require('nightmare');
var page = Nightmare({show:true}).goto('http://yahoo.com');

page
  .wait(function() {
    return false;
  })
  .run(function(error, result) {
    if (error) { console.log("Error waiting for nothing:", error); }
    else { console.log("Inifnite wait finished, but shouldn't have! (uhoh)"); }
  });

page
  .wait(function() {
    return document.querySelector(".darla").firstChild.nodeName === "IFRAME";
  })
  .run(function(error, result) {
    if (error) { console.log("Error waiting for ad to load:", error); }
    else { console.log("First ad is loaded"); }
  });

// Prints:
// First ad is loaded
// Inifnite wait finished, but shouldn't have! (uhoh)
```

Or with typing:

``` js
var Nightmare = require('nightmare');
var page = Nightmare({show:true}).goto('http://yahoo.com').run(function() {
  page
    .type('#uh-search-box', 'github nightmare')
    .evaluate(function() {
      return document.querySelector('#uh-search-box').value;
    })
    .run(function(error, result) {
      if (error) { console.log("Error typing:", error); }
      else { console.log("Typed 'github nightmare'? " + result); }
    });

  page
    .type('#uh-search-box', 'ok')
    .evaluate(function() {
      return document.querySelector('#uh-search-box').value;
    })
    .run(function(error, result) {
      if (error) { console.log("Error typing:", error); }
      else { console.log("Typed 'ok'? " + result); }
    });
});

// Prints:
// Typed 'github nightmare'? goikt
// Typed 'ok'? goikt
```

Obviously there are more complicated questions with that one, but the salient bit here is that the queue typing "github nightmare" returned early. You can watch the window and see that it is still typing after the results are printed to the console.

You can do this with `goto()`, too, but that one's also somewhat complicated by the fact that `goto()` actually doesn't know how to fail (which is a different issue altogether). But it would fail to fail (ha!) if navigation were pre-empted by a second, simultaneous `goto()` call.

Obviously this is a little edge-case-y, but I suspect users will hit things like this more now that the "official" way to use Nightmare is via the `then()` API instead of with generators (where you have to go out of your way to trigger simultaneous actions).

There are a few potential ways I can think of to fix this.
1. Every cross-process call gets a unique ID. Replies would include that ID so the right listener handles it. (This could all be wrapped in up in a nice callback or promise based API, of course)
2. Ensure that multiple actions cannot be executed at once (two queues could be interleaved, but while queue A is executing an action, queue B would have to wait until that action is finished to execute its next action). This probably requires much more overhead to manage, but would fix issues like interleaved characters from two calls to `type()`. On the other hand, you might want most actions to be able to be simultaneous and `type()` might just be a little special.
3. Eliminate the possibility for multiple queues on a single nightmare instance altogether. Actions queued after a `run()` call would queue after `run`'s callback (or possibly immediately before the callback, but after the actions it was running).
4. Something else? Those three are all I've got.
 It might also be worth noting that, while this is generally an edge-case, deep extensions of the sort that #425 aims to enable might be more prone to triggering these sorts of issues if they are slow and highly asynchronous.
 Some notes about thoughts Iâ€™ve had since I first posted this issue (or, an expansion of stuff from #561):

I think (1) or some flavor of it is essential. No matter what, itâ€™s likely that some actions will have to do call multiple operations in the Electron process and those operations could collide. Even if everything in Nightmareâ€™s core is extra careful, plugins could easy trip over things.

Given how often people run into problems with loops (#533, #526, #522 to name just a few recent ones) and how complex [explaining the problem and various solutions](https://github.com/rosshinkley/nightmare-examples/blob/master/docs/common-pitfalls/async-operations-loops.md) is, I think (3) above or a variation on it is also a good idea. If all actions go onto a single, long-lived queue, even after the queue starts executing, that will completely eliminate looping issues.

As much as I like the idea of the power-user capability of being able to do multiple operations at once in the same window, Iâ€™m not sure there are a lot of concrete, real-world use cases for it. If there are good use-cases, I think they are sufficiently uncommon as to justify requiring a bit more work to enable them. Maybe an API like `nightmareInstance.getQueue()` would give you a new queue that you can add operations to (e.g. `nightmareInstance.getQueue().click('#something').title().then(...)`) and executes simultaneously with the â€œdefaultâ€ queue.
 Since we are in agreement that (1) should happen and since it resolves the critical _safety_ issue, some notes on that first:

High-level goals:
1. Prevent two simultaneously performed actions from being able to mix up their results/errors
2. Be really easy to use (ideally, easier than the current method)
3. Support progress/streaming results? I think this would be neat, but I donâ€™t think any existing Nightmare actions have need of it. Not sure how much of a priority to make it, but I suspect it would at least be wise not to implement a design that closes the door on it.

Proposed API:

``` js
// user process
this.child.send('command-name', arg1, arg2, ..., function(error, result) {
  // handle results
});

// electron process
parent.on('command-name', function(arg1, arg2, ..., done) {
  // do some stuff
  done(error, result);
});
```

This uses callbacks in order to be consistent and composable with Nightmareâ€™s action API. That way, you can just pass the callbacks along:

``` js
actions.useragent = function(useragent, done) {
  debug('.useragent() to ' + useragent);
  this.child.send('useragent', done);
};
```

(If we wanted to change Nightmareâ€™s API for actions to be promise-based, then Iâ€™d say this new API should be promises, too, but I donâ€™t think anybody is pushing to do that).

On handling progress data, `this.child.send()` could be an event emitter (or a stream?) that emits anything the handler of `parent.on('command')` `emit`s to its `done` argument. All events emitted there will only be received on the emitter created by calling `this.child.send()`:

``` js
// user process
this.child.send('command-name', arg1, arg2, ..., function(error, result) {
    // handle results
  })
  .on('data', function() {
    // do something on progress
  });

// electron process
parent.on('command-name', function(arg1, arg2, ..., done) {
  done.emit('data', 'step 1');
  done.emit('data', 'step 2');
  ...
  done(error, result);
});
```

Internally, every call to `this.child.send()` would generate a unique ID (this could just be a incrementing an integer) and send a message named `'command'` over IPC with the arguments: `'command-name', id, [command arguments]`. Using the string `'command'` as the event name allows us to safely differentiate between internal management commands and calls to actions.

On the electron side, a handler for `'command'` events is responsible for creating a callback that will send a message back over IPC named `'command-result'` with the arguments `id, error, result`.

Will post on queueing stuff in a bit.
 Heeeeeeere we go...

> I'm guessing you'd expect the first three actions to execute prior to the actions in .then(), right?

Yes.

> Are you envisioning .then() being an action that acts like Underscore's/Lodash's .tap(), or would there be a differentiation between the queue being executed and the queue that is accruing tasks?

Iâ€™m struggling to follow with what youâ€™re getting at here and I may be about to go way off the rails (sorry if so). Slightly reconfigured:

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2();
  });

nightmare
  .action3()
  .then(function then2 (results) {...});
```

Are you asking whether `action3` or `action2` runs first? i.e. whether `then()` would be like pushing its onResolved handler onto the queue as an action, needing to complete before the next action (`action3`) runs? That is, is the resulting queue:

``` js
Time
 â†“    action1
 â†“    then1
 â†“      â””â”€ action2
 â†“    action3
 â†“    then2

// or

 â†“    action1
 â†“       â”œâ”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
 â†“    action3                then1
 â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
 â†“    action2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    then2
```

At the very least, **if `then1` is expected to run before `action3`** (as opposed to simultaneously or after), I think that would mean `action2` would have to run before `action3`, so it matches the basic behavior of promises. That is, if a promiseâ€™s onResolved/onRejected handlers return a then-able, they should not â€œcompleteâ€ until the then-able they returned does. So the `then1` action wouldnâ€™t complete (enabling the queue to move on to `action3`) until the promise for the result of `action2` completes.

That is to say, I do not think this would be acceptable because it either violates the expectation of promises/then or puts you in a deadlock (can't continue to action3 until action2 is done but action2 can't be performed until after action3):

```
Time
 â†“    action1
 â†“    then1 â”€â”€ (queues) â”€â”
 â†“    action3            â”‚
 â†“    then2              â”‚
 â†“    action2 â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

(Except the above _is_ what would theoretically happen if `then1` didnâ€™t _return_ the nightmare instance (no more deadlock concern). But, mechanistically, it would be complicated to differentiate between the two. Hmmm.) Not to mention the question of what happens here:

``` js
nightmare
  .action1()
  .then(function then1 (results){
    return nightmare.action2();
  })
  .then(function then2 (results) {
    return nightmare.action4();
  });

nightmare
  .action3()
  .then(function then3 (results) {...});
```

So. I think I would go with the second flow of events above (with the very complicated chart) because the implementation seems very straightforward. Except. Complicated flow. :(

But then I want to imagine a magical land of fairies and unicorns where this works:

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2();
  })
  .action3()
  .then(function then2 (results) {...});
```

Which begs the question: is that different than the above code snippet? Reading it naively, it would definitely imply behavior like the first timing diagram above. You would really expect `then1` to participate in the queue of actions and come before `action3`. Maybe it is:

``` js
 â†“    action1
 â†“       â””â”€â”€ (schedules) â”€â”€â”
 â†“                       then1
 â†“    action2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â†“       â””â”€â”€ (schedules) â”€â”€â”€â”€â”€â”€â”€â”€â”
 â†“                         (implicit then)
 â†“    action3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â†“       â””â”€â”€ (schedules) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â†“                                   then2
```

I think (if Iâ€™m thinking right, but Iâ€™m getting a headache now) that emulates the behavior of the first timing chart but under the implementation that matches the second (very complicated timing chart). Or, under the first technical approach, the two code snippets function the same, while they function differently under the second.

How is that _really_ different? Well... (deep breath)

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2(); // implicit then caused by return
  })
  .action3()
  .then(function then2 (results) {...});

nightmare
  .action4()
  .then(function then3 () {...});
```

Would be:

```
â†“    action1
â†“       â”œâ”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
â†“    action4                then1
â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
â†“    action2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    then3
â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â†“                                    (implicit then)
â†“    action3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â†“                                                then2
```

And this is starting to get crazy enough that Iâ€™m almost beginning to regret coming down this path. Sigh.

Or were you getting at what happens here?

``` js
nightmare
  .action1()
  .then(function then1 (results){
     return nightmare.action2();
  });

nightmare
  .action3()
  .action4()
  .then(function then2 (results) {...});
```

Being one of:

```
Time
 â†“    action1
 â†“    then1
 â†“      â””â”€ action2
 â†“    action3
 â†“    action4
 â†“    then2

// or (actions invoked in `then` run ASAP but canâ€™t interrupt another action)

 â†“    action1
 â†“       â”œâ”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
 â†“    action3 â”€â”€â”€â”€â”          then1
 â†“    action2 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â†“    action4 â”€â”€â”€â”€â”˜
 â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
 â†“                           then2

// or

 â†“    action1
 â†“       â”œâ”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”
 â†“    action3                then1
 â†“    action4                  â”‚
 â†“       â””â”€â”€â”€â”€ (schedules) â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
 â†“    action2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    then2
```

And Iâ€™m pretty sure Iâ€™ve gotten myself lost. Fresh eyes in the morning. Not going to get to explicit parallelism yet.
 > There are a few (many?) devils in the details, but I don't think they're worth touching until development is underway.

BOOM: #579. Now weâ€™ve got a separate place to discuss that one.
 After reading everything you said i still dont understand why i can't run multiple instance of new Nightmare() on the same machine.
If i launch the same script  5 or 6 times at the same time then some of them are going to hang (nothing happen or stay on `nightmare:log altering page to force rendering`) or crash (`nightmare:log crashed [{},false]`)
Do you have some idea to help me debug that ? Thanks ! @GautierT I think you might be a bit mixed up hereâ€”nothing on this issue is about problems running multiple instances of Nightmare at once (in fact doing so *solves* the issues here; this is about doing multiple sets of actions with *one* Nightmare instance).

Your problem sounds a lot like #612. One thing you might want to try is using random partition names or memory partitions, like so:

```js
var nightmare = Nightmare({
  // Make sure that, not only are we using a memory partition, but that
  // it is probably a different one than any we've used before.
  webPreferences: {partition: 'custom-partition' + Math.random()}
});
```

If that doesnâ€™t help, you might want to make a separate issue, since your problem is definitely off-topic for this thread. @Mr0grog : Ok. Sorry for the miss understanding.. !
My current partition setting is 
`webPreferences: {
       partition: 'nopersist'
 },
`
and i haven't set `session`.
I will try with a random partition number ! @GautierT No worries! I hope you get it figured out.  Fixes #490, addresses @Mr0grog's comments from #482.  Also removes `vo` from the CNN example based on [@matthewmueller's comment](https://github.com/segmentio/nightmare/pull/482#issuecomment-184525044).

That being said: why the move to excise `vo`?  Is it to remove the external dependency?  I still think showing an example of using `vo` or `co` with `yield` is helpful.  Thoughts?
 Thanks! Wasn't sure if any maintainers (is that just @matthewmueller?) were going to do anything about that since nobody replied on that thread.

My 2Â¢: I think it's good to have the main examples rely on as few third-party libraries (like vo) as possibleâ€”there's a surpising amount of friction added to getting started when you have to learn a second tool in order to learn the once you want to use. (Of course I'm biased: I'm not really using vo in my own work w/ Nightmare.)

That said, libraries like vo are great tools that make the async nature of this stuff a little easier in some cases. Those who don't know about them might never find out if not for the examples. I think it would be great to have a section that talks about how Nightmare pairs well with and gives examples of:
- ES-next `async/await` (maybe with a note about how to set it up with Babel?)
- Tools for generators: vo, co, Bluebird's `Promise.coroutine()`, etc.
- Mocha-generators, Jasmine-co, etc. (for testing)
 @Mr0grog no problem.  I apologize if I zapped any of your efforts, but I saw #490 this morning and figured that since I was in there, I may as well patch up the other stuff you pointed out.

As for not including external libraries: I agree.  Adding additional dependencies with their own quirks and learning curve only serves to make the learning process more difficult.  I use `vo` when it's convenient, but I guess the main takeaway here is that you don't _have_ to use any outside libraries to use Nightmare.  Recommending using `.then()`, though?  Always?  That makes me ... uncomfortable.  It's hard for me to articulate why outside of aesthetic reasons.  Right tool for the job, I suppose.

Which brings me to your next point: I think adding examples for common usecases and popular libraries would be wildly helpful - something along the lines of Including an examples directory with documentation for each example.
 By the by, #472 is a _great_ case study for the need of detailing usage with different approaches.
 @rosshinkley Oh, no, you didn't zap any of my efforts at all; no worries! I held off on making any changes in that area since it sounded like @matthewmueller was making a bunch ideological changes that aren't written down anywhere, so I figured I'd wait to hear back or see what he did before _I_ tried to actually do anything more.

> Recommending using .then(), though? Always? That makes me ... uncomfortable. It's hard for me to articulate why outside of aesthetic reasons.

Wellâ€¦ we could focus on `run` or `end` instead. Then you have the "callback API" and the "promise API." To be honest, though, I'm not sure I have the same aesthetic concerns with `then`â€”I kind of like it ;)

The biggest thing I'm concerned with about moving away from generator-based examples is that several things are buggy in Nightmare if you ask it to handle multiple queues at onceâ€”and that's easy/inviting to do if you focus on the run/end/then API. See, for example, #465. On the other hand, I'd bet those issues exist because early authors focused on using generators and so rarely tripped over bugs that happen when multiple operations are going on simultaneously. But all that is a big discussion that is somewhat separate from how things are documented! So I'll shut up on that for now.

> I think adding examples for common usecases and popular libraries would be wildly helpful - something along the lines of Including an examples directory with documentation for each example.

Ooh, definitely! I think the documentation, in general, could be vastly improved. Several of the issues and questions in #472 are ones I ran into when I first started looking at Nightmare, too (I also think it would be great if all methods returned a promise or thunkâ€”there's no reason a nightmare instance can't actually be one of those things, but that's _way_ out of scope here).

_[Rant warning:]_ Anyway, I'd _would_ love to volunteer to help with that, butâ€¦ I'm personally a bit wary of diving into major changes to docs (or other changes of similar scope). There's no documentation here relating to direction or process for the project. I'm not sure whether there are people at Segment (or outside it) who are acting as maintainers other than @matthewmueller. And when he makes a sudden change in project direction and only announces that change in a comment on a random issue/PR, as happened in #482, or makes surprising API changes with nary a PR or even a comment in an issue (like making `then` act more like a promise after much discussion against or not very in favor of it in #256), or even when issues and PRs can sit for months (e.g. #222) with no maintainer feedback at all (even just a "no thanks"), I don't have much confidence that big contributions will be well respected.

That's especially true for docs. It's hard to do a good job with them when you don't know what direction the project is headed. What parts should be focused on? What things should be downplayed because owners/contributors don't feel great about them? What's deprecated and going away? What are the known gotchas? And so on. #482, again, is a great example here: in previous issues, @matthewmueller talks about `then()` as a private API, only there to make vo behave properly. Now, with no other discussion in between, it's suddenly the primary front-and-center way to use Nightmare.

Anyway, I know you weren't necessarily asking for my help and sorry for the sudden rant there. I hate to heap on a lot of criticism when I've only been observing the goings-on here for a couple weeks. I hope there's not a mailing list or something I'm totally missing out on. It felt like it needed to be said somewhere, though.
 (And to be clear, none of that is to say that Nightmare is a bad or project or that anybody is doing bad workâ€”merely that it's not super friendly to big outside contributions.)
 I realize that this PR is closed, but I feel compelled (and somewhat responsible) to respond to the commentary.  I'm going to _try_ to respond to both of your comments.  (This is going to be a bit of a missive; strap in for a long read.)

> Oh, no, you didn't zap any of my efforts at all; no worries!

I'm relieved. :)  Duplicate work is the worst kind of work.

> Wellâ€¦ we could focus on run or end instead. Then you have the "callback API" and the "promise API." To be honest, though, I'm not sure I have the same aesthetic concerns with thenâ€”I kind of like it ;)

I guess getting back to a point @Mr0grog made: I am biased for using `yield`.  No real reason other than "it looks nice" and it has fit in well with what I've done with Nightmare.  And it's not like I'm _losing_ that ability, but I do think it's worth providing a usage sample.

> The biggest thing I'm concerned with about moving away from generator-based examples is that several things are buggy in Nightmare if you ask it to handle multiple queues at onceâ€”and that's easy/inviting to do if you focus on the run/end/then API. 

This may be - is? - getting a bit off topic, but while running parallel operations on a single page should Just Work&trade;, running parallel operations across multiple domains with a single Nightmare instance won't work.  It can't work.  At least not in the current incarnation.

That said, I am very interested in the outcome of #465.  I suspect there's other issues in the guts of Nightmare to getting single-page parallel operations to work.  I haven't carved out time to really get into it, though.

While I'm on this tangent, documenting single-domain (well, single URI anyway) parallel operations would be kind of tricky.  They would have to state outright that you cannot perform actions across domains at the same time.  However...

>  But all that is a big discussion that is somewhat separate from how things are documented! So I'll shut up on that for now.

Yeah, I should too.  I propose we move that conversation over to #465.  Hopefully I'll have something constructive to add there soon. :)

> Ooh, definitely! I think the documentation, in general, could be vastly improved.  Several of the issues and questions in #472 are ones I ran into when I first started looking at Nightmare, too 

Same.  I'm not above sandboxing for a bit, and that sort of work doesn't frustrate me.   I can totally understand and relate to where it would be frustrating, especially to someone not terribly familiar with javascript.  Example usage - at least, non-issue, non-test case example usage - to flog this horse I'm pretty sure is already dead, would be great.

> (I also think it would be great if all methods returned a promise or thunkâ€”there's no reason a nightmare instance can't actually be one of those things, but that's way out of scope here).

As you pointed out, this is also kind of out in the weeds, but I just wanted to quickly point out that all of the methods _do_ return a thennable as Nightmare itself (partially) implements promises.  Having Nightmare directly inherit from `Promise` opens a bit of a can of worms.  (I touched on this briefly in #472.)

> [Rant warning:] 

Off topic, but I have to admit, that 1) this gave me a chuckle and 2) thank you.  I'm going to skip around a bit now, as I think the bulk of the "rant" should be addressed with @matthewmueller's comment.

> #482, again, is a great example here: in previous issues, @matthewmueller talks about then() as a private API, only there to make vo behave properly. Now, with no other discussion in between, it's suddenly the primary front-and-center way to use Nightmare.

This was what I was getting at with my original question about excising `vo`.  I had seen commentary for both ways and wanted clarification - and perhaps more importantly, justification - written down somewhere for posterity.  I am _certain_ it's going to come up in questions again and I wanted to have a reference to point at.  (The poor, poor souls that get this PR as a reference in the future.  Apologies to future readers everywhere.)

To be honest, even with my self-reported biases, I don't really care what the suggested usage is.  It needs to be documented, and big shifts in usage need to be justified.

Moving on...

> thanks @rosshinkley for the fixes â€“ though i'm a bit surprised about the id change since I tested this two days ago. I wonder if yahoo is doing something weird with rendering.

No problem.  I feel like Yahoo has changed IDs of either the search bar or button or both in the past.  I have this nagging memory of seeing this issue before, but a cursory glance through the issues yielded nothing.  On a related note, I suspect it's not the last time it'll happen.

> I should have mentioned something, but to be honest I'm not sure it broke anyone's code.  The goal of this change was to make it more familiar to newcomers and remove the additional dependency that was confusing in the first place.

I also doubt it broke much, if anything.  It _does_ make usage a bit strange, though.  Calling `.end()` before `.then()` looks kind of odd to me.  It's also worth pointing out that adding something akin to [Underscore's `tap`](http://underscorejs.org/#tap) method so you can interact with values from functions like `.evaluate()` before `.then()` might be handy.  Food for thought, and I'd be willing to work on that if it's something worth including.

Also, thank you for the clarification on the removal.

> @Mr0grog 
> 
> > ... or makes surprising API changes with nary a PR or even a comment in an issue (like making then act more like a promise after much discussion against or not very in favor of it in #256), or even when issues and PRs can sit for months (e.g. #222) with no maintainer feedback at all (even just a "no thanks"), I don't have much confidence that big contributions will be well respected.
> 
> @matthewmueller
> 
> > If you go back in the merged PRs, there are some really big PRs that have been merged. It does take time to go through some of the bigger ones though since a lot of people depend on this library and I have other commitments outside of working on Nightmare.

Not having the change documented via a PR is a bit frustrating, if for no other reason that there's no real trail to hold up as when and why the change was made.  With respect to the PRs, I understand the bigger ones take time to review.  Especially ones that change the shape and surface of Nightmare, like #425 (not to toot my own horn).  I also understand that Nightmare competes for attention and priority.  Commentary or updates on PRs are nice to have, and help encourage contribution.

> @Mr0grog 
> 
> > That's [being contribution consideration] especially true for docs. It's hard to do a good job with them when you don't know what direction the project is headed. What parts should be focused on? What things should be downplayed because owners/contributors don't feel great about them? What's deprecated and going away? What are the known gotchas? And so on.
> 
> @matthewmueller 
> 
> > The next two things on my TODO list for nightmare is to get @rosshinkley's #425 merged and create better documentation (a quick how-to video) on how to run Docker on linux.

Thank you for the todo list, and I'm thrilled that #425 is on deck.

Based on my observations in this project, the direction (at least since moving off of Phantom and onto Electron) has been ad hoc.  Folks wanting certain functionality ask for it, and in general, that piece is discussed and added or fixed in isolation.

With that in mind, I don't know that a more comprehensive project map is possible.  Again, most of the changes I've seen have been an outgrowth of issues or desired behavior, and that kind of thing is tough to predict.  And if I'm being totally honest, I'm not sure the onus is on the ownership to suss that out.  Iterating based on feedback makes for a better project, in my humble opinion, and has the added benefit of being relatively easy.

And with _that_ in mind, this gets back to a motif:  Documentation.  I very (emphasis on very) strongly agree that deprecation and gotchas should be documented.  I also think - and I know I've made this clear already - that changes should be documented.  While I'm repeating myself, I'll mention again that documenting common use cases with popular libraries should also probably be included.

What would be nice - and I think might go a long way to addressing @Mr0grog's list - would be guidelines for requesting functionality, guidelines for submitting issues, and guidelines for submitting PRs.  Perhaps even some general notes on what to expect with those items.  #425 magnifies the above problems, adding the question of what belongs in the core of Nightmare vs. what should be a plugin.  Thoughts?

---

Finally, thank you both for the commentary and criticism.  I think this discussion is an important one and needed to be had.
 Technical notes first, feelingsy stuff about how stuff gets done second:

> while running parallel operations on a single page should Just Workâ„¢, running parallel operations across multiple domains with a single Nightmare instance won't work.

Exactly! The issues at the end of #465 are all on the same page and should just work, but donâ€™t. The major underlying issue is that communication between Nightmareâ€™s process and the Electron process (and similarly between the Electron browser and renderer processes) doesnâ€™t differentiate between which actual call to do  a given operation they are responding to. Thatâ€™s not a problem until there are two simultaneous calls to do the same kind of operation (in #465, that was `evaluate`, but really it could be any operation). Iâ€™m actually going to go make an issue for that now (I think itâ€™s separate from the actual thing #465 was trying to fix).

(Another note for better docs: it would be good to clarify that you need multiple nightmare instances to work on multiple pages at the same time.)

> Having Nightmare directly inherit from Promise opens a bit of a can of worms. (I touched on this briefly in #472.)

Yep! I think it would require a lot of discussion. There are multiple ways to skin that cat (and, as you say, reasons to not to skin it at all). I havenâ€™t written an issue or PR yet because I havenâ€™t taken the time to really think through and articulate it well.

---

Project process stuffs:

> 1. I apologize about the API change

Oh, you don't need to apologize for the change! It's a good change, too (in my opinion, at least).

> I should have mentioned something, but to be honest I'm not sure it broke anyone's code.

Given the way `then` previously worked (clearing the queue), that's probably trueâ€”you'd likely get more confusion than utility out of chaining off of `then`. But it is much easier to be confident in that assertion if you let people know about the change in advance and give them at least a few days for feedback. It may or may not break users' code, but it _is_ a breaking change and certainly has the potential to do so. As you said, â€œa lot of people depend on this library,â€ which I think only makes this sort of thing a bigger deal.

Maybe @rosshinkley put this better than me above:

> I had seen commentary for both ways and wanted clarification - and perhaps more importantly, justification - written down somewhere for posterity. I am certain it's going to come up in questions again and I wanted to have a reference to point at. (The poor, poor souls that get this PR as a reference in the future. Apologies to future readers everywhere.)

Again, I think the change itself is great! I hear and agree with your reasoning for it 100%. It's the _manner in which the change was made_ that I'm concerned about.

> there are some really big PRs that have been merged

Definitely! Being accepting and being _welcoming_ (maybe â€œinvitingâ€ or â€œsupportiveâ€ would be a better terms for what Iâ€™m trying to get at here) are different things though. My point is that I think big and good contributions have been made in spite of an environment that might not be as supportive of them as it could be.

I do want to clarify, too, that I used the word â€œmajorâ€ rather than â€œbigâ€ because Iâ€™m talking about changes that are highly impactful to how someone uses Nightmare. Mainly, that means things like breaking API changes and adding or removing new classes of behavior. Your change to `then` is a good exampleâ€”itâ€™s small in terms of lines of code, but potentially major in impact. #479 might be a good counter-example if itâ€™s accepted. Itâ€™s big-ish in terms of lines of code (at least relative to most PRs here), but relatively isolated and not particularly impactful to how Nightmare works. Users wonâ€™t see it as anything but a slight improvement. (Note that that _doesnâ€™t_ mean it wonâ€™t require careful review. Itâ€™s still a lot of code.)

> It does take time to go through some of the bigger ones

And it should! This stuff should be (and is, I think) reviewed with a careful eye. I am nothing but :thumbsup: :thumbsup: :thumbsup: on that font. I should say that my personal experience hasnâ€™t been one where I think anything has taken too long. Itâ€™s only other issues and PRs that I see sitting for a while.

OSS projects are, by nature, done in most peopleâ€™s off-hours, so taking a few days to reply doesnâ€™t seem bad to me. Even if it takes longer than a few days to come up with substantive feedback, thatâ€™s fine. But in my experience, it _really helps_ people feel better about whatâ€™s going on if, after a few days, a maintainer at least says â€œhey, thanks for issue/PR/whatever; weâ€™re super busy right now, but I should be able to take a closer look in a few days/a week/whenever.â€

> The next two things on my TODO listâ€¦

Thanks for the info! But this is more-or-less exactly what Iâ€™m talking about. Now _I_ know whatâ€™s on the docket, but this info is still buried away at the bottom of a closed PR. Who is going to see that besides you, me, and @rosshinkley?

> the directionâ€¦ has been ad hocâ€¦ with that in mind, I don't know that a more comprehensive project map is possible.

Ah, good to know! I havenâ€™t been here long enough to get a sense for whether things are mostly just ad-hoc or whether there is a tacit roadmap that only exists in a few peopleâ€™s heads. @rosshinkley makes some really good points here and I think I agree on what would really be helpful:
- Guidelines for requesting functionality
- Guidelines for submitting patches
- A commitment that project maintainers will also follow a public process (the same process as other contributors?) for making changes.
- Clear documentation about deprecation, and gotchas, etc.

I donâ€™t think any of these things need to be exceedingly exact or heavy-duty; even a little guidance helps. For me, the biggest one by far is having project maintainers/committers following a public process for proposing/making changes, especially for changes that affect the API surface or intended usage.

> Finally, thank you both for the commentary and criticism. I think this discussion is an important one and needed to be had.

Glad to know Iâ€™m not just a crazy man off screaming in the corner! Thanks for your feedback, too, it was probably clearer and more concrete than mine :D
 @Mr0grog I didn't have a _great_ place to put this, but this seems the most logical.

I decided to pull together an external [examples project](https://github.com/rosshinkley/nightmare-examples) as to not pollute the Nightmare package with extraneous libraries.  That said it's (I hope) close to what we had originally discussed.  So far it has basic usage on `vo`, `co`, promises and semantic callbacks, as well as a couple of known problems.  I'll be adding more stuff to it as time permits, and would love to have your and possibly @matthewmueller's feedback, availability permitting.
 @rosshinkley cool! Iâ€™ve been a little busy this week, but will definitely check it out.
  I need use proxy credentials but how to do this in nightmare ? 
In electron this solve simple http://electron.atom.io/docs/v0.36.7/api/web-contents/#event-login
But how to do this in nightmare ? I need send event.preventDefault(), but how it can over ipc ?
  If the process Nightmare is running in exits or is killed (via a graceful process.exit() call, interrupt signal, etc), this ensures that the underlying Electron process Nightmare is managing also gets closed and cleaned up so users don't have have tons of rogue Electrons running.

Fixes #474.
 +1 for the PR, and a double +1 for the remote branch name. ;)
 :+1: No problem, happy to help out.
   Status?
  I've seen this a few times recently as well.
  You state:

> Under the covers it uses Electron, which is similar to PhantomJS but faster and more modern.

Can you show us some proof like benchmarks or documentation to proof that?

Greets
 @matthewmueller You wouldn't happen to have the benchmarking code would you? I did some basic benchmarking on a 2016 Macbook Pro between Nightmare (using Electron) and Capybara with PoltergeistJS (Ruby interface to PhantomJS), and Nightmare is usually around 1.5x - 2.5x slower for me It is unclear to me what those benchmark numbers even mean or if they are even accurate...

I ran Nightmare locally and Electron takes 2300ms~ to get page title from google.com, this is using the latest build available on NPM.

A truly fast headless browser - zombie.js, the results are very promising: 700ms~ to get page title from google.com @boxtown weird maybe phantom has improved a lot since these were run. Don't have the old code on me, but you can probably just download nightmare 1.x and nightmare 2.x to run them side by side.

@abacaj if you can use a headless browser with a fake DOM implementation, then you should. Last I checked zombie was still using jsdom, you could improve that further with cheerio. Nightmare is built for sites that are javascript heavy and need to be able to run the client-side javascript code. https://github.com/laggingreflex/scrapers-benchmarks

```
Run 1 { request: 747, zombie: 2895, phantom: 4406, nightmare: 7854 }
Run 2 { request: 627, zombie: 2008, phantom: 4486, nightmare: 7522 }
Run 3 { request: 620, zombie: 1807, phantom: 4736, nightmare: 11186 }
Run 4 { request: 631, zombie: 2025, phantom: 4810, nightmare: 8878 }
Run 5 { request: 615, zombie: 2122, phantom: 4864, nightmare: 7726 }
Average: { request: 648, zombie: 2171, phantom: 4660, nightmare: 8633 }
```
  I am scraping a site that declares  a global function in it's head tag : 

```
<script type="text/javascript">
//<![CDATA[

function __aFunction() {
  ...
}
//]]>
</script>

```

Inside an evaluate() I call this function and get this error message
###### error occured : 'caller' and 'arguments' are restricted function properties and cannot be accessed in this context.
 As an experiment, I propped up a sample on a branch on my fork ([test](https://github.com/rosshinkley/nightmare/blob/client-script/test/index.js#L196-L203), [fixture](https://github.com/rosshinkley/nightmare/blob/client-script/test/fixtures/evaluation/index.html#L6-L10) if you're curious) as a minimal case.  The function call works and the test passes.

I wonder if you're hitting something internal to the client function?  Is there a more complete error description or stacktrace?
  Figured the docs should be updated so more people don't have trouble as in #477.

I wound up making significant changes to the last example so that it would actually still work safely in the case of an error. It seems that, if the vo callback that is handling the error throws, then vo just continues execution as normal in the `run` function and doesn't raise the error. So `undefined` is logged and it looks like no error happened, but no title was found, either. I changed it to log the error, but that also means the handler has to call `process.exit()` otherwise it hangs because `nightmare.end()` is never called because of the error getting the title. Maybe it would just be better to use try/catch/finally instead, since generators allow that:

``` js
vo(run)();

function *run() {
  var nightmare = Nightmare();
  try {
    var title = yield nightmare
      .goto('http://cnn.com')
      .evaluate(function() {
        return document.title;
      });
    console.log(title);
  }
  catch(error) {
    console.error(error);
  }
  finally {
    yield nightmare.end();
  }
}
```
 Soâ€¦ the new first example doesn't work because the `end()` call happens simultaneously with the queue being used to get the link. It kills the electron process before the queue can complete.

The second example (down near the end under the heading "Execution") is still using vo.
 Also, _both_ those examples should probably:

`var Nightmare = require('nightmare')`

rather than:

`var Nightmare = require('./');` (the first one) and
`var Nightmare = require('../nightmare');` (the last one).
  I have the following code (nightmare v2.1.6 and  node v4.3.0)

```
      var nightmare = new Nightmare({show: showBrowser})
          .useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36')
          .goto('http://someSite)
          .inject('js', './node_modules/underscore/underscore.js')
          .wait(2000)
          .wait(".someClass")
          .evaluate(function() {
              _.map(someArray,function(z) {...})
           })

```

Nightmare gives me a "_ is not defined" error

I have verified that the path of underscore.js is correct, since I can do : 

 var _ = require('./node_modules/underscore/underscore.js')

inside my nodejs script.
 What you have there ought to work.  Out of curiosity, is the `.goto()` causing a redirect?  What happens if you move the injection to after `.wait(".someClass")`?
    Fixed by #465 
  When using `.type()` and showing the Electron window, I can see how the text I put in gets typed. Is there a way to control the typing speed?
 @matthewmueller I wanted to speed it up. How much do you think we could increase the speed without compromising the ordering?
 I've tested my tests with `0` timeout on the `.type()` function and can't report any keystrokes being emitted in the wrong order. 

Using the `setTimeout(fn, 0);` hack to defer the event to the next event loop of JavaScript should be just fine. 

I was tempted to make this timeout a configurable variable to aid debugging without making test suites run longer than necessary, but I did not want to introduce a breaking change. 
  In trying to use Nightmare for doing some screen captures of highly dynamic web pages, I've discovered that the screenshots are often out-of-sync with the state of the web page being captured. After a lot of investigation, it turns out that this is actually an underlying issue in Electronâ€”it generates a screenshot by simply copying from Chrome's backing store, which is not actually guaranteed to be up-to-date (see [Electron issue 1049](https://github.com/atom/electron/issues/1049) and [this Chromium-dev discussion](https://groups.google.com/a/chromium.org/forum/#!topic/chromium-dev/o2aUtFAIlyQ)).

I believe this is probably the underlying issue behind a few other nightmare bugs, such as: https://github.com/segmentio/nightmare/issues/33, https://github.com/segmentio/nightmare/issues/129, the long wait @rosshinkley suggests adding in his solution to https://github.com/segmentio/nightmare/issues/328

But! It turns out there is a way to address this. In Electron's `BrowserWindow.webContents`, you can call `beginFrameSubscription(callback)`, which seems (in my testing) to guarantee that the backing store is up-to-date when your callback is called. So if you changed [line 252 of `lib/runner.js`](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L252) to:

``` js
win.webContents.beginFrameSubscription(function(buffer) {
  win.webContents.endFrameSubscription();
  win.capturePage.apply(win, args);
});
```

You ought to have a much more deterministic result when calling `.screenshot()`.

Unfortunately, I don't have a great reduced test case for this, but I'm more than happy to submit a patch if desired.
 @Mr0grog Glad to finally have an answer to that question, and good eye for finding that issue!  Especially good to know it's not a framebuffer-dependent issue.

I agree: anything to make the behavior deterministic.  I do have an edge-case question, though - in my read of the documentation, the `beginFrameSubscription` callback is called for any display event.  If the screenshot is taken well after the page is rendered, will the callback still be called?
 @matthewmueller Great, I'll try and put together a PR this week.

@rosshinkley That is a really good question! I will poke around and see what I can see. In the worst case, twiddling with something on the page, such as adding and removing an element, ought to work to trigger it.
 Spent a little time on this today and discovered:
1. If the page is all settled and idle, the callback won't be fired (as you surmised @rosshinkley), so we do have to do something to the page to trigger it. That something has to affect the render treeâ€”adding comment nodes, empty text nodes, etc. won't do it. Happily, adding a transparent 1x1 div to the top left corner of the page (even if the top/left corner isn't in view!) works.
   
   (Also interesting: even though adding it to the top of the page when the top of the page isn't visible does work adding it where it never _could_ be drawn, e.g. `left: -10000px` does _not_ work. Â¯_(ãƒ„)_/Â¯ )
2. It's easy to crash electron while doing this (see https://github.com/atom/electron/issues/4441), so the whole technique may be a bit problematic in the end. If we stay subscribed to frames for the lifetime of the window, I think we could reliably avoid the crash, but I can imagine that easily getting resource intensive.
 @Mr0grog Would [window.requestAnimationFrame()](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame) trigger the render tree?
 It certainly triggers the render tree, but this isn't actually a render tree issue. Also, I tried the same thing when I was first exploring this ;)

It's fundamentally an issue with how Chrome's _backing store_ gets updated, which is actually largely unrelated to what is getting rendered to the screen inside the renderer process (where the web page is being drawn to the screen). In any case, there is a complete fix for this issue in #479, it just needs reviewing.
    Hi,
Is it possible to upload files using nightmare.type('#input-element-id', '/tmp/img001.jpg'), similar to what selenium supports?
http://www.seleniumeasy.com/selenium-tutorials/uploading-file-with-sendkeys-method

If not, is there a suggested alternative way to achieve the same, which is to programatically initiate a file upload, without having to open a file browser?
 +1
 Unfortunately not :/

The only thing that might work is to fake a drop event with the file(s) attached. But one would probably run into some other browser restrictions, but it might be worth a try. 

If the above approach does not work, then this is not possible until Electron adds some way of intercepting the file dialog or manually setting the file(s). There's more to read in the [other issue](https://github.com/segmentio/nightmare/issues/235) regarding uploading files.
  This pull is like #84 
I creating another pull request because i deleted the oldest one(don't ask me why please).
Past the response from @reinpk 

"thanks @Max93! sorry i never got to this with v1... it looks like an interesting abstraction for other events... what events were you interested in? closing for now but may bring the idea into v2 with more info here. thanks!"

Thanks again @reinpk 
  G'day, I have the following bit of code that I can't get to work for the life of me. I have the preview window on and can see electron navigating around properly but I can never get the "hello" to come up as the result.

```
    getLinks(function() {
        co(downloadRecord).then(function(res) {
            console.log("res is ");
            console.log(res);
        }, x => console.log("Error is " + x));
    });

    function* downloadRecord() {
        var return_button = "#licenceHolderForm\\:returnButton";
        var results = [];
        var a;
        for (var i = 0; i < 2; i++) {
            var link = links[i];
            yield nightmare.click(link).wait(return_button);
            yield a = nightmare.evaluate(function() {return "hello"});
            yield nightmare.back().wait(refine_button);
        }
        return a;
    }
```

I've tried about a million different combinations where the only I could get to work involved using .run where the second parameter returned "hello" instead of the nightmare instance. Previously I had `yield a = nightmare.click(link).wait(return_button).evaluate(function() {return "hello"})` all in one line. In that case res was returning an instance of nightmare. Since I've split them res is now undefined.  I'm new to generators and co/vo in js so any help would be greatly appreciated!
 I don't know if this is the entirety of your problem, but this line:

``` js
 yield a = nightmare.evaluate(function() {return "hello"});
```

...should read:

``` js
 a = yield nightmare.evaluate(function() {return "hello"});
```

The former waits for an assignment of what `.evaluate()` returns, which is a Nightmare instance.  The latter awaits fulfillment of what `.evaluate()` yields.
 Thanks for that! I knew it would be something simple. [This article](https://davidwalsh.name/async-generators) really helped me to understand what was going on with co. Feel free to close
  Hi,

whats the best way to get access to `win.session.webRequest` object through Nightmare?
(looks like it s in revision 36+, not the currently electron version used in nightmare, but i was able to use it by passing the `electronPath`)

A use case for me
when scraping sites using Nightmare, there are a lot of ads/tracking pixels firing. they slow down the page dramatically.
i want to filter out those request (request not originating from the domain i m interested in).
i was able to do this by adding the `win.session.webRequest.onBeforeRequest` handler.

wondering if theres a way to do this through the `plugin/action` extension pattern.

thanks
 looks like the `cookies.get/set` should be using `win.session` object, but i am unable to find the usage in the Nightmare code base.
 Selfish +1 for making this a plugin.  I'd be happy to put it together. :)

Half-kidding aside, though, if you would rather have this be a part of core I'd be happy to throw together a PR.  Which would you prefer?
 [Curiosity got the best of me](https://github.com/rosshinkley/nightmare-load-filter).  If that seems like something worth submitting for core, I'd be happy to do it.  I'd love to hear your arguments for including it. :)
 @yoshi95 I added `nightmare.webRequest.onBeforeRequest` in PR #495 
@matthewmueller In order to make plugin like this, I think some apis are needed which can access electron side api or event message receiver written in `runner.js` just like [this](https://github.com/segmentio/nightmare/pull/495/files#diff-b3b53682a18f203ac8d29b0e277cad26R353) which is the same as the way of cookie api.
 @kyungw00k the API you're requesting is done.  For more information, read through #391 and #425.
 @rosshinkley the API will be available to use after #391 is completed, right?
 @kyungw00k Correct.
 @yoshi95 now, you can use `webRequest.onBeforeRequest` handler with [nightmare-webrequest-addon](https://github.com/kyungw00k/nightmare-webrequest-addon)
  Yesterday, I ran up against #224, and before finding all of the helpful info there (_thank you everyone_), I was doing my own debugging based on the [exit code](http://tldp.org/LDP/abs/html/exitcodes.html) of the electron child process. This should hopefully make it easier to identify potential issues when ["it just quits."](https://github.com/segmentio/nightmare/issues/224#issuecomment-177268035)

If you're seeing exit code 127, you may not have electron installed correctly.
If you're seeing exit code 126, you may not have all the necessary dependencies for electron (:wave: gtk).
If you're seeing exit code 1, xvfb is a likely suspect in my experience.
If you're seeing exit code 0, electron appears to be working fine and it's something else.

Do you agree the exit code is helpful when debugging? Should these possible problems be included in the source, README, or wiki?
 :+1: I like when software tries to help me directly, too
 Is there anything else I can do for this PR before merging? 
  If a wait function times out and throws an error with functions queued up (i.e. the wait function is not the last step in a chain of actions) execution should fail immediately, yielding the error that was thrown.

If anything else is missing from this PR let me know and I'll be happy to address. Thanks for all the hard work that has gone into this project, it's a pleasure to use!

It seems like the following GitHub issues are related:
https://github.com/segmentio/nightmare/issues/397
https://github.com/segmentio/nightmare/issues/171
  Is there some way to use nightmare without a headless browser, like include it tampermonkey plugin?
 For clarity: are you asking if Nightmare could be used under TamperMonkey?

If you're asking if TamperMonkey could be included as an extension for a Nightmare process, that is currently not possible.  Electron does not have a plan to [include Chrome's extension APIs](https://github.com/atom/electron/issues/1498).
 I'm not writing an extension for TamperMonkey. I just want to use nightmare API to write scripts in TamperMonkey. Thank you for your replies.
  See [this issue](https://github.com/segmentio/nightmare/issues/454) for details.
 You're very welcome, Nightmare has been a huge help in my work and I'm happy to contribute where I can.

Quick question, any idea when the next release is due?  I'm also waiting on the default value for waitTimeout that's currently only in master.
 Never mind, I see that it's out!  Awesome!
  When using Nightmare 2.1.2 and 2.1.3, we see the following warnings,  but only on Windows.

```
(electron) ipc module is deprecated. Use require("electron").ipcMain instead.
(electron) getUrl is deprecated. Use getURL instead.
(electron) loadUrl is deprecated. Use loadURL instead.
```

I am preparing a pull request to fix each of these warnings now.
 The PR is here: https://github.com/segmentio/nightmare/pull/455
 The "url" fixes were trivial.  The "ipc" change was not, so I left that for now.  This will at least get rid of 2/3 warnings.
  This should go away once a new release is cut that includes [this commit](https://github.com/segmentio/nightmare/commit/24d9efa4a42a9937910650b860eed37bec0b1b1b).  I am making a note of it here to help anyone else who encounters the problem with version 2.1.3.

In version 2.1.3, which includes [this change](https://github.com/segmentio/nightmare/commit/f75b48aad09339b1407f3d3422a1dd51b936c2f0), a call to `nightmare.wait(ms)` will fail unexpectedly as demonstrated in the following code:

```
"use strict";

var Nightmare = require("Nightmare");
var nightmare = new Nightmare();

nightmare.wait(500).run(function (error, result) {
    console.log("error:", error.message);
});
```

This consistently outputs `.wait() timed out after undefinedmsec`.  The solution (until a new release is cut that sets a default value) is simply to set the required option, as in `new Nightmare({ waitTimeout: 30000})`.
  this electron flag seems to stop the fullscreen context switching described in #434 
 @matthewmueller it works! (I npm installed the current release, so I'm unsure if @emars fix was reflected in that.)

---

Aside:
While testing it I ran the Yahoo! example in the readme and it doesn't work anymore because the class for the submit button isn't present.

``` js
document.getElementsByClassName('ac-21th')[0].href;
```

`getElementsByClassName` returns an empty list in this case.
  can we expose __timeoutMs_ to option as well, so that users can override this value if they want, 250ms sometimes sounds relative long, for example measuring page loaded time..

``` javascript
/**
 * Wait until evaluated function returns true.
 *
 * @param {Nightmare} self
 * @param {Function} fn
 * @param {...} args
 * @param {Function} done
 */

var _waitMsPassed = 0;
var _timeoutMs = 250;
function waitfn (self, fn/**, arg1, arg2..., done**/) {
...
}
```
 Hi, @rosshinkley , measuring page load time is the case i can think of currently which matters most for the accuracy to the test numbers.
  How would I go about using Nightmare.js within an Express route?

I have tried the following but it is not working ...

``` javascript
var express = require('express');
var router = express.Router();
var Nightmare = require('nightmare');

router.get('/', function(req, res) {

    new Nightmare({ show: true })
        .useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36')
        .viewport(1200, 950)
        .goto('http://www.bbc.co.uk/')
        .wait()
        .screenshot('screenshots/bbc.png')
        .run(function() {
            res.send('Screenshot has been captured');
        })
        .end();

});

module.exports = router;
```

Any ideas?
 Just to get some context, is this all the code that you're running?
 No, I have other Express code that initialises the server etc (in separate files). The code above is just what gets run when the '/' route is matched.
 Oh..which version of nightmare are you using?
 What you have _should_ work.  What happens when you run it?  Have you tried running it with `DEBUG`?

In addition to version, are you running this headlessly?  (I suspect since you have `show: true`, the answer is no, but it's worth double-checking.)  How are you running the node process?
 @shri3k I have `"nightmare": "^2.0.7"` in my package.json file.

@rosshinkley When I run it I never get a response back and the PNG screenshot doesn't get created. 
Do you mean run it like ...
`$ DEBUG=app bin/www`

I want it to run headlessly. I have changed it to `new Nightmare({ show: false })` but it hasn't made any difference.

I know the route is matched and running ok, as I have put `console.log`'s in there and I can see them in Terminal.

I'm just about to go on holiday for a week. So I won't be able to reply to this thread. But when I get back I'll put together a simple(r) demo that I can share with you.

Thanks in advance.
 Electron requires a framebuffer to render, and I'd wager your headless solution doesn't have a framebuffer running.  If you are running headlessly - and testing what you provided as a sample headlessly - you're probably going to want to at least read through #224.  It has some proposed solutions to try.  I have a sneaking suspicion you're hitting the same issue.
 @rosshinkley I think you were right. I am having the same issue as #224. I managed to get it working locally, but I need it to run on Digital Ocean (headlessly. It appears I'm not the only one having problems with this, judging by the thread on #224.
   @rosshinkley now updated
  #419
   This is because there is no default reject function, so if you fail to pass one then you will get an unhelpful error Ã  la `undefined is not a function`. Throwing it allows your `uncaughtException` handler to log out the actual error.
 @inversion I think the issue you were trying to solve here was fixed when @matthewmueller changed `.then()` to return a promise: https://github.com/segmentio/nightmare/commit/54f81d3dd9e6e4dad861f749a4a3064e2ce98dd0

If so, it would probably help to close this PR.
 With that change it will now log out properly so closing.

```
new Promise(function(fulfil, reject) { reject(new Error('foo')); }).catch(undefined);
// Promise {[[PromiseStatus]]: "pending", [[PromiseValue]]: undefined}
// Uncaught (in promise) Error: foo(â€¦)
```
  See http://blog.atom.io/2015/11/17/electron-api-changes.html
  fixes: #442 
bug introduced by: #438 
  The dock icon is now hidden by default by the following pull request:
https://github.com/segmentio/nightmare/pull/426

This OS X specific option allows the dock icon to be shown again, mainly
for testing purposes, and makes no harm in other operating systems.

Fixes: https://github.com/segmentio/nightmare/issues/377
 Let me know if you have any suggestions, mainly regarding the documentation!
 @matthewmueller Renamed `showDock` to `dock`!
  fixes #428 
  Sometimes the "should type integer" test will fail.

It appears to be pretty random.

`mocha -g "type integer"`
  fixes #429 
 hi - i had a problem with this change because i wasn't specifying a waitTimeout and so it was hitting the failure case instead. I think we need a check for undefined.

https://github.com/segmentio/nightmare/blob/f75b48aad09339b1407f3d3422a1dd51b936c2f0/lib/actions.js#L250

Also, for the odd (isn't it?) case when a ms timeout is >= than the optionWaitTimeout, what is the benefit in waiting for a guaranteed failure?

 Couldn't we just either:
- throw an error immediately
- wait for the optionWaitTimeout but don't throw an error
 @squirmy , yep it is kind a negative case to have timeout wait value >= the option WaitTimeout i tested :)
currently it has an issue without setting it as you mentioned(hanging from my side with 2.1.3 release). 
I would suggest that we can have a default value of option WaitTimeout(30000ms for example), or user can overwrite it in options explicitly.
 @emars Thank you for fixing this! :+1: 
  fixes #431 
    https://github.com/segmentio/nightmare/blob/master/package.json

![screen shot 2016-01-12 at 8 23 49 am](https://cloud.githubusercontent.com/assets/546900/12257365/4393a028-b906-11e5-9eed-e86c4c59634b.png)
 lol
  How can call a local site hosted in IIS and using windows authentication using nightmare?
 Struggled with it too for a while. Solution / workaround (because `authenticate()` didn't work):

```
.goto('domain\\username:password@hostname:port/path');
```

â€¦correctly used NTLM authentication in my case. Fixing `authenticate()` would be the best option though.
 @rosshinkley I'm fairly sure I've tried `.on('login', â€¦)` but let's wait until Monday when I check this at work. Nb. I've had exactly the same problem with Casper/Phantom.
   Thanks!
  Hiding the application dock icon gives a more polished experience and
abstracts the user from Nightmare's internals.

I believe this was commented out by mistake.
 `app.dock` seems to be `undefined` in CircleCI, which I believe happens when nightmare is run in a platform other than OS X.

```
TypeError: Cannot read property 'hide' of undefined
        at Object.<anonymous> (/home/ubuntu/nightmare/lib/runner.js:47:9)
        at Module._compile (module.js:434:26)
        at Object.Module._extensions..js (module.js:452:10)
        at Module.load (module.js:355:32)
        at Function.Module._load (module.js:310:12)
        at Object.<anonymous> (/home/ubuntu/nightmare/node_modules/electron-prebuilt/dist/resources/default_app/main.js:252:23)
        at Module._compile (module.js:434:26)
        at Object.Module._extensions..js (module.js:452:10)
        at Module.load (module.js:355:32)
        at Function.Module._load (module.js:310:12)
```

---

I'll update my PR to check for the existence of `app.dock`.
 @matthewmueller I'm shipping an electron app which uses Nightmare under the hood, and thus a new electron icon is shown in the dock for a while, which looks very awkward.

> i'm just a little apprehensive with hiding it right now just because it's nice to know if you accidentally opened up a ton of processes.

I see, this issue hit me a few times already. What about allowing a custom opt-in option to hide it from the dock (`hideDock`?) on the `Nightmare` constructor, that way users can enable it on demand, knowing the possible implications.
 BTW, Circle CI seems to be failing with a sporadic error:

```
  1) Nightmare manipulation should type integer:

      AssertionError: expected '' to equal '10'
      + expected - actual

      +10

      at Context.<anonymous> (test/index.js:280:22)
      at next (native)
      at onFulfilled (node_modules/mocha-generators/node_modules/co/index.js:65:19)
      at Nightmare.<anonymous> (lib/nightmare.js:316:10)
      at Nightmare.done (lib/nightmare.js:226:15)
      at Nightmare.next (lib/nightmare.js:204:28)
      at EventEmitter.<anonymous> (lib/nightmare.js:214:12)
      at ChildProcess.<anonymous> (lib/ipc.js:28:10)
      at handleMessage (internal/child_process.js:685:10)
      at Pipe.channel.onread (internal/child_process.js:440:11)
```

Can you restart the build for me?
  This is a possible implementation for solving #391.  Not _exactly_ what was requested, but hopefully close.

Some things to ponder, in no particular order:
1. This amends the instance, not the prototype.  I did this largely because Nightmare does not share Electron instances between Nightmare instances.  It didn't seem sensible to force the prototype to have Nightmare actions for which there were no Electron actions.  This also allows separate instances of Nightmare to use different plugins.
2. Adding Nightmare and Electron actions together makes more sense to me than adding Electron actions alone.  Thoughts?
3. I readily acknowledge this sort-of-kind-of steps on `.action()` (and to a lesser extent, `.use()`).  I considered updating `.use()` for plugins, but decided not to introduce breaking changes for this proposal.  Suggestions for naming conventions or restructuring welcome.
4. Constructed function scoping works a little differently.  This is why the constructed function binds to an object that passes in `require` (it's _slightly_ cleaner than using `eval`).  This allows `require` calls to be made in the Electron action.  I considered stuffing that object with `parent`, `win`, etc - this would make the Electron actions look closer to what is in `runner.js`, but decided to leave them as explicit parameters for the time being.  Thoughts?
 @matthewmueller no problem, happy (at least to try) to help.

> This could be confusing with how .action works, but is sort of inline with .use. I'm not crazy about having all these sorta different, but obscure ways to extend nightmare. I think it was discussed a bit in #379.

I thought something eerily similar, and I actually had a point about that originally that got edited out as I couldn't make it constructive enough.  I opted to go the way I did just to get the gist of the idea on virtual paper and not stomp on stuff that already existed.  I agree that, as it stands, this will be _very_ confusing, even with more/better documentation.

> Need to think on this more. But in general, I agree. It needs to be consolidated a bit more.

I think I'm going to go ahead and update this to put all of this into `action` - that seems to be a logical consolidation step.  I also think it'll help to have a rough cut of what that would look like.  More on that when I finish.

> Explicit params is probably fine if there's not going to need to be any additional params (or different ordering). If not, we should probably just pass a params object in.

I don't _think_ there will be additional parameters, but the required signature is a bit verbose.  I'm also not crazy about wrapping the function in a context - it makes the parameters feel a bit "magic", but I thought I'd put it on the table as an option.  

> Some general aestetic thoughts: I'm not crazy about passing an object in with nightmareAction, electronAction.

A parameters hash is a bit... icky?  I'm not enthusiastic about it either.  As an aside, the reason I did it that way with `plugin` was a personal preference: I'll use a hash when I don't know what the final signature will be.  It's a vestige of experimentation. :)
 @matthewmueller This update keeps the additions of the extensions together, as well as consolidates `.action()` and `.plugin()` into a single `.action()` function.  I've also kept the order of parameters similar to `.evaluate()` where the (optional) client method comes before the Nightmare action.

There are a couple of differences (and possible pitfalls?) in this update.  For starters, to keep the current behavior of `.action()` consistent, I decided it made the most sense to have the Electron plugin(s) be added for all instances.  The child actions are cached on the nightmare constructor, similar to how namespacing for `.action()` works.  Consequently, the addition of those child actions are added to the queue in the constructor such that all child action additions are executed prior to the first user-specified action.  (And they're silent, something I've got mixed feelings about.)

Thoughts?
 @matthewmueller When I wrote that sentence about possible pitfalls, I had two things in mind:
1. I was changing how `.plugin()` behaved considerably - originally, you could add Electron functionality piecemeal.  This meant the execution time/complexity to add Electron extensions was only as big as the instance required, whereas now, actions for _every_ plugin are queued for every instance before execution can even start.  On reflection, since the plugin action is uniform (except in what's actually transferred), I'd bet the performance impact is (almost) negligible.  At any rate, it's not anywhere near dealbreaking, only the fringiest (is that a word?) of fringe cases would be using multiple Nightmare instances with different bolt-ons.  TLDR: adding plugins to every instance isn't going to be a problem. :)
2.  I know I mentioned this already: queued plugin actions execute silently before the first user call.  Should they at least make a `debug` call or something?

Finally: anything else I can do to help this PR along?
 @matthewmueller I went ahead and added the debug, and also went ahead and merged in the recent changes.  Special thanks to @emars for fixing the build, something I just hadn't had time to do. :)
 @matthewmueller I've gone ahead and thrown together a couple of proposed plugins: [additional events](https://github.com/rosshinkley/nightmare-custom-event) (from #376) and [download management](https://github.com/rosshinkley/nightmare-download-manager) (from #382).  From that, I got to use this PR for "real" applications, and as such, made a couple of touchups to include options in the Electron method, as well as attaching the options hash to the instance.  This allows for making/expecting options in the Nightmare options for plugin use.
 A note on `require`'s context: The Electron context does have `require` attached, but it's worth noting that it'll require things from the local Nightmare install's node modules, not the plugin's node modules due to how the Electron function is created.  Plugin-installed modules can be required if they are specified with absolute or relative paths passed from the Nightmare plugin to the Electron plugin.

An example may be helpful.  Say we wanted to do some date manipulation in Electron and wanted to use Moment to help:

``` js
var Nightmare = require('nightmare');

Nightmare.action('requireSomething',
  function(name, options, parent, win, renderer, done) {
    parent.on('require-example', function(){
      parent.emit('log', 'trying to require moment');
      var moment = require('moment');
      parent.emit('log', moment().format('YYYY-MM-DD'));
      parent.emit('require-example');
    })
    done();
    return this;
  },
  function(done) {
    this.child.once('require-example', done);
    this.child.emit('require-example');
  });
```

... won't work.  You'll get an exception from `runner` saying it couldn't find moment.  However, if you pass the module path down:

``` js
var Nightmare = require('nightmare'),
    path = require('path');

Nightmare.action('requireSomething',
  function(name, options, parent, win, renderer, done) {
    parent.on('require-example', function(modulePath){
      var path = require('path');
      parent.emit('log', 'trying to require moment');
      var moment = require(path.resolve(modulePath, 'moment'));
      parent.emit('log', moment().format('YYYY-MM-DD'));
      parent.emit('require-example');
    })
    done();
    return this;
  },
  function(done) {
    this.child.once('require-example', done);
    this.child.emit('require-example', path.resolve(__dirname, 'node_modules'));
  });
```

... allows Moment to be required.

---

I considered trying to make `require` automagically work: the `.action()` method would need to determine the caller location (which can be done by sifting through an artificial stacktrace, or use of `module.parent`, both of which have problems).  Then, Electron's `require` would need to be wrapped in a function that determines if it's a bare package name or path, require, and return the package, and I'm sure there's other complexity buried there.  

In other words, it's complicated, and probably too much complexity to introduce when 1) using `require` from Electron is probably going to be rare and 2) passing the path explicitly avoids complication entirely.

I'm certainly open to suggestions or thoughts. :)

---

Is it worth including something akin to the above in the documentation to clear up possible problems with `require` from Electron?
  I found that the Examples <<Let's search on Yahoo:>> can't run correctly in ubuntu & centos. When I run the examples in window 8, It's can run and output the result. But when I run the examples in ubuntu & centos, it run fast and exit at once, and no result output. It seems like that nightmare just push action into queue, but do nothing.

Can anybody else have such issues?
 ## output in window8:

> node yahoo.js

https://github.com/segmentio/nightmare

## output in centos:

[root@test]# DEBUG=nightmare node --harmony yahoo.js  
nightmare starting...  
  nightmare queueing action "goto" for http://yahoo.com +0ms 
  nightmare queueing action "type" +5ms  
  nightmare queueing action "click" +2ms  
  nightmare queueing action "wait" +0ms  
  nightmare queueing action "evaluate" +0ms  
  nightmare running +1ms                                     
 Without spinning up a Centos VM, this sounds suspiciously like there's no X-compatible framebuffer running.  Take a look through #224, possible duplicate of #269.
 Thank you very much. 
I have take a look through #224, and make some upgrade for my ubuntu server.
Now my program has been running in ubuntu correctly.

Thank you!
  Hello,

I have a form that respond to submission with a CSV file. Do you know how I could test it ?
- test that a file in responded ?
- test the file name ?
- test the file size ?
 TLDR: You currently cannot test downloads this way.  There are plans to address this issue.

A slightly longer explanation: use-cases for how Electron handles downloads - the `will-download` event - are very different.  PR #382 attempts to manage downloads, but it was decided that downloads should be handled in one or more plugins (see #391) - one for handling them in parallel, and possibly another for handling them inside of the Nightmare pipeline.  It may also be worth reading #332, #371, and #151 for more background.
 Thanks a lot for this detailed explanation that/certainly took time to
write. It's much appreciated !

Le mar. 5 janv. 2016 00:13, rosshinkley notifications@github.com a Ã©crit :

> TLDR: You currently cannot test downloads this way. There are plans to
> address this issue.
> 
> A slightly longer explanation: use-cases for how Electron handles
> downloads - the will-download event - are very different. PR #382
> https://github.com/segmentio/nightmare/pull/382 attempts to manage
> downloads, but it was decided that downloads should be handled in one or
> more plugins (see #391 https://github.com/segmentio/nightmare/issues/391)
> - one for handling them in parallel, and possibly another for handling them
>   inside of the Nightmare pipeline. It may also be worth reading #332
>   https://github.com/segmentio/nightmare/issues/33%0D%202, #371
>   https://github.com/segmentio/nightmare/issues/371, and #151
>   https://github.com/segmentio/nightmare/issues/151 for more background.
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/422#issuecomment-168840916
> .
 Thanks a lot, @rosshinkley, what a great bunch of plugins, that's awesome!
  we're currently swallowing errors, making debugging nightmare timeouts incredibly difficult:

**timeout.js**

``` js

var ms = require('ms');
var Nightmare = require('./')

var n = new Nightmare;
n.goto('http://yahoo.com').end(function() {
  console.log('=)')
  process.exit(0)
});

setTimeout(function() {
  console.error('timeout')
  process.exit(1)
}, ms('30s'))
```

**output**:

```
$ DEBUG=nightmare* node timeout
  nightmare queueing action "goto" for http://yahoo.com +17ms
  nightmare running +3ms
timeout
```

---

running `dist/electron` directly yields:

```
$ node_modules/electron-prebuilt/dist/electron lib/runner.js 
node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libgconf-2.so.4: cannot open shared object file: No such file or directory
```

... any reason we're not sending this to `stderr`, or at least notifying the user that something went wrong?
 I'm trying to run nightmare on GCP and get a similar error:

```
$ node_modules/electron-prebuilt/dist/electron lib/runner.js 
node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
```
 Since this was filed, it looks like Nightmare has gotten a _little_ better at surfacing electron errors: https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L70

â€¦but that really wouldnâ€™t give nearly as much detail as it could. A user would never see the message above from electron, for example:

```
node_modules/electron-prebuilt/dist/electron: error while loading shared libraries: libnotify.so.4: cannot open shared object file: No such file or directory
```

One option would be to just send Electronâ€™s stderr through the parent processâ€™s stderr. Users would see deprecation notices and possibly a number of other bits of noisy output from Electron. Thereâ€™s probably some good to be had there (in trying this, I noticed Nightmare uses several deprecated APIs), but I can imagine there might be other output that is more noisy than helpful.

Another option might be to buffer up Electronâ€™s stderr and emit it when/if Electron exits with a non-zero exit code. Any thoughts?
 My very minor 2Â¢: sending Electronâ€™s stdout/stderr to debug channels like `electron:log/election:error` seems like a great idea and gives people lots of flexibility for getting various output. Iâ€™m somewhat skeptical that a new, heavier logging tool needs to come along for the ride, but can definitely see ways that doing so might be helpful. Maybe the main question is: whatâ€™s the pain point youâ€™re trying to solve switching logging implementations?
- loglevel is great for when you need something light and simple, especially in the browser. That said, switching to it will sacrifice some nice things Nightmare currently has: automatic coloring, prefixing, and timing in log output, plus automatic filtering of loggers by environment variable. That will all have to be re-coded (if we still want it). (Also full disclosure: I wrote loglevelâ€™s multiple-logger support, so I may be somewhat biased in regards to it.)
- winston is really heavy-duty, but will probably get you all you need straight away with very little extra work. I think you can also query/re-play logs, which might be useful if, say, Electron logging is suppressed but then Electron crashes and we want to output its logs anyway.
 > running Nightmare with DEBUG wildly verbose. There are probably other events - like any of the events that are simply forwarded - that could be dropped to a lower log level.

Getting off topic from this bug, but _oh, certainly._ I think itâ€™s already a little verbose. One simpler thing to do might be just having more granular logging channels, e.g. browser events, script execution, runner actions, queueing, process management, etc. One could potentially manage just as well by message type as by severity.
  untested
 it logs to the bash the page events like alert and error with `DEBUG=nightmare:log`
 The change to `page` from `page-error`, `page-log` etc was an intentional one.  Take a look at the default preload script, specifically at how [page errors are handled](https://github.com/segmentio/nightmare/blob/master/lib/preload.js#L6-L8) and consequently [transmitted to Nightmare](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L90-L92).  All of the messages are (to the best of my knowledge) still being logged to `debug`, but are logically grouped together using the same event.
 it was intentional and i understand this change how ever only the child process does this correct (as you mentioned). https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L90-L92 

the parent process doesn't listen to `page` it listens to `page-error` and thats what die pr is fixing. https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L111-L117
 @antpaw Ah, I see.  I must have misread the original diff.  It looked like in passing it was adding the `page-*` events back.  At any rate, I think you are correct. The parent process should listen to `page`.  +1. :)

One nit: I think the page handler should handle variable arguments.  Something like:

``` js
this.child.on('page', function(){                                                               
  log.apply(null, ['page'].concat(sliced(arguments)))                                           
}); 
```

... or if the `page-*` convention should be kept for `debug`, something like:

``` js
this.child.on('page', function(){                                                               
  log.apply(null, ['page-'+arguments[0]].concat(sliced(arguments,1)))                           
});
```

Re testing, the tests for ensuring `page` is handled are already there ([alert](https://github.com/segmentio/nightmare/blob/master/test/index.js#L688-L694), [prompt](https://github.com/segmentio/nightmare/blob/master/test/index.js#L704-L721), and [confirm](https://github.com/segmentio/nightmare/blob/master/test/index.js#L704-L721) are good examples), but simply test that the events are emitted from the child and not submitted to debug.  Testing debug output would probably require using a mock (like mockery).
  It seems like electron has suddenly become quite verbose, transmitting any small browser error for me to read in my node console. I think I must have performed a rebuild, because I don't recall seeing all these messages before:

`Renderer process started:` 

I see this every time the scraper goes to a new URL. Is this normal behavior? I recall seeing this message once when the scraper first initialized, but now I see it with every page change.

`[10800:1228/105431:ERROR:cookie_monster.cc(1742)] Found 1 duplicate cookies for host='....`

I never used to see these kind of messages. Actually I don't remember seeing many messages from Electron at all, previously. The scraper is still performing well, it's just quite noisy now.
Any tips on how to tone down the noise? Thanks!
 in `lib/nightmare.js` it appears the only messages being logged to the console directly are `uncaughtException`'s so unless you are using `DEBUG` there shouldn't be a ton of output. 

I'll update the README with a list of DEBUG flags for more targeted logging? 
 Interesting... I really have no idea what is causing the behavior. I
remember attempting to put my console into debug mode once upon a time,
does that state persist after closing powershell? Thanks for responding,
BTW.
On Jan 20, 2016 5:17 AM, "Evan Marsland" notifications@github.com wrote:

> in lib/nightmare.js it appears the only messages being logged to the
> console directly are uncaughtException's so unless you are using DEBUG
> there shouldn't be a ton of output.
> 
> I'll update the README with a list of DEBUG flags for more targeted
> logging?
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/419#issuecomment-173186573
> .
 Not 100% sure because I'm on OSX, but try:
`Get-ChildItem Env:`
in powershell and look for the `DEBUG` flag. 
 Here's an example of the errors that I didn't used to see until rebuilding:

![nightmarejserrors](https://cloud.githubusercontent.com/assets/8418137/13235833/73517546-d97d-11e5-98ef-4740b673a5ea.jpg)
 I hadn't explicitly set any conditions like this. It's possible they are
enabled in the nightmare package? I'm using v2.0.2. Thank you so much for
the link, I had been trying to find these flags.
On Apr 11, 2016 6:12 AM, "Ross Hinkley" notifications@github.com wrote:

> @kanethal https://github.com/kanethal Do you have
> ELECTRON_ENABLE_LOGGING set? It might be worth to check your environment
> variables against the Electron environment variable flags
> https://github.com/electron/electron/blob/master/docs/api/environment-variables.md
> .
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/419#issuecomment-208333064
 I'd be happy to try!
On Apr 11, 2016 6:29 AM, "Ross Hinkley" notifications@github.com wrote:

> @kanethal https://github.com/kanethal No problem!
> 
> As for them being enabled for 2.0.2, I don't think so. I don't see the
> same behavior. I'd be curious if you'd get the same behavior with a
> different version. Could you upgrade to 2.3.0 and run it again?
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/419#issuecomment-208342334
 Hi Ross, I believe there had been some semantic changes between the two
versions, and was going to have to reconfigure the scraping script and
haven't had time to focus on that. I'm sorry, I wish I had time to play
with it some more!
On Apr 23, 2016 5:33 PM, "Ross Hinkley" notifications@github.com wrote:

> @kanethal https://github.com/kanethal Did you have any luck with an
> upgrade?
> 
> â€”
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/419#issuecomment-213848706
  Was going through the documentation and noticed a missing #. Will come up with a better PR next time.
Cheers!
  Fix being able to construct nightmare with user defined paths. The electron method takes 2 arguments instead of 1.
 @matthewmueller is there any timeframe on when this fix will be released? I noticed it's not included in the latest NPM release.
  Hi,

Seems that there is an issue with the file runner.js when it run the statement require('browser-window').
I have tried several examples but I 'm always getting the same error.
I'm running this on windows 10 and my node environement works fine for other applications.

``` javascript
> node --version
v5.3.0
>
> cat .\package.json
{
  "name": "webautomation",
  "version": "1.0.0",
  "private": true,
  "description": "testing nightmare.js",
  "main": "main.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "dependencies": {
    "nightmare": "^2.1.2",
    "vo": "^1.0.3"
  },
  "author": "ECH",

  "license": "ISC"
}
>
> npm install
>
> npm ls electron-prebuilt
webautomation@1.0.0 D:\MyEnv\WebAutomation
â””â”€â”¬ nightmare@2.1.2

  â””â”€â”€ electron-prebuilt@0.35.4
>
> cat .\main.js
var Nightmare = require('nightmare');
console.log("require done");
dream = Nightmare();

dream.goto('http://yahoo.com');
dream.end();
>
> node main.js
creation done
module.js:338
    throw err;
    ^


Error: Cannot find module 'browser-window'
    at Function.Module._resolveFilename (module.js:336:15)
    at Function.Module._load (module.js:286:25)
    at Module.require (module.js:365:17)
    at require (module.js:384:17)
    at Object.<anonymous>    (D:\MyEnv\WebAutomation\node_modules\nightmare\lib\runner.js:6:21)
    at Module._compile (module.js:434:26)
    at Object.Module._extensions..js (module.js:452:10)
    at Module.load (module.js:355:32)
    at Function.Module._load (module.js:310:12)
    at Function.Module.runMain (module.js:475:10)
>
```

Can you help me to fix this issue ?

Thanks
 Hi matthew,

Do you mean that I should run the application differently than with : `node <myapp>` ?
 @erch Are you still experiencing this problem?
 @rosshinkley : thanks for the inquiry , I switched the project to my linux box and it works on it. I suppose that there was a issue with my windows node js installation.

Eric
  As I mentioned in #414, `type()` has an issue that `done()` is called before Electron actually fires an input event.
This is an limitation of Electron's API, but it causes populating a long text into an element to fail in a certain situation.

So this pull request add a `populate` action to provide a more reliable way to populate a text.
 As reported in #394, the new version of type() breaks backward compatibility, so for those applications where it's preferable to simply set the value, instead of sending keystrokes and potentially appending to an existing value, it would be good to have a supported method that works the way type() used to.

Workarounds of course include writing, rather verbosely,
`nightmare.evaluate(function(selector, value) { document.querySelector(selector).value = value; }, selector, value);`
(neglecting the focus/blur that I mentioned above)
  I found that `nightmare.type()` does not wait for actually finishing the typing since v2.1.0 (i.e. starting to use `sendInputEvent`), which causing populating a long text into an input element to fail in an certain situation.
I created a sample application to describe this issue:

https://github.com/nodaguti/nightmare-type-issue

In this app, `click('[type=submit]')` is executed before finishing to type a long message, resulting that only a partial message is submitted.

This issue is annoying especially when you test a login page or something like that because you have to put `wait(100)` before every `type()` actions to ensure the entire user ID and password are populated.

`type()` is still useful to trigger keyboard-related events like `keypress` properly, so I suggest adding another action `populate(selector, text)` to enter a text into an element synchronously by executing `element.value = text`.

I also created a pull request to implement `populate` action.
 Thanks for creating an issue for Electron about this problem!
Indeed the root of this issue lies `sendInputEvent` 's asynchoronous, so it's perfect if it is resolved on Electron side.
 >  I haven't been able to reproduce this issue on smaller bodies of text (yet)

i've had intermittent failures typing small chunks of text (email addresses) :/
 rad dude =)
 Glad it's not just me.  Rather than just a +1, I thought I'd share a workaround.

I often experience problems when using `type` back to back, where part of the first field's text is intermittently typed into the second field.  For example:

```
nightmare.type(".username", "username").type(".password", "password");
```

You can easily end up with fun stuff like a username set to `userna` and a password set to `mepassword`.  I found that adding a long enough `wait` call between two `type` calls avoids this for now.

Looking forward to the full fix, thanks in advance for following up.
  I want to send page down input events to the browser window to scroll down instead of scrollTo()

It seems that the keycode is 34, but should i use type() for this and not a special function?
  Closes #408 

Feel free to reject allowing `object` strings to be typed.
  Nightmare works fine when we start with...

```
xvfb-run node cnn.js
```

assuming cnn.js has....

```
    var Nightmare = require('../nightmare');
    var vo = require('vo');

    vo(run)(function(err, result) {
      if (err) throw err;
    });

    function *run() {
      var nightmare = Nightmare();
      var title = yield nightmare
        .goto('http://cnn.com')
        .evaluate(function() {
          return document.title;
        });
      console.log(title);
      yield nightmare.end();
    }
```

is there a way to write the whole code inside X Virtual Frame Buffer, so that we can execute in normal way

```
`node cnn.js` instead of `xvfb-run node cnn.js`
```
 You can use [headless](https://github.com/kesla/node-headless) to create xvfb child process for you. And get the screen id of background xvfb. Then set DISPLAY=:id to process.env. So that when you start nightmare program, it will find its screen automatically.
 Possible duplicate of #224.

I've had reasonable luck with running `Xvfb` on its own.  See [this comment](https://github.com/segmentio/nightmare/issues/224#issuecomment-141575361) for an example.
  Support [Chrome command line switches](https://github.com/atom/electron/blob/master/docs/api/chrome-command-line-switches.md) (e.g. proxy-server, ignore-certificate-errors).
 Hey, can we change proxies on the fly or just on the opening of nightmare?
 using proxy-server switch use http proxy,
how can I set it to sock proxy ?

Thanks
 This PR adds support for electron's [Chrome command line switches](https://github.com/electron/electron/blob/master/docs/api/chrome-command-line-switches.md). I haven't tried changing proxies on the fly nor use socks proxy so I can't really say that it works or not. Feel free to try them yourself and please don't forget to share how you did it if it works! ;)
 @catblade have you found how to change proxies on the fly? I'm going to open a issue for  that. @wiliame There is a way.  I'll get you a code snippet this evening.    @catblade thanks, I figured it out.

https://github.com/segmentio/nightmare/issues/908

I'm now trying to figure this other one:

https://github.com/electron/electron/issues/8089  ```
The last time you opened Electron, it unexpectedly quit while reopening windows.

Do you want to try to reopen its windows again?
```

Right now `.end()` force kills the process, and on OSX this makes the OS prompt you the next time you open it, asking if you meant to kill it and if you want to reopen the process again. I'm spinning up and closing down a ton of instance rapidly, so my OS after a while looks like this:

![](https://cldup.com/KVjMblaitc.png)

Each one of these is a lingering process that is only closed by clicking "no" - and eventually I get an ENFILE error because there are too many processes open.
 I think killing with a SIGHUP will fix this.

A temporary workaround:

```
defaults write NSQuitAlwaysKeepsWindows -bool false
defaults write com.apple.CrashReporter DialogType none
```
 I believe this was fixed in #487.  @contra can you verify?
 Can't confirm, not using it rn - will close though and if anybody else hits this we can reopen - thanks.
  if you spin up 10 nightmare processes, you get nasty console messages about an event emitter leak because 10+ listeners will be attached to process. this tells node everything is okay and we meant to do this.
 Any idea when this will make it in?

nvm: I had an old version.
  Hi!

I'm planning to use nightmare as the headless browser for my mockup generator: https://github.com/fabrik42/responsive_mockups/pull/6

However, I can not figure out how to use the Nightmare API without the `vo` lib with pure generator functions. I created this simplified code to show what I mean:

``` javascript
var Nightmare = require('nightmare');

var urls = [
  'http://google.com',
  'http://yahoo.com',
  'http://bing.com'
];

function *renderInNightmare(url, savePath) {
  yield Nightmare()
    .goto(url)
    .wait(100)
    .screenshot(savePath)
    .end();
}

function *batchProcessing() {
  for(var i = 0; i < urls.length; i++) {
    var url = urls[i];
    var savePath = __dirname + 'screenshot_' + i + '.png';
    yield *renderInNightmare(url, savePath);
  }
}

for(var result of batchProcessing()) {
  console.info('finished a screenshot...');
}
```

At the moment, this will spawn up three electron processes and they just seem to stay idle without ever finishing or taking the screenshot.

I'm not very familiar with generator functions in JavaScript, so I'm happy about every hint. :)
Am I missing something here?

Cheers,
Chris
 Hi Matthew,

thanks for the heads up - I think I got it now. :)

My code didn't work because Nightmare works asynchronously so it didn't make sense to return it as an argument of a yield statement.

Closing this ticket now, happy holidays!
  After opening one instance then in series loading 10,000 pages (sometimes it happens even lower, around 1000) this happens:

```
Nightmare runner error:

    Error: Uncaught, unspecified "error" event. ([object Object])
        at EventEmitter.emit (events.js:144:17)
        at EventEmitter.<anonymous> (/Users/contra/Projects/college-scrapers/node_modules/electron-prebuilt/dist/Electron.app/Contents/Resources/atom.asar/browser/api/lib/web-contents.js:85:27)
        at emitTwo (events.js:87:13)
        at EventEmitter.emit (events.js:172:7)
```

and the process crashes
 Solved the problem by reusing a new nightmare instance for each request, but the overhead on this is making everything quite a bit slower. I think this demonstrates that it's a leak in the nightmare instance that was loading 10K pages and not a leak in any of the other application code.
 FWIW, I was able to recreate this behavior, but even after sifting through the `DEBUG` data and peeking through Electron output, nothing really stood out.  This does smell of a memory issue, but `htop` data seems to disagree with that hypothesis.  I'll take another swing at that as time permits.

I also noticed (mostly by accident) if there is a network interruption, Nightmare seems to fail silently and will also produce this behavior.  Did you happen to have a networking issue?
 @rosshinkley I don't think it was ever fixed, I'm not using this for anything right now though.
 @rosshinkley Did you push a fix for the problem? I don't think it disappeared on its own. You said earlier you were able to reproduce it, is it still happening for you?
 Also getting this error. Don't seem to have any networking issues and I'd be surprised if it was a memory issue as I've got only a very basic script here. I can't see anything in the debug logs that's helpful, but just in case here's the end of it:

```
nightmare:log did-get-response-details +24ms [{"sender":{"id":1,"session":{"cookies":{},"protocol":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"will-navigate":[null,null],"destroyed":[null,null],"did-finish-load":[null],"did-fail-load":[null],"did-start-loading":[null,null],"did-stop-loading":[null,null],"did-get-response-details":[null],"dom-ready":[null]},"_eventsCount":27,"browserWindowOptions":{"waitTimeout":1000,"show":false,"alwaysOnTop":true,"webPreferences":{"preload":"/Users/Will/projects/learning/elm/elm-boilerplate/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://localhost:3000/browser-sync/socket.io/?EIO=3&transport=polling&t=LOtQm75&sid=L0syoNMMoE8eWY-FAAAl","http://localhost:3000/browser-sync/socket.io/?EIO=3&transport=polling&t=LOtQm75&sid=L0syoNMMoE8eWY-FAAAl",200,"GET","http://localhost:3000/",{"access-control-allow-origin":["*"],"connection":["keep-alive"],"content-length":["4"],"content-type":["application/octet-stream"],"date":["Fri, 29 Jul 2016 16:09:34 GMT"],"set-cookie":["io=L0syoNMMoE8eWY-FAAAl"]},"xhr"]
 into #new-todo +118msype()
 into #new-todo +1ms.type()
 into #new-todo +0ms.type()
 into #new-todo +0ms.type()
 into #new-todo +0ms.type()
 into #new-todo +1ms.type()
 into #new-todo +0ms.type()
 into #new-todo +0ms.type()
 into #new-todo +1ms.type()
 into #new-todo +0ms.type()
 into #new-todo +0ms.type()
 into #new-todo +0ms.type()
  nightmare:actions .click() on #todo-4 .toggle +59ms
  nightmare:actions .click() on #todo-8 .toggle +1ms
  nightmare:actions .click() on #todo-7 .toggle +0ms
  nightmare:actions .click() on #todo-6 .toggle +0ms
  nightmare:actions .click() on #todo-2 .toggle +1ms
    And I have completed 5 Todos
  nightmare queueing action "wait" +50ms
  nightmare queueing action "wait" +0ms
  nightmare queueing action "click" +0ms
  nightmare running +0ms
  nightmare:actions .wait() for 200ms +0ms
Nightmare runner error:

    Error: Uncaught, unspecified "error" event. ([object Object])
        at EventEmitter.emit (events.js:163:17)
        at EventEmitter.<anonymous> (/Users/Will/projects/learning/elm/elm-boilerplate/node_modules/electron-prebuilt/dist/Electron.app/Contents/Resources/electron.asar/browser/api/web-contents.js:156:13)
        at emitTwo (events.js:106:13)
        at EventEmitter.emit (events.js:191:7)
```

No idea why the logs of `into #new-todo +0ms.type()` are screwed up like that - maybe it's related?
 @rosshinkley Well, it's probably more than 100k requests total from the instance itself. I opened 10k requests, and each page probably had ~100 resources on it (CSS, JS, Images, etc.). You should try sending 100k requests to a more suitable test that doesn't load instantly to rule out race conditions (https://mail.google.com/ ?)
 @rosshinkley Understandable, try delaying the response from your server by a couple of seconds: `setTimeout(() => res.status(200).end(), 5000)`

I was 99% sure it had something to do with a race condition while waiting for requests to finish.

If you have a repo w/ your test case I can try to modify it to reproduce.
 @rosshinkley Don't think I've introduced any backspaces or non-character escapes myself, but I'll see if I can put together a minimal case to reproduce the weird logging.
  > # UPDATE
> 
>   I have found out that this is the same issue that #395 

Hi, I'm trying to run my code (it's very similar to the example code) and it's not working. When I launch my code with the show option to true, in the developers tools console shows up the next text:

```
Uncaught ReferenceError: __nightmare is not defined
```

Otherwise, it runs ok with the release 2.0.8. and release 2.0.9. ~~I'll check if code still working properly with the release 2.1.0~~. My code stops working with 2.1.0

You can reproduce the issue with this code:

``` javascript
'use strict';
var Nightmare = require('nightmare');
var vo = require('vo');

vo(run)(function(err, result){
  if (err) throw err;
  console.log(result);
});

function *run() {
  var nightmare = Nightmare({
    height: 700,
    width: 1280,
    show: true,
    "web-preferences": {
      partition: ""
    }
  });

  yield nightmare
    .goto('http://www.google.com/')
    .wait(400)
    .type('.gsfi:fist-child', 'hello world')
    .wait(20000);

  yield nightmare.end();
}
```
   I switched it to use activeElement and added a unit test.
  Fixes #394.
   Two methods, depending on what you need:
1. Use [`webPrefereces.partition`](https://github.com/atom/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions).  Example:

``` javascript
var nightmare = Nightmare({
   webPreferences:{
       partition: 'your-unique-partition-name'
   }
});
```
1. Use [`options.paths`](https://github.com/segmentio/nightmare#paths).  Example:

``` javascript
var nightmare = Nightmare({
   paths:{
       userData: '/path/to/your/data'
   }
});
```
 @rosshinkley Could the second method used to share session between different machines?
 @dingziran _Great_ question.  I'd suspect the answer to that is not a clear "yes" or "no" - it'd probably depend on how strict the site-in-question's security policy is and if it does any sort of request origin validation.

I'll put this one on the list, though.  It's probably worth a peek. :)
 @Velissel I took a minute to take another look at this.  Provided your instances share partition information, session information is shared across instances.

However, if you open an instance, log in, and open a second instance with the same persistence data before closing the first, the session information doesn't appear to be shared (or the data from the first session isn't persisted or shareable yet).  I'm still digging into that.
 Maybe related to https://github.com/electron/electron/issues/5673 ?
  I might be misunderstanding [this line](https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L297), my apologies beforehand if my expectation is off:

``` javascript
return done(new Error('.wait() timed out after '+self.optionWaitTimeout+'msec'));
```

This doesn't seem to throw an error/exception when using vo, example code below:

``` javascript
var Nightmare = require('nightmare'),
    vo = require('vo');


vo(function* () {
  var nightmare = Nightmare({
    show: process.env.SHOW_WINDOW || false,
    width: 1305,
    height: 800,
    waitTimeout: 1000 // we aren't going to wait this long unfortunately
  }), url;

  nightmare.goto('http://www.cnn.com')
    .wait(function(){
      return document.querySelector('.some-fake-selector');
    })
    .wait(1000); // give it an extra second, arbitrary time.

  url = yield nightmare.url();

  yield nightmare.end();

  return url;

})(function (err, result) {
  console.log(result, err);
  if (err) {
    console.error(err);
    return err;
  }

  console.log('Found url=%s', result);
});

```

For some odd reason, the path to `url = yield nightmare.url()` gets called instead of an exception being thrown.
 Are you missing a `yield` in front of the `nightmare.goto` line?
 @yoz The results are the same, a yield is only needed when you want to return the result. You could run the script in this incarnation as well and it will yield the same result:

``` javascript
var Nightmare = require('nightmare'),
    vo = require('vo');


vo(function* () {
  var nightmare = Nightmare({
    show: process.env.SHOW_WINDOW || false,
    width: 1305,
    height: 800,
    waitTimeout: 1000 // we aren't going to wait this long unfortunately
  }), url;

  yield nightmare.goto('http://www.cnn.com')
    .wait(function(){
      return document.querySelector('.some-fake-selector');
    })
    .wait(100);

  url = yield nightmare.url();

  yield nightmare.end();

  return url;

})(function (err, result) {
  console.log(result, err);
  if (err) {
    console.error(err);
    process.exit(1);
  }

  console.log('Found url=%s', result);
});
```

Output:

```
http://www.cnn.com/ null
Found url=http://www.cnn.com/
```

Now, when you remove the ending `wait(100)`, it does throw the exception but the process hangs without exiting:

```
undefined [Error: .wait() timed out after 1000msec]
[Error: .wait() timed out after 1000msec]
```
 Hi. It also occurred to me.
And this seems Electron's issue or design.

waitfn() in Nightmare will perform dom search javascript every 250ms.
But suddenly javascript stop responding.

```
  parent.on('javascript', function(src) {
renderer.once('response', function(event, response) {
  parent.emit('javascript', null, response);
});

renderer.once('error', function(event, error) {
  parent.emit('javascript', error);
});

renderer.once('log', function(event, args) {
  parent.emit.apply(parent, ['log'].concat(args));
});

win.webContents.executeJavaScript(src);
  });
```

This is not always happened but also specific page cause it.
when no javascript response come, i saw the logs that Electron dispatched messages

```
did-get-response-details
did-get-response-details
page-favicon-updated
did-stop-loading
did-frame-finish-load
did-get-response-details
did-get-response-details
```

Electron should dispatch "response" or "error". But after these message dispatched, never happened.
I guess this is electron's bug or design.

I'm keeping research what happened in electron.

If someone want to fix instantly. Just add long wait before .wait("#dom") to over that event
`.wait(10000)`
Or, use setTimeout your self.
  #372

``` javascript
new Nightmare({
    proxy: 'socks5://localhost:9050'
})
```
 Just bumped into this myself and thought it was better to support all Chrome command line switches rather than just `--proxy-server`. #410 
  I updated to 2.1.0. And after inject jquery.js. The console of electron print "Uncaught ReferenceError: __nightmare is not defined".
 @matthewmueller 
maybe it is not caused by inject
The below code will stop during the second yield. 
Ans also "Uncaught ReferenceError: __nightmare is not defined"

``` javascript

         var login_url="https://passport.weibo.cn/signin/login?entry=mweibo&res=wel&wm=3349&r=http%3A%2F%2Fm.weibo.cn%2F%3Fjumpfrom%3Dweibocom";
        var nightmare = Nightmare({
                show:true,
                waitTimeout:3000,
                "web-preferences":{
                    partition:"persissdfsdft"//+username
                }
            });
        if(nightmare.state==="initial") {
            yield nightmare.goto(login_url).wait(1000)
            yield nightmare
                //.inject("js", "jquery.js")
                //.wait(function () {
                //    return jQuery ? true : false;
                //})
                .click("#loginAction")
            console.log("jquery on");
        }
        yield nightmare
            .type("#loginName",username)
            .type("#loginPassword",password)
            .type("#loginVCode",captcha)
```
 I tried on an old machine which has installed nightmare 2.0.8. And it is working.
After delete nightmare folder and npm install. The same problem appear.
After npm install nightmare that will update to 2.1.0. Also show the same error.
Maybe it is because of electron-prebuilt?

I am using windows 10, node 4.2.
 also not work in ubuntu 14.04 desktop :''' (
 I find the problem. After delete web-preferences config. Everything is ok.

```
"web-preferences":{
                    partition:"persissdfsdft"//+username
                }
```

After some test, partition is not working anymore. Is that a bug?
 @dingziran @matthewmueller Matt you are right, it wasn't working for me and I renamed the web preferences and it did work. Thanks.
  After updating to nightmare@2.1.0 the way the `.type()` method works seems to have changed. In 2.0.9 and before, `.type()` would clear out the element and then enter the specified text, but after updating to 2.1.0, the specified text is typed in, but the existing text is not cleared out. Is this the desired outcome or a bug? If this is the desired behavior, is there a way to delete the text inside an element? With 2.0.9 I could just do `.type(selector, '')` to clear the text from an element, but now that will just add an empty string to the beginning of the value already there.
  Currently `nightmare` assumes that it will be running inside a normal `node.js` app so it ends using `child_process.spawn(/path/to/electron)` to do its job, what i'm proposing is support a way to execute `nightmare` inside a native electron app, without spawning anything just using it like a normal module.

this feature will let `nightmare` to be running with a workers manager module (something like [electron-workers](https://github.com/bjrmatos/electron-workers)) and do tasks in scale.

if you are ok i can implement this on my own and send a PR

what i would like is to discuss with you guys is how would you like to support this feature.

some options:
- a new option to the nigthmare constructor? (`Nightmare({ nativeElectronApp: true })`)
- detecting if `nightmare` is running inside `electron` via a run-time condition
 the important difference is that currently if i put nigthmare behind a node cluster it will mean that 1 task = 1 electron process (created by `nigthmare`), so if my application need to do 100 tasks in parallel it will mean creating 100 electron process.. there is no electron process re-use and there is the initial overhead of creating and electron process each time per task.

the advantage of [electron-workers](https://github.com/bjrmatos/electron-workers) is **that the logic for worker assignment lives in the electron process** by itself (using node cluster or another algorithm is just an implementation detail in electron-workers, so electron-workers is just an abstraction), if `nigthmare` can support running in a normal electron app, from a node app i can invoke a module with a worker abstraction (can be electron-workers or a custom node cluster script), inside the worker module i can **spawn an electron process with a electron script just one time** and re-use it for many tasks, in the electron script i can `require('nigthmare')` and using it normally, so if my node app need to do 100 tasks in parallel it will mean 1 task spawning the electron process, 99 tasks re-using the electron process created before.. just one electron process created per worker :)
 in other words.. with my use case in mind, there is no need for `nigthmare` to spawn an electron process per instance created, it could just create a browser window each time per instance (assuming that `nigthmare` will be running inside an electron app/script).

another advantage gained with `nigthmare` supporting this feature is that the developer can have control of the electron process by itself, so anyone can implement custom funcionality (#391, #373)
 > I don't see the node layer going away.

yes, that was not my intention :smile: just figure out how to make it run stand-alone.. let me experiment with a run-time condition (detecting if nigthmare is running inside a electron app) and see how it looks!
 +1 for this, although I'm not sure I''m totally following everything mentioned above.  It does seem like it's related to my use case which is that I'd like to build an Electron app that's a GUI for taking screenshots.  Being able to take many screenshots all at once (or in quick succession) which varying options.  
 Ideally you would detect and/or have options to specify that nightmare should spawn Electron process itself or that it is already running in an Electron process and use it natively.  

I want this functionality now where I have an app that runs as a service (node) as well as a UI (electron).
When running the UI, I will now have additional ram usage due to additional electron process, though I can't avoid the doubling up of electron-prebuilt directory.
 An issue with Nightmare not running inside Electron just became real.

I just realised that electron-packager builds an executor that won't accept an arbitrary script file on the command line e.g. 'electron index.js'  

This means it complicates create a package for an Electron app that utilises Nightmare.

I can work around this, but right now without custom packaging requires the packaged electron plus electron-prebuilt to be installed doubling up on disk usage.  Memory use is less of a concern.
 how's it going? 
 @bjrmatos hi there!
I just ran across a situation where I am required to have nightmare run inside an already executing electron application, and I noticed you said you might have experimented with this.

I was wondering if you had anything working/WIP that I could use as a base -- otherwise I am going to implement this shortly! Thanks! Nevermind! I managed to get nightmare to use the already running electron instance. Sorry for bugging you @bjrmatos. @Timer Could you share a link to how you managed to do that? I have an idea for a project that will need to do just that. (nightmare using electron instance) @yourfavorite I need to do some tweaking and I'll push it to my fork of nightmare. I broke the existing functionality of running within node and always assumed to not launch electron. Once I have the changes working for both use cases I'll drop a line on this thread. :) @yourfavorite see https://github.com/segmentio/nightmare/pull/967 ðŸ‘   It might also make sense to pass `parent`.  That would grant implementing custom actions in Nightmare with custom downstream actions in the Electron process.  Thoughts?

---

Pondering out loud: is there a reason to prefer using `require`?  If so, why does `action` not offer a `require` option?  Would the plugin paths be passed in with options, or added later?
 It would make more sense to implement #393 and let nigthmare focus on its main job
 inevitably, people will start to ask more and more features outside nightmare's job, it will be more easy to let nigthmare run as a electron module, and let developers do what they want with the electron process
 @matthewmueller did I misunderstand?  I thought the intent was passing paths to require over IPC (or possibly, as command-line arguments akin to `paths`) and requiring them in the electron process, not vice-versa.  No IPC serialization required.  Parent should then be passable.

I'll need to take another pass at this when I'm fresh and have coffee.  I'll try to carve out some time.
 @matthewmueller I should have been more specific, and the naming conventions are also probably not helping: in `runner`, `parent` is defined as the IPC process.

Re ideas for implementation (I still need to carve out time to experiment): how do you want them?  Should I make a branch on my fork and link to it, set up a PR with "proposal" in the header, or something else?  What would you prefer?

---

@bjrmatos I'm on board for having Nightmare be supported inside of Electron (#393), but I don't think you'd want to discard Nightmare as a node module.  (I would argue it's one of the bigger problems with using Phantom/Casper et al.  Usage from node is certainly possible, but a bigger pain.)  I agree that extensibility is currently an issue, but not an insurmountable one.
 @rosshinkley my intention never was to discard using `nigthmare` as a node module :smile: however for tasks in scale the current state of `nigthmare` is not very efficient, i'm just trying to support a way to run `nigthmare` that let me scale in other ways
  hi - I've found myself using with this pattern frequently:

``` javascript
yield nightmare
  .wait('.page-next')
  .click('.page-next')
```

How about we include this behavior by default in the click method? Either as is above, or if the overhead for the .wait() is too much it could only enter .wait() if it doesn't find it immediately.

As it currently stands when it doesn't find the element you get an error:

```
Cannot read property 'dispatchEvent' of null
```

Perhaps it also applies equally to some of the other methods too. ie.
- select
- check
- type
- mouseover
- mousedown
 The .click() above is not leading to another page in this case. Here's my scenario:
- single page application
- user clicks a button which switches the main view
- user is shown a spinner until the data is pulled down
- when we have the data the spinner is removed and the content rendered
  - it's at this point the `.page-next` button is shown

so it goes something like this in nightmare:

``` javascript
yield nightmare
  .click('.change-view')
  .wait('.page-next')
  .click('.page-next')
```

if i omit the `.wait(.page-next)` i get an error because the spinner is showing for a short duration before the button is shown.
  I've noticed that you're bundling `0.35.2` which includes additional options for `printToPDF`, including additional paper sizes like `letter`, `A5` etc. 

The current documentation points to an older version of Electron docs which do not show all possible settings. This PR updates the link to reference the docs specifically for `0.35.2`
  Hello people below is my code ...

```
    var Nightmare = require('nightmare');
    var vo = require('vo');
    var tags = [];
    vo(function* () {
      var nightmare = Nightmare({ show: true });
      var example = yield nightmare
        .goto('https://example.com')
        .type('#thesearchbox', 'film')
        .wait()
        .evaluate(function (tags) {

           $('#thesearchbox').keydown().delay(100000);
          //setTimeout(function(){ tags.push({url:$(".autocomplete").html()}) }, 10000);

          if($('ul.autocomplete li').length >= 1)
          {
              $('.autocomplete li').each(function(i)
              {

                tags.push({search:$(this).html()});
                //console.log("good");

              });
          } else{
            tags.push({url:"nothing"})
          }

          return tags;
        },tags);
      console.log(example);
       return res.json(example);
    })(function (err, result) {
      if (err) return console.log(err);
    });
```

It works fine by typing `film` inside seacrhbox. electron ui will also show `autocomplete` class ... but iam not able to fetch html contents within `autocomplete` .. is there any ways to fix this?
  Option naming of `BrowserWindow` was changed at Electron v0.35. (e.g. `max-width` -> `maxWidth`)

Documentation:
https://github.com/atom/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions
 @matthewmueller Thanks!
  mocha-generators is now required in `test/index.js` explicitly.
  I added `electronPath` option to options of `Nightmare()`.

I added this because I want to use Nightmare for end-to-end Electron app testing (e.g. Nightmare uses Electron v0.35.2 but my app uses new API introduced on Electron v0.35.4).  Nightmare now fixes Electron version.  I agree that it's reasonable bacause Nightmare can't support all versions of Electron.  So I added notation to document.
  Allow users to automatically accept, automatically ignore, or handle downloads on a per-case basis. Fixes #332 and #371 with the addition of the `ignoreDownloads` option, should fix #151 with the `download` event and the various ways that can be used.
 I reviewed it and tested it. It works great. Thank you so much for doing this.
 Firstly - awesome library and great pull request.
I wanted to share a scenario where I am logged in with a session and need to click on a button that runs some javascript that POSTS a form with a unique URL and data set and can only be requested once (each submission creates a new ID at the end of the URL so cannot be replayed).
The response is a download attachment (Content-Disposition: attachment).

I need to get get the response attachment somehow - an API would allow for that. Currently I haven't figured out how to do this.

Thanks
 @matthewmueller Thank you for your reply, and I'm sorry I couldn't get back to this sooner.  Also, apologies in advance for the missive.  Responding to your feedback:

> By default ignore all downloads

Seems reasonable to me.  I can do that as time permits.

> If someone wants to download something, provide nightmare.download(selector|url) which returns a buffer. if a buffer is not possible, support path in the signature to write to a file.

I don't understand what you're asking, what should the selector provided do?  Click?  As for providing a URL, would that be a simple get?  And with the buffer, no, I don't think that is possible.  Electron supplies the filepath and a method to override the filepath.

> When we are downloading something, wait until that download is complete in order to resume.

Blocking on each download isn't how browsers work.  From a test automation standpoint, I can certainly understand the need, but from a purely automation standpoint, I'm not sure I agree.

> Potentially support progress events via nightmare.on('progress', fn) if that's supported

Yes, that's supported (and can be supported with the reduced API).

Re: getting away with a simple request: no, I don't think you want to do that.  If you're making an authenticated request for a resource (thinking of something like a request to a private link in say, Dropbox), you want to do that from within the context of Electron.  Copying the resource URI and issuing a plain GET will almost certainly result in failure.  This (I think, and I'm sorry if I'm misreading here) gets to what @subcontact's problem - authenticated downloads won't work with simple requests.

Re: keeping at least some form of downloads in core, that's a _great_ question.  My answer to that would be a qualified no.  How downloads are handled is probably going to be dependent on use case.  To that end, I think the blocking `.download()` and the non-blocking methods in this PR should be broken out into at least one (probably two?) plugins.  

The problem with that is binding to `will-download`.  A new method to hook into `will-download` with a custom handler could be exposed, or (with modification to pass a child handler) the custom event bindings in #367 could be used.  Thoughts?

I'm willing to reduce the API as requested, and if you think it's a good idea, I will close this PR and open a fresh one with those changes.
 @matthewmueller no problem. :)  Thanks for yours as well!

Tying up some loose ends:

> I was proposing this to handle `wait('downloads-complete')` piece that you added in this PR. Haven't investigated how that would work internally though.

Yeah, I understand the need, and also buy `.wait('downloads-complete')` is problematic.  Totally off the cuff: I think that enforcing one download per `.download()` call would probably work.  It would consist of (more or less) how it works now, but with an extra wait for `will-download` to be caught, and the internal method using the wait-download function.

> From my understanding, a POST request triggers the download, so whether this is a plugin or not, we'd need to at least know how to do that with core.

I was more concerned with the "authenticated" part, not with that it was triggered on POST.  I don't _think_ it should matter.  Electron doesn't seem to care what triggered a download, just that one happens.  That being said, it's probably worth propping up a minimal test case to be certain.

> Yah, I agree [to plugins].

The more I think about this, the more sense it makes, and maybe should redirect my attention to #391.  I was thinking about how to extend the Electron process earlier today, because, well...

> Seems like it would be as simple as: `win.webContents.session.on('will-download', forward('will-download'))`

Handling this appropriately seems to require doing some special steps in the Electron process.  In tinkering with `.on('will-download', fn)`, as soon as the `DownloadItem` fell out of the handler scope, Electron would execute whatever behavior had been defined by synchronous completion (almost like the `on` handler is more like middleware, if that makes sense).  The [Electron docs for `setSavePath`](https://github.com/atom/electron/blob/master/docs/api/download-item.md#downloaditemsetsavepathpath) seem to support what I found by experimentation:

> The API is only available in session's will-download callback function. If user doesn't set the save path via the API, Electron will use the original routine to determine the save path(Usually prompts a save dialog).

In other words, trying to do something via event communication would (almost) certainly result in a blocking download dialog.

I think I'm going to close this PR, backburner the download plugins for the moment, and direct my remaining questions to #391 as I think they're more sensible under that topic.  
 @rosshinkley since the merge of this PR seems to be on hold. would you be able to provide some example to download a file using the internals? Sorry, I am new to both electron and nightmare
 @AspireToCodeBetter TL;DR: At present, you'd have to fork Nightmare and roll your own.

There is currently work being done to add extensions to the Electron process that Nightmare wraps (#391), one of the benefits of this being the ability to attach a handler to `will-download`.  The reason this PR was ultimately closed is because there are several use-cases for `will-download`, leading me to believe they should be broken out into plugins to be used with (as of this writing, incomplete) extending Electron.

When #391 is complete, I'll see to it that the download plugins are completed and put on NPM, and  certainly post a link on this thread and possibly on a few others (#151 and #371 come to mind).
  Hi guys,

Just having an issue with `type` function.
In my code I call 
`yield night.type('div.card__body > input.field-metric', '50000')` 
which is meant to trigger a onChange callback and update some value in an object.
It works perfectly when I fill manually my input on Chrome but when I run tests with nightmarejs value is never updated.

We found a temp fix which is 

```
nightmare.action('type', function(selector, text, done) {
    this.evaluate_now(function(selector, text) {
        const elem = document.querySelector(selector);
        elem.focus();
        elem.value = text;
        elem.blur();
        elem.dispatchEvent(new Event('input', { bubbles: true }));
    }, done, selector, text);
});
```

But we thought it might be a issue you want to have a look into on your side.

Cheers.
 +1
  This fixes the typo.
  The new actions feature is great, but we need to be able to pass in arguments to the callback
so we can do something like this:

``` js
Nightmare.action('evaluValue', function*(done, value, cb) {
  var test = yield this.evaluate(cb);
  assert.strictEqual(test, value, 'evaluValue() ' + errorMessageHelper(value, cb));
  done();
});
```
 no sorry didnt tried that, though done is the first arg, this works indeed. can you help me out with this code here? thanks

``` js
var url = 'http://google.com';
Nightmare.action('googleto', function(page, done) {
  this.goto(url + page);
  return done();
});

var t = yield Nightmare().googleto('/').evaluate(function(){
  document.querySelector('a').click();
}).title()
console.log(t);

```
 this example just hangs (white screen in electron) in the air an doesn't go to the google page, the callback function of vo is never called

```
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function* () {
  var url = 'http://google.com';
  Nightmare.action('googleto', function(page, done) {
    this.goto(url + page);
    return done();
  });

  return yield Nightmare({show: true}).googleto('/').title();
})(function (err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```

this code works as expected and writes 'Google' to the bash

```
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function* () {
  var url = 'http://google.com';
  return yield Nightmare({show: true}).goto(url).title();
})(function (err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```
 The `DEBUG` output from above yields a clue:

```
nightmare queueing action "googleto" +0ms
nightmare queueing action "title" +5ms
nightmare running +3ms
nightmare queueing action "goto" for http://google.com/ +607ms
nightmare:actions .title() getting it +4ms
```

From that, it looks like the title action would happen _before_ the goto, which would certainly cause problems.  Actions that add other actions would enqueue them after the last action in the chain.  Consider the following:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function * () {
  var url = 'http://google.com';
  Nightmare.action('googleto', function(page, done) {
    this.goto(url + page);
    return done();
  });


  var nightmare = Nightmare({
      show: true
    });
    yield nightmare.googleto('/');

  return yield nightmare.title();
})(function(err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```

This will (misleadingly) work: `.googleto()` is the last action in the first chain, and as a side effect, will run the internal `.goto()` enqueued by `.googleto()` before the next nightmare chain.

I don't think that `.action()` is intended to execute other internal actions, and in this case, I think `.use()` may be more appropriate.  Something like:

``` js
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function * () {

  var url = 'http://google.com';
  var googleto = function(page){
    return function(nightmare){
      nightmare.goto(url + page);
    };
  };

  var nightmare = new Nightmare({show:true});

  var title = yield nightmare
    .use(googleto('/'))
    .title();

  yield nightmare.end();

  return title;
})(function(err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```

... might yield better results.
 The documentation on this is extremely sparse. 

For anyone else who finds this, the way to pass arguments to an action is to pass additional arguments to child.call, like this:

```
var path = require('path');
var Nightmare = require('nightmare');

//define a new Nightmare action named "foo"
Nightmare.action('foo',

    // This task runs in the remote process
    function (name, options, parent, win, renderer, done) {
        parent.respondTo('foo',
            function (args, done) { // <---- See args 
                // Do whatever with args here...
                done();
            });
        done();
    },

    // use the IPC child's `call` to call the action added to the Electron instance
    function (args, done) {
        this.child.call('foo"', args, done); // <--- Args passed in
    });

    ...

    var nightmare = Nightmare();
    nightmare
        .goto('http://www.google.com")
        .foo({ some: 'value' })
        .then(function () { nightmare.end(); }, function (error) { console.log(error); });
```
 I agree with @shadowmint; there definitely needs to be more documentation for passing parameters to custom actions. There's almost nothing in the documentation that I could find, and the actual way you need to do it is not super intuitive - a bad combination.

**Edit:** Also, I just found this which is helpful for passing parameters with non-electron actions: https://github.com/rosshinkley/nightmare-examples/blob/master/docs/beginner/action.md  (Thanks, Ross!) Should be a link to that from the main docs I reckon.    ```
app.dock.hide()
```
 I've sent a PR to uncomment this out: https://github.com/segmentio/nightmare/pull/426
 @matthewmueller I just implemented a `showDock` option: https://github.com/segmentio/nightmare/pull/441
 @matthewmueller BTW, is there an existing issue to specifically tackle the open electron processes problem when an error occurs? I'd love to collaborate on that one.
 @jviotti #409 is _somewhat_ related, is that what you had in mind?
   :+1: I'm also seeing this.
 Cool :+1: 
 Also seeing this :rotating_light: When a page fails to load it just hangs forever and never calls waitTimeout
 Also seeing this.
 also see this hang forever for own my negative tests(On Mac OS Captian EI + 2.3.2 release), when wait a _non-exist element on page_ or wait a _function which does not return true condition_ (BTW Page load has already done), 
Please let me know if need my help on reproducing this issue.
 Hi, @rosshinkley , your case works fine from my side too, but my test pages is not kind of different with yours :)
my page will load the page content async(like SPA application), so if i write wait method like following, it will hang forever:

``` javascript
var Nightmare = require('nightmare'),
  nightmare = Nightmare({waitTimeout: 10000, show: true, openDevTools: false});

  nightmare.goto('https://www.stubhub.com/')
    .wait('.event-title123') //this element does not exist..
    .end()
    .then(function(){
      console.log('done');
    })
    .catch(function(err){
      console.dir(err);
    });
```

however, if i hard-wait for the page loaded complete, then the wait() works fine until it timedout(10 seconds in my case)

``` javascript
var Nightmare = require('nightmare'),
  nightmare = Nightmare({waitTimeout: 10000, show: true, openDevTools: false});

  nightmare.goto('https://www.stubhub.com/')
    .wait(5000) // wait for enough time until page load completely
    .wait('.event-title123') //this element does not exist..
    .end()
    .then(function(){
      console.log('done');
    })
    .catch(function(err){
      console.dir(err);
    });
```

Seems, nightmare API does not support SPA properly(wait for a element created after Dom content loaded event). Hope this case helps for your further analysis. just let me know if you need any info.

Thanks!
 @rosshinkley , Thanks for your info , is that possible to be an issue with Electron? hack way may not elegant, but once you have more insights, please let us know :)
 Thanks @rosshinkley for all your effort and investigation! then we need to wait for Electron permanent fixes. 
 just saw electron/electron#5183 has been closed, which is awesome, looking forward to integrate with Nightmare release and kick off a regression test!! :)
 Well, Electron has to ship, first ;)  Hopefully soon!
 they are pretty good team to get things resolved fast, and thank you @Mr0grog and @rosshinkley for chasing them :)
 Good news, i saw the new electron-0.37.7 has been released, with this electron/electron#5183 fix, change log: https://github.com/electron/electron/releases/tag/v0.37.7

hope we can release nightmare soon with  electron-0.37.7 build ðŸ‘ 
 verified, ðŸ‘ 
  This takes care of @yoz's question from PR #365 regarding `confirm` and `prompt`: by default, they will both emit their respective events and throw an exception.  This prevents unwanted behavior on the page (eg, by prompt/confirm returning default values), as well as prevents Nightmare from hanging on modal dialogs.

This also is a partial answer to my question #366.  Rather than overriding the Nightmare preload, the internal preload script can now be added to with the same `options['web-preferences'].preload` option.  This allows for overriding the above exception behavior if it is not desirable, as well as opens up user-defined preload actions should they be needed.

Thoughts?
 @matthewmueller Ah, yeah, grouping them makes a lot of sense.  I'll pull that together as time permits.

As for overwriting the preload: the template-generated preload would be overwritten every time.  The template is internal to Nightmare.  As such, the internal changes to preload should be picked up if any are made.  Ultimately, what I am reaching for is the default exception behavior for prompt and confirm may be (probably is?) undesirable, and there should be a way to override it.  Maybe I'm not following what you're asking?

As for specific use cases: the only one I know of offhand is what @yoz ran into with `alert` - if you have a prompt or confirm an event that fires _before_ an `inject`/`evaluate` can run.  This gets back to overriding the default exception behavior - I'd imagine you'd want to overwrite it to handle dialogs with valid responses.  Does this make sense?
 @matthewmueller I may have gotten a _bit_ overzealous (and these changes almost certainly step on #337's logging changes), but I've grouped all of the page-\* events into one unified event.  I also tried to update the documentation to be clear-ish on what to expect with `on('page', type ...` using the jsdoc-like format.  (Offtopic, is there a documentation standard to follow?  Is this tangentially related to #364?)

Thoughts?
 @matthewmueller thank you. :)  Responding to your questions:
1. Yeah, the other reason I went the templated route was because of precedent, but regardless, this is a good question.  Spitballing an idea off the top of my head: could the internal preload script be in its own file, read off disk, have the `{{!src}}` token spliced in, and have that be used in the place of `exports.preload`?  That would let both the user-defined preload and internal preload be real first-class javascript files, complete with syntax highlighting.  (There are probably less ugly, less fragile variants of this, like having the token in a comment or something.  The chosen solution might be able to be adapted for the other templates.  Would that worth pursuing in a separate PR?)
2. Thinking about this with a little distance, I could have probably simply used `require` to pull in the user-defined preload, and pass the IPC to it that way.  Should the token then be changed to something like `require('{{!userPreloadFilepath}}')(__nightmare.ipc);`?  I'm almost positive the path would _have_ to be absolute, and the documentation should reflect that.  This also may help solve the token issues from your first question if the require had a dummy file to require by default.  Thoughts?
 @matthewmueller This was an itch I had to scratch: I went ahead and pulled together the `require` approach described above.  Is this close to what you had in mind?
 By the by, back to the earlier topic of use cases: Providing custom preload scripts should let you prevent elements from rendering on a page, and as such, I think this should provide a way to fix #373.
 Yeah, I understand what you did in your PR.  I would have preferred skipping the user having to include the IPC themselves, but what you did works just fine too. :)  Thanks!
  How can I prevent loading the Google Analytics when I scrape page with nightmare.js?
 @matthewmueller I expected a more elegant solution, eg blocking scripts loading by domain or hostname, this way works in PhantomJS.
 Hi @matthewmueller ,

I am not really sure the issue that I create a custom preload script to capture alert message. Actually I follow the site that you provided, but no chance.

```
VM106:3 Uncaught TypeError: Cannot read property 'nightmare' of undefined
javascript @ VM106:3
(anonymous function) @ VM106:38
electron.ipcRenderer.on @ init.js:51
emitMany @ events.js:127
emit @ events.js:201
 ```


 source code is quite simple:
```
var Nightmare = require('nightmare'),
  nightmare = Nightmare({
    openDevTools: {
      mode:'detach'
    },
  show: true,
  webPreferences: {
        devTools: true,
        preload: 'alertMessage.js',
        nodeIntegration: false,
        webSecurity: false,
        allowRunningInsecureContent: true
      }
});
  
nightmare.useragent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3015.0 Safari/537.36');

nightmare.goto('http://www.google.com')
  .then(function() {
	return nightmare.url();  
  })
  .then(u => {
	  console.log('The url is: ' + u);
  });
```

And alertMessage.js (follows the instructions of the site), has not done anything:
```
window.__nightmare = {};
__nightmare.ipc = require('electron').ipcRenderer
```  Hi I was using the nightmare the one that was using phantomjs and there I can set proxy by passing proxy: 'username:password@host:port'. Question is there any available option for this now? I tried to set it in runner.js like this "win.webContents.session.setProxy(config, callback)"  but it's throw an unexpected error. So can someone tell how I should do that?
 @hovosanoyan #410 will let you set proxy settings, etc. through [Chrome's command line switches](https://github.com/segmentio/nightmare#switches). Hope it helps!
 I leaved that for now but will check it later anyway thank you very much.
  When I `goto` a web page containing `iframe` with a pdf, save file dialog pops up blocking the process. I've found out that it is possible to resolve that by adding `will-download` listener to `webContents.session` of `BrowserWindow` as described [here](https://github.com/atom/electron/issues/3142). Would it be desirable to extend Nightmare's API to support this usecase? If yes then would sth like that be fine?

```
nightmare.session.on('will-download', handler);
```

If that's acceptable then I could submit PR
 @fmaruki, @darthcloud and myself touched on this in #332.  I didn't pull together a PR because I wasn't too keen on polluting options with download rules and I was/I am _pretty_ certain my implementation and approach were not good.  Since then, I haven't set aside time to take a second (hopefully longer) look.

Adding an event handler in this way might work.  It side-steps the immediate action problem, and offloads responsibility for cleanup and multiple downloads to the user, which simplifies things.

Thoughts?
 Is there any other way we can automate pages containing iframes with pdf content? I don't even want to download it, I just don't want it to get in my way by displaying blocking system window.

Would it be acceptable to just hardcode `will-download` event prevention in Nightmare?

Is it of any use to display blocking system dialog in context of browser automation? If yes then is there any way to interact with it in automated way?
 While I understand the temptation to discard/ignore downloads, I don't think that is a particularly good approach.  If Nightmare is being used for scripting, it is possible that the downloaded file will help determine what steps to take after the download (eg, with integration testing).  I suppose Nightmare could simply accept every download, but that also seems like an unpleasant option.

Answering your second question: From within browser automation, no, modal system dialogs are not useful and cause problems.  For example, `alert`, `confirm`, and `prompt` cause Nightmare to hang just like with download prompts.  (For what it's worth, some work has been done to address those three, and for more information, see #359, #365, #366 and #374.)

Answering your third question: from within Electron, you can either cancel the download or set the download path within the `will-download` handler.  This is functionally the same as interacting with the download dialog and will prevent one from showing.
 Thank you for your time @rosshinkley. Unfortunately it means that I will either have to switch to barebone Electron or deal with this issue in forked Nightmare. It would be nice to know if there is some long term plan to support those usecases or if the idea is not even considered to be included in Nightmare's source.
 @pkawiak no problem.  I can't imagine this particular issue is going away as there are already a couple of other open download questions akin to this one.  Plus, willfully not supporting a common browser activity would be sort of silly.

As for inclusion, I'm sure a PR to take care of the obvious download cases would be welcome.
 OK then during weekend I'll try to put together PR with following API:

```
nightmare.session.on('will-download', handler);
```
 @pkawiak I didn't mean to step on your toes, but I've put together (a hopefully reasonable?) PR #382 to handle downloads.  I'd like to get your feedback. :)
  It makes the TODO in the scroll test done.
  For test passing on small screen resolution.
Because on some platforms electron can not set initial viewport size more than screen resolution.
  Adds a headers() method to override headers for all requests from that instance of nightmare.

``` javascript
yield nightmare
  .headers({ 'X-Nightmare-Header': 'hello world' })
  .goto('localhost:3000/');
```

And adds an optional param to goto(), specifying headers to use for that specific request:

``` javascript
yield nightmare
  .goto('localhost:3000/', { 'X-Nightmare-Header': 'hello world' });
```

Fixes #325 
 Sure, I can do that. :) Are you ok with leaving goto's optional headers param as-is?

And any reason for preferring a singular `nightmare.header` as opposed to the original `nightmare.headers` available in Nightmare 1.x? Just trying to keep it more consistent with node's https://nodejs.org/docs/v0.4.0/api/http.html#response.setHeader ?
 @matthewmueller Sounds good, updated!
  Adds ability to add custom events that can be emitted with `ipc.send` from `evaluate` or `inject`.  Fixes #354.
 I follow and agree.  I will make the update as time permits. :)
 @matthewmueller I have a couple of questions for you.  One, is it acceptable that `.bind()` accepts _only_ a name, and not data (like say, jQuery's bind)?  Two, `.unbind()` removes all of the named event listeners, introducing the (probably wrong) assumption that unbinding a custom event should remove all of the child process listeners for that name.

Is this closer to what you had in mind?  Thoughts?
 @matthewmueller Sure, making the event handler an option in the function call, or having `unbind` remove the parent listener makes sense.  It's also probably worth pointing out that I don't think you can fully wall this off from `.on()` - the ad hoc events will still be listenable. In other words,

``` javascript
nightmare
    .on('some-custom-event', handler)
    .bind('some-custom-event')
```

... should still be valid, if a bit misleading.  Alternatively, and for completeness,

``` javascript
nightmare
    .on('some-custom-event', handler)
    .bind('some-custom-event', function(){
        //custom event handler
    })
```

... would also still call the handler from `.on()` when `some-custom-event` is emitted.

It's also probably worth noting that I don't think you can remove an `.on()` handler, either - is there a helper to remove a listener from `child`?

Are you suggesting making the handler function for `.bind()` mandatory?  I'm not so certain about that, but I can't think of a compelling counterargument.

---

What I was a _bit_ more concerned about - and I'm sorry I wasn't terrifically clear - was what happens when you call `.unbind()` down to the child process (in `runner.js`).  I wrote it such that the Electron `.unbind()` listener would scrub all listeners with that name from the renderer, effectively removing that event from being emittable.  This is owing to the handler in the renderer's `.on('some-custom-event', fn)` not being unique and also not being scoped outside of `bind`.

This also raises another question: can more than one event emitter per name be added and bound?  Is there a use case for having multiple custom event emitters of the same event name?  Would it be worth enforcing a rule that one and only one custom emitter could be added per name?

I'm still not sure I'm being clear.  Let me know if you have questions.
 @matthewmueller I've gone ahead and put in the optional handlers for custom events.  

I've added enforcement of only one child emitter per name.  This prevents situations where custom events can have more than one emitter.  (This also clears up my question from above.)

I've also added some extra logic around how `unbind` works: `.unbind('sample-event')` will remove the event listeners on the parent and the child emitter, where `.unbind('sample-event', handler)` will remove the handler on the parent and the emitter on the child if it is the last handler.  I'm not _real_ confident in the last parent listener removal logic also removing the child emitter.  It's nice the event cleanup is there, but I worry it might be unexpected behavior.  What do you think?
 Closing this PR.  I will break this out into a plugin pending the outcome of #425 and #391.
  Sets up the `page-alert` event for alerts, preventing alerts from blocking the process.  Should fix #359.  Thoughts? /cc @yoz 
 Works great, thanks for the quick update!
 P.S. window.confirm and window.prompt may also benefit from something like this, although those are more complex because they have to return a value. See for example
http://stackoverflow.com/questions/33520361/nightmarejs-to-click-the-window-confirms-button
 @yoz I thought about this when I was going through this last night, and decided that I'd address your immediate problem first.  I'm planning to look at confirm and prompt as time permits.
  scrollToSelector function + test + readme
 Good point, thank you! Maybe I also should do it in #358, how do you think?
 It won't breaks the API if we will check argument type.

UPD. Ok, now it will :)
 @matthewmueller Please take a look.
 Dear, @rosshinkley just wondering is there any reason for this PR's to still be awaiting merge?

Thanks you! :)
  scrollToSelector function + test + readme
 Sorry about the mess with the commits. I'll clean this and prepare new PR.
  sendInputEvent wasn't implemented in Electron 0.33 so I bumped the dependency, tests seem ok. Happy to add a test for sendInputEvent if needed.
 Hi @matthewmueller - I'm currently using it to implement drag and drop as well. (I've made an action which can drag and drop from/to page pixel positions, and you can also pass DOM selectors or functions to evaluate in the page context for it to determine those positions).

Internally it uses mouseDown/Move/Up and could also use touchStart/Move/End for mobile simulation.

I'd like to contribute that as I think it could be useful generally. Any thoughts? It would be easy to port without a public sendInputEvent action anyway.

Also just on the upgrade side you'll notice some deprecation warnings with the new Electron which I haven't looked into.

Cheers,
Andrew
 Agreed on the plugin, let's move discussion to #336 
 Hi @inversion, I stumbled over this issue since I also need some drag and drop functionality. Have you released anything in that direction? Maybe a drag and drop action/plugin?
 Hi @maxfriedmann - I haven't got anything released for it yet, but the approach I took is basically sending the input events `mouseDown mouseMove (several) mouseUp`. The issues to consider are finding the start and end co-ordinates, choosing where to pick up the element and where to drop it (e.g. if you are trying to drop something that needs to be entirely in a target area, or if there are other target areas adjacent which can be mistakenly dropped into.
  screenshotSelector function (with test and readme)
 I was working on the same feature and was about to push it when I saw your PR. This is a much needed feature, I hope it will be merged soon. Thank you @Kreozot for your work!

FYI here's my own implementation: 

``` js
exports.captureSelection = function (path, selector, done) {
  debug('.captureSelection()');
  var self = this;
  this.evaluate(function (selector, clip) {
    var element = document.querySelector(selector);
    if (element) {
      var rect = element.getBoundingClientRect();
      return {
        x: rect.left,
        y: rect.top,
        width: rect.width,
        height: rect.height
      };
    }
    return false;
  }, selector)
    .then(function (clip) {
      if (clip) {
        self.child.once('screenshot', function (img) {
          var buf = new Buffer(img.data);
          debug('.captureSelection() captured with length %s', buf.length);
          fs.writeFile(path, buf, done);
        });
        self.child.emit('screenshot', path, clip);
      }
    }, function (err) {
      console.log(err);
    });
};
```

But your solution seems at least as good
 Thanks. In my implementation I also used Math.round function because clip parameters must be integer but getBoundingClientRect can return decimal values.
 Nice catch, I was having an issue making Electron crash and adding Math.round solved it
 It would be nice to add an optional parameter which would give more control to the developer on the way screenshot are taken. What I'm thinking about is:

``` javascript
{
  offsetX: 0,         // horizontal distance from the top left corner of the selection
  offsetY: 0,         // vertical distance from the top left corner
  width: 'selection', // force the width instead of using selection's width
  height: 'selection' // force the height
}
```

If you can think of any other options, I'd be glad to talk about them with you
 I think this is redundant. You can not guess all use cases. I think all individual use cases must be implemented outside this function.
First time I've wanted to add scroll functionality to this function (to prevent cases when selection is outside visible area), but then I've decided to keep it clean ([YAGNI](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it) principle)
 Scroll functionality is another thing, it should be done outside of this function, I totally agree with this. In fact I had a use case for those options (taking the same screenshot at different times to catch visual regressions) but I can go without them as well, it's not a problem for me
 I think scroll is needed for this function. Otherwise you could call the function and get a screenshot of the wrong section of the page.

I don't think the user should have to think about manually scrolling before calling this function.

If you want to keep it clean maybe create a separate function such as scrollToElement which is called internally by captureSelection.

For extra points you could get it to scroll back to the pervious position after the screenshot was taken.

Something like this inside of eval should do it.

``` javascript
window.scrollTo(Math.round(rect.left), Math.round(rect.top));
```

You just need to remember that scrolling is not instantaneous and you might need to wait a little bit before taking the screenshot.
 I find it hard to think of a use case where it's necessary to take a snapshot of a selector without scrolling there. I think most use cases that require a snapshot of a selector is because they want an image of the content of that selector. You can't get that without scrolling first. 
What do you think guys? I think that's a more sensible use case.
 I still think that it should be done manually before calling `screenshotSelector`. Maybe it would be interesting to implement a similar `scrollToSelector` function, because of two things:
- a function should focus on doing only one thing and doing it well ;
- what if the user doesn't want to scroll to the element before capturing the screenshot? there might be use cases for that
 @yhuard :+1: 
scrollToSelector PR is coming
 If you call screenshotSelector('header') and you have scrolled to the bottom of the page you will get a screenshot but it will be of the wrong thing.

I can not think of a use case where you say give me a screenshot of an element but bring me back a screenshot thats the same size as that element but not really of that element.

I agree with concept of a function having to do one thing and doing it well.

I would then suggest having the following functions.
1. getSelectorRect
2. scrollTo (which already exists) / scrollToSelector
3. screenshot (with rect as a parameter which exists already)

then a wrapper for these 3 functions called screenshotSelector.

Then if you want an additional function for scrolling to a selector you can call the getSelectorRect and use it in conjunction with scrollTo.

But it still really confusing if you call screenshotElement and getting a random screenshot back.
 +1 for @sepehrs' suggestion: `screenshotSelector` should not violate the principle of least surprise.  If you ask for a picture of a specific element, you should get a shot of the whole element.  I completely agree with splitting the underlying functionality into their own functions, then having `screenshotSelector` be a wrapper for those functions

That being said, there are corner cases that I have mixed feelings about.  For example, taking a complete screenshot when the body is longer or wider than the viewport rectangle (as with #328) - should `screenshotSelector` take this into account and resize the viewport automatically, putting it back upon screenshot completion?  Thoughts?
 @rosshinkley I've already thought of that and ended up thinking that resizing the viewport is dangerous: it can have side effects that the user didn't expect. For example, if an element is too big for, let's say, a medium screen but is hidden on large screen and we apply the resizing, the element may disappear. 

We define the viewport at beginning because we want to test the rendering with that viewport. If the screenshot cuts the element we capture, it's actually a good indicator that something's wrong with our style!
 I wasn't actually talking about reszing the viewport. In my opinion there is no need for that since you would want to see how the element would look on the device (viewport) you have selected.

I still don't see any problems with scrolling to the element.
 Just created PR with scrollToSelector function: #363
 @yhuard @sepehrs Like I said, I had mixed (and admittedly, mostly negative) feelings about resizing the viewport.  I agree that it's not a great idea, but mileage may vary with elements that extend beyond the viewport.
 @rosshinkley the reason i didn't mind to much about the reszing of the viewport is the point @yhuard made about css selector but also a genuine use case could be that you want to see how the element looks on a specific device. if for example you are taking a screenshot of a header on mobile. you can see exactly what the above the fold content is.
 @matthewmueller, I think you can merge this now if you don't have any suggestions.
After making "path" parameter optional it became impossible to overload original "screenshot" function by checking parameter type as I mentioned in our discussion in #363. So I think this PR is ready to be merged.
 Oh, That's good news for me! Thanks @matthewmueller !
 @matthewmueller I will give it a try this morning and I will let you know. The selector I want to capture is an external iframe. This is great. Thanks!
 @matthewmueller It did work, thanks a lot!
 @matthewmueller  Is there a way to capture an image if the evaluation of the page returns true?
  This fulfills #356.
 Done - also did this for the arguments to `evaluate` in the Readme.md.
  This is useful for retrieving HttpOnly cookies which are not available from `document.cookie`.
  Hey there,
is there a way to implement a callback function callable within evaluate?
Like this

``` js
nightmare.on('nightmare-message', function(mixed) {
 //do stuff
 console.log(mixed)
})
nightmare
 .goto('example.com')
 .evaluate(function() {
   //do browser stuff
   var myobject = {...}
   //[...]
   window.nightmare(myobject)
   //[...]
   window.nightmare("hello")
 })
```
 Short answer is no, I don't think so, at least not in the way you're imagining.

However, I think you could use `yield` to get your desired effect.  Something like the following:

``` javascript
var Nightmare = require('nightmare'),
    vo = require('vo');

function nightmareMessage(mixed) {
    //do stuff
    console.log(mixed)
};

function *run() {
    var nightmare = new Nightmare();
    var myobject = yield nightmare
        .goto('http://example.com')
        .evaluate(function() {
            //do browser stuff
            var myobject = {...};
            //[...]
            return myobject;
        });
    nightmareMessage(myobject);

    var message = yield nightmare.evaluate(function() {
        //[...]
        return "hello";
    });
    nightmareMessage(message);
};

vo(run)(function(err){
    console.log('done');
});
```
 Hm. This is not really sutiable for my usecase. I want to be able to trigger a "log time" process giving status updates on the go. @rosshinkley Your example only (my perspective) would work (my use case) if I would trigger the process and then check in a certain interval if there is any update. - no "live data".

I had a quick look  through the source an found this

``` js
window.__nightmare = {};
__nightmare.ipc = require('ipc');
__nightmare.sliced = require('sliced');

window.addEventListener('error', function(e) {
  __nightmare.ipc.send('page-error', e.message, e.error.stack);
});
```

Can't I utilize somehow `__nightmare.ipc.send` ? (or I am on the wrong track..)
 @fentas Ah, I see.  Using `yield` and `evaluate` in this manner probably wouldn't work then. :)

I also take it you're trying to go beyond using `console.log` and the `DEBUG` environment variable?

If so, I'm not sure you can set up ad hoc events with `__nightmare.ipc.send`.  My gut instinct is no, as the event from `ipc` needs to be emitted up through the Electron process to Nightmare.  I don't _think_ the plumbing for that exists.  I'll have to play with it to see.
 @matthewmueller I (embarrassingly) missed the `ipc.send`.  That's handy.

I think I'm on the same train of thought - I was tinkering with adding user-customizable events to accomplish what @fentas needed and have at least some of the basic mechanics down.  As time permits, I'll see if I can pull together the changes + documentation required. :)
  I've got a use case for the screenshot function that doesn't require it to be written to disk. Electron itself returns the image in memory, so I thought it'd be useful if writing it to the disk were optional. This pull request maintains backwards compatibility and adds the necessary tests. These tests actually pass (https://github.com/segmentio/nightmare/pull/290), but I didn't include the line from that PR to avoid a conflict.
 I updated the documentation to match the official node.js docs for a function with two optional parameters. I also tried to add some clarifying language. Thoughts?
 Hah yep, that's a typo. Should be good to go now.
  I have a scenario to handle a pop-up window that opens up via a javascript call in the main window. If I read the documentation correct, I need to use the .on('new-window', function()) method to handle the pop-up, but not sure how the callback needs to be handled. I need to further perform some selections and clicks on the new pop-up

Can anyone point me to an example on how I can achieve this? Thanks
  The documentation in Electron's master branch differs from the documentation for the version of Electron Nightmare is on.  As such, the link in the Nightmare constructor should point to the versioned documentation.
  ``` js
function* extractPage(page) {
    let test1 = true
    let test2 = () => true;

    const title1 = yield page.evaluate((test1) => {
        return test1 ? 1 : 2;
    }, test1);
    console.log(title1);
    const title2 = yield page.evaluate((test2) => {
        return test2() ? 2 : 3;
    }, test2);
    console.log(title2);
}
```

and this is what I get:

```
  nightmare queueing action "evaluate" +52ms
1
  nightmare queueing action "evaluate" +13ms
test2 is not a function
```
 I think you can't pass functions or objects to `evaluate` https://github.com/segmentio/nightmare/issues/89#issuecomment-102769448
 Why is that? 
I really need utility functions in evaluate.

BTW - objects are passing, but without all methods. 
 I see, I'll take a look.
thx
  Hi, how execute right click on element ?
 At present, I don't think it is _directly_ possible, but you could potentially use `evaluate` or `file` to inject your own rightclick handler.
 For what's worth, I hastily threw together a `rightClick` action on [my fork](https://github.com/rosshinkley/nightmare/blob/rightclick/lib/actions.js#L84-L132).  It _technically_ works, at least in my local sandboxes.  I'm not super-comfortable with issuing a PR, as I'm not sure `contextmenu` is really the correct way for client-side javascript to generate/handle right-click events.

Thoughts? /cc @reinpk 
 @rosshinkley Thanks! I will try use your fork.
 I've submitted a PR for sendInputEvent in Electron which lets you do this (though you'd need to calculate element co-ordinates yourself right now)

https://github.com/segmentio/nightmare/pull/361
 @inversion Far and away better than my implementation.  Thanks!
 Are you guys planning on shipping in a rightClick API with nightmare, or do consumers still have to roll this themselves?
  I can keep cookies in a file with phantoms.

Since nightmare moved to  Electron, is there any document about how to store cookies so that I needn't to do the login trick again and again.

Thanks.
 Electron maintains sessions and cookies across logins in a partition (see [here](http://electron.atom.io/docs/v0.34.0/api/browser-window/#new-browserwindow-options)).  You shouldn't have to log in every time provided you're using the same persisted session.  By default, I believe Nightmare uses the default Electron partition, which does get persisted.

As an aside, there is currently no choice _but_ to use the default partition as trying to use a [different session breaks Nightmare](https://github.com/segmentio/nightmare/issues/345).

If you are wondering how to load cookies from scratch into a new partition, that is a topic of lengthy [discussion on the Electron repo](https://github.com/atom/electron/issues/959), the TLDR is that it's not currently possible.
 @rosshinkley Hi for some reason the partition is not working for me
https://github.com/segmentio/nightmare/issues/754
  Hello, does nightmarejs allow page access through a tor socket (https://www.torproject.org)?
Is it planned to provide this feature?

Thank you.
  I running following code:

``` javascript
var test = new Nightmare()
                          .viewport(1000, 1000)
                          .useragent("Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36")
                          .goto('https://en.wikipedia.org/wiki/Ubuntu')
                          .inject('js', 'jquery.js')
                          .wait(500)
                          .screenshot('page.png')
                          .evaluate(
                                         function () 
                                         {
                                          return  $('h1.firstHeading').text(); //Get Heading
                                         },
                                        function (value) 
                                        {
                                           console.log("Not in page context");
                                         }
                                       )
                           .run(
                                     function (err, nightmare) 
                                    {
                                        if (err) return console.log(err);
                                        console.log('Done!');
                                     }
                                );

```

The page is loaded and the screenshot, page.png, is taken correctly, but the evaluate callback never gets executed since the message "Not in page context" never gets printed. The jquery.js is in the same folder as the script and it gets successfuly injected, because if I remove the injectJS I get an error indicating that $ is not defined. I want to get the text content of the h1.firstHeading selector.

Why is the evaluate callback not executed.

Thank you. 
 I'm having a similar problem getting an evaluate callback to log out to the console.
 I found this answer on Stack Overflow which helped ...

http://stackoverflow.com/questions/33659483/nightmare-js-evaluate-page

Try this ...

```
var Nightmare = require('nightmare');

var test = new Nightmare({ show: true })
    .viewport(1200, 950)
    .useragent("Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36")
    .goto('https://en.wikipedia.org/wiki/Ubuntu')
    .inject('js', 'jquery.js')
    .wait(500)
    .screenshot('page.png')
    .evaluate(function () {
        return {firstHeading: $('h1.firstHeading').text()};
    }, function (value) {
        return {firstHeading: 'Not in page context'};
    })
    .run(function (err, nightmare) {
        if (err) return console.log(err);
        console.log('firstHeading:', nightmare.firstHeading);
    })
    .end();
```
  Is there any way to have Nightmare store a csrf token?
 Can you be more specific on what you are attempting to do?
If you access the GET page before, and do your action by clicking or submiting a form, than your POST page will receive the token just as it would in a normal navegation.
For sending the POST directly, you need to parse the page and find the CSRF, this can be done with client-side JS in .evaluate().
Just remember that a CSRF token is not valid between sessions, so you can't save and reuse it later.
 I'm trying to create a scrape for a web service my company uses to process customer credit information. Nightmare works great until I navigate through the final list. That's where I'm getting a CSRF Token Error.

![eoscarlist](https://cloud.githubusercontent.com/assets/9448070/11098209/0e8acbc2-8869-11e5-9bb9-e83ee801c464.png)

![consumer-info](https://cloud.githubusercontent.com/assets/9448070/11098217/173c0ede-8869-11e5-9399-76c29bc882ab.png)
 And this error is happening well after I login to the app, so I'm confused what I need to do differently.
 Also, how to you access GET/POST pages within Nightmare?
  Add method for set position of window.
 recently I use nightmarejs with robotjs for complex test that needed real mouse event.
robotjs is uses absolute position for move mouse cursor, so test is need reset the window position before start.
  This is useful for example to change the userData directory so you don't reuse cookies and such from other instances.
 Merge this as soon as possible please...
 +1
 This is great for testing Electron apps!
 @matthewmueller are there any autoformatter settings for the project? If we could standardise them it would help.
 Spacing updated @matthewmueller 
  I've named the events `page-console-error` and `page-console-warn` because otherwise the error event has a naming conflict with the existing event.

I've suggested deprecating page-log and making it page-console-log to bring it inline with the other new events. Any thoughts?
 Hi @matthewmueller , the use case for us is that our application logs messages to error, warn, info, log depending on severity and these are useful to capture in our tests (we're mainly using nightmare for UI testing). I think a nicer implementation would be a generic `console` event which captures all console output but also adds a `type` or similar field indicating the 'level' (dir, trace, info, error) etc.

The existing page-log event can be kept the same as it is for backwards compatibility and people who are only interested in `console.log` and want simplicity.

Happy to implement that if it sounds like something that would be merged.
 Done in https://github.com/segmentio/nightmare/commit/f499ddfac65416a781d5c17c86e4fee33719bcab
  fixes #167 
 <3 please merge it.
 I love the idea, but for it to be merged it probably needs a test case.
 It's conceptually and implementation-wise very simple so I'm not sure about testing being needed. One caveat that could be added to the docs is that if you have actions which themselves call other actions you'll need to resolve them, otherwise you end up just queueing an action which itself queues actions. I've generally been handling this by passing a `done` callback to my actions and calling `then` at the end of my action code.
 I've never 'used' `use` but I think there's a case for breaking out some actions into plugins. For example I have got a growing suite of mobile-specific actions that might end up bloating nightmare if merged here.

I also think we should handle conflicts on the prototype in either case and namespacing to plugins seems like a good way to do that.
   I started using Nightmare yesterday with node v0.10.36 (no generators) and it seems to be working fine. Am I going down a road that will lead to :broken_heart:?

``` js
var Nightmare = require('nightmare')

new Nightmare()
  .goto('https://google.com')
  .screenshot('google.png')
  .title()
  .end(function (err, title) {
    if (err) throw err

    console.log(title)
  })
```

``` bash
$ node -v
v0.10.36

$ node test.js
Google
```
  When visiting a page that prompts a download window after the onload, is there a way to prevent it to pop up, so that I can use nightmarejs without needing to interact and close those windows?

Something like a preventDefault on a will-download event?
 The good news: you can prevent dialog popups in Electron on a `will-download` event by using [`DownloadItem.setSavePath`](https://github.com/atom/electron/blob/master/docs/api/download-item.md#downloaditemsetsavepathpath).  This was introduced with [this pull](https://github.com/atom/electron/pull/2840).  Or if you don't want to download the item, I think you can use [`DownloadItem.cancel`](https://github.com/atom/electron/blob/master/docs/api/download-item.md#downloaditemcancel).

And now, the unfortunate news: I don't think `will-download` is exposed in Nightmare, at least at present.  It looks (at least superficially) difficult - I think downloads would have to be tracked and `Nightmare.end` would have to be blocked until the downloads are all complete.

Thoughts?
 The new will-download functionality in Electron is really interesting, in Issue #151 @fritx provided some example of using it.

Adding support for download would be important in Nightmare IMHO it's something missing in most headless browser automation solution.
 @darthcloud I agree that it's something that is (in general) missing from headless solutions, and that it is pretty important.

To that end, I spent some time tinkering with `will-download`, and there are a couple of things I'd love to hear your (and others') thoughts on.
1. I know I'm stating the obvious, but this would require an upgrade to `electron-prebuilt`.
2. You have to do what you're going to do with the downloading item synchronously inside of the `will-download` handler.  This means that I don't think you could use events to negotiate on a per-download basis where to put downloads or if an item should be ignored.  I haven't put in an option to globally ignore downloads yet, I wanted to get some feedback (hopefully a correction) on this first.
3. I realize that multiple downloads is a _bit_ of a corner case, but a problem nonetheless.  In my sandbox, I have the `will-download` event emitting a `download-start` event, and when the item is done, emitting a `download-done` event from the DownloadItem's `done` event up to Nightmare.  My sample application simply keeps track of the number of downloads in progress and uses (more or less) the same approach as `wait` until all of the downloads are complete.  In other words, it's hacky and works, but I'm struggling to come up with a less-hacked together approach.
4. If #338 were folded in, we could reuse the override path to dictate where downloads go.  That might make for cleaner options and easier cleanup.
5. If the server doesn't immediately respond to the action that triggers a download (your example in #151 exhibits this behavior), the `will-download` event might be triggered _after_ Nightmare has already moved on.  My current "fix" is to simply wait, but I don't think there's a method to expect an outcome from an action, eg clicking on a link and expecting a download to start.

I put the changes up on [a branch in my fork](https://github.com/rosshinkley/nightmare/tree/auto-download).  I put up a hastily thrown together minimal sample [as a gist](https://gist.github.com/rosshinkley/c1873d40e17dd433cc2d) for the curious.
 @rosshinkley :+1: for sharing fork and a how-to-gist and +1 for feature
 @santeriv This is a _bit_ out of date.  I redid the solution for `will-download` and submitted a PR (#382), but it's been closed pending adding Electron extensions (#391).  If you want to use a fork to handle `will-download`, I'd suggest using that one for the time being.  There are examples in the test suite to show how to use it. :)
  According to [the docs](https://github.com/segmentio/nightmare#pdfpath-options) (which refer to [these docs](http://electron.atom.io/docs/v0.30.0/api/browser-window/#webcontents-printtopdf-options-callback)), doesn't look like there's a way to select what pages to export to PDF. Would be great if there was!
 Could you print to PDF and then use GhostScript to trim off the pages you don't want (see tip [here](http://www.linuxjournal.com/content/tech-tip-extract-pages-pdf))?  That would allow you trim pages from the document.

Not that introducing another dependency would be ideal, but it is an option.

It _looks_ like Electron supports partial selections to print to PDF, but the documentation is lean on how such selections are made.  (It looks like you can select all, and unselect, but it isn't clear how to do partial selections).
  I've been playing around with the screenshot functionality but I couldn't make it print the whole content.
My use case is to compare the whole site snapshot for differences (similar to the phantomcss library). Casperjs allows to capture the whole scrollable screen in a png. Is there a way of doing the same with nightmare? If not, I'll see if it can be added easily but it may take some time as I just started getting into nightmare.
 ^ +1
 +1
 You can ask Nightmare to get the dimensions of the body element (using `scrollHeight`/`scrollWidth`), and then use `Nightmare.viewport` to set the viewport dimensions.  After that, you should be able to take a screenshot of the entire page.  I'm not sure this will work 100% of the time, but it's what I've got working for me and I thought I'd share.

An example might be useful:

``` javascript
var Nightmare = require('nightmare'),
    vo = require('vo');

function * run() {
    var nightmare = new Nightmare({
        show: false,
        width: 1024,
        height: 768
    });
    var dimensions = yield nightmare.goto('http://www.gmail.com')
        .wait('body')
        .evaluate(function() {
            var body = document.querySelector('body');
            return { 
                height: body.scrollHeight,
                width:body.scrollWidth
            }
        });

    console.dir(dimensions);
    yield nightmare.viewport(dimensions.width, dimensions.height)
        .wait(1000)
        .screenshot(require('path')
            .join(__dirname, 'gmail.png'));

    yield nightmare.end();
}   

vo(run)(function() {
    console.log('done');
});
```

A couple of notes and questions:
1. The width (and to a lesser extent, height) of the original Nightmare instance should be reasonably big, especially if your site is responsive.  Make sure the width is near the threshold you're targeting your screenshot for.
2. `show` has to be false.  If Electron actually renders to a real screen and the page scrolls off the bottom, the viewport will render with the scrollbar as it appears on screen.  I _think_ this is because `show:false` renders in the framebuffer which has no screen dimensions to honor, but I'm not sure.  Anyone know for certain?
3. The `wait` call after setting `Nightmare.viewport` seems to be mandatory.  (Not waiting stretches the original viewport to the body dimensions obtained in `evaluate`.)  I am not clear on why this is, but I once again think it has to do with rendering time in the framebuffer.  (Aside: I think 1s is probably far too long, but I'm guessing a mininum time would be machine-dependent.)  A cursory look through the Electron project didn't yield anything, but admittedly, I didn't spend a whole lot of time on it.  Again, anyone know for sure?
  Can I pass message from main process to render process like ipc module in electron?
 You could use [`Nightmare.evaluate`](https://github.com/segmentio/nightmare#evaluatefn-arg1-arg2), or possibly [`Nightmare.inject`](https://github.com/segmentio/nightmare#injecttype-file).

What are you trying to do?
  There are minor rendering differences for Nightmare on OSX and Linux that are causing [tests](https://travis-ci.org/dbkaplun/domscii/jobs/88532553) to fail. Certain pixel values are off by one.
  As of electron 0.34, you can override headers as part of loadUrl: https://github.com/atom/electron/pull/3227

``` javascript
webContents.loadUrl('https://www.example.com', {
  extraHeaders: 'Accept-Encoding: gzip;q=0,deflate;q=0'
});
```

It'd be great if goto could accept a second argument that included these headers. Happy to submit a PR if interested. :)
 Yup! Would you want to expose the extraHeaders argument as a string like in electron, or improve on the API a bit and allow passing a headers object instead?
 Since I may have misunderstood, do you mean adding two things?
- `.headers(object)`
- optional goto param, `.goto(url, headers)`

I'd assume you prefer a headers object to the headers string electron uses?
  If we take a look at nightmarejs package size, you are gonna be surprised (maybe). It is ~100mb. It is all because electron package.

My question is the following, is it possible to change it to phantom headless browser?
 NightmareJS was based on PhantomJS before. But they've sinced then switched to Electron.

Electron makes it possible to utilize any node package you'd like. For PhantomJS to communicate with Node you'll have to open a really ugly socket and transfer the data that way. To understand this better, take a look at some other [phantomjs-node](https://github.com/sgentle/phantomjs-node#no-really-how-does-it-work) packages:  

The binaries in phantomjs may be smaller, but it uses a very old version of QtWebKit (And as of QT 5.4 it is what the Qt team says "done").

I'm interested in this package mainly _because_ it's using Electron (which in turn uses Chromium). Disk space is essentially free these days, and the overhead you're creating by using PhantomJS (memory leaks, processing power, etc) is not worth it to switch back.

There are a few other options out there for you, and the closest you'll get is probably [CaseperJS](http://casperjs.org/). 

Also, if you install the Electron-binary beforehand and globally, npm will verify it's existance and not pull it in again (if the versions match), `npm install -g electron-prebuilt`. 
  This works great:

```
nightmare.inject('js', `node_modules/jquery/dist/jquery.js`);
```

but minified file not:

```
nightmare.inject('js', `node_modules/jquery/dist/jquery.min.js`);
```

Any ideas?
 Got the same issue too.
  running with babel-node for es6 stuff

```
vo(...urls.map(run), endN)(end);

function run(url) {
  return function*() {
    const title = yield nightmare
      .goto(url)
      .evaluate(() => document.title);
    console.log(`crawling: ${title}`);
    const html = yield nightmare
      .evaluate(() => document.documentElement.outerHTML);
    const savepath = `${md5(url)}.html`;
    console.log(`writing ${title} to ${savepath}`);
    fs.writeFile(savepath, html, 'utf8');
  };
}

function* endN() {
  yield nightmare.end();
}

function end(err, res) {
  if (err) throw err;
  if (res) console.log(res);
}
```

it always gets stuck at

```
nightmare queueing action "evaluate" +1ms
```
 it runs fine if i remove all `.evaluate` blocks,
 even replacing the `evaluate(() => document.title);` to  `evaluate(() => 'hello');` causes it to hang
 +1 for the issue.
I have this issue occasionally. Like a random event
I don't know where to get the chromium debeg info.
 _Somewhat_ offtopic, could this (and #320) also be related to #345?
 I think this might be an ES6 issue. I have the same problem with running nightmare on ES6 with node v4.2.3
 @rosshinkley i haven't used nightmare in a long time, but yes it was with fat arrow functions, thought it shouldn't have mattered either way because I was transpiling down to es5 before running...
  The formerly used "did-finish-load" is not always emitted after an action
in case webContents.isLoading() is true. Thus the "continue" event is never
emitted. The probability of this behavior rises with rising frequency
of actions, resulting in flaky behavior and hangs depending on the
target site.

The electron documentation states that "did-finish-load" is only
dispatched when the "onload" event is dispatched and the spinner of the
tab has stopped spinning. Yet the "onload" event is not always dispatched
when webContents.isLoading() is true. Therfore the correct event is
"did-stop-loading" which is always dispatched after isLoading()
transitions to false.
 As far as I can see this will fix a few open issues for example: #278 #238 #251 
 There might be timing issues that could break _some_ existing code that relies on the current behavior of `continue` only emitting on `did-finish-load` and never earlier, but you could probably formulate that code differently using direct event listeners on `did-finish-load`. Furthermore such code does seem to be incorrect to rely on that logic in the first place, so it should probably be changed in any case (or the interface should expose the intent directly).

Apart from that I am pretty sure that even though the `did-finish-load` event always precedes `did-stop-loading` it also _always_ coincides with the latter, which in turn gives us compatibility with the original (intended?) case.

Of course, there could be edge cases that I am not aware of right now. If I find the time I can look into the electron code to graph out all event sequences possible, but if anyone knows right off the bat, that would be awesome.
 Hi. This solves my issues with wait functions. Are you going to merge it?
 Seems to work well, would be nice to see it merged.
 @reinpk it's just one line!
 Applying this change manually fixed #322 for me
 +1.  Wait is much more reliable with this patch.
  I'm trying out nightmare, and so far it looks like it can be a good replacement for CasperJS.

CasperJS had a pretty nifty function named "waitForUrl". It just waited until the browser was pointed at the expected url (or regex), and then it continued to the next step. 

I did some experimentation and it looks like a combination of Electron event's "will-navigate" and "did-get-response-details" could make this happen.

I'm confused about the docs [here](https://github.com/segmentio/nightmare#onevent-callback) though. 
Is it possible for me to use the events after goto() in this case?

The case I'm trying out is a login form where they (the site) do some "ajax magic" to authenticate the user, and if the response is ok, they do a window.location.href-redirection. 
 i think you dont need any events for this because the code isn't runed async, its a generator function with yield, it will wait until .goto() finished just like in this examples  https://github.com/segmentio/nightmare/blob/master/test/index.js#L48 Just remember that you have no callbacks, unless you want to inject some js into the site with evaluate, then you need to pass in that js as a callback
 In this case the yield will finish after it's clicked on the login button. I can of course wait for an element on the site I get redirected to, but in this instance, the only unique thing that can help my verify I was successfully logged in is the new url.

When I know I'm inside, I yield another step that fetches the data for me, but if the first yield doesn't take me to the new url, the data fetching will fail.

The only reason I would like to utilize the events is because they are in place, and that would eliminate any need for pulling the url and check if we're at the expected url.
 sorry i don't understand, can you paste the code?
 It's very simple, really, hopefully my example here will clear some things up.

```
var login = yield nightmare
    .goto('https://example.com')
    .type('input#username', 'me@example.com')
    .type('input#password', 'mypassword')
    .click('input#login')
    /* 
       Since this particular site does async stuff, nightmare will not wait
       for their click-event to finish, so I need to wait for the new url.
       Which they redirect to by doing window.location.href
       I could wait for an element on the url I get redirected to, but the
       only unique verification I have is the new URL.

       The site in question is poorly written. 
    */
    .waitForUrl('https://example.com/everything-went-okay')
    .url();

if(login === 'https://example.com/everything-went-okay') {
    // We're inside, do the next thing.
    var postInformation = yield nightmare
          .goto('https://example.com/information')
          .click('a#edit')
          .type('textarea#information', 'Hello, this is posted from Nightmare')
          .click('input#save');
}
```

Here's a quick and dirty implementation of what I really mean which I just now placed in
`nightmare/lib/actions.js` for the sake of argument.

```
exports.waitForUrl = function(url, done) {
  this.child.on('will-navigate', function(event, navigateTo) {    
    if(navigateTo.match(url)) {
      done();
    }
  });
};
```

This whole issue is a suggestion of enhancement by adding the functionality to wait for a certain url. The above code is obviously just a proof of concept, but by listening to some of the other events, a better implementation could be made. 
 try something like this

``` js
var login = yield nightmare
    .goto('https://example.com')
    .type('input#username', 'me@example.com')
    .type('input#password', 'mypassword')
    .click('input#login')
    .wait(function(){
        return window.location.href === 'https://example.com/everything-went-okay';
    })
    .url();

```
 Thank you, but then we're back at pulling [(setTimeout)](https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L270), and that was the whole idea to avoid by utilising the events Electron sends.

I know of a few different ways I can make this particular case work, but I was just suggesting the implementation of a feature that I think could be good to have in the core of Nightmare.

Reading this whole thread back again, I might have been a bit unclear about the purpose of the issue.
 I was looking through the PR's and saw https://github.com/segmentio/nightmare/pull/425, and decided to do a quick experiment. This could easily be implemented like a plugin once #425 is decided on, by doing something like;

``` javascript
var Nightmare = require('nightmare'),
    debug = require('debug')('nightmare:wait-for-url');

Nightmare.action(
    'waitForUrl',
    function(ns, options, parent, win, renderer, done) {
        var navigationHistory = [];

        win.webContents.on('navigation-entry-commited', function(event, url, inPage, replaceEntry) {
            // @see https://github.com/atom/electron/issues/3334
            // ^-- This will cover history.pushState

            // We should probably have some way of knowing if the current url is loaded
            navigationHistory.push(url);
        });

        // Get the list of navigated urls
        parent.on('waitForUrl', function() {
            parent.emit('waitForUrl', navigationHistory);
        });

        done();
    },
    function() {
        var self = this;
        var matchUrl = arguments[0];
        var done = arguments[1];

        var timeout = setTimeout(function() {
            return done(new Error('.waitForUrl() timed out after 5000 msec - could not find a matching url'))
        }, 5000); // The timeout here should probably be specified as an argument or use self.optionWaitTimeout

        // Our event handler
        var handler = function(navigationHistory) {
            var latestUrl = navigationHistory[navigationHistory.length-1];

            if(latestUrl !== undefined && latestUrl.match(matchUrl)) {
                // Remove the listener if we have a match
                self.child.removeListener('waitForUrl', handler);

                // Clear the timeout
                clearTimeout(timeout);

                // We're done
                done(null, true);
            } else {
                // If we don't match, emit again, so we get the latest urls
                self.child.emit('waitForUrl');
            }
        };

        self.child.on('waitForUrl', handler);

        // Call the parent to get the list of url's we've navigated to
        self.child.emit('waitForUrl');
    }
);
```

Which would allow for usage like this;

``` javascript
var url = yield nightmare.goto('https://example.com/sv-se')
    .click('li.language-picker a.dropdown-toggle')
    .click('a[data-lang="en-US"]')
    .waitForUrl('https://example.com/en-us')

console.log('Matched?', url);
```
 Yeah, we're not doing the next action until we're ready, and that's good!

This is an older issue, and back in october I couldn't get the example I've provided here to work. Nightmare has changed since then, but my take on this was that the particular site did not have any other "success-verification" other than the url, and navigation there was done with a async `window.location.href`.

Which meant that nightmare just continued with the other yield's.

The site in question has since then changed, so I solved it in a different way. 

However, with history.pushState we never get the "did-stop-loading" event, and that's where waitForUrl would be nice - otherwise one would run into timing issues.

This plugin would allow for usage such as this;

``` javascript
var page2 = yield nightmare
    .goto('https://www.google.com')
    .type('input[label="Search"]', 'Alexander the great')
    .click('input[name="btnK"]')
    .waitForUrl(/https:\/\/www\.google\.com\/.*q=Alexander\+the\+great/)
    .click('a.pn')
    .waitForUrl(/https:\/\/www\.google\.com\/.*q=Alexander\+the\+great&start=\d+/);

if(page2) {
    console.log('We\'re at page 2');
}
```
 @rosshinkley Yes! I'll get on it tomorrow or monday - and closing this with a link when I'm done.
 The plugin can be found here https://github.com/Zn4rK/nightmare-wait-for-url
  In the README documentation menu, the URL for **Set up a new instance** was [wrong](https://github.com/segmentio/nightmare#new-nightmareoptions).
This pull request changes it to a [correct](https://github.com/segmentio/nightmare#nightmareoptions) one.

It started from the commit https://github.com/segmentio/nightmare/commit/562e7e42d98d8e844883ae7f7c79e8722ca287e6,  when it removed the **new** keyword but missed the respective URL hash.

I hope I didn't mess anything.
  Hello! <br>
I have a script using nightmare and which works on my pc ,and couldnt get it working on another pc.
This is the error im getting :  

```
Error: spawn D:\Projects\Lounge\Lounge\node_modules\electron-prebuilt\dist\elect
ron.exe ENOENT
    at exports._errnoException (util.js:874:11)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:178:32)
    at onErrorNT (internal/child_process.js:344:16)
    at doNTCallback2 (node.js:439:9)
    at process._tickCallback (node.js:353:17)
    at Function.Module.runMain (module.js:469:11)
    at startup (node.js:134:18)
    at node.js:961:3
```

It seems like its searching for the electron on my pc's path , how could i change it? I have the electron exec , in the node moudle , but the path is diffrent (F:\Lounge\Lounge\node_modules\electron-prebuilt\dist\electron.exe)
 Hello. Maybe it's late but anyway. I had the same trouble and searched more and found solution for me. The path.txt file which is located in "nightmare\node_modules\electron-prebuilt" containe path where it is installed so you have to change it for current module location.
  Can I create app on my device
    Node version 4.2.1
Mac Os 10.10.5

Running: node --harmony test.js

Test script is the cnn test but with { show: true } passed to the constructor.    A window pops up titled Electron but is hung.  Have to kill the process and kill the script.  Any thoughts on what I am doing wrong?
  See [Build #1](https://travis-ci.org/dbkaplun/domscii/builds/87059257) for [dbkaplun/domscii](https://github.com/dbkaplun/domscii). Runs great locally but fails on TravisCI due to timeouts.

See also travis-ci/travis-ci#5002
 https://github.com/juliangruber/electron-stream#travis
 Aha, thanks @juliangruber!
 :+1: 
  Hi,

I am currently looking for alternatives to PhantomJS for a project of mine and Nightmare looks very promising!

However, I need to be able to retrieve response details such as response code and response headers. Is it possible to get this information with Nightmare somehow?
 @reinpk I've try to capture `did-get-response-details` event, but I got EVERY response of the resources(js, css, images...) in the page. I only want the main page's response info.

Is there any way to do this?
  Is it possible to export a page to pdf that forces a specific aspect ratio / resolution?
  Yeah i am archaic, can you guys provide es5 examples aswell?
 +1 :+1: 
  Hi, 

Great work, at first.
I use this module to replace phantom for web page automation. However, I need to set custom header or `accept-language` header of the requests.

How can I achieve that?

Best regards,
Kevin
 I've got a feature branch that implements passing options to goto. With this you can add headers to your request. @reinpk if you think this is an appropriate pull request, let me know. Here's the branch: https://github.com/fr-/nightmare/commit/21fb1eb597ad85981333583ec7dc33098ea309e2  
  Added a `mousedown` event to fulfill enhancement #201.
  Since "...page-error ... event is not triggered if the injected javascript code (e.g. via .evaluate()) is throwing an exception....", what's the best way to do so?
  In Nightmare v1 there was an option to timeout .wait(), i added this back in to v2

please don't merge both of this pull requests https://github.com/segmentio/nightmare/pull/305  at the same time, they will have conflicts.
I can merge the other with upstream/origin and update the other after you have merged one of this.
 Thanks! Resolved!
  I'm running the example from the Readme:

``` javascript
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {
  it('should find the nightmare github link first', function*() {
    var nightmare = Nightmare()
    var breadcrumb = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.url.breadcrumb')
      .evaluate(function () {
        return document.querySelector('.url.breadcrumb').innerText;
      });
    expect(breadcrumb).to.equal('github.com');
  });
});
```

and when I switch out the URL in the expect statement (to something that should definitely fail, like 'asdf'), the test is still showing as passing. I have mocha, chai, and mocha-generators installed, and I'm using `mocha --harmony` to run the files in my test directory. 

After reading issue #295, I tried installing vo and adding in that wrapping syntax, but it doesn't seem to make any difference. 
 I added your test to `test/index.js` then ran it and got this error.

```
 2) test yahoo search results should find the nightmare github link first:
     Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.
```

The problem seems to be that the search result page on [yahoo.com](https://search.yahoo.com/search?p=github+nightmare) doesn't have any elements that have a class of `url` and `breadcrumb`. Thus the test should timeout if ran properly.

Maybe the reason why your test are passing is because you installed but didn't initialize the `mocha-generator` module. See this on how. https://github.com/segmentio/nightmare/pull/290
 Oh jeez, of course, thanks @LarryBattle. 

I added the `require('mocha-generators').install();` line and the tests are now failing. I've tried to get an example that passes, pulling in updated selectors from the yahoo search, but I'm not able to get anything to work. Are there updated examples using Mocha that pass?
 I have the same problem here with OS X 10.11.1 node v4.2.1 mocha 2.3.3. I'm new to node.

``` javascript
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {
  it('should find the nightmare github link first', function*() {
    var nightmare = Nightmare()
    var link = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.ac-21th')
      .evaluate(function () {
        return document.getElementsByClassName('ac-21th')[0].href;
      });
    expect(link).to.equal('anything');
  });
});
```

the result is:

``` javascript
  test yahoo search results
    âœ“ should find the nightmare github link first


  1 passing (8ms)
```

With `require('mocha-generators').install();` added to top

``` javascript
require('mocha-generators').install();
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line
...
```

the result is:

``` javascript
  test yahoo search results
    1) should find the nightmare github link first
Error: spawn /Users/xxx/node_modules/nightmare/node_modules/electron-prebuilt/dist/Electron.app/Contents/MacOS/Electron ENOENT
    at exports._errnoException (util.js:874:11)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:178:32)
    at onErrorNT (internal/child_process.js:344:16)


  0 passing (28ms)
  1 failing

  1) test yahoo search results should find the nightmare github link first:
     Uncaught Error: spawn /Users/xxx/node_modules/nightmare/node_modules/electron-prebuilt/dist/Electron.app/Contents/MacOS/Electron ENOENT
      at exports._errnoException (util.js:874:11)
      at Process.ChildProcess._handle.onexit (internal/child_process.js:178:32)
      at onErrorNT (internal/child_process.js:344:16)
```

is this right?
 I was getting a mocha timeout error but this seems to work fine:

``` js
var Nightmare = require('nightmare')
var expect = require('chai').expect // jshint ignore:line
require('mocha-generators').install()

describe('test yahoo search results', function() {
  this.timeout(5000)
  it('should find the nightmare github link first', function*() {
    var nightmare = Nightmare()
    var link = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.ac-21th')
      .evaluate(function () {
        return document.getElementsByClassName('ac-21th')[0].href;
      });
    expect(link).to.equal('https://github.com/segmentio/nightmare');
    yield nightmare.end()
  });
});
```

If you change the assertion, you end up with a failing test.  I also added `nightmare.end()` to close the window when the tests are finished.  
   `exports` and `module.exports` point to the same object unless changed. 
- https://nodejs.org/docs/latest/api/modules.html#modules_the_module_object

It would be better to change the 2 references to `module.exports` to point to `exports`. 
 It would be better to stick to `module.exports` because that's the convention. `exports` is merely a shorthand that can sometimes cause confusion.

For example, if you use `module.exports` and `exports`, what's exported? And when you do, `module.exports = exports = x`, that's just additional meaningless clutter to your codebase especially when `module.exports` _always_ works in Node.js :wink: 

Read here- http://www.hacksparrow.com/node-js-exports-vs-module-exports.html
 alright. regardless of convention, i'd still recommend against `exports`... but i understand commonjs so whatever. i myself am +- 0
 fair
  i'd say that since everyone using nightmare is es5+, Function#bind should be preferred to the `var self = this` strategy since rebinding `this` is the end goal and we don't have to declare another variable.

thoughts?
 @matthewmueller FWIW, there's a decent looking [jsperf](https://jsperf.com/bind-vs-closure-setup/49).  According to that, it looks like the `bind` method is significantly slower.  Is that close to what you had in mind?
 aha, nope- i did not have a stat for this but am glad to see this one- didn't know...
  There are two ways of getting an exception in Nightmare, one is to inject some "bad" code via .evaluate(), this will stop nightmare and even call done() in mocha. But there is also the issue with already existing code, that has errors, now there is an option to listen for this.
Same with console log, before only console logs from evaluate() where shown.
 ok, done
  This was a horrible bug. Happening on my node v4.2.1 and on the circleci build system
 Look at #290 
 I've added more npm updates to it. Please please do merge this or #290 it's reckless to move on with this project without tests.
 I've update to the current master. Basically this brach is a npm-update-branch now. Especially important is the electron update.
 Oh i just noticed, this pr also solves the issue with two "scripts" keys in package.json 

https://github.com/segmentio/nightmare/blob/e908b5c960c9034b8e9024bdcaf4ac5988a7e5c8/package.json#L7
https://github.com/segmentio/nightmare/blob/e908b5c960c9034b8e9024bdcaf4ac5988a7e5c8/package.json#L43
 https://github.com/mafintosh/electron-prebuilt/commits/master

i don't know exactly, most of the commits are just version bumps for now obvious reason, but there are also some merges of prs with some fixes. i think it's go to stay to date with this npm.
  - Removed `Makefile`
- `npm test` can now be used to run tests
- Updated Readme.md to mention how to run tests
- tmp folders are now created inside `test` instead of `/tmp/nightmare`
- Includes https://github.com/segmentio/nightmare/pull/290
 @matthewmueller i'd recommend #303 instead. you may have more make tasks later but `npm test` is very common (as the shortcut is even there from `npm run-script` / `npm run` test)... so best to support that. i think many CI systems default to this, too.
 yep! makefile is good, we can do much more there. `npm test` is just a helper :)

:-1: on this change
  This introduces a new `browser-configure` event that happens before `browser-initialize`, which allows the user to configure the Chromium instance itself. Might be useful to provide other flags, but I only needed `disable-http-cache`. (Apologies for the lack of tests.)
 +1
 +1
 Close to reduce entropy? You can now pass switches to the runner.
  Hi. I want to give it a try but the basic examples don't work for me. I read everything and searched the web for my errors but can't get nightmare do do anything. I can't even run the tests. The docs don't say how and going into the nightmare dir, running npm install and node tests/index.js dosn't do it either. I paste the example scripts and try to run them and i get this:

> /nodeapps/nightmare_app/index.js:2
> yield Nightmare()
>           ^^^^^^^^^
> SyntaxError: Unexpected identifier
>    at exports.runInThisContext (vm.js:73:16)
>    at Module._compile (module.js:443:25)
>    at Object.Module._extensions..js (module.js:478:10)
>    at Module.load (module.js:355:32)
>    at Function.Module._load (module.js:310:12)
>    at Function.Module.runMain (module.js:501:10)
>    at startup (node.js:129:16)
>    at node.js:814:3

i am running it like so:  

```
node --harmony --harmony_proxies index.js
```

. no luck at all. is that what it's supposed to do ? give me nightmares ?

P.S. this is the code ( running on CentOS 7 ):

``` javascript
var Nightmare = require('nightmare');
yield Nightmare()
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('.searchsubmit');
```

Does anyone know how to get it working ?
 @matthewmueller Yes, you should change the example, because you want start try it out and you got this error it's frustrating at the beginning.
  When using `nightmare.mouseover` the :hover pseudo class isn't triggered in the browser. Looking into it a bit has largely convinced me to not hover events for anything other than cosmetic changes. But to allow screenshots to show effect of mouse hover it could be pretty useful.

Workaround I have is to alias all :hover styles with a `--hover` class, then add the class to `element` inside `nightmare.mouseover`.

As I understand it, this is caused by Chromium not triggering the :hover pseudo class on mouseenter. Issue is possibly covered by [this chromium issue](https://code.google.com/p/chromium/issues/detail?id=486176)).

Curious if you have any thoughts, or I'm missing something more obvious. Thanks!
  Now it's possible to trace js exceptions. It solves this https://github.com/segmentio/nightmare/issues/248 issue and makes Nightmare viable for TTD again.
 I've changed to addEventListener. i think the keyword 'js' is fine since its used here too `.inject('js', file)` 
 I saw the callbacks for runtime errors https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L106 but it's only used for `_inject` as far as i understand.
Right now i'm having a very strange issue and can not check if this two callbacks can be used as one.
The problem is, all the tests are passing within 400ms even if i have something like this `title.should.equal('NOPE')` and i have 30 instances of Electron open in my doc. Even if i freshly checkout master form your remote, mocha tests are just behaving crazy. Do you have any idea why this could happen?
 Oh it looks like this issue is happing everywhere 
`$ make test` in this old build took 29s https://circleci.com/gh/segmentio/nightmare/364
`$ make test` in this build took 1s https://circleci.com/gh/segmentio/nightmare/373
since build 365 tests don't really run
what could have caused this? the commit for build 365 https://github.com/segmentio/nightmare/commit/58ff6acd00838576c50f953473101ec9241cb60f has nothing at all
 ok i've fixed this problem here https://github.com/segmentio/nightmare/pull/299
 Sorry i need to move this pr to a new branch https://github.com/segmentio/nightmare/pull/300
  Hey Nightmare Team - it looks like mocha test suite isn't automatically initializing `mocha-generators` so the tests only appear to run and succeed, instead of running.

**Branch**: Master
**Commit**: 748a2b2b14163d34e89108250e34553d991e7913
### Use-Case

Modify any test to have a `console.log` - never logs to console.
### Solution

Setup needs `require('mocha-generators').install()`
 :+1: It says it right there in the readme. https://github.com/vdemedes/mocha-generators
 :+1:  need to recover test
 This should be merged ASAP because I think currently all tests are passed wrongly.
In my environment, below tests failed after adding `require('mocha-generators').install()`.

```
31 passing (43s)
2 failing

1) Nightmare rendering should take a clipped screenshot:
   Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.


2) Nightmare rendering "after each" hook for "should take a clipped screenshot":
   Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.
```
 :+1:
  I am trying to crawl a domain completely and ignoring the external domain links. I have written a `while` loop for that, but it ran into an exception.

Here is my code so far:

```
var Nightmare = require('nightmare');
var vo = require('vo');

var link = 'https://www.cordbloodbanking.com/';

vo(run)(function(err, result) {
    if (err) throw err;
});


function *run() {

    var seen = ignored = linksQueue = [];

    linksQueue.push(link);

    while(linksQueue.length > 0){

        var nightmare = Nightmare();

        var link = linksQueue.pop();

        var n = yield nightmare
            .goto(link)
            .evaluate(function() {

                console.log('evaluating..');  // never works

                var links = document.querySelectorAll("a");

                for(var i = 0, l = links.length; i < l; i++){
                    if(!seen[links[i].href] && !ignored[links[i].href]){
                        if(/^https:\/\/www\.cordbloodbanking\.com/.test(links[i].href) || /^\//.test(links[i].href)){
                            linksQueue.push(links[i].href);
                            seen[links[i].href] = true;
                        } else {
                            ignored[links[i].href] = true;
                        }
                    }
                }
            });
    };

    console.log('CRAWLING COMPLETE!');
    console.log('Links visited:', seen);


    yield nightmare.end();
}
```

Here is how I ran it:

```
Rahuls-MacBook-Air:nightmare rahuldesai$ DEBUG=nightmare node --harmony index.js 
  nightmare queueing action "goto" for undefined +0ms
  nightmare queueing action "evaluate" +4ms
```

Here is what I got as soon as I ran it:

![screen shot 2015-10-15 at 5 49 18 pm](https://cloud.githubusercontent.com/assets/2539881/10528690/b86b0436-7365-11e5-9fe5-9485374c74e8.png)

How do I fix this?
 This is your problem.

```
nightmare queueing action "goto" for undefined +0ms
```

You're passing in a undefined link because the global `link` is overwritten in the context of `run()`.
There are two ways you can fix this.
1. Rename the global `link` variable to something else, like `bacon`
2. Change `var link = linksQueue.pop();` to `link = linksQueue.pop();`
 @LarryBattle That was my bad. I tried both of your solutions, but it gives me `undefined`.

```
rahul@rahul-Inspiron-N5010:~/stuff$ DEBUG=nightmare node --harmony nig.js 
  nightmare queueing action "goto" for https://www.cordbloodbanking.com/ +0ms
  nightmare queueing action "evaluate" +7ms
undefined
rahul@rahul-Inspiron-N5010:~/stuff$ 
```

I am not sure why exactly it is breaking.
 Oh. It's because `.evaluate()` executes the function you passed in the context on the browser, which doesn't have access to your link variables unless you pass them directly to `.evalulate()` as additional arguments. 
I hope this example makes this.

```
var moduleFnArg1 = 1
var moduleFnArg2 = 2
var moduleFn = function(arg1, arg2){
    console.log( "Got arg1 as %s, and arg2 as %s", arg1, arg2)
}
yield nightmare
.goto(link)
.evalulate(moduleFn, moduleFnArg1, moduleFnArg2)
```

Here's the source: https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L183
 @LarryBattle I tried your example but it gave me `undefined` in the console, just like before. Here is my code: https://gist.github.com/rahul-desai3/8ee6f5322e17a34116ba
 You're getting `undefined` because `* run()` is called by `vo()` before the other global variables are initialized. This causes `* run()` to stores references to `undefined` values. Place the `vo()` part at the end of the script and run it again.

Here's a simple and short working example of extracting the links on a page.

```
var Nightmare = require('nightmare');
var vo = require('vo');

var homeUrl = 'http://www.wimp.com/'

var findUnseenRelativeLinks = function(baseUrl, viewedLinks) {
    var markedLinks = {}
    var links = document.querySelectorAll("a");

    for (var i = 0; i < links.length; i++) {
    var href = links[i].href;
    if (!markedLinks[href] && !viewedLinks[href] && (/^\//.test(href) || href.indexOf(baseUrl) != -1)) {
        markedLinks[href] = 1;
    }
    }

    return Object.keys(markedLinks).sort();
}

function* findNewLinksToVisitFromLink(viewedLinks, url, nightmare) {
    var links = yield nightmare.goto(url).evaluate(findUnseenRelativeLinks, homeUrl, viewedLinks)
    return links;
}

function * run() {
    var nightmare = Nightmare();
    var viewedLinks = {};
    var linksToVisit = [homeUrl];

    // @TODO Refactor this section to view to a breadth first search on the new links
    var url = linksToVisit.pop() 
    viewedLinks[url] = 1;
    var links = yield * findNewLinksToVisitFromLink(viewedLinks, url, nightmare);
    // end of TODO breadth first search

    console.log(links);
    yield nightmare.end();
}

vo(run)(function(err, result) {
    if (err) throw err;
});
```
 @LarryBattle That works very well on my local. However, when I put this on Heroku, it doesnt. Here is what I get:

```
2015-10-19T17:58:22.372868+00:00 app[web.1]: Mon, 19 Oct 2015 17:58:22 GMT nightmare queueing action "evaluate"
2015-10-19T17:58:22.368523+00:00 app[web.1]: Mon, 19 Oct 2015 17:58:22 GMT nightmare queueing action "goto" for https://github.com
2015-10-19T17:58:22.377707+00:00 app[web.1]: Error: spawn /tmp/build_19b8229474da1b68ec2af6357882e756/node_modules/nightmare/node_modules/electron-prebuilt/dist/electron ENOENT
2015-10-19T17:58:22.377710+00:00 app[web.1]:     at exports._errnoException (util.js:837:11)
2015-10-19T17:58:22.377712+00:00 app[web.1]:     at Process.ChildProcess._handle.onexit (internal/child_process.js:178:32)
2015-10-19T17:58:22.377713+00:00 app[web.1]:     at onErrorNT (internal/child_process.js:344:16)
2015-10-19T17:58:22.377714+00:00 app[web.1]:     at doNTCallback2 (node.js:429:9)
2015-10-19T17:58:22.377714+00:00 app[web.1]:     at process._tickCallback (node.js:343:17)
2015-10-19T17:58:52.246164+00:00 heroku[router]: at=error code=H12 desc="Request timeout" method=POST path="/getLinksAndEmails" host=email-finder.herokuapp.com request_id=fc837338-24d7-4f86-b3f8-5bfd129f3b94 fwd="71.42.53.69" dyno=web.1 connect=0ms service=30000ms status=503 bytes=0
```
 Related issue: https://github.com/segmentio/nightmare/issues/224
  Added a license field to package.json to get rid of this error.

```
>:nightmare$ npm install
npm WARN package.json nightmare@2.0.7 No license field.
```
  I try to use nightmare inside an express app. something like this:

``` js
router.get('/', function(req, res, next) {

    var getPrice = function* () {
       console.log('hello');  // <-- never even logged
        return yield Nightmare()
            .goto(MY_URL)
            .evaluate(function () {
                return document.querySelectorAll('.price-total .animated')[0].innerText;
            })
            .run();
    };
    res.status(200).json(getPrice());
});
```

I am new to generators and all my attempts with `evaluate` where not successful. I just wish I could use the old `.evaluate(fn, callback)` way. 

Any help greatly appreciated.
 The problem is that Express 4 `res.json(obj)` / `JSON.stringify()` only accepts objects and primitives and not generators.
If you look at the source code for `res.json(obj)` you can see that all they do is pass the object to `JSON.stringify()`.
Source code: https://github.com/strongloop/express/blob/2f8ac6726fa20ab5b4a05c112c886752868ac8ce/lib/response.js#L242

A generators is an iternator factory. Broadly speaking, to execute a generator you need to initialize it then call `next()` and check for the value property on the returned object.

Simple example:

```
var gen = function *(){
  var i = 0;
  yield i++
  yield i++
  yield i++
}
var x = gen()
do{
  var val = x.next().value
  console.log("Got: ", val)
}while(val !== undefined)
console.log("DONE")
```

Output:

```
Got:  0
Got:  1
Got:  2
Got:  undefined
DONE
```

Tutorial over generators:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators

So if you update your code you should get something like this.

```
router.get('/', function(req, res, next) {
    var getPrice = function* () {
       console.log('hello'); 
        return yield Nightmare()
            .goto(MY_URL)
            .evaluate(function () {
                return document.querySelectorAll('.price-total .animated')[0].innerText;
            });
    };
    var price = getPrice().next().value
    res.status(200).json(price);
});
```

Lastly, I think you might want to use [cheerio](https://github.com/cheeriojs/cheerio) instead Nightmare for scraping webpages.
Tutorial:
https://scotch.io/tutorials/scraping-the-web-with-node-js
 thanks @LarryBattle - I definitely do not want to use cheerio as I need to fill in forms, click buttons etc. on the remote page before parsing it. I am looking into [SpookyJS](https://github.com/SpookyJS/SpookyJS) as well as into nightmare, but with nightmare I am not able to evaluate s simple value and extract it back into express at this time.
I do understand the purpose of generating values, it just doesn't click with me how to use them for scraping, especially if I have a series of remote tasks with multiple `.evaluate` blocks.
 Seconding this. In my case, I think the best bet is to switch back to a version older than 2.x.x for the moment.
  I just copied the `cnn.js` example from the docs here and started it with `node --harmony cnn.js`.
When it start, it _does not_ show any error or anything. It just stop when calling `Nightmare()` and do not go on nor terminate the application.
Everytime I try to call `Nightmare()` (in any code) it just stop on the function.

Further information:

```
Linux Mint 17.1 Rebecca
Node v0.12.2
"npm -v nightmare": 2.7.4
Node packages installed:
  npm install --save nightmare
  npm install vo
```

**Question 1:** Does Nightmare require some other package or applciation?
**Question 2:** Any idea why the function is locking the node application? It's just me?
 I tested `cnn.js` using node v0.12.2 and worked. 
The problem might be that you have a slow connection to cnn.com.
For simplicity, change the url to `example.com` and see if the `cnn.js` script works.

Or add this file to root of the nightmare directory and run this.
**nightmare_example_com_test.js**

```
var Nightmare = require('../nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
    if (err) throw err;
});

function* run() {
    var nightmare = Nightmare();
    var title = yield nightmare
        .goto('http://example.com')
        .evaluate(function() {
            return document.title;
        });
    console.log("Title: ", title);
    yield nightmare.end();
}
```

Expected output:

```
Title:  Example Domain
```
 Hi. Can you help me?

this is my test code:

```
var debug = require('debug')('test:nightmare');
var vo = require('vo');
var Nightmare = require('nightmare');

vo(run)(function(err, result) {
  if (err) throw err;
  debug(result);
});

function* run() {
  var nightmare = Nightmare();
  var title = yield nightmare
    .goto('http://www.bing.com')
    .evaluate(function() {
      return document.title;
    });
  console.log("Title: ", title);
  yield nightmare.end();
  return title;
}

```

It's works fine on windows. but the same problem that application stoped immediately on linux(centos)

This is my debug information`DEBUG=* node --harmony test.js`

```
  nightmare queueing action "goto" for http://www.bing.com +0ms
  nightmare queueing action "evaluate" +5ms
```

That's all the log...
  Hi,

It's possible to use each function ?
I would like to crawl comments and click on the paginate (javascript paginate) when there aren't comments.

Thanks,
  +1 for the issue
 @matthewmueller Could you provide a test example?
 in my case, after adding a .wait(selector) action into the test, it runs into this situation. Any idea? or solution?   
 The fix/hack is to add `process.setMaxListeners(0);` at the top of your script.
Source: http://stackoverflow.com/questions/9768444/possible-eventemitter-memory-leak-detected

To reproduce the warning message, remove `process.setMaxListeners(0);` from `test/index.js` then run the tests.

I wonder if there is actually a memory leak going on :question: 
 process.setMaxListeners(0); is making no difference here - definitely seems related to the use of wait().

mocha 2.3.3, node 4.1.2, nightmare 2.0.7
 Same problem here. process.setMaxListeners(0) did not make a difference.
 +1 for the issue
 +1 for the issue
 It seems to me that using nightmare in a long running/concurrent setup is prone to many errors and can cause all kinds of hiccups.

Firstly, there are _some_ things to consider when registering a global (process) event handler in the ctor of any class, but in this specific case it's pretty important to clean them up in _all_ cases that can be considered a shutdown/dtor scenario for nightmare: 
1. Shutdown via end()
2. Exit of child process
3. Inability to start child process
4. Exceptional exit

This also applies for some of the control flow, which can cause nightmare to hang if the electron process abnormally quits, as it does not reject in those cases (mainly never returning from `continue`).

I have created a preliminary feature branch on my fork of nightmare that tries to tackle these, but it's not cleaned up. Basically it tries to achieve multiple things:
1. Clean up after event listeners
2. Dynamically increase the maximum event listeners when more instances of nightmare are created on a single process
3. Handle abnormal exists (such as electron SIGSEGV/SIGBUS, exit code != 0, exceptions)
4. Set a `failed` state on the nightmare instance along the lines of `initial` and `ready` in case electron crashes/exits abnormally

I am not yet convinced this is the best solution, so I am not yet issuing a pull request, but you can take a look here: https://github.com/fr-/nightmare/commit/c22b45c8a9d4e6712ba236e4c16761a44198ab59

It does seem to work for largely concurrent runs in my test cases, though. Any input appreciated!
 My research: as @fr stated it's about a long test run but I believe it's related to number of tests rather than physical time (to be specific). In my case commenting one `.click(..., ...)` or `.type()` made it work without warning, but uncommenting any one of these made the warning occur again - tested many times. Adding `.wait(100)` doesn't bring the warning. What's more interesting (another bug probably), doing `.wait(100).wait(100)` hangs up.

By looking into https://github.com/segmentio/nightmare/blob/master/lib/actions.js I can see there's one common thing between `click()` and `type()` and not for `wait()` - it's a call to `this._evaluate` which can be found here: https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js I can see only a call to `once` in there. Not sure what's to be cleaned here, do you have some ideas about it, @fr?
 @Namek from what I can see there are multiple issues at the same time that also but not _exclusively_ manifest themselves in warnings about  about too many registered `uncaughtException` event listeners:
1. The most obvious one is of course, that the event listeners are registered on `process` (which is _global_) whenever a new Nigthmare instance is created and them not being removed after an instance is shut down.
2. Additionally there is a default maximum for listeners on any `EventEmitter` (10 is the default, as per: https://nodejs.org/api/events.html#events_emitter_setmaxlisteners_n) which can be increased (and depending on the node version queried) as need be. So in the legitimate case where more than 10 instances of Nightmare are created _concurrently_ this number has to be increased with the number of instances. _(as a side note: as there could be more code apart from nightmare that registers handlers on `process` one should also track the globally registered event listeners not created by nightmare)_.

The above points are being handled by the feature branch I posted, with the slight caveat that the meaning of _shutdown_ is a matter of definition, but can be classified as in my previous comment.

The second part of the issue is handling abnormal exits and failure to start the underlying electron process. In these cases one also needs to ensure that none of the actions that are waiting on `continue` will hang forever when the underlying electron and therefore the IPC has shut down and will never emit said event. My proposed solution is to:
1. Return from continue immediately after an abnormal shutdown of electron
2. Set a `failed` state on the instance of nightmare such that failure can be detected
3. Clean up global resources (aka global event listeners in this case)

So coming back to `_evaluate` @Namek: one thing that just occurred to me is that the `_evaluate` function you point to could possibly wait for `javascript` indefinitely if the electron process crashes while handling the inbound `javascript` event. I'd have to review the code again to be sure, though.

In any case, as far as I can see there seem to be no more implications other than the aforementioned leading to the behavior described; but I haven't really had the time to dig any further, which is why I was looking for more input on the branch.

Btw: The `wait(100).wait(100)` problem might very well be another issue that possibly can be fixed with #320 

As a general note: It does seem a bit unsafe to use `once` on the IPC as a control flow structure without handling exceptional cases...
 I'm also running into this, when using `.wait(fn)`.
 I have a pretty long running nightmare process that runs into this issue. it seemed fine until I got to the last method which involved setting and clicking a lot of form fields. I tried to move the code into just a couple of evaluate blocks to possibly keep the number of events down but that didn't seem to work.
https://gist.github.com/billpull/c8278fdf367455f4eb91

has anyone made any progress on this issue?
 One hack to get around the issue is to add

```
Emitter.defaultMaxListeners = 0;
```

to the ipc.js file in nightmare > lib.

Note that this is dangerous and could easily lead to memory leaks.
 +1 for the issue
 Still getting this using the latest version. `Emitter.defaultMaxListeners = 0;` in the ipc.js as recommended by @EmiPhil is the only way I could get these errors to stop, even using the latest version. `process.setMaxListeners(0);` did not work. I'm on win 10, node v5.5
 +1
 +1
 +1 
 +1
 +1
 +1
  Seems to be more performant, leaner, and has better error handling. Solves #279 
 no probs!
  Electron processes don't exit after tests finish.
Is it expected behavior?

If no, is it Nightmare issue?

Thanks!
 I found this too â€” I realised you need to call `end()` when you're done:

```
after(function*() {
  yield nightmare.end();
});
```

Hope that helps!
 @danhalliday , thanks!

Let's mention in docs?
  Let's use [mocha-generators](https://github.com/vdemedes/mocha-generators) instead of [co-mocha](https://github.com/blakeembrey/co-mocha) in tests?
It's more lightweight and predictable.
See also #275 .
 This issue should be closed.
  doing the following code, `console.log('after')` is called 1/10 times. most of the time it stays blocked

``` es6
  const nightmare = Nightmare()
  console.log('before')
  const objects = yield nightmare
    .goto(url)
    .evaluate(function () {
      return 'noop'
    })
  console.log('after')

  yield nightmare.end()
  return objects
```
 `http://fd5-courses.leclercdrive.fr/magasin-069401-Vitry-sur-Seine.aspx`
 i just tried it now (i don't use nightmare for now) and it works !
thank you
  is it possible to block specific ressources ? (ie : images, css, or facebook scripts) as i only want to acceed to generated dom tree very quicly ?
 on `phantomjs-node`, we can do : 

``` js
page.onResourceRequested(function (data, request) { request.abort() })
```
 related to #258 maybe it should be considered as a duplicate
 Untested, but I'm wondering if perhaps https://github.com/kyungw00k/nightmare-webrequest-addon might be of some help. Might be a way in there to listen for certain types of resources and block their loading
  In trying to turn off cross origin policy using  `web-preferences: {web-security: false}` as specified in [Electrons options](https://github.com/atom/electron/blob/master/docs/api/browser-window.md#new-browserwindowoptions), I realized it hoses nightmare's use of the `web-preferences` setting. 

This PR fixes it.   Tests included.   It also provides a v2-compatible solution for https://github.com/segmentio/nightmare/issues/203. 
 :+1: Can you publish a release with this?
  I have problems with running the mocha test example, seems like some module version issue. I am running Arch Linux, tried both node v0.12 and v4.1.2 both have same problem.

The file is in directory `test/main-test.js`.

``` js
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {

  it('should find the nightmare github link first', function*() {

    var nightmare = Nightmare()
    var breadcrumb = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.url.breadcrumb')
      .evaluate(function () {
        return document.querySelector('.url.breadcrumb').innerText;
      });
    expect(breadcrumb).to.equal('github.com');
  });
});
```

Installed following modules `package.json`

``` js
{
  "name": "app-smoke-test",
  "private": "true",
  "description": "Flow testing",
  "version": "0.0.1",
  "engines": {
    "node": "~4.1.2"
  },
  "scripts": {
    "test": ""
  },
  "dependencies": {},
  "devDependencies": {
    "chai": "^3.3.0",
    "co-mocha": "^1.0.1",
    "mocha": "^2.3.0",
    "nightmare": "^2.0.7"
  }
}
```

Added `mocha.opts`

```
--slow 3s
--timeout 10s
--require co-mocha
```

Used following command line to trigger mocha runner which ends error, seems like some generators handling is broken `node_modules/.bin/mocha --harmony`. I also tried to run the nightmare package tests which works well.

The mocha result:

```
node_modules/.bin/mocha --harmony


  test yahoo search results
    1) should find the nightmare github link first


  0 passing (10s)
  1 failing

  1) test yahoo search results should find the nightmare github link first:
     Error: timeout of 10000ms exceeded. Ensure the done() callback is being called in this test.
```
 +1
@riston , any news?
@segmentio , can you help us, please?
 See https://github.com/vdemedes/mocha-generators instead of `co-mocha`
 @kuraga did you get the example working, I switched to your suggested `mocha-generators` library which seems to at least output errors. I am not sure why spawning an electron process fails ?

```
Error: spawn /home/risto/node_modules/nightmare/node_modules/electron-prebuilt/dist/electron ENOENT
    at exports._errnoException (util.js:746:11)
    at Process.ChildProcess._handle.onexit (child_process.js:1046:32)
    at child_process.js:1137:20
```
 That's something else. Reinstall Electron and Nightmare?
 True that's something else, made clean install and now it's working. Actually it seems the original test case should "work" from the test execution part. The only problem is that some of the test steps seems to fail which does not throw errors but instead timeout. This is really annoying problem when you have no clue where the test just broke.

```
    var nightmare = Nightmare()
    var breadcrumb = yield nightmare
      .goto('http://yahoo.com')
      .type('input[title="Search"]', 'github nightmare')
      .click('.searchsubmit')
      .wait('.url.breadcrumb')     // There is no such element on the page, no clear error just mocha test timeout
      .evaluate(function () {
        return document.querySelector('.url.breadcrumb').innerText;
      });
    expect(breadcrumb).to.equal('github.com')
```
 I got this issue too when I run mocha example, then I found that I should increase the timeout of mocha test suit by adding this line:

``` js
this.timeout(20000);
```

Should I create a pull request to add this fix?

``` js
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {
  this.timeout(20000); //<======= add this line
  it('should find the nightmare github link first', function(done) {
    var nightmare = Nightmare()
    nightmare
      .goto('http://yahoo.com')
      .type('form[action*="/search"] [name=p]', 'github nightmare')
      .click('form[action*="/search"] [type=submit]')
      .wait('#main')
      .evaluate(function () {
        return document.querySelector('#main .searchCenterMiddle li a').href
      })
      .end()
      .then(function(link) {
        expect(link).to.equal('https://github.com/segmentio/nightmare');
        done();
      })
  });
});
```
  In my project I implement a paste with some specified drop-in data but the code becomes a little ugly:
https://github.com/fritx/wxbot/blob/dev/preload.js#L249-L270
I wonder if there is any way better for a paste action, so we can do that in nightmare.

In addition, in some cases paste could be a better replacement of type, tricking around the input stuffs.
We could just do a brute paste instead of triggering some keydown/keyup event.
 @fritx Could you use [`.insert()`](https://github.com/segmentio/nightmare#insertselector-text) instead?  That sends text directly to the specified selector.
 Hey, @rosshinkley, i'm afraid not.
I need to somehow trigger the inputbox to react the action.
"Insert" does not trigger any event, but "Paste" does.
Paste can also bring images too (if copied).

``` js
document.execCommand('paste')
```
  The test case of 'type and click' doesn't ensure 'type' works
'type and click' passes even when 'type' types nothing
 Is there any problem still on this PR?
 Thanks ;)
  Add a comment about the `co-mocha` package, fixes #261
  I'm running some basic NightmareJS code on my Macbook and it works perfectly. But when I do the same on my CentOS cloud server on debug mode, I see all actions being queued and then the script terminates without any results. It's like the actual actions are never run.

Node, Electron and Python are all present. PhantomJS and CasperJS too. Any ideas?

Thanks.
  #257
  I don't know exactly whats going on, still pretty new doing development, but nightmare isn't working, and I'm getting this error below: 

`Uncaught Exception:
TypeError: Error processing argument -1.
    at TypeError (native)
    at NavigationController.loadUrl (/Users/myusername/Desktop/nightmare/node_modules/nightmare/node_modules/electron-prebuilt/dist/Electron.app/Contents/Resources/atom.asar/browser/api/lib/navigation-controller.js:59:24)
    at EventEmitter.webContents.(anonymous function) [as loadUrl] (/Users/myusername/Desktop/nightmare/node_modules/nightmare/node_modules/electron-prebuilt/dist/Electron.app/Contents/Resources/atom.asar/browser/api/lib/web-contents.js:79:27)
    at EventEmitter.<anonymous> (/Users/myusername/Desktop/nightmare/node_modules/nightmare/lib/runner.js:87:23)
    at emitOne (events.js:77:13)
    at EventEmitter.emit (events.js:169:7)
    at process.<anonymous> (/Users/myusername/Desktop/nightmare/node_modules/nightmare/lib/ipc.js:28:10)
    at emitTwo (events.js:87:13)
    at process.emit (events.js:172:7)
    at handleMessage (internal/child_process.js:685:10)`

Everything was fine before I updated... but I can't get the older version back
 @jppope To get an older version back you can do `npm remove nightmare` and then `npm install nightmare@2.0.5 --save`. Replace `2.0.5` with your desired version.

I also had an error like this when using the old syntax with v2, maybe that's the problem.
 I'm having a similar issue. I have a working installation with nightmare 2.0.5. I started a new project and installed the same version, but nightmare doesn't want to initialize. So maybe it's a dependency that is no longer compatible? I only have the one working installation now, and I would just copy it over, but I get the file names too long errors on copy.
 I can verify this issue as well on both OS X and Window 7. It worked fine with the old version, but I decided I wanted to upgrade and go back to do some refactoring and just can't get it to work at all. Could a dependency somehow be interfering as kanethal said? I will keep investigating. 

Here is an error log: 

```
$ DEBUG=nightmare & mocha anonymous.spec.js
[1] 1718


  anonymous users
    Start page
      1) should show form when loaded
TypeError: Cannot read property 'apply' of undefined
    at Nightmare.done (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:162:14)
    at Nightmare.next (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:140:28)
    at EventEmitter.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:150:12)
    at ChildProcess.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/ipc.js:28:10)
    at handleMessage (child_process.js:324:10)
    at Pipe.channel.onread (child_process.js:352:11)
TypeError: Cannot read property 'apply' of undefined
    at Nightmare.done (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:162:14)
    at Nightmare.next (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:140:28)
    at EventEmitter.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:150:12)
    at ChildProcess.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/ipc.js:28:10)
    at handleMessage (child_process.js:324:10)
    at Pipe.channel.onread (child_process.js:352:11)


  0 passing (323ms)
  1 failing

  1) anonymous users Start page should show form when loaded:
     Uncaught TypeError: Cannot read property 'apply' of undefined
      at Nightmare.done (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:162:14)
      at Nightmare.next (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:140:28)
      at EventEmitter.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/nightmare.js:150:12)
      at ChildProcess.<anonymous> (/Users/tim/Code/project_name/node_modules/nightmare/lib/ipc.js:28:10)
      at handleMessage (child_process.js:324:10)
      at Pipe.channel.onread (child_process.js:352:11)



[1]+  Done
```
 Also, for reference, here's the test script I was running:

```
var chai = require('chai');
var Nightmare = require('nightmare');
var expect = chai.expect;

module.exports = function() {
  'use strict';

  describe('anonymous users', function() {
    this.timeout(20000);
    var nightmare;

    before(function() {
      nightmare = new Nightmare({show: true});
    });

    describe('Start page', function () {
      it('should show form when loaded', function (done) {
        new Nightmare()
          .goto('http://yahoo.com')
          .click('.searchsubmit')
          .run();
      });
    });
  });
});
```

I'll post back if I learn anything new.
 I think I figured it out. Looking at this line:
https://github.com/segmentio/nightmare/blob/master/lib/nightmare.js#L162

It looks like the `run` method is expecting a callback, and if you don't pass one in it seems to be causing the error above.

Changing to this fixed it for me, alternatively you should probably pass in a done function from a testing framework for instance, I bet thats the intention with this.

```
.run(function() {
  console.log('DONE')
});
```

Should I open a pull request to at least throw a more helpful error here? Other people might get tripped up by copying/pasting examples online like I did.. :P (Example: http://weblogs.asp.net/mikaelsoderstrom/writing-end-to-end-tests-with-nightmare-js, a top result for using nightmare for testing)

Hope that fixes it for you @jppope!
 Actually the error that you have looks different.. sorry folks!
 Try this... passing the reference of done to the run() method should let the test run properly. 
var chai = require('chai');
var Nightmare = require('nightmare');
var expect = chai.expect;

module.exports = function() {
  'use strict';

  describe('anonymous users', function() {
    this.timeout(20000);
    var nightmare;

```
before(function() {
  nightmare = new Nightmare({show: true});
});

describe('Start page', function () {
  it('should show form when loaded', function (done) {
    new Nightmare()
      .goto('http://yahoo.com')
      .click('.searchsubmit')
      .run(done);
  });
});
```

  });
});
  `self` is not used in `waitms`
  The pdf method should accept options (based on the documentation). I fixed the method to really accept them.
Fixes #264 
  Hi!

Sorry if im doing this wrong but I cant get this to work.

Im trying to extract the following number from a page.
![image](https://cloud.githubusercontent.com/assets/420754/10215197/a4993186-681f-11e5-9514-86a45bafafab.png)
![image](https://cloud.githubusercontent.com/assets/420754/10215222/eeca3dcc-681f-11e5-9f38-2e29852c2977.png)

im using the following code:

``` javascript
import vo from 'vo';
import Nightmare from 'nightmare';


const url = 'http://www.jm.se/bostader/sok-bostad/#c=stockholm&ts=allapartmenttypes&vacant=true&tab=objects&listmode=box';
const selector = '#hitcountobjects';

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare();
  var count = yield nightmare
    .goto(url)
    .wait(5000)
    .evaluate(function (selector) {
      // now we're executing inside the browser scope.
      return document.querySelector(selector).innerText;
    }, selector);

  console.log(count);
  yield nightmare.end();
}
```

count is always undefined. Anyone know if this is possible?
 Hi @toppetoppe, I was having some issues with the loading of XHR/AJAX calls and using the option `show: true` when creating the Nightmare instance helped me debug, as you can see the window and how the page is loading with the console on the side.

``` javascript
var opts = {
  show: true
};

var nightmare = Nightmare(opts);
```

Hope it helps, maybe you just need to wait longer.
 I see that the text node I want is visible when I set `show = true`but count is still undefined
 anyone got any clue as to why this is not working?
 @toppetoppe This has nothing to do with Nightmare, but have you tried running the code directly in the Dev Tools console? Maybe there is another element matching your selector and `querySelector()` is returning only the first one in the DOM.
 Yeah, I have retrieved the selector using X-ray and that works just fine, but i would prefer to use nightmare.

DevTools console says the following:
![image](https://cloud.githubusercontent.com/assets/420754/10458427/06a92ad4-71cb-11e5-8b83-478d77d7db42.png)
 Then my only theory is that `selector` might not being correctly passed to the function to evaluate. I wonder if you'd be able to double check this by running Nightmare with with `show: true` and then:

``` javascript
.evaluate(function (selector) {
  // now we're executing inside the browser scope.
  window.alert(selector); // getting a console.error from Node is doable but harder
  return document.querySelector(selector).innerText;
}, selector);
```
 yeah, looks like that is the problem.
the following does nothing:

``` javascript
window.alert(selector)
```

this works.

``` javascript
window.alert(document.querySelector('#hitcountobjects').innerHTML); 
```

so to get the value i do the following now:

``` javascript
return document.querySelector('#hitcountobjects').innerHTML;
```

how should i pass selector to evaluate?
 According to the docs you're doing it right:

``` javascript
var selector = 'h1';
var text = yield nightmare
  .evaluate(function (selector) {
    // now we're executing inside the browser scope.
    return document.querySelector(selector).innerText;
   }, selector); // <-- that's how you pass parameters from Node scope to browser scope
```

Probably you should close this issue and open a new one saying that the example in the docs is not working for you, now that you know the cause.
  Update description in package.json since you guys aren't using Phantom.js anymore.

Electron ftw!
  This doesn't work:

``` js
nightmare.end();
```

But this does:

``` js
nightmare.end(function() {});
```
 Can we use this outside of a generator? Using a function is the only way to kill the process in this script file.

``` js
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.end(function () {});
```
  Is there any approach to network monitoring? Like in phantomJS
page.onResourceRequested = function(request) {
  console.log('Request ' + JSON.stringify(request, undefined, 4));
};

http://phantomjs.org/network-monitoring.html
 Not that I can see â€” depending on what you're doing I've managed to structure all my tests so that I `wait()` for new DOM elements (all my requests are XHRs to my backend API). YMMV
 Awesome!
  Are people opposed to using a real promise in `.then` method? I think it's confusing to name the method that when it's really a callback.
 Agreed. I'm currently wrapping the Nightmare chain in a promise and calling `resolve()` inside the fulfilled callback of the `.then()` method.

Besides, some methods such as `.screenshot()` are not even then-able (or I just can't make it work).
 I don't fully understand generators, so this may not make sense, but my understanding is that `yield nightmare.someAction()` sends a promise or async function to whoever is iterating over the generator, so `.then` is exposed to the control flow logic. For example in `vo(function* () {})`, `vo` would depend on the `.then` method.
 @matthewmueller Sure thing. In the following example, the `debug` message is never shown (using thenables instead of generators):

``` javascript
nightmare
.screenshot('./example.png')
.then(function() {
  debug('Screenshot taken');
})
.end();
```

In this other snippet, both `getTitle` and `.screenshot()` are never executed:

``` javascript
nightmare
.evaluate(findTitle)
.then(getTitle)
.screenshot('./example.png')
.end();
```

Hope it helps. I'm currently using version 2.0.5 because with 2.0.6 it doesn't even get passed the first `.evaluate()`.

I know you're all putting time and effort into this and I'm thankful, but the lack of documentation and consistency is making the experience to really be a nightmare...
 @FdezRomero â€“Â haha isn't nightmare a great name for a software library?

It would be helpful to specify and document the async interface for nightmare. Whether it is consumed by a generator function or some other pattern is outside the scope of nightmare.

Using a `.run` method seems like the simplest solution. You would end up with an API that looks like:

``` js
var title;

// callbacks
nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    })
    .run(function(err, res) {
        if (err) throw new Error(err);
        title = res;
    })
;

// or return a promise if no argument is passed in
myPromise = nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    })
    .run()
;
myPromise
    .then(function(res) {
        title = res;
    }).catch(function(err) {
        throw new Error(err);
    })
;
```

Which could then be consumed in a number of ways:

``` js
require('async').series([nightmare.someAction().run], function onEnd() {/*...*/});
require('co')(function* () { return yield nightmare.someAction().run(); })
    .then(/*...*/);

```

This would change the examples b/c you would need to end every method chain block with `.run`. Another option is to have every chainable method return a promise. This is how [petecoop/phantasma](https://github.com/petecoop/phantasma) works. The API is maybe prettier, but I think this adds unnecessary complexity. 
 Hi @matthewmueller,

I think I found the issue I was having with the undocumented use of `.then()`. I was chaining several actions like this (omitting the parameters for clarity):

``` javascript
nightmare
.evaluate()
.then()
.screenshot()
.then()
.end();
```

And saw that the next action didn't hook up with the previous part of the chain. I think this is why the `.then()` after the `.screenshot()` didn't run. Please correct me if I'm wrong as I'm still trying to get the inner workings of Nightmare.
 +1, Promises are getting ubiquituous in the Node landscape since 4.0. It's very surprising that you push a custom way of handling async calls. I love co and koa and generators, but Promises are yieldable by co, too. So offering a Promise-based API would let existing developers use generators if they want to, and be more open to newcomers.
  I am trying to click all the buttons with the same class. But its only clicking one button with the class name.

Is there any way, i can retrieve the collection of the button with the class name and loop over each item and click it? 
   Are there any arguments or return value? It might be good to use .end() consistently in the readme examples. It is only in the example at the end. Or maybe it's just confusing because no one knows how to use generators? I'm not sure what is going on in the chainable nightmare methods. In version one it used callbacks, so you had `nightmare.something().something().run(function onEnd() {})`. But how does v2 work?

``` js
var Nightmare = require('../nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare();
  var title = yield nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    });
  console.log(title);
  yield nightmare.end();
}
```
  How do I use this without a wrapper like `vo`?

This example works:

``` js
var Nightmare = require('../nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare();
  var title = yield nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    });
  console.log(title);
  yield nightmare.end();
}
```

But this does not:

``` js

var Nightmare = require('nightmare');

function *run() {
  var nightmare = Nightmare();
  var title = yield nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    });
  console.log(title);
  yield nightmare.end();
}

for (var i of run()) {
  console.log(i);
}

```
  fix #249
related #250
 it's my pleasure, thanks!
  Hello there,

I have been trying to use `.wait(fn)` and my script always got stuck at this point, so I started debugging the `waitfn()` function in `lib/actions.js`, adding some `debug()` like this:

``` javascript
function waitfn (self, fn, done) {
  debug('waitfn');
  self._evaluate(fn, function (err, result) {
    debug('_evaluate');
    if (result) {
      debug('Wait is done');
      return done();
    }
    else {
      debug('Waiting another 250ms');
      setTimeout(function () {
        waitfn(self, fn, done);
      }, 250);
    }
  });
}
```

And noticed that `waitfn()` stops iterating after a few cycles. This is the output:

```
  nightmare:actions .wait() for fn +26ms
  nightmare:actions waitfn +0ms
  nightmare:actions _evaluate +3ms
  nightmare:actions Waiting another 250ms +1ms
  nightmare:actions waitfn +254ms
  nightmare:actions _evaluate +2ms
  nightmare:actions Waiting another 250ms +1ms
  nightmare:actions waitfn +251ms
  nightmare:actions _evaluate +191ms
  nightmare:actions Waiting another 250ms +0ms
  nightmare:actions waitfn +252ms
  // missing a call to "_evaluate" here
```

Any idea why this is happening? `_evaluate` only gets called 2 or 3 times and I really don't know why...

Thanks,
Rodrigo
 I'm also facing the exact same problem. `waitfn` stops after 1-3 iterations. If I increase the timeout from `250` to `2500` or more the script executes successfully.
 Any progress on this issues?

`wait` family including `wait(selector)` and `wait(fn)` have the same problem
 +1
 seems that the bug isn't resolved yet, i'm on version 2.10. anybody has solution? thx  ~~Sorry for the extra field in package.json & a missing semicolon, but I think they could be fixed with the next bump clean~~ (cleaned) ;) fix #247 #242 
 @matthewmueller ok.
- No, forget the missing semicolon. ~~I meant it was I that had [missed a semicolon](https://github.com/segmentio/nightmare/pull/250/files#diff-9dcc65cc4a6c14eb4f81fbe4005301d0R41) in my PR commit, but just leave it ;)~~ (cleaned)
- Yes, with `node-integration` turned off:
  - Electron won't expose node stuff like `module/exports` to the web.
  - So we could correctly load any webpage with many scripts like jquery that depends on a `module/exports` detection.
  - Still, with a `preload` script we can inject anything with node access just like what we do, but only at the very beginning.
  - We have to do so. It's the only way to load normal webpages in electron correctly.
  - And this should get it loads even faster than before, without node integration which is unnecessary around the user webpage itself.
  - As a change, the `preload` script should be the only way that we write things in node to get nightmare page ready.
  - Most importantly, it fixes a **security** bug, as in `node-integration` a webpage can hack into the user system in javascript. eg `require('fs')`.
 See also: https://github.com/sindresorhus/caprine/blob/master/index.js#L39
It's a hot electron app that loads facebook messenger, and it sets like this.
 Let me clean my commit to become better.
Done. Also, the `jquery` test slice placed before `font`.
 @matthewmueller once this problem solved, in #249 i'd suggest we replace `google.com` with `github.com`, and it'd get to work. ;) and my [project](https://github.com/fritx/wxbot) is gonna switch back to nightmare.
 cool, thanks much! @matthewmueller 
  OK, so I may have gone too far down the rabbit hole:
I have a script that is working nicely. Now I want to wrap some of this up into methods on my own objects and stay DRY. When I execute this function:

``` javascript

var go =  function(sel, attr){
  var resp= n.evaluate(function(sel, attr){
    return document.querySelector(sel)[attr];
  },sel, attr)
  return resp;
};

vo(function* () {
var init= yield n
    .goto(scraper.start)
    .wait(500)

if(yield n.exists(scraper.id[0])){
    var scrape= yield go(scraper.id[0], "innerText");
    scraped.push(scrape);
  }
```

Everything runs fine; but if I try to pass the nightmare instance to a method within my function WITHIN the generator, things fall apart, namely everything goes back to async mode and self destructs. How do I keep things running synchronously with vo.js when I want to pass a nightmare instance to a method within a function within a generator? I tried initially to call `yield` on the nightmare phrases in the methods like I did in the snippit above, but my console got mad at me and started saying very rude things about the method being an unexpected identifier when preceded by `yield`. This is what I am working with. I removed the offending yields already:

``` javascript
scrapes= {
      fixed: {
        init: function(sel, attr){
            var fixed = n
            .evaluate(function(sel,attr){
              for (el in sel){
                var q = document.querySelector(sel[el]);
                if(!!q){
              // add to fixed[el]
                  return q[attr];
                } else {fixed[el]=null};
              }
            },sel, attr);
            return fixed;
          },

        sel: {
          id: "[itemprop='name']",
        },
        attr: "innerText",
        // <<<<close fixed>>>>
    }

var goSuperScrape = function(scrapes){
      var pageload= n
        .goto(url)
        .wait()
var args = scrapes.fixed
    var scrape = args.init(agrs.sel, args.attr)
}

var n = new Nightmare();

vo(function* () {
  console.log('Nightmare Started');
  var auth = yield n
    .goto(login.url)
    .wait()

//login stuff here then fire up goSuperScraper to go to scraping page and scrape scrapables

var theInfos = yield goSuperScrape(scrapes);
```

I've been looking over the vo.js documentation and I'm starting to glean some knowledge, but I'm not smart enough to extend the examples to what I'm doing. Can I get a booster shot of smarts please!? 

Thanks, Dan.

PS, I'm wondering if I'm violating the purpose of this forum, and if I should post these kinds of help requests elsewhere. I'm really very new to this whole scene, and figured this is probably where people who are familiar with nightmare will be lurking. If I should put this kind of content up on stackOF instead, just let me know :) Thanks for all your awesomeness!
 3am jibber jabber, sorry.
  +1 for this, hope it works as well as the real user keyboard typing
 yes please!
 +1 If an `<input>` has a javascript powered input mask on it, `.type()` doesn't let you type into it. I think this is what's necessary to remedy that, because it works fine in CasperJS
  I haven't used Nightmare in about a month; I came back this morning, and it seems that a lot has changed, including removing any mention of plugins and .use(). Are they still available to use?
 +1, i rely heavily on plugins
 +1, please bring it back
 I believe this was fixed in #376.  Feel free to reopen/file a new issue if this is still a problem.
  I've cloned this repo and tried `make test`, it succeeded. Then I went ahead and modified the 'navigation' fixture, (html is appended in this message), to checkout Electron's JS abilities. Looks like absolutely no JS is running, I tried to do `.click('.a')` and instead of creating a `<div>` it took me to a.html (`.title()` was no longer 'Navigation' but 'A') I tried to take a screenshot right after `goto and wait(1000)` the `div#foo` was not rendered. So I'm quite sure JS doesn't run at all, that makes v2 inferior to v1? Am I missing something?

``` html
<!DOCTYPE html>
<html>
  <head>
    <title>Navigation</title>
  </head>
  <body>
    <a class="a" href="a.html">A</a>
    <a class="b" href="b.html">B</a>
    <a class="c" href="c.html">C</a>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script>
        $(document.body).append('<div id="foo">bar</div>');
        $('.a').click(function(e){
            e.preventDefault();
            setTimeout(function(){
                $(document.body).append('<div id="no">yes</div>');
            }, 2000);
            return false;
        });
    </script>
  </body>
</html>
```
 Looks like Electron doesn't like JS loaded from an external website. To fix your problem, simply load jQuery in this way:

 `<script src="http://code.jquery.com/jquery-2.1.4.min.js" onload="window.$ = window.jQuery = module.exports;"></script>`

Then your jQuery snippet below will be executed. You can find more details [here](https://github.com/atom/electron/issues/345).
 Okay I will try this, the other question is: why is nightmare not giving me any errors on this one. Like `$ "undefined is not a function"`. This would make it much simpler to debug.
 Agreed. 
This weird Nightmare "behaviour" took me some time to figure how to fix it. Nightmare should have an option for reporting all Electron error or debug messages.
 Okay i've just tried it and it looks like Electron gives the browser a package management system just like in node. So the browser has no longer to deal with global var. Instead of doing this onload hack, we can simply

``` html
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script>
        var $ = require('jquery');
        $(document.body).append('<div id="xxx">lolxxx</div>');
        $('.a').click(function(e){
            e.preventDefault();
            setTimeout(function(){
                $(document.body).append('<div id="omg">yes</div>');
            }, 2000);
            return false;
        });
    </script>
```

but we really need a way to access JS errors
 @matthewmueller Thanks for the hint. I've tried to listen to `error` event on `nightmare` on an example very similar to @antpaw's one, but with no luck (didn't see any errors). I was expecting something like `$ is not defined`.
 I am getting a lot of errors like $ is not defined, module ipc is not availiable, could not load jquery when i tried to login to linkedin using nightmare. Can you please tell how i can resolve this?
 @matthewmueller I've created this issue with a testcase #248 please help me :)
   Ok, definitely should rework this since node is already supporting yields and promises.
Should i remove this PR and start two separate forks?
 Also i thought that you should set proxy as
`.proxy(host, port, protocol)`
 Hey guys,

Any luck we'll see this PR merged anytime soon? Playing with cookies exactly what I am after for my tests :)

Cheers
 :+1: me too :)
 And me! :)
 Hey guys,
This PR has been going for some time now.. Is there anything we can do to help? Looks like there is only one test not passing against the build
  You guys have been so great getting to my questions. I'm still struggling up the learning curve with nightmarejs and vo.js and am hoping to get some help on syntax here. 

I read the responses for using V2 properly, and the response for URL() returning null was also very helpful. I've been working through the examples and the documentation for vo.js, but I admit I'm still confused on a couple things, any help would be great!

1) the example for console logging the URL includes console.log in parenthesis at the end of the line.

`javascript vo(function(){...})` 

This syntax was also given by Matt in response to the how to use V2 properly issue as a template for using a generator: 

`javascript vo(function (){yield...}(fn)` 

What is role of the final parenthesis set? Sorry, I'm sure it's an elementary question.

2) am I correct to assume that the instance if the browser within the generator is persistent? What would be the correct format to use nightmare to navigate to a sight, login, go to another page and grab data and put it into an array, then paginate and continue scraping values for the array, all while maintaining the authentication?

I'm so sorry if this is all very newbish, I'm so excited to be learning your module though and hope the questions are constructive at least :)
 Thanks so much Matt. I'm happy to say that after digging way down into the
previous issues you guys have already responded to and reading over the
test material I have a working version of my script!! I'm so excited :) I'd
be happy to submit some of the learning process I went through to get up
and running if you think it would help your other novice users! Thanks
again. Dan.
On Sep 22, 2015 10:06 AM, "Matthew Mueller" notifications@github.com
wrote:

> no worries man, we were all new to this stuff at one time
> 
> 1) vo uses a technique called currying
> https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe.
> Comes from a functional programming, and allows you to progressively build
> up functions before executing. The reason this is useful is that it allows
> for you to easily compose pipelines together: vo(vo(...), [vo(...),
> vo(...)]) for example.
> 
> Truth be told, I wasn't planning on keeping vo(...) in here, it's just a
> library that I like. You can easily use nightmare in other ways, using co,
> promises or callback functions. What I'd like to avoid is like what's
> going on in the react community, where it's just expected you know ES6,
> JSX, React and Flux to get started on just about any documentation, so let
> me know if this is preventing you from understanding nightmare better.
> 
> 2) Nightmare stores cookies across requests, but not across processes.
> This means that when your node program ends, the cookies are gone. We may
> add a way to load cookies, but I think it's actually more resilient to
> build in the login logic each time as opposed to loading temporary cookie
> files every time. Downside of course is that it's slower and might be
> suspicious that you're logging into the same account many times.
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/240#issuecomment-142350807
> .
  I am attempting to use NightmareJS to test a Polymer v1.0 application. So far I have been unsuccessful. I assume electron is the problem, but can't access any electron debugging information to verify this. Is there any way to get some feedback from electron while running NightmareJS?
  Hello, I am trying to use nightmare to perform load and stress testing of a web application where e.g. 20 concurrent users are expected. However, it appears that only 1 session is active and others are simply waiting, although I can see 20 phantomjs processes in task manager (using Windows 7).
Did anyone else also try this, does nightmare support such use case at all? Thanks for feedback!

Here is my script:

``` javascript
var Nightmare = require('nightmare');

var createTest = function (id) {
    return new Nightmare({timeout: 7200000})
    .log('#' + id + ' << BEGIN >>')
    .log('#' + id + ' ' + 'Starting to load')
    .goto('http://192.168.1.1:8080/webapp/index.jsf')
    .log('#' + id + ' ' + 'Page loaded')
    .log('#' + id + ' ' + 'Enter user/pass')
    .type('input[id="loginForm:tab:username"]', 'test')
    .type('input[id="loginForm:tab:password"]', 'xxxxxx')
    .screenshot('test' + id + ' ' + 'screen-1.png')
    .log('#' + id + ' ' + 'Click Login button')
    .click('button[name="loginForm:tab:btnLogin"]')
    .wait()
    .screenshot('test' + id + ' ' + 'screen-2.png')
    .log('#' + id + ' ' + 'Click APP button') 
    .click('button[name="overviewForm:j_id_d:j_id_q"]')
    .wait()
    .log('#' + id + ' ' + 'Enter 123456')
    .type('input[id="Search:j_id_c:j_id_s"]', '123456')
    .log('#' + id + ' ' + 'Click Search button') 
    .click('button[name="Search:j_id_c:j_id_z"]')
    .screenshot('test' + id + ' ' + 'screen-3.png')
    .wait('form[name="App:SomeInfo"]')
    .wait(2000) // wait 2 more seconds to finish the chart animation
    .screenshot('test' + id + ' ' + 'screen-4.png')
    .log('#' + id + ' ' + 'View search page')
    .log('#' + id + ' << END >>');
}

var runTest = function (test) {
    test.run(function (err, nightmare) {
      if (err) return console.log(err);
    });
}

var tests={};

var numTests = 20;

console.log('Preparing ' + numTests + ' tests');

for (i=1; i<=numTests; i++) {
    tests[i] = createTest(i);
}

console.log("Executing tests");

for (i=1; i<=numTests; i++) {
    runTest(tests[i]);
}
```
 Tried the script using the latest version of NightmareJS in an Ubuntu 14.04 virtual machine. I removed the timeout and set show to true. Although I can see things happening now in parallel, not all instances finish and hang at waiting for a selector (removing the long timeout didn't raise any error). Tried it also with only 5 instances, and only 3 finished. 
Could it be related to https://github.com/segmentio/nightmare/issues/251 or https://github.com/segmentio/nightmare/issues/171?

Are there any known issues with Electron instances running in parallel from the same process?
 Do you have an idea if the problem is somewhere in nightmarejs or in electron? Would be very interested in helping to fix it.
 If the electron processes are all using the same temporary directory (because the app name is the same) could this cause issues? See https://github.com/atom/electron/blob/master/docs/api/app.md#appgetpathname
 @rosshinkley I have this problem with the latest version installed today. Interestingly enough, this happens on an Ubuntu box and a Mac, but on Windows, it's fine. I've come to expect the opposite usually.
 +1. 
I have a similar case: a lot of links (>15k), processed by bunch (10-50) in a loop, for each of it I run async function where new Nightmare instance is created. I also use Promise.all(arrayOfFunctions). 
As the result after some time (depends on the number of links you have in a bunch) 1 of electron processes hangs, sometimes - even before DOM is ready, but sometimes - between evaluate() and end() invocations.
When I dumped Nightmare instance of hung process I saw that the proc.status code is SIGSEGV.
 Hi! Did someone find a solution to run multiple nightmare instance on the same machine at the same time ? Once i launch 4-5 times the same script some of them hang and finally timeout on a .wait() or a .goto()  `after` and `util` are not used in test/index.js.
  Hello! I noticed that installing nightmare also brought in x-ray-phantom. Is there support for using x-ray with nightmare?
 Looking forward to it :)
On Sep 20, 2015 8:59 PM, "Matthew Mueller" notifications@github.com wrote:

> yikes, it shouldn't have. x-ray will be a user of new nightmare very soon
> though ;-) just trying to work out the details
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/236#issuecomment-141871251
> .
 So I'm a big fat liar, no x-ray-phantom module in nightmare. I don't know what I was thinking. Many apologies :)
  In a previous version there was an `upload` function in `lib/actions.js`, as far as I understand after switching to Electron the functionality was removed, its because is not supported by Electron or was not implemented yet?

Is there an obvious way on how to upload files and I missed it?
 +1
 Any news on this issue?
 I don't think so.  Electron does not directly allow a way to intercept requests for uploads [like it does for downloads](https://github.com/atom/electron/blob/master/docs/api/session.md#event-will-download).  I've seen it discussed in the Electron issues, most notably [#749](https://github.com/atom/electron/issues/749) and [#3999](https://github.com/atom/electron/issues/3999), but as far as I know, it's still an open problem.
 @rosshinkley True... Saw these issues too. :+1: 
 +1
 I just tested [this](https://github.com/electron/electron/issues/749#issuecomment-213822739), and it actually works really well. I'll see if I can find the time and make a PR to add this.

If someone else beats me to it, I'm totally fine with that :)
 its work: https://github.com/rosshinkley/nightmare-upload  Great work guys.  I switched over to the atom editor in May and have been impressed with the stability of atom-shell (now electron).  Nice choice of dependencies for browser automation!

Cheers!
  #232
 Thanks! Im a contributor now!
  A non connected node process in the IPC emitter would cause electron to
break.
 Got this problem as soon as I started with v2.0. trying to run mocha tests locally with a react app. 
  Help, I broke nightmare :(

I did this:

``` javascript
var Nightmare = require('nightmare')

Nightmare()
.goto('http://google.com')
.screenshot('goog.png')
.url(function(link) {
  console.log('url is: '+link)
})
.run()
```

And got back a screen shot of google.com and null for the URL.
If I `.url()` before `.screenshot()` then it hangs the process before generating a screenshot, so I'm guessing I'm just using this wrong. Any sagely words of wisdom?

I noticed that all the documented examples here are using `yield`. Is it necessary to use generators to execute nightmare properly? 

I'm following usage examples from [http://www.devsbytes.com/browser-automation-with-nightmarejs.html](http://www.devsbytes.com/browser-automation-with-nightmarejs.html) and [https://azurelogic.com/posts/web-scraping-with-nightmare-js/](https://azurelogic.com/posts/web-scraping-with-nightmare-js/)

Has the proper usage changed from these examples (I understand you released a new version)

Thanks in advance! Dan
  See stack post http://stackoverflow.com/questions/32612868/running-electron-atom-shell-headlessly-on-linux-server-through-nightmare-js
  I was trying to setup e2e test environment with nightmare and mocha. I get stucked with example from readme. Then I tried to run nightmare standard test against my application and got this stack trace.

OS: Ubuntu 14.04
Node: 4.0.0

```
 Nightmare
    âœ“ should be constructable
    navigation
      1) should click on a link and then go back
      2) should work for links that dont go anywhere
      3) should click on a link, go back, and then go forward
      4) should refresh the page
      5) "after each" hook
Error: IPC channel is already disconnected
    at ChildProcess.target.disconnect (internal/child_process.js:630:26)
    at Nightmare.done (lib/nightmare.js:158:17)
    at Nightmare.next (lib/nightmare.js:140:28)
    at EventEmitter.<anonymous> (lib/nightmare.js:150:12)
    at ChildProcess.<anonymous> (lib/ipc.js:28:10)
    at handleMessage (internal/child_process.js:685:10)
    at Pipe.channel.onread (internal/child_process.js:440:11)
events.js:141
      throw er; // Unhandled 'error' event
      ^

Error: IPC channel is already disconnected
    at ChildProcess.target.disconnect (internal/child_process.js:630:26)
    at process.<anonymous> (/home/yoihito/Work/expedite/ls-portal/node_modules/nightmare/lib/nightmare.js:58:15)
    at emitOne (events.js:82:20)
    at process.emit (events.js:169:7)
    at process._fatalException (node.js:211:26)
```
 How can I get electron's error log?
  Hello, so far I'm loving nightmare as a much more semantic use for phantomjs. I've been able to login to the site I'm gathering data from, and got screenshots confirming I am working on the correct page. But I am having trouble working the evaluate feature. I followed the tutorial here: https://azurelogic.com/posts/web-scraping-with-nightmare-js/  and then adapted it to my use case. I have now found this tutorial to maybe be out of date because I get errors when I execute it verbatim. 

I'm confident I am simply using this wrong, so any correction will be very welcome. I am not getting any console output for except for 'I suck', which I do :(

``` javascript
var nightmare = require('nightmare');

var n= new nightmare()
  .viewport(1000,1000)
  .goto('A URL')
  .wait()
  .screenshot('pic1.png')
  .type(login.idfield , login.id)
  .screenshot('pic2.png')
  .type(login.pwfield , login.pw)
  .screenshot('pic3.png')
  .click("input.cartaccountlogin")
  .wait()
  .screenshot('pic4.png')
  .goto('ANOTHER URL')
  .wait()
  .screenshot('pic5.png')  <===== This picture shows the intended page with login intact
  .evaluate(function (){
    return document.querySelector('body'); <==== confirmed this selector is working in chrome.
  }, function(res){
    var out = res
      console.log('eval output') <====== no action here
    console.log(out)   <===== no action here
  })
  .run(function(err, nightmare){
    if (err) return consoloe.log(err);
    console.log('I suck');  <==== plenty of action here //I suck
    })
```

Again, I'm sure I am just using this wrong. I've followed the examples as closely as possible but I must be missing something.
 Thanks for the response! I have copied in your lines in place of my .evaluate. I don't see a change in the console output as seen here:

```
node test.js
[4592:0916/204719:INFO:renderer_main.cc(200)] Renderer process started
[11220:0916/204723:INFO:renderer_main.cc(200)] Renderer process started
I suck
```

I also put in some more console.logs to see if I can get static feedback, but there was no change in the console output.

``` javascript
.evaluate(function (){
    console.log('eval function')
    return document.querySelector('body').innerHTML;
    } ,function(res){
      console.log('eval res function')
      console.log(res)
    })
```

I checked on the version and I pulled v2.02. Are there some other dependencies I need to include? Right now I have python 2.7, node, phantomjs available to PATH, and nightmare and that's everything. Thanks again for getting back, I appreciate your interest!
 Thanks Chris, I really appreciate your help here. I was able to get an
evaluation to work successfully!
On Sep 21, 2015 2:44 PM, "Chris Sperandio" notifications@github.com wrote:

> gotcha, makes sense then! the method signature for evaluate changed in
> 2.0.0, it only takes a single callback function now that the IPC works a
> bit differently:
> https://github.com/segmentio/nightmare/#evaluatefn-arg1-arg2
> 
> looks like you're after something along the lines of:
> 
> var body = yield nightmare()
>   .viewport(1000,1000)
>   .type(login.idfield , login.id)
>   .type(login.pwfield , login.pw)
>   .click("input.cartaccountlogin")
>   .wait()
>   .goto('ANOTHER URL')
>   .wait()
>   .evaluate(function (){
>     return document.querySelector('body').innerHTML;
>   })
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/226#issuecomment-142118129
> .
  Hello, I'm a newbie of nightmare, got this error: "Syntax error: unexpected identifier" for the below code
var nightmare = Nightmare();
function login () {
       var a = yield nightmare
    .goto('http://somewebpage.com')
}
Anyone can help.
 Thanks Matt, now I have a problem running nightmarejs on linux server (it does not do anything even throw exception/error). I guess I have the same problem as issue #228 . Please help
  I've taken the cnn.js example, and my only change is changing the require line from ../nightmare to nightmare, but when I run it I only get...

> DEBUG=nightmare node --harmony cnn.js

```
nightmare queueing action "goto" +0ms    
nightmare queueing action "evaluate" +5ms
```

I don't ever seem to get the title of the page.

I've tried various other examples from Nightmare < 2 from around the web, and I can't get any of them to work either. Nothing ever errors, I just never seem to get any screenshot, pdf or elements pulled off the page in the output.

After 4 hours of bashing my head, I'm not sure what else to try.
 I tried this and got it returned properly.

```
nightmare queueing action "goto" +0ms
nightmare queueing action "evaluate" +1ms
Breaking News, U.S., World, Weather, Entertainment & Video News - CNN.com
```

But if I tried with a website that have a SLL problem, like below, it hang there for, forever. 

```
    vo(run)(function(err, result) {
      if (err) throw err;
    });

    function *run() {
        var title = yield nightmare
        .goto('https://cas2.northport.com.my/myapp/wa/r/nmbctr')
        .evaluate(function() {
            return document.title;
        });
        console.log(title);
        yield nightmare.end();
    }
```

It just hang here. No error, and electron no exited.

```
    nightmare queueing action "goto" +0ms
    nightmare queueing action "evaluate" +1ms
```
 What's your environment for running the cnn.js script?

Entirely headless server, or in a terminal in an existing X session, or OS X etc?
 I do have the same issue on a headless server. Everything runs correctly on OSX but not on my build server.
 Odd that at least you get an error message when I don't. Mine just fails silently.

My guess is that it can't get the framebuffer, which is where xvfb would normally come in. But I've tried running electron with that too and just get gtk errors.
 That doesn't solve it for me on my environment. Still no errors, but still no title from the CNN example either.

I had previously got Gtk3::Webkit Perl module running, which also uses xvfb, and had everything installed except libxss1 already. So I know my xvfb works.

Going round in circles trying to find suggestions. I see the same as this person when running electron through xvfb-run, https://gist.github.com/AspireToCodeBetter/130877925f52c8fb2557. 

And the Stack Overflow question points people here, http://stackoverflow.com/questions/32612868/running-electron-atom-shell-headlessly-on-linux-server-through-nightmare-js. 
 Hey! That did it. I can now start Xvfb on display 9 as you posted before, then I can now run the cnn example.

Looks like it was an incomplete Electron install before.

So can you modify your launch of electron process to use xvfb-run?
 I was thinking something like this as a variation on your steps, which is how I had run Gtk Webkit .

```
xvfb-run --server-args="-screen 9 1280x2000x24" ./electron
```

That does seem to launch correctly and the renderer process starts. So I'm not sure if you can do something similar from your JS and then do the IPC with that process.
 Actually, this works, without having Xvfb running in the background first as per your previous steps...

```
DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" node cnn.js
```
 @richard5mith thanks for that, runs for me now on my build server!
 @matthewmueller that might help:
https://github.com/shippableImages/minBase/blob/master/ubu1204/01base/containerSetup.sh
https://github.com/shippableImages/minBase/blob/master/ubu1204/01base/xvfb.sh

Using the shippable container to run nightmare and mocha.
 @matthewmueller I've narrowed it down to `apt-get update && apt-get install -y xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic x11-apps clang libdbus-1-dev libgtk2.0-dev libnotify-dev libgnome-keyring-dev libgconf2-dev libasound2-dev libcap-dev libcups2-dev libxtst-dev libxss1 libnss3-dev gcc-multilib g++-multilib`

Hope that helps!
 I'm unable to fix [my #223 Heroku deploy](https://github.com/segmentio/nightmare/issues/223). Updated to Nightmare v2.0.6 and tried custom buildpacks but couldn't sort it out.  Has anyone used xvfb on Heroku?
 @matthewmueller https://github.com/Rob--W/node-xvfb might be of use for controlling the xvfb server.
 @notsentient Jabin, Simply Wall St looks outstanding.  Good find on the xvfb module.
 same issue there.
@dylanvalade did you find out how to make it work ?
 @jney Unfortunately, I had to change my plan. Using Phantom now and this explains the setup.
http://stackoverflow.com/questions/22116673/cannot-find-module-phantomjs-in-heroku/32853675#32853675

After this Linux issue gets sorted out I would much rather use Nightmare.
 This

```
apt-get update && apt-get install -y xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic x11-apps clang libdbus-1-dev libgtk2.0-dev libnotify-dev libgnome-keyring-dev libgconf2-dev libasound2-dev libcap-dev libcups2-dev libxtst-dev libxss1 libnss3-dev gcc-multilib g++-multilib
```

and 

```
DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" node cnn.js
```

worked for me, might be worth updating the doc for since this is going to be mostly used on headless servers.
 +1 I also have it running relatively painlessly using 'xvfb-run', after trying and failing to get it connected to a separate 'xvfb' process.
 Did not work for me :(
Have all packages installed, using master from nightmare, headless Ubuntu 14.04.3.
No error messages, just hangs. Works fine on Mac

EDIT: works with sudo, not perfect but it's something
 Not work for me either after tried install `xvfb-run`

```
âžœ  nightmare  DEBUG=nightmare* xvfb-run --server-args="-screen 0 1024x768x24" node --harmony test.js
  nightmare queueing action "goto" for https://www.taobao.com +0ms
  nightmare queueing action "evaluate" +6ms
```
 sudo yum install xorg-x11-server-Xvfb
xvfb-run --server-args="-screen 0 1024x768x24" node --harmony cnn.js

worked for me on CentOS.
 @deinwort which version of CentOS and NodeJS are you using ?
 On CentOS 7, with xvfb-run is not working :

```
# xvfb-run --server-args="-screen 0 1024x768x24" node --harmony cnn.js 
  nightmare queueing action "goto" for http://cnn.com +0ms
  nightmare queueing action "evaluate" +2ms
```

```
# uname -a
Linux localhost 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
```

```
# node -v 
4.2.3
```
 Xvfb need more packages under Centos otherwise it will crash 

```
yum install xorg-x11-server-Xvfb  gtk2 libXtst GConf2 alsa-lib xorg-x11-fonts*
```

The best way to debug this, is by running electron directly:

```
xvfb-run --server-args="-screen 0 1024x768x24 -extension RANDR" ./node_modules/nightmare/node_modules/electron-prebuilt/dist/electron
```
 For those not familiar with Docker, here is the step by step once you've installed it (it needs a 64 bit modern distro & kernel).

In the nightmare source directory (from this repo), create a file named Dockerfile which has the content at the bottom of this post (@matthewmueller I had to make some edits, including  replacing `FROM node:5` with `FROM node:4.2` for version pinning since 5.x is not LTS) then run:

`docker build -t nightmare-test .`

This takes a little while. Then:

`docker run nightmare-test`

expected result is:

```
Thu, 10 Dec 2015 15:03:07 GMT nightmare queueing action "goto" for http://cnn.com
Thu, 10 Dec 2015 15:03:07 GMT nightmare queueing action "evaluate"
Thu, 10 Dec 2015 15:03:07 GMT nightmare running
Breaking News, Daily News and Videos - CNN.com
Thu, 10 Dec 2015 15:03:25 GMT nightmare running
```

My Dockerfile is:

```
FROM node:4.2

# Updating ubuntu packages
RUN apt-get update

# Installing the packages needed to run Nightmare
RUN apt-get install -y \
  xvfb \
  x11-xkb-utils \
  xfonts-100dpi \
  xfonts-75dpi \
  xfonts-scalable \
  xfonts-cyrillic \
  x11-apps \
  clang \
  libdbus-1-dev \
  libgtk2.0-dev \
  libnotify-dev \
  libgnome-keyring-dev \
  libgconf2-dev \
  libasound2-dev \
  libcap-dev \
  libcups2-dev \
  libxtst-dev \
  libxss1 \
  libnss3-dev \
  gcc-multilib \
  g++-multilib

ENV DEBUG="nightmare"

# Add current directory to /app
ADD . /app

# Set current working directory as /app
WORKDIR /app

# Install npm packages
RUN npm install

# Default command. Assumes our file is index.js and our screen size is 1024x768
CMD npm install vo ; xvfb-run --server-args="-screen 0 1024x768x24" node index.js
```

My index.js for the CNN example (in the root project folder is:

``` javascript
var Nightmare = require('nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare();
  var title = yield nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
      return document.title;
    });
  console.log(title);
  yield nightmare.end();
}
```

@matthewmueller, if you want me to do a PR with the docker file, an example directory and documentation, let me know.
 index.js being the CNN example, right?

Yes, it's a good idea to use an ENTRYPOINT for that. Let me know what I can help with.

Note however that the ENTRYPOINT will require you to install the application dependencies through nightmare's package.json in this case. Use the exec form of ENTRYPOINT so it could be overriden, maybe?

You could also look at a node-onbuild (such as https://github.com/nodejs/docker-node/blob/master/4.2/onbuild/Dockerfile) for your base image.
 I have the same problem, I don't know what the cause is yet. I thought it might be in the encoding of the quotes & such but I don't think so anymore. Might be helpful to tail the logs if you know where the xvfb stuff goes (`docker exec nightmare tail -f /var/log/whatever_it_is.log`)
 After creating an app in in windows(Worked awesome) .. now its not running in fedora 64-bit.. I seriously think this is waste of time for everyone.. why dont you guyzz shut down nightmare, Its really nightmare for developers... All my time wasted, tried to fix for 2 days.... Unftunately its not giving any error messages... tried every steps....Its totally waste
 I have had no problem here. Have you tried the Docker approach @sriducati?
 @edasque thats the only step left bcos iam new to docker...  I tried almost all steps.. trust me,each and every dependencies i fixed for electron,scanned whole internet to fix this issue... spent 2-3 days.. but still not working...
 @matthewmueller I am sorry if my comment was offencive .I was very happy with nightmare when working on windows but suddenly all my app stopped working without any error messages... its really very hard...just don't know what to do now...
 @sriducati did you try using DEBUG=nightmare ? I think there might be a way to alter the verbosity but I can't recall.
 @edasque  ya i tried debug mode below is the result...

  [root@server ~]# DEBUG=nightmare node --harmony cnn.js
  nightmare queueing action "goto" for http://cnn.com +0ms
  nightmare queueing action "evaluate" +21ms
  nightmare running +3ms
 @sriducati  `nightmare` is base on [electron](http://electron.atom.io/) which doesn't have a good support on linux speciality with headlessly window. Best way to debug this on linux is to run first electron :
`./node_modules/nightmare/node_modules/electron-prebuilt/dist/electron` In most case, it's a dep/library missing. 
Docker solution may be a the best way for now.
 @younes200 thank you, tried your method as well...result is empty ... again the same prob when we try to run nightmare.. no errors.. no output  :(
 Good new everyone.. nightmare worked well with ubuntu 12.04 64-bit
 @sriducati could you please post your results here to help others too ;)
 @matthewmueller , @edasque , @younes200  Thank you all...After changing many operating sys versions... found simple fix Ubuntu 12.04 64-bit ;) 

```
root@server:~# xvfb-run node cnn.js
Breaking News, Daily News and Videos - CNN.com
root@server:~# node -v 
v5.3.0
root@server:~# npm -v
3.3.12
root@server:~# 
```

Its running on OpenVz VPS , No docker used... It would be great if anyone could replay to  https://github.com/segmentio/nightmare/issues/411 ,  I can write a complete help guide to install in VPS ... 
 @matthewmueller 
Why not put the solution/workaround in README ?
 I'm also having this issue. CentOS workaround didn't work for me.

Mine doesn't hang tho, it just quits.

```
$ DEBUG=nightmare node cnn.js
  nightmare queueing action "goto" for http://cnn.com +0ms
  nightmare queueing action "evaluate" +5ms
  nightmare running +4ms
```

I tried with `xvfb` but still the same issue

``` plain
$ DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" node cnn.js
  nightmare queueing action "goto" for http://cnn.com +0ms
  nightmare queueing action "evaluate" +5ms
  nightmare running +2ms
```
 It would be good to get a solution to this.
I need to get Nightmare.js running on a remote headless server.

I have a Digital Ocean virtual server running Ubuntu 14.04.3 x64
I have installed Node v5.4.1

Running my app ...
`$ sudo DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" node app.js`

Gives the following output in Terminal ...

```
   nightmare queueing action "useragent" +0ms
   nightmare queueing action "viewport" +3ms
   nightmare queueing action "goto" for http://www.bbc.co.uk +4ms
   nightmare queueing action "wait" +1ms
   nightmare queueing action "screenshot" +1ms
   nightmare running +0ms
```

No screenshot is created, and the final success message (that I get when testing on localhost) is never shown.
 Here, the same with a centOS docker image and node 5.5. :-/
 I worked latest nightmare on headless machine(docker node:4.2, docker-machine with virtualbox driver as host machine).
my dockerfile is

``` dockerfile
FROM node:4.2

# Updating ubuntu packages
RUN apt-get update

# Installing the packages needed to run Nightmare
RUN apt-get install -y \
  xvfb \
  x11-xkb-utils \
  xfonts-100dpi \
  xfonts-75dpi \
  xfonts-scalable \
  xfonts-cyrillic \
  x11-apps \
  clang \
  libdbus-1-dev \
  libgtk2.0-dev \
  libnotify-dev \
  libgnome-keyring-dev \
  libgconf2-dev \
  libasound2-dev \
  libcap-dev \
  libcups2-dev \
  libxtst-dev \
  libxss1 \
  libnss3-dev \
  gcc-multilib \
  g++-multilib

WORKDIR /opt/test
RUN npm install vo segmentio/nightmare
```

and execute

``` bash
Xvfb -ac -screen scrn 1280x2000x24 :99.0 &
export DISPLAY=99.0
node index.js
```

and index.js content is following.

``` javascript
var Nightmare = require('nightmare');
var vo = require('vo');

vo(function* () {
  var nightmare = Nightmare({ show: true });
  var link = yield nightmare
    .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('#uh-search-button')
    .wait('.ac-21th')
    .screenshot('screenshot.png')
    .evaluate(function () {
      return document.getElementsByClassName('ac-21th')[0].href;
    });
  yield nightmare.end();
  return link;
})(function (err, result) {
  if (err) return console.log(err);
  console.log(result);
});
```

but I don't want to write `"nightmare": "segmentio/nightmare"` to package.json. and my circle-ci test is failed.
 Guys, I couldn't run headless nightmare based on advices from this discussion. 
So, any news? 
I tryed few docker's, and it always stuck at `nightmare running +1ms` step..
 Just a note when trying to debug - set environment variables `ELECTRON_ENABLE_LOGGING` and `ELECTRON_ENABLE_STACK_DUMPING` true.
https://github.com/atom/electron/blob/master/docs/api/environment-variables.md

Then there should be more output.
 **msokk** thanks, 
but there is no new here: 

```
xvfb-run node test/index.js 
  nightmare queueing action "useragent" +0ms
  nightmare queueing action "goto" for http://google.com +5ms
  nightmare queueing action "type" +4ms
  nightmare queueing action "click" +1ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "inject" +1ms
  nightmare queueing action "evaluate" +0ms
  nightmare running +2ms
```

But it works good with the electrone: `xvfb-run electron test/electron.js`. And I get a data, that I'm waiting for. And also see tons of logs
  edasque's solution worked for me on Ubuntu 14.04 however my build server uses pm2 to run node. I can't get it to work with pm2. Any suggestions? I would hate to have to switch back to phantom. I've tried below:

pm2 start app.js --node-args="--expose-gc" -- DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" 

DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" pm2 start app.js  

DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" && pm2 start app.js 

pm2 start app.js --execute-command DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24" 

pm2 start DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24â€ app.js  

pm2 start DEBUG=nightmare xvfb-run --server-args="-screen 0 1024x768x24â€ app.js  
 I have the same problem as @huemans, I couldn't make PM2, xvfb and Nightmare play well together.

Any ideas?
 Still having issues with the same issue, I tried all of your solutions, everything works perfectly on OSX but when moved to the Linux server it doesn't provide any response. It's the same environment, same versions of node and nightmare etc. On linux it will just not show any output. Any ideas?

npm@3.6.0 /usr/local/lib/node_modules/npm
Air:nm sagi$ npm -l version
{ npm: '3.6.0',
  ares: '1.10.1-DEV',
  http_parser: '2.6.2',
  icu: '56.1',
  modules: '47',
  node: '5.7.1',
  openssl: '1.0.2g',
  uv: '1.8.0',
  v8: '4.6.85.31',
  zlib: '1.2.8' }

## 

# DEBUG=nightmare\* xvfb-run node cnn.js

  nightmare queueing action "goto" for http://cnn.com +0ms
  nightmare queueing action "evaluate" +9ms
  nightmare running +11ms
 Might be a problem with electron running headless in Linux.

root@Ubuntu-1510-wily-64-minimal /tmp/electron-quick-start # xvfb-run /var/www/growthy/nm/node_modules/electron-prebuilt/dist/electron --type=gpu-process --channel=25956.0.799365973 --no-sandbox --supports-dual-gpus=false --gpu-driver-bug-workarounds=2,51,63 --disable-accelerated-video-decode --gpu-vendor-id=0x1234 --gpu-device-id=0x1111 --gpu-driver-vendor --gpu-driver-version --v8-natives-passed-by-fd --v8-snapshot-passed-by-fd
[27268:0308/205209:FATAL:scoped_file.cc(29)] Check failed: 0 == IGNORE_EINTR(close(fd)). : Bad file descriptor
#0 0x000001ae0a1e <unknown>
#1 0x000001af6bab <unknown>
#2 0x000001af716d <unknown>
#3 0x000001af08c4 <unknown>
#4 0x000001aea530 <unknown>
#5 0x000001af083e <unknown>
#6 0x000001af06a8 <unknown>
#7 0x000002b6e10d <unknown>
#8 0x000002b6e015 <unknown>
#9 0x0000010a9fa1 <unknown>
#10 0x0000010a911a <unknown>
#11 0x000002ea776c main
#12 0x7f93b3386a40 __libc_start_main
#13 0x000000539f09 <unknown>

(That's the command that node is trying to execute)
 @huemans @FdezRomero did you solve that problem? I'm trying to run my nightmare app with PM2 but I can't make it work.
 @gabrielperales No, I haven't found a solution yet. The next thing I was planning to try is the [Headless](https://www.npmjs.com/package/headless) module, a wrapper for Xvfb directly from Node. But I don't know if it will play well with Nightmare. Let me know if you try it! 
 @FdezRomero Thank you for your answer. I have tried headless module... but it doesn't seems to work. I'll keep trying
 @FdezRomero @huemans I could do it with this module [node-xvfb](https://github.com/Rob--W/node-xvfb). I have done a test example [here](https://github.com/gabrielperales/nightmareHeadlessTest/blob/master/index.js) .
 I've got nightmare working in headless mode with code similar to the example from @gabrielperales. However, I do not think the code will work with pm2 (atleast I wasn't able to
 @SantoshSrinivas79 I have tried my code once... and I think it worked, I'll try it again later to be sure
 @gabrielperales - works perfectly, thank you!
 Anyone else running this on heroku and have it working? I'm getting crashing. Everything works fine locally. It works fine for websites on the smaller side, and using larger dynos occasionally lets it finish when it otherwise wouldnt indicating maybe some kind of memory thing?

```
$ node --version
v5.7.0
$ npm list | grep nightmare
+-- nightmare@2.2.0
$ DEBUG=nightmare* xvfb-run --server-args "-screen 0 1024x768x24" node cnn.js
```

I'm using all the deps outlined above. The last 3 lines of the log for running cnn.js.

```
nightmare:log did-get-response-details +3ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"alwaysOnTop":true,"webPreferences":{"preload":"/app/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}},false,"http://rtax.criteo.com/delivery/rta/rta.js?netId=4157&cookieName=crtg_trnr&rnd=10840509575&varName=crtg_content","http://rtax.criteo.com/delivery/rta/rta.js?netId=4157&cookieName=crtg_trnr&rnd=10840509575&varName=crtg_content",200,"GET","http://www.cnn.com/",{"cache-control":["no-cache"],"content-length":["158"],"content-type":["text/javascript; charset=utf-8"],"date":["Sat, 26 Mar 2016 01:38:45 GMT"],"expires":["Mon, 26 Jul 1997 05:00:00 GMT"],"p3p":["CP=\"NON DSP COR CURa PSA PSD OUR BUS NAV STA\""],"pragma":["no-cache"],"server":["Microsoft-IIS/8.5"],"x-powered-by":["ASP.NET"]}]
nightmare:log did-stop-loading +118ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"alwaysOnTop":true,"webPreferences":{"preload":"/app/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
nightmare:log crashed +0ms [{"sender":{"session":{"cookies":{},"webRequest":{}},"hostWebContents":null,"devToolsWebContents":null,"debugger":{},"_maxListeners":0,"_events":{"page-title-updated":[null,null],"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":28,"browserWindowOptions":{"show":false,"alwaysOnTop":true,"webPreferences":{"preload":"/app/node_modules/nightmare/lib/preload.js","nodeIntegration":false}}}}]
```

Looks like it's crashing in the renderer process. Planning on trying to upgrade electron to 0.37 and see what happens. Ideally i'd like to keep this on heroku, but maybe not in the cards. I can make a new issue if more useful.
 @benogle Unfortunately I don't think anyone have made it work on heroku. I tried a lot, but never did make it work. Now I follow this issue to see if anyone does i the future. Maybe when Chromium gets better at running headless.
 [I made a buildpack](https://github.com/benschwarz/heroku-electron-buildpack) for running Electron on Heroku. 

:cake: Works for me. YMMV. :tada: 
 Hi, I have updated [my example](https://github.com/gabrielperales/nightmareHeadlessTest) with a Dockerfile. That is all you will need to run your nightmarejs code in headless mode. I hope you can enjoy it.
 hey @benschwarz , how did you make it work with heroku? which dyno size were you using? mine is crashing after a certain (very small) amount of actions queued? I think I'm running into the whole heroku /dev/shm being too small (5 mb in heroku I believe, which is useless).
Also, I'm getting  electron:stderr Xlib:  extension "RANDR" missing on display ":99"., not sure if relevant...
 @rickmed I found it to be pretty unstable too (admittedly, on the 512m dyno), I decided to use phantomjs instead. I'd love to have used electron and nightmare, but instead I shipped phantomjs and had no issues since. I'm sure there is a simple reason that this is happening on heroku environments, but I just didn't have the time to spend on it. 
 Think I found the "best" answer:
- [Official Electron documentation on testing headlessly](https://github.com/electron/electron/blob/master/docs/tutorial/testing-on-headless-ci.md)

It shows what to put in `.travis.yml` and recommends the super-handy [xvfb-maybe](https://github.com/paulcbetts/xvfb-maybe) utility.
 Simple [gist](https://gist.github.com/lucasbrigida/f9d606a6888cbd1c7874a84607486c3e) with commands for run nightmare headless.
 Is this issue still a bug in nightmare, or it was fixed in any new version..?? I am not able to run nightmare on google appengine for node.js using any of provided solution. Asked regarding [this on stackoverflow](http://stackoverflow.com/questions/37625327/how-to-run-nightmare-js-on-google-appengine-for-node-js). Can someone answer my question over there.
 This is not a nightmare issue but an electron (chromium really) issue. @rosshinkley maybe this should be closed? 

@hhsadiq I'll try to help you via stackoverflow.

EDITED: for anyone interested in the answer: http://stackoverflow.com/questions/37625327/how-to-run-nightmare-js-on-google-appengine-for-node-js/37663861#37663861
 FYI:
- https://chromium.googlesource.com/chromium/src/+/master/headless/README.md
- https://bugs.chromium.org/p/chromium/issues/detail?id=546953
 # Solution with Docker

The simplest way i found to get it working with docker...

Dockerfile

```
FROM node:argon

RUN apt-get update &&\
    apt-get install -y libgtk2.0-0 libgconf-2-4 \
    libasound2 libxtst6 libxss1 libnss3 xvfb

WORKDIR /app

RUN npm install nightmare
COPY cnn.js .

COPY entrypoint /
RUN chmod +x /entrypoint
ENTRYPOINT ["/entrypoint"]

CMD DEBUG=nightmare node cnn.js
```

entrypoint

```
#!/usr/bin/env bash
set -e

# Start Xvfb
Xvfb -ac -screen scrn 1280x2000x24 :9.0 &
export DISPLAY=:9.0

exec "$@"
```

cnn.js

```
var Nightmare = require('nightmare'),
  nightmare = Nightmare();

nightmare.goto('http://cnn.com')
  .evaluate(function(){
    return document.title;
  })
  .end()
  .then(function(title){
    console.log(title);
  })
```

Build image

```
docker build -t cnn-example .
```

Then run and see the results

```
docker run cnn-example
Tue, 14 Jun 2016 13:38:35 GMT nightmare queuing process start
Tue, 14 Jun 2016 13:38:35 GMT nightmare queueing action "goto" for http://cnn.com
Tue, 14 Jun 2016 13:38:35 GMT nightmare queueing action "evaluate"
Tue, 14 Jun 2016 13:38:35 GMT nightmare running
Tue, 14 Jun 2016 13:38:51 GMT nightmare electron child process exited with code 0: success!
CNN - Breaking News, U.S., World, Weather, Entertainment & Video News
```

I'm using docker-machine with virtualbox driver
 I got GAE deploys working in a simpler fashion described here: http://stackoverflow.com/a/38447642/562915
 I got it working on Gitlab-Ci

```
image:  node:latest

before_script:
  # Install and start virtual screen
  - apt-get update
  - apt-get install -y libgtk2.0-0 libgconf-2-4 libasound2 libxtst6 libxss1 libnss3 xvfb
  - Xvfb -ac -screen scrn 1280x2000x24 :9.0 &
  - export DISPLAY=:9.0

  # Install npm dependencies
  - npm install --silent

build_job:
  script:
    - "npm test"
```
 @huemans, @FdezRomero, @gabrielperales, @SantoshSrinivas79 . To get nightmare working headlessly with pm2, you just need to wrap your mind around what Xvfb does, what xvfb-run does, how they interact with your node process, and how this interaction is facilitated.

Going to give you an idea of the basics and then tell you how to get this all going in pm2. Forgive me if I am oversimplifying things:
- Xvfb is a frame buffer which allows us to mock a desktop interface where, in this case, the electron browser can run.
- Xvfb sets a display number (the initial default is "99"). The application using the desktop must have an idea of this display number to use the frame buffer.
- xvfb-run (which is a shell script) is perfect for single process node applications as what it actually does (as far as I understand) is setup the Xvfb process, set the "DISPLAY" environment variable to ":99", and then spawn the process you specify with access to the environment variable so it can access the display.
- For PM2 to manage processes happily it must spawn all the processes that it controls. I think this is where xvfb-run falls apart with pm2. It creates processes that need to be controlled and then exits and pm2 doesn't like this.
- Instead what we can do is spawn two processes simultaneously (do what xvfb-run does essentially): one being Xvfb and the other being a process for your application, setting the display number and "DISPLAY" environment variable explicitly.
- The best way to spawn the two processes is to create a PM2 Process file json as explained [here](http://pm2.keymetrics.io/docs/usage/application-declaration/) in pm2 docs, and then use the pm2 start command.

This is what your process file would look like, substituting for your specific case:

``` json
{
  "apps" : [{
    "name"        : "<your_app_name>",
    "script"      : "<your_main.js>",
    "env": {
      "DISPLAY": ":99"
    }
  },
    {
      "name"        : "Xvfb",
      "interpreter" : "none",
      "script"      : "Xvfb",
      "args"        : ":99"
    }]
}
```

If you place this process file in the same directory as `<your_main.js>`, and feed the process file to  pm2, you're all set. Assuming we call the file `process.json` then you would execute this pm2 command to get the two processes started:

```
pm2 start process.json
```

Tested and working on Debian 8.
 Everybody is going astray. the bug is simple, **just get my F\* bot  to work**... and yet everybody is failing to give a simple answer.This is the oneliner that will save your day ( obviously if you have xfvb installed... modify to your needs.. this one is for slackware 14.1). 

*Note, on some systems "xvfb" is called "Xvfb" (capital X)  and in other "xvfb-run"

**DEBUG=nightmare\*  Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 & node --harmony app.js**

![p](https://cloud.githubusercontent.com/assets/5326525/18171925/2d70ec10-7053-11e6-86f6-dc38eddb2160.png)
 I got an image working based on this discussion, but when I create a screenshot, I don't see any text. Selecting any text via nightmare works though. Anyone ever seen that issue?

**SOLUTION** : I based my docker image on 'node:slim', after changing to 'node:6.6.0-wheezy' it works!
 I tried to install 
`this yum install xorg-x11-server-Xvfb  gtk2 libXtst GConf2 alsa-lib xorg-x11-fonts*`
but it doesn't work

Node version
- v6.4.0

Centos Version
- v7.2

Do centos work nightmarejs?
 From a performance POV, does anyone know how Nightmare running with Xvfb compares to PhantomJS as headless?
 @pelhage I haven't used phantomJS since Nightmare decided to bundle electron instead of webkit.  I think there are many reason you should choose Electron instead of phantom's webkit such as but not limited to : 
-Browser technology up to date with standards (unlike phantomJS webkit)
-Electron is becoming a defacto standard for automation testing and it will probably take over Selenium
 I used @mashaalmemon 's solution for my Scraper cron job, and it worked for the first day, but ever since I've been getting error messages in my log and my scraper won't run. Not sure how to decipher them, can someone maybe point me in the right direction or tell me what typically causes these errors?

Gist of logs https://gist.github.com/pelhage/3f43240a3bd36a7ec06cb09d06c3be92

EDIT: I fixed this by creating a new instance of Nightmare upon each cron job. My error was related to an instance of my scraper being run multiple times, as opposed to creating a new scraper each time.
 The ultimate solution.
`pm2 start --interpreter xvfb-run npm -- start`
 Has anyone successfully gotten Nightmare to work on Heroku? If so, can you share your Dockerfile?

Works locally. Seeing this when running on Heroku:

![image](https://cloud.githubusercontent.com/assets/7015626/20581656/3fdf4d24-b18f-11e6-93f7-2f3e39f94d09.png)



cc @rosshinkley  @stevenmiller888 Take a look at https://github.com/captain401/heroku-buildpack-xvfb. You'll also want heroku-buildpack-apt as in the instructions.

(You might also need to include libnotify4 and libxss1 in your Aptfile - let me know if I need to update the instructions.) My website was deployed on EC2, and I tried `sudo DEBUG=nightmare xvfb-run --server-args "-screen 0 1024x768x24" node app.js`, but it processes the request only once
![image](https://cloud.githubusercontent.com/assets/11835233/20952971/36eee936-bc6b-11e6-8cd0-7c59196ec66b.png)
 @otaviomedeiros : Hi ! Did u manage to launch multiple long script at the same time with this config ?
I tried and when i launch 4-5 times the same script on the same xvfb display it's hang and i got some nightmare .wait() timeout. 
Same if i launch multiple xvfb display and attach one script to one display. 
Seems that a docker instance can't handle many xvfb display... 
No error output from nightmare. Just a `Error: .wait() timed out after 180000msec` at last @Dachow : it's seems that you killed the electron child process before the other request had time to finish. show us your code ! @GautierT  Hi! I have ran it with express. The basic structure of code like this:
```
router.get('/', function (req, res, next) {
    nightmare
        .useragent('...')
        .goto('https://www.instagram.com/')
        .click('._aj7mu._taytv._ki5uo._o0442')
        .insert('form input[type="email"]', 'xxx@gmail.com')
        .insert('form input[type="password"]', 'xxx')
        .click('form button')
        .wait('article')
        .evaluate(function () {
            // return something
        }
        .end()
        .then(function(result){
            // some handlers
            res.render('body', {
                items: items
            });
        })
        .catch(function (error) {
            console.error('Search failed:', error);
        });
}
```
It processes the request only once @Dachow, that's because you are ending the instance on first run. @Dachow I think you can make a new instance everytime the route is called, if your resources can handle it so Folks following my original post on August 11, 2016 I have some more information to share. I noticed some others had similar problem that I just identified. 

Going back to my post you'll see I mentioned how to get nightmare.js working on linux via the use of pm2 and Xvfb. This still applies to a linux bare metal of vm installation.

However to run nightmare in a docker a few things to keep in mind:
-  You'll need to run your node.js script and Xvfb in the docker simultaneously. [pm2-docker](http://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/) is a good option for running multiple processes in a docker.
- I noticed that some folks had this all working in a docker except screenshots. Or they had situations where things were working in some cases but were not. Dockers have by default 64MB shared memory (/dev/shm). Electron (chromium) needs more shared memory so you'll need to increase this. Look into docker documentation to find out more but it can be done either as part of your "docker run" command or in your .yml files. See issue #587 .
- Lastly electron processes that are complete stick around as [Zombie processes](https://www.google.ca/amp/s/blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/amp/?client=safari). There are a few solutions out there. [dumb-init](https://github.com/Yelp/dumb-init) by the folks at Yelp took me about 5 minutes to setup. On my first run the many many defunct electron processes that used to be left behind are no more. 

Hopefully one or more of these points helps you folks. @GautierT, no need to have multiple Xvfb displays in my experience. One Xvfb display and as many simultaneous nightmare processes as your system can handle reasonably. One more thing that I encountered when trying to run using xvfb-run. Apparently, if a process executing Xvfb has pid 1, then Xvfb does not send SIGUSR1 which is what xvfb-run relies on.
More info here: https://codereview.chromium.org/1398053003/
Workaround could be as simple as running `/bin/bash -c "xvfb-run <command>"` Since the ~2 weeks ago Chromium support headless mode.

> With the latest Chrome Canary on Linux you can enable headless mode with the --headless command line flag. (https://bugs.chromium.org/p/chromium/issues/detail?id=546953#c148)

@matthewmueller @rosshinkley  Will this change in Chromium make any difference here?

Nightmare is awesome, and a headless mode (without xvfb) would be very useful! ðŸ¥‡ 

*(here is a related issue in Electron https://github.com/electron/electron/issues/228)* @sandstrom That's really cool! Looking forward to see it working in nightmare! Heroku just bumped the size of `/dev/shm/` on their dyno to allow headless browser test ðŸŽ‰.

https://devcenter.heroku.com/changelog-items/1085 I used `xvfb-run`, but got these error:

```
$ DEBUG=nightmare*,electron* xvfb-run --server-args="-screen 0 1280x2000x24" npm test -- --progress=false --single-run --watch=false

> linchang@0.0.0 test /var/lib/jenkins/workspace/customer-client-wx
> ng test --code-coverage "--progress=false" "--single-run" "--watch=false"


START:
(node:12768) DeprecationWarning: loaderUtils.parseQuery() received a non-string value which can be problematic, see https://github.com/webpack/loader-utils/issues/56
parseQuery() will be replaced with getOptions() in the next major version of loader-utils.
03 03 2017 15:24:45.811:WARN [karma]: Port 9876 in use
03 03 2017 15:24:45.813:INFO [karma]: Karma v1.5.0 server started at http://0.0.0.0:9877/
03 03 2017 15:24:45.814:INFO [launcher]: Launching browser Nightmare with unlimited concurrency
03 03 2017 15:24:45.819:INFO [launcher]: Starting browser Nightmare
Fri, 03 Mar 2017 07:24:45 GMT nightmare queuing process start
Fri, 03 Mar 2017 07:24:45 GMT nightmare queueing action "goto" for http://localhost:9877/?id=7995405
Fri, 03 Mar 2017 07:24:45 GMT nightmare queueing action "wait"
Fri, 03 Mar 2017 07:24:45 GMT nightmare queueing action "evaluate"
Fri, 03 Mar 2017 07:24:45 GMT nightmare queueing action "wait"
Fri, 03 Mar 2017 07:24:45 GMT nightmare running

Fri, 03 Mar 2017 07:24:46 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".

Fri, 03 Mar 2017 07:24:46 GMT electron:stderr Xlib:  extension "RANDR" missing on display ":99".

Fri, 03 Mar 2017 07:24:46 GMT electron:stderr [12818:0303/152446.458888:FATAL:platform_font_linux.cc(63)] Check failed: typeface. Could not find any font: Nimbus Sans L, sans
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #0 0x000001ccd51e <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #1 0x000001cb27cb <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #2 0x000003b48e3d <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #3 0x000003b48a7f <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #4 0x000003b49736 <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #5 0x000003b562f9 <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #6 0x000002a668ce <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #7 0x00000293abd3 <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #8 0x000003c13654 atom::api::WebContents::InitWithSessionAndOptions()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #9 0x000003c13dad atom::api::WebContents::WebContents()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #10 0x000003c1dd16 atom::api::WebContents::Create()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #11 0x000003c2f24f atom::api::Window::Window()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #12 0x000003c30b6c atom::api::Window::New()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #13 0x000003bece00 mate::internal::InvokeNew<>()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #14 0x000003becf90 mate::internal::Dispatcher<>::DispatchToCallback()
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #15 0x7fc91b24ceff <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #16 0x7fc91adf744b <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #17 0x7fc91adf6f09 <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr #18 0x2764fc7043a7 <unknown>
Fri, 03 Mar 2017 07:24:46 GMT electron:stderr 

Fri, 03 Mar 2017 07:24:47 GMT nightmare electron child process exited with code null: undefined

Fri, 03 Mar 2017 07:24:47 GMT nightmare electron child process not started yet, skipping kill.

03 03 2017 15:24:47.152:ERROR [launcher]: Cannot start Nightmare
	
03 03 2017 15:24:47.156:INFO [launcher]: Trying to start Nightmare again (1/2).
Fri, 03 Mar 2017 07:24:48 GMT nightmare queuing process start
``` @abcfy2 Man read the log there is a clue. I'll give you a hint `FATAL:platform_font_linux.cc(63)] Check failed: typeface. Could not find any font: Nimbus Sans L, sans`. Peace ;) It's a little strange. I find the `Nimbus Sans L` font exists. But after install some other fonts(I don't remember which font solved my issue, maybe `apt install -y fonts-noto`?), it works. Hey folks, I'm going to lock this conversation since there's a ton of good information available and each comment emails approximately 300 people.

If you have an issue with getting Nightmare working on Electron please first read through the comments here. If you cannot find an answer, open a new issue. Thanks!  My app works locally using the CNN example.  However, after a Heroku build and deploy this error is logged when Nightmare is called.

``` sh
Error: spawn /tmp/build_aa182f5bde01ee44f4dcea91b391b552/node_modules/nightmare/node_modules/electron-prebuilt/dist/electron ENOENT
     at exports._errnoException (util.js:837:11)
     at Process.ChildProcess._handle.onexit (internal/child_process.js:178:32)
     at onErrorNT (internal/child_process.js:344:16)
     at doNTCallback2 (node.js:429:9)
     at process._tickCallback (node.js:343:17)
 events.js:141
      throw er; // Unhandled 'error' event
      ^

 Error: IPC channel is already disconnected
     at ChildProcess.target.disconnect (internal/child_process.js:630:26)
     at process.<anonymous> (/app/node_modules/nightmare/lib/nightmare.js:58:15)
     at emitOne (events.js:82:20)
     at process.emit (events.js:169:7)
     at process._fatalException (node.js:211:26)
```

package.json includes

``` js
"dependencies": {
    "ejs": "^2.0.0",
    "express": "^4.0.0",
    "nightmare": "^2.0.2",
    "vo": "^1.0.3"
  },
  "engines": {
    "node": "4.0.x"
  },
```
 This is very different from #224 - this fails trying to start `electron-prebuilt`.

It looks like the `/tmp/build...` path comes from `electron-prebuilt` using `__dirname` in its install script, which has unexpected behavior on Heroku. This gets written into `path.txt` in `electron-prebuilt`. So I'm fairly sure it's a bug in `electron-prebuilt`.
 (Regretfully, after fixing this it does run into the same issue as #224 .)
 Hi, I am having the same issue on OS X (10.10.5) any ideas? Thanks.
 @felixcrive the fix I referenced above should be fixed in electron 0.36.0 - does it work if you use the `electronPath` option with that newer electron?
 @yoz I doesn't work I have electron-prebuilt@0.36.2 and Nightmare@2.1.2 pointing to electronPath.
  Changing the value of a field doesn't trigger the change and input event by default.
 Doesn't have to be very complicated, interested by the change event more than anything really.

It was on the other methods but not the type one. Do you think this can be merged in?
 @matthewmueller can this be merged in please?
 I need to test some simple things written in Angular, and $digest doesn't see the changes. Please, merge.
 @matthewmueller @reinpk is there an issue with the code, anything you want me to change, would be helpful to merge so I don't use my forked version in production.
 @pastawoua at least the `input` or `change` event you dispatch is missing some properties like `keyCode`, etc? it's not certain, and it might probably make something broken
 @fritx keyCode is not fired on `input` or on `change` events.

fyi, casperjs implementation: https://github.com/n1k0/casperjs/blob/master/modules/clientutils.js#L899

similar code than on the `check` method, not as robust as #244 but an easy fix for now.
 @pastawoua wrote a nice solution that works for me. But if you want to follow the code style, then check this:  

``` javascript
exports.type = function(selector, text, done) {
  debug('.type() %s into %s', text, selector);
  this._evaluate(function (selector, text) {
    var element = document.querySelector(selector);
    var event = document.createEvent('HTMLEvents');
    element.value = text;
    event.initEvent('change', true, true);
    element.dispatchEvent(event);
  }, done, selector, text);
};
```

So, focus() and blur() are unnecessary. At least while you're implementing the real cool things (sendKeys or simkey and a lot of more) please accept the pull request so we can use nightmare for testing. Thanks
 Not working for react apps. Really helps this:

``` js
            .type('input[name=password]', '1234')
            .evaluate(() => {
                document.querySelector('input[name=password]').dispatchEvent(new Event('input', {bubbles: true}))
            })
```
 @zerkalica I can confirm that `evaluate()` function works for Angular 2 forms as well.
 @zerkalica nice that info! Have you tried to type some text in a field? I know that $digest in Angular 1.4\* listens only events. So, the current version indeed types something but this is not enough. A change event should be fired. The solution given by @pastawoua is enough for me.
 @zerkalica Yes, I have a full end-to-end test for my Angular 2 app working using Nightmare. I work around the digest/diffing by `wait()`ing for DOM elements. It works surprisingly well (much easier than setting up Protractor, and less tightly coupled to Angular, too). Eg:

``` javascript
yield nightmare
  .goto(URL)
  .wait("#login") // <form>
  .type("#login-email", EMAIL).evaluate(() => { document.querySelector("#login-email").dispatchEvent(new Event("input", { bubbles: true })); })
  .type("#login-password", PASSWORD).evaluate(() => { document.querySelector("#login-password").dispatchEvent(new Event("input", { bubbles: true })); })
  .click("#login-submit")
  .wait("#toolbar");

var toolbar = yield nightmare
  .evaluate(() => {
    return document.querySelector("#toolbar").textContent;
  });

expect(toolbar).to.contain(USERNAME);
```
 @danhalliday Thanks a lot! I hope this kind of workarounds will be temporary. Soon we'll be able to call type(...) and go ahead with the next step.
 Some patch:

``` js

import Nightmare from 'nightmare'
import __debug from 'debug'

const debug = __debug('nightmare:actions')

const actions = {
    input(selector, text, done) {
        debug('.input() %s into %s', text, selector)
        this._evaluate(function (selector, text) {
            var elem = document.querySelector(selector)
            elem.focus()
            elem.value = text
            elem.dispatchEvent(new Event('input', {bubbles: true}))
            elem.blur()
        }, done, selector, text)
    }
}

class MyNightmare extends Nightmare {
}
Object.keys(actions).forEach(name => {
    const fn = actions[name]
    MyNightmare.prototype[name] = function() {
        debug('queueing action "' + name + '"')
        const args = [].slice.call(arguments)
        this._queue.push([fn, args])
        return this
    }
})

const nightmare = new MyNightmare()

nightmare
.goto('login-page')
.input('input[name=password]', '1234')
```
 @zerkalica Cool!
 Any progress on this?
 Would love to see this merged. Having to manually apply the patch at the moment.
 fyi, I gave up on having this merged and maintaining my forked version so we moved to http://nightwatchjs.org
  Based on the example give,

```
var Nightmare = require('nightmare');
yield Nightmare()
  .goto('http://yahoo.com')
  .type('input[title="Search"]', 'github nightmare')
  .click('.searchsubmit');
```

jshint telling me `A yield statement shall be within a generator function (with syntax: function*)`. Am I missing something to make this work?
  In previous version, there is this option `ignoreSslErrors` that can overcome the SSL error on the targeted page. How can I do this in V2? The instances options only resolve around the browser window of electron. The only thing related to HTTPs are the `allow-displaying-insecure-content` and `allow-running-insecure-content` but that can't overcome the SSL error.
 Well, you can try with this site: https://cas2.northport.com.my/myapp/wa/r/nmbctr

I just try to load it up, and take screenshot -- it never did. But if it was replaced with CNN site for example, it worked well.

It is not really failing, cause it didn't return any error, but it didn't do anything, so I'm suspecting this as one of the reason since the site do have SSL errors.

Is this option available in V2 or is it automatically set?
 This is the exact thing I do.

```
    import Nightmare from 'nightmare';
    import vo from 'vo';

    vo(run)(function(err, result) {
      if (err) throw err;
    });

    function *run() {
        var title = yield nightmare
        .goto('https://cas2.northport.com.my/myapp/wa/r/nmbctr')
        .evaluate(function() {
            return document.title;
        });
        console.log(title);
        yield nightmare.end();
    }
```

And nothing happened, which I suspect related to the SSL error, because it work with `1.8.2`. The electron pop and never quit.
 Hi, @idrakimuhamad.

It seems that we could achieve this using "--ignore-certificate-errors" switch, passing it through app.commandLine.appendSwitch in runner.js. I suggest new feature request in nightmare to provide such api for setting more advance options for electron. Associated electron issue: https://github.com/atom/electron/issues/1221

Also your example is a bit unclear â€“ for me it looks like it wont compile.

Here is mine:

``` js
process.env.DEBUG = "nightmare nightmare:*";

(function () {
  "use strict";

  var Nightmare = require("nightmare"),
    vo = require("vo");

  vo(function* run() {
    var nightmare = new Nightmare()
      .goto("https://cas2.northport.com.my/myapp/wa/r/nmbctr")
      .title();
    var title = yield nightmare;
    yield nightmare.end();
    return title;
  })(function (err, title) {
    if (err) {
      throw err;
    }
    console.log(title);
  });

}());
```

this is what i do

```
  nightmare queueing action "goto" for https://cas2.northport.com.my/myapp/wa/r/nmbctr +0ms
  nightmare queueing action "title" +5ms
  nightmare:log did-start-loading +964ms [{"sender":{"session":{"cookies":{}},"_events":{"crashed":[null,null]},"_eventsCount":21}}]
```

and this is the output (then it just got stuck).
OSX 10.10 / iojs v3.2.0 / nightmare v2.0.6.

---

Yup, just tried it. I've added the line `app.commandLine.appendSwitch('ignore-certificate-errors', 'true');` just right after imports in `runner.js` module. New output: 

```
  nightmare queueing action "goto" for https://cas2.northport.com.my/myapp/wa/r/nmbctr +0ms
  nightmare queueing action "title" +7ms
  nightmare:log did-start-loading +2s [{"sender":{"session":{"cookies":{}},"_events":{"crashed":[null,null]},"_eventsCount":21}}]
...
  nightmare:log did-finish-load +0ms [{"sender":{"session":{"cookies":{}},"_events":{"crashed":[null,null],"did-finish-load":[null,null]},"_eventsCount":20}}]
  nightmare:actions .title() getting it +1ms
NMB - CONTRAK-2/Client Access System (v1.3.7)
```
 Hey thanks @yura415 I'll try that out. My example of course, aren't complete. I've only showing the important part of the code, excluding the `module.exports` etc
 I'm not sure I follow this issue, but I was running into the same problem, essentially a blank white page with nothing loading, until I added `app.commandLine.appendSwitch('ignore-certificate-errors', 'true');` in `runner.js` after the imports. It seems like `ignoreSslErrors` doesn't cover all ssl errors? Monkeypatching nightmare doesn't seem like an awesome solution to the problem though.
  @reinpk While trying to find a way to accomplish https://github.com/segmentio/nightmare/issues/148 even though you closed it here: https://github.com/segmentio/nightmare/issues/148#issuecomment-139900939 I was reading the electron [window-open.md api documentation](https://github.com/atom/electron/blob/master/docs/api/window-open.md) and noticed that it said:

> When window.open is called to create a new window in a web page, **a new instance of BrowserWindow will be created** for the url and a proxy will be returned to window.open to let the page have limited control over it.

and thought this might cause the windows to be shown because I remember reading in [runner.js](https://github.com/segmentio/nightmare/blob/master/lib/runner.js#L33) that you hard code the options.show to false for the main instance of BrowserWindow.

Running the following code causes the spawned window to be shown for the duration of script. I left `nightmare.end();` out to exaggerate the issue.

``` javascript
var Nightmare = require('nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
  if (err) throw err;
});

function *run() {
  var nightmare = Nightmare();
  yield nightmare
    .goto('http://www.cnn.com')
    .evaluate(function() {
        window.open("http://www.google.com");
    });
  //yield nightmare.end();
}
```

We should probably hard code the show option within the browser-window function to false so that this doesn't happen.
 Hi @matthewmueller thanks for the reply and for the example.  Ultimately, I would like to use the nightmare api to interface with new windows.

Regardless of whether this repo decides to support this, the fact is some websites may spawn new windows on their own. When this happens, the windows are shown (instead of running headless) which is not the desired effect...

Like you said, we may need to open an issue on the electron repo. Instead of monkey patching window.open we may need to monkey patch browser-window function so it defaults to `{show: false}`.
 Okay, sounds good. Thank you.
  > myrubapa@myrubapa:~/httpdocs/phantomjs/tests$ npm install nightmare
> npm WARN package.json tests@1.0.0 No description
> npm WARN package.json tests@1.0.0 No repository field.
> npm WARN package.json tests@1.0.0 No README data
> 
> > weak@0.4.1 install /home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak
> > node-gyp rebuild
> 
> make: Entering directory '/home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build'
>   CXX(target) Release/obj.target/weakref/src/weakref.o
> In file included from ../src/weakref.cc:19:0:
> ../node_modules/nan/nan.h:261:25: error: redefinition of â€˜template<class T\> v8::Local<T\> _NanEnsureLocal(v8::Local<T\>)â€™
>  NAN_INLINE v8::Local<T\> _NanEnsureLocal(v8::Local<T\> val) {
>                          ^
> ../node_modules/nan/nan.h:256:25: note: â€˜template<class T\> v8::Local<T\> _NanEnsureLocal(v8::Handle<T\>)â€™ previously declared here
>  NAN_INLINE v8::Local<T\> _NanEnsureLocal(v8::Handle<T\> val) {
>                          ^
> ../node_modules/nan/nan.h:661:13: error: â€˜node::smallocâ€™ has not been declared
>      , node::smalloc::FreeCallback callback
>              ^
> ../node_modules/nan/nan.h:661:35: error: expected â€˜,â€™ or â€˜...â€™ before â€˜callbackâ€™
>      , node::smalloc::FreeCallback callback
>                                    ^
> ../node_modules/nan/nan.h: In function â€˜v8::Local<v8::Object\> NanNewBufferHandle(char*, size_t, int)â€™:
> ../node_modules/nan/nan.h:665:50: error: â€˜callbackâ€™ was not declared in this scope
>          v8::Isolate::GetCurrent(), data, length, callback, hint);
>                                                   ^
> ../node_modules/nan/nan.h:665:60: error: â€˜hintâ€™ was not declared in this scope
>          v8::Isolate::GetCurrent(), data, length, callback, hint);
>                                                             ^
> ../node_modules/nan/nan.h: In function â€˜v8::Local<v8::Object\> NanNewBufferHandle(const char_, uint32_t)â€™:
> ../node_modules/nan/nan.h:672:67: error: call of overloaded â€˜New(v8::Isolate_, const char_&, uint32_t&)â€™ is ambiguous
>      return node::Buffer::New(v8::Isolate::GetCurrent(), data, size);
>                                                                    ^
> ../node_modules/nan/nan.h:672:67: note: candidates are:
> In file included from ../node_modules/nan/nan.h:25:0,
>                  from ../src/weakref.cc:19:
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:31:40: note: v8::MaybeLocal<v8::Object> node::Buffer::New(v8::Isolate_, v8::Local<v8::String\>, node::encoding) <near match\>
>  NODE_EXTERN v8::MaybeLocal<v8::Object\> New(v8::Isolate* isolate,
>                                         ^
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:31:40: note:   no known conversion for argument 3 from â€˜uint32_t {aka unsigned int}â€™ to â€˜node::encodingâ€™
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:43:40: note: v8::MaybeLocal<v8::Object\> node::Buffer::New(v8::Isolate_, char_, size_t) <near match\>
>  NODE_EXTERN v8::MaybeLocal<v8::Object\> New(v8::Isolate* isolate,
>                                         ^
> /home/myrubapa/.node-gyp/4.0.0/include/node/node_buffer.h:43:40: note:   no known conversion for argument 2 from â€˜const char*â€™ to â€˜char*â€™
> In file included from ../src/weakref.cc:19:0:
> ../node_modules/nan/nan.h: In function â€˜v8::Local<v8::Object\> NanNewBufferHandle(uint32_t)â€™:
> ../node_modules/nan/nan.h:676:61: error: could not convert â€˜node::Buffer::New(v8::Isolate::GetCurrent(), ((size_t)size))â€™ from â€˜v8::MaybeLocal<v8::Object\>â€™ to â€˜v8::Local<v8::Object\>â€™
>      return node::Buffer::New(v8::Isolate::GetCurrent(), size);
>                                                              ^
> ../node_modules/nan/nan.h: In function â€˜v8::Local<v8::Object> NanBufferUse(char_, uint32_t)â€™:
> ../node_modules/nan/nan.h:683:12: error: â€˜Useâ€™ is not a member of â€˜node::Bufferâ€™
>      return node::Buffer::Use(v8::Isolate::GetCurrent(), data, size);
>             ^
> weakref.target.mk:90: recipe for target 'Release/obj.target/weakref/src/weakref.o' failed
> make: *_\* [Release/obj.target/weakref/src/weakref.o] Error 1
> make: Leaving directory '/home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build'
> gyp ERR! build error 
> gyp ERR! stack Error: `make` failed with exit code: 2
> gyp ERR! stack     at ChildProcess.onExit (/opt/node-v4.0.0-linux-x64/lib/node_modules/npm/node_modules/node-gyp/lib/build.js:270:23)
> gyp ERR! stack     at emitTwo (events.js:87:13)
> gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
> gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
> gyp ERR! System Linux 3.16.0-4-amd64
> gyp ERR! command "/usr/bin/node" "/opt/node-v4.0.0-linux-x64/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "rebuild"
> gyp ERR! cwd /home/myrubapa/httpdocs/phantomjs/tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak
> gyp ERR! node -v v4.0.0
> gyp ERR! node-gyp -v v3.0.1
> gyp ERR! not ok 
> npm WARN optional dep failed, continuing weak@0.4.1

Node v0.10.29 work fine
    ![capture d ecran 2015-09-08 a 00 11 21](https://cloud.githubusercontent.com/assets/1368129/9723274/2f321e58-55be-11e5-9789-3b66693e8323.png)

When I run `make test`, it threw `Cannot read property 'apply' of undefined`.
Now it checks if done is passed as an argument.

Another fix for the if could be:

``` js
if (done) {
  return this.run(done)
}
```

Because as I understand, `done` is only passed if nightmare is not running ?
  I am getting started on javascript.     When I run the v2 demo, I encounter a error message:

```
  if (err) throw err;
                      ^
  TypeError: You may only yield a function, promise, generator, array, or object,
   but the following was passed: "[object Object]"
       at next (..\wrap-fn\node_modules\co\index.js:106:12)
       at ..\wrap-fn\node_modules\co\index.js:45:5
       at ..\wrap-fn\index.js:53:21
       at _resolve_function (..\vo\index.js:176:8)
       at series (\node_modules\vo\index.js:103:3)
       at start (\node_modules\vo\index.js:51:7)
       at vo (\node_modules\vo\index.js:41:7)
         .......
      at Object.Module._extensions..js (module.js:478:10)
```

Is there any idea? It may help me.
 A demo provided by the Readme: 

```
var Nightmare = require('nightmare');
var vo = require('vo');

vo(run)(function(err, result) {
    if (err) throw err;
 });

function *run() {
  var nightmare = Nightmare();
   var title = yield nightmare
    .goto('http://cnn.com')
    .evaluate(function() {
     return document.title;
     });
   console.log(title);
    yield nightmare.end();
  }
```
 It seems that the return object was represented by a text value when transferred to the vo and it invokes the toString() method which return "[object, Object]".  How to fix it? Still working on this. 
  Everytime my mocha test doesn't succeed, I'm left with an open phantomjs instance `killall -9 phantomjs` works but I would rather have something like `nightmareInstance.close()`
Can you add something like this?
  RT, in PhantomJS there is [navigationLocked](http://phantomjs.org/api/webpage/property/navigation-locked.html) property, how should I set this property in nightmare? Thank you!
  Is there any way to use extracted data in selector. 
I extract some data from webpage using evaluate() method, and would like
to use that to perform next actions (click).

Only way I can think of atm, is to run nightmare two times. First time to 
extract data and second time to use that data...
 I hace a similar problem, tris problem should be perforemos using yield on
v2

El lunes, 31 de agosto de 2015, Jure Polutnik notifications@github.com
escribiÃ³:

> Is there any way to use extracted data in selector.
> I extract some data from webpage using evaluate() method, and would like
> to use that to perform next actions (click).
> 
> Only way I can think of atm, is to run nightmare two times. First time to
> extract data and second time to use that data...
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/210.
 Yes in v2 this is solved. 
For v1 I did following workaround... It enables to use nightmare ref. 
further in run callback.

```
Nightmare.prototype._run = function(callback) {
  var self = this;
  next();

  var noop = function() {};

  function next(err) {
    var item = self.queue.shift();
    if (!item) {
      return (callback || noop)(err, self);
    }
    var method = item[0];
    var args = item[1];
    args.push((next));
    method.apply(self, args);
  }
};

Nightmare.prototype.run = function(callback) {
  var self = this;
  if (!self.page) {
    self.setup(function() {
      self._run(callback);
    });
  } else {
    self._run(callback);
  }
};

```
  Cuts the test suite's running time from 2m to 1m on my machine. I've been using it with nightmare-driven test suites, as well as a module that subclasses it. Figured it might be helpful. :)
 Thanks to this commit I also improved test speed for our project
Awesome tool :+1: 
   :thumbsup:
  Is anyone getting this to work?  If so, can you point out the version of phantomJs you have?

I'm never seeing .select('#selectelement', value) work.  Period.  I get predictably inaccurate results on .type() on a select element, but it matches what you'd see in chrome in a select with option texts of 01 - 99, typing 55 will get you 51 and 66 will get you 61, etc -- but it literally is a 'type' method.  .select() just does _nothing_ with phantomjs 1.9.8.
 Hmm, when I perform the same operations as .select does in chrome console, nothing is selected either. (well not quite the same.  I'm not wrapping in page.evaluate())
 Here's a quick demo on how to use [select](https://jsbin.com/becowa/edit?html,js,output) within DOM. However, in `nightmare` you have this:-
[`.select(selector, option)`](https://github.com/segmentio/nightmare#selectselector-option), 
where `option` is the value of `option value` and `selector` is the DOM object.
 ...which is how i'm using it.  Thanks for the demo of javascript working on the DOM in the desired context.  I get that .select() and .type() don't operate on the same second parameter, if that's what you're getting at, overall.  So, the demo is not quite what nightmare does...  Have you gotten .select working in nightmare?  If so, could so you say what version of phantomjs you're using?
 Thanks for asking.  Can't run any of the tests.  Getting:
`/usr/lib/node_modules/express/lib/application.js:209`
`throw new TypeError('app.use() requires middleware functions');`
Having trouble figuring out what is needed, to be frank.
 @mattyhead I'm currently in PhantomJS 1.9.0. I've wanted to upgrade to 2.0 but haven't yet. 
And yes, I have been able to make selection with `.select`. You can play with it [here](https://ide.c9.io/shriek/nightmare).(had to scour the Internet to find classic dropdown) (just let me know your username and I'll give you access to write as well). Anyway, often times your selector might return an array of DOM objects when nightmare only expects one. I easily forget that part many times. Not sure if it's the same with you but just a note.
 @sinkingshriek Thanks!  I'll downgrade a bit and see what I get.
  If inject a js file before the screenshot action, the output file would be a empty png file.

Here is my code:

```
 nightmare
 .goto("http://www.google.com/")
     .inject("js","./test.js")        
 .wait('.event-title')   // should be a valid element
 .screenshot("shot1.png")

 .click('.event-title')  // click a button or something 
     .wait('#sell-tickets') // wait some element
     .screenshot('shot2.png')

 .run(function (err, nightmare) {   
     if (err) return console.log(err);
 });
```

Any idea about this? Thanks!
  I wanna send some test data to KAFKA when using nightmare.
  I get this error every time:

``` javascript
Error: Cannot find module 'weak'
    at Function.Module._oldRes (module.js:695:15)
    at Function.Module._resolveFilename (module.js:1401:19)
    at Function.Module._load (module.js:267:25)
    at Module.require (module.js:377:17)
    at require (module.js:395:17)
    at new D (F:\node_modules\phantom\node_modules\dnode\index.js:28:20)
    at module.exports (F:\node_modules\phantom\node_modules\dnode\index.js:8:12)

    at F:\node_modules\phantom\phantom.js:159:13
    at Server.handler (F:\node_modules\phantom\node_modules\shoe\index.js:22:9)
    at Server.emit (events.js:82:15)
```
 Can you tell me what version of node you're using? In Linux, this error usually happens when you don't have `build-essential` (I don't know specific to which compiler but I'm guessing C++ compiler) installed that causes this. If you're running the latest node/npm then you might want to download the latest VS available on your Windows machine and remove `node_modules` package and try re-installing again. 
 I get 

``` javascript
MSBUILD : error MSB4132: The tools version "2.0" is unrecognized. Available too
ls versions are "12.0", "14.0", "4.0".
gyp ERR! build error
gyp ERR! stack Error: `C:\Program Files\MSBuild\14.0\bin\msbuild.exe` failed wit
h exit code: 1
gyp ERR! stack     at ChildProcess.onExit (C:\Users\Dany\.jx\npm\node_modules\no
de-gyp\lib\build.js:271:23)
gyp ERR! stack     at ChildProcess.emit (events.js:85:15)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:824:
12)
gyp ERR! System Windows_NT 6.2.9200
gyp ERR! command "jx" "C:\\Users\\Dany\\.jx\\npm\\node_modules\\node-gyp\\bin\\n
ode-gyp.js" "rebuild"
gyp ERR! cwd F:\node_modules\nightmare\node_modules\phantom\node_modules\dnode\n
ode_modules\weak
gyp ERR! node -v v0.10.40
gyp ERR! node-gyp -v v0.13.1
gyp ERR! not ok
npm WARN optional dep failed, continuing weak@0.4.1
```

I use jxcore instead of nodejs.
  Nice feature +1
 Where would this be added @rclai please?
 Sweet, thanks!
 +1
 Thanks @rclai I've created a plugin from your code: https://www.npmjs.com/package/nightmare-iframe
 The above PR allows you to do `new Nightmare({'web-preferences': {'web-security': false}});`, which turns off same-origin policy in electron.    You can then do things like, 

``` javascript
var result = yield nightmare
  .evaluate(function () {
    return $("#id_description_iframe").contents().find("body").html();
  });
```
 Thank you for the feature!
Why do I get an exception?

``` console
TypeError: Cannot read property 'switchToFrame' of undefined
    at Nightmare.exports.withFrame (/var/www/html/antiqode/node_modules/nightmare/lib/actions.js:439:12)
    at Nightmare.next (/var/www/html/antiqode/node_modules/nightmare/lib/nightmare.js:144:12)
    at EventEmitter.<anonymous> (/var/www/html/antiqode/node_modules/nightmare/lib/nightmare.js:150:12)
    at EventEmitter.g (events.js:260:16)
    at emitNone (events.js:67:13)
    at EventEmitter.emit (events.js:166:7)
    at ChildProcess.<anonymous> (/var/www/html/antiqode/node_modules/nightmare/lib/ipc.js:28:10)
    at emitTwo (events.js:87:13)
    at ChildProcess.emit (events.js:172:7)
    at handleMessage (internal/child_process.js:686:10)
```

I tried to install the plugin

``` console
npm install --save nightmare-iframe
```

``` console
$ phantomjs -v
2.0.1-development
$ node -v
v4.2.2
```
 I tried the change preferences solution but could not change elements (type, etc) inside the iframe, just extract info. And the first solution does not work for me as the iframes in my problem only have ids. Any ideas?
 So, how can we navigate through iframes with the new Nightmare built on Electron? It seems Electron has no support for iframes.
 I just submitted a PR (#496) that should solve this issue. If you have the time you may check it to see if it works.

An example of the usage would be:

```
var Nightmare = require('nightmare');
var nightmare = Nightmare();
nightmare.goto('http://www.w3schools.com/tags/tryit.asp?filename=tryhtml_iframe').then();

nightmare.title().then(function(res){console.log(res)});

nightmare.enterIframe('#iframeResult').enterIframe('iframe');

nightmare.title().then(function(res){console.log(res)});

nightmare.exitIframe();

nightmare.title().then(function(res){console.log(res)});

nightmare.end();
```

It would print to the console:

```
Tryit Editor v2.6
W3Schools Online Web Tutorials
Tryit Editor v2.6
```

Also, it should work with general selectors, not just with iframe names or numbers.
 Hello. I'm trying to enter a credit card number in an iframe and I'm not sure which of the methods to use:
- using plain nightmare (doesn't work): `.wait('[name=card.number]')`
- using `nightmare-iframe`
- using tiangolo's patch
- using `{'web-security': false}` (and then what?)

Please can someone tell me which is best?  This issue has too many options.

PS. I'm using Electron, I see references above to phantom.js which confuse me even more, because I thought that was for Nightwatch, not Nightmare.
 [More Googling](http://stackoverflow.com/questions/38294743/nightmare-iframe-dynamic-iframe-name) shows me there isn't a solution to this problem. Please will whoever runs this project add a sentence to the main readme.md stating that nightmare doesn't support iframes.

We wouldn't have tried to learnt this framework if we knew it couldn't handle iframes. Their supoprt is absolutely essential to test any website that does ecommerce.
 @RichardJECooke here's the summary.
- The first approach commented here doesn't work anymore with the latest versions. 
- I wrote the PR, it got rejected. 
- @rosshinkley used parts of that PR to create an improved version of the functionality as an external plug-in.

Right now, the best you can do is use @rosshinkley's https://github.com/rosshinkley/nightmare-iframe-manager. Go there and check his documentation. That's what I'm doing.

The Nightmare team (Segmentio) don't like the approach taken in the PR and the plug-in (not even Ross, the plug-in's writer). They dislike it so much that didn't wan to publish it to NPM, you have to install it from GitHub. Feel yourself hyper-warned. No warranties anywhere, use at your own risk, etc.

Given that, for non-mission critical problems (to emphasize the warnings) the plug-in works pretty good.

I use it to extract my credit card transactions in my bank's website.

---

Here's what you would do (excessively detailed):
- Create a directory for your project and enter it:

``` bash
mkdir myProject
cd myProject
```
- Initiate your Node / Nightmare project with npm filling the package data:

``` bash
npm init
```
- Install Ross's plug-in from the GitHub repo (`npm` does it automatically for you, but you probably need to have `git` installed):

``` bash
npm install --save rosshinkley/nightmare-iframe-manager
```
- In your main project file, `require` Nightmare and the plug-in and pass the `Nightmare` object to the plug-in:

``` javascript
var Nightmare = require('nightmare');
require('nightmare-iframe-manager')(Nightmare);
```
- And then you can use it. The plug-in extends Nightmare itself. So you have additional methods in your Nightmare instance. Follow the documentation:
  https://github.com/rosshinkley/nightmare-iframe-manager
 Sadly this doesn't work for me, I get: 

```
TypeError: Cannot set property 'evaluate_now' of undefined
    at module.exports.exports (/home/rje/projects/ekaya/dist/client_gumtree/ts_output/client_gumtree/node_modules/nightmare-iframe-manager/nightmare-iframe.js:5:36)
    at Object.<anonymous> (/home/rje/projects/ekaya/dist/client_gumtree/ts_output/client_gumtree/tests/helper.js:5:73)
    at Module._compile (module.js:413:34)
    at Object.Module._extensions..js (module.js:422:10)
    at Module.load (module.js:357:32)
    at Function.Module._load (module.js:314:12)
    at Module.require (module.js:367:17)
    at require (internal/module.js:20:19)
    at Object.<anonymous> (/home/rje/projects/ekaya/dist/client_gumtree/ts_output/client_gumtree/tests/root/root.js:11:16)
    at Module._compile (module.js:413:34)
not ok 1 no plan found
not ok 2 no assertions found
```

when calling

``` typescript
import Nightmare = require('nightmare');
const show = (process.env.ekaya_gumtree_test_show_browser_window === 'true');
export const nightmare = new Nightmare({'show': show, 'height': 900 });
import manageNightmareIframesPlugin = require('nightmare-iframe-manager');
manageNightmareIframesPlugin(nightmare);
```
 You are modifying the `nightmare` instance after creating it. You have to modify the `Nightmare` "class" and then create the instance.

I bet it would be something like:

``` javascript
import Nightmare = require('nightmare');
import manageNightmareIframesPlugin = require('nightmare-iframe-manager');
manageNightmareIframesPlugin(Nightmare);
const show = (process.env.ekaya_gumtree_test_show_browser_window === 'true');
export const nightmare = new Nightmare({'show': show, 'height': 900 });
```
 Thank you for summary ! This could work for me.

For different domain iframe,

```
new Nightmare({webPreferences: {webSecurity: false})
```

is needed, seems. (`web-preferences`and  `web-security` are renamed since Electron 1.0)

Otherwise, an error

> Failed to read the 'contentDocument' property from 'HTMLIFrameElement': Blocked a frame with origin "*****" from accessing a cross-origin frame.

will occur.

I hope this can help someone.
 I'm getting errors when using `nightmare-iframe-manager` under xvfb (i.e. `xvfb-run node nightmare-script.js`) on linux. If I use a real X server as the display (or run it on MS Windows), it works fine.

Kind of a bummer, as I was hoping to use nightmare as part of a build on our Jenkins server (Ubuntu server 16.06).  Hello there! It seems as if there's no function for removing cookie(s) stored? By any chance could someone add this? I think it would be super useful
 We need this, PhantomJS has it...
 That's the one thing I hate @alfonsomga , I love NightmareJS, but there's no functions built-in for manipulating cookies. I'm going to start looking at the NightmareJS code soon, and perhaps I can figure out a way to do such. 
 :+1: for this. would a PR be welcome?
 Sorry to poke a head in: wouldn't [setting a cookie](https://github.com/segmentio/nightmare#cookiessetname-value) and [clearing a cookie by name for the current domain](https://github.com/segmentio/nightmare#cookiesclearname) work?  Is there something i'm missing?
 @rosshinkley - that works well generally.

For this specific use case I am trying to start the nightmare / electron process clear of cookies. As far as I can tell there's not an easy way to do that with the current api.
 @mathisonian True, clearing all cookies is not currently supported, at least directly.  I say go for a PR, then.
 @mathisonian to build upon @rosshinkley's response: you could issue a single request to the domain and clear all the cookies before you do your actual requests. That way the second request will be free of cookies.
 @johanneslumpe Unless I'm missing something (a very real, very big possibility), you'd have to use `.evaluate()` to retrieve and parse the cookie names yourself.  Then you could iterate over them and use `.cookies.clear()`.

It's certainly doable out of the box, but it would be nice to have something a little more convenient.
 @rosshinkley Oh yeah, if you do not know the cookie names beforehand, then probably yes. For my case I know which cookies I need to delete, so just doing a request and clearing those cookies seems to work fine. The original request will still be sent with the cookies, but the 2nd one will be fine.
 I know this threadâ€™s been sitting a while, but hopefully this note helps someone. For the use case of â€œtrying to start the nightmare / electron process clear of cookies,â€ you can actually do that and itâ€™s pretty easy! Itâ€™s entirely undocumented, though, so itâ€™s not surprising if you donâ€™t know about it.

When you create an Nightmare instance, it uses whatâ€™s called a â€œpartitionâ€ to store dataâ€”cookies, cache, history, localStorage, etc. Normally, every instance shares the same default partition, which gets stored to disk. However, you can tell it to use a different partition. Just set the `webPreferences.partition` property in the options object when creating a new Nightmare instance:

``` js
var browser = Nightmare({
  webPreferences: {
    partition: 'your-custom-partition'
  }
});
browser
  .goto('somewhere')
  .evaluate(...)
  .then(...);
```

The value for `webPreferences.partition` is just a string identifying the partition you want to use. The string can be anything you want; if thereâ€™s no existing partition with that name, a new one will be created. If the name of the partition starts with `persist:`, the data it stores will be saved to disk. Otherwise, it will be an in-memory partition, which means the data is thrown out when no more Nightmare instances are using it. You can actually see an example of this in action in the cookie tests: https://github.com/segmentio/nightmare/blob/master/test/index.js#L531 (because we want the tests to start fresh every time ;)
 @Mr0grog I don't understand how handle `.cookies.get()`

``` js
nightmare
    .goto(url)
    .cookies.get()
    //now here I want to go forEach with cookies, but how?
```
 @littleguga You can do it the same way you work with any nightmare actions that return values:

``` js
nightmare
  .goto(url)
  .cookies.get()
  .then(function(cookieList) {
    // loop through cookieList (an array of cookies) here
  });
```

This is the same way [the first example in the readme](https://github.com/segmentio/nightmare#examples) gets the top search resultâ€™s URL. Because everything in Nightmare is asynchronous, you use the `then()` promise method to wait for the actual result.
  Awesome stuff! I wonder how soon will that be :)
 I'm glad that this is getting some `generator` love too. :+1: 
 Nice!  can't wait for v2
 Excited for this! Thank you :D
 I think when you are on html pages with wait method is enough but on
angular or pages that inject and load content on some elements on page you
need to point exactly the selector you want to wait for

El miÃ©rcoles, 2 de septiembre de 2015, Peter Reinhardt <
notifications@github.com> escribiÃ³:

> ah, that's a very interesting idea yeah. in v1 you could just call .wait()
> without any arguments... do you think omitting the .wait() altogether is
> the right solution, or just making it so that the complexity of finding a
> relevant selector is unnecessary?
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/200#issuecomment-136948793
> .
 I use nightmare for electron and my opinion nightmare for phantomjs was better.
 Would it make sense to have 2 projects?  nightmare/phantom and `proton`/electron, with the same api? (note, I'm not part of the dev team, I'm only a user.)
 Why not?
 In my opinion, electron works much better. I use to get all sorts of node-gyp errors, but I don't get them anymore with the electron release.
  I am currently learning how to use _NightmareJS_. I found the performace is so slow while I was running the code below. It took up to 30 seconds to get the output. Did I do anything wrong?

Moreover, I have tried to use `wait()` with a selector but that does not help so much. :cry:

I am not sure whether this is related to my Internet connection, however, open the same site using Google Chrome and perform the same task is faster than using _Nightmare_.

**Soruce Code**

``` javascript
var Nightmare = require('nightmare');

var after;
var before = Date.now();

new Nightmare({
    loadImages: false
  }).goto('https://www.wikipedia.org/')
  .type('#searchInput', process.argv[2])
  .click('input[name="go"]')
  .wait()
  .url(function(url) {
    after = Date.now();
    console.log('>>> [' + (after - before) / 1000.0 + 's] ' + url);
  })
  .run(function(err, nightmare) {
    if (err) console.log(err);
  });
```

**Output**

``` bash
node n02_extract_wiki_link.js "node.js"
>>> [31.227s] https://en.wikipedia.org/wiki/Node.js
```

My current environment is listed below.

``` bash
Mac OS X 10.10.4
node v0.12.5
PhantomJS 2.0.0
nightmare@1.8.2
```

**Update: 1507271521**

Use the code below to complete the same task in native PhantomJS environment. It took about 17s.

``` bash
>>> [17.873s] https://en.wikipedia.org/wiki/Node.js
```

Source Code

``` javascript
var page = require('webpage').create();

var after;
var before = Date.now();

page.open('https://wikipedia.org', function(status) {
  if (status === 'success') {

    page.evaluate(function() {
      document.querySelector('#searchInput').value = 'node.js';
      document.querySelector('#www-wikipedia-org > div:nth-child(3) > form > fieldset > input.formBtn').click();
    });

    waitFor(function() {
      console.log('LoadingProgress: ' + page.loadingProgress + '%');
      if (page.loadingProgress == 100) {
        return true;
      }
    }, function() {
      after = Date.now();
      console.log('>>> [' + (after - before) / 1000.0 + 's] ' + page.url);
      phantom.exit(0);
    });
  } else {
    console.log('>>> Error');
    phantom.exit(1);
  }
});

function waitFor(testFx, onReady, timeOutMillis) {
  var maxtimeOutMillis = timeOutMillis ? timeOutMillis : 30000, //< Default Max Timout is 3s
    start = new Date().getTime(),
    condition = false,
    interval = setInterval(function() {
      if ((new Date().getTime() - start < maxtimeOutMillis) && !condition) {
        // If not time-out yet and condition not yet fulfilled
        condition = (typeof(testFx) === "string" ? eval(testFx) : testFx()); //< defensive code
      } else {
        if (!condition) {
          // If condition still not fulfilled (timeout but condition is 'false')
          console.log("'waitFor()' timeout");
          phantom.exit(1);
        } else {
          // Condition fulfilled (timeout and/or condition is 'true')
          console.log("'waitFor()' finished in " + (new Date().getTime() - start) + "ms.");
          typeof(onReady) === "string" ? eval(onReady): onReady(); //< Do what it's supposed to do once the condition is fulfilled
          clearInterval(interval); //< Stop this interval
        }
      }
    }, 100); //< repeat check every 100ms
};
```
  I'm trying to scrap a page with dynamic pagination. I want to be able to scrap the first page (using evaluate), send the info to the node process, scrap the second page if there's one, and repeat the process.

I'm trying to do it using the run callback recursively, but it seems the state is lost after calling the run method.
 @rclai are you sure? I don't think `use()` gets a chance to modify the nightmare task queue after `run()` has started.
@fpinzn I had the same issue. I monkey-patched [`Nightmare.prototype.run`](https://github.com/segmentio/nightmare/blob/master/lib/index.js#L59-L76) to take an additional suppressTeardown param and additionally to not call this.setup if this.page was defined.
 @rclai It doesn't
@abe-winter I think that's pretty useful if you check there's an open pull request for exactly that https://github.com/segmentio/nightmare/pull/59 

The same guy that did the pull request created this https://github.com/johntitus/node-horseman which seems like a substantial improvement over nightmare.

At the end I just went the trivial way: no flow control login inside the nightmare instance.
  I'm getting en error:

```
Uncaught Error: listen EADDRNOTAVAIL
```

I have pin pointed it down to this script(Nothing wrong with my express server). It seems like an async error is being thrown and I'm not being able to catch it, because it is async. Are you listening to all error events and passing it up?

``` typescript
try {
new nightmare()
    .viewport(cf.TEST_PAGE_VIEW_PORT.WIDTH, cf.TEST_PAGE_VIEW_PORT.HEIGHT)
    .goto(`http://${cf.HOST}:${cf.PORT}/`)
    .wait()
    .screenshot(`${filePath}.jpg`)
    .run((err, nightmare) => {
        console.log(err);
        if(err) {
            printDiagnostic(Diagnostics.Could_not_start_headless_web_browser);
        }

        if (self.options.interactive) {
            printDiagnostic(Diagnostics.Stop_the_server_by_exiting_the_session_CTRL_plus_C);
        }
        else {
            serverComposer.stop(err => {
                app = undefined;
                serverComposer = undefined;
                done();
            });
        }
    });
}
catch(err) {
}
```
  In PhantomJs we can get the content of page like this:

```
var page = require('webpage').create();
....
var content = page.content;
```

What is the best way to get the content is nightmarejs?(I can see evaluate can help but I think it is not very good solution)
 x2
 I figured out like this:

``` javascript
new Nightmare(options)
  .goto('http://www.blablabla.com/')
  .wait()
  .evaluate(function () {
        return document.documentElement.outerHTML;
     }, function (result) {
        console.log( result);
     }
  ).run(function( err, nightmare){
    console.log("done");
  });
```
  This PR addresses https://github.com/segmentio/nightmare/issues/120 when the `keypress` event was added it broke functionality for certain forms. 

I ran tests locally and the following tests are not passing:

``` js
it('should upload a file', function (done) {
  new Nightmare()
    .goto(fixture('upload'))
    .upload('input[type=file]', 'test/files/test.css')
    .click('button[type=submit]')
    .wait(1000)
    .evaluate(function () {
      return JSON.parse(document.body.querySelector('pre').innerHTML)
    }, function (files) {
      files.file.originalname.should.equal('test.css');
    })
    .run(done);
});

// results in err => Uncaught TypeError: Cannot read property 'originalname' of undefined
```

``` js
it('should set authentication', function (done) {
  new Nightmare()
    .authentication('my', 'auth')
    .goto(fixture('auth'))
    .evaluate(function () {
      return JSON.parse(document.querySelector('pre').innerHTML);
    }, function (data) {
      data.should.eql({ name: 'my', pass: 'auth' });
    })
    .run(done);
});
//results in err => Error: timeout of 40000ms exceeded
```

but this seems unrelated to the PR and I'm wondering if these tests are somehow "flaky"?. 
  Using the exact mocha example given in the readme.md, times out at 30000

```
var Nightmare = require('nightmare');
var expect = require('chai').expect; // jshint ignore:line

describe('test yahoo search results', function() {
  this.timeout(30000);

  it('should find the nightmare github link first', function(done) {
    new Nightmare()
      .goto('http://yahoo.com')
        .type('input[title="Search"]', 'github nightmare')
        .click('.searchsubmit')
        .wait('.url.breadcrumb')
        .evaluate(function () {
          return document.querySelector('.url.breadcrumb').innerText;
        }, function (breadcrumb) {
          expect(breadcrumb).to.equal('github.com');
        })
        .run(done);
  });
});
```

Output:

```
child_process: customFds option is deprecated, use stdio instead.


  test yahoo search results
    1) should find the nightmare github link first


  0 passing (30s)
  1 failing

  1) test yahoo search results should find the nightmare github link first:
     Error: timeout of 30000ms exceeded
      at [object Object].<anonymous> (/usr/local/lib/node_modules/mocha/lib/runnable.js:157:19)
      at Timer.listOnTimeout (timers.js:89:15)

```
 I upped the timeout to be `60000`, new error. This is something I ran into previously as well, `document` seems to be undefined within `evaluate()`

```
ÏŸ test  mocha
child_process: customFds option is deprecated, use stdio instead.


  test yahoo search results
phantom stdout: TypeError: null is not an object (evaluating 'document.querySelector('.url.breadcrumb').innerText')


phantom stdout:   phantomjs://webpage.evaluate():2
  phantomjs://webpage.evaluate():3

    1) should find the nightmare github link first


  0 passing (7s)
  1 failing

  1) test yahoo search results should find the nightmare github link first:
     Uncaught AssertionError: expected null to equal 'github.com'
      at /Users/henrysnopek/projects/test/test/test.js:16:33
      at wrapped (/Users/henrysnopek/projects/test/node_modules/nightmare/lib/actions.js:403:14)
      at Proto.apply (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/dnode-protocol/index.js:123:13)
      at Proto.handle (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/dnode-protocol/index.js:99:19)
      at D.dnode.handle (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/dnode/lib/dnode.js:140:21)
      at D.dnode.write (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/dnode/lib/dnode.js:128:22)
      at SockJSConnection.ondata (stream.js:32:26)
      at emitOne (events.js:77:13)
      at SockJSConnection.emit (events.js:169:7)
      at Session.didMessage (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/lib/transport.js:220:25)
      at WebSocketReceiver.didMessage (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/lib/trans-websocket.js:102:40)
      at /Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/lib/trans-websocket.js:75:22
      at null.<anonymous> (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket/api/event_target.js:41:7)
      at Array.forEach (native)
      at EventTarget.dispatchEvent (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket/api/event_target.js:40:33)
      at API.receive (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket/api.js:30:10)
      at instance._emitFrame (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket/hybi_parser.js:285:44)
      at instance.parse (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket/hybi_parser.js:143:18)
      at Socket.<anonymous> (/Users/henrysnopek/projects/test/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/node_modules/faye-websocket/lib/faye/websocket.js:72:33)
      at emitOne (events.js:77:13)
      at Socket.emit (events.js:169:7)
      at readableAddChunk (_stream_readable.js:145:16)
      at Socket.Readable.push (_stream_readable.js:109:10)
      at TCP.onread (net.js:519:20)


```
  How is it possible to use phantomjs through nightmarejs with external scripts. I mean something like this:

```
phantomjs yslow.js --info basic http://www.yahoo.com
```
  Technically, you can use `npm` as your CDN and do the injection. Either that or you can inject any one of script loaders into the page to load the external URLs for you. 
 Okay, let me give this a shot.
**From npm:-**
Let's say you want to inject `jquery` or `angular`. There are npm packages for them so you can just do 

``` javascript
var $ = require('jquery');  
var angular = require('angular');
```

and with nightmare you can just inject them in your browser scope (I'm guessing this is what you're looking for?) as this:-

``` javascript
new Nightmare()
  .evaluate(function($, angular){
      console.log($); //in browser scope
      console.log(angular); //in browser scope
    }, 
    function(){}, //in node scope if you want anything being returned from browser to node
    $, angular //injection happens here
  )
  .run();
```

It's described more [here](https://github.com/segmentio/nightmare#evaluatefn-cb-arg1-arg2).

**From script loaders:-**

``` javascript
var requirejs = require('requirejs'); //one of the AMD script loader

new Nightmare()
  .evaluate(function(require){
    require(['//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js', '//cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.16/angular.js']);
  }, function(){ },
  requirejs //injection
  )
  .run();
```

There are other non AMD script loaders as well but this was just one example. I hope this somewhat clarifies what you're trying to do. 
  added 'mouseover'
 will do
 test added
  I noticed that on Jenkins, some nightmare tests are failing due to the fact that nightmare tests are running on old view files. I think these are phantomjs cached pages.
There should be an option to delete phantomjs cached pages before you run the tests. Maybe using something like `new Nightmare().clearMemoryCache()`
  Hi, I'm new to nightmare and phantomjs.

Each time I `open` a new url all the requests got a status of `200`,
using the same `nightmare` instance,
while the e-tag was enabled and
the browsers would get from cache or at least a `304` always.

How could I turn on the cache option somewhere, or something else? Thanks.

```
GET /song/5802 200 4.489 ms - -
GET /static/dist/app/common.css 200 5.591 ms - -
GET /static/dist/app/common.js 200 3.369 ms - 399
GET /static/dist/zepto.min.js 200 5.157 ms - -
GET /static/dist/modern/css/modern.min.css 200 8.725 ms - -
GET /static/dist/modern/fonts/iconFont.svg 200 41.429 ms - -
GET /songlist 200 13.260 ms - -
      âœ“ back to songlist (7361ms)
GET /song/5802 200 4.854 ms - -
GET /static/dist/app/common.css 200 3.115 ms - -
GET /static/dist/app/common.js 200 2.181 ms - 399
GET /static/dist/zepto.min.js 200 4.044 ms - -
GET /static/dist/modern/css/modern.min.css 200 9.829 ms - -
GET /static/dist/modern/fonts/iconFont.svg 200 46.414 ms - -
GET /song/5656 200 7.081 ms - -
      âœ“ links to next (7264ms)
```
 1 up vote! I need the cache too, anyone can help ?
 yeah!
I really like how nightmare magically connects to PhantomJS on node but at this point I really need to know how to control this connection for setting cache and other settings too
 hi guys, as metioned in https://github.com/atom/electron/issues/1360
seems nightmare (in electron) now always supports cache. is it right?
 @fritx @a7madgamal @luatnd Is this still an issue since the move to Electron?
 @rosshinkley I read the electron threads referenced by you earlier. As I understand it: with electron, by default caching is enabled correct (which can be disabled explicitly with the pragma if need be). And so thus nightmare has caching enabled by default. Is this the case?  @t-suwa proposed this fix in #179, just creating a PR for easy merging.

I'm running into this problem on CircleCI. Their artifacts directories have extra periods in them, and this currently breaks any use of `screenshot()` when trying to save to them.
 Thanks!
  Is there a callback handler for when the selector is not found after the timeout is up?
 @rclai Definitely! When the `wait` function times out, it emits a `timeout` event that can be handled using the [`Nightmare.on` method](https://github.com/segmentio/nightmare#onevent-callback).  All `.on()` calls must happen before the first `.goto()` so consider it more of a configuration step.

Here's a brief example using `on` to handle a `wait(selector)` timeout. Note the default timeout for `wait(selector)` can be configured in the [Nightmare options](https://github.com/segmentio/nightmare#new-nightmareoptions).

``` js
var Nightmare = require('nightmare');
new Nightmare()
  .on('timeout', function(msg) {
     return console.log(msg);
   })
  .goto('http://yahoo.com')
    .type('input[title="Search"]', 'github nightmare')
    .click('.searchsubmit')
    .wait('#non-existent')
    .run(function (err, nightmare) {
      if (err) return console.log(err);
      console.log('Done!');
    });
// Output:
//     timeout elapsed before selector "#non-existent" became present
//     Done!
```
  I'm using Nightmare to make a screenshot service for a social media site I'm building. I've got the page loading down, and the screenshots look as expected, but now I need to upload them to S3.

I have an express app that sends some route params in to .evaluate callbacks in Nightmare to find the thing that needs screenshotting. What I'm trying to do is resolve a separate promise in the .run callback to tell my app that everything is done, so you can upload the screenshot to S3 now.

``` javascript
function(var1, var2, var3) {
   var d = when.defer(); 
   new Nightmare()
        .someQueuedCalls()
        .run(function(err, nightmare) { 
            if(err) d.reject();
            d.resolve();
        });
   return d.promise;
}
```

It seems like the promise resolves immediately, before the page even starts loading. Is .run the wrong place for it, or what am I missing?
  Before this change resourceRequestStarted would clobber any listeners set for resourceRequested. This change allows two callbacks to be passed to resourceRequestStarted. The first callback runs in the scope of phantom and the second runs in the scope of node. Wraps [onResourceRequested of the underlying phantom library](https://github.com/sgentle/phantomjs-node#functionality-details).
 This PR is pretty important. The current functionality seems to be faulty and I think this PR should be merged to fix that.
  screenshot() fails when the image file path includes plural dots like this:

```
c:\Users\foo_bar.DOMAIN\dev\some-product\test.e2e\evidence\case-001.png
```

Instead of using combination of `substring` and `indexOf`, we can extract the extension by regexp.

``` javascript
exports.screenshot = function (path, done) {
  var formats = ['png', 'gif', 'jpeg', 'jpg', 'pdf'];
  var ext = path.match(/[^.]+$/); // use regexp to extract the extention
  if (!~formats.join(',').indexOf(ext)) {
    done(new Error('Must include file extension in `path`.'));
  }
  debug('.screenshot() saved to ' + path);
  this.page.render(path, done);
};
```
  I know nightmare using standard css selector. So here, when I want to using css path like this:

```
.click('body.sz1200 > div > div >a')  
```

This is worked.
But when I want to try 

```
 .click('body.sz1200 > div > div >a:eq(1)')
```

Which is worked in JQuery environment, but not work in Nightmare
 That's primarily because `:eq` is `jQuery` only feature. I believe you can still use `nth-child` selector from `CSS` which does something similar except that it starts with 1 index than 0 index that `:eq` starts with.
 No, they are not exactly same, I just thinking jQuery support is very necessary for DOM operation
  It can be used when one doesn't want to kill the page once all queued actions are done.

I've already used it a few times like so:

``` js
nightmare
    .stuff()
    .moreStuff()
    .setup(function () {
        nightmare.drainQueue(console.log.bind(console, 'drained'))
    });
```

It also allows queueing up more actions after the run loop, for instance from user input.

Useful enough to merge into main?
 Seems like a dup of #176. Yes, this feature is highly anticipated; however, they don't merge these PRs for some obscure reason. I doubt this repo is maintained at all :confused: 
  As explained in #175, I extracted the `exec` method which runs the queue on already initialized Nightmare instance. I also took the liberty of removing `@api private` from `setup` and `teardownInstance`, since these methods should now be exposed for this style of working with Nightmare.

I'd also rename `teardownInstance` into `teardown`, but I decided to leave this one up to the core team.

I'd also be happy if someone could reflect this in docs (I'm not so confident about my English).

Thanks again for an awesome tool!
 Could some of the collaborators please comment this one? Do you plan to accept this (with modifications maybe) or instance reuse is not something you plan to ever support for Nightmare?

TIA
 A big :+1: to this!  Here's what I'm currently doing instead, it's really ugly:

``` js
var browsers = {};

// Do not teardown PhantomJS instances (reuse them to save time)
// Even though Nightmare#setup() is called for each Nightmare#run() call, this
// still works because Nightmare#setupInstance() checks
// this.initializingPhantomJS and only creates a new PhantomJS page, not a
// whole new instance.
// TODO this is a nasty hack that may cause other unexpected problems
Nightmare.prototype.oldTeardownInstance = Nightmare.prototype.teardownInstance;
Nightmare.prototype.teardownInstance = function() {
    require('nightmare/node_modules/debug')('nightmare')('skipping PhantomJS teardown');
};

// but do tear them down on process exit
// we specify --no-exit in the mocha.opts file, but mocha still adds a process
// 'exit' listener to set its exit code; when that listener is added, we know
// mocha is finished running
process.on( 'newListener', function( event, listener ) {
    if ( 'exit' === event ) {
        // This doesn't work
        Object.keys( browsers ).forEach( function( role ) {
            browsers[ role ].oldTeardownInstance();
        } );
        // Give everything some time to exit before forcing
        var timeout = setTimeout( function() {
            Object.keys( browsers ).forEach( function( role ) {
                try {
                    browsers[ role ].phantomJS.process.kill();
                    console.error( 'Killed browser process for role: %s', role );
                } catch (e) { }
            } );
            process.exit();
        }, 2000 );
    }
} );
```
 @nylen Thanks for your feedback. After a couple of days I came up with a conclusion that this project is not actively maintained. FWIW we decided to switch to [navit](https://github.com/nodeca/navit) which is designed for testing right from the start.
  Opening an issue to explain upcoming PR.

It would be handy to be able to work with a single PhantomJS instance multiple times (queue some things, run them, do some stuff, queue some more things, run again, etc.). For example in a typical BDD-style spec someone would want to do this:

``` js
describe('My awesome page', function() {
  var nightmare = new Nightmare();

  before(function(done) {
    nightmare.setup(done);
  });

  it('should login', function(done) {
    nightmare.goto('/some/login/page').exec(done);
  });

  it('should do something stateful with a page and assert some results', function(done) {
    nightmare.click('btn--primary')
      // assert something
      .exec(done);
  });

  it('should do some more stuff', function(done) {
    nightmare
      // do something
      // assert something
      .exec(done);
  });

  after(function() {
    nightmare.teardownInstance();
  });

});
```

The funny thing is that it's super-easy to support this flow, all we have to do is:
- extract a method which actually runs a queue from `run` (I called it `exec`)
- make `setup` and `teardownInstance` methods public (document them, remove `@api private`)
- (optionally) rename `teardownInstance` into `teardown`

Implementing this would also solve #36 and other similar issues. Although it does not introduce control explicit flow helpers, it becomes kinda doable with explicit `exec` calls (callback pyramid can be optimized/eliminated in numerous ways).

As for automated tests (with Mocha), this solution fits the bill ideally: async tests work like a charm and you also gain a significant performance boost by instantiating PhantomJS only once per `describe` or even per entire spec.
 A big :+1: to this!  I'm currently hacking together something similar by disabling `teardownInstance` and manually calling it when I'm ready.
 @nylen Thanks! I've also included a [small test in PR](https://github.com/inca/nightmare/blob/56d3bb262d0a887f232c297ac587741c065a0c8a/test/index.js#L743) to illustrate a potential use case with `localStorage`, but it could really be anything.
  Fixes this error: 

```
phantom stdout: SyntaxError: DOM Exception 12: An invalid or illegal string was specified.
```

when trying to use escaped selectors (e.g. `.wait("#escaping\\:test")`)
  When pages fail to load, it looks like `nightmare` will just continue along the queue of operations anyway.  Instead, it should fail and stop trying to do any other queued actions, or at least provide a way to catch the error and decide what to do.

Example log output:

```
  nightmare .goto() url: https://wordpress.com/post/89812188/2 +5ms
  nightmare .goto() page loaded: fail +3ms
```

The page load doesn't always fail after only 3ms, but why would that happen?  Is there a way to see why page loads are failing?  I've added `resourceError` callbacks, but I just get a bunch of these with "Operation canceled" as the error message.

Right now I'm doing something like this, which does detect the failure but is not ideal:
- It's not the simple API that I really like about Nightmare.
- It doesn't provide a way for me to see why the page load failed.
- I'd have to write the same logic for functions other than `goto` like clicking a button etc.

``` js
lib.gotoPage = function( url ) {
    return function( nightmare ) {
        nightmare
            .on( 'loadFinished', function( status ) {
                if ( status == 'fail' ) {
                    throw new Error( util.format(
                        'Failed to load page: "%s"',
                        url ) );
                }
            } )
            .goto( url );
    };
};

nightmare.use( lib.gotoPage( pageUrl ) );
```
 @reinpk thoughts?  Error handling seems like an important feature that nightmare lacks.
  Hey is there a way I could do something like

```
Nightmare   
    .goto(url)      
    .evaluate(function(){
        return document.getElementById('test').innerHTML
    }, function(test){

        if (test === 'some text') {
            // SOMEHOW QUIT PROCESS and not type below
            process.quit();
        }
        else {
            // Continue on typing below
        }

    })
    // I don't want this to run because of conditions above
    .type('input[name="email"]', email)         
    .type('input[name="password"]', password)
    .click('input[type="submit"]')  
    .run(function (err, nightmare) {
        return;
    });
```

So quit the process and stop the chain. Thanks!
  I had a situation like:

``` js
.wait('input')
.type('input', 'hi')
```

`input` would never match, but then `type` would eventually be attempted.
Made debugging really hard.
 Also, while `wait` should surface an error, so should `type`. Instead, `type` targetting an unknown selector results in:

```
phantom stdout: TypeError: 'null' is not an object (evaluating 'document.querySelector(selector).focus')
phantom stdout:   phantomjs://webpage.evaluate():2
  phantomjs://webpage.evaluate():3
  phantomjs://webpage.evaluate():3
```

and the test passing with no `err` after calling `run`
 I've had similar errors too (the one you mentioned in the 2nd comment). From my understanding so far, this happens when you have two `phantomjs` instances running at the same time. so if I do :-

```
nightmare
  .goto('http://github.com')
  .type('input', 'hi')
  .run(function(err, nightmare){
    if(err) return err;
      console.log('done');
  });

nightmare
  .goto('http://twitter.com')
  .type('input', 'bye')
  .run(function(err, nightmare){
    if(err) return err;
      console.log('done');
  });
```

then I get the `document.querySelector(selector).focus')` error. I've been thinking of mitigating this problem by running the second instance only when the first one completes but I haven't really tested that yet.
 @shri3k @rauchg Is this still an issue?
    Seems like cookies don't persist if you have multiple `goto(...)`, even if it's the same domain.

Anyone have a solution for this?
 You would have to pass the name of the file that you want the cookie to persist in an option while you're creating an instance of `nightmare`.

Something like:-

```
 var nightmare = new Nightmare({ cookiesFiles: "./cookie.txt"});
```

Seems to work for me. 
 Can you provide an example? I've tried this and no luck :-/
 Okay, let's take an example of [onedrive.com](http://onedrive.com). Since they both use the same login and they share the same cookie, below is an example of how that would work.

```
var Nightmare = require("nightmare");
var nightmare = new Nightmare({ cookiesFile: "./cookie.txt"});
nightmare
  .goto("http://www.hotmail.com")
  .type("input[type=\"email\"]", "your_account_here")
  .type("input[type=\"password\"]", "your_pass_here")
  .screenshot("./beforeLoggedIn.jpg")
  .click("input[type=\"submit\"]")
  .wait()
  .screenshot("./afterLoggedIn.jpg")
  .goto("http://www.onedrive.com")
  .screenshot("./onedrive.jpg")
  .wait()
  .run(function(err, nightmare){
    if(err) throw new Error(err);
    console.log("completed");
  });
```
 ``` javascript
nightmare.evaluate(function() {
  window.location = '...';
}).wait(..);
```

does the job. ;)
  This might be a bit out of scope for github issues, since it's not directly code related -

But how would you go in teaching somebody about nightmare and how to use it? I'm asking because every business owner loves to have automated testing, but training people to do it is a bit of a challenge, unless they are already devs. But especially with helpers like 

Maybe you guys know of suggested or complementary courses that can bring you from learning about...

a) html/css selectors
to ...
e) phantomjs
f) nightmare?
g) daydream

For beginners? Any ideas? Especially with extensions like Daydream I think the barriers to get non-devs involved into testing and automation are getting easier with each day; but there's still basics that have to be covered
  Very strange that wait(2000) is executing in 500ms. I see this affecting timing in a lot of places.

```
nightmare queueing action "goto" +0ms
  nightmare queueing action "screenshot" +1ms
  nightmare queueing action "wait" +0ms
  nightmare run +0ms
  nightmare .setup() creating phantom instance with options {"webSecurity":false,"cookiesFile":"data/cookies/ebay.com.txt","timeout":5000,"interval":50,"weak":true,"loadImages":true,"ignoreSslErrors":true,"sslProtocol":"any","proxy":null,"proxyType":null,"proxyAuth":null} +0ms
  nightmare .setup() phantom instance created +752ms
  nightmare .setup() phantom page created +5ms
  nightmare .goto() url: https://signin.ebay.com/ws/eBayISAPI.dll?SignIn&ru=http%3A%2F%2Fwww.ebay.com%2Fsch%2Fi.html%3F_nkw%3Dlogin +1ms
  nightmare .goto() page loaded: success +1s
  nightmare .wait() for 2000ms +504ms
  nightmare .screenshot() saved to data/screenshots/ebay.com.png +0ms
  nightmare .teardownInstance() tearing down +2s
```
  I don't think you can just turn javascript off that easily, I think the way to do this is to list to `resourceRequestStarted` and abort it's network request e.g.

``` js
.on('resourceRequestStarted', function(requestData, networkRequest) {
  if(requestData.url.indexOf('.js') !== -1) networkRequest.abort();
});
```
 @petecoop, I'm not sure if there's a plugin for `NoScript` like `YSlow` for `phantomjs` but if OP can find that plugin then s/he should be able to load it just like [`YSlow`](http://yslow.org/phantomjs/)
 There is actually a `javascriptEnabled` setting in phantomjs itself: http://phantomjs.org/api/webpage/property/settings.html

However not sure if that would break the connection between phantomjs and nightmare/phantomjs-node
 @petecoop, That's in fact quite possible in `nightmare`. Just did a quick test and seems to me that it's working. 

@MakoMakox, plug the following lines in `/lib/actions.js` and see if that helps. This is just a quick test to see if it's working and if everyone agrees with this, I or anyone can send a PR.

```
/**
 * Enable/Disable JavaScript.
 *
 * @param {Boolean} useragent
 * @param {Function} done
 */

exports.noJS= function(value, done) {
  debug('.noJS() to ' + value);
  this.page.set('settings.javascriptEnabled', !value, done);
};
```

The usage of this would be:-

```
nightmare
  .noJS(true)
  .viewport(1920, 1080)
  .goto('http://angularjs.org')
  .screenshot('./test.jpg')
  .wait()
  .run(function(err, nightmare) {
    if(err) console(err);
    console.log('done!!');
  });
```
 Nice, think I'll look at putting this into [Phantasma](https://github.com/petecoop/phantasma)
 Awesome!! In the meantime I'll go ahead and send a PR on this one.
 I don't think you'd be able to `evaluate` anything after that :smirk:
    For "Walmart.com", Here I just use .wait(5000) after .goto() 
Then I use the screenshot, check the page. Its text form and submit button is odd. (Show strange pictures and different position)

Further actions like .type is not work.

![sth2](https://cloud.githubusercontent.com/assets/3384807/6423588/658bf95a-beb6-11e4-822f-c340449745b7.png)
  Addresses #157 
 I like the idea, but this implementation is setting the status whenever the `onResourceReceived` callback fires.  That callback is "[invoked when a resource requested by the page is received](http://phantomjs.org/api/webpage/handler/on-resource-received.html)".  Every external javascript, stylesheet, etc causes this to fire.  So the status code you receive may be for something other than the URL itself.
 Right, that makes sense.  I included a check in there to make sure that the url of the response matched the url of the page requested by 'goto'
 I see, sorry I missed that. Next question - what happens if the user sets a `resourceReceived` callback? May need to catch that an wrap it in the `exports.on` method.
 No worries, I'm happy you are keeping a close eye on it.  As far as the next issue, I'll take a look and see if I can make a recommendation.  Great point.
 One more potential issue - If you `.goto('http://www.reddit.com')`, it gets translated into `http://www.reddit.com/` with the trailing slash. I think this would cause this method to 'miss' the response.
 Possible way to do it, at the end of this conversation:

https://github.com/ariya/phantomjs/issues/10185
  Would be nice to have a shortcut to get the http status code of the current page.  Pull request coming shortly (test included).
  Getting the following errors running document.querySelector in Nightmare 1.7.0 on version 0.12.0 of node.

dyld: lazy symbol binding failed: Symbol not found: __ZN2v86Object3SetENS_6HandleINS_5ValueEEES3_NS_17PropertyAttributeE
  Referenced from: /Users/rfink/watchtower/default-tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build/Release/weakref.node
  Expected in: dynamic lookup

dyld: Symbol not found: __ZN2v86Object3SetENS_6HandleINS_5ValueEEES3_NS_17PropertyAttributeE
  Referenced from: /Users/rfink/watchtower/default-tests/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/weak/build/Release/weakref.node
  Expected in: dynamic lookup
  Passing papersize option for PDF rendering
 @reinpk  Thanks, i have setup default to what it is in production now.
  Hi there,

I want to propose to add this badge to the README to show off inline-documentation: [![Inline docs](http://inch-ci.org/github/segmentio/nightmare.svg)](http://inch-ci.org/github/segmentio/nightmare)

The badge links to [Inch CI](http://inch-ci.org) and shows an evaluation by [InchJS](http://trivelop.de/inchjs), a project that tries to raise the visibility of inline-docs (early adopters include [forever](https://github.com/foreverjs/forever), [node-sass](https://github.com/sass/node-sass) and [when](https://github.com/cujojs/when)).

The idea is to motivate aspiring Node developers to dive into Open Source projects and read the code.
It's about _engagement_, because, while testing and code coverage are important, inline-docs are the humanly engaging factor in Open Source. This project is about making people less adverse to jumping into the code and see whats happening, because they are not left alone while doing so. I know that, because I put off reading other people's code way too long in my life.

Although this is "only" a passion project, I really would like to hear your thoughts, critique and suggestions. Your status page is http://inch-ci.org/github/segmentio/nightmare

What do you think?
  control-c the node process doesn't kill the phantomjs process and sometimes randomly but frequently I get this error:

phantom stderr: PhantomJS has crashed. Please read the crash reporting guide at https://github.com/ariya/phantomjs/wiki/Crash-Reporting and file a bug report at https://github.com/ariya/phantomjs/issues/new with the crash dump file attached: /tmp/D3087DE3-8A3E-43B8-88FE-64E7809F4C2B.dmp

assert.js:100
  throw new assert.AssertionError({
        ^
AssertionError: abnormal phantomjs exit code: 1
  at Console.assert (console.js:87:23)
  at ChildProcess.<anonymous> (/Users/izelnakri/newkamernet/node_modules/nightmare/node_modules/phantom/phantom.js:153:28)
  at ChildProcess.emit (events.js:101:17)
  at Process.ChildProcess._handle.onexit (child_process.js:1038:12)
  Has anyone been able to download a file?

I have tried a few approaches. The first was:

``` js
.on('filePicker', function(oldFile) {
            console.log('onFilePicker(' + oldFile + ') called');
            return 'a-filename.ext';
          })
```

That code was never triggered.

Then [someone mentioned](https://groups.google.com/forum/#!topic/phantomjs/JChUakj--24) onFileDownload, but that also didn't work.

I have a listener to output resource requests (and it is correctly logging the attempt to retrieve the file):

``` js
.on('resourceRequested', function(requestData, networkRequest) {
            console.log('Request (#' + requestData.id + '): ' + JSON.stringify(requestData));
          })
```

I can't just stream the file to disk because it's behind an authenticated session, hence the need for PhantomJS.

Anyone able to get file downloading to work? I think [Casper](http://docs.casperjs.org/en/latest/modules/casper.html#casper-download) has it going, so I will try that next.
 If you can get a hyperlink to the file, then it's not too hard. I used something like this:

```
nightmare.evaluate(
  function () {
    var data = [];
    var xhr = new XMLHttpRequest();
    xhr.open("GET", $("target_anchor").attr('href'), false);
    xhr.overrideMimeType("text/plain; charset=x-user-defined");
    xhr.send();
    data.push(xhr.responseText);
    return data;
  },
  function(data) {
    fs.writeFile("my_filename", data[0], "binary", function(err, x) {console.log('wrote file');});
});
```

It's not very async, but you get the idea.
 That's an interesting approach. I might try it next time, but wouldn't be optimal for large files as the whole file needs to be loaded into memory.

I ended up just extracting the session cookie headers, and then running wget on the command line, setting the necessary headers to pull down the file.
 docs of electron download api: https://github.com/atom/electron/blob/master/docs/api/download-item.md
related PR: https://github.com/atom/electron/pull/2840
just an example to trigger download and save files in electron:
- triggers: https://github.com/fritx/wxbot/blob/dev/preload.js#L113-L116
- saves: https://github.com/fritx/wxbot/blob/dev/index.js#L41-L59

hope that helps
expecting a high-level api in nightmare
 :+1:

Downloads can be triggered in a number of tricky ways (javascript redirect, iframe, etc).  Being able to plug into the `will-download` event would be huge.
 This page is a good test for that eventual feature:
http://www.fangraphs.com/projections.aspx?pos=all&stats=bat&type=steameru

Export Data link at the bottom right export a csv file.

Proper download support is something that always lacked in the various headless browser, nice to see Electron support, hopefully Nightmare will make use of it :)
 Hello All, I am having the same issue. Anyone who has a solution to this?
 This is amazing!  Thank you.
  Hi,

I am trying to use nightmare.js to simulate signing out and doing some functional tests after that.
![](http://i.imgur.com/NFFMwrf.png)

As the alert says, I went through the sign out process. But the session seems like it's not destroyed yet.
The top nav bar isn't showing sign in and sign up links.

Any idea what might be going on?
Wondering if this is a similar situation as this.
https://github.com/detro/ghostdriver/issues/170
  Hi,

i have a Nightmare instance in which i click a button that opens a new window.

Is there a way to handle the DOM of the new window? (for example typing the inputs, clicking buttons...)

Thanks.
 I have the same requirement.

I'd need to be able to click on a link that calls a JavaScript function; amongst other things this function generates a URL and pops it up in a new window.

I see PhantomJS has the ability to do this, added in [this PR](https://github.com/ariya/phantomjs/pull/293)
 Due to the lack of answers i moved to casperjs, it solved all the problems i had and it works nicely.
You can write clean code avoiding callback hell.

Concerning this single issue in casperjs you can interact with a pop up window with e specific method, look here http://docs.casperjs.org/en/latest/modules/casper.html#waitforpopup

Hope this helps.
 Thank you! I'll try Casper out too :)
 Still no answer. I guess I'll have to try Casper too.
 okay, thank you.

Based on your response I can only assume that it's currently not a feature of the api?
 Any word on this feature? Due to the pages I have to scrape, it's a make-or-break for me.
 @reinpk Can the feature to interact with new window be added to v2?
 @reinpk that's too bad. I was hoping for this feature to come now with v2 out. 

I wish I understood more on how you are using electron in place of phantomjs. Maybe then I would understand why you say that you don't think it's possible. 

Any chance you can explain at a high level how you are using electron? It's my understanding that electron is used to package applications... 
 Nevermind I think I found the answer in your readme. It appears you are using electron to create a new browser window and subsequently navigate the web. Very cool. 

Maybe there is a way to force input buttons that a given website tries to open a new window so that they open in the current page. Anybody have any ideas?
 @reinpk BrowserWindow.getAllWindows() returns an array of all the BrowserWindow object references. Surely this could be used to incorporate some sort of interaction with newly generated windows.

cc @matthewmueller
  Hi,

I have a form with no button. It is submitted when the enter key is pressed.
Does nightmare support keyboard events?

I have tried something like this

```
var keyEvent = new KeyboardEvent("keydown", {key : "Enter", char : "", shiftKey: false});
var q = document.querySelector('#nameInput')
q.dispatchEvent(keyEvent)
```

within evaluation() but no luck.
 I've got the same issue.
But you can write `.type("\n");` to simulate enter keypress. at least it's looks like works for me here.
 For people who get here via google, this sort of thing works fine for me:
```javascript
const Nightmare = require('nightmare');
const nightmare = new Nightmare({ show: true });
(async function() {

  await nightmare
    .goto('https://google.com.au')
    .type('body', 'github nightmarejs') // type into currently-focused input box
    .wait(500)
    .type('body', '\u000d') // press enter

})();

```  Hey guys,

Either i'm doing something wrong or this isn't working.  I'm trying to set the viewport before taking a screenshot, and no matter what order or whatever i place these calls in, the screenshot is always the full page (very long images).

``` js
new Nightmare()
        .viewport(1080, 1920)
        .goto(uri)
        .wait()
        .url(function(url) {
            endUrl = url;
        })
        .screenshot(filename)
        .run(function() {
            //some code
        });
```
  Hi,

Can I use xpath in selector ?

If yes, how can I do that ?

Thanks.
  Nightmare is currently missing a rather helpful and important feature: Taking a screenshot of a specific DOM element, instead of the entire page.

MakoMakox, already created such an action [here](https://github.com/MakoMakox/nightmare/blob/master/lib/actions.js#L352) and [here](https://github.com/MakoMakox/nightmare/blob/master/lib/actions.js#L370). Unfortunately s/he closed the relevant ticket https://github.com/segmentio/nightmare/issues/107, even though the feature was not merged into the Nightmare codebase yet.
 I reopened the issue until it will get merged into  the Nightmare codebase . I didn't expect that someone else will need it :+1: .
  - Sometimes a website with a hashtag in the URL doesn't load
- How can I monitor for ajaxComplete events? Injecting code constantly gives me a 
  `phantom stdout: TypeError: 'null' is not an object (evaluating 'a.parentNode')`
 @reinpk it seems a little preemptive to not respond to a ticket for almost a month and then close it without giving the opener any chance to post sample code, just putting it out there. This is an old issue and I've since found an alternate solution so I don't have any sample code for you anymore, but I would have about a month ago =). Thanks for your work!
  Add scrollTo feature. Always relative to top left corner. Resolves #130.
  Adds zoom feature. Resolves #136.

This sort of "High DPI" screenshot can be achieved by increasing the zoom level and viewport size proportionally (sample of this code is included in Readme.md). I decided to implement it this way to allow maximum flexibility.
 Not sure why this is failing. It doesn't appear to be related to my changes.
  I forgot to ignore test PDFs in my .pdf PR. Also, adds in some semicolons to be more consistent.
 Really odd that this is failing. These aren't even functional changes.
  If you call `nightmare.screenshot()` with a `path` which lacks an extension, the function seems to silently fail and not create any file at all.

From looking at the [Nightmare code](https://github.com/segmentio/nightmare/blob/master/lib/actions.js#L305) and the [PhantomJS documentation](http://phantomjs.org/api/webpage/method/render.html), I suspect this may be an upstream issue with PhantomJS itself. However, I haven't tested with PhantomJS directly - I have little experience of using PhantomJS directly (thus my use of this library).

Even if this is an upstream issue, it'd be great for user-friendliness if the `screenshot()` function checked for one of the supported extensions, or even just if the [documentation of the function](https://github.com/segmentio/nightmare#screenshotpath) mentioned that an extension is required.
  This adds `.headers()`, which sets the headers on a request.
  example  < a href="/test"  target="_blank" >test< /a >
  Did you found a solution?
 I managed to make it run In a multithread, I'm working on it really. I will post as soon as I have a ncie written slution. If anynone has progress on this I'm only ears.
 Look at this https://github.com/Buzzvil/ghost-town
  Hello @reinpk,

I'm trying a very simple test but the result is not what I've expected.

var Nightmare = require('nightmare');
new Nightmare()
.goto('http://www.mypage.com/login')
.type('input[name=username]', 'myusername')
.type('input[name=password]', 'mypassword')
.click('input.button')
.wait()
.screenshot('test.jpg') 
.run(function(err, Nightmare){
    console.log('Done.');
});

I suppose that the generated screenshot should be of the page after login. Instead I only get the Done message and a screenshot of the login page.
I've tried using wait with selector (div from the landing page after login process) but the result is the same.
Any advice?

Thank you!
 Hello again!
The generated screenshot contains the filled u/p fields. I've changed the click() selector to be sure that the button is found.

DEBUG=\* node logintest2.js
  nightmare queueing action "goto" +0ms
  nightmare queueing action "type" +5ms
  nightmare queueing action "type" +0ms
  nightmare queueing action "click" +1ms
  nightmare run +0ms
  nightmare .setup() creating phantom instance with options {"timeout":5000,"interval":50,"weak":true,"loadImages":true,"ignoreSslErrors"                                       :true,"sslProtocol":"any","proxy":null,"proxyType":null,"proxyAuth":null,"cookiesFile":null,"webSecurity":true} +0ms
  nightmare .setup() phantom instance created +2s
  nightmare .setup() phantom page created +11ms
  nightmare .goto() url: http://www.mypage.com/login +3ms
  nightmare .goto() page loaded: success +943ms
  nightmare .type() myusername into input[name="username"] +502ms
  nightmare .type() mypassword into input[name="password"] +23ms
  nightmare .click() on .pure-button +13ms
  nightmare .wait() for the next page load +24s
  nightmare .wait() detected page unload +5s
  nightmare .wait() detected page load +103ms
  nightmare .screenshot() saved to test3.jpg +0ms
  nightmare .teardownInstance() tearing down +192ms
Done.

According to debug, there is a page unload followed by a page load.
Still, the screenshot is of the login page.

Thank you!
  Hi,
Iam new to nightmarejs. i have one requirement like reading some data's from browser and put it into file.I really don't know where to run and what are all the tools  needed.can any one help me for the same.please provide the beginners link if any. Thanks
  Hi, I have one question. When I use the event handler resourceRequested, I get an error when calling the abort method of the object networkRequest
// Unhandled stream error in pipe.
Object #<Object> has no method 'abort'
Because the object networkRequest contains
{
objectName: ",
'destroyed(QObject*)': [Function],
'destroyed()': [Function],
'deleteLater()': [Function],
'abort()': [Function],
'changeUrl(QString)': [Function]
}

But even calling networkRequest['abort()']() gets the error
Error: cannot call function of deleted QObject

Is there any other way to cancel the load unwanted files?

I use phantomJS v 1.9.8 and 1.9.0, node v 0.10.33 , ubuntu 14.04
  As seen with `DEBUG=nightmare`:

```
  nightmare .goto() page loaded: success +6s
  nightmare .type() Lydia into input[name="firstname"] +503ms
  nightmare .type() Homenick into input[name="lastname"] +4ms
  nightmare .type() Hessel_Jeanne@Herzog.com into input[name="email"] +17s
  nightmare .type() 380 16 628 20 47 into input[name="phone"] +25s
  nightmare .type() 8140 Adrian Knolls Apt. 225 into input[name="address"] +25s
  nightmare .type() New Frances into input[name="city"] +24s
```
 I found that this issue can be fixed by doing direct `sendEvent` calls, not sure why.
 I have the same problem.
It seems that the problem appeared between 1.6.1 and 1.6.2.

Edit : This is the diff which cause the problem https://github.com/segmentio/nightmare/commit/b94ecc5664239ddac731143886f3c413a80034c5#diff-0
Edit 2 : This is verified, when I revert it, it's working
 @Quentin01 while that may fix the immediate problem, it doesn't trigger the "real" UI event.
 @reinpk Gist available here: https://gist.github.com/kytwb/de153003ef2c211774b9
 Fwiw, I observed the same type of slowness on OSX with phantomjs _2.0_ ; back to _1.9.x_ and times were very reasonable again. Maybe the people involved in this issue could confirm/infirm that ?
 More experiments:
- I experienced a very slow (> 20s) `type()` (and maybe `wait()`) on Linux as well with _any_ version of Phantomjs (tested 1.9.0, 1.9.2, 1.9.7, 1.9.8, 2.0.1-devel)
- I confirm that reverting back to nightmare 1.6.1 made the performance be acceptable again, and starting from 1.6.2 it starts to be slow as hell (which may confirm @Quentin01's bisect)

Fwiw here's the problematic part of a debug output, don't know if it can help:

```
...
  nightmare .goto() page loaded: success +2s
  nightmare .type() user into input[name="identification"] +500ms
  nightmare .type() passwordz into input[name="password"] +7ms
  nightmare .click() on button[type="submit"] +21s
  nightmare .wait() for the next page load +25s
...
```
 Going to use @jbbarth fork while waiting for a fix.
 I believe this issue has the same root cause as this other one:
https://github.com/segmentio/nightmare/issues/123

It's the socket connection between the phantomjs module and it's dependency, shoe.

You can manually edit shoe yourself. Go into `node_modules/phantom/shoe/index.js` and change line 8 to read

``` js
var server = sockjs.createServer({
        heartbeat_delay : 200
});
```

Can you try that out and see if it helps?
 @johntitus That fixed it for me. Problem is shoe is a dependence of phantom so would require to fork nightmare, fork phantom, fork shoe, fix, then cascade reference all the patched forks in each package.json. Good find though!
 I've been looking at this module: https://github.com/baudehlo/node-phantom-simple

Could be a possible replacement for the `phantom` module. `node-phantom-simple` has no dependencies, except PhantomJS. It uses node's `child_process.spawn` instead of socket.io, so it should be a bit more solid.

However, the API is slightly different, so it wouldn't be a drop in replacement. Also, it seems to be intermittently maintained.
 I've been looking at this module: [johntitus/node-horseman](https://github.com/johntitus/node-horseman).
 Any update to this? I'm running into the same issue. :+1: 
 :+1:  can confirm @johntitus's solution worked.
 @johntitus solution did work, but it stinks for us because I'd have to go in manually update all the node_modules on my production server...and then once they refresh with a `npm install` I'd have to do it again :frowning: 
 I was having the same problem.  Here's a way to :shit:-patch it from within your own app:

``` js
// Monkey patch for https://github.com/segmentio/nightmare/issues/126
( function() {
    var sockjs = require( 'nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs' );
    if ( ! sockjs._createServerOld ) {
        sockjs._createServerOld = sockjs.createServer;
        sockjs.createServer = function( options ) {
            if ( ! options ) {
                options = { };
            }
            if ( ! ( 'heartbeat_delay' in options ) ) {
                options.heartbeat_delay = 200;
            }
            return sockjs._createServerOld( options );
        };
    }
} )();
```

I'm not sure if this will still work if, for example, a compatible version of `shoe` is installed at a lower level of the modules tree.  Does anyone know?
    This might be a basic question, but once all of the steps are queued up, are the arguments that are passed in to `goto` modifiable? Or are they 'locked in' at runtime?

Given the following  stripped-down example:

```
var config = require('./config');
var Nightmare = require('nightmare');
var baseUrl = 'https://google.com';
var iframeURL = '';
var instance = new Nightmare()
  .viewport(1280, 720)
  .goto(baseUrl)
  .wait('.signin > a:nth-child(2)')
  .click('.signin > a:nth-child(2)')
  .wait()
  .evaluate(function() {
    var html = document.querySelector('iframe').outerHTML;
    return html.match(/src="(.*)"/)[1];
  }, function(res) {
    iframeURL = res;
  })
  .goto(iframeURL)
  .wait()
  .run(function() {
    console.log('AT THE END: ' + iframeURL);
  });
```

I'm parsing the iframe `src` inside the evaluate, passing it to the callback as `res`, then setting my "global" `iframeURL` to the parsed value, but the call to `goto` right afterwards sees it as empty. The log statement inside the `run` callback sees it as the correct value.

Is there a different approach I should be taking to this?
  Hi, @reinpk:
    I'm using nightmare do integration tests, but I find out it's really slow to do page navigation, especially when there are muliple "click and wait" combinations. for example, this codes here failed sometimes for timeout reason on my computer.
   By using casperjs, the same logic spend less than 15 seonds.
   Maybe it's the internal nodule:phantmjs's problem.
   Hope you can solve this problem.
   Thanks for your great work!

``` javascript

describe('Nightmare', function () {
    this.timeout(60000);

    it('shoud not spend a lot of time', function (done) {
        var nightmare = new Nightmare();
        nightmare.goto('https://github.com')
            .click('a[href="/login"]')
            .wait()
            .visible('div#login', function (visible) {
                visible.should.be.true;
                console.log('before login');
            })
            .type('input[name=login]', 'myUsername')
            .type('input[name=password]', 'myPassword')
            .click('input.button')
            .wait()
            .visible('span.octicon-inbox', function (visible) {
                visible.should.be.true;
                console.log('after login');
            })
            .run(done);
    });
});

```
 I just tested with  wait(selector),  not good:

``` javascript
    âˆš shoud not spend a lot of time (54090ms)
  1 passing (54s)
```

 I am using protractor(https://github.com/angular/protractor) to do  E2E test now.
 here it is:

``` javascript
  mocha:suite bail undefined +0ms
  mocha:suite enableTimeouts true +5ms
  mocha:suite bail undefined +4ms
  mocha:suite timeout 2000 +379ms
  mocha:suite enableTimeouts true +1ms
  mocha:suite slow 75 +1ms
  mocha:suite bail undefined +1ms
  mocha:suite timeout 60000 +1ms
  mocha:runnable timeout 60000 +1ms
  mocha:runnable enableTimeouts true +1ms
  mocha:runnable timeout 75 +1ms
  mocha:runner grep /.*/ +1ms
  mocha:runner globals ["ArrayBuffer","Int8Array","Uint8Array","Uint8ClampedArra
y","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64
Array","DataView","DTRACE_NET_SERVER_CONNECTION","DTRACE_NET_STREAM_END","DTRACE
_NET_SOCKET_READ","DTRACE_NET_SOCKET_WRITE","DTRACE_HTTP_SERVER_REQUEST","DTRACE
_HTTP_SERVER_RESPONSE","DTRACE_HTTP_CLIENT_REQUEST","DTRACE_HTTP_CLIENT_RESPONSE
","COUNTER_NET_SERVER_CONNECTION","COUNTER_NET_SERVER_CONNECTION_CLOSE","COUNTER
_HTTP_SERVER_REQUEST","COUNTER_HTTP_SERVER_RESPONSE","COUNTER_HTTP_CLIENT_REQUES
T","COUNTER_HTTP_CLIENT_RESPONSE","global","process","GLOBAL","root","Buffer","s
etTimeout","setInterval","clearTimeout","clearInterval","setImmediate","clearImm
ediate","console","Reporter","before","after","beforeEach","afterEach","context"
,"describe","xcontext","xdescribe","specify","it","xspecify","xit","XMLHttpReque
st","Date"] +2ms
  mocha:runner globals [] +3ms
  mocha:runner start +1ms

  mocha:runner run suite  +1ms

  mocha:runner run suite Nightmare +4ms
  Nightmare
  nightmare queueing action "goto" +0ms
  nightmare queueing action "click" +0ms
  nightmare queueing action "wait" +2ms
  nightmare queueing action "visible" +1ms
  nightmare queueing action "type" +1ms
  nightmare queueing action "type" +1ms
  nightmare queueing action "click" +1ms
  nightmare queueing action "wait" +1ms
  nightmare queueing action "visible" +1ms
  nightmare run +1ms
  nightmare .setup() creating phantom instance with options {"timeout":5000,"int
erval":50,"port":12301,"weak":true,"loadImages":true,"ignoreSslErrors":true,"ssl
Protocol":"any","proxy":null,"proxyType":null,"proxyAuth":null,"cookiesFile":nul
l,"webSecurity":true} +1ms
  nightmare .setup() phantom instance created +892ms
  nightmare .setup() phantom page created +8ms
  nightmare .goto() url: https://github.com +13ms
phantom stdout: TypeError: 'undefined' is not a function (evaluating 'Array.prot
otype.forEach.call.bind(Array.prototype.forEach)')


phantom stdout:   https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2
a00235feebb2fc218f0e91bbe06e140fb6ca67049215c66508.js:29
  https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2a00235feebb2fc21
8f0e91bbe06e140fb6ca67049215c66508.js:29

phantom stdout: ReferenceError: Can't find variable: $

  https://assets-cdn.github.com/assets/github-1f331009569afef1b6732009f2b35f3833
0c0837b8cf35ff15698f631aa4256d.js:1

phantom stdout:   https://assets-cdn.github.com/assets/github-1f331009569afef1b6
732009f2b35f38330c0837b8cf35ff15698f631aa4256d.js:1

  nightmare .goto() page loaded: success +5s
  nightmare .click() on a[href="/login"] +504ms
  nightmare .wait() for the element div#login +11ms
phantom stdout: TypeError: 'undefined' is not a function (evaluating 'Array.prot
otype.forEach.call.bind(Array.prototype.forEach)')

  https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2a00235feebb2fc21
8f0e91bbe06e140fb6ca67049215c66508.js:29

phantom stdout:   https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2
a00235feebb2fc218f0e91bbe06e140fb6ca67049215c66508.js:29

phantom stdout: ReferenceError: Can't find variable: $


phantom stdout:   https://assets-cdn.github.com/assets/github-1f331009569afef1b6
732009f2b35f38330c0837b8cf35ff15698f631aa4256d.js:1
  https://assets-cdn.github.com/assets/github-1f331009569afef1b6732009f2b35f3833
0c0837b8cf35ff15698f631aa4256d.js:1

  nightmare .visible() for div#login +615ms
before login
  nightmare .type() myUserName into input[name=login] +7ms
  nightmare .type() myPassword into input[name=password] +3ms
  nightmare .click() on input.button +18s
  nightmare .wait() for the element span.octicon-inbox +25s
phantom stdout: TypeError: 'undefined' is not a function (evaluating 'Array.prot
otype.forEach.call.bind(Array.prototype.forEach)')

  https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2a00235feebb2fc21
8f0e91bbe06e140fb6ca67049215c66508.js:29
  https://assets-cdn.github.com/assets/frameworks-1dca3eab4ab3b2a00235feebb2fc21
8f0e91bbe06e140fb6ca67049215c66508.js:29

phantom stdout: ReferenceError: Can't find variable: $


phantom stdout:   https://assets-cdn.github.com/assets/github-1f331009569afef1b6
732009f2b35f38330c0837b8cf35ff15698f631aa4256d.js:1

phantom stdout:   https://assets-cdn.github.com/assets/github-1f331009569afef1b6
732009f2b35f38330c0837b8cf35ff15698f631aa4256d.js:1

  nightmare .visible() for span.octicon-inbox +3s
after login
  nightmare .teardownInstance() tearing down and bumping port to 12302 +30ms
    âˆš shoud not spend a lot of time (54590ms)

  mocha:runner finished running +55s

  1 passing (55s)

  mocha:runner end +1ms

```
 Yea I do have the same problem. Everything is fast expect `.click()` and `.wait()`

``` bash
nightmare .type() asdf into #login_username +505ms
nightmare .type() xyz into #login_password +0ms
nightmare .click() on div.c1:nth-child(4) > input:nth-child(1) +23s
nightmare .wait() for the next page load +25s
```

``` js
nightmare
  .goto('https://site.com')
  .type('#login_username', user)
  .type('#login_password', pw)
  .click('div.c1:nth-child(4) > input:nth-child(1)')
  .wait()
  .screenshot(__dirname + '/temp/login.png')
```

I noticed that this is only happening when I'm on my windows machine. On Linux, everything is fast.
 I'm definitely having the same issues:

```
.click('#loginbutton').wait(500)
```

```
nightmare .click() on #loginbutton +25s
nightmare .wait() for 500ms +25s
```

Very odd.
 similar issue as well

```
 nightmare .setup() phantom instance created +3s
 nightmare .setup() phantom page created +8ms
 nightmare .goto() url: https://mixpanel.com/login/ +1ms
 nightmare .goto() page loaded: success +34s
 nightmare .wait() for the element input#id_email +505ms
 nightmare .type() bob333@gmail.com into input#id_email +111ms
 nightmare .type() password123 into input#id_password +3ms
```
 I was having the same issue with [Horseman](https://github.com/johntitus/node-horseman), so I did some investigating. I believe the cause is either phantomjs-node, or perhaps PhantomJS itself, when more than one page.evaluate is called in the same script.  Both click & wait & type all use phantom's page.evaluate under the hood.

I've opened an [issue](https://github.com/sgentle/phantomjs-node/issues/248) with phantomjs-node, hopefully they can track the actual root cause.
 The issue turns out to be related to a node module called `shoe`, which wraps socket.js.  Socketjs has a configurable option called heartbleed_delay that shoe does not let you configure.  The default `heartbleed_delay` is 25000 ms. If you manually edit that to something else, like 200 ms, everything gets sped up.

There is an open pull request against shoe to expose this config option in socketjs, but it doesn't look like shoe is actively maintained.  Here's my comment to the phantomjs-node folks. Not sure what they can do about it, except to fork shoe.

https://github.com/sgentle/phantomjs-node/issues/248#issuecomment-75621671

You can manually edit shoe yourself. Go into `node_modules/phantom/shoe/index.js` and change line 8 to read

``` js
var server = sockjs.createServer({
        heartbeat_delay : 200
});
```
 I am experiencing the same issues on windows with the slowness. 

@johntitus I tried your suggestion at it worked! much faster now. Hopefully this can be addressed, so this wont be necessary, though.
 Same root cause as #126.  See https://github.com/segmentio/nightmare/issues/126#issuecomment-94948463 for a workaround you can include in your app.
  I figured it would be useful to be able to export certain types of pages in a more printer and e-reader friendly format.
  I've noticed since changes were merged in last weekend that Nightmare no longer fills out form fields properly.  You can see an example in my repo here

https://github.com/dtothefp/nightmare-timeout-test-example/tree/master

If you run the tests, generated screenshots show that form inputs do not contain the correct information.  If you switch to my branch where I use an older version of Nightmare I previously forked:

https://github.com/dtothefp/nightmare-timeout-test-example/tree/dfoxpowell/nightmare-v1.6.0

```
rm -rf node_modules
npm cache clean
npm i
```

If you previously `npm i` in the master branch.  Then run the tests again and you will see that form fields are filled out properly.  You will also see in this branch the test timeout failures I submitted previously in

https://github.com/segmentio/nightmare/issues/102 
 I believe I'm being hit with the same issue, although the form I'm filling out does not have real-time validation on it or anything of that sort.

![login-2](https://cloud.githubusercontent.com/assets/656884/5265857/b01e0d10-7a13-11e4-8df9-2af1a579a0e3.png)

It doesn't happen every time, but when it does, it looks like it's switching focus to the password field before the email field is finished typing. I've tried adding a .wait(500) between typing in the email and typing in the password, but it still seems to occur...
 @reinpk Any news on this, or should we file an issue elsewhere? I've had my Nightmare version constrained for far too long, and there have been many updates in `node phantom` module. I'm also working to switch to PhantomJS 2.0.0 which surprising worked fine if I was on Nightmare 1.6.0 but upgraded old Nightmare package.json to 0.7.2 of https://github.com/sgentle/phantomjs-node. Even the simple Optimizely signin form fails (and this has no dynamic validation, only on form submit), as you can see the email and password get entered in the same input:

![screen shot 2015-03-22 at 11 49 50 pm](https://cloud.githubusercontent.com/assets/4656726/6773885/d36c2de8-d0ed-11e4-82c9-a121ef1972af.png)
 @reinpk I've actually pinpointed the problem to this PR https://github.com/segmentio/nightmare/pull/100/files that switches the `type` action to implement the `sendEvent` Phantom method. I'm not sure if this is a problem with `phantomjs-node`'s implementation of `sendEvent` or a problem in PhantomJS itself, but for now would you consider reverting as it doesn't seem worthwhile to have such a small change potentially effecting users?

When I get some time later in the week I can put together some tests to pinpoint the problem more acuratelly and determine if I should submit an issue with `phantomjs-node` or PhantomJS

@rosslavery If you are still having this problem revert the `exports.type` method

``` js
exports.type = function(selector, text, done) {
  debug('.type() %s into %s', text, selector);
  this.page.evaluate(function(selector, text) {
    var element = document.querySelector(selector);
    element.value = text;
  }, done, selector, text);
};
```

You can pull this from my github if you'd like

```
"nightmare": "git+ssh://git@github.com/dtothefp/nightmare.git",
```
 @reinpk do I need to contribute something to revert this change, or would you like to do it? I'm tired of pulling from a fork of Nightmare just because of this small issue
 @reinpk addressed it here https://github.com/segmentio/nightmare/pull/195. Sorry ended up having a bit of a "gitmare" and screwed up a couple PR's which I had to close. Would be great to get this merged as soon as you have a change.
 This issue has re-appeared in my tests.  Observe:

<img width="674" alt="screen shot 2015-12-25 at 12 13 19 pm" src="https://cloud.githubusercontent.com/assets/1254/12004284/b174fc3a-ab01-11e5-8df7-11b6d3859607.png">

Can somebody re-open, or shall I create a new issue?
  I think the `value` parameter should be removed from `.wait(fn, value, [delay])`, and `fn` should simply be a function that returns a boolean. It's more readable because you can see the condition that determines whether the wait is over.

In other words, changing this:

``` javascript
nightmare
.wait(function() {
  var thing = document.querySelector('.thing');
  return thing ? thing.textContent.toLowerCase() : 'goodbye';
}, 'hello', 6000);
```

...to this:

``` javascript
nightmare
.wait(function() {
  var thing = document.querySelector('.thing');
  return thing && thing.textContent.toLowerCase() === 'hello';
}, 6000);
```

Also, I cannot see any reason for `delay` to be an _optional_ parameter. If you don't specify a `delay`, the wait will be over after the first timeout, making the return value of `fn` inconsequential...

Furthermore, it would be nice if you could specify an indefinite wait that polls the page every X milliseconds, but _doesn't_ refresh it. For example, there may be a lengthy operation that is running on the page that a refresh would cancel/reset. Perhaps add a `refresh` option?

So in conclusion, `.wait(fn, value, [delay])` â†’ `.wait(fn, delay, [refresh])`.

Happy to send a pull request for any of this you agree with, if you want me to.
 Ah, I glossed over the 50ms thing, thanks for pointing that out! I was under the impression that `wait(fn, value)` would call `fn` only at the end of the timeout (which would be pointless, of course).

Still, as a plugin developer, it's a little unclear as to when I should be respecting the timeout setting of the user. Specifying a `delay` option effectively makes the wait become "indefinite" (i.e. it will wait _forever_ until the condition is true), whereas _not_ specifying a `delay` will only wait long enough for a timeout to occur. In the case of the former, I am completely ignoring the user's timeout setting, yet respecting it in the case of the latter. From the perspective of someone using my plugin, there's no way to know to which behaviour to expect (aside from looking at the source code of my plugin).

For instance, say my plugin allows the user to upload a video file via a form (a potentially lengthy operation). Depending on the size of the video and the speed of the Internet connection, it could take a long time to upload, or it could be very quick. Can I trust the user's timeout setting or not? Ideally, I'd like my plugin to "wait indefinitely" until the condition (video finishes uploading) is true, but the only way to get that behaviour at the moment is to use `wait(fn, value, delay)`, which refreshes the page (and refreshing would cancel the upload!).

I just don't understand why we're quite happy to let a plugin wait forever in the case of `wait(fn, value, delay)`, yet waiting forever _without_ refreshing the page is not allowed and has to respect the timeout setting? Seems a little arbitrary to me.
  Nightmare needs 'less real world', local web pages for testing.
- Current circleci build status is 'failed' because of timeouts.
- It would also make testing environment more consistent across the world. Yahoo serves different pages in different regions.
- Some edge case features are hard to test on 'real world' web pages.
 correct.

You can use phantomjs/nightmare to serve content (see webserver module).

Take a look to casperjs test suite for an implementation.
 I will be happy to help if needed :)

For informational purposes, see https://github.com/n1k0/casperjs/blob/master/tests/selftest.js#L16
  Hi @reinpk,

I'm part of casperjs team and I look at your project since months.
As you may notice, casperjs project is a little bit inactive... we don't have time to realy maitain it for now.

Imo, casperjs has some cons:
- not realy nodejs supported
- testing api / exporter is so coupled to the main/casper api
- a lot of weird behaviors

casperjs have also some pros:
- the best docs ever (realy, I contribute to a lot of projects including big frameworks like Symfony2, and casperjs has the best docs and a lot of samples)
- easy to use, easy to learn
- fast, realy fast / Selenenium
- fully tested, used by major companies
- (subjective) I like it, because I contribute to

I see that nightmare is actively maintained and I have a lot of ideas to suggest, probably to add fonctionnalities which I have on casper to nightmare.

You said the goal of nightmare is to expose only "few" methods, is there any chance that you change your mind on that ?

Regards,
 Hi @lambtron,

I think we don't need to make another testing library (casperjs'one was a mistake from his creator opinion) but maybe we can work on how to ease the use of major testing libraries (mocha/chai/jasmine/jest) with nigthmarejs.

Then specials plugins/helpers dedicated to use cases like REST consuming/testing can be developped (and I will give a hand).

Like you, I don't want a big API but many useful middlewares: if nightmare offer same features as casperjs I think we wont release after the 1.1.x anymore /c @n1k0

What do you think ?
 Hi,

I also (like you) experience this bad performance.

Imo the big cost is the instanciation of phantomjs webpage object. In the example you point, a new phantomjs page is instanciated for each test and the timeout is not a good idea at all in this case.

We need a better control on "how" we create, refresh and kill the phantomjs native webpage.

I will present nightmarejs on a (very) little event, so I will experiment it a lot :)
  Hello !

I have just install the latest Nightmare 1.5.6. When I try to run the "Yahoo example", I get this :

```
phantom stdout: TypeError: 'null' is not an object (evaluating 'document.querySelector(selector).focus')

  phantomjs://webpage.evaluate():2
  phantomjs://webpage.evaluate():3
  phantomjs://webpage.evaluate():3

Done!
```

Seems that works but not really correctly.
 When i tried with DEBUG=nightmare prefix, I get this :

```
  nightmare queueing action "goto" +0ms
  nightmare queueing action "type" +5ms
  nightmare queueing action "click" +0ms
  nightmare run +0ms
  nightmare .setup() creating phantom instance with options {"timeout":5000,"interval":50,"weak":true,"loadImages":true,"ignoreSslErrors":true,"sslProtocol":"any","proxy":null,"proxyType":null,"proxyAuth":null,"cookiesFile":null,"webSecurity":true} +0ms
  nightmare .setup() phantom instance created +192ms
  nightmare .setup() phantom page created +7ms
  nightmare .goto() url: http://yahoo.com +3ms
  nightmare .goto() page loaded: success +7s
  nightmare .type() github nightmare into input[title="Search"] +504ms
  nightmare .click() on .searchsubmit +9ms
    phantom stdout: TypeError: 'null' is not an object (evaluating 'document.querySelector(selector).focus')

phantom stdout:   phantomjs://webpage.evaluate():2
  phantomjs://webpage.evaluate():3
  phantomjs://webpage.evaluate():3

  nightmare .teardownInstance() tearing down +21ms
Done!
```
 Maybe _yahoo_ changed something on their site.. ?
 Not a bad idea :)
 How about a bunch more examples?
The Yahoo example is still broken.
  `./node_modules/.bin/mocha test/ -g "sequential"`
  Hey,

I want to make a screenshot from a website which embeds its fonts via `@font-face`, but they're not loaded. I will set up a demonstration and post it here.

Have a great day and keep up the good work! :octocat: 
 Okay, so I have this HTML document:

``` html
<!DOCTYPE html>
<html>
  <head>
    <title>Nightmare not lading fonts - DEMO</title>
    <style>
      body {
        font-family: Oswald;
      }
    </style>
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>
  </head>
  <body>
    <h1>This should be written in Oswald.</h1>
  </body>
</html>
```

This looks like this when viewed in Safari:
![bildschirmfoto 2014-11-10 um 12 19 49](https://cloud.githubusercontent.com/assets/1725839/4975651/bd8f5e48-68db-11e4-9dae-929ef6156de4.png)

And like this when captured with nightmare:
![bildschirmfoto 2014-11-10 um 12 19 47](https://cloud.githubusercontent.com/assets/1725839/4975657/c53bf110-68db-11e4-8112-c1382a907f5a.png)
 Looks like it's a Phantomjs issue:
https://github.com/ariya/phantomjs/search?q=web+fonts&type=Issues

Maybe give this binary a try:
http://arunoda.me/blog/phantomjs-webfonts-build.html
 Thanks @reinpk :+1: 
  Hey!
We're about to start using Nightmare to test our open source web-ide for programming lessons at Hexlet https://github.com/Hexlet/hexlet-ide. We run a virtual machine for each user and give them web-ide with terminal to write code and complete exercises. 

The only issue we might have is phantom js not being very good when it comes to web sockets (which we use to make RPC calls).
 Actually, we (Rodati.com) are using Nightmare as part of our internal platform of functional/integration testing. In the past, we used casperjs, but the poor integration with nodejs forced us to migrate to another library. 
For now, Nightmare is working OK with our platform, but, we are experimenting some problems with the limited API exposed by the library (compared to casperjs) and the difficulty of debug Nightmare if the browser have a problem with a page (specially using `evaluate`). So, for that, we are thinking test another alternatives like `node-horseman` or our fork of Nightmare.
Anyway, congrats for the great work!
 For example:
- The form methods/shortcuts: [fill()](http://casperjs.readthedocs.org/en/latest/modules/casper.html#fill), [fillSelectors()](http://casperjs.readthedocs.org/en/latest/modules/casper.html#fillselectors)
- The getters: [getFormValues()](http://casperjs.readthedocs.org/en/latest/modules/casper.html#getformvalues), [getHTML()](http://casperjs.readthedocs.org/en/latest/modules/casper.html#gethtml), etc
- The [clientutils](http://casperjs.readthedocs.org/en/latest/modules/clientutils.html#clientutils-prototype) module

I know that these methods can be simulated using `evaluate`/chaining low level methods (like click(), type(), etc), but the consecuencies are (in the first case) a overuse of `evaluate`, spending a lot of time debugging if something is not working properly or (in the second case) fragile or unmaintainable code.
 @dzignus if you need all the CasperJS API, the best way will be to use ... CasperJS.

Anyway, I think nightmare can provide more plugins, inspirated by CasperJS API.
 Yep, that's the point, my opinion is that many people are using Nightmare as a replace of casperjs, for that many are demanding features like my example of above.
 I started a website crawler to retrieve data from sites that don't have any public api. 
As its depedencies are really limited, there is no problem to use it in web-ide (as cloud9 for exemple)
 I've just started to use Nightmare to write automated browser tests, mainly because the API is a lot nicer to use than Selenium's for node.
I'm not altogether sure of a solution, but I've also run into problems where I'm not getting the data back I expect from the website under test, and have not been able to extract enough information to work out why.  
I need to fiddle with it some more; I'm prepared to persist because it's such a graceful API, but if we're going to get Nightmare.js to excel in this area it needs more complete docs and examples.
 We at [fund kis](https://fundkis.com) use it to render high quality pdf documents. we used phantomjs for that but since you switched to electron, we migrated to use nightmare. It also simplified our code. Thanks for that but please keep in mind this rendering usage...
  Any news on select / check? Temporary solution for that?
 This branch seems to work fine for me. I think the errors are from other tests in the suite as I get errors on `make test` with the master branch too. Also if you comment out all of the other tests and just leave the check and select test, it passes fine. I'd love to see this get merged soon.
 @reinpk @sperand-io ?
  ``` javascript
var Nightmare = require('nightmare');
var should = require('should');

describe('Nightmare', function () {

    it('login yahoo', function (done) {
        var nightmare = new Nightmare({
            timeout: 2000
        });
        nightmare.goto('http://www.yahoo.com')
            .click('a.sign-in')
            .wait()
            .visible('form#login_form', function (visible) {
                visible.should.be.true;
            })
            .type('input[name=username]', 'myaccount')
            .type('input[name=password]', 'mypassword')
            .click('div#submit > button')
            .wait()
            .visible('li.tab-my', function (visible) {
                visible.should.be.true; // error line
            })
            .run(done);
    });
});
```

the result come out with an error:

TypeError: Cannot read property 'should' of null
    at  ****test\test.js:14:24

Did I miss something? 
 hi, reinpk, thanks for your great work. 

About this issue, what I mean is the second click not work here:
 "click('div#submit > button')"

The process should be:
 "https://www.yahoo.com/" 
-(click login)-> 
"https://login.yahoo.com" 
-(login sucess)->
"https://www.yahoo.com/"

But the login form submit not work here,  is there something wrong with my code?
 Yahoo login test case is not the only one failed, 
the login process test case for my website failed too.  
So I think maybe there is a bug in nightmare when navigate through multiple pages by click or submit.
 I just upgrated nightmare  and run mocha tests. 
And the test failed  with a timeout.

And I see the CI build failed too.
https://circleci.com/gh/segmentio/nightmare/168

But the tests work for you, maybe I should upgrade phtomjs and test again.

Thanks.
  1. It can be set before a .screenshot() , it's not necessary to have it set at the beginning of a sequence.
2. Yes, exactly. Cropping the image to a certain dom element "size" .
   It can be used in many cases. I my case  I want to use this to extract an CAPTCHA dom element (the element doesn't contain an image) in the same browser instance. What I did to work around this problem was to create a macro to resize the screenshot in paint :)) export it in an exe and use node's child_process to execute it. But it adds around 30 sec to the process so it's inconvenient.
   If you could give access to the phantom's 'current' instance too that would be great.
   Thanks for such a fast response to my request.

You can take a look here for inspiration (if needed :+1: ) : https://github.com/smallmultiples/grunt-screenshot-element .
 Hey! 

I needed this too, so I just forked it and built it. I'm planning to create pull request but am still figuring out how to test the `clipRect` method in my spare time. 

If you want to build it yourself, @reinpk, you may find this helpful: https://github.com/bahlo/nightmare/compare/zoom-factor
 Suggest we modify `.screenshot(path)` to `.screenshot(path, [selector|boundingRectangle])`.

Inside of `.screenshot`, we could use `clipRect` to resize the viewport before actually rendering, then return the viewport size to whatever it was before. I think something like this would be nice:

``` js
nightmare
  .goto('http://www.yahoo.com')
  .screenshot('logo.png','.logo-image')
  .run()
```

`boundingRectangle` would be the normal js `{top:50, left:200, width:75, height:200}` sort of deal, for when the api user wants to capture something that can't be defined by a simple selector.

I can work on this, if it's the direction desired and no one else wants to.
 @johntitus The thing is, that we may need to crop again after zooming. So we'd need at least an own option (maybe both?)

As I said, my fork is almost done. I just need to test the `clipRect` method.
 @bahlo I don't see what's the problem with testing the clipRect method.
use .getBoundingClientRect() to get the rect options from an dom element.
ex: document.querySelector('selector').getBoundingClientRect() .

Or maybe I didn't understood correctly why you can't finish your fork.
Let me know. Thanks.
 There is no problem, I just hadn't had the time yet. I will have time in a few hours though, expect a PR today.
But thanks for the tip.
 @bahlo Oh great can't wait to use it xoxo. Sorry if I sounded rude and for my impatience . 
 Okay, I didn't have much time but finished the tests. The thing is, they are failing (because Yahoo displays a different title in Germany). I need to fix that first, so if anyone is in a hurry and wants it done asap, feel free to fork my fork and do it themselves.

Another question: How do we check if we zoomed correctly?
 It didn't work as I wanted too but I made my own version without zoomFactor.

``` javascript
/**
 * Set the rect to clip.
 *
 * @param {Object}   rect
 * @param {String} path
 * @param {Function} done
 */

exports.clipRect = function (rect, path, done) {
    debug('.clipRect() saved to ' + path + 'with this rect settings: ' + rect);
    this.page.set('clipRect', rect, done);
    this.page.render(path, done);
};
```

Tested like this:

``` javascript
var Nightmare = require('./node_modules/nightmare-zoom-factor/lib');
var rect = {};
var nightmare = new Nightmare();
nightmare.goto('https://accounts.google.com/SignUpWithoutGmail?service=youtube')
    .evaluate(function () {
        return document.querySelector('img[id="recaptcha_challenge_image"]').getBoundingClientRect();
    }, function (rect) {
        nightmare.clipRect(rect, './rect.png')
    })
    .screenshot('./test.png')
    .run(function (err, nightmare) {
        console.log("done");
    });
```

The method should be called captureDomElement :) . 
Let me know what you think :+1: 
 I made it even better with clipReact on 'selector' just like you use it on phantomjs.
Code:

``` javascript
/**
 * Set the rect to clip.
 *
 * @param {String} selector
 * @param {Function} done
 */
exports.clipRect = function (selector, done) {
    debug('.clipRect() from ' + selector);
    var self = this;
    this.page.evaluate(function (selector) {
        return document.querySelector(selector).getBoundingClientRect();
    }, function (rectOptions) {
        self.page.set('clipRect', rectOptions, done);
    }, selector);
};
```

Tested like this:

``` javascript
var Nightmare = require('./node_modules/nightmare-zoom-factor/lib');
var rect = {};
var nightmare = new Nightmare();
nightmare.goto('https://accounts.google.com/SignUpWithoutGmail?service=youtube')
    .clipRect('img[id="recaptcha_challenge_image"]')
    .screenshot('./testClipRect.png')
    .run(function (err, nightmare) {
        console.log("done");
    });
```
 ... or just take the CasperJS's one ? Why re-invent the wheel ?
[capture()](https://github.com/n1k0/casperjs/blob/master/modules/casper.js#L294) and [captureSelector()](https://github.com/n1k0/casperjs/blob/master/modules/casper.js#L372)
  How do I pass custom accept language headers to Nightmare?
I'm trying to scrape my site X times testing X different locales but need to pass in custom HTTP headers.
 My main use case is that we determine which locale we should serve based on an `Accept-Language` header.

``` js
headers: {
  'Accept-Language': 'de'
}
```
 I'd also like to pass in a custom user agent, how could I do this?
 From the documentation
https://github.com/segmentio/nightmare#useragentuseragent

Here is an untested example

var Nightmare = require('nightmare');
var nightmare = new Nightmare();
nightmare
 .useragent('Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like
Gecko) Chrome/41.0.2228.0 Safari/537.36')
 .goto('http://mywebsite');

Hope this helps,
Tim

On 3 December 2014 at 15:56, sean-hill notifications@github.com wrote:

> I'd also like to pass in a custom user agent, how could I do this?
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/106#issuecomment-65432644.
 That was perfect thank you!
    I'm trying to create multiple instances of Nightmare and finding that only one instance gets to the `run()` method and then the program exits.  Here's a sample file and output: https://gist.github.com/gwintrob/0dda54b7017de7213e68.  Basically, I'm trying to scrape 2 sites ('http://www.nytimes.com/' and 'http://www.gnu.org/') using `nightmare1` and `nightmare2`, but I only see results from `nightmare2`.

Has anyone else seen this problem?  Thanks for your help!

Note: This issue initially came up when using Nightmare 1.6.0 with async 0.9.0 (https://github.com/caolan/async).  There's an example at https://gist.github.com/gwintrob/67e44b851d435509097b, but the underlying issue seems to come from using multiple Nightmare instances.
 I also have an problem with `async`, maybe they're somewhat related (if not, I'm happy to create a new issue).

My codes looks basically like this:

``` javascript
async.map(urls, function(url, callback) {
  new Nightmare()
    .goto(url)
    .wait('#my-elem')
    // do even more stuff
    .run(callback)
}, function(err) {
  if (err) throw err;
});
```

When I run this code for one url, everything works just fine, but as soon as I have two, I get the following error: `TypeError: Object #<Nightmare> has no method 'onTimeout'`

So I started debugging and logged `self` in the `wait()` function just before the error. I then get two objects, the first has a `onTimeout()` function, the second hasn't and throws an error.

I also noticed, they are using the same port which doesn't make sense to me since I'd imagine we need to create multiple phantom instances.

Using the newest versions `async 0.9.0` and `nightmare 1.6.0` as well.
 Don't have a stack trace for it , or a proper description ( yet ) , but experiencing the same issue when consuming 2 urls simultaneously. makes me very sad
 Thanks @reinpk.  You da boss! :thumbsup:
 Hmm , having issues since 1.6.3. With a single Nightmare() instance, i can only do 1 .run() operation, the second .run() will result in EADDRINUSE .. Not sure about why , will hopefully write an isolated test case for this tonight, but it seems it's trying to create a new phantom instance (listening on the port provided in Nightmare constructor options ), but the old instance hasn't been fully discarded yet .. 

I've noticed a new .run() in 1.6.2 and prior actually increments the port, hence why this was not an issue before, no collisions really possible.
 Test here: 
https://github.com/segmentio/nightmare/pull/115 
 Not sure if this is the correct way to use nightmare actually .. Are Nightmare() instances meant to be re-usable ?

On another note , maybe this should go in another ticket since this one is already closed .. 
 Awesome , but now if we provide a port in the options when constructing the nightmare instance , that test fails ..
 Also, i think we start at port 13200 , and increment on every `.run()` call . If my understanding is correct, this means we have 65535 - 13200 possible `.run()` calls in a single process .. Would it be worthwhile investigating if we can reuse the same port per Nightmare() instance ?
  Just FYI...
  I'm running Nightmare through grunt-mocha-test with Chai assertion library.  This works great part of the time but if a test fails for some reason all subsequent tests will timeout.  Also, if the initial test fails, it seems to fail silently, and finish by timing out, rather than calling the `done` callback.  I know some of this behavior is mostly likely related to Mocha/Chai integration, but is there a teardown issue with the Phantom Instance potentially causing all subsequent tests to a failed test to timeout?

Here is the branch of my repo that I'm observing the problems in

https://github.com/optimizely/marketing-website/tree/dfoxpowell/nightmare-tests/__test__
 ![screen shot 2014-11-04 at 7 02 56 pm](https://cloud.githubusercontent.com/assets/4656726/4910395/1217d410-647f-11e4-86a4-357a63cc0b11.png)
 From testing in the node-inspector I've found that when a chai assertion fails it somehow does not execute the done function below it and moves on.  Somehow this behavior is causing the callback function passed to Nightmare's .run method to not execute.  Without looking more through Nightmares code I don't know what repercussions this has, but it seems to be preventing mocha from executing any of the following async tests, therefore all tests after a failure are timing out.
 I've discovered this behavior is that Chai and Should assertions throw errors, so unless those errors are caught, the callback passed to the Nightmare .run method will not execute.  Therefore, all subsequent Nightmare tests will not run.  Seems like alternatives would be to use jasmine-node which catches the exceptions http://www.collidingobjects.com/posts/jasmine_node_failures_explained, using try/catch blocks on all assertions, or somehow handling this within the Nightmare API.
 @reinpk sorry for the delay.  Here is an example repo.  It actually doesn't demonstrate this behavior because something you have merged in recently has fixed the problem:

https://github.com/dtothefp/nightmare-timeout-test-example/tree/master

If you switch to an older version of Nightmare you will see the behavior I'm talking about:

If you previously ran `npm i` be sure to 

```
rm -rf node_modules
npm cache clean
npm i
```

https://github.com/dtothefp/nightmare-timeout-test-example/tree/dfoxpowell/nightmare-v1.6.0

This is also referenced here:
https://github.com/segmentio/nightmare/issues/120
  This PR addresses issue https://github.com/segmentio/nightmare/issues/92 and PR https://github.com/segmentio/nightmare/pull/94.

@kevva @reinpk 

I agree that it would be nice to specify the phantom binary path rather than globally installing Phantom via Homebrew or some other method.  @kevva I tested out your solution and believe I found a problem in that the `path` property in the `options` should actually be `binary`, which corresponds to the same property in the node-phantom module.  

Therefore, you would

`var phantomPath = require('phantomjs').path;`

and instantiate nightmare the same way

`new Nightmare({phantomPath: phantomPath})`

@kevva if I use your solution I will continuously get the "phantomjs-node: You don't have 'phantomjs' installed" error message from node-phantom.
 The path shouldn't be the full path to the binary, just the dirname. So, `path.dirname(require('phantomjs').path)` should work. https://github.com/sgentle/phantomjs-node/blob/master/phantom.js#L83-L88.

But yeah, I agree. Using the full path might be better.
 @kevva you know what the problem is, when I installed Nightmare, my version of node-phantom was 0.6.6.  Therefore, that line with path isn't in my version, must be a new update.  Think it has to do with Nightmare's package.json having a tilde instead of a carrot, so if we want this PR to work for all users either we should send a PR fixing the package.json or merge this PR http://stackoverflow.com/questions/22343224/difference-between-tilde-and-caret-in-package-json

![screen shot 2014-11-04 at 8 17 14 pm](https://cloud.githubusercontent.com/assets/4656726/4911150/677c2fdc-6489-11e4-9d1b-60aa56fa4929.png)
  Fixes #81.
  I added style check.
 @reinpk I don't think that wikipedia has transparent or `visibility: hidden;` elements on the page, so I'm not sure how to test these cases. Also, yahoo supports i18n, so when I go to yahoo from Canada I get 'Yahoo Canada' in the title, and because of that some tests fail. 
It would be nice to have less 'real-world' testing environment. Some local page would work. It would also speed up testing (it takes forever with my current internet connection).
  I've got a site where I have to confirm a request. This is done via JavaScript confirm method.

```
var nightmare = new Nightmare()
  .on('confirm', function(msg) {
      console.log(msg);
      return true;
    })
  .goto()
  ....
```

I can see the message on the console but I'm stuck on the page with the confirmation and the request is not send properly.
[Phatom API](https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#webpage-onConfirm) says I just have to return `true`.
  I'm creating a NightMare instance and passing in an options object with proxy: '<ip>:<port>' and proxyType: 'http'  . the problem is that no proxy is being used when i run the script.
 Sorry, just realised i had an older version, updating fixed this.
  Fixes #92.
 What's more to be added? This only adds the ability to specify a custom path to PhantomJS in the constructor. [phantom](https://github.com/sgentle/phantomjs-node) accepts a custom path using the `path` option.

We could use the https://github.com/Medium/phantomjs module to provide a binary with this module. That would remove the need for the user to install PhantomJS manually.
  Detect is the page loading failed by function Nightmare.hasError(). Check server status code by Nightmare.getStatusCode()
  Yea, apparently the proxy ip's that i used to test it didn't work and that was the problem. #facepalm  
  I'm struggling with this one because it seems like it should just work.

When I've got things set up like so.... it should pass in arg1 and arg2 into the fn on the evaluate when it calls it right?  Well, it doesn't seem to.  In addition it seems to also throw errors that don't make sense sometimes.

The return statement is where I thought I could return whatever I wanted as a result, but when I have the callback called with res (for the result (what was returned from fn), sometimes it gives me some errors, and sometimes it just does nothing.

[pseudo-code...sort of]

```
global var1 // foo
global var2 // bar

new Nightmare()
    .blah-blah-blah
    .evaluate(fn(param1, param2){
        some code
        console.log(param1 + " " + param2);  // foo bar
        return "The result is pretty.";
    }, cb(res) { console.log(res); }, ["var1", "var2])
    .run();  // In theory produces the result of calling fn with var1 and var2, ...which would
    // be "foo bar" in the console, along with "The result is pretty."
```
 So initially I started this issue because I couldn't get the global variables into the scope of the evaluate's fn.  I found that I can avoid the whole args array and just do it this way:

```
.evaluate(fn(param1, param2) {
    some code involving param1 and param2
}(var1, var2), cb(res) {code})
.run();
```

However, there still seems to be some errors sometimes... generally when I try to use the callback and send it something with the return statement from the fn.  Maybe I just don't understand what the callback is expecting?

Any way, it seems like the args array is totally useless and broken if you ask me.
 I think you've just got the syntax wrong for evaluate. It should be:

``` js
var p1=1,
     p2 = 2;

nightmare
  .evaluate( function(param1, param2){
        //now we're executing inside the browser scope.
        return param1 + param2;
     }, function(result){
        // now we're inside Node scope again
        console.log( result);
     }, p1, p2 // <-- that's how you pass parameters from Node scope to browser scope
  ) //end evaluate
  .run();
```

That should log out a 3.
 OHHH.  That actually explains a lot!

Now I understand so much more about it.  Why it would usually never console.log or console.dir in my node shell within that browser scope...because it was doing it in the headless browser.  Then what I passed back to the cb function is the result of what I returned from that.

The syntax of it all didn't quite come to me this way either based on the API docs and no examples, especially for the passing in of my arguments.  After trying it that makes perfect sense.

However now I have a new problem, I guess it would be appropriate to close this one and start a new issue...
 It's very lucky that this GitHub issue exists, because without this thread I would never have understood that. I suggest we add this explanation to the main documentation.
 jfrumar I agree with you.  I actually feel that the documentation while enough to get doing some really cool things is still not what it could be.  I'm glad that I could help by bringing up the issue and then getting johntitus to clear it up.

This is really a great module, and I enjoy using it very much, but there's quite a bit I'm still not getting.  I hope more can be done for the docs and examples.  I find this to be so awesomely useful.
 this is very useful
 I'm able to pass strings like the example above.  But for some reason it fails on passing in functions.  Can't figure out what I could be doing wrong.  Any advice would be really appreciated.

```
var onPageLoad = function() {
  return 'I am a callback!';
};

nightmare
  .goto(url)
  .evaluate(function(pageCb) {
      return pageCb();
    },
    function(val) {
      return console.log(val);
    },
    onPageLoad
  );
```
 Okay, in case anyone else gets stuck wondering why they can't pass functions or objects into the arguments of .evaluate(), its because all the values are serialized before being sent over. 

Great explanation here: https://stackoverflow.com/questions/12222856/passing-arguments-to-anonymous-function-inside-page-includejs-and-page-evaluat
  I'm trying to work with nightmare in an "after-login" scenario (already had nightmare do the logging in and that part works great).  Only on the page that comes up after the login, it's utilizing some kind of client-side javascript to call back to the server where it checks the submitted form data and then updates the page with the results.

In an actual web browser such as Chrome the page actually does this; however in my nightmare script, the moment I tell it to click the submit button, it just resets the form or something...I end up with nothing but what I started with before entering the data.  My screenshots literally show empty form, then typed-in(filled) form, then empty form again after the click.

Am I going about this all wrong?  Or is there a real problem here?

Thanks.
 I've already tried that...tried it all day long.  Banging my head against this thing.  Here is my code, slightly modified so as to not leak anything private.

``` javascript
var Nightmare = require('nightmare');
goCards = new Nightmare()
    .viewport(800, 1600)
    .goto('https://secure.store.apple.com/us/giftcard/balance')
        .type('#login-appleId', "user@www.net")
        .type('#login-password', "password2014")
        .click('#sign-in')
    //.wait('#gift-card-balance-content-pin')
    .wait(12000)
    .type('#gift-card-balance-content-pin', "MYUBERSECRETPIN")
    .screenshot('aftertypePIN.jpg')
    .wait(1000)
    .click('button#gift-card-balance-content-checkBalance-button')
    .wait(12000)
    .screenshot('postBtnClick.jpg')
    .run();
```
 Glad I could point out something that needed fixed.  Very happy to contribute, and that it's not just me haha.
 Also, when will the newest version be available for update by npm?
 Thank you SO MUCH by the way.  That did fix my problem.  Absolutely perfect.
  Could you please add remote-debugger-port and remote-debugger-autorun?

I tried to hack this in myself,

index.js:
  if (this.options.debuggerPort !== null) {
    flags.push('--remote-debugger-port='+this.options.debuggerPort);
    flags.push('--remote-debugger-autorun=yes');
  }

But it didn't work, the console complained with the following:

phantom stdout: TypeError: 'undefined' is not a function (evaluating 'core_require('webpage')')

  about:blank:5433
  about:blank:5642
  about:blank:179
  about:blank:25
  about:blank:5645
  :1
    Updates Readme with on error description, and adds a test for it.
 The key is to add the handler BEFORE `goto()` (the same case as `viewport()`).
Please also add that to README.
 Thanks :wink:
  Currently type just changes the value property of the element. This doesn't work with libraries that listen for key events. Therefore I suggest to use phantoms `page.sendEvent("keypress", keys)` for the implementation of `type()`. I unfortunately can't provide a pull request due to work restrictions.
 I think timjacobi might be right.  Is there a workaround that I can use in the meantime?  Maybe something like:

``` javascript
new Nightmare()
    .goto('https://google.com')
        //.type('#gbqfq', "pizza")  Doesn't actually send key event..
        .page.sendEvent("keypress", "pizza")
        .click('#gbqfba')
    .wait()
    .run();
```
 I'm not alone! Ractive/mustache combo does not cope with altered value properties and needs strictly key-events.  Isn't it possible to at least expose phantom's `.page`, as woohoowebs suggests, so it's easier to add on top of it? 
 For now you could write a class that extends nightmare so you can add your own actions.
 I've been working on a fork of nightmare, and I've included this. The syntax is slightly different, but if someone wants to nightmare-ize the code, it should be fairly straightforward.

https://github.com/johntitus/node-horseman/blob/master/lib/actions.js#L184
  File is verified via `fs.existsSync` before the phantom `uploadFile` method is called.
Passes error to `run` callback. Previously, the run callback `err` attribute was hard coded to null.
Fixed a bug in `untilOnPage`, where it was returning when it shouldn't have been.
 Good question. I misunderstood what was going on. There is a test, `should wait until specific text is present`, that started failing when I returned any errors in `.run`.  It turns out that `.untilOnPage` was passing `done` directly to `.until`, but `.until` returns either true or false, and `done` in this case is Mocha's done, which is expecting only an Error or null to be passed to it. 

So, I changed `.untilOnPage` to capture the output of `.until`. If `.until` passes true, then it just calls the callback with no parms (since everything went well). If `.until` returns false (because of a timeout), it returns an Error - which is not passed to `.run` correctly.

The test itself was just broken. It was splitting on `.com` when it's calling a `.net` page, and also it's looking for a `10` which obviously only occurs every 10 seconds - but the default timeout is 5 seconds. So I gave the test a new timeout period of 11 seconds and fixed the split method. Seems to be ok now.
 After looking at how other systems handle this, I changed it so that if a .wait fails to pass before the default timeout period, it calls a new `.onTimeout` callback. The user can explicitly decide how to handle timeouts this way (throw an error, continue, up to them).
  Verify's a file's existence before calling phantom's .uploadFile(). Returns an error if path is invalid. Uses fs.existsSync.
- Modified index.js .run() to detect if the last action has passed back an error, and if so, actually send it to the .run callback. Previously, err was always going to be null.
- Added tests for .upload happy case and unhappy case.
 Seriously, I suck at git. going to clean this up and re-pull request.
  What if you just put the **specific** phantomjs/slimer/trifle options into something like:

``` js
{ phantom: ['--one=1', '--two=2'], trifle: [], slimer: [] }
```
 @fbm-static It is inconvenient when we must pass similar arguments to different engines.
 @execmd Right.
 I prefer this approach, but would request that `sslProtocol` default to `any`, unless there's a security issue with that. Also, perhaps add a default for `--web-security`.
 Nice.
 Thanks for adding this in. Will suggest my team to use this in production now.
  +1
  I have a fork of phantomjs-node that supports PhantomJS 2, and I am trying to get it accepted upstream.  The changes so far look pretty clean and are backwards compatible with PhantomJS 1.9.7, so hopefully that goes smoothly.  In the meantime, people that want to give Phantom 2 a spin should be able to replace the nightmare version in their package.json with "https://github.com/bprodoehl/nightmare/archive/phantom2.tar.gz"

The PR for phantomjs-node is here: https://github.com/sgentle/phantomjs-node/pull/209
 This landed today in version 0.7.0 of the phantom package.
 Updated nightmare's package.json to phantom 0.7.0 and all tests passed. However, I don't have phantom 2.0 as that thing would take years to build on my box, and pre-built packages aren't available yet.
 What's your platform?  I posted pre-built packages of the latest still-in-development snapshot of 2.0 for 64-bit OS X and Linux here: https://github.com/bprodoehl/phantomjs/releases

I would only suggest using those if you want to see if 2.0 fixes a problem you're seeing in 1.9, though.  They're two weeks old, but they are so far still up to date with https://github.com/ariya/phantomjs, since the POODLE fix is still just on the 1.9 branch.

The big change I noticed, and why I care, is that 2.0 can actually render D3.js SVG stuff properly, and that was largely a trainwreck with 1.9.7 and earlier.
 Very cool, I'll check those out.
 Any results with Nightmare + Phantomjs 2?
 PhantomJS just released 2.0.0-stable https://github.com/ariya/phantomjs/releases/tag/2.0.0
 Should this be closed? Nightmare is apparently working without any problems with PhantomJS 2.
 Yes, please close.  Thanks!
  new pull request. Still don't understand squash command.
  Adds a .visible() method.

New pull request because I goofed the last one's git history.
  Allows to pass phantomjs arguments via new Nightmare() second argument
Example:

``` javascript
var nightmare = new Nightmare({
    'ignoreSslErrors': true,
    'sslProtocol': 'tlsv1'
});
```

The phantomjs will be called with this arguments
 Can we get this merged? It would be really helpful to test HTTPS sites.
 @reinpk what exactly do you want to happen. I think they look better that way.
 @reinpk options and arguments have different purposes. Each arguments element must be passed as string to the phantomjs, but options - as whole object. 
 That's ok. Thanks!
  ``` js
'use strict';

var Nm = require('nightmare');
var browser = new Nm();
var events = [ 'initialized', 'loadStarted', 'loadFinished', 'urlChanged', 'navigationRequested', /*'resourceRequested', 'resourceReceived'*/, 'consoleMessage', 'alert', 'confirm', 'prompt' ];

events.forEach(function (event) {
  browser.on(event, function() {
    console.log('event %s: %j', event, arguments);
  });
});

browser
  .useragent('Cheddar Cheese Dip')
  .goto('http://twitter.com')
  .screenshot('twitter_com.jpg')
  .goto('http://httpbin.org')
  .screenshot('httpbin_org.jpg')
  .evaluate(function () {
    return document.title;
  }, function (res) {
    console.log('title: %j', res);
  })
  .goto('http://gfycat.com')
  .screenshot('gfycat_com.jpg')
  .run(function (err) {
    console.log('err:', err);
  });
```

`twitter_com.jpg` will become a black image.

Here's a log:

```
$ node app.js                                                                         
event navigationRequested: {"0":"http://twitter.com/","1":"Other","2":true,"3":true}  
event loadStarted: {}                                                                 
event navigationRequested: {"0":"https://twitter.com/","1":"Other","2":true,"3":true} 
event loadFinished: {"0":"fail"}                                                      
event initialized: {}                                                                 
event navigationRequested: {"0":"http://httpbin.org/","1":"Other","2":true,"3":true}  
event loadStarted: {}                                                                 
event urlChanged: {"0":"http://httpbin.org/"}                                         
event initialized: {}                                                                 
event loadFinished: {"0":"success"}                                                   
title: "httpbin(1): HTTP Client Testing Service"                                      
event navigationRequested: {"0":"http://gfycat.com/","1":"Other","2":true,"3":true}   
event loadStarted: {}                                                                 
event urlChanged: {"0":"http://gfycat.com/"}                                          
event initialized: {}                                                                 
event loadFinished: {"0":"success"}                                                   
err: null                                                                             
```
 Had to temporarily do this at `lib/index.js:114`

``` js
phantom.create('--ssl-protocol=tlsv1', { port: port, dnodeOpts: dnodeOpts }, function(instance) {
```
 You can use this https://github.com/segmentio/nightmare/pull/62
 #76 fixed it.
  Any plans to add support for SlimerJS and TrifleJS? I believe it has similar implementation.

Would be nice to see an `engine` method as an option (defaults to phantomjs).

``` javascript
var Nightmare = require('nightmare');
new Nightmare()
+  .engine('slimerjs')
  .goto('http://kayak.com')
  .evaluate(function () {
    return document.documentElement.innerHTML;
  }, function (res) {
    console.log(res);
  })
  .run();
```

Thoughts?

Thanks!
 :+1:  Would love this feature, it's what is missing from other high-level wrappers like CasperJS
 Could be the killer feature :)
 @ryanmcdermott this is just "wrong".
CasperJS is the first and the _only_ testing tool that supports both phantomJS and SlimerJS, and TrifleJS has been developped using the CasperJS testsuite.

So, at this point this is a missing feature of nightmareJS that is already implemented in CasperJS ;)

Then, :+1: nightmareJS is a very promising project !
 Let me know if you need a hand with TrifleJS, I'm development mode at the moment.
  Added an optional boolean to .run that tells Nightmare to not teardown the instance when run is complete, so you can do some conditional control flow. 
Added a larger example, using the no-teardown option & some control flow examples.
 Nice contribution. Thank you.

However the code you added is inconsistently formatted in regards to itself. Sometimes you put spaces inside parentheses `if ( foo == bar )` and sometimes you don't. When submitting pull requests, you should make an attempt to match the coding style of the project you're contributing to.
 +1 for this feature
 What is the status of this feature? I find it very, very useful. 
Can we please have a merge to master if there are no objections?
 +1 much wanted!
  Determines if a selector is visible or not. Used jQuery's check, which is so straightforward I'm worried I missed something:

https://github.com/jquery/jquery/blob/10399ddcf8a239acc27bdec9231b996b178224d3/src/css/hiddenVisibleSelectors.js
 Goofed the merge/squash. Going to do a new branch and new pull request.
   Should be ok now.
 Closing so I can submit a new, cleaned up pull request.
    I grabbed the example code and modified it:

``` javascript
new Nightmare()
    .goto('http://kayak.com')
    .evaluate(function (page) {
        return page;
        // return document.documentElement.innerHTML;
    }, function (res) {
        console.log(page);
        // console.log(res);
    })
    .run();
```

The output in the terminal is:

```
>> node test.js

stream.js:94
      throw er; // Unhandled stream error in pipe.
            ^
ReferenceError: page is not defined
```
 My mistake there (I should have gone to sleep at that point). Maybe I'm misunderstanding what `page` is here...

``` javascript
new Nightmare()
    .goto('http://kayak.com')
    .evaluate(function (page) {
        return page;
    }, function (res) {
        var json = JSON.stringify(res,null,4);
        console.log(json);
    })
    .run();
```

```
>> node test.js
{}
```
 The first method in .evaluate() is a javascript function that is executed inside the browser that nightmare/phantom created.  It doesn't have access to the phantomjs "page", so in essence the first function is just returning "undefined".  In the second function you call JSON.strintify(undefined), which returns an empty object, which is then console.logged as "{}".
What are you trying to accomplish?
 @johntitus thanks for clearing that up. That's what I thought. I copied that from the example, and I couldn't figure out why "page" is being passed into that first function.
  Let's the user set dnode options. This will allow windows users to avoid issues with the Weak module in phantomjs.  Per this issue https://github.com/segmentio/nightmare/issues/23
 Yeah i think that makes way more sense. I just pushed up a change
 Fixed style issues. 
  Brew is only for mac. You're not alone in this world. Some(lot) of us are on pc or just debian, ubuntu and other great OS. We don't need to know you've a Mac.

Sorry for saying this like this, but it's really annoying to see a lot of people thinking that all of developers are on mac. It's not true.
  Added .authentication(userName,password) method for basic http auth. Updated readme & tests.
 Merged, but I've somehow managed to make things worse commit message wise. I'll have to ask a guy with more git-fu for help when he comes in tomorrow.
 This request's git history is fubar. I'm going to close and reopen with a new pull request.
  Seems like a lot of questions being received were basic "How do I run this?" type, so I expanded the Usage instructions to make it clear 
A) that Nightmare is a Node module
B) how to execute nightmare
C) how to debug it
D) how to run automated tests
  I believe phantomjs allows to store cookies to an external file
 +1 for `.cookie()` function
 Awesome! If you don't end up having time to make the PR, I've
started on implementing this functionality as well and would be
more than happy to turn my changes into a PR.

## 

Zach Latta
http://zachlatta.com
https://github.com/zachlatta
https://twitter.com/zachlatta

On Tue, Oct 21, 2014, at 05:19 PM, TZ | å¤©çŒª wrote:

  I will pull this later.
- cookie file should be import by phantom art
- add cookie(callback), then merge callback result to cookie.
  
  â€”
  Reply to this email directly or [1]view it on GitHub.

References
1. https://github.com/segmentio/nightmare/issues/50#issuecomment-60019879
 Don't quote me on it, but isn't addCookies used on the PhantomJS instance itself?

## 

Zach Latta
http://zachlatta.com
https://github.com/zachlatta
https://twitter.com/zachlatta

> On Oct 21, 2014, at 8:24 PM, TZ | å¤©çŒª notifications@github.com wrote:
> 
> had pull #71 , can read cookies and modify, but can't add new cookies cause I got problem with this.page.addCookies
> 
> â€”
> Reply to this email directly or view it on GitHub.
 Any update on this?
 Waiting too =/
 This issue seems to be fairly old, and I believe was against 1.x.x of Nightmare which was based on Phantom.

For what it's worth, adding cookies should be possible with [`cookies.set()`](https://github.com/segmentio/nightmare#cookiessetname-value) added in 2.0.9.

I'm going to consider this issue resolved.  If it's still an issue, feel free to reopen or file a new issue.
  Is it possible to set the language used by phantom in nightmare?
 Apologies for the delayed reply.

Nightmare would be great a simplified version of phantom to quickly check if translations are functioning properly on a web app.  It would be great if I could on the fly set my region to being German, for an example, and make assertions that the right string are being returned.

So far this seems to not be as easy as I would hope.
 I believe that languages in websites are either static, manually selected (and a cookie set), or auto-chosen based on IP location.  A lot of websites detect the location of the IP first (for example a German IP address from a German pool/block of IPs owned by a German company or the German government).  However, you could go set your language to German in your real web browser and find out if the site set any language cookies.  Then you could manually make that into a persistent cookie in your nightmare project, and theoretically you achieve the result you were after.

I hope that helps.
  I have 
`phantomjs --version` `1.4.0`

When I try out any of the examples in the README, I always only get:
`phantom stdout: XMLHttpRequest cannot load http://localhost:12301/dnode/info. Cannot make any requests from null.`

What can I do? 
  Disclaimer: I've never worked with PhantomJS before, only with [nightwatch](http://nightwatchjs.org/).
The README is missing an important line for newcomers-- how to execute the tests?
Also if only `node testname.js` needs to be executed (I don't know if I'm doing it correctly) no output is shown to track progress/debug.
 +1
 I've submitted a pull request documenting this, but in short, just run `make test`. It uses Mocha, so you'll see some dots appear and then the number of passing/failing tests.
 @johntitus if I run `make test` at the directory-- I get a response from my GNU make:
`make: *** No rule to make target 'test'.  Stop.`
I believe I need a Makefile, but again: what command should it run?
 There's a Makefile at the root of Nightmare. Make sure you call make from that directory.

https://github.com/segmentio/nightmare/blob/master/Makefile
 Are we talking about the same? 
I meant the tests I'll write to test my apps, not the functional tests of the library.
 Ah, sorry, I did think you were talking about the functional tests.

To execute your own file, you just do `node mytestfile.js`.  Nightmare doesn't spit out any output unless you write some into the process yourself.

You can do that by using the evaluate function's callback.

``` javascript
new Nightmare()
 .goto("http://www.google.com")
 .evaluate(function(){}, function(){ console.log("step1")})
 .goto("http://www.yahoo.com")
 .run()
```
 Thanks.
Adding exactly what you just posted to the README would be awesome.
EDIT: The example with the .evaluate() function to indicate progress worked fine.

Now when I try to run the first example I got this:

```
phantom stdout: TypeError: 'null' is not an object (evaluating 'element.value = text')

phantom stdout:   phantomjs://webpage.evaluate():3
phantomjs://webpage.evaluate():4
phantomjs://webpage.evaluate():4

Done!
```
  This is a great little nifty plugin!

I'm wondering if there's any way to get user input while Nightmare is running. I want to be able to pull my bank info automatically, but in order to log in to my bank account I have to:
1. Go to the login page
2. Type in the code generated by the website into my physical device (I can see the code by using .screenshot())
3. My device generates a new code that I type into the website to log in.

The problem is the third step. Is there a way for Nightmare to get some user input AFTER that it has been initiated? Either through stdin, or maybe just by using .wait() so that you have time to edit a textfile that it can later read from?

Thanks!
  [PhantomJS allows setting the username and password](http://phantomjs.org/api/webpage/property/settings.html) to use when receiving a WWW-Authenticate request. It'd be very useful if this could be added to supported options pass through of nightmare as well.
 Thanks!
  nightmarejs: command not found.

It must work a little differently than phantomjs on the command line. As far as I know I installed it properly. 
 I went to the nightmare-master folder, ran "make" from the commad-line. It looked like node modules were added to the folder. I then included test/index.js in an HTML file as a script... opened up that file and there weren't any results. 

So it sounds like using the Terminal has nothing to do with using nightmarejs.. I thought it was kind of like using SlimerJS, CasperJS, etc. Is using nightmare like using libraries or frameworks such as AngularJS, jQuery, etc? I use a type of Ubuntu linux. The whole thing might sound like common sense to you, but there isn't a clear indiciation of how you use it. 
 In the folder nightmare-master/test/ there is the file index.js. So, I put an HTML file with this in it:  
    script src="index.js"  /script
(I had to delete the brackets because it wasn't showing up in here)

I then opened that up with a web browser. Since I'm not seeing any results, does this mean I didn't install or configure it properly? I just want to interact with web sites without having to be present for all of it, and it seemed like nightmare would be the perfect fit as I saw the comparison of PhantomJS and Nightmare side by side (the nightmare version was much shorter and simplified.) 
  Allows a user to attach callback to Phantom's page events.
https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#callbacks-list

Added tests, but for some reason the alert, prompt, and confirm event tests cause phantomjs to crash. However, they all work fine in normal usage. I have no idea what the issue is. Perhaps someone more familiar with phantom can figure it out.
  Running into this when trying to run the examples:

```
  nightmare queueing action "evaluate" +0ms
  nightmare run +5ms
  nightmare .setup() creating phantom instance on port 12301 +1ms
phantom stdout: TypeError: undefined is not an object (evaluating 'phantom.args[0]')


phantom stdout:   /Users/matt/Playground/node_modules/nightmare/node_modules/phantom/shim.js:5421
  /Users/matt/Playground/node_modules/nightmare/node_modules/phantom/shim.js:5599
  /Users/matt/Playground/node_modules/nightmare/node_modules/phantom/shim.js:159
  /Users/matt/Playground/node_modules/nightmare/node_modules/phantom/shim.js:11 in require
```

This could definitely be an issue with `phantomjs` on 10.10, but any ideas?
 Oh, it could also be because I'm running `2.0.0`:

```
$ phantomjs --version
2.0.0 (development)
```
 Yep, that was it. I guess it's a good heads up ;-)

Great project!
 @reinpk What's the outlook on supporting PhantomJS 2.0.0?  Do you have any idea how much effort would be involved, and how much the Phantom devs have actually been changing the interfaces?  1.9.7 does a pretty terrible job of rendering interactive D3.js, and my attempts at bridging the gap in my app between what D3 wants and what 1.9.7 supports haven't worked out so far.  So far interactive D3.js looks great in PhantomJS 2.0.0.
 Sorry, I see the same error just running phantomjs-node examples, so I don't think this has anything to do with nightmare.
 I'm having the same issue but with phantom 1.9.7, but I'm not running the examples

phantom stdout: TypeError: 'undefined' is not an object (evaluating 'x.options')
 My OS is MacOS 10.10,and phantomjs is 2.0.0 (development),has this problem,please fix it
 @mariodu The problem lies in a package that nightmare depends on.  I have created a ticket under that project here: https://github.com/sgentle/phantomjs-node/issues/208

@fernandopasik are you sure the problem isn't in your code?  I'm not finding "x.options" anywhere in nightmare or phantomjs-node.
 I've forked [Node PhantomJS](https://github.com/Medium/phantomjs) and hacked around with it to install the only "stable" version for Mac of Phantom 2.0.0 I could find:

Version I'm using: https://github.com/eugene1g/phantomjs/releases/download/2.0.0-bin/phantomjs-2.0.0-macosx.zip
Fork: https://github.com/dtothefp/phantomjs

So, you could just `require` the binary path

``` js
var phantomPath = require('phantomjs').path
var nightmareOptions = {
  path: phantomPath.substring(0, phantomPath.lastIndexOf('/') + 1),
}
```

@bprodoehl it looks like you have shimmed the `phantomjs-node` package and the binary works fine with it. I just tried using the binary with Nightmare and it seems to work fine.

Also, I saw in your PR that the previous `phantom.args` are defined on `system.args`. Is this the syntax moving forward with PhantomJS 2.0.0?
    Love the tool, definetely better than casperjs.
Can we have more examples such as but not limited to :
--how to open and post to multiple urls
--dynamic loading,lazy-loading 
--javascript injection

Thank you :+1: 
 --authentification
+1
 +1
  ```
var Nightmare = require('nightmare');
var nightmare= new Nightmare();

nightmare
    .goto("http://www.google.com")
    .wait("input")
    .run(function( err ){
        if ( err ) throw err;
    });
```

results in

```
phantom stdout: SYNTAX_ERR: DOM Exception 12: An invalid or illegal string was specified.

phantom stdout:   phantomjs://webpage.evaluate():2
  phantomjs://webpage.evaluate():8
  phantomjs://webpage.evaluate():8
```

The selector used doesn't seem to matter - it always throws the error.
 Exact same problem here.
  I was wondering your thoughts on adding a method to break out of the nightmare chain, so that you can execute things in Node's context. I'm thinking of an action like this:

```
exports.node = function( callback, done ){
  callback( this, done );
};
```

which would allow something like this in the nightmare chain:

```
nightmare
    .goto("http://www.google.com")
    .node( function( n, done ){
        n.screenshot("out.png");
        ///image processing in the local filesystem
        request.post(/* send the processed file somewhere */, function(){
            done();
        });
    })
    //continue the chain
    .run();
```

You can accomplish nearly the same thing with .evaluate, but this is more explicit and gives you access to the nightmare instance.
  In Chrome on latest Android on a Nexus tablet:
![screenshot_2014-10-07-23-26-46](https://cloud.githubusercontent.com/assets/419884/4554785/4a1051e8-4eb4-11e4-8ad1-0fcdcce39c96.png)

And they're also not scrollable, so it's not possible to view the cut-off parts of the code at all.
 i.e. https://github.com/segmentio/nightmarejs.org/commit/a23340be4da244fb605e4ced44425a217e59a305
  Hi. Thanks for the neat tool.

I'm trying it out tonight and have hit a roadblock that I can't seem to make it around. I'm looking to add a conditional branch to my pipeline -- i.e. if a certain element is visible on the page, then click it and fill out some form, if that element is not visible then just proceed to whatever else you were going to do.

I can't seem to figure out a way to do this without dropping down to raw JS for that alternate flow in an `evaluate` -- which kind of defeats the whole purpose of using this abstraction. I thought about adding the control flow in the callback used in `run()`, but it seems that the `nightmare` instance returned as the second argument there has already been deconstructed, meaning I can't queue up any further interactions with it.

Are there any examples of this functionality?
 yes..this enhancement if being implemented would be really helpful..
 I pushed a noTeardown pull request, but I was thinking there is an alternative. The noTeardown option, which keeps Nightmare alive after .run() so you can do conditional flow is really just trying to force the chained api to work in a non-chained way, and it's kind of messy. If you're doing a lot of conditional work, you'll end up in a hard-to-manage callback hell.

Alternatively, we could re-architect Nightmare to run through it's chain synchronously, and offer an explicit .close() method to get do the teardown when all work is complete.
An example:

``` js
var nightmare = new Nightmare();
nightmare.goto("http://www.google.com"); //execution halted while phantom loads the page

if ( nightmare.exists("input") ){ //returns true/false synchronously
// do something
} else {
// do something else
}
nightmare.close();
```

It'd be a major change, and I know forcing synchronicity on Node may make some people grab their pitchforks, but I think it would make Nightmare easier to use.
 +1 to follow on this issue.
What I tried to do is to submit the form for each drop down list option on the page, can't figure out how to do it with current API.
 I've worked around this by using .use(). Inside this function, the queue is "paused", so you can control flow. Also, using this plugin interface help to avoid callback hell.
 I'm struggling with this issue too - I assumed that the 'nightmare' object that's passed into the callback to 'run' would allow further queuing and running.

it looks like I'll have to re-login and initiate my session for each branch in my flow until another option comes along.
 I ran into this problem too and found that nightmare doesn't support my needs, so I'm currently working on an alternative called [Phantasma](https://github.com/petecoop/phantasma) which uses Promises to handle the asynchronous methods, rather than queueing. Which means you can change control flow at any point.

It's not ready yet, when I'm sure it's stable I'll release v1.0 however would be nice to have some early feedback either on the API or by beta testing - everything in the API docs is working so far (however before 1.0 release may change at any point).

https://github.com/petecoop/phantasma
 That looks really compelling Pete! Please let us know when it's ready.

Sent from my Android
On Mar 7, 2015 8:18 AM, "Pete Cooper" notifications@github.com wrote:

> I ran into this problem too and found that nightmare doesn't support my
> needs, so I'm currently working on an alternative called Phantasma
> https://github.com/petecoop/phantasma which uses Promises to handle the
> asynchronous methods, rather than queueing. Which means you can change
> control flow at any point.
> 
> It's not ready yet, when I'm sure it's stable I'll release v1.0 however
> would be nice to have some early feedback either on the API or by beta
> testing - everything in the API docs is working so far (however before 1.0
> release may change at any point).
> 
> https://github.com/petecoop/phantasma
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/36#issuecomment-77696017.
 Thanks @jfrumar, will do! I've created a [v1.0 milestone](https://github.com/petecoop/phantasma/milestones/v1.0.0) with the issues I aim to complete before going 1.0
 Hey @jfrumar, I've just released v1.0 as I've met my original goals - check it out https://github.com/petecoop/phantasma

Open an issue if you've got any feedback 
  Is nightmare seems like it would be a suitable solution for web scraping. Do you think you could write an example?
 Actually using PhantomJS is the better solution for webscraping since merely parsing the HTML returned by the server won't work but for the most simple web applications. You want the JS to run and to contribute to building the page. There are many web applications you cannot web scrape without such a solution. I have been using CasperJS to do just that before finding Nightmare (all my code is still in CasperJS at this time). @jwmarshall, I wouldn't call the following a complete web scraping example but it does run a function in phantomJS, accessing jQuery on the page and returning the results for the server side to process: https://gist.github.com/edasque/df1a8f48f3e0528ae3f8
   Can you maybe change function calls/definitions like

``` javascript
fn( note )
```

to

``` javascript
fn(note)
```

just so it's consistent with the existing code style.

Also, what do you guys think: When there's a option to inject js into the page there should also be an option to inject css easily:

``` js
nightmare
  .inject('js', './file')
  // -> Requires ./file.js

  .inject('css', './file')
  // -> Requires ./file.css

  .inject('./file')
  // -> Always requires ./file.js
```
 Should work for js or css now. It works by getting the page contents and appending either a `<style>` or `<script>` tag. Does not use the phantom.injectJs method, which it did previously, because that seemed to overwrite injected CSS. 

It does require a `'type'` param, of either js or css. I could try and guess the file type based on the string ending in .css or .js, but I wasn't sure if that was a good approach or not.
  Cloned project. cd to project. npm install. created a `google.js` with:

```
var Nightmare = require('nightmare');
new Nightmare()
  .goto('https://google.com')
    .type('input#gbqfq', 'github nightmare')
    .click('button#gbqfba')
    .run(function(err, nightmare) {
      if (err) return fn(err);
      fn();
    });
```

tried running `node google.js`

Error:

```
stream.js:94
      throw er; // Unhandled stream error in pipe.
            ^
ReferenceError: fn is not defined
    at /Users/dstanton/Sites/_projects/nightmarejs/nightmare/google.js:9:7
    at next (/Users/dstanton/Sites/node_modules/nightmare/lib/index.js:59:34)
    at f (/Users/dstanton/Sites/node_modules/nightmare/node_modules/once/once.js:16:25)
    at Proto.apply (/Users/dstanton/Sites/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/dnode-protocol/index.js:123:13)
    at Proto.handle (/Users/dstanton/Sites/node_modules/nightmare/node_modules/phantom/node_modules/dnode/node_modules/dnode-protocol/index.js:99:19)
    at D.dnode.handle (/Users/dstanton/Sites/node_modules/nightmare/node_modules/phantom/node_modules/dnode/lib/dnode.js:140:21)
    at D.dnode.write (/Users/dstanton/Sites/node_modules/nightmare/node_modules/phantom/node_modules/dnode/lib/dnode.js:128:22)
    at SockJSConnection.ondata (stream.js:51:26)
    at SockJSConnection.emit (events.js:95:17)
    at Session.didMessage (/Users/dstanton/Sites/node_modules/nightmare/node_modules/phantom/node_modules/shoe/node_modules/sockjs/lib/transport.js:220:25)
```
 Great! Thank you!
    Trying to add direct checkbox and select dropdown support but can't get the tests to pass. Think it makes sense to break the tests for each of those methods apart...  Was trying to run them against a raw custom jsFiddle but jsfiddle ends up wrapping it in an iframe (even if you use the raw src url) so that you can't reach it with js... will need to use a different test site
  In the [simple api](http://www.nightmarejs.org/#simple-api) section of the website, the code formatting(?) is converting the double-quotes to &amp;#x201d; (ironically enough, not 201f for the opening quote) and the apostrophes to &amp;#x2018; and &amp;#x2019; in the code snippets.

This stops users from copy-and-pasting the examples into their terminal or their editor, along with looking out of place with the rest of the fixed-width font.
  Why would a wait timeout not result in an error considering it would not be yielding the expected result?
  Weak is a module that requires cpp compilation which is a [terrible experience for Windows developers](https://github.com/sgentle/phantomjs-node#use-it-in-windows) and it can be disabled through the `phantom.create` option: `{ dnodeOpts: { weak: false } }`

Since phantom port is already an implemented option, this would be implemented in much of the same way.
 Nice addition, thanks!

On Mon, Oct 20, 2014 at 1:08 AM, Peter Reinhardt notifications@github.com
wrote:

> Closed #23 https://github.com/segmentio/nightmare/issues/23.
> 
> â€”
> Reply to this email directly or view it on GitHub
> https://github.com/segmentio/nightmare/issues/23#event-180642932.
  eg:

``` js
nightmare.run();
```

if you dont care to wait for it to finish (like when running on a loop)
 yup, just a convenience thing i ran into while working on something that ran nightmare on an interval
  A cool idea might be to add the ability for each plugin to append metadata to the `nightmare` instance. I know that [metalsmith](https://github.com/segmentio/metalsmith) does the exact same thing. It would be incredibly helpful when you try to communicate with those different plugins and easier for testing.

``` js
Nightmare()
  .use(plugin())
  .run(function () {
    var val = nightmare.metadata.value
    assert(val, 'test')
  })

function plugin () {
  return function (nightmare) {
    nightmare.metadata.value = 'test'
  }
}
```

won't be too difficult to implement. I can make a PR if this make sense to add in.
  Can we alias these?

``` js
Nightmare.prototype.agent =
Nightmare.prototype.useragent = function () {}
```
 +1
  otherwise there are some problems with the native `weak` bindings
  Hey guys!

First off thanks for the awesome PhantomJS wrapper. I really enjoy the approach you took to queuing actions upfront, and the plugin architecture.

---

I ran into a scenario where multiple Nightmare instances would be spun up at the same time, but in separate node processes, and found that the ports were colliding between the two processes.

In order to work around this, I added an option to the constructor for specifying port, so that I could eventually randomize the port when the node processes were being created to minimize collision.

I thought I'd post back the contribution, to get your guys feedback on it. I didn't see any specific tests around constructor options, but I'm happy to add some, if you guys want.

Thanks!
  I tried to fix https://github.com/segmentio/nightmare/issues/10. Not really sure if this is the right way but it's the simplest I have come up with. Basically we just run each plugin seperate and call the next function in the main queue when the given plugin is done.

``` js
new Nightmare()
  .use(first())

function first () {
  return function (nightmare, done) {
    nightmare
      .goto() // etc ...
      .run(done);
  }
}
```

Would love to hear what you think and if it makes sense to `.run()` each plugin. @reinpk
 Awesome! I just took a peek at the changes, updated my current version and it works great now!
    Let's say I have a simple search task:

``` js
new Nightmare()
  .use(tw.login('user', 'pw')
  .use(tw.search('503'))
  .use(function plugin () {
    return function (nightmare) {
      // function gets executed immediately, before tw.search() and tw.login() are done.
    }
  })
```

The return function get's executed immediately after nightmare is instantiated. If `search()` returns some properties that I want to use for `plugin()`, they would be undefined since the function was executed before the plugin.

Not sure if this can be done and if I'm missing something but the `.use()` function could be added to the queue so that all the other tasks before finishes first.
  Great work on the latest commits, much nicer now :) (Also I noticed some speed improvements since you changed to phantomjs-node)

There is one problem with the `.run()` method though:

``` js
new Nightmare()
    .goto('http://yahoo.com')
    .evaluate(function () {
      return document.title;
    }, function (title) {
      console.log('1')
    })
    .run(function (err, nightmare) {
      console.log('2');
    });
```

then the output would be:

``` bash
  2
  1
```

which doesn't make sense, right? It should first report the `1` and then it should invoke the callback from `.run()`. Right now it's the opposite. Couldn't figure out why though.

Quick fix is to throw a `.wait(500)` in between. But this gets quite hard to guess the time it takes for `.evaluate()` to finish especially if it does not always have the same execution time.
  There are some major problems with node-phantom: 
- https://github.com/alexscheelmeyer/node-phantom/issues/83
- https://github.com/alexscheelmeyer/node-phantom/issues/89

The repository hasn't changed since 6 months ago and he hasn't replied to any of those issues. [phantomjs-node](https://github.com/sgentle/phantomjs-node) is much more active and has the above issue fixed. 

No need for those 

``` js
this.page.setFn('EVIL_EVAL', ...)
```

hacks.
   sweet, thanks! You should probably test if the viewport changes. Something like this:

``` js
var size = { width: 500, height: 400 };
new Nightmare()
  .goto('http://www.wikipedia.org/')
    .viewport(size.width, size.height)
    .run(function () {
      return {
        width: window.innerWidth,
        height: window.innerHeight
      };
    }, function (err, res) {
      if (err) throw err;
      res.should.eql(size);
      done();
    });
```
 Also, are you sure changing the agent works? I tried the same thing and it didn't work properly. when I tried to check for `navigator.userAgent` in the browser, they wouldn't match up. There are bugs in node-phantom involving this:
alexscheelmeyer/node-phantom#83
  looks like there is no way of getting out of `run` method and continue the chain, see the code below..

``` js
var Nightmare = require( 'nightmare' );

new Nightmare()
  .goto( './pulse/jasmine/specrunner.html' )
  .run(function() {
    return $( '.alert' ).text();
  }, function( err, res ) {
    console.log( 'test status: ' + ( !!res.match( /passing/i ) ) );
    if( err ) { throw new Error( err ) };
    return;
  })
  .done(function( nightmare ) {
    // <<-- cannot reach here 
    console.log( 'done' );
    process.exit( 0 );
  });
```
 the error is not thrown ( `err = null` ),
assuming the happy path in the example above, the code does not seem to move on to the `done` method.
 it also hangs for me. As soon as you `.run()` it won't go to the next chained fn:

``` js
new Nightmare()
    .goto('http://www.wikipedia.org/')
      .run(function (param) {
        return document.title + '--' + param;
      }, noop, 'test')
    .done(function (nightmare) {
      process.exit()
    });
```

The process never exits. There is also never an error thrown into `noop(err, res)`
  Would be awesome if we could add an option to change the userAgent. 

Maybe we could add it as an optional parameter to the `.goto` function.

``` js
new Nightmare()
  .goto(agent, 'http://site.com')
  .goto('http://example.com')
```

But it might be better to set something like this global and add it to the options object for `nightmare`

``` js
new Nightmare({
    agent: 'Chrome ...'
  })
  .goto('http://example.com')
```

you can modify the user agent in phantomjs from `page.settings.userAgent`.

btw, great libary! So much easier to work with, especially without the callback hell and those unnecessary complex function names :p
 You might want to change the agent to see how a site reacts, so maybe more like this:

``` js
Nightmare()
  .agent('chrome')
  .goto('http://example.com')
  .evaluateSomething()
  .agent('firefox')
  .goto('http://example.com')
  .evaluateSomething()
```
  is there an easy way to access the `window` object ?
 perfect.
